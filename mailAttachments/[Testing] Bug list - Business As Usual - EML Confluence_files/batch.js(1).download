WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--02a4084a95', location = 'aui.chunk.75130b495e607a7338f0--2f04e9650b240a083ff5.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--02a4084a95"],{M4tZ:function(E,n,o){var i,u,A;
/*!
 * jQuery UI Keycode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */u=[o("oDIA"),o("O+lX")],void 0===(A="function"==typeof(i=function(E){return E.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}})?i.apply(n,u):i)||(E.exports=A)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--ec56cc9135', location = 'aui.chunk.9f91be739892212e7aea--fd290e496548c2eefcdc.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--ec56cc9135"],{"O/HO":function(e,t,a){var i,s,r;
/*!
 * jQuery UI Datepicker 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */s=[a("oDIA"),a("O+lX"),a("M4tZ")],void 0===(r="function"==typeof(i=function(e){var t;function a(e){for(var t,a;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(a=parseInt(e.css("zIndex"),10),!isNaN(a)&&0!==a))return a;e=e.parent()}return 0}function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=s(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(t){var a="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.on("mouseout",a,(function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")})).on("mouseover",a,r)}function r(){e.datepicker._isDisabledDatepicker(t.inline?t.dpDiv.parent()[0]:t.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function n(t,a){for(var i in e.extend(t,a),a)null==a[i]&&(t[i]=a[i]);return t}return e.extend(e.ui,{datepicker:{version:"1.12.1"}}),e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return n(this._defaults,e||{}),this},_attachDatepicker:function(t,a){var i,s,r;s="div"===(i=t.nodeName.toLowerCase())||"span"===i,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(r=this._newInst(e(t),s)).settings=e.extend({},a||{}),"input"===i?this._connectDatepicker(t,r):s&&this._inlineDatepicker(t,r)},_newInst:function(t,a){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:a,dpDiv:a?s(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,a){var i=e(t);a.append=e([]),a.trigger=e([]),i.hasClass(this.markerClassName)||(this._attachments(i,a),i.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(a),e.data(t,"datepicker",a),a.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,a){var i,s,r,n=this._get(a,"appendText"),d=this._get(a,"isRTL");a.append&&a.append.remove(),n&&(a.append=e("<span class='"+this._appendClass+"'>"+n+"</span>"),t[d?"before":"after"](a.append)),t.off("focus",this._showDatepicker),a.trigger&&a.trigger.remove(),"focus"!==(i=this._get(a,"showOn"))&&"both"!==i||t.on("focus",this._showDatepicker),"button"!==i&&"both"!==i||(s=this._get(a,"buttonText"),r=this._get(a,"buttonImage"),a.trigger=e(this._get(a,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:r,alt:s,title:s}):e("<button type='button'></button>").addClass(this._triggerClass).html(r?e("<img/>").attr({src:r,alt:s,title:s}):s)),t[d?"before":"after"](a.trigger),a.trigger.on("click",(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,a,i,s,r=new Date(2009,11,20),n=this._get(e,"dateFormat");n.match(/[DM]/)&&(t=function(e){for(a=0,i=0,s=0;s<e.length;s++)e[s].length>a&&(a=e[s].length,i=s);return i},r.setMonth(t(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),r.setDate(t(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-r.getDay())),e.input.attr("size",this._formatDate(e,r).length)}},_inlineDatepicker:function(t,a){var i=e(t);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(a.dpDiv),e.data(t,"datepicker",a),this._setDate(a,this._getDefaultDate(a),!0),this._updateDatepicker(a),this._updateAlternate(a),a.settings.disabled&&this._disableDatepicker(t),a.dpDiv.css("display","block"))},_dialogDatepicker:function(t,a,i,s,r){var d,c,o,l,h,u=this._dialogInst;return u||(this.uuid+=1,d="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+d+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),(u=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",u)),n(u.settings,s||{}),a=a&&a.constructor===Date?this._formatDate(u,a):a,this._dialogInput.val(a),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(c=document.documentElement.clientWidth,o=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[c/2-100+l,o/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",u),this},_destroyDatepicker:function(a){var i,s=e(a),r=e.data(a,"datepicker");s.hasClass(this.markerClassName)&&(i=a.nodeName.toLowerCase(),e.removeData(a,"datepicker"),"input"===i?(r.append.remove(),r.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||s.removeClass(this.markerClassName).empty(),t===r&&(t=null))},_enableDatepicker:function(t){var a,i,s=e(t),r=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&("input"===(a=t.nodeName.toLowerCase())?(t.disabled=!1,r.trigger.filter("button").each((function(){this.disabled=!1})).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==a&&"span"!==a||((i=s.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})))},_disableDatepicker:function(t){var a,i,s=e(t),r=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&("input"===(a=t.nodeName.toLowerCase())?(t.disabled=!0,r.trigger.filter("button").each((function(){this.disabled=!0})).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==a&&"span"!==a||((i=s.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,a,i){var s,r,d,c,o=this._getInst(t);if(2===arguments.length&&"string"==typeof a)return"defaults"===a?e.extend({},e.datepicker._defaults):o?"all"===a?e.extend({},o.settings):this._get(o,a):null;s=a||{},"string"==typeof a&&((s={})[a]=i),o&&(this._curInst===o&&this._hideDatepicker(),r=this._getDateDatepicker(t,!0),d=this._getMinMaxDate(o,"min"),c=this._getMinMaxDate(o,"max"),n(o.settings,s),null!==d&&void 0!==s.dateFormat&&void 0===s.minDate&&(o.settings.minDate=this._formatDate(o,d)),null!==c&&void 0!==s.dateFormat&&void 0===s.maxDate&&(o.settings.maxDate=this._formatDate(o,c)),"disabled"in s&&(s.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),o),this._autoSize(o),this._setDate(o,r),this._updateAlternate(o),this._updateDatepicker(o))},_changeDatepicker:function(e,t,a){this._optionDatepicker(e,t,a)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var a=this._getInst(e);a&&(this._setDate(a,t),this._updateDatepicker(a),this._updateAlternate(a))},_getDateDatepicker:function(e,t){var a=this._getInst(e);return a&&!a.inline&&this._setDateFromField(a,t),a?this._getDate(a):null},_doKeyDown:function(t){var a,i,s,r=e.datepicker._getInst(t.target),n=!0,d=r.dpDiv.is(".ui-datepicker-rtl");if(r._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),n=!1;break;case 13:return(s=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",r.dpDiv))[0]&&e.datepicker._selectDay(t.target,r.selectedMonth,r.selectedYear,s[0]),(a=e.datepicker._get(r,"onSelect"))?(i=e.datepicker._formatDate(r),a.apply(r.input?r.input[0]:null,[i,r])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),n=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),n=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,d?1:-1,"D"),n=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),n=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,d?-1:1,"D"),n=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),n=t.ctrlKey||t.metaKey;break;default:n=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):n=!1;n&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var a,i,s=e.datepicker._getInst(t.target);if(e.datepicker._get(s,"constrainInput"))return a=e.datepicker._possibleChars(e.datepicker._get(s,"dateFormat")),i=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||i<" "||!a||a.indexOf(i)>-1},_doKeyUp:function(t){var a=e.datepicker._getInst(t.target);if(a.input.val()!==a.lastVal)try{e.datepicker.parseDate(e.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,e.datepicker._getFormatConfig(a))&&(e.datepicker._setDateFromField(a),e.datepicker._updateAlternate(a),e.datepicker._updateDatepicker(a))}catch(e){}return!0},_showDatepicker:function(t){var i,s,r,d,c,o,l;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(r=(s=e.datepicker._get(i,"beforeShow"))?s.apply(t,[t,i]):{})&&(n(i.settings,r),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),d=!1,e(t).parents().each((function(){return!(d|="fixed"===e(this).css("position"))})),c={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),c=e.datepicker._checkOffset(i,c,d),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":d?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"}),i.inline||(o=e.datepicker._get(i,"showAnim"),l=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",a(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[o]?i.dpDiv.show(o,e.datepicker._get(i,"showOptions"),l):i.dpDiv[o||"show"](o?l:null),e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),e.datepicker._curInst=i)))},_updateDatepicker:function(a){this.maxRows=4,t=a,a.dpDiv.empty().append(this._generateHTML(a)),this._attachHandlers(a);var i,s=this._getNumberOfMonths(a),n=s[1],d=17,c=a.dpDiv.find("."+this._dayOverClass+" a");c.length>0&&r.apply(c.get(0)),a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&a.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",d*n+"em"),a.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),a===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(a)&&a.input.trigger("focus"),a.yearshtml&&(i=a.yearshtml,setTimeout((function(){i===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml),i=a.yearshtml=null}),0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,a,i){var s=t.dpDiv.outerWidth(),r=t.dpDiv.outerHeight(),n=t.input?t.input.outerWidth():0,d=t.input?t.input.outerHeight():0,c=document.documentElement.clientWidth+(i?0:e(document).scrollLeft()),o=document.documentElement.clientHeight+(i?0:e(document).scrollTop());return a.left-=this._get(t,"isRTL")?s-n:0,a.left-=i&&a.left===t.input.offset().left?e(document).scrollLeft():0,a.top-=i&&a.top===t.input.offset().top+d?e(document).scrollTop():0,a.left-=Math.min(a.left,a.left+s>c&&c>s?Math.abs(a.left+s-c):0),a.top-=Math.min(a.top,a.top+r>o&&o>r?Math.abs(r+d):0),a},_findPos:function(t){for(var a,i=this._getInst(t),s=this._get(i,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[s?"previousSibling":"nextSibling"];return[(a=e(t).offset()).left,a.top]},_hideDatepicker:function(t){var a,i,s,r,n=this._curInst;!n||t&&n!==e.data(t,"datepicker")||this._datepickerShowing&&(a=this._get(n,"showAnim"),i=this._get(n,"duration"),s=function(){e.datepicker._tidyDialog(n)},e.effects&&(e.effects.effect[a]||e.effects[a])?n.dpDiv.hide(a,e.datepicker._get(n,"showOptions"),i,s):n.dpDiv["slideDown"===a?"slideUp":"fadeIn"===a?"fadeOut":"hide"](a?i:null,s),a||s(),this._datepickerShowing=!1,(r=this._get(n,"onClose"))&&r.apply(n.input?n.input[0]:null,[n.input?n.input.val():"",n]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var a=e(t.target),i=e.datepicker._getInst(a[0]);(a[0].id===e.datepicker._mainDivId||0!==a.parents("#"+e.datepicker._mainDivId).length||a.hasClass(e.datepicker.markerClassName)||a.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!a.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===i)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,a,i){var s=e(t),r=this._getInst(s[0]);this._isDisabledDatepicker(s[0])||(this._adjustInstDate(r,a+("M"===i?this._get(r,"showCurrentAtPos"):0),i),this._updateDatepicker(r))},_gotoToday:function(t){var a,i=e(t),s=this._getInst(i[0]);this._get(s,"gotoCurrent")&&s.currentDay?(s.selectedDay=s.currentDay,s.drawMonth=s.selectedMonth=s.currentMonth,s.drawYear=s.selectedYear=s.currentYear):(a=new Date,s.selectedDay=a.getDate(),s.drawMonth=s.selectedMonth=a.getMonth(),s.drawYear=s.selectedYear=a.getFullYear()),this._notifyChange(s),this._adjustDate(i)},_selectMonthYear:function(t,a,i){var s=e(t),r=this._getInst(s[0]);r["selected"+("M"===i?"Month":"Year")]=r["draw"+("M"===i?"Month":"Year")]=parseInt(a.options[a.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(s)},_selectDay:function(t,a,i,s){var r,n=e(t);e(s).hasClass(this._unselectableClass)||this._isDisabledDatepicker(n[0])||((r=this._getInst(n[0])).selectedDay=r.currentDay=e("a",s).html(),r.selectedMonth=r.currentMonth=a,r.selectedYear=r.currentYear=i,this._selectDate(t,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear)))},_clearDate:function(t){var a=e(t);this._selectDate(a,"")},_selectDate:function(t,a){var i,s=e(t),r=this._getInst(s[0]);a=null!=a?a:this._formatDate(r),r.input&&r.input.val(a),this._updateAlternate(r),(i=this._get(r,"onSelect"))?i.apply(r.input?r.input[0]:null,[a,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],"object"!=typeof r.input[0]&&r.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(t){var a,i,s,r=this._get(t,"altField");r&&(a=this._get(t,"altFormat")||this._get(t,"dateFormat"),i=this._getDate(t),s=this.formatDate(a,i,this._getFormatConfig(t)),e(r).val(s))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,a=new Date(e.getTime());return a.setDate(a.getDate()+4-(a.getDay()||7)),t=a.getTime(),a.setMonth(0),a.setDate(1),Math.floor(Math.round((t-a)/864e5)/7)+1},parseDate:function(t,a,i){if(null==t||null==a)throw"Invalid arguments";if(""===(a="object"==typeof a?a.toString():a+""))return null;var s,r,n,d,c=0,o=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff,l="string"!=typeof o?o:(new Date).getFullYear()%100+parseInt(o,10),h=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,u=(i?i.dayNames:null)||this._defaults.dayNames,p=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,g=(i?i.monthNames:null)||this._defaults.monthNames,_=-1,f=-1,k=-1,D=-1,m=!1,y=function(e){var a=s+1<t.length&&t.charAt(s+1)===e;return a&&s++,a},v=function(e){var t=y(e),i="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,s=new RegExp("^\\d{"+("y"===e?i:1)+","+i+"}"),r=a.substring(c).match(s);if(!r)throw"Missing number at position "+c;return c+=r[0].length,parseInt(r[0],10)},M=function(t,i,s){var r=-1,n=e.map(y(t)?s:i,(function(e,t){return[[t,e]]})).sort((function(e,t){return-(e[1].length-t[1].length)}));if(e.each(n,(function(e,t){var i=t[1];if(a.substr(c,i.length).toLowerCase()===i.toLowerCase())return r=t[0],c+=i.length,!1})),-1!==r)return r+1;throw"Unknown name at position "+c},w=function(){if(a.charAt(c)!==t.charAt(s))throw"Unexpected literal at position "+c;c++};for(s=0;s<t.length;s++)if(m)"'"!==t.charAt(s)||y("'")?w():m=!1;else switch(t.charAt(s)){case"d":k=v("d");break;case"D":M("D",h,u);break;case"o":D=v("o");break;case"m":f=v("m");break;case"M":f=M("M",p,g);break;case"y":_=v("y");break;case"@":_=(d=new Date(v("@"))).getFullYear(),f=d.getMonth()+1,k=d.getDate();break;case"!":_=(d=new Date((v("!")-this._ticksTo1970)/1e4)).getFullYear(),f=d.getMonth()+1,k=d.getDate();break;case"'":y("'")?w():m=!0;break;default:w()}if(c<a.length&&(n=a.substr(c),!/^\s+/.test(n)))throw"Extra/unparsed characters found in date: "+n;if(-1===_?_=(new Date).getFullYear():_<100&&(_+=(new Date).getFullYear()-(new Date).getFullYear()%100+(_<=l?0:-100)),D>-1)for(f=1,k=D;!(k<=(r=this._getDaysInMonth(_,f-1)));)f++,k-=r;if((d=this._daylightSavingAdjust(new Date(_,f-1,k))).getFullYear()!==_||d.getMonth()+1!==f||d.getDate()!==k)throw"Invalid date";return d},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,a){if(!t)return"";var i,s=(a?a.dayNamesShort:null)||this._defaults.dayNamesShort,r=(a?a.dayNames:null)||this._defaults.dayNames,n=(a?a.monthNamesShort:null)||this._defaults.monthNamesShort,d=(a?a.monthNames:null)||this._defaults.monthNames,c=function(t){var a=i+1<e.length&&e.charAt(i+1)===t;return a&&i++,a},o=function(e,t,a){var i=""+t;if(c(e))for(;i.length<a;)i="0"+i;return i},l=function(e,t,a,i){return c(e)?i[t]:a[t]},h="",u=!1;if(t)for(i=0;i<e.length;i++)if(u)"'"!==e.charAt(i)||c("'")?h+=e.charAt(i):u=!1;else switch(e.charAt(i)){case"d":h+=o("d",t.getDate(),2);break;case"D":h+=l("D",t.getDay(),s,r);break;case"o":h+=o("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=o("m",t.getMonth()+1,2);break;case"M":h+=l("M",t.getMonth(),n,d);break;case"y":h+=c("y")?t.getFullYear():(t.getFullYear()%100<10?"0":"")+t.getFullYear()%100;break;case"@":h+=t.getTime();break;case"!":h+=1e4*t.getTime()+this._ticksTo1970;break;case"'":c("'")?h+="'":u=!0;break;default:h+=e.charAt(i)}return h},_possibleChars:function(e){var t,a="",i=!1,s=function(a){var i=t+1<e.length&&e.charAt(t+1)===a;return i&&t++,i};for(t=0;t<e.length;t++)if(i)"'"!==e.charAt(t)||s("'")?a+=e.charAt(t):i=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":a+="0123456789";break;case"D":case"M":return null;case"'":s("'")?a+="'":i=!0;break;default:a+=e.charAt(t)}return a},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var a=this._get(e,"dateFormat"),i=e.lastVal=e.input?e.input.val():null,s=this._getDefaultDate(e),r=s,n=this._getFormatConfig(e);try{r=this.parseDate(a,i,n)||s}catch(e){i=t?"":i}e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),e.currentDay=i?r.getDate():0,e.currentMonth=i?r.getMonth():0,e.currentYear=i?r.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,a,i){var s=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},r=function(a){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),a,e.datepicker._getFormatConfig(t))}catch(e){}for(var i=(a.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,s=i.getFullYear(),r=i.getMonth(),n=i.getDate(),d=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,c=d.exec(a);c;){switch(c[2]||"d"){case"d":case"D":n+=parseInt(c[1],10);break;case"w":case"W":n+=7*parseInt(c[1],10);break;case"m":case"M":r+=parseInt(c[1],10),n=Math.min(n,e.datepicker._getDaysInMonth(s,r));break;case"y":case"Y":s+=parseInt(c[1],10),n=Math.min(n,e.datepicker._getDaysInMonth(s,r))}c=d.exec(a)}return new Date(s,r,n)},n=null==a||""===a?i:"string"==typeof a?r(a):"number"==typeof a?isNaN(a)?i:s(a):new Date(a.getTime());return(n=n&&"Invalid Date"===n.toString()?i:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,a){var i=!t,s=e.selectedMonth,r=e.selectedYear,n=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=n.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=n.getMonth(),e.drawYear=e.selectedYear=e.currentYear=n.getFullYear(),s===e.selectedMonth&&r===e.selectedYear||a||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(i?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var a=this._get(t,"stepMonths"),i="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map((function(){var t={prev:function(){e.datepicker._adjustDate(i,-a,"M")},next:function(){e.datepicker._adjustDate(i,+a,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(i)},selectDay:function(){return e.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(i,this,"Y"),!1}};e(this).on(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])}))},_generateHTML:function(e){var t,a,i,s,r,n,d,c,o,l,h,u,p,g,_,f,k,D,m,y,v,M,w,b,C,I,x,Y,S,F,N,T,A,K,j,O,R,L,W,E=new Date,H=this._daylightSavingAdjust(new Date(E.getFullYear(),E.getMonth(),E.getDate())),P=this._get(e,"isRTL"),U=this._get(e,"showButtonPanel"),z=this._get(e,"hideIfNoPrevNext"),J=this._get(e,"navigationAsDateFormat"),B=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),Z=1!==B[0]||1!==B[1],$=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),q=this._getMinMaxDate(e,"min"),G=this._getMinMaxDate(e,"max"),Q=e.drawMonth-V,ee=e.drawYear;if(Q<0&&(Q+=12,ee--),G)for(t=this._daylightSavingAdjust(new Date(G.getFullYear(),G.getMonth()-B[0]*B[1]+1,G.getDate())),t=q&&t<q?q:t;this._daylightSavingAdjust(new Date(ee,Q,1))>t;)--Q<0&&(Q=11,ee--);for(e.drawMonth=Q,e.drawYear=ee,a=this._get(e,"prevText"),a=J?this.formatDate(a,this._daylightSavingAdjust(new Date(ee,Q-X,1)),this._getFormatConfig(e)):a,i=this._canAdjustMonth(e,-1,ee,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(P?"e":"w")+"'>"+a+"</span></a>":z?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(P?"e":"w")+"'>"+a+"</span></a>",s=this._get(e,"nextText"),s=J?this.formatDate(s,this._daylightSavingAdjust(new Date(ee,Q+X,1)),this._getFormatConfig(e)):s,r=this._canAdjustMonth(e,1,ee,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(P?"w":"e")+"'>"+s+"</span></a>":z?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(P?"w":"e")+"'>"+s+"</span></a>",n=this._get(e,"currentText"),d=this._get(e,"gotoCurrent")&&e.currentDay?$:H,n=J?this.formatDate(n,d,this._getFormatConfig(e)):n,c=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",o=U?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(P?c:"")+(this._isInRange(e,d)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+n+"</button>":"")+(P?"":c)+"</div>":"",l=parseInt(this._get(e,"firstDay"),10),l=isNaN(l)?0:l,h=this._get(e,"showWeek"),u=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),g=this._get(e,"monthNames"),_=this._get(e,"monthNamesShort"),f=this._get(e,"beforeShowDay"),k=this._get(e,"showOtherMonths"),D=this._get(e,"selectOtherMonths"),m=this._getDefaultDate(e),y="",M=0;M<B[0];M++){for(w="",this.maxRows=4,b=0;b<B[1];b++){if(C=this._daylightSavingAdjust(new Date(ee,Q,e.selectedDay)),I=" ui-corner-all",x="",Z){if(x+="<div class='ui-datepicker-group",B[1]>1)switch(b){case 0:x+=" ui-datepicker-group-first",I=" ui-corner-"+(P?"right":"left");break;case B[1]-1:x+=" ui-datepicker-group-last",I=" ui-corner-"+(P?"left":"right");break;default:x+=" ui-datepicker-group-middle",I=""}x+="'>"}for(x+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===M?P?r:i:"")+(/all|right/.test(I)&&0===M?P?i:r:"")+this._generateMonthYearHeader(e,Q,ee,q,G,M>0||b>0,g,_)+"</div><table class='ui-datepicker-calendar'><thead><tr>",Y=h?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",v=0;v<7;v++)Y+="<th scope='col'"+((v+l+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[S=(v+l)%7]+"'>"+p[S]+"</span></th>";for(x+=Y+"</tr></thead><tbody>",F=this._getDaysInMonth(ee,Q),ee===e.selectedYear&&Q===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,F)),N=(this._getFirstDayOfMonth(ee,Q)-l+7)%7,T=Math.ceil((N+F)/7),A=Z&&this.maxRows>T?this.maxRows:T,this.maxRows=A,K=this._daylightSavingAdjust(new Date(ee,Q,1-N)),j=0;j<A;j++){for(x+="<tr>",O=h?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(K)+"</td>":"",v=0;v<7;v++)R=f?f.apply(e.input?e.input[0]:null,[K]):[!0,""],W=(L=K.getMonth()!==Q)&&!D||!R[0]||q&&K<q||G&&K>G,O+="<td class='"+((v+l+6)%7>=5?" ui-datepicker-week-end":"")+(L?" ui-datepicker-other-month":"")+(K.getTime()===C.getTime()&&Q===e.selectedMonth&&e._keyEvent||m.getTime()===K.getTime()&&m.getTime()===C.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(L&&!k?"":" "+R[1]+(K.getTime()===$.getTime()?" "+this._currentClass:"")+(K.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(L&&!k||!R[2]?"":" title='"+R[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+K.getMonth()+"' data-year='"+K.getFullYear()+"'")+">"+(L&&!k?"&#xa0;":W?"<span class='ui-state-default'>"+K.getDate()+"</span>":"<a class='ui-state-default"+(K.getTime()===H.getTime()?" ui-state-highlight":"")+(K.getTime()===$.getTime()?" ui-state-active":"")+(L?" ui-priority-secondary":"")+"' href='#'>"+K.getDate()+"</a>")+"</td>",K.setDate(K.getDate()+1),K=this._daylightSavingAdjust(K);x+=O+"</tr>"}++Q>11&&(Q=0,ee++),w+=x+="</tbody></table>"+(Z?"</div>"+(B[0]>0&&b===B[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}y+=w}return y+=o,e._keyEvent=!1,y},_generateMonthYearHeader:function(e,t,a,i,s,r,n,d){var c,o,l,h,u,p,g,_,f=this._get(e,"changeMonth"),k=this._get(e,"changeYear"),D=this._get(e,"showMonthAfterYear"),m="<div class='ui-datepicker-title'>",y="";if(r||!f)y+="<span class='ui-datepicker-month'>"+n[t]+"</span>";else{for(c=i&&i.getFullYear()===a,o=s&&s.getFullYear()===a,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",l=0;l<12;l++)(!c||l>=i.getMonth())&&(!o||l<=s.getMonth())&&(y+="<option value='"+l+"'"+(l===t?" selected='selected'":"")+">"+d[l]+"</option>");y+="</select>"}if(D||(m+=y+(!r&&f&&k?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",r||!k)m+="<span class='ui-datepicker-year'>"+a+"</span>";else{for(h=this._get(e,"yearRange").split(":"),u=(new Date).getFullYear(),g=(p=function(e){var t=e.match(/c[+\-].*/)?a+parseInt(e.substring(1),10):e.match(/[+\-].*/)?u+parseInt(e,10):parseInt(e,10);return isNaN(t)?u:t})(h[0]),_=Math.max(g,p(h[1]||"")),g=i?Math.max(g,i.getFullYear()):g,_=s?Math.min(_,s.getFullYear()):_,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g<=_;g++)e.yearshtml+="<option value='"+g+"'"+(g===a?" selected='selected'":"")+">"+g+"</option>";e.yearshtml+="</select>",m+=e.yearshtml,e.yearshtml=null}return m+=this._get(e,"yearSuffix"),D&&(m+=(!r&&f&&k?"":"&#xa0;")+y),m+="</div>"},_adjustInstDate:function(e,t,a){var i=e.selectedYear+("Y"===a?t:0),s=e.selectedMonth+("M"===a?t:0),r=Math.min(e.selectedDay,this._getDaysInMonth(i,s))+("D"===a?t:0),n=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(i,s,r)));e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),"M"!==a&&"Y"!==a||this._notifyChange(e)},_restrictMinMax:function(e,t){var a=this._getMinMaxDate(e,"min"),i=this._getMinMaxDate(e,"max"),s=a&&t<a?a:t;return i&&s>i?i:s},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,a,i){var s=this._getNumberOfMonths(e),r=this._daylightSavingAdjust(new Date(a,i+(t<0?t:s[0]*s[1]),1));return t<0&&r.setDate(this._getDaysInMonth(r.getFullYear(),r.getMonth())),this._isInRange(e,r)},_isInRange:function(e,t){var a,i,s=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),n=null,d=null,c=this._get(e,"yearRange");return c&&(a=c.split(":"),i=(new Date).getFullYear(),n=parseInt(a[0],10),d=parseInt(a[1],10),a[0].match(/[+\-].*/)&&(n+=i),a[1].match(/[+\-].*/)&&(d+=i)),(!s||t.getTime()>=s.getTime())&&(!r||t.getTime()<=r.getTime())&&(!n||t.getFullYear()>=n)&&(!d||t.getFullYear()<=d)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,a,i){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var s=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(i,a,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),s,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var a=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(a)):this.each((function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(a)):e.datepicker._attachDatepicker(this,t)})):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(a))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.12.1",e.datepicker})?i.apply(t,s):i)||(e.exports=r)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.5b7fdbd666', location = 'aui.chunk.481a26ee2a882731487b--57e287c4c08972455bc5.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.5b7fdbd666"],{fVKi:function(n,t,i){"use strict";var r=i("JFi+");t.a=function(n){function t(t){return u((function(){return n.hasAttribute(t)}),t+" wasn't defined")}function i(i){if(!t(i))return!1;var r=n.getAttribute(i);return u((function(){return document.getElementById(r)}),'an element with id set to "'+r+'" was not found')}function u(t,i){return!!t()||(n?r.a(i,n):r.a(i),!1)}return{attributeExists:t,refersTo:i,satisfiesRules:u,ariaControls:function(){return i("aria-controls")},ariaOwns:function(){return i("aria-owns")}}}}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.8a641c03a4', location = 'aui.chunk.6ae40629bae4f707f820--01600a948c4870fc7736.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.8a641c03a4"],{kdZR:function(t,e,n){"use strict";function u(t,e,n){n?t.setAttribute(e,""):t.removeAttribute(e)}n.d(e,"b",(function(){return u})),e.a={computeBooleanValue:function(t){return null!==t},setBooleanAttribute:u,computeEnumValue:function(t,e){const n=t=>t.toLowerCase()===e.toLowerCase(),u=null===e,i=!u&&!t.values.filter(n).length;return u?t.hasOwnProperty("missingDefault")?t.missingDefault:null:i?t.hasOwnProperty("invalidDefault")?t.invalidDefault:t.hasOwnProperty("missingDefault")?t.missingDefault:null:t.values.length?t.values.filter(n)[0]:null},setEnumAttribute:function(t,e,n){t.setAttribute(e.attribute,n)}}}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.d727dd207f', location = 'aui.chunk.962931490c23ca7314d7--df552fbef7147ee58d46.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.d727dd207f"],{VtiI:function(i,n,s){"use strict";s("FStl"),s("Q0fs"),s("nqD9"),s("NjKm")}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.543254b237', location = 'aui.chunk.f06cc4108c8fe7c54455--6477deaf74551e13203c.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.543254b237"],{P3bb:function(e,t,n){"use strict";var i=n("+x/D"),o=n("vbuG"),r=n("TmQU"),s=n("kdZR"),a=n("fVKi"),u=n("KloK"),c=n("jEnx"),b=n("4dFR"),l=n("TK3y"),p=n("/soZ"),d=n("I7um"),f=n("ih6f");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t){Object(p.a)(e,(function(n){n.setAttribute("aria-expanded","false"),t.setAttribute("aria-expanded",e.open)})),Object(p.e)(e,t)}function v(e,t){if(e._auiAlignment)e._auiAlignment.changeTarget(t),e._auiAlignment.enable();else{let n={overflowContainer:"viewport"===e.getAttribute("contained-by")?"viewport":"window",positionFixed:!1,eventsEnabled:!0};n=O(O({},n),{onCreate:()=>{k(e)&&Object(f.a)().enter(Object(i.a)(e),Object(i.a)(t))},onEvents:{enabled:()=>{k(e)&&Object(f.a)().enter(Object(i.a)(e))},disabled:()=>{k(e)&&Object(f.a)().exit(Object(i.a)(e))}}}),e._auiAlignment=new o.a(e,t,n)}}function h(e){e._auiAlignment&&(e._auiAlignment.destroy(),delete e._auiAlignment)}function y(e){return Object(l.a)(e).get("mouse-inside")||e.contains(document.activeElement)}function T(e,t){var n=t.currentTarget;n&&(j(e,n),v(e,n)),e.open||(e.open=!0),clearTimeout(e._closingTimeout)}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){t.open&&!Object(c.b)(t).isPersistent()&&(clearTimeout(t._closingTimeout),t._closingTimeout=setTimeout((function(){y(t)||(t.open=!1),t._closingTimeout=null}),e))}}const A={click(e,t){e.open&&!Object(c.b)(e).isPersistent()?e.open=!1:(j(e,t.currentTarget),e.open=!0),clearTimeout(e._closingTimeout)},mouseenter:T,mouseleave:_(1e3),focus:T,blur:_(0)};function w(e){var t=e.currentTarget;Object(l.a)(t).set("mouse-inside",!0),t.message({type:"mouseenter"})}function E(e){var t=e.currentTarget;Object(l.a)(t).set("mouse-inside",!1),t.message({type:"mouseleave"})}function x(e){var t=e.currentTarget;"hover"===t.respondsTo&&_(1e3)(t)}function P(e){Object(l.a)(e).set("mouse-inside",void 0),e.removeEventListener("mouseenter",w),e.removeEventListener("mouseleave",E),e.removeEventListener("blur",x),"hover"===e.respondsTo&&(Object(l.a)(e).set("mouse-inside",!1),e.addEventListener("mouseenter",w),e.addEventListener("mouseleave",E),e.addEventListener("blur",x))}function D(e,t){return"".concat(e,".nested-layer-").concat(t)}function V(e){return Object(c.b)(e).show(),!0===Object(c.b)(e).isVisible()}function L(e){return Object(c.b)(e).hide(),!1===Object(c.b)(e).isVisible()}function k(e){return"hover"!==e.respondsTo}function I(e){e.__initialised||(Object(c.b)(e),Object(i.a)(e).on({["".concat(c.a,"show")]:function(){const e=this;!function(e){let t=Object(i.a)(e);const n=e.id,o=e=>t.find(Object(p.c)(e.target)).length<1;Object(i.a)(document).on(D("aui-layer-show",n),(e=>{o(e)||t.attr("persistent","")})).on(D("aui-layer-hide",n),(e=>{o(e)||t.removeAttr("persistent")})).on(D("select2-opening",n),(()=>{t.attr("persistent","")})).on(D("select2-close",n),(()=>{setTimeout((()=>{t.removeAttr("persistent")}),150)}))}(e),Object(p.a)(e,(function(t){v(e,t),t.setAttribute("aria-expanded","true")}))},["".concat(c.a,"hide")]:function(){const e=this;!function(e){const t=e.id;Object(i.a)(document).off(D("aui-layer-hide",t)).off(D("aui-layer-show",t)).off(D("select2-opening",t)).off(D("select2-close",t))}(e.id),e.ownerDocument.body.contains(e)?function(e){e._auiAlignment&&e._auiAlignment.disable()}(e):h(e),Object(p.a)(e,(function(e){e.setAttribute("aria-expanded","false")})),Object(p.e)(e,null)}}),e.__initialised=!0)}const K={attribute:"responds-to",values:["toggle","hover"],missingDefault:"toggle",invalidDefault:"toggle"},U=Object(b.a)("aui-inline-dialog",{prototype:{get open(){return Object(c.b)(this).isVisible()},set open(e){this.__propUpdate=!0,e?V(this):L(this)},get persistent(){return this.hasAttribute("persistent")},set persistent(e){s.a.setBooleanAttribute(this,"persistent",e)},get respondsTo(){var e=K.attribute;return s.a.computeEnumValue(K,this.getAttribute(e))},set respondsTo(e){const t=this.respondsTo;s.a.setEnumAttribute(this,K,e),t!==this.respondsTo&&P(this)},message:function(e){return function(e,t){var n={toggle:["click"],hover:["mouseenter","mouseleave","focus","blur"]}[e.respondsTo];n&&n.indexOf(t.type)>-1&&A[t.type](e,t)}(this,e),this}},attributes:{open:function(e,t){if(I(e),e.__propUpdate)delete e.__propUpdate;else{if("created"===t.type){V(e)||Object(s.b)(e,"open",!1)}if("removed"===t.type){L(e)||Object(s.b)(e,"open",!0)}}},"responds-to":function(e,t){s.a.computeEnumValue(K,t.oldValue)!==s.a.computeEnumValue(K,t.newValue)&&P(e)}},created:I,attached:function(e){Object(a.a)(e).attributeExists("id"),e.setAttribute("tabindex",0),e.setAttribute("role","dialog"),Object(p.a)(e,(function(t){t.setAttribute("aria-expanded",e.open)})),Object(p.b)(e,(function(e){e.setAttribute("aria-haspopup","true")})),P(e)},detached:function(e){Object(d.a)(e).then((()=>{h(e),Object(p.b)(e,(function(e){e.removeAttribute("aria-haspopup"),e.removeAttribute("aria-expanded")}))}))},template:function(e){Object(i.a)('<div class="aui-inline-dialog-contents"></div>').append(e.childNodes).appendTo(e)}});Object(r.a)("aui/inline-dialog2",U),Object(u.a)("InlineDialog2",U),t.a=U},Rvtc:function(e,t,n){"use strict";n.r(t);n("AehQ"),n("THZ5"),n("VtiI");var i=n("P3bb");n.d(t,"InlineDialogEl",(function(){return i.a}))}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.form.date-select', location = 'aui.chunk.e07e5af8105f6886c499--c62a0af8cd25b3964f0e.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.form.date-select"],{cQgS:function(e,t,a){"use strict";a.r(t),a.d(t,"DatePicker",(function(){return x}));a("6fSn"),a("Rvtc");var i=a("+x/D"),n=a("O/HO"),o=a.n(n),s=a("JFi+"),c=a("cWqH"),r=a("KloK"),d=a("+ay7"),l=a("HH5i"),u=a("P3bb"),p=a("OEua");const f=e=>{let{dateFormat:t,$field:a,onSelect:i,hide:n,onChangeMonthYear:o}=e;return{dateFormat:t,defaultDate:a.val(),maxDate:a.attr("max"),minDate:a.attr("min"),nextText:">",onSelect:function(e){a.val(e),a.trigger("change"),n(),i&&i.call(this,e)},onChangeMonthYear:o,prevText:"<"}},h=(e,t)=>{let a,n,o,s=!1;const c=Object(i.a)("body"),r=t=>{let a=Object(i.a)(t.target),o=a.closest(n).length||a.is(e),c=a.closest(".ui-datepicker-header").length;if(!o&&!c||t.keyCode===d.a.ESCAPE)return h(),void(s=!1);a.get(0)!==e.get(0)&&t.preventDefault()},l=()=>{s||(c.on("focus blur click mousedown","*",r),s=!0)},p=()=>{a.get(0).open||f()},f=()=>{a.get(0).open=!0},h=()=>{a.get(0).open=!1};return{calendarContainerSelector:null,getPopupContents:e=>{let{$field:d}=e;return a=(e=>{let{horizontalAlignment:t,datePickerUUID:a}=e;const n=new u.a;n.id=a;const o=Object(i.a)(n);return o.attr("persistent",""),o.attr("data-aui-focus","false"),o.attr("alignment","bottom ".concat(t)),o.addClass("aui-datepicker-dialog"),o})({horizontalAlignment:(e=>e.offset().left<window.innerWidth/2?"left":"right")(d),datePickerUUID:t}),o=d.closest("aui-inline-dialog").get(0),o&&(o._datePickerPopup=a,Object(i.a)(o).on("aui-hide",(e=>{s&&e.preventDefault(),c.off("focus blur","*",r),o&&o._datePickerPopup&&delete o._datePickerPopup}))),c.append(a),n=a,a},handleFieldFocus:p,showDatePicker:f,hideDatePicker:h,handleChangeMonthYear:()=>{setTimeout(a.refresh,0)},getCalendarNode:()=>a.get(0).childNodes[0],destroyPolyfill:()=>{h(),e.off("focus click",p),e.off("focusout keydown",l),c.off("keydown",l),c.off("focus blur click mousedown keydown",r)},createPolyfill:function(){c.on("keydown",r),e.on("focusout keydown",l)}}},k=function(e){const t=e.getField(),a=e.getOptions(),n=e.getUUID();let o;const{getPopupContents:c,handleFieldFocus:r,showDatePicker:d,hideDatePicker:l,handleChangeMonthYear:u,getCalendarNode:p,destroyPolyfill:k,createPolyfill:y}=h(t,n),m=e=>{Object(i.a)(e.currentTarget).val()&&o.datepicker("setDate",t.val())},b=t.attr("placeholder"),x=t.prop("type");let j;{const a=e=>t=>{if(void 0!==o)return e(t)},i=a((()=>{o.datepicker("destroy")}));e.show=d,e.hide=l,e.destroyPolyfill=()=>{k(),t.off("propertychange keyup input paste",m),j&&(j.disconnect(),j=null),b&&t.attr("placeholder",b),x&&t.prop("type",x),t.removeAttr("data-aui-dp-uuid"),i(),delete e.destroyPolyfill,delete e.show,delete e.hide},e.setDate=a((e=>{o.datepicker("setDate",e)})),e.getDate=a((()=>o.datepicker("getDate"))),e.setMin=a((e=>o.datepicker("option","minDate",e))),e.setMax=a((e=>o.datepicker("option","maxDate",e)))}a.languageCode in g.prototype.localisations||(a.languageCode="");const T=g.prototype.localisations;if(t.attr("aria-controls",n),void 0===o){void 0!==t.attr("step")&&s.b("WARNING: The date picker polyfill currently does not support the step attribute!");const n=f({dateFormat:a.dateFormat,$field:t,onSelect:a.onSelect,hide:e.hide,onChangeMonthYear:u}),r=i.a.extend(void 0,n,T);a.firstDay>-1&&(r.firstDay=a.firstDay),o=(e=>{let{config:t,popupContents:a,getCalendarNode:n,hint:o}=e;const s=Object(i.a)(n());let c;return s.datepicker(t),o&&(c=Object(i.a)("<div/>").addClass("aui-datepicker-hint"),c.append("<span/>").text(o),a.append(c)),s})({config:r,popupContents:c({$field:t}),getCalendarNode:p,hint:a.hint}),y(),t.on("propertychange keyup input paste",m),j=new MutationObserver((function(t){t.forEach((function(t){"min"===t.attributeName?e.setMin(t.target.getAttribute("min")):"max"===t.attributeName&&e.setMax(t.target.getAttribute("max"))}))})),j.observe(t.get(0),{attributes:!0})}t.on("focus click",r),t.attr("placeholder",a.placeholder),t.prop("type","text"),t.attr("data-aui-dp-uuid",n)};function g(e,t){let a={};const n=Object(p.a)("date-picker"),o=Object(i.a)(e),s={getUUID:()=>n,getField:()=>o,getOptions:()=>a,destroy:()=>{"function"==typeof s.destroyPolyfill&&s.destroyPolyfill()},reset:()=>{s.destroy();const e=!g.prototype.browserSupportsDateField,t=!1!==a.overrideBrowserDefault;(e||t)&&k(s)},reconfigure:e=>{a=i.a.extend(void 0,g.prototype.defaultOptions,e),s.reset()}};return s.reconfigure(t),s}function y(e,t){const a=i.a.extend({nextText:">",prevText:"<"},t),n=Object(i.a)(e).addClass("aui-datepicker-dialog").addClass("aui-calendar-widget").datepicker(a);if(a.hint){const e=Object(i.a)("<div/>").addClass("aui-datepicker-hint");e.append("<span/>").text(a.hint),n.append(e)}return n.reconfigure=e=>{n.datepicker("destroy"),n.datepicker(e)},n.destroy=()=>{n.datepicker("destroy")},n}g.prototype.browserSupportsDateField=Object(c.b)(),g.prototype.defaultOptions={overrideBrowserDefault:!1,firstDay:-1,languageCode:Object(i.a)("html").attr("lang")||"en-AU",dateFormat:o.a.W3C},g.prototype.localisations={dayNames:[l.a.getText("ajs.datepicker.localisations.day-names.sunday"),l.a.getText("ajs.datepicker.localisations.day-names.monday"),l.a.getText("ajs.datepicker.localisations.day-names.tuesday"),l.a.getText("ajs.datepicker.localisations.day-names.wednesday"),l.a.getText("ajs.datepicker.localisations.day-names.thursday"),l.a.getText("ajs.datepicker.localisations.day-names.friday"),l.a.getText("ajs.datepicker.localisations.day-names.saturday")],dayNamesMin:[l.a.getText("ajs.datepicker.localisations.day-names-min.sunday"),l.a.getText("ajs.datepicker.localisations.day-names-min.monday"),l.a.getText("ajs.datepicker.localisations.day-names-min.tuesday"),l.a.getText("ajs.datepicker.localisations.day-names-min.wednesday"),l.a.getText("ajs.datepicker.localisations.day-names-min.thursday"),l.a.getText("ajs.datepicker.localisations.day-names-min.friday"),l.a.getText("ajs.datepicker.localisations.day-names-min.saturday")],firstDay:l.a.getText("ajs.datepicker.localisations.first-day"),isRTL:"true"===l.a.getText("ajs.datepicker.localisations.is-RTL"),monthNames:[l.a.getText("ajs.datepicker.localisations.month-names.january"),l.a.getText("ajs.datepicker.localisations.month-names.february"),l.a.getText("ajs.datepicker.localisations.month-names.march"),l.a.getText("ajs.datepicker.localisations.month-names.april"),l.a.getText("ajs.datepicker.localisations.month-names.may"),l.a.getText("ajs.datepicker.localisations.month-names.june"),l.a.getText("ajs.datepicker.localisations.month-names.july"),l.a.getText("ajs.datepicker.localisations.month-names.august"),l.a.getText("ajs.datepicker.localisations.month-names.september"),l.a.getText("ajs.datepicker.localisations.month-names.october"),l.a.getText("ajs.datepicker.localisations.month-names.november"),l.a.getText("ajs.datepicker.localisations.month-names.december")],showMonthAfterYear:"true"===l.a.getText("ajs.datepicker.localisations.show-month-after-year"),yearSuffix:l.a.getText("ajs.datepicker.localisations.year-suffix")};const m="aui-datepicker",b=e=>function(t){let a=this.data(m);return a?"object"==typeof t?a.reconfigure(t):"destroy"===t&&a.destroy():(a=new e(this,t),this.data(m,a)),a};i.a.fn.datePicker=b(g),Object(r.a)("DatePicker",g),i.a.fn.calendarWidget=b(y),Object(r.a)("CalendarWidget",y);var x=g}},[["cQgS","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--084821f40b","aui.splitchunk.vendors--02a4084a95","aui.splitchunk.vendors--ec56cc9135","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.dd803a46b4","aui.splitchunk.994e478d48","aui.splitchunk.d7c46c2734","aui.splitchunk.e54c7c7304","aui.splitchunk.fb15cffa72","aui.splitchunk.56dfb54d0c","aui.splitchunk.f1e06f97a4","aui.splitchunk.479fe6ee76","aui.splitchunk.f673ef53ac","aui.splitchunk.8659b532c1","aui.splitchunk.908fe798b4","aui.splitchunk.5f851f97df","aui.splitchunk.462ee5f9ef","aui.splitchunk.d0110a864f","aui.splitchunk.afa5039e04","aui.splitchunk.bff3715233","aui.splitchunk.26116b3cbd","aui.splitchunk.c750721820","aui.splitchunk.6d6f245ed3","aui.splitchunk.50dca3e042","aui.splitchunk.084821f40b","aui.splitchunk.5b8c290363","aui.splitchunk.baa83dbaf9","aui.splitchunk.e5af17b48e","aui.splitchunk.f154095da3","aui.splitchunk.36cd9d521c","aui.splitchunk.d925afe2c0","aui.splitchunk.5b7fdbd666","aui.splitchunk.8a641c03a4","aui.splitchunk.d727dd207f","aui.splitchunk.543254b237"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.sortable-table', location = 'aui.chunk.fc00fc57e7d463bffab1--b7cbca5073f3715a60fd.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.sortable-table"],{AqzS:function(e,t){
/**!
 * TableSorter 2.17.7 - Client-side table sorting with ease!
 * @requires jQuery v1.2.6+
 *
 * Copyright (c) 2007 Christian Bach
 * Examples and docs at: http://tablesorter.com
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @type jQuery
 * @name tablesorter
 * @cat Plugins/Tablesorter
 * @author Christian Bach/christian.bach@polyester.se
 * @contributor Rob Garrison/https://github.com/Mottie/tablesorter
 */
!function(e){"use strict";e.extend({tablesorter:new function(){var t=this;function r(){var e=arguments[0],t=arguments.length>1?Array.prototype.slice.call(arguments):e;"undefined"!=typeof console&&void 0!==console.log?console[/error/i.test(e)?"error":/warn/i.test(e)?"warn":"log"](t):alert(t)}function s(e,t){r(e+" ("+((new Date).getTime()-t.getTime())+"ms)")}function a(e){for(var t in e)return!1;return!0}function n(r,s,a){if(!s)return"";var n,o=r.config,i=o.textExtraction||"",c="";return c="basic"===i?e(s).attr(o.textAttribute)||s.textContent||s.innerText||e(s).text()||"":"function"==typeof i?i(s,r,a):"function"==typeof(n=t.getColumnData(r,i,a))?n(s,r,a):s.textContent||s.innerText||e(s).text()||"",e.trim(c)}function o(e,s,a,o){for(var i,c=t.parsers.length,d=!1,l="",u=!0;""===l&&u;)s[++a]?(l=n(e,d=s[a].cells[o],o),e.config.debug&&r("Checking if value was empty on row "+a+", column: "+o+': "'+l+'"')):u=!1;for(;--c>=0;)if((i=t.parsers[c])&&"text"!==i.id&&i.is&&i.is(l,e,d))return i;return t.getParserById("text")}function i(e){var a,n,i,c,d,l,u,p,g,f,h=e.config,m=h.$tbodies=h.$table.children("tbody:not(."+h.cssInfoBlock+")"),b=0,y="",w=m.length;if(0===w)return h.debug?r("Warning: *Empty table!* Not building a parser cache"):"";for(h.debug&&(f=new Date,r("Detecting parsers for each column")),n={extractors:[],parsers:[]};b<w;){if((a=m[b].rows)[b])for(i=h.columns,c=0;c<i;c++)d=h.$headers.filter('[data-column="'+c+'"]:last'),l=t.getColumnData(e,h.headers,c),g=t.getParserById(t.getData(d,l,"extractor")),p=t.getParserById(t.getData(d,l,"sorter")),u="false"===t.getData(d,l,"parser"),h.empties[c]=t.getData(d,l,"empty")||h.emptyTo||(h.emptyToBottom?"bottom":"top"),h.strings[c]=t.getData(d,l,"string")||h.stringTo||"max",u&&(p=t.getParserById("no-parser")),g||(g=!1),p||(p=o(e,a,-1,c)),h.debug&&(y+="column:"+c+"; extractor:"+g.id+"; parser:"+p.id+"; string:"+h.strings[c]+"; empty: "+h.empties[c]+"\n"),n.parsers[c]=p,n.extractors[c]=g;b+=n.parsers.length?w:1}h.debug&&(r(y||"No parsers detected"),s("Completed detecting parsers",f)),h.parsers=n.parsers,h.extractors=n.extractors}function c(a){var o,i,c,d,l,u,p,g,f,h,m,b,y,w=a.config,v=w.$table.children("tbody"),x=w.extractors,C=w.parsers;if(w.cache={},w.totalRows=0,!C)return w.debug?r("Warning: *Empty table!* Not building a cache"):"";for(w.debug&&(h=new Date),w.showProcessing&&t.isProcessing(a,!0),p=0;p<v.length;p++)if(y=[],o=w.cache[p]={normalized:[]},!v.eq(p).hasClass(w.cssInfoBlock)){for(m=v[p]&&v[p].rows.length||0,l=0;l<m;++l)if(b={child:[]},g=e(v[p].rows[l]),[new Array(w.columns)],f=[],g.hasClass(w.cssChildRow)&&0!==l)i=o.normalized.length-1,o.normalized[i][w.columns].$row=o.normalized[i][w.columns].$row.add(g),g.prev().hasClass(w.cssChildRow)||g.prev().addClass(t.css.cssHasChild),b.child[i]=e.trim(g[0].textContent||g[0].innerText||g.text()||"");else{for(b.$row=g,b.order=l,u=0;u<w.columns;++u)void 0!==C[u]?(i=n(a,g[0].cells[u],u),c=void 0===x[u].id?i:x[u].format(i,a,g[0].cells[u],u),d="no-parser"===C[u].id?"":C[u].format(c,a,g[0].cells[u],u),f.push(w.ignoreCase&&"string"==typeof d?d.toLowerCase():d),"numeric"===(C[u].type||"").toLowerCase()&&(y[u]=Math.max(Math.abs(d)||0,y[u]||0))):w.debug&&r("No parser found for cell:",g[0].cells[u],"does it have a header?");f[w.columns]=b,o.normalized.push(f)}o.colMax=y,w.totalRows+=o.normalized.length}w.showProcessing&&t.isProcessing(a),w.debug&&s("Building cache for "+m+" rows",h)}function d(r,n){var o,i,c,d,l,u,p,g=r.config,f=g.widgetOptions,h=r.tBodies,m=[],b=g.cache;if(a(b))return g.appender?g.appender(r,m):r.isUpdating?g.$table.trigger("updateComplete",r):"";for(g.debug&&(p=new Date),u=0;u<h.length;u++)if((c=e(h[u])).length&&!c.hasClass(g.cssInfoBlock)){for(d=t.processTbody(r,c,!0),i=(o=b[u].normalized).length,l=0;l<i;l++)m.push(o[l][g.columns].$row),g.appender&&(!g.pager||g.pager.removeRows&&f.pager_removeRows||g.pager.ajax)||d.append(o[l][g.columns].$row);t.processTbody(r,d,!1)}g.appender&&g.appender(r,m),g.debug&&s("Rebuilt table",p),n||g.appender||t.applyWidget(r),r.isUpdating&&g.$table.trigger("updateComplete",r)}function l(e){return/^d/i.test(e)||1===e}function u(a){var n,o,i,c,d,u,p,f=a.config;f.headerList=[],f.headerContent=[],f.debug&&(p=new Date),f.columns=t.computeColumnIndex(f.$table.children("thead, tfoot").children("tr")),c=f.cssIcon?'<i class="'+(f.cssIcon===t.css.icon?t.css.icon:f.cssIcon+" "+t.css.icon)+'"></i>':"",f.$headers=e(a).find(f.selectorHeaders).each((function(r){o=e(this),n=t.getColumnData(a,f.headers,r,!0),f.headerContent[r]=e(this).html(),d=f.headerTemplate.replace(/\{content\}/g,e(this).html()).replace(/\{icon\}/g,c),f.onRenderTemplate&&(i=f.onRenderTemplate.apply(o,[r,d]))&&"string"==typeof i&&(d=i),e(this).html('<div class="'+t.css.headerIn+'">'+d+"</div>"),f.onRenderHeader&&f.onRenderHeader.apply(o,[r]),this.column=parseInt(e(this).attr("data-column"),10),this.order=l(t.getData(o,n,"sortInitialOrder")||f.sortInitialOrder)?[1,0,2]:[0,1,2],this.count=-1,this.lockedOrder=!1,void 0!==(u=t.getData(o,n,"lockedOrder")||!1)&&!1!==u&&(this.order=this.lockedOrder=l(u)?[1,1,1]:[0,0,0]),o.addClass(t.css.header+" "+f.cssHeader),f.headerList[r]=this,o.parent().addClass(t.css.headerRow+" "+f.cssHeaderRow).attr("role","row"),f.tabIndex&&o.attr("tabindex",0)})).attr({scope:"col",role:"columnheader"}),g(a),f.debug&&(s("Built headers:",p),r(f.$headers))}function p(e,t,r){var s=e.config;s.$table.find(s.selectorRemove).remove(),i(e),c(e),w(s.$table,t,r)}function g(r){var s,a,n,o=r.config;o.$headers.each((function(i,c){a=e(c),n=t.getColumnData(r,o.headers,i,!0),s="false"===t.getData(c,n,"sorter")||"false"===t.getData(c,n,"parser"),c.sortDisabled=s,a[s?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+s),r.id&&(s?a.removeAttr("aria-controls"):a.attr("aria-controls",r.id))}))}function f(r){var s,a,n,o=r.config,i=o.sortList,c=i.length,d=t.css.sortNone+" "+o.cssNone,l=[t.css.sortAsc+" "+o.cssAsc,t.css.sortDesc+" "+o.cssDesc],u=["ascending","descending"],p=e(r).find("tfoot tr").children().add(o.$extraHeaders).removeClass(l.join(" "));for(o.$headers.removeClass(l.join(" ")).addClass(d).attr("aria-sort","none"),a=0;a<c;a++)if(2!==i[a][1]&&(s=o.$headers.not(".sorter-false").filter('[data-column="'+i[a][0]+'"]'+(1===c?":last":""))).length){for(n=0;n<s.length;n++)s[n].sortDisabled||s.eq(n).removeClass(d).addClass(l[i[a][1]]).attr("aria-sort",u[i[a][1]]);p.length&&p.filter('[data-column="'+i[a][0]+'"]').removeClass(d).addClass(l[i[a][1]])}o.$headers.not(".sorter-false").each((function(){var r=e(this),s=this.order[(this.count+1)%(o.sortReset?3:2)],a=r.text()+": "+t.language[r.hasClass(t.css.sortAsc)?"sortAsc":r.hasClass(t.css.sortDesc)?"sortDesc":"sortNone"]+t.language[0===s?"nextAsc":1===s?"nextDesc":"nextNone"];r.attr("aria-label",a)}))}function h(e,t){return e&&e[t]&&e[t].type||""}function m(r,s,a){if(r.isUpdating)return setTimeout((function(){m(r,s,a)}),50);var n,o,i,c,l,u=r.config,p=!a[u.sortMultiSortKey],g=u.$table;if(g.trigger("sortStart",r),s.count=a[u.sortResetKey]?2:(s.count+1)%(u.sortReset?3:2),u.sortRestart&&(o=s,u.$headers.each((function(){this===o||!p&&e(this).is("."+t.css.sortDesc+",."+t.css.sortAsc)||(this.count=-1)}))),o=s.column,p){if(u.sortList=[],null!==u.sortForce)for(n=u.sortForce,i=0;i<n.length;i++)n[i][0]!==o&&u.sortList.push(n[i]);if((c=s.order[s.count])<2&&(u.sortList.push([o,c]),s.colSpan>1))for(i=1;i<s.colSpan;i++)u.sortList.push([o+i,c])}else{if(u.sortAppend&&u.sortList.length>1)for(i=0;i<u.sortAppend.length;i++)(l=t.isValueInArray(u.sortAppend[i][0],u.sortList))>=0&&u.sortList.splice(l,1);if(t.isValueInArray(o,u.sortList)>=0)for(i=0;i<u.sortList.length;i++)l=u.sortList[i],c=u.$headers.filter('[data-column="'+l[0]+'"]:last')[0],l[0]===o&&(l[1]=c.order[s.count],2===l[1]&&(u.sortList.splice(i,1),c.count=-1));else if((c=s.order[s.count])<2&&(u.sortList.push([o,c]),s.colSpan>1))for(i=1;i<s.colSpan;i++)u.sortList.push([o+i,c])}if(null!==u.sortAppend)for(n=u.sortAppend,i=0;i<n.length;i++)n[i][0]!==o&&u.sortList.push(n[i]);g.trigger("sortBegin",r),setTimeout((function(){f(r),b(r),d(r),g.trigger("sortEnd",r)}),1)}function b(e){var r,n,o,i,c,d,l,u,p,g,f=0,m=e.config,b=m.textSorter||"",y=m.sortList,w=y.length,v=e.tBodies.length;if(!m.serverSideSorting&&!a(m.cache)){for(m.debug&&(c=new Date),n=0;n<v;n++)d=m.cache[n].colMax,m.cache[n].normalized.sort((function(s,a){for(r=0;r<w;r++){if(i=y[r][0],l=y[r][1],f=0===l,m.sortStable&&s[i]===a[i]&&1===w)return s[m.columns].order-a[m.columns].order;if((o=/n/i.test(h(m.parsers,i)))&&m.strings[i]?(o="boolean"==typeof m.string[m.strings[i]]?(f?1:-1)*(m.string[m.strings[i]]?-1:1):m.strings[i]&&m.string[m.strings[i]]||0,u=m.numberSorter?m.numberSorter(s[i],a[i],f,d[i],e):t["sortNumeric"+(f?"Asc":"Desc")](s[i],a[i],o,d[i],i,e)):(p=f?s:a,g=f?a:s,u="function"==typeof b?b(p[i],g[i],f,i,e):"object"==typeof b&&b.hasOwnProperty(i)?b[i](p[i],g[i],f,i,e):t["sortNatural"+(f?"Asc":"Desc")](s[i],a[i],i,e,m)),u)return u}return s[m.columns].order-a[m.columns].order}));m.debug&&s("Sorting on "+y.toString()+" and dir "+l+" time",c)}}function y(t,r){t[0].isUpdating&&t.trigger("updateComplete"),e.isFunction(r)&&r(t[0])}function w(e,r,s){var a=e[0].config.sortList;!1!==r&&!e[0].isProcessing&&a.length?e.trigger("sorton",[a,function(){y(e,s)},!0]):(y(e,s),t.applyWidget(e[0],!1))}function v(r){var s=r.config,o=s.$table;o.unbind("sortReset update updateRows updateCell updateAll addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(s.namespace+" ")).bind("sortReset"+s.namespace,(function(t,a){t.stopPropagation(),s.sortList=[],f(r),b(r),d(r),e.isFunction(a)&&a(r)})).bind("updateAll"+s.namespace,(function(e,a,n){e.stopPropagation(),r.isUpdating=!0,t.refreshWidgets(r,!0,!0),t.restoreHeaders(r),u(r),t.bindEvents(r,s.$headers,!0),v(r),p(r,a,n)})).bind("update"+s.namespace+" updateRows"+s.namespace,(function(e,t,s){e.stopPropagation(),r.isUpdating=!0,g(r),p(r,t,s)})).bind("updateCell"+s.namespace,(function(t,a,i,c){t.stopPropagation(),r.isUpdating=!0,o.find(s.selectorRemove).remove();var d,l,u,p,g=o.find("tbody"),f=e(a),h=g.index(e.fn.closest?f.closest("tbody"):f.parents("tbody").filter(":first")),m=e.fn.closest?f.closest("tr"):f.parents("tr").filter(":first");a=f[0],g.length&&h>=0&&(u=g.eq(h).find("tr").index(m),p=f.index(),s.cache[h].normalized[u][s.columns].$row=m,l=void 0===s.extractors[p].id?n(r,a,p):s.extractors[p].format(n(r,a,p),r,a,p),d="no-parser"===s.parsers[p].id?"":s.parsers[p].format(l,r,a,p),s.cache[h].normalized[u][p]=s.ignoreCase&&"string"==typeof d?d.toLowerCase():d,"numeric"===(s.parsers[p].type||"").toLowerCase()&&(s.cache[h].colMax[p]=Math.max(Math.abs(d)||0,s.cache[h].colMax[p]||0)),w(o,i,c))})).bind("addRows"+s.namespace,(function(t,c,d,l){if(t.stopPropagation(),r.isUpdating=!0,a(s.cache))g(r),p(r,d,l);else{var u,f,h,m,b,y,v,x=(c=e(c).attr("role","row")).filter("tr").length,C=o.find("tbody").index(c.parents("tbody").filter(":first"));for(s.parsers&&s.parsers.length||i(r),u=0;u<x;u++){for(h=c[u].cells.length,v=[],y={child:[],$row:c.eq(u),order:s.cache[C].normalized.length},f=0;f<h;f++)m=void 0===s.extractors[f].id?n(r,c[u].cells[f],f):s.extractors[f].format(n(r,c[u].cells[f],f),r,c[u].cells[f],f),b="no-parser"===s.parsers[f].id?"":s.parsers[f].format(m,r,c[u].cells[f],f),v[f]=s.ignoreCase&&"string"==typeof b?b.toLowerCase():b,"numeric"===(s.parsers[f].type||"").toLowerCase()&&(s.cache[C].colMax[f]=Math.max(Math.abs(v[f])||0,s.cache[C].colMax[f]||0));v.push(y),s.cache[C].normalized.push(v)}w(o,d,l)}})).bind("updateComplete"+s.namespace,(function(){r.isUpdating=!1})).bind("sorton"+s.namespace,(function(s,n,i,l){var u=r.config;s.stopPropagation(),o.trigger("sortStart",this),function(t,r){var s,a,n,o,i,c=t.config,d=r||c.sortList;c.sortList=[],e.each(d,(function(t,r){if(o=parseInt(r[0],10),n=c.$headers.filter('[data-column="'+o+'"]:last')[0]){switch(a=(a=(""+r[1]).match(/^(1|d|s|o|n)/))?a[0]:""){case"1":case"d":a=1;break;case"s":a=i||0;break;case"o":s=n.order[(i||0)%(c.sortReset?3:2)],a=0===s?1:1===s?0:2;break;case"n":n.count=n.count+1,a=n.order[n.count%(c.sortReset?3:2)];break;default:a=0}i=0===t?a:i,s=[o,parseInt(a,10)||0],c.sortList.push(s),a=e.inArray(s[1],n.order),n.count=a>=0?a:s[1]%(c.sortReset?3:2)}}))}(r,n),f(r),u.delayInit&&a(u.cache)&&c(r),o.trigger("sortBegin",this),b(r),d(r,l),o.trigger("sortEnd",this),t.applyWidget(r),e.isFunction(i)&&i(r)})).bind("appendCache"+s.namespace,(function(t,s,a){t.stopPropagation(),d(r,a),e.isFunction(s)&&s(r)})).bind("updateCache"+s.namespace,(function(t,a){s.parsers&&s.parsers.length||i(r),c(r),e.isFunction(a)&&a(r)})).bind("applyWidgetId"+s.namespace,(function(e,a){e.stopPropagation(),t.getWidgetById(a).format(r,s,s.widgetOptions)})).bind("applyWidgets"+s.namespace,(function(e,s){e.stopPropagation(),t.applyWidget(r,s)})).bind("refreshWidgets"+s.namespace,(function(e,s,a){e.stopPropagation(),t.refreshWidgets(r,s,a)})).bind("destroy"+s.namespace,(function(e,s,a){e.stopPropagation(),t.destroy(r,s,a)})).bind("resetToLoadState"+s.namespace,(function(){t.refreshWidgets(r,!0,!0),s=e.extend(!0,t.defaults,s.originalSettings),r.hasInitialized=!1,t.setup(r,s)}))}t.version="2.17.7",t.parsers=[],t.widgets=[],t.defaults={theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,widgets:[],widgetOptions:{zebra:["even","odd"]},initWidgets:!0,initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssIcon:"tablesorter-icon",cssInfoBlock:"tablesorter-infoOnly",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]},t.css={table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",info:"tablesorter-infoOnly",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"},t.language={sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"},t.log=r,t.benchmark=s,t.construct=function(r){return this.each((function(){var s=this,a=e.extend(!0,{},t.defaults,r);a.originalSettings=r,!s.hasInitialized&&t.buildTable&&"TABLE"!==this.tagName?t.buildTable(s,a):t.setup(s,a)}))},t.setup=function(s,a){if(!s||!s.tHead||0===s.tBodies.length||!0===s.hasInitialized)return a.debug?r("ERROR: stopping initialization! No table, thead, tbody or tablesorter has already been initialized"):"";var n,o="",d=e(s),l=e.metadata;s.hasInitialized=!1,s.isProcessing=!0,s.config=a,e.data(s,"tablesorter",a),a.debug&&e.data(s,"startoveralltimer",new Date),a.supportsDataObject=((n=e.fn.jquery.split("."))[0]=parseInt(n[0],10),n[0]>1||1===n[0]&&parseInt(n[1],10)>=4),a.string={max:1,min:-1,emptyMin:1,emptyMax:-1,zero:0,none:0,null:0,top:!0,bottom:!1},/tablesorter\-/.test(d.attr("class"))||(o=""!==a.theme?" tablesorter-"+a.theme:""),a.table=s,a.$table=d.addClass(t.css.table+" "+a.tableClass+o).attr("role","grid"),a.$headers=d.find(a.selectorHeaders),a.namespace?a.namespace="."+a.namespace.replace(/\W/g,""):a.namespace=".tablesorter"+Math.random().toString(16).slice(2),a.$table.children().children("tr").attr("role","row"),a.$tbodies=d.children("tbody:not(."+a.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"}),a.$table.find("caption").length&&a.$table.attr("aria-labelledby","theCaption"),a.widgetInit={},a.textExtraction=a.$table.attr("data-text-extraction")||a.textExtraction||"basic",u(s),function(t){if(t.config.widthFixed&&0===e(t).find("colgroup").length){var r=e("<colgroup>"),s=e(t).width();e(t.tBodies[0]).find("tr:first").children(":visible").each((function(){r.append(e("<col>").css("width",parseInt(e(this).width()/s*1e3,10)/10+"%"))})),e(t).prepend(r)}}(s),i(s),a.totalRows=0,a.delayInit||c(s),t.bindEvents(s,a.$headers,!0),v(s),a.supportsDataObject&&void 0!==d.data().sortlist?a.sortList=d.data().sortlist:l&&d.metadata()&&d.metadata().sortlist&&(a.sortList=d.metadata().sortlist),t.applyWidget(s,!0),a.sortList.length>0?d.trigger("sorton",[a.sortList,{},!a.initWidgets,!0]):(f(s),a.initWidgets&&t.applyWidget(s,!1)),a.showProcessing&&d.unbind("sortBegin"+a.namespace+" sortEnd"+a.namespace).bind("sortBegin"+a.namespace+" sortEnd"+a.namespace,(function(e){clearTimeout(a.processTimer),t.isProcessing(s),"sortBegin"===e.type&&(a.processTimer=setTimeout((function(){t.isProcessing(s,!0)}),500))})),s.hasInitialized=!0,s.isProcessing=!1,a.debug&&t.benchmark("Overall initialization time",e.data(s,"startoveralltimer")),d.trigger("tablesorter-initialized",s),"function"==typeof a.initialized&&a.initialized(s)},t.getColumnData=function(t,r,s,a){if(null!=r){var n,o=(t=e(t)[0]).config;if(r[s])return a?r[s]:r[o.$headers.index(o.$headers.filter('[data-column="'+s+'"]:last'))];for(n in r)if("string"==typeof n&&(a?o.$headers.eq(s).filter(n):o.$headers.filter('[data-column="'+s+'"]:last').filter(n)).length)return r[n]}},t.computeColumnIndex=function(t){var r,s,a,n,o,i,c,d,l,u,p,g,f,h=[],m={},b=0;for(r=0;r<t.length;r++)for(c=t[r].cells,s=0;s<c.length;s++){for(i=c[s],o=e(i),l=(d=i.parentNode.rowIndex)+"-"+o.index(),u=i.rowSpan||1,p=i.colSpan||1,void 0===h[d]&&(h[d]=[]),a=0;a<h[d].length+1;a++)if(void 0===h[d][a]){g=a;break}for(m[l]=g,b=Math.max(g,b),o.attr({"data-column":g}),a=d;a<d+u;a++)for(void 0===h[a]&&(h[a]=[]),f=h[a],n=g;n<g+p;n++)f[n]="x"}return b+1},t.isProcessing=function(r,s,a){var n=(r=e(r))[0].config,o=a||r.find("."+t.css.header);s?(void 0!==a&&n.sortList.length>0&&(o=o.filter((function(){return!this.sortDisabled&&t.isValueInArray(parseFloat(e(this).attr("data-column")),n.sortList)>=0}))),r.add(o).addClass(t.css.processing+" "+n.cssProcessing)):r.add(o).removeClass(t.css.processing+" "+n.cssProcessing)},t.processTbody=function(t,r,s){var a;if(t=e(t)[0],s)return t.isProcessing=!0,r.before('<span class="tablesorter-savemyplace"/>'),a=e.fn.detach?r.detach():r.remove();a=e(t).find("span.tablesorter-savemyplace"),r.insertAfter(a),a.remove(),t.isProcessing=!1},t.clearTableBody=function(t){e(t)[0].config.$tbodies.children().detach()},t.bindEvents=function(t,r,s){var n,o=(t=e(t)[0]).config;!0!==s&&(o.$extraHeaders=o.$extraHeaders?o.$extraHeaders.add(r):r),r.find(o.selectorSort).add(r.filter(o.selectorSort)).unbind("mousedown mouseup sort keyup ".split(" ").join(o.namespace+" ")).bind("mousedown mouseup sort keyup ".split(" ").join(o.namespace+" "),(function(s,i){var d,l=s.type;if(!(1!==(s.which||s.button)&&!/sort|keyup/.test(l)||"keyup"===l&&13!==s.which||"mouseup"===l&&!0!==i&&(new Date).getTime()-n>250)){if("mousedown"===l)return n=(new Date).getTime(),/(input|select|button|textarea)/i.test(s.target.tagName)?"":!o.cancelSelection;o.delayInit&&a(o.cache)&&c(t),d=e.fn.closest?e(this).closest("th, td")[0]:/TH|TD/.test(this.tagName)?this:e(this).parents("th, td")[0],(d=o.$headers[r.index(d)]).sortDisabled||m(t,d,s)}})),o.cancelSelection&&r.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})},t.restoreHeaders=function(r){var s=e(r)[0].config;s.$table.find(s.selectorHeaders).each((function(r){e(this).find("."+t.css.headerIn).length&&e(this).html(s.headerContent[r])}))},t.destroy=function(r,s,a){if((r=e(r)[0]).hasInitialized){t.refreshWidgets(r,!0,!0);var n=e(r),o=r.config,i=n.find("thead:first"),c=i.find("tr."+t.css.headerRow).removeClass(t.css.headerRow+" "+o.cssHeaderRow),d=n.find("tfoot:first > tr").children("th, td");!1===s&&e.inArray("uitheme",o.widgets)>=0&&(n.trigger("applyWidgetId",["uitheme"]),n.trigger("applyWidgetId",["zebra"])),i.find("tr").not(c).remove(),n.removeData("tablesorter").unbind("sortReset update updateAll updateRows updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave keypress sortBegin sortEnd resetToLoadState ".split(" ").join(o.namespace+" ")),o.$headers.add(d).removeClass([t.css.header,o.cssHeader,o.cssAsc,o.cssDesc,t.css.sortAsc,t.css.sortDesc,t.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true"),c.find(o.selectorSort).unbind("mousedown mouseup keypress ".split(" ").join(o.namespace+" ")),t.restoreHeaders(r),n.toggleClass(t.css.table+" "+o.tableClass+" tablesorter-"+o.theme,!1===s),r.hasInitialized=!1,delete r.config.cache,"function"==typeof a&&a(r)}},t.regex={chunk:/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i},t.sortNatural=function(e,r){if(e===r)return 0;var s,a,n,o,i,c,d,l,u=t.regex;if(u.hex.test(r)){if((a=parseInt(e.match(u.hex),16))<(o=parseInt(r.match(u.hex),16)))return-1;if(a>o)return 1}for(s=e.replace(u.chunk,"\\0$1\\0").replace(u.chunks,"").split("\\0"),n=r.replace(u.chunk,"\\0$1\\0").replace(u.chunks,"").split("\\0"),l=Math.max(s.length,n.length),d=0;d<l;d++){if(i=isNaN(s[d])?s[d]||0:parseFloat(s[d])||0,c=isNaN(n[d])?n[d]||0:parseFloat(n[d])||0,isNaN(i)!==isNaN(c))return isNaN(i)?1:-1;if(typeof i!=typeof c&&(i+="",c+=""),i<c)return-1;if(i>c)return 1}return 0},t.sortNaturalAsc=function(e,r,s,a,n){if(e===r)return 0;var o=n.string[n.empties[s]||n.emptyTo];return""===e&&0!==o?"boolean"==typeof o?o?-1:1:-o||-1:""===r&&0!==o?"boolean"==typeof o?o?1:-1:o||1:t.sortNatural(e,r)},t.sortNaturalDesc=function(e,r,s,a,n){if(e===r)return 0;var o=n.string[n.empties[s]||n.emptyTo];return""===e&&0!==o?"boolean"==typeof o?o?-1:1:o||1:""===r&&0!==o?"boolean"==typeof o?o?1:-1:-o||-1:t.sortNatural(r,e)},t.sortText=function(e,t){return e>t?1:e<t?-1:0},t.getTextValue=function(e,t,r){if(r){var s,a=e?e.length:0,n=r+t;for(s=0;s<a;s++)n+=e.charCodeAt(s);return t*n}return 0},t.sortNumericAsc=function(e,r,s,a,n,o){if(e===r)return 0;var i=o.config,c=i.string[i.empties[n]||i.emptyTo];return""===e&&0!==c?"boolean"==typeof c?c?-1:1:-c||-1:""===r&&0!==c?"boolean"==typeof c?c?1:-1:c||1:(isNaN(e)&&(e=t.getTextValue(e,s,a)),isNaN(r)&&(r=t.getTextValue(r,s,a)),e-r)},t.sortNumericDesc=function(e,r,s,a,n,o){if(e===r)return 0;var i=o.config,c=i.string[i.empties[n]||i.emptyTo];return""===e&&0!==c?"boolean"==typeof c?c?-1:1:c||1:""===r&&0!==c?"boolean"==typeof c?c?1:-1:-c||-1:(isNaN(e)&&(e=t.getTextValue(e,s,a)),isNaN(r)&&(r=t.getTextValue(r,s,a)),r-e)},t.sortNumeric=function(e,t){return e-t},t.characterEquivalents={a:"áàâãäąå",A:"ÁÀÂÃÄĄÅ",c:"çćč",C:"ÇĆČ",e:"éèêëěę",E:"ÉÈÊËĚĘ",i:"íìİîïı",I:"ÍÌİÎÏ",o:"óòôõö",O:"ÓÒÔÕÖ",ss:"ß",SS:"ẞ",u:"úùûüů",U:"ÚÙÛÜŮ"},t.replaceAccents=function(e){var r,s="[",a=t.characterEquivalents;if(!t.characterRegex){for(r in t.characterRegexArray={},a)"string"==typeof r&&(s+=a[r],t.characterRegexArray[r]=new RegExp("["+a[r]+"]","g"));t.characterRegex=new RegExp(s+"]")}if(t.characterRegex.test(e))for(r in a)"string"==typeof r&&(e=e.replace(t.characterRegexArray[r],r));return e},t.isValueInArray=function(e,t){var r,s=t.length;for(r=0;r<s;r++)if(t[r][0]===e)return r;return-1},t.addParser=function(e){var r,s=t.parsers.length,a=!0;for(r=0;r<s;r++)t.parsers[r].id.toLowerCase()===e.id.toLowerCase()&&(a=!1);a&&t.parsers.push(e)},t.getParserById=function(e){if("false"==e)return!1;var r,s=t.parsers.length;for(r=0;r<s;r++)if(t.parsers[r].id.toLowerCase()===e.toString().toLowerCase())return t.parsers[r];return!1},t.addWidget=function(e){t.widgets.push(e)},t.hasWidget=function(t,r){return(t=e(t)).length&&t[0].config&&t[0].config.widgetInit[r]||!1},t.getWidgetById=function(e){var r,s,a=t.widgets.length;for(r=0;r<a;r++)if((s=t.widgets[r])&&s.hasOwnProperty("id")&&s.id.toLowerCase()===e.toLowerCase())return s},t.applyWidget=function(r,a){var n,o,i,c=(r=e(r)[0]).config,d=c.widgetOptions,l=[];!1!==a&&r.hasInitialized&&(r.isApplyingWidgets||r.isUpdating)||(c.debug&&(n=new Date),c.widgets.length&&(r.isApplyingWidgets=!0,c.widgets=e.grep(c.widgets,(function(t,r){return e.inArray(t,c.widgets)===r})),e.each(c.widgets||[],(function(e,r){(i=t.getWidgetById(r))&&i.id&&(i.priority||(i.priority=10),l[e]=i)})),l.sort((function(e,t){return e.priority<t.priority?-1:e.priority===t.priority?0:1})),e.each(l,(function(t,s){s&&(!a&&c.widgetInit[s.id]||(c.widgetInit[s.id]=!0,s.hasOwnProperty("options")&&(d=r.config.widgetOptions=e.extend(!0,{},s.options,d)),s.hasOwnProperty("init")&&s.init(r,s,c,d)),!a&&s.hasOwnProperty("format")&&s.format(r,c,d,!1))}))),setTimeout((function(){r.isApplyingWidgets=!1}),0),c.debug&&(o=c.widgets.length,s("Completed "+(!0===a?"initializing ":"applying ")+o+" widget"+(1!==o?"s":""),n)))},t.refreshWidgets=function(s,a,n){var o,i=(s=e(s)[0]).config,c=i.widgets,d=t.widgets,l=d.length;for(o=0;o<l;o++)d[o]&&d[o].id&&(a||e.inArray(d[o].id,c)<0)&&(i.debug&&r('Refeshing widgets: Removing "'+d[o].id+'"'),d[o].hasOwnProperty("remove")&&i.widgetInit[d[o].id]&&(d[o].remove(s,i,i.widgetOptions),i.widgetInit[d[o].id]=!1));!0!==n&&t.applyWidget(s,a)},t.getData=function(t,r,s){var a,n,o="",i=e(t);return i.length?(a=!!e.metadata&&i.metadata(),n=" "+(i.attr("class")||""),void 0!==i.data(s)||void 0!==i.data(s.toLowerCase())?o+=i.data(s)||i.data(s.toLowerCase()):a&&void 0!==a[s]?o+=a[s]:r&&void 0!==r[s]?o+=r[s]:" "!==n&&n.match(" "+s+"-")&&(o=n.match(new RegExp("\\s"+s+"-([\\w-]+)"))[1]||""),e.trim(o)):""},t.formatFloat=function(t,r){return"string"!=typeof t||""===t?t:(t=(r&&r.config?!1!==r.config.usNumberFormat:void 0===r||r)?t.replace(/,/g,""):t.replace(/[\s|\.]/g,"").replace(/,/g,"."),/^\s*\([.\d]+\)/.test(t)&&(t=t.replace(/^\s*\(([.\d]+)\)/,"-$1")),s=parseFloat(t),isNaN(s)?e.trim(t):s);var s},t.isDigit=function(e){return!isNaN(e)||/^[\-+(]?\d+[)]?$/.test(e.toString().replace(/[,.'"\s]/g,""))}}});var t=e.tablesorter;e.fn.extend({tablesorter:t.construct}),t.addParser({id:"no-parser",is:function(){return!1},format:function(){return""},type:"text"}),t.addParser({id:"text",is:function(){return!0},format:function(r,s){var a=s.config;return r&&(r=e.trim(a.ignoreCase?r.toLocaleLowerCase():r),r=a.sortLocaleCompare?t.replaceAccents(r):r),r},type:"text"}),t.addParser({id:"digit",is:function(e){return t.isDigit(e)},format:function(r,s){var a=t.formatFloat((r||"").replace(/[^\w,. \-()]/g,""),s);return r&&"number"==typeof a?a:r?e.trim(r&&s.config.ignoreCase?r.toLocaleLowerCase():r):r},type:"numeric"}),t.addParser({id:"currency",is:function(e){return/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/.test((e||"").replace(/[+\-,. ]/g,""))},format:function(r,s){var a=t.formatFloat((r||"").replace(/[^\w,. \-()]/g,""),s);return r&&"number"==typeof a?a:r?e.trim(r&&s.config.ignoreCase?r.toLocaleLowerCase():r):r},type:"numeric"}),t.addParser({id:"ipAddress",is:function(e){return/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(e)},format:function(e,r){var s,a=e?e.split("."):"",n="",o=a.length;for(s=0;s<o;s++)n+=("00"+a[s]).slice(-3);return e?t.formatFloat(n,r):e},type:"numeric"}),t.addParser({id:"url",is:function(e){return/^(https?|ftp|file):\/\//.test(e)},format:function(t){return t?e.trim(t.replace(/(https?|ftp|file):\/\//,"")):t},type:"text"}),t.addParser({id:"isoDate",is:function(e){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/.test(e)},format:function(e,r){return e?t.formatFloat(""!==e?new Date(e.replace(/-/g,"/")).getTime()||e:"",r):e},type:"numeric"}),t.addParser({id:"percent",is:function(e){return/(\d\s*?%|%\s*?\d)/.test(e)&&e.length<15},format:function(e,r){return e?t.formatFloat(e.replace(/%/g,""),r):e},type:"numeric"}),t.addParser({id:"usLongDate",is:function(e){return/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i.test(e)||/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i.test(e)},format:function(e,r){return e?t.formatFloat(new Date(e.replace(/(\S)([AP]M)$/i,"$1 $2")).getTime()||e,r):e},type:"numeric"}),t.addParser({id:"shortDate",is:function(e){return/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/.test((e||"").replace(/\s+/g," ").replace(/[\-.,]/g,"/"))},format:function(e,r,s,a){if(e){var n=r.config,o=n.$headers.filter("[data-column="+a+"]:last"),i=o.length&&o[0].dateFormat||t.getData(o,t.getColumnData(r,n.headers,a),"dateFormat")||n.dateFormat;e=e.replace(/\s+/g," ").replace(/[\-.,]/g,"/"),"mmddyyyy"===i?e=e.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$1/$2"):"ddmmyyyy"===i?e=e.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$2/$1"):"yyyymmdd"===i&&(e=e.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,"$1/$2/$3"))}return e?t.formatFloat(new Date(e).getTime()||e,r):e},type:"numeric"}),t.addParser({id:"time",is:function(e){return/^(([0-2]?\d:[0-5]\d)|([0-1]?\d:[0-5]\d\s?([AP]M)))$/i.test(e)},format:function(e,r){return e?t.formatFloat(new Date("2000/01/01 "+e.replace(/(\S)([AP]M)$/i,"$1 $2")).getTime()||e,r):e},type:"numeric"}),t.addParser({id:"metadata",is:function(){return!1},format:function(t,r,s){var a=r.config,n=a.parserMetadataName?a.parserMetadataName:"sortValue";return e(s).metadata()[n]},type:"numeric"}),t.addWidget({id:"zebra",priority:90,format:function(r,s,a){var n,o,i,c,d,l,u=new RegExp(s.cssChildRow,"i"),p=s.$tbodies;for(s.debug&&(d=new Date),l=0;l<p.length;l++)(n=p.eq(l)).children("tr").length>1&&(i=0,n.children("tr:visible").not(s.selectorRemove).each((function(){o=e(this),u.test(this.className)||i++,c=i%2==0,o.removeClass(a.zebra[c?1:0]).addClass(a.zebra[c?0:1])})));s.debug&&t.benchmark("Applying Zebra widget",d)},remove:function(t,r,s){var a,n,o=r.$tbodies,i=(s.zebra||["even","odd"]).join(" ");for(a=0;a<o.length;a++)(n=e.tablesorter.processTbody(t,o.eq(a),!0)).children().removeClass(i),e.tablesorter.processTbody(t,n,!1)}})}(jQuery)},M8Tw:function(e,t,r){"use strict";r.r(t);r("jJ4L");var s=r("+x/D"),a=(r("AqzS"),r("KloK"));const n={sortMultiSortKey:"",headers:{},debug:!1,tabIndex:!1};function o(e,t){let r=Object.assign({},n,t);return e.find("th").each((function(e,t){const a=Object(s.a)(t);r.headers[e]={},a.hasClass("aui-table-column-unsortable")?r.headers[e].sorter=!1:(a.attr("tabindex","0"),a.wrapInner("<span class='aui-table-header-content'/>"),a.hasClass("aui-table-column-issue-key")&&(r.headers[e].sorter="issue-key"))})),e.tablesorter(r)}let i={setup:function(){s.a.tablesorter.addParser({id:"issue-key",is:function(){return!1},format:function(e){const t=e.split("-"),r=t[0],s=t[1],a="..........",n="000000";let o=(r+a).slice(0,a.length);return o+=(n+s).slice(-n.length),o},type:"text"}),s.a.tablesorter.addParser({id:"textSortAttributeParser",is:function(e,t,r){return r.hasAttribute("data-sort-value")&&(!r.hasAttribute("data-sort-type")||"text"===r.getAttribute("data-sort-type"))},format:function(e,t,r){return r.getAttribute("data-sort-value")},type:"text"}),s.a.tablesorter.addParser({id:"numericSortAttributeParser",is:function(e,t,r){return"numeric"===r.getAttribute("data-sort-type")&&r.hasAttribute("data-sort-value")},format:function(e,t,r){return r.getAttribute("data-sort-value")},type:"numeric"}),Object(s.a)(".aui-table-sortable").each((function(){o(Object(s.a)(this))}))},setTableSortable:function(e,t){return o(e,t)}};Object(s.a)(i.setup),Object(a.a)("tablessortable",i)}},[["M8Tw","runtime","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.d7c46c2734","aui.splitchunk.fb15cffa72","aui.splitchunk.862f26d10a","aui.splitchunk.b2ecdd4179","aui.splitchunk.16f099a0da"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--c7d6d1dc80', location = 'aui.chunk.65a339636e1a7f9970d0--19dccfa7bbe75ae7048a.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--c7d6d1dc80"],{"2NYx":function(t,i,o){var e,n,l;
/*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */n=[o("oDIA"),o("O+lX")],void 0===(l="function"==typeof(e=function(t){return function(){var i,o=Math.max,e=Math.abs,n=/left|center|right/,l=/top|center|bottom/,s=/[\+\-]\d+(\.[\d]+)?%?/,f=/^\w+/,h=/%$/,r=t.fn.position;function p(t,i,o){return[parseFloat(t[0])*(h.test(t[0])?i/100:1),parseFloat(t[1])*(h.test(t[1])?o/100:1)]}function c(i,o){return parseInt(t.css(i,o),10)||0}function a(i){var o=i[0];return 9===o.nodeType?{width:i.width(),height:i.height(),offset:{top:0,left:0}}:t.isWindow(o)?{width:i.width(),height:i.height(),offset:{top:i.scrollTop(),left:i.scrollLeft()}}:o.preventDefault?{width:0,height:0,offset:{top:o.pageY,left:o.pageX}}:{width:i.outerWidth(),height:i.outerHeight(),offset:i.offset()}}t.position={scrollbarWidth:function(){if(void 0!==i)return i;var o,e,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),l=n.children()[0];return t("body").append(n),o=l.offsetWidth,n.css("overflow","scroll"),o===(e=l.offsetWidth)&&(e=n[0].clientWidth),n.remove(),i=o-e},getScrollInfo:function(i){var o=i.isWindow||i.isDocument?"":i.element.css("overflow-x"),e=i.isWindow||i.isDocument?"":i.element.css("overflow-y"),n="scroll"===o||"auto"===o&&i.width<i.element[0].scrollWidth;return{width:"scroll"===e||"auto"===e&&i.height<i.element[0].scrollHeight?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(i){var o=t(i||window),e=t.isWindow(o[0]),n=!!o[0]&&9===o[0].nodeType;return{element:o,isWindow:e,isDocument:n,offset:e||n?{left:0,top:0}:t(i).offset(),scrollLeft:o.scrollLeft(),scrollTop:o.scrollTop(),width:o.outerWidth(),height:o.outerHeight()}}},t.fn.position=function(i){if(!i||!i.of)return r.apply(this,arguments);i=t.extend({},i);var h,d,g,u,m,w,W=t(i.of),v=t.position.getWithinInfo(i.within),y=t.position.getScrollInfo(v),H=(i.collision||"flip").split(" "),x={};return w=a(W),W[0].preventDefault&&(i.at="left top"),d=w.width,g=w.height,u=w.offset,m=t.extend({},u),t.each(["my","at"],(function(){var t,o,e=(i[this]||"").split(" ");1===e.length&&(e=n.test(e[0])?e.concat(["center"]):l.test(e[0])?["center"].concat(e):["center","center"]),e[0]=n.test(e[0])?e[0]:"center",e[1]=l.test(e[1])?e[1]:"center",t=s.exec(e[0]),o=s.exec(e[1]),x[this]=[t?t[0]:0,o?o[0]:0],i[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]})),1===H.length&&(H[1]=H[0]),"right"===i.at[0]?m.left+=d:"center"===i.at[0]&&(m.left+=d/2),"bottom"===i.at[1]?m.top+=g:"center"===i.at[1]&&(m.top+=g/2),h=p(x.at,d,g),m.left+=h[0],m.top+=h[1],this.each((function(){var n,l,s=t(this),f=s.outerWidth(),r=s.outerHeight(),a=c(this,"marginLeft"),w=c(this,"marginTop"),b=f+a+c(this,"marginRight")+y.width,T=r+w+c(this,"marginBottom")+y.height,L=t.extend({},m),P=p(x.my,s.outerWidth(),s.outerHeight());"right"===i.my[0]?L.left-=f:"center"===i.my[0]&&(L.left-=f/2),"bottom"===i.my[1]?L.top-=r:"center"===i.my[1]&&(L.top-=r/2),L.left+=P[0],L.top+=P[1],n={marginLeft:a,marginTop:w},t.each(["left","top"],(function(o,e){t.ui.position[H[o]]&&t.ui.position[H[o]][e](L,{targetWidth:d,targetHeight:g,elemWidth:f,elemHeight:r,collisionPosition:n,collisionWidth:b,collisionHeight:T,offset:[h[0]+P[0],h[1]+P[1]],my:i.my,at:i.at,within:v,elem:s})})),i.using&&(l=function(t){var n=u.left-L.left,l=n+d-f,h=u.top-L.top,p=h+g-r,c={target:{element:W,left:u.left,top:u.top,width:d,height:g},element:{element:s,left:L.left,top:L.top,width:f,height:r},horizontal:l<0?"left":n>0?"right":"center",vertical:p<0?"top":h>0?"bottom":"middle"};d<f&&e(n+l)<d&&(c.horizontal="center"),g<r&&e(h+p)<g&&(c.vertical="middle"),o(e(n),e(l))>o(e(h),e(p))?c.important="horizontal":c.important="vertical",i.using.call(this,t,c)}),s.offset(t.extend(L,{using:l}))}))},t.ui.position={fit:{left:function(t,i){var e,n=i.within,l=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,f=t.left-i.collisionPosition.marginLeft,h=l-f,r=f+i.collisionWidth-s-l;i.collisionWidth>s?h>0&&r<=0?(e=t.left+h+i.collisionWidth-s-l,t.left+=h-e):t.left=r>0&&h<=0?l:h>r?l+s-i.collisionWidth:l:h>0?t.left+=h:r>0?t.left-=r:t.left=o(t.left-f,t.left)},top:function(t,i){var e,n=i.within,l=n.isWindow?n.scrollTop:n.offset.top,s=i.within.height,f=t.top-i.collisionPosition.marginTop,h=l-f,r=f+i.collisionHeight-s-l;i.collisionHeight>s?h>0&&r<=0?(e=t.top+h+i.collisionHeight-s-l,t.top+=h-e):t.top=r>0&&h<=0?l:h>r?l+s-i.collisionHeight:l:h>0?t.top+=h:r>0?t.top-=r:t.top=o(t.top-f,t.top)}},flip:{left:function(t,i){var o,n,l=i.within,s=l.offset.left+l.scrollLeft,f=l.width,h=l.isWindow?l.scrollLeft:l.offset.left,r=t.left-i.collisionPosition.marginLeft,p=r-h,c=r+i.collisionWidth-f-h,a="left"===i.my[0]?-i.elemWidth:"right"===i.my[0]?i.elemWidth:0,d="left"===i.at[0]?i.targetWidth:"right"===i.at[0]?-i.targetWidth:0,g=-2*i.offset[0];p<0?((o=t.left+a+d+g+i.collisionWidth-f-s)<0||o<e(p))&&(t.left+=a+d+g):c>0&&((n=t.left-i.collisionPosition.marginLeft+a+d+g-h)>0||e(n)<c)&&(t.left+=a+d+g)},top:function(t,i){var o,n,l=i.within,s=l.offset.top+l.scrollTop,f=l.height,h=l.isWindow?l.scrollTop:l.offset.top,r=t.top-i.collisionPosition.marginTop,p=r-h,c=r+i.collisionHeight-f-h,a="top"===i.my[1]?-i.elemHeight:"bottom"===i.my[1]?i.elemHeight:0,d="top"===i.at[1]?i.targetHeight:"bottom"===i.at[1]?-i.targetHeight:0,g=-2*i.offset[1];p<0?((n=t.top+a+d+g+i.collisionHeight-f-s)<0||n<e(p))&&(t.top+=a+d+g):c>0&&((o=t.top-i.collisionPosition.marginTop+a+d+g-h)>0||e(o)<c)&&(t.top+=a+d+g)}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position})?e.apply(i,n):e)||(t.exports=l)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.position', location = 'aui.chunk.d0711aecad829e977fd1--9d868d6240f5d1e9f032.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.position"],{"7ih8":function(i,u,n){"use strict";n.r(u);n("2NYx");u.default="jquery"}},[["7ih8","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--c7d6d1dc80","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--825acd7236', location = 'aui.chunk.a789521260b0bb8293e4--92122f70f73c3bd97ccc.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--825acd7236"],{PTCr:function(e,t,i){var s,o,n;
/*!
 * jQuery UI Droppable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */o=[i("oDIA"),i("z+ct"),i("XPYc"),i("O+lX"),i("yIBB")],void 0===(n="function"==typeof(s=function(e){e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t)},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(i)))},_drop:function(i,s){var o=s||e.ui.ddmanager.current,n=!1;return!(!o||(o.currentItem||o.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function(){var s=e(this).droppable("instance");if(s.options.greedy&&!s.options.disabled&&s.options.scope===o.options.scope&&s.accept.call(s.element[0],o.currentItem||o.element)&&t(o,e.extend(s,{offset:s.element.offset()}),s.options.tolerance,i))return n=!0,!1})),!n&&!!this.accept.call(this.element[0],o.currentItem||o.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",i,this.ui(o)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var t=e.ui.intersect=function(){function e(e,t,i){return e>=t&&e<t+i}return function(t,i,s,o){if(!i.offset)return!1;var n=(t.positionAbs||t.position.absolute).left+t.margins.left,r=(t.positionAbs||t.position.absolute).top+t.margins.top,a=n+t.helperProportions.width,l=r+t.helperProportions.height,p=i.offset.left,c=i.offset.top,d=p+i.proportions().width,h=c+i.proportions().height;switch(s){case"fit":return p<=n&&a<=d&&c<=r&&l<=h;case"intersect":return p<n+t.helperProportions.width/2&&a-t.helperProportions.width/2<d&&c<r+t.helperProportions.height/2&&l-t.helperProportions.height/2<h;case"pointer":return e(o.pageY,c,i.proportions().height)&&e(o.pageX,p,i.proportions().width);case"touch":return(r>=c&&r<=h||l>=c&&l<=h||r<c&&l>h)&&(n>=p&&n<=d||a>=p&&a<=d||n<p&&a>d);default:return!1}}}();return e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var s,o,n=e.ui.ddmanager.droppables[t.options.scope]||[],r=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;s<n.length;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(o=0;o<a.length;o++)if(a[o]===n[s].element[0]){n[s].proportions().height=0;continue e}n[s].visible="none"!==n[s].element.css("display"),n[s].visible&&("mousedown"===r&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions({width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight}))}},drop:function(i,s){var o=!1;return e.each((e.ui.ddmanager.droppables[i.options.scope]||[]).slice(),(function(){this.options&&(!this.options.disabled&&this.visible&&t(i,this,this.options.tolerance,s)&&(o=this._drop.call(this,s)||o),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,s)))})),o},dragStart:function(t,i){t.element.parentsUntil("body").on("scroll.droppable",(function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}))},drag:function(i,s){i.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(i,s),e.each(e.ui.ddmanager.droppables[i.options.scope]||[],(function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var o,n,r,a=t(i,this,this.options.tolerance,s),l=!a&&this.isover?"isout":a&&!this.isover?"isover":null;l&&(this.options.greedy&&(n=this.options.scope,(r=this.element.parents(":data(ui-droppable)").filter((function(){return e(this).droppable("instance").options.scope===n}))).length&&((o=e(r[0]).droppable("instance")).greedyChild="isover"===l)),o&&"isover"===l&&(o.isover=!1,o.isout=!0,o._out.call(o,s)),this[l]=!0,this["isout"===l?"isover":"isout"]=!1,this["isover"===l?"_over":"_out"].call(this,s),o&&"isout"===l&&(o.isout=!1,o.isover=!0,o._over.call(o,s)))}}))},dragStop:function(t,i){t.element.parentsUntil("body").off("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.ui.droppable})?s.apply(t,o):s)||(e.exports=n)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.droppable', location = 'aui.chunk.7cafb85ba31222609cb0--d1cb2c41e018b3145bb6.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.droppable"],{qe8r:function(u,i,n){"use strict";n.r(i);n("PTCr");i.default="jquery"}},[["qe8r","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--d18e3cafa7","aui.splitchunk.vendors--db57146687","aui.splitchunk.vendors--51504ebf10","aui.splitchunk.vendors--9c8c8c1546","aui.splitchunk.vendors--351ae504d7","aui.splitchunk.vendors--06bc6ae5d7","aui.splitchunk.vendors--825acd7236","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--85718a7eef', location = 'aui.chunk.d8b4e695447f7abc2f01--f4dc482a646dce1cdcaa.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--85718a7eef"],{"2V+C":function(t,i,e){},XnJT:function(t,i,e){var s,h,n;
/*!
 * jQuery UI Resizable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */h=[e("oDIA"),e("XPYc"),e("zq/Y"),e("lSwU"),e("O+lX"),e("yIBB")],void 0===(n="function"==typeof(s=function(t){return t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(i,e){if("hidden"===t(i).css("overflow"))return!1;var s=e&&"left"===e?"scrollLeft":"scrollTop",h=!1;return i[s]>0||(i[s]=1,h=i[s]>0,i[s]=0,h)},_create:function(){var i,e=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!e.aspectRatio,aspectRatio:e.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:e.helper||e.ghost||e.animate?e.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,i={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(i),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(i),this._proportionallyResize()),this._setupHandles(),e.autoHide&&t(this.element).on("mouseenter",(function(){e.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())})).on("mouseleave",(function(){e.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var i,e=function(i){t(i).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(e(this.element),i=this.element,this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")}).insertAfter(i),i.remove()),this.originalElement.css("resize",this.originalResizeStyle),e(this.originalElement),this},_setOption:function(t,i){switch(this._super(t,i),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var i,e,s,h,n,o=this.options,a=this;if(this.handles=o.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},e=0;e<s.length;e++)h="ui-resizable-"+(i=t.trim(s[e])),n=t("<div>"),this._addClass(n,"ui-resizable-handle "+h),n.css({zIndex:o.zIndex}),this.handles[i]=".ui-resizable-"+i,this.element.append(n);this._renderAxis=function(i){var e,s,h,n;for(e in i=i||this.element,this.handles)this.handles[e].constructor===String?this.handles[e]=this.element.children(this.handles[e]).first().show():(this.handles[e].jquery||this.handles[e].nodeType)&&(this.handles[e]=t(this.handles[e]),this._on(this.handles[e],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[e],this.element),n=/sw|ne|nw|se|n|s/.test(e)?s.outerHeight():s.outerWidth(),h=["padding",/ne|nw|n/.test(e)?"Top":/se|sw|s/.test(e)?"Bottom":/^e$/.test(e)?"Right":"Left"].join(""),i.css(h,n),this._proportionallyResize()),this._handles=this._handles.add(this.handles[e])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",(function(){a.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=n&&n[1]?n[1]:"se")})),o.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(i){var e,s,h=!1;for(e in this.handles)((s=t(this.handles[e])[0])===i.target||t.contains(s,i.target))&&(h=!0);return!this.options.disabled&&h},_mouseStart:function(i){var e,s,h,n=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),e=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),n.containment&&(e+=t(n.containment).scrollLeft()||0,s+=t(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:e,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:e,top:s},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,h=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===h?this.axis+"-resize":h),this._addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(i){var e,s,h=this.originalMousePosition,n=this.axis,o=i.pageX-h.left||0,a=i.pageY-h.top||0,l=this._change[n];return this._updatePrevProperties(),!!l&&(e=l.apply(this,[i,o,a]),this._updateVirtualBoundaries(i.shiftKey),(this._aspectRatio||i.shiftKey)&&(e=this._updateRatio(e,i)),e=this._respectSize(e,i),this._updateCache(e),this._propagate("resize",i),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",i,this.ui()),this._applyChanges()),!1)},_mouseStop:function(i){this.resizing=!1;var e,s,h,n,o,a,l,r=this.options,p=this;return this._helper&&(h=(s=(e=this._proportionallyResizeElements).length&&/textarea/i.test(e[0].nodeName))&&this._hasScroll(e[0],"left")?0:p.sizeDiff.height,n=s?0:p.sizeDiff.width,o={width:p.helper.width()-n,height:p.helper.height()-h},a=parseFloat(p.element.css("left"))+(p.position.left-p.originalPosition.left)||null,l=parseFloat(p.element.css("top"))+(p.position.top-p.originalPosition.top)||null,r.animate||this.element.css(t.extend(o,{top:l,left:a})),p.helper.height(p.size.height),p.helper.width(p.size.width),this._helper&&!r.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",i),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var i,e,s,h,n,o=this.options;n={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||t)&&(i=n.minHeight*this.aspectRatio,s=n.minWidth/this.aspectRatio,e=n.maxHeight*this.aspectRatio,h=n.maxWidth/this.aspectRatio,i>n.minWidth&&(n.minWidth=i),s>n.minHeight&&(n.minHeight=s),e<n.maxWidth&&(n.maxWidth=e),h<n.maxHeight&&(n.maxHeight=h)),this._vBoundaries=n},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var i=this.position,e=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=i.left+(e.width-t.width),t.top=null),"nw"===s&&(t.top=i.top+(e.height-t.height),t.left=i.left+(e.width-t.width)),t},_respectSize:function(t){var i=this._vBoundaries,e=this.axis,s=this._isNumber(t.width)&&i.maxWidth&&i.maxWidth<t.width,h=this._isNumber(t.height)&&i.maxHeight&&i.maxHeight<t.height,n=this._isNumber(t.width)&&i.minWidth&&i.minWidth>t.width,o=this._isNumber(t.height)&&i.minHeight&&i.minHeight>t.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,r=/sw|nw|w/.test(e),p=/nw|ne|n/.test(e);return n&&(t.width=i.minWidth),o&&(t.height=i.minHeight),s&&(t.width=i.maxWidth),h&&(t.height=i.maxHeight),n&&r&&(t.left=a-i.minWidth),s&&r&&(t.left=a-i.maxWidth),o&&p&&(t.top=l-i.minHeight),h&&p&&(t.top=l-i.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var i=0,e=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],h=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];i<4;i++)e[i]=parseFloat(s[i])||0,e[i]+=parseFloat(h[i])||0;return{height:e[0]+e[2],width:e[1]+e[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,i=0,e=this.helper||this.element;i<this._proportionallyResizeElements.length;i++)t=this._proportionallyResizeElements[i],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:e.height()-this.outerDimensions.height||0,width:e.width()-this.outerDimensions.width||0})},_renderProxy:function(){var i=this.element,e=this.options;this.elementOffset=i.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++e.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,i){return{width:this.originalSize.width+i}},w:function(t,i){var e=this.originalSize;return{left:this.originalPosition.left+i,width:e.width-i}},n:function(t,i,e){var s=this.originalSize;return{top:this.originalPosition.top+e,height:s.height-e}},s:function(t,i,e){return{height:this.originalSize.height+e}},se:function(i,e,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[i,e,s]))},sw:function(i,e,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[i,e,s]))},ne:function(i,e,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[i,e,s]))},nw:function(i,e,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[i,e,s]))}},_propagate:function(i,e){t.ui.plugin.call(this,i,[e,this.ui()]),"resize"!==i&&this._trigger(i,e,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(i){var e=t(this).resizable("instance"),s=e.options,h=e._proportionallyResizeElements,n=h.length&&/textarea/i.test(h[0].nodeName),o=n&&e._hasScroll(h[0],"left")?0:e.sizeDiff.height,a=n?0:e.sizeDiff.width,l={width:e.size.width-a,height:e.size.height-o},r=parseFloat(e.element.css("left"))+(e.position.left-e.originalPosition.left)||null,p=parseFloat(e.element.css("top"))+(e.position.top-e.originalPosition.top)||null;e.element.animate(t.extend(l,p&&r?{top:p,left:r}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(e.element.css("width")),height:parseFloat(e.element.css("height")),top:parseFloat(e.element.css("top")),left:parseFloat(e.element.css("left"))};h&&h.length&&t(h[0]).css({width:s.width,height:s.height}),e._updateCache(s),e._propagate("resize",i)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,e,s,h,n,o,a,l=t(this).resizable("instance"),r=l.options,p=l.element,d=r.containment,g=d instanceof t?d.get(0):/parent/.test(d)?p.parent().get(0):d;g&&(l.containerElement=t(g),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(g),e=[],t(["Top","Right","Left","Bottom"]).each((function(t,s){e[t]=l._num(i.css("padding"+s))})),l.containerOffset=i.offset(),l.containerPosition=i.position(),l.containerSize={height:i.innerHeight()-e[3],width:i.innerWidth()-e[1]},s=l.containerOffset,h=l.containerSize.height,n=l.containerSize.width,o=l._hasScroll(g,"left")?g.scrollWidth:n,a=l._hasScroll(g)?g.scrollHeight:h,l.parentData={element:g,left:s.left,top:s.top,width:o,height:a}))},resize:function(i){var e,s,h,n,o=t(this).resizable("instance"),a=o.options,l=o.containerOffset,r=o.position,p=o._aspectRatio||i.shiftKey,d={top:0,left:0},g=o.containerElement,u=!0;g[0]!==document&&/static/.test(g.css("position"))&&(d=l),r.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-d.left),p&&(o.size.height=o.size.width/o.aspectRatio,u=!1),o.position.left=a.helper?l.left:0),r.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),p&&(o.size.width=o.size.height*o.aspectRatio,u=!1),o.position.top=o._helper?l.top:0),h=o.containerElement.get(0)===o.element.parent().get(0),n=/relative|absolute/.test(o.containerElement.css("position")),h&&n?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),e=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-l.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-l.top)),e+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-e,p&&(o.size.height=o.size.width/o.aspectRatio,u=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,p&&(o.size.width=o.size.height*o.aspectRatio,u=!1)),u||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var i=t(this).resizable("instance"),e=i.options,s=i.containerOffset,h=i.containerPosition,n=i.containerElement,o=t(i.helper),a=o.offset(),l=o.outerWidth()-i.sizeDiff.width,r=o.outerHeight()-i.sizeDiff.height;i._helper&&!e.animate&&/relative/.test(n.css("position"))&&t(this).css({left:a.left-h.left-s.left,width:l,height:r}),i._helper&&!e.animate&&/static/.test(n.css("position"))&&t(this).css({left:a.left-h.left-s.left,width:l,height:r})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var i=t(this).resizable("instance").options;t(i.alsoResize).each((function(){var i=t(this);i.data("ui-resizable-alsoresize",{width:parseFloat(i.width()),height:parseFloat(i.height()),left:parseFloat(i.css("left")),top:parseFloat(i.css("top"))})}))},resize:function(i,e){var s=t(this).resizable("instance"),h=s.options,n=s.originalSize,o=s.originalPosition,a={height:s.size.height-n.height||0,width:s.size.width-n.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};t(h.alsoResize).each((function(){var i=t(this),s=t(this).data("ui-resizable-alsoresize"),h={},n=i.parents(e.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(n,(function(t,i){var e=(s[i]||0)+(a[i]||0);e&&e>=0&&(h[i]=e||null)})),i.css(h)}))},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var i=t(this).resizable("instance"),e=i.size;i.ghost=i.originalElement.clone(),i.ghost.css({opacity:.25,display:"block",position:"relative",height:e.height,width:e.width,margin:0,left:0,top:0}),i._addClass(i.ghost,"ui-resizable-ghost"),!1!==t.uiBackCompat&&"string"==typeof i.options.ghost&&i.ghost.addClass(this.options.ghost),i.ghost.appendTo(i.helper)},resize:function(){var i=t(this).resizable("instance");i.ghost&&i.ghost.css({position:"relative",height:i.size.height,width:i.size.width})},stop:function(){var i=t(this).resizable("instance");i.ghost&&i.helper&&i.helper.get(0).removeChild(i.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var i,e=t(this).resizable("instance"),s=e.options,h=e.size,n=e.originalSize,o=e.originalPosition,a=e.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,r=l[0]||1,p=l[1]||1,d=Math.round((h.width-n.width)/r)*r,g=Math.round((h.height-n.height)/p)*p,u=n.width+d,f=n.height+g,c=s.maxWidth&&s.maxWidth<u,m=s.maxHeight&&s.maxHeight<f,z=s.minWidth&&s.minWidth>u,w=s.minHeight&&s.minHeight>f;s.grid=l,z&&(u+=r),w&&(f+=p),c&&(u-=r),m&&(f-=p),/^(se|s|e)$/.test(a)?(e.size.width=u,e.size.height=f):/^(ne)$/.test(a)?(e.size.width=u,e.size.height=f,e.position.top=o.top-g):/^(sw)$/.test(a)?(e.size.width=u,e.size.height=f,e.position.left=o.left-d):((f-p<=0||u-r<=0)&&(i=e._getPaddingPlusBorderDimensions(this)),f-p>0?(e.size.height=f,e.position.top=o.top-g):(f=p-i.height,e.size.height=f,e.position.top=o.top+n.height-f),u-r>0?(e.size.width=u,e.position.left=o.left-d):(u=r-i.width,e.size.width=u,e.position.left=o.left+n.width-u))}}),t.ui.resizable})?s.apply(i,h):s)||(t.exports=n)},"zq/Y":function(t,i,e){var s,h,n;
/*!
 * jQuery UI Disable Selection 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */h=[e("oDIA"),e("O+lX")],void 0===(n="function"==typeof(s=function(t){return t.fn.extend({disableSelection:(i="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(i+".ui-disableSelection",(function(t){t.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var i})?s.apply(i,h):s)||(t.exports=n)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.resizable', location = 'aui.chunk.76b698c6b1b5f69c0610--31566db8081d03482789.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.resizable"],{kW2n:function(u,i,n){"use strict";n.r(i);n("2V+C"),n("XnJT");i.default="jquery"}},[["kW2n","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--d18e3cafa7","aui.splitchunk.vendors--db57146687","aui.splitchunk.vendors--9c8c8c1546","aui.splitchunk.vendors--85718a7eef","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--7c76061134', location = 'aui.chunk.6f6d319dead4c2cb632d--f88ae3a2bdc3fe4f073a.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--7c76061134"],{TRfs:function(e,t,s){},iCCw:function(e,t,s){var l,i,n;
/*!
 * jQuery UI Selectable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */i=[s("oDIA"),s("XPYc"),s("O+lX"),s("yIBB")],void 0===(n="function"==typeof(l=function(e){return e.widget("ui.selectable",e.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t.elementPos=e(t.element[0]).offset(),t.selectees=e(t.options.filter,t.element[0]),t._addClass(t.selectees,"ui-selectee"),t.selectees.each((function(){var s=e(this),l=s.offset(),i={left:l.left-t.elementPos.left,top:l.top-t.elementPos.top};e.data(this,"selectable-item",{element:this,$element:s,left:i.left,top:i.top,right:i.left+s.outerWidth(),bottom:i.top+s.outerHeight(),startselected:!1,selected:s.hasClass("ui-selected"),selecting:s.hasClass("ui-selecting"),unselecting:s.hasClass("ui-unselecting")})}))},this.refresh(),this._mouseInit(),this.helper=e("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(t){var s=this,l=this.options;this.opos=[t.pageX,t.pageY],this.elementPos=e(this.element[0]).offset(),this.options.disabled||(this.selectees=e(l.filter,this.element[0]),this._trigger("start",t),e(l.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),l.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each((function(){var l=e.data(this,"selectable-item");l.startselected=!0,t.metaKey||t.ctrlKey||(s._removeClass(l.$element,"ui-selected"),l.selected=!1,s._addClass(l.$element,"ui-unselecting"),l.unselecting=!0,s._trigger("unselecting",t,{unselecting:l.element}))})),e(t.target).parents().addBack().each((function(){var l,i=e.data(this,"selectable-item");if(i)return l=!t.metaKey&&!t.ctrlKey||!i.$element.hasClass("ui-selected"),s._removeClass(i.$element,l?"ui-unselecting":"ui-selected")._addClass(i.$element,l?"ui-selecting":"ui-unselecting"),i.unselecting=!l,i.selecting=l,i.selected=l,l?s._trigger("selecting",t,{selecting:i.element}):s._trigger("unselecting",t,{unselecting:i.element}),!1})))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var s,l=this,i=this.options,n=this.opos[0],c=this.opos[1],a=t.pageX,o=t.pageY;return n>a&&(s=a,a=n,n=s),c>o&&(s=o,o=c,c=s),this.helper.css({left:n,top:c,width:a-n,height:o-c}),this.selectees.each((function(){var s=e.data(this,"selectable-item"),r=!1,u={};s&&s.element!==l.element[0]&&(u.left=s.left+l.elementPos.left,u.right=s.right+l.elementPos.left,u.top=s.top+l.elementPos.top,u.bottom=s.bottom+l.elementPos.top,"touch"===i.tolerance?r=!(u.left>a||u.right<n||u.top>o||u.bottom<c):"fit"===i.tolerance&&(r=u.left>n&&u.right<a&&u.top>c&&u.bottom<o),r?(s.selected&&(l._removeClass(s.$element,"ui-selected"),s.selected=!1),s.unselecting&&(l._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1),s.selecting||(l._addClass(s.$element,"ui-selecting"),s.selecting=!0,l._trigger("selecting",t,{selecting:s.element}))):(s.selecting&&((t.metaKey||t.ctrlKey)&&s.startselected?(l._removeClass(s.$element,"ui-selecting"),s.selecting=!1,l._addClass(s.$element,"ui-selected"),s.selected=!0):(l._removeClass(s.$element,"ui-selecting"),s.selecting=!1,s.startselected&&(l._addClass(s.$element,"ui-unselecting"),s.unselecting=!0),l._trigger("unselecting",t,{unselecting:s.element}))),s.selected&&(t.metaKey||t.ctrlKey||s.startselected||(l._removeClass(s.$element,"ui-selected"),s.selected=!1,l._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,l._trigger("unselecting",t,{unselecting:s.element})))))})),!1}},_mouseStop:function(t){var s=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each((function(){var l=e.data(this,"selectable-item");s._removeClass(l.$element,"ui-unselecting"),l.unselecting=!1,l.startselected=!1,s._trigger("unselected",t,{unselected:l.element})})),e(".ui-selecting",this.element[0]).each((function(){var l=e.data(this,"selectable-item");s._removeClass(l.$element,"ui-selecting")._addClass(l.$element,"ui-selected"),l.selecting=!1,l.selected=!0,l.startselected=!0,s._trigger("selected",t,{selected:l.element})})),this._trigger("stop",t),this.helper.remove(),!1}})})?l.apply(t,i):l)||(e.exports=n)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.selectable', location = 'aui.chunk.3c3c0ded6570de74c899--20e798ff6143721db0f5.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.selectable"],{FvNQ:function(u,i,n){"use strict";n.r(i);n("TRfs"),n("iCCw");i.default="jquery"}},[["FvNQ","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--d18e3cafa7","aui.splitchunk.vendors--db57146687","aui.splitchunk.vendors--7c76061134","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.vendors--fc45e4dda1', location = 'aui.chunk.010b2f3cfaf3d919be07--fdf37289c89f8086684d.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.vendors--fc45e4dda1"],{"FJx+":function(n,i,o){}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.sortable', location = 'aui.chunk.4f8d496ceb7b2e25abde--432a148153c8fbbd25cd.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.sortable"],{Ckgl:function(u,i,n){"use strict";n.r(i);n("FJx+"),n("xTPO");i.default="jquery"}},[["Ckgl","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--d18e3cafa7","aui.splitchunk.vendors--db57146687","aui.splitchunk.vendors--51504ebf10","aui.splitchunk.vendors--351ae504d7","aui.splitchunk.vendors--6ce18a1d80","aui.splitchunk.vendors--fc45e4dda1","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:common-resources', location = 'build/common.js' */
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=79)}({79:function(e,t,r){"use strict";r.r(t);r(80)},80:function(e,t,r){}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:multiple-pages-export-resources', location = 'build/multiple-pages-export.js' */
!function(t){function e(e){for(var a,o,l=e[0],s=e[1],c=e[2],h=0,p=[];h<l.length;h++)o=l[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);for(d&&d(e);p.length;)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,l=1;l<n.length;l++){var s=n[l];0!==r[s]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={24:0},i=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var l=window.webpackJsonpTFAC=window.webpackJsonpTFAC||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=s;i.push([84,0,1,2]),n()}({84:function(t,e,n){"use strict";n.r(e);var a=n(0),r={getExportHtml:function(t){if(t.hasClass("table-chart-contents")){var e=t.find("#pngdataurl").html(),n=r.getTablesHtml(t.find(".chart-body:not(.chart-hidden) table").not(".tablefilter-outer-wrapper table table").not(".pivot-content table table").not(".table-chart-contents table table").not(".original-table.pivot-hidden table").not(".tj-source.tj-hidden table"));return{id:t.data("id"),pageId:t.data("pageid"),html:e+n.join("")}}var a=t.find("table").not(".tablefilter-outer-wrapper table table").not(".pivot-content table table").not(".table-chart-contents table table").not(".table-joiner table table").not(".table-excerpt table table");if(t.hasClass("table-excerpt")||(a=a.not(".original-table.pivot-hidden table").not(".chart-body.chart-hidden table").not(".tj-source.tj-hidden table")),t.find(".filter-container").hasClass("filtered")||a.find(".tf-numbering").length||a.find(".tf-hidden-column").length||t.hasClass("pivot-content")||t.hasClass("table-excerpt")||t.find("th.tablesorter-headerAsc, th.tablesorter-headerDesc").length||t.find("tr.total-row").length||t.find("th.total-col").length||t.find("th.tf-sparkline-header").length||t.hasClass("table-joiner")){var i=r.getTablesHtml(a).join("<table-filter-splitter>");return{id:t.data("id"),pageId:t.data("pageid"),html:i}}},getTablesHtml:function(t){(t=t.clone()).each((function(){var t=$(this),e=t.find(".tableFloatingHeader");"none"==e.css("display")?e.remove():t.find(".tableFloatingHeaderOriginal").remove()})),t.find("a[href]").each((function(){$(this).attr("href",this.href)})),t.find(".tf-header-hidden").remove(),t.find(".resize-sensor").remove(),t.find(".refresh-action-group").remove(),t.find("tr").filter((function(){return"none"==$(this).css("display")})).remove(),t.find("td,th").filter((function(){var t=$(this);return"none"==t.css("display")||t.hasClass("tf-hidden-column")||t.hasClass("pivot-hidden-column")})).remove(),t.find(".pivot-null-value").remove(),t.removeClass("tablesorter tablesorter-default stickyTableHeaders"),t.removeAttributes(["class"]),t.children().removeAttributes().filter("thead").children("tr").removeAttributes().children().removeAttributes(["class","rowspan","colspan"]).removeClass("tablesorter-header sortableHeader tablesorter-headerUnSorted tablesorter-headerDesc tablesorter-headerAsc").children(".tablesorter-header-inner").replaceWith((function(){return this.innerHTML})),t.find("input.select2-input, input.select2-offscreen, input.handy-date-input").remove();var e=[];return t.each((function(){$(this);e.push($("<div/>").append(this).html())})),e}};AJS.toInit((function(){$('[name="inlinecommentform"]').one("click",(function(){$(".tf-form, .pivot-content form, .chart-wrapper form").attr("name","")})),$("#action-export-pdf-link, #action-export-word-link, #com-k15t-confluence-scroll-pdf-launcher, #com-k15t-confluence-scroll-office-launcher,#k15t-exp-pdf-export-dialog-web-item, #k15t-exp-word-export-dialog-web-item").unbind("click.tf").bind("click.tf",(function(){var t=[],e=[],n=[];$(".tablefilter-outer-wrapper, .pivot-content, .table-chart-contents, .table-excerpt, .table-joiner").filter((function(){return!$(this).parents(".original-table.pivot-hidden").length&&!$(this).parents(".table-chart-contents").length&&!$(this).parents(".tj-source.tj-hidden").length})).each((function(){var a=$(this),i=r.getExportHtml(a);i?(t.push(i.id),e.push(i.pageId),n.push(i.html)):(t.push(a.data("id")),e.push(a.data("pageid")),n.push(""))})),t.length&&$.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"POST",async:!1,cache:!1,url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/export",dataType:"json",data:{pageIds:e,ids:t,htmls:n}})}))})),jQuery.fn.removeAttributes=function(t){var e=t||[];return this.each((function(){for(var t=this.attributes.length-1;t>=0;t--){var n=this.attributes[t].name;-1===e.indexOf(n)&&this.attributes.removeNamedItem(n)}})),this};var i=r;!function(t){function e(t){return t.split("").reduce((function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t}),0)}AJS.toInit((function(){var n={};AJS.Meta.get("page-id")!==AJS.Meta.get("latest-page-id")||t("body.content-preview, body.page-gadget").length||t(".tablefilter-outer-wrapper, .pivot-content, .table-chart-contents, .table-joiner").filter((function(){var e=t(this);return e.hasClass("table-chart-contents")||!e.parents(".original-table").length&&!e.parents(".table-chart-contents").length&&!e.parents(".tablefilter-table-wrapper").length&&!e.parents(".table-joiner").length})).bind("tf-save tf-export-ready",(function(r,o){var l=t(this),s=l.attr("data-id");if("tf-save"===r.type||o.macroId===s){var c=a.a.getExcerptInclude(l,a.a.getExcerpt(l),"");if(a.a.hasLoadingContent(c))return;0===c.find(".filter-save, .chart-save, .pivot-save-changes").not(".tf-disabled-link").length&&(clearTimeout(n[s]),n[s]=setTimeout((function(){var n=i.getExportHtml(l),a=l.data("export-hash");if(n){var s=e(n.html);if(a!==s){if(o&&o.adaptiveDimensions&&a===(s=e(JSON.stringify(o.data)+JSON.stringify(o.params))))return;l.data("export-hash",s),t.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"POST",cache:!1,url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/export/multi-page",dataType:"json",data:{pageId:n.pageId,id:n.id,html:n.html,hash:s}})}}else("tf-save"===r.type||!n&&a)&&t.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"DELETE",cache:!1,url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/export/multi-page",dataType:"json",data:{pageId:l.data("pageid"),id:l.data("id")}})}),500))}}))}))}(AJS.$)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:3e47e85048b0f47d1719c4141a6d8d78', location = 'build/3e47e85048b0f47d1719.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[8],{31:function(e,n,t){"use strict";var a=t(0);$.fn.table2CSV=function(e){var n=[],t=e.headers.length,r=[];if(t>0)for(var i=0;i<t;i++)r[r.length]=s(e.headers[i]);return o(r),this.each((function(n){n&&o([" "]);var t=this.rows;if(t){var r=0===n?1:0;(t[0].classList.contains("tf-header-hidden")||$(this).children("thead.tableFloatingHeader").length)&&r++;for(var i=0;i<t.length;i++)if(0===t[i].children.length)r++;else if(i>=r&&"none"!==t[i].style.display){for(var l=[],h=t[i].children,f=0;f<h.length;f++){var c=$(h[f]);if("none"!==c.css("display")){var p=c[0].textContent;if(e.exportLinks){var u=c.find("a[href]");u.length&&u[0].href&&(p="=HYPERLINK("+e.quote+u[0].href+e.quote+e.linkSeparator+s(p)+")")}a.a.getTables(c,a.a.textType).forEach((function(n){var t=[].concat.apply([],n);p=p.replace(t.join(""),t.join(" "+e.linkSeparator))})),l[l.length]=s(a.a.clearString(p))}else(c.hasClass("fake")&&!c.hasClass("tf-hidden-column")&&!c.hasClass("pivot-hidden-column")||c.hasClass("pivot-export"))&&(l[l.length]="")}o(l)}}})),n.join("\n");function o(t){var a=t.join("");if(t.length>0&&""!==a){var r=t.join(e.separator);n[n.length]=r}}function s(n){var t=n.trim();return""==t?"":(t=t.replace(new RegExp(e.quote,"g"),e.quote+e.quote),e.quote+t+e.quote)}}},32:function(e,n,t){}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:77c937cae0a46a094417e0a29d65df51', location = 'build/77c937cae0a46a094417.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[5],{26:function(t,n,e){"use strict";var a=e(7);$.fn.wordExport=function(t){t=void 0!==t?t:"jQuery-Word-Export";var n={mhtml:{top:"Mime-Version: 1.0\nContent-Base: "+location.href+'\nContent-Type: Multipart/related; boundary="NEXT.ITEM-BOUNDARY";type="text/html"\n\n--NEXT.ITEM-BOUNDARY\nContent-Type: text/html; charset="utf-8"\nContent-Location: '+location.href+"\n\n<!DOCTYPE html>\n<html>\n_html_</html>",head:'<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8">\n<style>\n_styles_\n</style>\n</head>\n',body:"<body>_body_</body>"}},e=624,o=$(this).clone();o.each((function(){var t=$(this);t.is(":hidden")&&t.remove()}));for(var i=Array(),r=o.find("img"),h=0;h<r.length;h++){var d=Math.min(r[h].width,e),c=r[h].height*(d/r[h].width),s=document.createElement("CANVAS");s.width=d,s.height=c,s.getContext("2d").drawImage(r[h],0,0,d,c);var l="";try{l=s.toDataURL("image/png")}catch(t){}$(r[h]).attr("src",r[h].src),r[h].width=d,r[h].height=c,i[h]={type:l.substring(l.indexOf(":")+1,l.indexOf(";")),encoding:l.substring(l.indexOf(";")+1,l.indexOf(",")),location:$(r[h]).attr("src"),data:l.substring(l.indexOf(",")+1)}}var m="\n";for(h=0;h<i.length;h++)m+="--NEXT.ITEM-BOUNDARY\n",m+="Content-Location: "+i[h].location+"\n",m+="Content-Type: "+i[h].type+"\n",m+="Content-Transfer-Encoding: "+i[h].encoding+"\n\n",m+=i[h].data+"\n\n";m+="--NEXT.ITEM-BOUNDARY--";var p="";o.each((function(){p+=$(this).html()}));var f=n.mhtml.top.replace("_html_",n.mhtml.head.replace("_styles_","")+n.mhtml.body.replace("_body_",p))+m,y="application/msword;charset=utf-8";-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&(y="application/octet-stream");var g=new Blob([f],{type:y});Object(a.saveAs)(g,t+".doc")}}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:67923d669a977dbaff06438a5e6c6e9a', location = 'build/67923d669a977dbaff06.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[6],{28:function(t,e,s){var i=s(12);s(12);(function(){(function(){var t,e,s,n,r=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty;(n=function(){function t(){this.options_index=0,this.parsed=[]}return t.prototype.add_node=function(t,e){return"OPTGROUP"===t.nodeName.toUpperCase()?this.add_group(t):this.add_option(t,null,null,e)},t.prototype.add_group=function(t){var e,s,i,n,r,o;for(e=this.parsed.length,this.parsed.push({array_index:e,group:!0,label:t.label,title:t.title?t.title:void 0,children:0,disabled:t.disabled,classes:t.className}),o=[],s=0,i=(r=t.childNodes).length;s<i;s++)n=r[s],o.push(this.add_option(n,e,t.disabled));return o},t.prototype.add_option=function(t,e,s,i){if("OPTION"===t.nodeName.toUpperCase())return null!=e&&(this.parsed[e].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:t.value,text:t.text,html:i?t.text:t.innerHTML,title:t.title?t.title:void 0,selected:t.selected,disabled:!0===s?s:t.disabled,group_array_index:e,group_label:null!=e?this.parsed[e].label:null,classes:t.className,style:t.style.cssText}),this.options_index+=1},t}()).select_to_array=function(t,e){var s,i,r,o,h;for(o=new n,i=0,r=(h=t.childNodes).length;i<r;i++)s=h[i],o.add_node(s,e);return o.parsed},e=function(){function t(e,s){this.form_field=e,this.options=null!=s?s:{},this.label_click_handler=r(this.label_click_handler,this),t.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.on_ready())}return t.prototype.set_default_values=function(){return this.click_test_action=function(t){return function(e){return t.test_active_click(e)}}(this),this.activate_action=function(t){return function(e){return t.activate_field(e)}}(this),this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.is_rtl=this.options.rtl||/\bchosen-rtl\b/.test(this.form_field.className),this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text&&this.options.allow_single_deselect,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null==this.options.enable_split_word_search||this.options.enable_split_word_search,this.group_search=null==this.options.group_search||this.options.group_search,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null==this.options.single_backstroke_delete||this.options.single_backstroke_delete,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null==this.options.display_selected_options||this.options.display_selected_options,this.display_disabled_options=null==this.options.display_disabled_options||this.options.display_disabled_options,this.include_group_label_in_selected=this.options.include_group_label_in_selected||!1,this.max_shown_results=this.options.max_shown_results||Number.POSITIVE_INFINITY,this.case_sensitive_search=this.options.case_sensitive_search||!1,this.hide_results_on_select=null==this.options.hide_results_on_select||this.options.hide_results_on_select},t.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||t.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||t.default_single_text,this.default_text=this.escape_html(this.default_text),this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||t.default_no_result_text},t.prototype.choice_label=function(t){return this.include_group_label_in_selected&&null!=t.group_label?"<b class='group-name'>"+this.escape_html(t.group_label)+"</b>"+t.html:t.html},t.prototype.mouse_enter=function(){return this.mouse_on_container=!0},t.prototype.mouse_leave=function(){return this.mouse_on_container=!1},t.prototype.input_focus=function(t){if(this.is_multiple){if(!this.active_field)return setTimeout(function(t){return function(){return t.container_mousedown()}}(this),50)}else if(!this.active_field)return this.activate_field()},t.prototype.input_blur=function(t){if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(t){return function(){return t.blur_test()}}(this),100)},t.prototype.label_click_handler=function(t){return this.is_multiple?this.container_mousedown(t):this.activate_field()},t.prototype.results_option_build=function(t){var e,s,i,n,r,o,h;for(e="",h=0,n=0,r=(o=this.results_data).length;n<r&&("",""!==(i=(s=o[n]).group?this.result_add_group(s):this.result_add_option(s))&&(h++,e+=i),(null!=t?t.first:void 0)&&(s.selected&&this.is_multiple?this.choice_build(s):s.selected&&!this.is_multiple&&this.single_set_selected_text(this.choice_label(s))),!(h>=this.max_shown_results));n++);return e},t.prototype.result_add_option=function(t){var e,s;return t.search_match&&this.include_option_in_results(t)?(e=[],t.disabled||t.selected&&this.is_multiple||e.push("active-result"),!t.disabled||t.selected&&this.is_multiple||e.push("disabled-result"),t.selected&&e.push("result-selected"),null!=t.group_array_index&&e.push("group-option"),""!==t.classes&&e.push(t.classes),(s=document.createElement("li")).className=e.join(" "),t.style&&(s.style.cssText=t.style),s.setAttribute("data-option-array-index",t.array_index),s.innerHTML=t.highlighted_html||t.html,t.title&&(s.title=t.title),this.outerHTML(s)):""},t.prototype.result_add_group=function(t){var e,s;return(t.search_match||t.group_match)&&t.active_options>0?((e=[]).push("group-result"),t.classes&&e.push(t.classes),(s=document.createElement("li")).className=e.join(" "),s.innerHTML=t.highlighted_html||this.escape_html(t.label),t.title&&(s.title=t.title),this.outerHTML(s)):""},t.prototype.results_update_field=function(){if(this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing)return this.winnow_results()},t.prototype.reset_single_select_options=function(){var t,e,s,i,n;for(n=[],t=0,e=(s=this.results_data).length;t<e;t++)(i=s[t]).selected?n.push(i.selected=!1):n.push(void 0);return n},t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},t.prototype.results_search=function(t){return this.results_showing?this.winnow_results():this.results_show()},t.prototype.winnow_results=function(t){var e,s,i,n,r,o,h,l,c,_,a,u,d,p,f;for(this.no_results_clear(),_=0,e=(h=this.get_search_text()).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),c=this.get_search_regex(e),i=0,n=(l=this.results_data).length;i<n;i++)(r=l[i]).search_match=!1,a=null,u=null,r.highlighted_html="",this.include_option_in_results(r)&&(r.group&&(r.group_match=!1,r.active_options=0),null!=r.group_array_index&&this.results_data[r.group_array_index]&&(0===(a=this.results_data[r.group_array_index]).active_options&&a.search_match&&(_+=1),a.active_options+=1),f=r.group?r.label:r.text,r.group&&!this.group_search||(u=this.search_string_match(f,c),r.search_match=null!=u,r.search_match&&!r.group&&(_+=1),r.search_match?(h.length&&(d=u.index,o=f.slice(0,d),s=f.slice(d,d+h.length),p=f.slice(d+h.length),r.highlighted_html=this.escape_html(o)+"<em>"+this.escape_html(s)+"</em>"+this.escape_html(p)),null!=a&&(a.group_match=!0)):null!=r.group_array_index&&this.results_data[r.group_array_index].search_match&&(r.search_match=!0)));return this.result_clear_highlight(),_<1&&h.length?(this.update_results_content(""),this.no_results(h)):(this.update_results_content(this.results_option_build()),(null!=t?t.skip_highlight:void 0)?void 0:this.winnow_results_set_highlight())},t.prototype.get_search_regex=function(t){var e,s;return s=this.search_contains?t:"(^|\\s|\\b)"+t+"[^\\s]*",this.enable_split_word_search||this.search_contains||(s="^"+s),e=this.case_sensitive_search?"":"i",new RegExp(s,e)},t.prototype.search_string_match=function(t,e){var s;return s=e.exec(t),!this.search_contains&&(null!=s?s[1]:void 0)&&(s.index+=1),s},t.prototype.choices_count=function(){var t,e,s;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,t=0,e=(s=this.form_field.options).length;t<e;t++)s[t].selected&&(this.selected_option_count+=1);return this.selected_option_count},t.prototype.choices_click=function(t){if(t.preventDefault(),this.activate_field(),!this.results_showing&&!this.is_disabled)return this.results_show()},t.prototype.keydown_checker=function(t){var e,s;switch(s=null!=(e=t.which)?e:t.keyCode,this.search_field_scale(),8!==s&&this.pending_backstroke&&this.clear_backstroke(),s){case 8:this.backstroke_length=this.get_search_field_value().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(t),this.mouse_on_container=!1;break;case 13:this.results_showing&&(t.stopPropagation(),t.preventDefault());break;case 27:this.results_showing&&t.preventDefault();break;case 32:this.disable_search&&t.preventDefault();break;case 38:t.preventDefault(),this.keyup_arrow();break;case 40:t.preventDefault(),this.keydown_arrow()}},t.prototype.keyup_checker=function(t){var e,s;switch(s=null!=(e=t.which)?e:t.keyCode,this.search_field_scale(),s){case 8:this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0?this.keydown_backstroke():this.pending_backstroke||(this.result_clear_highlight(),this.results_search());break;case 13:t.preventDefault(),this.results_showing&&this.result_select(t);break;case 27:this.results_showing&&this.results_hide();break;case 9:case 16:case 17:case 18:case 38:case 40:case 91:break;default:this.results_search()}},t.prototype.clipboard_event_checker=function(t){if(!this.is_disabled)return setTimeout(function(t){return function(){return t.results_search()}}(this),50)},t.prototype.container_width=function(){return null!=this.options.width?this.options.width:this.form_field.offsetWidth+"px"},t.prototype.include_option_in_results=function(t){return!(this.is_multiple&&!this.display_selected_options&&t.selected||!this.display_disabled_options&&t.disabled||t.empty)},t.prototype.search_results_touchstart=function(t){return this.touch_started=!0,this.search_results_mouseover(t)},t.prototype.search_results_touchmove=function(t){return this.touch_started=!1,this.search_results_mouseout(t)},t.prototype.search_results_touchend=function(t){if(this.touch_started)return this.search_results_mouseup(t)},t.prototype.outerHTML=function(t){var e;return t.outerHTML?t.outerHTML:((e=document.createElement("div")).appendChild(t),e.innerHTML)},t.prototype.get_single_html=function(){return'<div class="chosen-single chosen-default">\n  <span>'+this.default_text+'</span>\n  <div><b></b></div>\n</div>\n<div class="chosen-drop">\n  <div class="chosen-search">\n    <input class="chosen-search-input" type="text" autocomplete="off" />\n  </div>\n  <ul class="chosen-results"></ul>\n</div>'},t.prototype.get_multi_html=function(){return'<ul class="chosen-choices">\n  <li class="search-field">\n    <input class="chosen-search-input" type="text" autocomplete="off" placeholder="'+this.default_text+'"/>\n  </li>\n</ul>\n<div class="chosen-drop">\n  <ul class="chosen-results"></ul>\n</div>'},t.prototype.get_no_results_html=function(t){return'<li class="no-results">\n  '+this.results_none_found+" <span>"+this.escape_html(t)+"</span>\n</li>"},t.browser_is_supported=function(){return"Microsoft Internet Explorer"!==window.navigator.appName||document.documentMode>=8},t.default_multiple_text="Select Some Options",t.default_single_text="Select an Option",t.default_no_result_text="No results match",t}(),(t=i).fn.extend({chosenTF:function(i){return e.browser_is_supported()?this.each((function(e){var n,r;r=(n=t(this)).data("chosen"),"destroy"!==i?r instanceof s||n.data("chosen",new s(this,i)):r instanceof s&&r.destroy()})):this}}),s=function(s){function i(){return i.__super__.constructor.apply(this,arguments)}return function(t,e){function s(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype}(i,e),i.prototype.setup=function(){return this.form_field_jq=t(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex},i.prototype.set_up_html=function(){var e,s;return(e=["chosen-container"]).push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&e.push(this.form_field.className),this.is_rtl&&e.push("chosen-rtl"),s={class:e.join(" "),title:this.form_field.title},this.form_field.id.length&&(s.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=t("<div />",s),this.container.width(this.container_width()),this.is_multiple?this.container.html(this.get_multi_html()):this.container.html(this.get_single_html()),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior()},i.prototype.on_ready=function(){return this.form_field_jq.trigger("chosen:ready",{chosen:this})},i.prototype.register_observers=function(){return this.container.on("touchstart.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.container.on("touchend.chosen",function(t){return function(e){t.container_mouseup(e)}}(this)),this.container.on("mousedown.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.container.on("mouseup.chosen",function(t){return function(e){t.container_mouseup(e)}}(this)),this.container.on("mouseenter.chosen",function(t){return function(e){t.mouse_enter(e)}}(this)),this.container.on("mouseleave.chosen",function(t){return function(e){t.mouse_leave(e)}}(this)),this.search_results.on("mouseup.chosen",function(t){return function(e){t.search_results_mouseup(e)}}(this)),this.search_results.on("mouseover.chosen",function(t){return function(e){t.search_results_mouseover(e)}}(this)),this.search_results.on("mouseout.chosen",function(t){return function(e){t.search_results_mouseout(e)}}(this)),this.search_results.on("mousewheel.chosen DOMMouseScroll.chosen",function(t){return function(e){t.search_results_mousewheel(e)}}(this)),this.search_results.on("touchstart.chosen",function(t){return function(e){t.search_results_touchstart(e)}}(this)),this.search_results.on("touchmove.chosen",function(t){return function(e){t.search_results_touchmove(e)}}(this)),this.search_results.on("touchend.chosen",function(t){return function(e){t.search_results_touchend(e)}}(this)),this.form_field_jq.on("chosen:updated.chosen",function(t){return function(e){t.results_update_field(e)}}(this)),this.form_field_jq.on("chosen:activate.chosen",function(t){return function(e){t.activate_field(e)}}(this)),this.form_field_jq.on("chosen:open.chosen",function(t){return function(e){t.container_mousedown(e)}}(this)),this.form_field_jq.on("chosen:close.chosen",function(t){return function(e){t.close_field(e)}}(this)),this.search_field.on("blur.chosen",function(t){return function(e){t.input_blur(e)}}(this)),this.search_field.on("keyup.chosen",function(t){return function(e){t.keyup_checker(e)}}(this)),this.search_field.on("keydown.chosen",function(t){return function(e){t.keydown_checker(e)}}(this)),this.search_field.on("focus.chosen",function(t){return function(e){t.input_focus(e)}}(this)),this.search_field.on("cut.chosen",function(t){return function(e){t.clipboard_event_checker(e)}}(this)),this.search_field.on("paste.chosen",function(t){return function(e){t.clipboard_event_checker(e)}}(this)),this.is_multiple?this.search_choices.on("click.chosen",function(t){return function(e){t.choices_click(e)}}(this)):this.container.on("click.chosen",(function(t){t.preventDefault()}))},i.prototype.destroy=function(){return t(this.container[0].ownerDocument).off("click.chosen",this.click_test_action),this.form_field_label.length>0&&this.form_field_label.off("click.chosen"),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},i.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field.disabled||this.form_field_jq.parents("fieldset").is(":disabled"),this.container.toggleClass("chosen-disabled",this.is_disabled),this.search_field[0].disabled=this.is_disabled,this.is_multiple||this.selected_item.off("focus.chosen",this.activate_field),this.is_disabled?this.close_field():this.is_multiple?void 0:this.selected_item.on("focus.chosen",this.activate_field)},i.prototype.container_mousedown=function(e){var s;if(!this.is_disabled)return!e||"mousedown"!==(s=e.type)&&"touchstart"!==s||this.results_showing||e.preventDefault(),null!=e&&t(e.target).hasClass("search-choice-close")?void 0:(this.active_field?this.is_multiple||!e||t(e.target)[0]!==this.selected_item[0]&&!t(e.target).parents("div.chosen-single").length||(e.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),t(this.container[0].ownerDocument).on("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},i.prototype.container_mouseup=function(t){if("ABBR"===t.target.nodeName&&!this.is_disabled)return this.results_reset(t)},i.prototype.search_results_mousewheel=function(t){var e;if(t.originalEvent&&(e=t.originalEvent.deltaY||-t.originalEvent.wheelDelta||t.originalEvent.detail),null!=e)return t.preventDefault(),"DOMMouseScroll"===t.type&&(e*=40),this.search_results.scrollTop(e+this.search_results.scrollTop())},i.prototype.blur_test=function(t){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field()},i.prototype.close_field=function(){return t(this.container[0].ownerDocument).off("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale(),this.search_field.blur()},i.prototype.activate_field=function(){if(!this.is_disabled)return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},i.prototype.test_active_click=function(e){var s;return(s=t(e.target).closest(".chosen-container")).length&&this.container[0]===s[0]?this.active_field=!0:this.close_field()},i.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=n.select_to_array(this.form_field,this.options.isHtml),this.is_multiple?this.search_choices.find("li.search-choice").remove():(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},i.prototype.result_do_highlight=function(t){var e,s,i,n,r;if(t.length){if(this.result_clear_highlight(),this.result_highlight=t,this.result_highlight.addClass("highlighted"),n=(i=parseInt(this.search_results.css("maxHeight"),10))+(r=this.search_results.scrollTop()),(e=(s=this.result_highlight.position().top+this.search_results.scrollTop())+this.result_highlight.outerHeight())>=n)return this.search_results.scrollTop(e-i>0?e-i:0);if(s<r)return this.search_results.scrollTop(s)}},i.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},i.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.get_search_field_value()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},i.prototype.update_results_content=function(t){return this.search_results.html(t)},i.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},i.prototype.set_tab_index=function(t){var e;if(this.form_field.tabIndex)return e=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=e},i.prototype.set_label_behavior=function(){if(this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=t("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0)return this.form_field_label.on("click.chosen",this.label_click_handler)},i.prototype.show_search_field_default=function(){return this.search_field.val(""),this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.attr("placeholder",this.default_text),this.search_field.addClass("default")):(this.search_field.attr("placeholder",""),this.search_field.removeClass("default"))},i.prototype.search_results_mouseup=function(e){var s;if((s=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first()).length)return this.result_highlight=s,this.result_select(e),this.search_field.focus()},i.prototype.search_results_mouseover=function(e){var s;if(s=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first())return this.result_do_highlight(s)},i.prototype.search_results_mouseout=function(e){if(t(e.target).hasClass("active-result")||t(e.target).parents(".active-result").first())return this.result_clear_highlight()},i.prototype.choice_build=function(e){var s,i;return(s=t("<li />",{class:"search-choice"}).html("<span>"+this.choice_label(e)+"</span>")).css("max-width",this.container.width()>100?this.container.width()-40:""),e.disabled?s.addClass("search-choice-disabled"):((i=t("<span />",{class:"search-choice-close","data-option-array-index":e.array_index})).on("click.chosen",function(t){return function(e){return t.choice_destroy_link_click(e)}}(this)),s.append(i)),this.search_container.before(s)},i.prototype.choice_destroy_link_click=function(e){if(e.preventDefault(),e.stopPropagation(),!this.is_disabled)return this.choice_destroy(t(e.target))},i.prototype.choice_destroy=function(t){if(0===t.length&&(t=this.pending_backstroke.find(".search-choice-close")),this.result_deselect(t[0].getAttribute("data-option-array-index")))return this.active_field?this.search_field.focus():this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.get_search_field_value().length<1&&this.results_hide(),t.parents("li").first().remove(),this.search_field_scale()},i.prototype.results_reset=function(){if(this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.trigger_form_field_change(),this.active_field)return this.results_hide()},i.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},i.prototype.result_select=function(t){var e,s,i,n;if(this.result_highlight)return s=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?s.removeClass("active-result"):this.reset_single_select_options(),s.addClass("result-selected"),(i=this.results_data[s[0].getAttribute("data-option-array-index")]).selected=!0,this.form_field.options[i.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(i):this.single_set_selected_text(this.choice_label(i)),this.is_multiple&&(!this.hide_results_on_select||t.metaKey||t.ctrlKey)?t.metaKey||t.ctrlKey?this.winnow_results({skip_highlight:!0}):(this.search_field.val(""),this.winnow_results()):(this.results_hide(),this.show_search_field_default()),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.trigger_form_field_change({selected:this.form_field.options[i.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,t.preventDefault(),this.search_field_scale());this.options.addUserOption&&(n=this.search_field.val(),e=!1,this.results_data.some((function(t){if(t.text===n)return e=!0,!0})),e||this.form_field_jq.append('<option value="'+n+'" selected="selected">'+n+"</option>").trigger("change",{selected:n}).trigger("chosen:updated"))},i.prototype.single_set_selected_text=function(t){return null==t&&(t=this.default_text),t===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").html(t)},i.prototype.result_deselect=function(t){var e;return e=this.results_data[t],!this.form_field.options[e.options_index].disabled&&(e.selected=!1,this.form_field.options[e.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.trigger_form_field_change({deselected:this.form_field.options[e.options_index].value}),this.search_field_scale(),!0)},i.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect)return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")},i.prototype.get_search_field_value=function(){return this.search_field.val()},i.prototype.get_search_text=function(){return t.trim(this.get_search_field_value())},i.prototype.escape_html=function(e){return t("<div/>").text(e).html()},i.prototype.winnow_results_set_highlight=function(){var t,e;if(null!=(t=(e=this.is_multiple?[]:this.search_results.find(".result-selected.active-result")).length?e.first():this.search_results.find(".active-result").first()))return this.result_do_highlight(t)},i.prototype.no_results=function(e){var s,i;return s=t(this.get_no_results_html(e)),this.search_results.append(s),this.options.addUserOption&&(i=this,s.addClass("add-user-option").click((function(){i.result_select()}))),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},i.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},i.prototype.keydown_arrow=function(){var t;return this.results_showing&&this.result_highlight?(t=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(t):void 0:this.results_show()},i.prototype.keyup_arrow=function(){var t;return this.results_showing||this.is_multiple?this.result_highlight?(t=this.result_highlight.prevAll("li.active-result")).length?this.result_do_highlight(t.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight()):void 0:this.results_show()},i.prototype.keydown_backstroke=function(){var t;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(t=this.search_container.siblings("li.search-choice").last()).length&&!t.hasClass("search-choice-disabled")?(this.pending_backstroke=t,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0},i.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},i.prototype.search_field_scale=function(){var e,s,i,n,r,o,h;if(this.is_multiple){for(r={position:"absolute",left:"-1000px",top:"-1000px",display:"none",whiteSpace:"pre"},s=0,i=(o=["fontSize","fontStyle","fontWeight","fontFamily","lineHeight","textTransform","letterSpacing"]).length;s<i;s++)r[n=o[s]]=this.search_field.css(n);return(e=t("<div />").css(r)).text(this.search_field.attr("placeholder")||this.get_search_field_value()),t("body").append(e),h=e.width()+25,e.remove(),this.container.is(":visible")&&(h=Math.min(this.container.outerWidth()-10,h)),this.search_field.width(h)}},i.prototype.trigger_form_field_change=function(t){return this.form_field_jq.trigger("input",t),this.form_field_jq.trigger("change",t)},i}()}).call(this)}).call(window)},29:function(t,e,s){}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:c553b07ba4b0fbd3aa5ad4074a7acb3b', location = 'build/c553b07ba4b0fbd3aa5a.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[7],{10:function(e,t,a){"use strict";a(59);var l=a(7),i=a(23),r=a(8),s=a.n(r),o=a(0),n=a(2),c=a(13),d=a.n(c);a(60);function p(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=function(e){var t=this;if(t.editorMacro=e.editorMacro,t.macroParams=e.macroParams,t.pageId=e.pageId,t.macroId=e.id,t.showNRows=e.showNRows,t.numbering=!!e.numbering&&e.numbering.toLocaleLowerCase(),t.dateFormat=(e.datepattern||"yy-mm-dd").replace("yyyy","yy"),t.localeDateFormat=o.a.getLocaleDateFormat(t.dateFormat),t.separator=e.separator,t.fixedRows="true"==e.limitHeight?1:e.limitHeight,t.fixedCols=e.fixedCols,t.heightValue=!!e.heightValue&&parseInt(e.heightValue),t.sorts=e.sorts,t.totalRow=e.totalrow?e.totalrow.split(","):[],t.totalCol=e.totalcol,t.cbState=null,t.tdNumbers=null,t.tables=null,t.rows=null,t.outerWrapper=$('.tablefilter-outer-wrapper[data-id="'+t.macroId+'"][data-pageid="'+t.pageId+'"][data-sessionid="'+e.sessionId+'"]'),t.tableWrapper=t.editorMacro?t.editorMacro.find(".tablefilter-table-wrapper"):t.outerWrapper.find("div#tf-table-"+t.macroId),t.tableWrapper=o.a.addExcerpt(t.tableWrapper,"tablefilter-table-wrapper"),t.tableWrapper=o.a.addIframe(t.tableWrapper,"tablefilter-table-wrapper",(function(e){t.tableWrapper=e,t.getTable(),t.addNumbering(),t.setFiltrationPanel(),t.tableUpdated=!0,t.filterTable()})),t.comboBoxDiv=t.outerWrapper.find("#comboBoxDiv-"+t.macroId),t.lockDisabled=t.comboBoxDiv.find("div.lockDisabled"),t.lockEnabled=t.comboBoxDiv.find("div.lockEnabled"),t.showBtn=t.outerWrapper.children(".tf-shower-wrapper").find(".tf-shower"),t.rawTables=null,t.columns=null,t.locale=o.a.getLocale(),t.hideParamName=t.pageId+"_"+t.macroId+"_hidden",t.menu=t.comboBoxDiv.find("#filter-menu-view-"+t.macroId+"-"+t.pageId+",#filter-menu-view-lock-"+t.macroId+"-"+t.pageId),t.saveBtn=t.menu.find(".filter-save").not("body.content-preview .filter-save"),t.resetSortBtn=t.menu.find(".filter-sort-reset"),t.isLockEnabled=e.isLockEnabled,t.tabs=e.tabs,t.worklog=o.a.getWorklog(e.worklog),t.sparkline=e.sparkline,t.sparkName="$sparkName"==e.sparkName?"":e.sparkName,t.isAND="OR"!=e.isOR,t.ddSeparator=e.ddSeparator,t.totalRows=[],t.tableUpdated=!0,t.outerWrapper.data("tf",t),t.shouldUpdateSelectOptions=e.updateSelectOptions,t.totalColName=e.totalColName,t.totalRowName=e.totalRowName,t.formatDecimal=s()({mark:t.separator,thousand:e.thousandSeparator!==t.separator?e.thousandSeparator:" "}),t.spakLinesFinished=!0,t.isCloud=t.outerWrapper.hasClass("tf-cloud-macro"),0==t.tableWrapper.length)return null;t.fixURIHash(),t.orderFilters(e.order),t.getTable(),t.sortTable(),t.addNumbering(),t.appendTotalCol(),t.createSelects(t.comboBoxDiv),t.createDatePickers(t.comboBoxDiv),t.bindInputs(),t.bindReset(),t.bindDisable(),t.bindDOMChange(),t.bindInnerFiltration(),t.bindHideBtn(),t.bindAddFilter(),t.bindChangeSettings(),t.bindSave(),t.bindExport(),t.bindSortReset(),t.bindCopyUrl(),t.bindGetUrlValues(),t.bindMakeInverse(),t.bindChangeLabel(),t.setFiltrationPanel(),t.makeSortable(),t.makeResizable(t.comboBoxDiv),t.filterTable(),t.makeTablesScrollable(),!t.editorMacro&&window.KarmaUser&&t.tables.find("a[data-username]").length&&setTimeout((function(){t.setFiltrationPanel(),t.filterTable()}),1e3)};function u(e){void 0!==this.total?this.total=o.a.multFloats(e,this.total):this.total=e}function b(e){this.total?this.total=o.a.addFloats(e,this.total):this.total=e}function h(e){null!=this.sum?(this.sum=o.a.addFloats(e,this.sum),this.count++):(this.sum=e,this.count=1),this.total=this.sum/this.count}function m(e){null!=this.total?this.total=Math.min(e,this.total):this.total=e}function v(e){null!=this.total?this.total=Math.max(e,this.total):this.total=e}function g(){null!=this.total?this.total++:this.total=1}function w(e){var t=2,a=Math.abs(e);a<1&&a>0&&(t=Math.ceil(Math.log(a)/Math.LN10*-1)+2);var l=Math.pow(10,t);return Math.round(e*l)/l}function y(e){return e.hasClass("selectfilter-element")?"Dropdown Filter":e.hasClass("userfilter-element")?"Free Text Filter":e.hasClass("numberfilter-element")?"Number Filter":e.hasClass("datefilter-element")?"Date Filter":e.hasClass("iconfilter-element")?"Icon Filter":e.hasClass("globalfilter-element")?"Global Filter":e.hasClass("columnhider-element")?"Hide Columns":void 0}f.prototype.orderFilters=function(e){if(e){var t=this.comboBoxDiv.find(".sortable-container");t.append(t.find(".iconfilter-element"));for(var a=t.find(".filter-container"),l=e.split(","),i=0;i<l.length;i++)t.append(a.eq($.inArray(i.toString(),l)))}},f.prototype.sortTable=function(){var e=this;function t(){e.sortOneTable($(this))}e.tables.bind("tablesorter-initialized.tf",(function(){var t=$(this),a=o.a.getTablesorterDateFormat(e.dateFormat);a&&t.find("thead th").addClass("dateFormat-"+a),t.append(t.children("div.resize-sensor"))})),e.sorts.length&&(e.tables.filter(".pivot-table-result").one("pivot-sorted",t),e.tables.not(".pivot-table-result").one("tablesorter-initialized.tf",t),e.tables.filter(".tablesorter").each(t))},f.prototype.sortTables=function(){var e=this;e.tables.each((function(){e.sortOneTable($(this))}))},f.prototype.sortOneTable=function(e){var t=this;if(t.sorts.length){var a=[];if($.each(t.sorts,(function(l,i){var r=-1===(i=i.replace(" (‍Asc)"," ⇧").replace(" (‍Desc)"," ⇩")).indexOf("⇧")?1:0,s=i.replace("⇧","").replace("⇩","").trim();o.a.getColumnPositions(t.rows[t.tables.index(e)],s).forEach((function(e){a.push([e,r])}))})),0===a.length)return void t.prepareExport(!0);t.sortWait=!0,t.resorting=!0,t.setMutationObserver(),e.hasClass("pivot-table-result")||t.updateSorter(e),t.restoreNumbering=!0,e.trigger("sorton",[a]),t.resorting=!1,t.resetSortBtn.addClass("tf-disabled-link"),t.setMutationObserver()}},f.prototype.normalizeTable=function(){var e=this;e.pauseUpdate=!0,e.setMutationObserver(!0),o.a.normalizeTable(e.tables),e.pauseUpdate=!1,e.setMutationObserver(!0),o.a.processMergedCells(e.tables.not(".pivot-table-result"))},f.prototype.addNumbering=function(){var e=this;o.a.hasLoadingContent(e.tableWrapper)||(e.numbering?(e.pauseUpdate=!0,e.setMutationObserver(),e.tables.each((function(t){var a=$(this),l=a.find("tr.pivot-header:eq(0)");0==l.find(".tf-numbering").length&&l.prepend('<th class="confluenceTh tf-numbering" rowspan="2"/>');var i,r=e.rows[t];0==a.find("colgroup col.tfn").length&&(i=a.hasClass("relative-table")?"0.1%":29+8*((""+r.length).length-1)+"px",a.find("colgroup").prepend('<col class="tfn synchrony-exclude" style="width: '+i+'"> '));r.each((function(a){for(var l=$(this),i=this.children,s=null,n=null,c=0;c<i.length;c++)if(!i[c].classList.contains("fake")){s=$(i[c]);break}i[0].classList.contains("tf-numbering")&&(n=$(i[0]));var d=s.attr("class");if(0===a)n?n.attr("contenteditable",!1):("th"===s.prop("tagName").toLowerCase()?l.prepend('<th class="'+d+' tf-numbering synchrony-exclude" contenteditable="false"/>'):l.prepend('<td class="'+d+' tf-numbering synchrony-exclude" contenteditable="false"/>'),e.rawTables[t][a].unshift(""),e.columns=o.a.getColumns(e.rawTables),e.rawIconTables&&e.rawIconTables[t][a].unshift(""));else{var p=-1!==e.numbering.indexOf("desc")?r.length-a:a;n?(n.attr("contenteditable",!1).html("<span>"+p+"</span>"),e.rawTables[t][a][0]=""+p):(l.prepend('<td class="'+d+' tf-numbering synchrony-exclude" contenteditable="false"><span>'+p+"</span></td>"),e.rawTables[t][a].unshift(""+p),e.rawIconTables&&e.rawIconTables[t][a].unshift(""))}})),e.updateSorter(a,!0),a.hasClass("metadata-summary-macro")&&e.tableWrapper.find("ol.aui-nav").eq(t).find("li a[href]").one("mouseup",(function(){e.pauseUpdate=!0,a.find(".tf-numbering").remove(),a[0].config&&a[0].config.headerContent&&a[0].config.headerContent.splice(0,1),a.trigger("updateAll",!1),e.pauseUpdate=!1}))})),e.pauseUpdate=!1,e.setMutationObserver()):(e.tables.find(".tf-numbering").remove(),e.tables.find("colgroup col.tfn").remove()))},f.prototype.updateSorter=function(e,t){var a=this;if(e.hasClass("appfire-table-plus-parms")){if(t&&!a.appFireUpdated&&org_swift_TableSorter&&getTableParms){a.appFireUpdated=!0;var l=new org_swift_TableSorter,i=getTableParms(e);l.customizeMacroTable(e,i.tableParms,i.columnAttributes)}}else if(e.trigger("update",!1),!a.resorting){var r=$.tablesorter||$.tablesorterEditor,s=r.restoreHeaders;r.restoreHeaders=function(){},e.trigger("updateAll",!1),e.one("updateComplete",(function(){r.restoreHeaders=s})),setTimeout((function(){r.restoreHeaders=s}),2e3)}},f.prototype.createSelects=function(e){var t=this;e.find("select").change((function(e,a){var l=$(this);a.selected?l.find("option").filter((function(){return this.textContent===a.selected})).prop("selected",!0):a.deselected&&l.find("option").filter((function(){return this.textContent===a.deselected})).prop("selected",!1),t.comboBoxDiv.find(".search-choice").filter((function(){return o.a.clearString(this.textContent)==="-Empty-"})).addClass("tf-empty-option"),t.enableSaveBtn(),t.filterTable(l)})).each((function(){var e=$(this);e.chosenTF({no_results_text:"No matches found. Press \u0027Enter\u0027 to add",placeholder_text_multiple:e.is(".icon-select")?"Select items...":"Click and start typing...",display_selected_options:!1,width:e.data("width"),addUserOption:!0,isHtml:e.data("html")})}))},f.prototype.createDatePickers=function(e){var t=this;AJS.DatePicker.prototype.localisations||(AJS.DatePicker.prototype.localisations=[]),t.datePickerOptions={overrideBrowserDefault:!0,languageCode:t.locale},e.find("input.date").each((function(){var e=$(this),a=t.getDateFormat(e),l=a.dateFormat,i=a.locale;o.a.initDatePickerLocalisations(i),t.initDatePicker(e,l,i);var r=e.val();e.val(o.a.convertToDate(r,l,i))}))},f.prototype.bindInputs=function(){var e=this,t=[];e.comboBoxDiv.delegate("input.user-filter, input.global-filter, input.date, input.number","input keyup",(function(){var a=$(this);clearTimeout(t[a]),t[a]=setTimeout((function(){e.enableSaveBtn(),e.filterTable(a)}),330)})),e.comboBoxDiv.delegate("input.date","change",(function(){e.enableSaveBtn(),e.filterTable($(this))}))},f.prototype.bindReset=function(){var e=this;e.comboBoxDiv.find(".filter-reset").click((function(){return $("body").trigger("filter-options-disable-and-reset",{type:"Reset Filters",pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View"}),e.clearFilters(),e.filterTable(),!1}))},f.prototype.clearFilters=function(){var e=this;e.comboBoxDiv.find("input.user-filter, input.global-filter, input.date, input.number").val("");var t=e.comboBoxDiv.find("select");t.find("option:selected").removeAttr("selected"),t.trigger("chosen:updated"),e.enableSaveBtn()},f.prototype.bindDisable=function(){var e=this,t=e.lockEnabled.show().width()+2;e.lockEnabled.hide(),e.comboBoxDiv.find("div.lockDisabled.not-empty").css("min-width",t>270?t:"270px"),e.lockDisabled.find(".disableLock").click((function(){return $("body").trigger("filter-options-disable-and-reset",{type:"Disable All Filters",pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View"}),e.editorMacro||e.lockEnabled.width(e.lockDisabled.width()),e.lockEnabled.height(e.lockDisabled.height()),e.lockDisabled.hide(),e.lockEnabled.show(),e.isLockEnabled=!0,e.showTableWithoutFilters(),!1})),e.lockEnabled.find(".enableLock").click((function(){return e.editorMacro||e.lockEnabled.width(""),e.lockDisabled.show(),e.lockEnabled.hide(),e.isLockEnabled=!1,e.filterTable(),!1}))},f.prototype.bindDOMChange=function(){var e=this,t=null,a=null;if(e.editorMacro){var l,i=!1,r=e.tableWrapper.html(),s=!1,n=function(t,l){if(t.is("td")||t.is("th")||(t=t.parents("td, th").eq(0)),(parseInt(t.attr("rowspan"))>1||parseInt(t.attr("colspan"))>1)&&(e.normalizeTable(),e.showOrHideTables()),t.hasClass("tablesorter-header"))e.comboBoxDiv.find("[name]").filterByAttr("name",a).attr("name",l).each((function(){var e=$(this).parents(".filter-container:eq(0)").find("label .tf-label-name");e.text(e.text().replace(a,l))})),e.updateRawTables(!0);else{if(t.length){var i=t[0].parentNode,r=e.tables.index($(i).parents("table").eq(0));if(r>=0){var s=e.rawTables[r][i.rowIndex];s&&(s[t[0].cellIndex]=t.text())}}else e.updateRawTables();e.appendTotalRow(),e.appendTotalCol()||(e.tables.trigger("update",!1),e.updateRawTables()),e.appendSparklines(),e.sparkline&&e.fixedRows>0&&e.updateFixedCells()}a=null,e.setFiltrationPanel()},c=function(a,o){if(!(i||e.pauseUpdate||e.sorting||e.resorting||e.editorSave||a.is("br")||a.hasClass("tablesorter-savemyplace")))if(a.is(".tf-numbering")){var c=Confluence.MacroParameterSerializer.deserialize(e.editorMacro.attr("data-macro-parameters"));e.numbering=c.numbering?c.numbering:""}else{if(a.hasClass("fake")){if(a.attr("colspan")||a.attr("rowspan"))return;a.removeClass("fake synchrony-exclude"),a.removeClass(a.getClassStartsWith(/tf-colspan-\d+/)),a.removeClass(a.getClassStartsWith(/tf-rowspan-\d+/)),a.css("display","")}clearTimeout(t);var d=l&&!l.is("td"),p=function(){if(l=null,"DOMNodeInserted"!==o||a.is("table")||0!==a.parents(".confluenceTable").length){var t=e.tableWrapper.html();if(t!=r)if(r=t,a.is("tr")||a.is("td")||a.is("th")||a.is("table")||s)s=!1,i=!0,e.getTable(),e.addNumbering(),e.setFiltrationPanel(),e.filterTable(),a.is("tr")&&a.show(),a.find("tr").show(),!d&&a.is("td")||a.parents("tr").show(),e.tables.not(".tablesorter").tablesorterEditor({cancelSelection:!1,dateFormat:e.dateFormat,locale:e.localeDateFormat}),a.is(".tablesorter-header")&&a.parents("table").eq(0).tablesorterEditor({cancelSelection:!1,dateFormat:e.dateFormat,locale:e.localeDateFormat}),e.appendTotalRow(),e.appendTotalCol()||e.tables.trigger("update",!1),e.appendSparklines(),a.is("table")?e.makeTablesScrollable():(e.sparkline&&e.fixedRows>0||a.is("th")||a.is("td")||a.is("tr"))&&e.updateFixedCells(),i=!1;else n(a,a.text())}};a.is("table")?p():((a.is("tr")||a.hasClass("numberingColumn"))&&(s=!0),t=setTimeout(p,500)),l=a}},d=function(l,i,s){e.editorSave||e.sorting||e.resorting||(clearTimeout(t),null==a&&(a=i),t=setTimeout((function(){r=e.tableWrapper.html(),n(l,s)}),500))};window.MutationObserver?(e.observerCallback=function(e){e.forEach((function(e){if(e.addedNodes.length)c($(e.addedNodes),"DOMNodeInserted");else if(e.removedNodes.length)c($(e.removedNodes),"DOMNodeRemoved");else if("characterData"==e.type){var t=$(e.target);d(t,e.oldValue,t.text())}}))},e.observer=new MutationObserver(e.observerCallback),e.observerParams={childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0},e.observer.observe(e.tableWrapper[0],e.observerParams),e.tableWrapper.find("td").each((function(){var e=new MutationObserver((function(t){t.forEach((function(t){var a=$(t.target),l=a.hasClass("tf-hidden-column");!l&&o.a.isRowVisible(a.parent()[0])||(e.disconnect(),a.attr(t.attributeName,t.oldValue),l?a.addClass("tf-hidden-column"):a.removeClass("tf-hidden-column"),e.observe(a[0],{attributes:!0,attributeOldValue:!0,attributeFilter:["class","data-highlight-colour"]}))}))}));e.observe(this,{attributes:!0,attributeOldValue:!0,attributeFilter:["class","data-highlight-colour"]})}))):e.tableWrapper.unbind("DOMNodeInserted.tf DOMNodeRemoved.tf").bind("DOMNodeInserted.tf DOMNodeRemoved.tf",(function(e){c($(e.target),e.type)})).unbind("DOMCharacterDataModified.tf").bind("DOMCharacterDataModified.tf",(function(e){d($(e.target),e.originalEvent.prevValue,e.originalEvent.newValue)}))}else{c=function(a,l){return!!(e.sorting||e.resorting||e.pauseUpdate)||(!!o.a.isIgnoreUpdateNode(a)||(l&&l.id=="tf-table-"+e.macroId||o.a.hasTableForUpdate(a)?(clearTimeout(t),t=setTimeout((function(){e.getTable(),e.addNumbering(),setTimeout((function(){e.sortTables(),e.setFiltrationPanel(),e.tableUpdated=!0,e.filterTable(),(e.fixedRows||e.fixedCols)&&e.makeTablesScrollable()}),1e3)}),50),!0):o.a.hasRowForUpdate(a)?(clearTimeout(t),t=setTimeout((function(){e.getTable(),e.addNumbering(),e.setFiltrationPanel(),e.sortTables(),e.tableUpdated=!0,e.filterTable(),(e.fixedRows||e.fixedCols)&&e.updateFixedCells()}),10),!0):o.a.hasCharsForUpdate(a,l)?(clearTimeout(t),t=setTimeout((function(){e.updateRawTables(),e.setFiltrationPanel(),e.filterTable()}),10),!0):void 0))};window.MutationObserver?(e.observerCallback=function(e){e.some((function(e){if(e.addedNodes.length)return c($(e.addedNodes),e.target)}))},e.observer=new MutationObserver(e.observerCallback),e.observerParams={childList:!0,subtree:!0},e.tableWrapper.each((function(){e.observer.observe(this,e.observerParams)}))):e.tableWrapper.bind("DOMNodeInserted",(function(e){c($(e.target),e.originalEvent.relatedNode)})),e.tableWrapper.bind("DOMCharacterDataModified changed.chk",(function(){clearTimeout(t),t=setTimeout((function(){e.updateRawTables(!0),e.setFiltrationPanel()}),50)})),e.tabs&&o.a.onTabChange(e.tableWrapper,(function(){e.getTable(),e.addNumbering(),e.setFiltrationPanel(),e.sortTables(),e.tableUpdated=!0,e.filterTable(),(e.fixedRows||e.fixedCols)&&e.updateFixedCells()})),e.tableWrapper.bind("tf-save",(function(){return e.outerWrapper.trigger("tf-save"),!1}))}},f.prototype.setMutationObserver=function(e){var t=this;if(t.observer)if(t.sorting||t.resorting||t.pauseUpdate)e||(t.prevRowsLength=0,t.rows.forEach((function(e){t.prevRowsLength+=e.length}))),t.observerCallback(t.observer.takeRecords()),t.observer.disconnect();else{if(!e){if(t.observerRestoring)return;t.observerRestoring=!0,t.getTable(!0);var a=0;t.rows.forEach((function(e){a+=e.length})),null!=t.prevRowsLength&&a!=t.prevRowsLength&&(t.prevRowsLength=a,t.tableUpdated=!0,t.setFiltrationPanel(),t.filterTable()),t.observerRestoring=!1}t.tableWrapper.each((function(){t.observer.observe(this,t.observerParams)}))}},f.prototype.processInnerFiltration=function(e,t){var a=!1;return e&&e.tf&&(e.tf.blockEvent=!0,e.tf.filterTable(),e.tf.pauseUpdate=!0,e.tf.setMutationObserver(!0),e.tf.tables.each((function(t){var l=e.tf.tables.eq(t);if(e.tf.rows[t].each((function(l){var i=$(this);if(l>e.tf.headerSize[t]&&(e.tf.cbState[t][l-1]||(i.remove(),a=!0)),e.tf.tdNumbers[t].length){var r=i.children("td,th");$.each(e.tf.tdNumbers[t],(function(e,t){r.eq(t).remove(),a=!0}))}})),e.tf.tdNumbers[t].length){var i=l.hasClass("relative-table"),r=0,s=$(this).children("colgroup").find("col");$.each(e.tf.tdNumbers[t],(function(e,t){s.eq(t).remove(),i&&"none"!==s[t].style.display&&(r+=parseFloat(s[t].style.width))})),r>0&&(l.css("width",parseFloat(l[0].style.width)*(1-r/100)+"%"),s.each((function(a){-1===e.tf.tdNumbers[t].indexOf(a)&&(this.style.width=parseFloat(this.style.width)/(1-r/100)+"%")})))}}))),a&&(e.tf.tables.find(".fake").each((function(){var e=$(this);"none"!==e.css("display")&&e.removeClass("fake")})),o.a.processMergedCells(e.tf.tables,!0)),t&&e&&e.tf&&this.filterTable(),e&&e.tf&&(e.tf.pauseUpdate=!1,e.tf.setMutationObserver(!0),e.tf.blockEvent=!1),a},f.prototype.bindInnerFiltration=function(){var e=this,t=[];e.tableWrapper.find(".pivot-content, .tablefilter-table-wrapper").each((function(){var a=$(this);a.parents("table, .tablefilter-table-wrapper, .pivot-content, .table-joiner").eq(0).is(e.tableWrapper)&&t.push(a.attr("id"))})),t.length&&(e.tableWrapper.bind("tf-filtered pt-calculated",(function(a,l){if(-1!==t.indexOf(l.id)){"tf-filtered"!==a.type&&(e.tableUpdated=!0);var i=e.processInnerFiltration(l,!0);return e.getTable(!0),i&&e.setFiltrationPanel(),l.tf||(e.addNumbering(),(e.fixedRows||e.fixedCols)&&e.makeTablesScrollable(),e.setFiltrationPanel()),e.filterTable(),!1}})),e.tableWrapper.bind("pivot-collapse-change",(function(a,l){if(-1!==t.indexOf(l.id))return e.showOrHideTables(),!1}))),e.tableWrapper.bind("tf-export-ready",(function(t,a){return e.macroId===a.macroId})),e.processInnerFiltration(e.tableWrapper.data("inner-filter"),!1)&&e.getTable(!0)},f.prototype.bindHideBtn=function(){var e=this,t=parseInt(e.outerWrapper.css("margin-top"));e.comboBoxDiv.find(".tf-hider").click((function(){var a=e.tables.eq(0),l=e.comboBoxDiv.outerHeight(!0);e.comboBoxDiv.width();e.comboBoxDiv.css({position:"absolute",top:e.comboBoxDiv.position().top-l});var i=a.outerWidth()-2,r={"margin-top":2*t+l+"px"};e.outerWrapper.css(r),e.comboBoxDiv.animate({top:a.position().top,opacity:0,width:i,height:14},{complete:function(){e.comboBoxDiv.hide().css({width:"",height:"",position:""}),r={"margin-top":t+"px"},e.outerWrapper.animate(r,{complete:function(){e.outerWrapper.css("width","")}}),e.showBtn.show().width(i)},duration:300}),n.a.setCookie(e.hideParamName,!0)})),e.showBtn.click((function(){var a=e.tables.eq(0);e.showBtn.hide(),e.comboBoxDiv.show();var l=e.comboBoxDiv.width(),i=e.comboBoxDiv.height(),r=e.comboBoxDiv.outerHeight(!0);e.comboBoxDiv.css({position:"absolute",opacity:0}),e.comboBoxDiv.css({width:a.width()-2,height:14});var s={"margin-top":2*t+r+"px"};e.outerWrapper.animate(s,{complete:function(){e.comboBoxDiv.css({top:0}).animate({top:-r,opacity:1,width:l,height:i},{complete:function(){e.comboBoxDiv.css({position:"",width:"",height:""}),e.outerWrapper.css({"margin-top":t+"px",width:""})},duration:300})}}),n.a.setCookie(e.hideParamName,!1)}))},f.prototype.bindTableEvents=function(){var e=this;if(!e.editorMacro){var t=e.fixedRows>0?e.tables.eq(0).parent():e.tables.eq(0);t.unbind("mouseover.tf"+e.macroId).bind("mouseover.tf"+e.macroId,(function(){var a=t.offset();e.showBtn.parent().offset({top:a.top-14,left:a.left+t.parent().scrollLeft()}),e.showBtn.css("visibility","visible"),e.showBtn.width(t.outerWidth()-2)})).unbind("mouseout.tf"+e.macroId).bind("mouseout.tf"+e.macroId,(function(){e.showBtn.css("visibility","")})),e.showBtnResizeSensor&&e.showBtnResizeSensor.detach&&e.showBtnResizeSensor.detach(),t.length&&(e.showBtnResizeSensor=new i.ResizeSensor(t,(function(){e.showBtn.width(t.outerWidth()-2)}))),e.outerWrapperResizeSensor&&e.outerWrapperResizeSensor.detach&&e.outerWrapperResizeSensor.detach(),e.outerWrapperResizeSensor=new i.ResizeSensor(e.outerWrapper,(function(){e.showBtn.css("max-width",e.outerWrapper.width()-2+"px")}))}e.tables.unbind("sortStart.tfs"+e.macroId).bind("sortStart.tfs"+e.macroId,(function(){e.sorting=!0,e.setMutationObserver()})).unbind("sortEnd.tfs"+e.macroId).bind("sortEnd.tfs"+e.macroId,(function(){if(e.sorting=!1,e.getTable(!0),e.resetSortBtn.removeClass("tf-disabled-link"),e.restoreNumbering&&(e.restoreNumbering=!1,e.addNumbering(),e.filterTable()),e.totalRows){var t=e.totalRows[e.tables.index(this)];t&&$(this).append(t)}e.fixedRows>1&&e.updateFixedCells(),e.setMutationObserver()}))},f.prototype.bindAddFilter=function(){var e=this,t=function(){"undefined"!=typeof AP&&AP.resize()},a=AJS.InlineDialog(e.comboBoxDiv.find(".lockDisabled .filter-settings"),"tf-add-filter-"+e.macroId,(function(t,a,l){t.css({"min-height":"166px"});var i=[],r=e.getFilters(),s=[{type:"selectfilter",name:"Dropdown Filter",desc:"Select from the list of column unique values",columns:[],existing:r.selectfilters},{type:"userfilter",name:"Free Text Filter",desc:"Enter custom text query or regular expression to filter data in the selected column",columns:[],existing:r.userfilters},{type:"numberfilter",name:"Number Filter",desc:"Specify the number range to filter data in the selected column",columns:[],existing:r.numberfilters},{type:"datefilter",name:"Date Filter",desc:"Select the time period to filter dates in the selected column",columns:[],existing:r.datefilters},{type:"iconfilter",name:"Visual Filter",desc:"Select icons, emoticons, images or state of checkboxes from the list of unique column values",columns:[],existing:r.iconfilters}];$.each(s,(function(t,a){$.each(e.columns,(function(e,t){-1==$.inArray(t.replace(/\,/g,"‚"),a.existing)&&a.columns.push(t)})),a.columns.length&&i.push(a)})),t.html(d.a.addFilterDialog({filters:i,globalfilter:!r.globalfilter,columnhider:!r.columnhider,dateFormat:e.dateFormat})),l()}),{offsetX:-20,width:270,noBind:!0,gravity:"n",initCallback:function(){var a=this,l=a.popup.find(".filter-type"),i=a.popup.find(".date-format-param"),r=i.find(".date-format-input");l.change((function(){var e=l.val(),t=a.popup.find(".tf-add-filter-column:visible select").val();a.popup.find("div.tf-add-filter-column").hide(),a.popup.find("div."+e).show().find("option").filter((function(){return this.textContent==t})).attr("selected","selected"),"datefilter"===e?i.fadeIn():i.fadeOut(),l.attr("title",l.find("option:selected").attr("title"))})),l.trigger("change"),a.popup.find("#cancel").click((function(){return a.hide(),t(),!1})),a.popup.find("#save").click((function(){$(this).prop("disabled",!0);var i=l.val();return"datefilter"===i&&e.changeSettings(r.val().trim()),e.addFilter(i,a.popup.find("select."+i).val()),a.hide(),$("body").trigger("filter-added-deleted",{action:"Filter Added",type:i,pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View"}),t(),!1})),o.a.dateFormatAutocomplete(r,a.popup),e.editorMacro&&a.popup.click((function(){return!1}))},hideCallback:function(){t()}});e.menu.find(".filter-add").bind("click",(function(t){return"undefined"!=typeof AP&&t.clientY+190>$("body").height()-10&&t.clientY-240<0&&AP.resize("100%",t.clientY+190),a.show(),"false"==e.menu.attr("aria-hidden")&&e.comboBoxDiv.find("#filter-settings-"+e.macroId).trigger("aui-button-invoke"),!1})),e.comboBoxDiv.find(".tf-add-start").click((function(t){return e.isCloud?(e.comboBoxDiv.find("#filter-settings-"+e.macroId).trigger("mousedown",[t]),setTimeout((function(){e.comboBoxDiv.find("#filter-settings-"+e.macroId).trigger("aui-button-invoke")}),100)):e.comboBoxDiv.find("#filter-settings-"+e.macroId).trigger("aui-button-invoke"),e.menu.find(".filter-add").addClass("active").removeClass("active",400).addClass("active",500),!1}))},f.prototype.addFilter=function(e,t){var a=this,l=$(d.a.filter({type:e,column:t}));return a.comboBoxDiv.find(".sortable-container").append(l),"selectfilter"==e||"columnhider"==e||"iconfilter"==e?("iconfilter"!==e||a.rawIconTables||a.updateRawIconTables(),a.createSelects(l)):"datefilter"==e&&a.createDatePickers(l),a.setFiltrationPanel(),a.makeResizable(l),a.enableSaveBtn(),l},f.prototype.bindChangeSettings=function(){var e=this,t=function(){"undefined"!=typeof AP&&AP.resize()},a=AJS.InlineDialog(e.comboBoxDiv.find(".lockDisabled .filter-settings"),"tf-change-settings-"+e.macroId,(function(t,a,l){t.css({"min-height":"120px"}),t.html(d.a.changeSettingsDialog({datepattern:e.dateFormat})),l()}),{offsetX:-20,width:270,noBind:!0,gravity:"n",initCallback:function(){var a=this,l=a.popup.find("#tf-cs-dialog-datepattern");o.a.dateFormatAutocomplete(l,a.popup),a.popup.find("#tf-cs-cancel").click((function(){return a.hide(),t(),!1})),a.popup.find("#tf-cs-save").click((function(){return e.changeSettings(l.val()),a.hide(),t(),!1})),e.editorMacro&&a.popup.click((function(){return!1}))},hideCallback:function(){t()}});e.menu.find(".tf-change-settings").bind("click",(function(t){return a.show(),"false"==e.menu.attr("aria-hidden")&&e.comboBoxDiv.find("#filter-settings-"+e.macroId).trigger("aui-button-invoke"),!1}))},f.prototype.changeSettings=function(e){var t=this;t.dateFormat!=e&&(t.enableSaveBtn(),t.dateFormat=e,t.updateDateFilters(),t.filterTable())},f.prototype.updateDateFilters=function(){var e=this;e.comboBoxDiv.find("input.date").each((function(){var t=$(this),a=e.getDateFormat(t),l=a.dateFormat,i=a.locale,r=t.attr("dateformat");if(l!=r){var s=t.val(),n=null;try{n=o.a.parseDate(s,r,i)}catch(e){}var c=$(t[0].outerHTML);t.replaceWith(c),c.attr("value",null!=n?o.a.formatDate(n,l,i):s),$(".aui-datepicker-dialog").remove(),e.initDatePicker(c,l,i)}}))},f.prototype.initDatePicker=function(e,t,a){var l=this;if(e.attr("dateformat",t),e.attr("locale",a),e.attr("placeholder",t),!t.match(/[iw]/)){l.datePickerOptions.dateFormat=o.a.getDateFormatWithoutTime(t),l.datePickerOptions.languageCode=a;var i=e.datePicker(l.datePickerOptions)}t.toLowerCase().indexOf("hh:mm")>=0?(e.width(120),e.bind("focus click keyup input paste",(function(){setTimeout((function(){i.setDate(o.a.getDateTimeObject(e.val(),t).dateString)}),1)}))):e.width(93)},f.prototype.getDateFormat=function(e){for(var t=this,a=e.attr("name"),l=t.dateFormat,i=t.locale,r=0;r<t.rows.length;r++){var s=t.rows[r],n=o.a.getColumnPosition(s,a);if(null!=n){var c=s.not("#issuetable tr, .spreadsheets-sheet tr").find("td:eq("+n+") time").not('[data-macro-name="page-info"]');if(c.length)return o.a.getDateMacroDateFormat(c,i,t.localeDateFormat)}}return{dateFormat:l,locale:i}},f.prototype.bindSave=function(){var e=this;e.saveBtn.click((function(t){var a=e.saveBtn;if(!a.hasClass("tf-disabled-link")){$("body").trigger("filter-options-save");var l=e.getFilters(),i={pageId:e.pageId,id:e.macroId,defaults:l.defaults.join(","),width:l.width.join(","),inverse:l.inverse.join(","),order:l.order.join(","),labels:e.getFilterLabels(),datepattern:e.dateFormat},r=function(e){for(var t=[],a=0;a<e.length;a++)""==e[a]?t.push("‌"):t.push(e[a]);return t.join(",")};l.selectfilters.length&&(i.column=r(l.selectfilters)),l.userfilters.length&&(i.userfilter=r(l.userfilters)),l.numberfilters.length&&(i.numberfilter=r(l.numberfilters)),l.datefilters.length&&(i.datefilter=r(l.datefilters)),l.iconfilters.length&&(i.iconfilter=r(l.iconfilters)),l.globalfilter&&(i.globalfilter="true"),l.columnhider&&(i.columnhider="true");var s=function(){a.addClass("tf-disabled-link"),e.comboBoxDiv.add(a).find(".tfac-unsaved").hide()};e.editorMacro?(i.column?e.macroParams.column=i.column:delete e.macroParams.column,i.userfilter?e.macroParams.userfilter=i.userfilter:delete e.macroParams.userfilter,i.numberfilter?e.macroParams.numberfilter=i.numberfilter:delete e.macroParams.numberfilter,i.datefilter?e.macroParams.datefilter=i.datefilter:delete e.macroParams.datefilter,i.globalfilter?e.macroParams.globalFilter=i.globalfilter:delete e.macroParams.globalFilter,i.columnhider?e.macroParams.hideColumns=i.columnhider:delete e.macroParams.hideColumns,i.iconfilter?e.macroParams.iconfilter=i.iconfilter:delete e.macroParams.iconfilter,i.width?e.macroParams["cell-width"]=i.width:delete e.macroParams["cell-width"],i.defaults?e.macroParams.default=i.defaults:delete e.macroParams.default,i.inverse?e.macroParams.inverse=i.inverse:delete e.macroParams.inverse,i.datepattern?e.macroParams.datepattern=i.datepattern:delete e.macroParams.datepattern,i.labels?e.macroParams.labels=i.labels:delete e.macroParams.labels,e.editorMacro.attr("data-macro-parameters",Confluence.MacroParameterSerializer.serialize(e.macroParams)),s()):(n.a.saveMacroParams(i,e.outerWrapper),s(),e.tableWrapper.trigger("tf-save")),t.preventDefault()}}))},f.prototype.bindExport=function(){var e=this;void 0===l.saveAs?(e.menu.find(".export-file-pdf").hide(),e.menu.find(".export-file-doc").hide(),e.menu.find(".export-file-csv").hide()):(e.menu.find(".export-file-pdf").bind("click",(function(t){n.a.loadScriptsBeforeExport((function(){o.a.exportToPdf(e.tableWrapper)})),t.preventDefault()})),e.menu.find(".export-file-doc").bind("click",(function(t){o.a.exportToDoc(e.tableWrapper),t.preventDefault()})),e.menu.find(".export-file-csv").click((function(t){o.a.createDialog(e.tables,e.rows[0],e.macroId).show(),"undefined"!=typeof AP&&$("#export-csv-dialog-"+e.macroId).css("margin-top",0),t.preventDefault()})))},f.prototype.bindSortReset=function(){var e=this;e.resetSortBtn.bind("click",(function(t){t.preventDefault(),e.resetSortBtn.hasClass("tf-disabled-link")||(e.sorts.length?e.sortTables():e.tables.trigger("sorton",[[]]),e.resetSortBtn.addClass("tf-disabled-link"))}))},f.prototype.bindCopyUrl=function(){var e=this;e.menu.find(".get-tf-url").bind("click",(function(t){var a=e.getFilters();a.sorts=[],e.tables.each((function(t){this.config&&this.config.sortList&&this.config.sortList.forEach((function(l){var i=0===l[1]?"⇧":"⇩";a.sorts.push(e.rawTables[t][0][l[0]]+" "+i)}))}));var l=window.location.hash,i=window.location.href.replace(l,""),r=$.getUrlHashVar("tf-filters");if(r){var s="tf-filters="+encodeURIComponent(r);l=(l=l.replace("&"+s,"")).replace("#"+s,"")}i=i+l+(l?"&":"#");var o=$("<span></span>");$("body").append(o),o.text(i+"tf-filters="+encodeURIComponent(JSON.stringify(a)));var n=document.createRange();n.selectNode(o[0]);var c=window.getSelection();c.removeAllRanges(),c.addRange(n),document.execCommand("copy"),o.remove(),t.preventDefault()}))},f.prototype.bindGetUrlValues=function(){var e=this,t=function(){var t=$.getUrlHashVar("tf-filters");if(t){var a=JSON.parse(t);e.setFilters(a)}};$(window).bind("hashchange",t),$(".tablefilter-table-wrapper").one("tf-filtered",t)},f.prototype.setFilters=function(e){var t=this,a=function(e,t){e?(t.addClass("inverse"),t.parents(".filter-container:eq(0)").addClass("inverse")):(t.removeClass("inverse"),t.parents(".filter-container:eq(0)").removeClass("inverse"))},l=function(e,t){return e.filterByAttr("name",t)};o.a.i18nFilterValues(e.defaults);var i=0;(t.clearFilters(),e.selectfilters.forEach((function(r){r=r.replace(/\‚/g,",");var s=l(t.comboBoxDiv.find("select.select"),r);0==s.length&&(s=t.addFilter("selectfilter",r).find("select")),a(e.inverse[i],s);var n=e.defaults[i++].replace(/\‚/g,","),c=o.a.clearStringLowerCase(n).split("&&");n=n.split("&&");var d=[];s.find("option:selected").prop("selected",!1),s.find("option").each((function(){var e=$(this),t=$.inArray(o.a.clearStringLowerCase(e[0].textContent),c);-1!=t&&(e.prop("selected",!0),d.push(t))})),n.forEach((function(e,t){e&&-1==$.inArray(t,d)&&s.append($('<option selected="selected"></option>').text(e))})),s.trigger("chosen:updated")})),e.userfilters.forEach((function(r){r=r.replace(/\‚/g,",");var s=l(t.comboBoxDiv.find("input.user-filter"),r);0==s.length&&(s=t.addFilter("userfilter",r).find("input")),a(e.inverse[i],s),s.val(e.defaults[i++].replace(/\‚/g,","))})),e.numberfilters.forEach((function(r){r=r.replace(/\‚/g,",");var s=l(t.comboBoxDiv.find("input.number.from"),r);0==s.length&&(s=t.addFilter("numberfilter",r).find("input.from"));var o=l(t.comboBoxDiv.find("input.number.to"),r);a(e.inverse[i],s),a(e.inverse[i],o);var n=e.defaults[i++].replace(/\‚/g,",").split("->");s.val(n[0]),o.val(n[1])})),e.datefilters.forEach((function(r){r=r.replace(/\‚/g,",");var s=l(t.comboBoxDiv.find("input.date.from"),r);0==s.length&&(s=t.addFilter("datefilter",r).find("input.from"));var n=l(t.comboBoxDiv.find("input.date.to"),r);a(e.inverse[i],s),a(e.inverse[i],n);var c=e.defaults[i++].replace(/\‚/g,",").split("->");s.val(o.a.convertToDate(c[0],s.attr("dateformat"),s.attr("locale"))),n.val(o.a.convertToDate(c[1],n.attr("dateformat"),s.attr("locale")))})),e.globalfilter)&&(0==(r=t.comboBoxDiv.find("input.global-filter")).length&&(r=t.addFilter("globalfilter","").find("input")),a(e.inverse[i],r),r.val(e.defaults[i++].replace(/\‚/g,",")));if(e.columnhider){var r;0==(r=t.comboBoxDiv.find("select.column-select")).length&&(r=t.addFilter("columnhider","").find("select")),a(e.inverse[i],r);var s=e.defaults[i++].replace(/\‚/g,","),n=o.a.clearStringLowerCase(s).split("&&");s=s.split("&&");var c=[];r.find("option:selected").prop("selected",!1),r.find("option").each((function(){var e=$(this),t=$.inArray(o.a.clearStringLowerCase(e.text()),n);-1!=t&&(e.prop("selected",!0),c.push(t))})),s.forEach((function(e,t){e&&-1==$.inArray(t,c)&&r.append($('<option selected="selected"></option>').text(e))})),r.trigger("chosen:updated")}e.iconfilters.forEach((function(r){r=r.replace(/\‚/g,",");var s=l(t.comboBoxDiv.find("select.icon-select"),r);0==s.length&&(s=t.addFilter("iconfilter",r).find("select")),a(e.inverse[i],s);var n=o.a.clearStringLowerCase(e.defaults[i++].replace(/\‚/g,",")).split("&&");s.find("option:selected").prop("selected",!1),s.find("option").each((function(){var e=$(this);-1!=$.inArray(o.a.clearStringLowerCase(e[0].textContent),n)&&e.prop("selected",!0)})),s.trigger("chosen:updated")})),e.sorts&&(t.sorts=e.sorts,t.sortTables()),t.filterTable()},f.prototype.fixURIHash=function(){var e=$.getUrlHashVar("tf-filters");if(e){var t=location.hash,a=location.hash.replace("&tf-filters="+encodeURIComponent(e),"");t!=a&&(location.hash=a,location.hash=t)}},f.prototype.bindMakeInverse=function(){var e=this;e.comboBoxDiv.delegate(".eq","click",(function(){var t=$(this).parents(".filter-container:eq(0)");t.addClass("inverse");var a=t.find("input, select").addClass("inverse");$("body").trigger("filter-inverse-direct",{type:y(t),pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View",filterMode:"Inverse"}),e.enableSaveBtn(),e.filterTable(a)})),e.comboBoxDiv.delegate(".not-eq","click",(function(){var t=$(this).parents(".filter-container:eq(0)");t.removeClass("inverse");var a=t.find("input, select").removeClass("inverse");$("body").trigger("filter-inverse-direct",{type:y(t),pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View",filterMode:"Normal"}),e.enableSaveBtn(),e.filterTable(a)}))},f.prototype.setFiltrationPanel=function(){var e=this,t=e.columns.map((function(e){return e.toLocaleLowerCase()})),a=e.comboBoxDiv.find("select.select, input.user-filter, div.range, select.icon-select");a.each((function(){var e=$(this);-1==$.inArray(o.a.clearStringLowerCase(e.attr("name")),t)?e.parents(".filter-container").eq(0).hide():e.parents(".filter-container").eq(0).show()})),e.setSelectOptions();var l=e.comboBoxDiv.find("select.column-select");l.find("option:not(:selected)").remove();var i=[];l.find("option").each((function(){i.push($(this).hasClass("tf-empty-option")?"":o.a.clearString(this.textContent))})),$.each(e.columns,(function(e,t){if(-1==$.inArray(t,i)){var a="",r=t;""==t&&(a=' class="tf-empty-option"',r="-Empty-"),l.append($("<option"+a+"></option>").text(r))}})),l.trigger("chosen:updated"),e.comboBoxDiv.find(".search-choice").filter((function(){return o.a.clearString(this.textContent)=="-Empty-"})).addClass("tf-empty-option"),e.updateDateFilters();var r=a.filter((function(){return"none"!=$(this).parent().css("display")})).length>0||l.length>0||e.comboBoxDiv.find(".global-filter").length>0,s="all"!=e.showNRows;if(0==e.rawTables.length)e.comboBoxDiv.show(),e.tableWrapper.data("hasFrame")?(e.comboBoxDiv.find(".waiting-for-table").show(),e.comboBoxDiv.find(".no-table-message").hide()):(e.comboBoxDiv.find(".no-table-message").show(),e.comboBoxDiv.find(".waiting-for-table").hide()),e.comboBoxDiv.find(".empty-message").hide(),e.lockDisabled.hide(),e.lockEnabled.hide(),e.outerWrapper.addClass("no-table"),e.comboBoxDiv.find(".tf-hider-wrapper").hide();else{if(e.comboBoxDiv.find(".tf-hider-wrapper").show(),e.outerWrapper.removeClass("no-table"),e.comboBoxDiv.find(".no-table-message").hide(),e.comboBoxDiv.find(".waiting-for-table").hide(),e.isLockEnabled=e.isLockEnabled&&(r||s),e.isLockEnabled?(e.lockDisabled.hide(),e.lockEnabled.show()):(e.lockDisabled.show(),e.lockEnabled.hide()),r||s||!(e.numbering||e.fixedRows||e.sorts.length||e.sparkline||e.fixedCols||e.totalRow.join("")||e.totalCol)?e.editorMacro||"true"!=n.a.getCookie(e.hideParamName)?(e.comboBoxDiv.show(),e.showBtn.hide()):(e.comboBoxDiv.hide(),e.showBtn.show()):e.editorMacro||(e.comboBoxDiv.hide(),e.showBtn.show()),!r&&s?(e.comboBoxDiv.find(".disableLock").show(),e.comboBoxDiv.find(".show-n-rows-only-message").show()):e.comboBoxDiv.find(".show-n-rows-only-message").hide(),r||s){e.comboBoxDiv.find(".filter-buttons-container").show(),e.comboBoxDiv.find(".empty-message").hide(),e.lockDisabled.addClass("not-empty").removeClass("empty");var c=e.outerWrapper.css("display");e.outerWrapper.show();var d=e.comboBoxDiv.css("display");if(e.comboBoxDiv.show(),!e.editorMacro){e.lockEnabled.css("width","").css("display","inline-flex");var p=Math.max(302,Math.ceil(e.lockEnabled.show().width())+1);e.lockDisabled.css("min-width",p+"px")}e.lockDisabled.show(),e.editorMacro||e.lockEnabled.width(Math.max(302,Math.ceil(e.lockDisabled.width()))),e.lockEnabled.height(Math.max(40,e.lockDisabled.height())),e.comboBoxDiv.css("display",d),e.outerWrapper.css("display",c),e.lockEnabled.css("display","block"),e.isLockEnabled?e.lockDisabled.hide():e.lockEnabled.hide()}else e.lockDisabled.addClass("empty").removeClass("not-empty").css("min-width",""),e.comboBoxDiv.find(".filter-buttons-container").show(),e.comboBoxDiv.find(".empty-message").show();r?(e.comboBoxDiv.find(".lockDisabled .filter-reset").prop("disabled",!1),e.comboBoxDiv.find(".lockDisabled .disableLock").prop("disabled",!1)):(e.comboBoxDiv.find(".lockDisabled .filter-reset").prop("disabled",!0),s||e.comboBoxDiv.find(".lockDisabled .disableLock").prop("disabled",!0))}e.outerWrapper.css("visibility","visible")},f.prototype.setSelectOptions=function(){var e=this,t=e.comboBoxDiv.find("select.select, select.icon-select").filter((function(){return"none"!=$(this).parent().css("display")}));if(t.find("option:not(:selected)").remove(),e.shouldUpdateSelectOptions)var a=e.getFilterContainers().not(".columnhider-element");t.each((function(){var t=$(this),l=t.attr("name").toLocaleLowerCase(),i=t.data("html"),r=!0,s=[],n=[];t.find("option").each((function(){if(i){var e=this.textContent;if(e!="-Empty-"){var t=$(e);t.is("img")&&(e=t[0].src,e=o.a.clearIconSrc(e))}else n.push("");n.push(e.toLocaleLowerCase())}else n.push($(this).hasClass("tf-empty-option")?"":o.a.clearStringLowerCase(this.textContent))})),$.each(e.rawTables,(function(c,d){var p=o.a.getCellPositions(d,l);if(e.shouldUpdateSelectOptions&&d.length){for(var f=new Array(d.length-1),u=0;u<f.length;u++)f[u]=!0;a.not(t.parent()).each((function(){var t=$(this).data("state");if(t&&t[c])for(var a=0;a<t[c].length;a++)e.isAND?f[a]=f[a]&&t[c][a]:f[a]=f[a]&&!t[c][a]}))}p.forEach((function(t){if($.each(i?e.rawIconTables[c]:d,(function(a,l){if(0!=a&&(!f||f[a-1])){var c=l[t];if(null==c)return;if(i&&c){var d=$(c);d.filter("img").each((function(){c=o.a.clearStringLowerCase(this.src),c=o.a.clearIconSrc(c),-1==$.inArray(c,n)&&(n.push(c),s.push(this.outerHTML))})),d.filter("ul").length&&r&&(r=!1,-1==$.inArray('<ul class="inline-task-list"><li></li></ul>',n)&&(s.push('<ul class="inline-task-list"><li></li></ul>'),n.push('<ul class="inline-task-list"><li></li></ul>')),-1==$.inArray('<ul class="inline-task-list"><li class="checked"></li></ul>',n)&&(s.push('<ul class="inline-task-list"><li class="checked"></li></ul>'),n.push('<ul class="inline-task-list"><li class="checked"></li></ul>')))}else e.ddSeparator&&""!=c?c.split(e.ddSeparator).forEach((function(e){(e=e.trim())&&(c=e.toLocaleLowerCase(),-1==$.inArray(c,n)&&(n.push(c),s.push(e)))})):(c=c.toLocaleLowerCase(),-1==$.inArray(c,n)&&(n.push(c),s.push(l[t])))}})),!i&&-1==$.inArray("@currentuser",n)){var a=e.tables.eq(c),l=!1;if(e.rows[c].length>1&&a.hasClass("tasks-report")&&o.a.getNthTdElem(e.rows[c][1],t).hasClass("tasks-report-assignee"))l=!0;else if(t++,a.find(".confluence-userlink").length){var p=a.find("tr td:nth-child("+t+"), tr th:nth-child("+t+")").find(".confluence-userlink").eq(0);p.length&&p.parents("td").eq(0).text().trim()==p.text().trim()&&(l=!0)}l&&(n.push("@currentuser"),s.push("@currentUser"))}}))})),s.sort();var c="";$.each(s,(function(e,t){var a="",l=t;""==t&&(a=' class="tf-empty-option"',l="-Empty-"),c+=$("<option"+a+"></option>").text(l)[0].outerHTML})),t.append(c),t.trigger("chosen:updated")}))},f.prototype.makeSortable=function(){var e=this;e.comboBoxDiv.find(".sortable-container").sortable({cancel:"input,textarea,button,select,option,.chosen-drop",scroll:!1,items:".sortable",start:function(e,t){t.item.width(Math.ceil(t.item.width())+1)},sort:function(t,a){e.highlightRemoveFilter(a.offset,a.helper)},beforeStop:function(t,a){e.enableSaveBtn(),e.removeFilter(a.offset,a.item)},update:function(e,t){$("body").trigger("filter-reordered",{type:y(t.item),pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View"})}})},f.prototype.makeResizable=function(e){var t=this;0==$("body.content-preview").length&&e.find(".chosen-container, div.tf-resizeable").length>0&&e.find(".chosen-container, div.tf-resizeable").resizable({handles:"e",resize:function(e,a){a.element.hasClass("chosen-container")?a.element.parent().find("select").attr("data-width",a.size.width):a.element.find("input").attr("data-width",a.size.width),t.enableSaveBtn()}})},f.prototype.makeTablesScrollable=function(){var e=this;o.a.hasLoadingContent(e.tableWrapper)||(e.pauseUpdate=!0,e.setMutationObserver(!0),e.tables.find(".tf-fixed-column-border").remove(),e.tables.parents(".table-wrap, .table-wrap-aui").unbind("scroll scroll-tf"),e.tables.find("td.tf-floating,th.tf-floating").removeClass("tf-floating").removeClass("tf-float-head").css({top:"",left:""}),e.tableWrapper.find(e.editorMacro?".table-wrap.tf-fixed-rows":".table-wrap.editor, .table-wrap-aui").each((function(){var e=$(this);e.before(e.children("table, .table-wrap")),e.remove()})),e.tableWrapper.removeClass("fixed"),e.editorMacro&&e.tableWrapper.find(".resize-sensor, .resize-sensor-shrink, .resize-sensor-expand").remove(),e.fixColumns(),e.pauseUpdate=!1,e.setMutationObserver(!0))},f.prototype.fixColumns=function(){var e=this;if(e.fixedCols>0&&!e.editorMacro||e.fixedRows>0){var t=window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)||/Edge/.test(navigator.userAgent);e.tables.each((function(a){var l=$(this);e.editorMacro?l.wrap('<div class="table-wrap editor"></div>'):e.fixedRows>0&&l.hasClass("aui")?l.wrap('<div class="table-wrap-aui"></div>'):0==l.parents(".table-wrap").length&&l.wrap('<div class="table-wrap"></div>');var i=l.parents(".table-wrap, .table-wrap-aui").eq(0);if(i.addClass("tf-fixed"),t&&i.addClass("ie"),l.find(".tableFloatingHeader").remove(),e.fixedRows>0){var r=e.rows[a].length>e.fixedRows?2*(e.rows[a].eq(e.fixedRows).offset().top-l.offset().top):l.height(),s=e.heightValue?e.heightValue:Math.floor(.7*window.innerHeight)||600;i.css("max-height",Math.max(r,s)+"px"),i.addClass("tf-fixed-rows")}l.tableHeadFixer({left:e.editorMacro?0:e.fixedCols,head:parseInt(e.fixedRows)+l.find("tr.tf-header-hidden").length,parent:i})})).bind("tablesorter-initialized updateComplete",(function(){$(this).find("th .tf-fixed-column-border").each((function(){var e=$(this);e.parents("th:eq(0)").append(e)}))})),t&&$(".tf-fixed-column-border.right, .tf-fixed-column-border.left").each((function(){var e=$(this);e.height(e.parents("th, td").eq(0).outerHeight()-1)})),e.tableWrapper.addClass("fixed")}},f.prototype.updateFixedCells=function(){var e=this;(e.fixedCols>0&&!e.editorMacro||e.fixedRows>0)&&(e.pauseUpdate=!0,e.setMutationObserver(!0),e.tables.parents(".table-wrap, .table-wrap-aui").unbind("scroll scroll-tf"),e.tables.find(".tf-fixed-column-border").remove(),e.tables.find("td.tf-floating,th.tf-floating").removeClass("tf-floating").css({top:"",left:""}),e.tables.each((function(){var t=$(this),a=t.parents(".table-wrap, .table-wrap-aui").eq(0);t.tableHeadFixer({left:e.editorMacro?0:e.fixedCols,head:e.fixedRows,parent:a})})),e.pauseUpdate=!1,e.setMutationObserver(!0))},f.prototype.enableSaveBtn=function(){this.saveBtn.removeClass("tf-disabled-link"),this.comboBoxDiv.add(this.saveBtn).find(".tfac-unsaved").show()},f.prototype.shouldRemoveFilter=function(e){var t=this,a=t.comboBoxDiv.offset(),l=a.left+t.comboBoxDiv.width()+10,i=a.left-10,r=a.top+t.comboBoxDiv.height()-10,s=a.top-20;return e.top<s||e.top>r||e.left>l||e.left<i},f.prototype.removeFilter=function(e,t){var a=this;a.outerWrapper.click(),a.shouldRemoveFilter(e)?(t.remove(),$("body").trigger("filter-added-deleted",{action:"Filter Deleted",type:y(t),pageMode:$("body").find("div#macro-browser-preview").length?"Macro Preview":"Page View"}),setTimeout((function(){a.filterTable(),a.setFiltrationPanel()}),500)):t.removeClass("filter-removing")},f.prototype.highlightRemoveFilter=function(e,t){this.shouldRemoveFilter(e)?t.addClass("filter-removing"):t.removeClass("filter-removing")},f.prototype.getFilters=function(){var e=this,t={selectfilters:[],userfilters:[],numberfilters:[],datefilters:[],globalfilter:e.comboBoxDiv.find("input.global-filter"),columnhider:e.comboBoxDiv.find("select.column-select"),iconfilters:[],defaults:[],width:[],inverse:[],order:[]},a=e.comboBoxDiv.find(".sortable-container .filter-container");if(e.comboBoxDiv.find("select.select").each((function(){var e=[],l=$(this);t.selectfilters.push(l.attr("name").replace(/\,/g,"‚")),t.width.push(l.attr("data-width").replace("px","")),l.find("option:selected").each((function(){e.push(this.textContent.replace(/\,/g,"‚"))})),t.defaults.push(e.join("&&")),t.inverse.push(l.hasClass("inverse")),t.order.push(a.index(l.parents(".filter-container")))})),e.comboBoxDiv.find("input.user-filter").each((function(){var e=$(this);t.userfilters.push(e.attr("name").replace(/\,/g,"‚")),t.width.push(e.attr("data-width").replace("px","")),t.defaults.push(e.val().replace(/\,/g,"‚")),t.inverse.push(e.hasClass("inverse")),t.order.push(a.index(e.parents(".filter-container")))})),e.comboBoxDiv.find(".range.numbers").each((function(){var e=[],l=$(this);t.numberfilters.push(l.attr("name").replace(/\,/g,"‚")),l.find("input.number").each((function(){e.push($(this).val().replace(/\,/g,"‚"))})),t.defaults.push(e.join("->")),t.inverse.push(l.parent().hasClass("inverse")),t.order.push(a.index(l.parents(".filter-container")))})),e.comboBoxDiv.find(".range.dates").each((function(){var e=[],l=$(this);t.datefilters.push(l.attr("name").replace(/\,/g,"‚")),l.find("input.date").each((function(){var t=$(this),a=t.val();e.push(o.a.dateToUTCTimestamp(a,t.attr("dateformat"),t.attr("locale")))})),t.defaults.push(e.join("->")),t.inverse.push(l.parent().hasClass("inverse")),t.order.push(a.index(l.parents(".filter-container")))})),t.globalfilter.length?(t.defaults.push(t.globalfilter.val().replace(/\,/g,"‚")),t.width.push(t.globalfilter.attr("data-width").replace("px","")),t.inverse.push(t.globalfilter.hasClass("inverse")),t.order.push(a.index(t.globalfilter.parents(".filter-container"))),t.globalfilter=!0):t.globalfilter=!1,t.columnhider.length){var l=[];t.columnhider.find("option:selected").each((function(){l.push(this.textContent.replace(/\,/g,"‚"))})),t.defaults.push(l.join("&&")),t.width.push(t.columnhider.attr("data-width").replace("px","")),t.inverse.push(t.columnhider.hasClass("inverse")),t.order.push(a.index(t.columnhider.parents(".filter-container"))),t.columnhider=!0}else t.columnhider=!1;return e.comboBoxDiv.find("select.icon-select").each((function(){var e=[],l=$(this);t.iconfilters.push(l.attr("name").replace(/\,/g,"‚")),t.width.push(l.attr("data-width").replace("px","")),l.find("option:selected").each((function(){e.push(this.textContent.replace(/\,/g,"‚"))})),t.defaults.push(e.join("&&")),t.inverse.push(l.hasClass("inverse")),t.order.push(a.index(l.parents(".filter-container")))})),o.a.unI18nFilterValues(t.defaults),t},f.prototype.getTable=function(e){var t=this,a=t.tabs&&o.a.hasTabs(t.tableWrapper);t.tables=o.a.getTableNodes(t.tableWrapper,t.editorMacro?"table.confluenceTable":"table").filter((function(){var e=$(this);if(a&&o.a.hasInactiveTab(e))return!1;var l=e.parents("table:not(.wysiwyg-macro), .tablefilter-table-wrapper");return l.eq(0).is(t.tableWrapper)||l.eq(0).is(".tablefilter-table-wrapper")&&l.eq(1).is(t.tableWrapper)})),e||t.normalizeTable(),t.rows=[],t.headerSize=[],t.tables.each((function(){var e=o.a.getRows(this);t.rows.push(e),t.headerSize.push(o.a.getMaxRowspan($(e[0])))})),t.updateRawTables(),o.a.setPaginationMsg(t.tableWrapper),e||t.bindTableEvents()},f.prototype.updateRawTables=function(e){var t=this;t.rawTables=o.a.getTablesRowsValues(t.rows,t.editorMacro?o.a.editorType:o.a.textType),e||(t.rawIconTables=null,(t.comboBoxDiv.find("select.icon-select").length||-1!==t.totalRow.indexOf("Count not empty"))&&t.updateRawIconTables()),t.columns=o.a.getColumns(t.rawTables)},f.prototype.updateRawIconTables=function(){this.rawIconTables=o.a.getTablesRowsValues(this.rows,o.a.visualType)},f.prototype.filterTable=function(e){var t=this;if(!o.a.hasLoadingContent(t.tableWrapper)){if(t.isLockEnabled)return t.appendTotalRow(),t.appendTotalCol(),t.appendSparklines(),t.setTablesReady(),void t.prepareExport();var a=t.getFilterContainers();e?t.filterContainer(e.parents(".filter-container.sortable")):t.filterContainer(a),t.showTable(t.isAND),t.filtered=!1,a.not(".columnhider-element").each((function(){var e=$(this);t.filtered=t.filtered||e.data("filtered");var a=e.data("state");if(a)for(var l=0;l<a.length;l++)for(var i=0;i<a[l].length;i++)t.isAND?t.cbState[l][i]=t.cbState[l][i]&&a[l][i]:t.cbState[l][i]=t.cbState[l][i]||a[l][i]})),t.filtered||t.isAND||t.showTable(!0);var l=a.filter(".columnhider-element").data("state");l&&l.length&&(t.tdNumbers=l),t.setTablesReady(),t.showOrHideTables(),t.appendTotalRow(),(t.updateSparkline||t.tableUpdated)&&(t.rows[0]&&!t.rows[0].eq(0).find(".total-col.tf-hidden-column").length&&t.appendTotalCol(),t.appendSparklines(),t.updateSparkline=!1,t.tableUpdated=!1,t.sparkline&&t.fixedRows>0&&t.updateFixedCells()),t.shouldUpdateSelectOptions&&t.setSelectOptions(),t.prepareExport(),t.editorMacro&&t.editorMacro.data("tf-self",!0).attr("type",JSON.stringify(t.getFilters()))}},f.prototype.prepareExport=function(e){var t=this;t.sortWait=t.sortWait||!t.sorts.length||e,t.blockEvent||o.a.hasLoadingContent(t.tableWrapper)||!t.sortWait||(clearTimeout(t.exportTimer),t.exportTimer=setTimeout((function(){t.tableWrapper.trigger("tf-export-ready",{macroId:t.macroId})}),300))},f.prototype.setTablesReady=function(){this.tables.data("tf-ready",!0)},f.prototype.getFilterContainers=function(){return this.comboBoxDiv.find(".filter-container.sortable").filter((function(){return"none"!=$(this).css("display")}))},f.prototype.filterContainer=function(e){var t=this;e.find("select, input").each((function(){var e=$(this);e.is(".select")?t.treatSelectFilter(e):e.is(".user-filter")?t.treatUserFilter(e):e.is(".number")?t.treatNumberFilter(e):e.is(".date")?t.treatDateFilter(e):e.is(".global-filter")?t.treatGlobalFilter(e):e.is(".column-select")?t.treatColumnFilter(e):e.is(".icon-select")&&t.treatIconFilter(e)}))},f.prototype.showTable=function(e){var t=this,a=t.tables.length;t.cbState=new Array(a),t.tdNumbers=new Array(a);for(var l=0;l<a;l++){t.tdNumbers[l]=[],t.cbState[l]=new Array(t.rows[l].length>0?t.rows[l].length-1:0);for(var i=0;i<t.cbState[l].length;i++)t.cbState[l][i]=e}},f.prototype.treatSelectFilter=function(e){var t=this,a=[];e.find("option:selected").each((function(){var e=$.trim(this.textContent);e==="-Empty-"?e="":"@currentUser"===e&&(e=n.a.getCurrentUserFullName(),a.push(n.a.getCurrentUserName())),a.push(e.toLocaleLowerCase())}));var l=e.parent();if(0===a.length)return l.data("state",[]),void l.data("filtered",!1);var i,r=e.attr("name"),s=e.hasClass("inverse");i=t.ddSeparator?function(e,a){if(""===e)return-1===$.inArray(e,a);var l=!0;return e.split(t.ddSeparator).some((function(e){return(e=e.trim())&&(l=-1===$.inArray(e,a)),!l})),l}:function(e,t){return-1==$.inArray(e,t)};var c=[];t.rawTables.forEach((function(e,l){var n=o.a.getCellPositions(e,r);c[l]=[],n.length&&e.forEach((function(e,r){if(r>0){var d=!0;n.forEach((function(t){var l=o.a.clearStringLowerCase(e[t]);d=d&&i(l,a)})),d=t.isAND?d:!d,c[l][r-1]=s!=d?!t.isAND:t.isAND}}))})),l.data("state",c),l.data("filtered",!0)},f.prototype.treatIconFilter=function(e){var t=this,a=[],l=[],i=!1;e.find("option:selected").each((function(){var e=$.trim(this.textContent);if(e=="-Empty-")i=!0;else{var t=$(e);t.length&&(t.is("ul")?l.push("ul.inline-task-list li"+(t.find("li").hasClass("checked")?".checked":":not(.checked)")):((e=t[0].src)&&(e=o.a.clearStringLowerCase(e),e=o.a.clearIconSrc(e)),a.push(e)))}}));var r=e.parent();if(0==a.length&&0==l.length&&!i)return r.data("state",[]),void r.data("filtered",!1);l=l.join(",");var s=e.attr("name"),n=e.hasClass("inverse"),c=[];t.tables.each((function(e){var r=t.rows[e],d=o.a.getColumnPositions(r,s);c[e]=[],d.length&&r.each((function(r){if(r>0){var s=!0,p=this;d.forEach((function(e){var t,r,n,c=o.a.getNthTdElem(p,e);a.length&&o.a.getTdIconsSrc(c).some((function(e){return e&&(e=o.a.clearStringLowerCase(e),e=o.a.clearIconSrc(e)),!(t=-1==$.inArray(e,a))})),l&&(r=0==c.find(l).length),i&&(n=c.find("ul.inline-task-list li, img[src]").length>0),s=s&&(!1!==t&&!1!==n&&!0===r||!0===t&&!1!==n&&!1!==r||!1!==t&&!0===n&&!1!==r)})),s=t.isAND?s:!s,c[e][r-1]=n!=s?!t.isAND:t.isAND}}))})),r.data("state",c),r.data("filtered",!0)},f.prototype.treatInputFilter=function(e,t){var a,l=this,i=e.val(),r=$.trim(i).toLocaleLowerCase();if("@currentUser"==i&&(i=n.a.getCurrentUserFullName()+"|"+n.a.getCurrentUserName()),r.indexOf("&")>0){var s="";$.each(i.split("&"),(function(e,t){s+="(?=.*"+t.trim()+")"})),i=s}try{var c=new RegExp(i,"i")}catch(e){}t&&(a=e.attr("name"));var d=e.parents(".filter-container.sortable");if(""==r)return d.data("state",[]),void d.data("filtered",!1);var p=e.hasClass("inverse"),f=[];l.rawTables.forEach((function(e,i){var s=o.a.getCellPositions(e,a);f[i]=[],t&&!s.length||e.forEach((function(e,a){if(a>0){var n="";t?(s.forEach((function(t){e[t]&&(n=n+" "+e[t])})),n=n.trim()):n=e.join(" ");var d=-1==o.a.clearStringLowerCase(n).indexOf(r)&&(!c||null==n.match(c));d=l.isAND?d:!d,f[i][a-1]=p!=d?!l.isAND:l.isAND}}))})),d.data("state",f),d.data("filtered",!0)},f.prototype.treatGlobalFilter=function(e){this.treatInputFilter(e,!1)},f.prototype.treatUserFilter=function(e){this.treatInputFilter(e,!0)},f.prototype.treatDateFilter=function(e){var t=this,a=$.trim(e.val()).toLocaleLowerCase(),l=e.attr("name"),i=e.attr("dateformat"),r=e.attr("locale"),s=e.hasClass("from"),n=e.hasClass("inverse");if(s)t.rangeFilterValues={from:p()};else{var c=e.parent().parent();if(t.rangeFilterValues.to=p(),t.rangeFilterValues.from||t.rangeFilterValues.to){var d=[];t.rawTables.forEach((function(e,a){var s=o.a.getCellPositions(e,l);d[a]=[],s.length&&e.forEach((function(e,l){if(l>0){var c=!0;s.forEach((function(a){var l=e[a]||"";try{var s=o.a.parseDate(l,i,r);s?n?t.rangeFilterValues.from?c=t.rangeFilterValues.to?c&&t.rangeFilterValues.from<=s&&t.rangeFilterValues.to>=s:c&&t.rangeFilterValues.from<=s:t.rangeFilterValues.to&&(c=c&&t.rangeFilterValues.to>=s):t.rangeFilterValues.from?c=t.rangeFilterValues.to?c&&(t.rangeFilterValues.from>s||t.rangeFilterValues.to<s):c&&t.rangeFilterValues.from>s:t.rangeFilterValues.to&&(c=c&&t.rangeFilterValues.to<s):c=c&&!n}catch(e){c=!1,AJS.log("Error while filtering date '"+l+"': "+e)}})),c=t.isAND?c:!c,d[a][l-1]=c?!t.isAND:t.isAND}}))})),c.data("state",d),c.data("filtered",!0)}else c.data("state",[]),c.data("filtered",!1)}function p(){try{var e;if("today"==a||"heute"==a)return(e=new Date).setHours(0,0,0,0);var t=["y","m","w","d"],l=!1;return t.some((function(e){if(new RegExp("^[+-]?\\d+"+e).test(a))return l=!0,!0})),l?((e=new Date).setHours(0,0,0,0),t.forEach((function(t,l){var i=a.split(t);if(2==i.length){var r=parseInt(i[0]);3==l?e.setDate(e.getDate()+r):2==l?e.setDate(e.getDate()+7*r):1==l?e.setMonth(e.getMonth()+r):e.setYear(e.getFullYear()+r),a=i[1]}})),e):e=o.a.parseDate(a,i,r)}catch(e){return AJS.log("Error while filtering by date '"+a+"': "+e),!1}}},f.prototype.treatNumberFilter=function(e){var t=this,a=$.trim(e.val()).toLocaleLowerCase(),l=e.attr("name"),i=e.hasClass("inverse"),r=e.hasClass("from"),s=o.a.getValueType(a,t.separator,t.worklog),n=o.a.parseValueByType(s,a,t.separator,t.worklog);if(n=!isNaN(n)&&n,r)t.rangeFilterValues={from:n,type:s};else{t.rangeFilterValues.type&&(s=t.rangeFilterValues.type),t.rangeFilterValues.to=n;var c=e.parent().parent();if(!1!==t.rangeFilterValues.from||!1!==t.rangeFilterValues.to){var d=[];t.rawTables.forEach((function(e,a){var r=o.a.getCellPositions(e,l);d[a]=[],r.length&&e.forEach((function(e,l){if(l>0){var n=!0;r.forEach((function(a){var l=e[a]||"";try{var r=o.a.parseValueByType(s,l,t.separator,t.worklog);isNaN(r)?n=n&&!i:i?!1!==t.rangeFilterValues.from?n=!1!==t.rangeFilterValues.to?n&&t.rangeFilterValues.from<=r&&t.rangeFilterValues.to>=r:n&&t.rangeFilterValues.from<=r:!1!==t.rangeFilterValues.to&&(n=n&&t.rangeFilterValues.to>=r):!1!==t.rangeFilterValues.from?n=!1!==t.rangeFilterValues.to?n&&(t.rangeFilterValues.from>r||t.rangeFilterValues.to<r):n&&t.rangeFilterValues.from>r:!1!==t.rangeFilterValues.to&&(n=n&&t.rangeFilterValues.to<r)}catch(e){n=!1,AJS.log("Error while filtering number '"+l+"': "+e)}})),n=t.isAND?n:!n,d[a][l-1]=n?!t.isAND:t.isAND}}))})),c.data("state",d),c.data("filtered",!0)}else c.data("state",[]),c.data("filtered",!1)}},f.prototype.treatColumnFilter=function(e){var t=this;t.updateSparkline=!0;var a=[];e.find("option:selected").each((function(){var e=$.trim(this.textContent);e=="-Empty-"&&(e=""),a.push(e.toLocaleLowerCase())}));var l=e.hasClass("inverse"),i=e.parent();if(0!=a.length){var r=[];t.rawTables.forEach((function(e,i){r[i]=[];var s=e[0]||[];s.forEach((function(e,n){l!=$.inArray(o.a.clearStringLowerCase(e),a)>=0&&(r[i].push(n),n==s.length-1&&(t.updateSparkline=!1))}))})),i.data("state",r)}else i.data("state",[])},f.prototype.showOrHide=function(e,t,a,l,i){var r=this,s=0;if(t>r.headerSize[e])if(!r.cbState[e][t-1]&&i<t)$(a).find("td[rowspan], th[rowspan]").trigger("hideCell"),a.style.display="none";else if(r.numbering&&(-1!=r.numbering.indexOf("dynamic")||"true"==r.numbering)){var o=a.children[0];o.classList.contains("tf-numbering")&&(o.children[0].textContent=l,r.rawTables[e][t][0]=""+l),s=1}if(r.tdNumbers&&r.tdNumbers[e].length){var n=a.children;$.each(r.tdNumbers[e],(function(e,t){$(n[t]).trigger("hideCol").addClass("tf-hidden-column")}))}return s},f.prototype.showTableWithoutFilters=function(){var e=this,t=e.showNRows;e.showNRows="all",e.showTable(!0),e.showOrHideTables(),e.showNRows=t,e.appendTotalRow(),e.appendTotalCol(),e.appendSparklines(),e.sparkline&&e.fixedRows>0&&e.updateFixedCells()},f.prototype.showOrHideTables=function(){var e=this,t=0,a=0;e.tables.each((function(l){var i=$(this),r=e.rows[l],s=i.hasClass("relative-table");r.children(".tf-hidden-column").removeClass("tf-hidden-column"),r.children("[colspan]").each((function(){var e=$(this);e.attr("colspan",$.data(e[0],"colspan"))}));var n=i.children("colgroup").children("col");if(s){var c=0,d=[];n.each((function(){"none"===this.style.display?c+=parseFloat(this.style.width):d.push(this)})),c>0&&(i.css("width",parseFloat(i[0].style.width)/(1-c/100)+"%"),d.forEach((function(e){e.style.width=parseFloat(e.style.width)*(1-c/100)+"%"})))}n.show();var p=i.find("tr.pivot-header, thead.tableFloatingHeader tr");if(p.children(".tf-hidden-column").removeClass("tf-hidden-column"),e.tdNumbers&&e.tdNumbers[l].length){c=0;$.each(e.tdNumbers[l],(function(e,t){n.eq(t).hide(),s&&(c+=parseFloat(n[t].style.width)),p.each((function(){$(this).find("th, td").eq(t).trigger("hideCol").addClass("tf-hidden-column")}))})),c>0&&(i.css("width",parseFloat(i[0].style.width)*(1-c/100)+"%"),n.each((function(t){-1===e.tdNumbers[l].indexOf(t)&&(this.style.width=parseFloat(this.style.width)/(1-c/100)+"%")})))}i.is(".attachments")&&i.find(".attachment-summary").each((function(t){e.cbState[l][t]||($(this).addClass("hidden"),r.eq(t+1).find(".icon-section-opened").removeClass("icon-section-opened").addClass("icon-section-closed"))}));var f=r.children(".fake").hide();r.children("td[rowspan], th[rowspan]").each((function(){this.rowSpan=$.data(this,"rowspan")||1})),r.css("display",""),t+=r.length-1;var u=/^\d+\*$/i.test(e.showNRows)&&0!=e.showNRows&&e.showNRows.indexOf("*")===e.showNRows.length-1?parseInt(e.showNRows.replace("*","")):-1,b=$.grep(e.cbState[l],(function(e,t){return e||u>t})).length,h=1,m=1;if(e.numbering&&-1!=e.numbering.indexOf("desc")&&(h=b,m=-1),r.each((function(t){h+=e.showOrHide(l,t,this,h,u)*m})),/^\d+\+?$/i.test(e.showNRows)&&(0!=e.showNRows&&e.showNRows.indexOf("+")!=e.showNRows.length-1||b==r.length-1)){var v=e.showNRows.replace("+","");r.filter((function(){return o.a.isRowVisible(this)})).filter(":gt("+v+")").hide(),b=Math.min(b,v)}e.editorMacro&&(f.filter("[rowspan]:not(:visible)").attr("rowspan",-1),f.filter("[colspan]:not(:visible)").attr("colspan",-1)),a+=b}));var l=e.comboBoxDiv.find(".filter-logo");t==a?l.removeClass("filtered").addClass("default").attr("title",AJS.format("Nothing filtered. Showing {0} rows",t)):l.removeClass("default").addClass("filtered").attr("title",AJS.format("Showing {0} of {1} rows",a,t)),e.resize&&e.resize();var i={id:"tf-table-"+e.macroId,tf:e,macroId:e.macroId};e.blockEvent||e.tableWrapper.trigger("tf-filtered",i),e.tables.trigger("tf-filtered-charts").trigger("scroll-tf"),e.comboBoxDiv.parents(".tablefilter-table-wrapper, .pivot-content, table").eq(0).data("inner-filter",i)},f.prototype.appendSparklines=function(){var e=this;if(e.pauseUpdate=!0,e.setMutationObserver(!0),e.spakLinesFinished=!0,e.sparkline)e.rows.forEach((function(t,a){!function(t,a){var l=null,i=0;function r(e){return(e.find(":first-child").attr("class")||"").replace("tf-numbering","").replace("tf-hidden-column","")}t.each((function(s,n){var c=$(n);c.find(".tf-sparkline-header, .tf-sparkline-container").remove();var d=r(c);if(0===s){if(c.append($('<th class="'.concat(d,' tf-sparkline-header synchrony-exclude" contenteditable="false" data-sorter="false"></th>')).text(e.sparkName)),n.classList.contains("tf-header-hidden")){var f=$(a).find("tr.pivot-header"),u=f.eq(0);u.find(".tf-sparkline-header").remove(),u.append($('<th class="'.concat(r(u),' tf-sparkline-header synchrony-exclude" contenteditable="false" data-sorter="false" rowspan="').concat(f.length,'">\n                              </th>')).text(e.sparkName))}}else{var b=[];c.children("td, th").not(".tf-numbering, .total-col, .numberingColumn").each((function(t){if($(this).hasClass("tf-hidden-column"))return!0;var a=o.a.clearString(this.textContent);null==l&&a&&(l=o.a.getValueType(a,e.separator,e.worklog,!0));var i=o.a.parseValueByType(l,a,e.separator,e.worklog,!0);isNaN(i)||b.push(i)}));var h=$('<td class="'.concat(d,' tf-sparkline-container synchrony-exclude" contenteditable="false"></td>'));if(function(e,t){var a=100,l=25,i=$('<svg xmlns="http://www.w3.org/2000/svg"/>').attr("width",a).attr("height",l),r=$(document.createElementNS("http://www.w3.org/2000/svg","path")).attr("d",function(e){if(e.length>1){var t=a/(e.length-1),i=Math.min.apply(Math,p(e)),r=Math.max.apply(Math,p(e))-i,s=0===r?l/2:l/r,o=e.map((function(e,a){return[t*a,0===r?s:l-s*(e-i)]}));return"M".concat(o.join("L"))}return""}(t)).attr("style","stroke: rgb(100, 100, 255); stroke-width: 1; fill: none;");i.append(r),e.append(i)}(h,b),c.append(h),!e.editorMacro){var m=c.find("svg").attr("version",1.1).prop("outerHTML");if("undefined"!=typeof btoa&&m){h.append("<canvas></canvas>");var v="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(m))),g=c.find("canvas").attr("width",100).attr("height",25)[0],w=g.getContext("2d"),y=new Image;y.src=v,y.onload=function(){w.drawImage(y,0,0);var e=g.toDataURL("image/png"),l='<img src="'.concat(e,'">');h.html(l),++i===t.length-1&&$(a).trigger("sparklines-converted")}}}}}))}(t.add(e.totalRows[a]),e.tables[a])})),e.updateSorterAndRawTables(!0),e.pauseUpdate=!1,e.setMutationObserver(!0);else{var t=e.tableWrapper.find(".tf-sparkline-header, .tf-sparkline-container"),a=t.length;t.remove(),e.updateSorterAndRawTables(a>0),e.pauseUpdate=!1,e.setMutationObserver(!0)}},f.prototype.appendTotalRow=function(){var e=this;if(e.pauseUpdate=!0,e.setMutationObserver(!0),e.tables.find("tr.total-row").remove(),e.totalRows=[],e.totalRow.length){var t=0;e.tableUpdated=!0,e.rawTables.forEach((function(a,l){for(var i={},r=e.numbering?1:0,s=e.rows[l].eq(0).children().not(".tf-sparkline-header, .total-col").length-r,n=t;n<s+t;n++)if(e.totalRow[n]){var c=h,p=!1,f=!1,y=!1;"Sum"==e.totalRow[n]?c=b:"Min"==e.totalRow[n]?c=m:"Max"==e.totalRow[n]?c=v:"Multiplication"==e.totalRow[n]?c=u:"Count"==e.totalRow[n]?(c=g,f=!0):"Count not empty"==e.totalRow[n]?(c=g,y=!0):p=!0,i[n-t+r]={calc:c,isAvg:p,isCount:f,isCountA:y}}t+=s;var x=null;if(Object.keys(i).length){var T={},C={};a.forEach((function(t,a){a>0&&o.a.isRowVisible(e.rows[l][a])&&$.each(i,(function(i,r){if(r.isCount)r.calc();else if(r.isCountA)(t[i]||e.rawIconTables[l][a][i])&&r.calc();else{null==T[i]&&t[i]&&(T[i]=o.a.getValueType(t[i],e.separator,e.worklog));var s=o.a.parseValueByType(T[i],t[i],e.separator,e.worklog);o.a.isNumber(s)&&(r.calc(s),T[i]!==o.a.number||C[i]||(C[i]=o.a.getNumberFormatter(t[i])))}}))}));var S=!1,k=!0;if($.each(i,(function(t,a){a.total=o.a.formatValueByType(a.total,T[t],(function(l){if(void 0!==l){S=!0,a.isAvg&&(l=w(l));var i=e.formatDecimal.to(l);return C[t]?C[t](i):i}return""}),e.worklog),""!==a.total&&(S=!0)})),S){if(x=$(d.a.totalRow({title:e.totalRowName,length:s+r,totals:i,numbering:r})),e.tdNumbers&&e.tdNumbers[l].length){k=!1;var I=x.children("td,th");$.each(e.tdNumbers[l],(function(e,t){I.eq(t).addClass("tf-hidden-column")})),$.each(I,(function(e,t){if(t.textContent&&!$(t).hasClass("tf-hidden-column"))return k=!0,!1}))}k&&e.tables.eq(l).append(x)}}e.totalRows.push(x),e.updateSorterAndRawTables(!1,!0)}))}e.pauseUpdate=!1,e.setMutationObserver(!0)},f.prototype.appendTotalCol=function(){var e=this;if(!o.a.hasLoadingContent(e.tableWrapper)){e.pauseUpdate=!0,e.setMutationObserver(!0);var t=!1;if(e.totalCol){var a=h,l=!1,i=e.totalCol;"Sum"==e.totalCol?a=b:"Min"==e.totalCol?a=m:"Max"==e.totalCol?a=v:"Multiplication"==e.totalCol?(a=u,i="Product"):l=!0,i=e.totalColName?e.totalColName:i,e.tables.each((function(t){var r=null,s=null;if(e.rows[t].length&&e.rows[t][0].classList.contains("tf-header-hidden")){var n=$(this).find("tr.pivot-header"),c=n.eq(0);if(0===c.children("th.total-col").length){var p=$('<th class="total-col confluenceTh" rowspan="'.concat(n.length,'"></th>')).text(i);c.append(p)}}e.rows[t].add(e.totalRows[t]).each((function(t){for(var n={calc:a},c=this.children,p=null,f=c.length-1;f>=0;f--)if(c[f].classList.contains("total-col")){p=$(c[f]);break}if(p||(p=$(d.a.totalCol({rowNumber:t})),$(this).append(p)),0===t)p.find("p").text(i);else{for(f=0;f<c.length;f++){var u=c[f];if(!u.classList.contains("tf-numbering")&&!u.classList.contains("total-col")&&!u.classList.contains("numberingColumn")){if(!u.classList.contains("tf-hidden-column")){var b=o.a.clearString(u.textContent);null==r&&b&&(r=o.a.getValueType(b,e.separator,e.worklog,!0));var h=o.a.parseValueByType(r,b,e.separator,e.worklog,!0);o.a.isNumber(h)&&(n.calc(h),r!==o.a.number||s||(s=o.a.getNumberFormatter(b)))}0}}var m=o.a.formatValueByType(n.total,r,(function(t){if(void 0===t)return"";l&&(t=w(t));var a=e.formatDecimal.to(t);return s?s(a):a}),e.worklog),v=p.attr("contenteditable","false").children("p");v.length||(v=$("<p></p>"),p.prepend(v)),v.text(m)}}))})),t=!0}else{var r=e.tables.find("th.total-col");r.length&&(t=!0,r.remove())}return t&&e.updateSorterAndRawTables(!0,!0),e.pauseUpdate=!1,e.setMutationObserver(!0),t}},f.prototype.updateSorterAndRawTables=function(e,t){var a=this;a.shouldUpdateSorter=a.shouldUpdateSorter||t,a.shouldUpdateRawTables=a.shouldUpdateRawTables||e,a.spakLinesFinished&&(a.shouldUpdateSorter&&(a.tables.not(".pivot-table-result").trigger("updateAll",!1),a.tables.not(".pivot-table-result").trigger("update",!1)),a.shouldUpdateRawTables&&a.updateRawTables(),a.shouldUpdateSorter=!1,a.shouldUpdateRawTables=!1,a.spakLinesFinished=!1)},f.prototype.bindChangeLabel=function(){var e=this;e.comboBoxDiv.delegate(".filter-container label.hideble","dblclick",(function(){var t=$(this).find(".tf-label-name"),a=!0,l=$(this).parent(),i=t.css("width");t.hide(),l.prepend(d.a.labelChanger({value:t.text(),width:parseInt(i,10)+6+"px"}));var r=!1,s=l.find(".tf-label-changer");s.focus(),s.bind("keydown",(function(l){13==l.keyCode&&(t.text(s.val()),s.remove(),t.show(),a=!1,e.enableSaveBtn()),32==l.keyCode&&(r=!0)})),s.bind("input",(function(){var e=s.textWidth(s.html())+6;r&&(e+=4,r=!1),s.css("width",(e<10?10:e)+"px")})),$(document).one("click",(function(e){!$(e.target).closest(".tf-label-changer").length&&a&&(s.remove(),t.show(),a=!1)}))})),$.fn.textWidth=function(e,t){return $.fn.textWidth.fakeEl||($.fn.textWidth.fakeEl=$("<span>").hide().appendTo(document.body)),$.fn.textWidth.fakeEl.text(e||this.val()||this.text()).css("font",t||this.css("font")),$.fn.textWidth.fakeEl.width()}},f.prototype.getFilterLabels=function(){var e=this,t=[];return a(".selectfilter-element"),a(".userfilter-element"),a(".numberfilter-element"),a(".datefilter-element"),a(".globalfilter-element"),a(".columnhider-element"),a(".iconfilter-element"),t.join("‚");function a(a){e.comboBoxDiv.find(a+" .tf-label-name").each((function(){t.push($(this).text())}))}},f.prototype.setPagination=function(){var e=this;e.pageSize&&e.tables.each((function(t){$(this),e.cbState[t].reduce((function(e){return!e}))}))},t.a=f},13:function(e,t){if(window.TableFilterTemplate=window.TableFilterTemplate||{},void 0===a)var a={};a.totalRow=function(e,t){for(var a='<tr class="total-row synchrony-exclude">',l=e.length,i=0;i<l;i++)a+=1==e.numbering&&0==i?'<td class="confluenceTd" contenteditable="false"></td>':'<th class="confluenceTh '+(e.totals[i]?"number":"")+'" contenteditable="false">'+(e.totals[i]?soy.$$escapeHtml(e.totals[i].total):i-e.numbering==0?e.title?soy.$$escapeHtml(e.title):soy.$$escapeHtml("Total\u200b"):"")+"</th>";return a+="</tr>"},goog.DEBUG&&(a.totalRow.soyTemplateName="TableFilterTemplate.totalRow"),a.totalCol=function(e,t){return'<th class="total-col synchrony-exclude confluenceTh '+(e.rowNumber>0?"number":"")+'" contenteditable="false"><p></p></th>'},goog.DEBUG&&(a.totalCol.soyTemplateName="TableFilterTemplate.totalCol"),a.labelChanger=function(e,t){return'<input class="tf-label-changer text" onfocus="this.select();" type="text" value="'+soy.$$escapeHtml(e.value)+'" style="width: '+soy.$$escapeHtml(e.width)+';" title="'+soy.$$escapeHtml("Press the Enter button to change the filter label")+'">'},goog.DEBUG&&(a.labelChanger.soyTemplateName="TableFilterTemplate.labelChanger"),a.editorCloseButton=function(e,t){return'<div class="aui-buttons close"><button type="button" class="aui-button" data-tooltip="'+soy.$$escapeHtml("Close")+'" original-title=""><span class="icon icon-close aui-icon aui-icon-small aui-iconfont-close-dialog">'+soy.$$escapeHtml("Close")+"</span></button></div>"},goog.DEBUG&&(a.editorCloseButton.soyTemplateName="TableFilterTemplate.editorCloseButton"),a.addFilterDialog=function(e,t){var a='<form class="aui top-label inline-dialog-form tf-add-filter-dialog" style="padding: 10px">';if(e.filters.length>0||e.globalfilter||e.columnhider){for(var l=e.filters,i=l.length,r=0;r<i;r++){var s=l[r];a+='<div class="'+soy.$$escapeHtml(s.type)+' tf-add-filter-column"><label for="'+soy.$$escapeHtml(s.type)+'">'+soy.$$escapeHtml("Filter Column")+'</label><select class="select '+soy.$$escapeHtml(s.type)+'" name="'+soy.$$escapeHtml(s.type)+'">';for(var o=s.columns,n=o.length,c=0;c<n;c++){var d=o[c];a+='<option value="'+soy.$$escapeHtml(d)+'">'+soy.$$escapeHtml(d)+"</option>"}a+="</select></div>"}a+='<div><label for="filter-type">'+soy.$$escapeHtml("Filter Type")+'</label><select class="select filter-type" name="filter-type">';for(var p=e.filters,f=p.length,u=0;u<f;u++){var b=p[u];a+='<option value="'+soy.$$escapeHtml(b.type)+'" title="'+soy.$$escapeHtml(b.desc)+'">'+soy.$$escapeHtml(b.name)+"</option>"}a+=(e.globalfilter?'<option value="globalfilter" title="'+soy.$$escapeHtml("Enter custom text query or regular expression to filter data in the whole table")+'">'+soy.$$escapeHtml("Global Filter")+"</option>":"")+(e.columnhider?'<option value="columnhider" title="'+soy.$$escapeHtml("Select table columns to hide")+'">'+soy.$$escapeHtml("Hide Columns")+"</option>":"")+'</select></div><div class="date-format-param"><label for="date-format-input">'+soy.$$escapeHtml("Date format")+'</label><input class="date-format-input text" type="text" value="'+soy.$$escapeHtml(e.dateFormat)+'"></div><div class="buttons-container"><div class="buttons"><input class="aui-button" type="button" value="'+soy.$$escapeHtml("Add filter")+'" id="save"/><a class="cancel" id="cancel">'+soy.$$escapeHtml("Cancel")+"</a></div></div>"}else a+='<div class="aui-message info aui-message-info"><p>'+soy.$$escapeHtml("Filters are not available")+'</p></div><div class="buttons-container"><div class="buttons"><a class="cancel" id="cancel">'+soy.$$escapeHtml("Cancel")+"</a></div></div>";return a+="</form>"},goog.DEBUG&&(a.addFilterDialog.soyTemplateName="TableFilterTemplate.addFilterDialog"),a.changeSettingsDialog=function(e,t){return'<form class="aui top-label inline-dialog-form" style="padding: 10px" onsubmit="return false;"><div class="change-settings-dialog-parameter"><label for="tf-cs-dialog-datepattern">'+soy.$$escapeHtml("Date format")+'</label><input type="text" class="text" id="tf-cs-dialog-datepattern" value="'+soy.$$escapeHtml(e.datepattern)+'"></div><div class="buttons-container"><div class="buttons"><input class="aui-button" type="button" value="'+soy.$$escapeHtml("Update")+'" id="tf-cs-save"/><a class="cancel" id="tf-cs-cancel">'+soy.$$escapeHtml("Cancel")+"</a></div></div></form>"},goog.DEBUG&&(a.changeSettingsDialog.soyTemplateName="TableFilterTemplate.changeSettingsDialog"),a.filter=function(e,t){return"selectfilter"==e.type?'<div class="filter-container selectfilter-element sortable"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.column)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="select" name="'+soy.$$escapeHtml(e.column)+'" style="width: 150px;" multiple data-width="150px"></select></div>':"userfilter"==e.type?'<div class="filter-container userfilter-element sortable input"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.column)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="tf-resizeable" style="width: 150px;"><input class="user-filter text" type="text" name="'+soy.$$escapeHtml(e.column)+'" style="width: 100%; max-width: none;" placeholder="'+soy.$$escapeHtml("Start typing...\u200b")+'" data-width="150px"/></div></div>':"numberfilter"==e.type?'<div class="filter-container numberfilter-element sortable"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.column)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="range numbers" name="'+soy.$$escapeHtml(e.column)+'">'+soy.$$escapeHtml("from")+'<input class="number from text" type="text" name="'+soy.$$escapeHtml(e.column)+'" style="width: 90px;" placeholder="'+soy.$$escapeHtml("Type value")+'"/>'+soy.$$escapeHtml("to")+'<input class="number to text" type="text" name="'+soy.$$escapeHtml(e.column)+'" style="width: 90px;" placeholder="'+soy.$$escapeHtml("Type value")+'"/></div></div>':"datefilter"==e.type?'<div class="filter-container datefilter-element sortable"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.column)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="range dates" name="'+soy.$$escapeHtml(e.column)+'">'+soy.$$escapeHtml("from")+'<input class="date from text" type="text" name="'+soy.$$escapeHtml(e.column)+'" style="width: 93px;" placeholder="'+soy.$$escapeHtml("Pick date")+'"/>'+soy.$$escapeHtml("to")+'<input class="date to text" type="text" name="'+soy.$$escapeHtml(e.column)+'" style="width: 93px;" placeholder="'+soy.$$escapeHtml("Pick date")+'"/></div></div>':"globalfilter"==e.type?'<div class="filter-container globalfilter-element sortable input"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml("Global filter")+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="tf-resizeable" style="width: 150px;"><input class="global-filter text" type="text" style="width: 100%; max-width: none;" placeholder="'+soy.$$escapeHtml("Start typing...\u200b")+'" data-width="150px"/></div></div>':"columnhider"==e.type?'<div class="filter-container columnhider-element sortable"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml("Hide columns")+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="column-select" style="width: 150px;" multiple data-width="150px"></select></div>':"iconfilter"==e.type?'<div class="filter-container iconfilter-element sortable"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.column)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="icon-select" name="'+soy.$$escapeHtml(e.column)+'" style="width: 150px;" multiple data-width="150px" data-html="true"></select></div>':""},goog.DEBUG&&(a.filter.soyTemplateName="TableFilterTemplate.filter"),a.panel=function(e,t){var a='<div class="tablefilter-outer-wrapper'+(e.isCloud?" tf-cloud-macro":"")+" "+(e.hideLabels?"hide-labels":"")+" "+(e.hidePane?"hide-pane":"")+(e.hideControls?" hide-controls":"")+'" data-id="'+soy.$$escapeHtml(e.macroId)+'" data-pageid="'+soy.$$escapeHtml(e.pageId)+'" data-export-hash="'+soy.$$escapeHtml(e.exportHash)+'" data-sessionid="'+soy.$$escapeHtml(e.sessionId)+'">';if(!e.isEmail){a+='<div id="comboBoxDiv-'+soy.$$escapeHtml(e.macroId)+'" class="tableFilterCbStyle"><div class="lockDisabled not-empty"><form class="aui tf-form" name="inlinecommentform" onsubmit="return false;" onkeydown="return event.keyCode != 13;"><div class="filter-container filter-icon filter-logo default '+(e.fd?"tf-fd":"")+'" title="'+soy.$$escapeHtml(AJS.format("Nothing filtered. Showing {0} rows",0))+'"></div><div class="filter-buttons-container"><div class="tf-menu-buttons aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="tf-btn-container"><div class="tf-btn-row"><button class="filter-reset aui-button aui-button-subtle" title="'+soy.$$escapeHtml("Reset all filters")+'"></button><button class="disableLock aui-button aui-button-subtle" title="'+soy.$$escapeHtml("Disable all filters")+'"></button></div><div id="tf-settings-row-'+soy.$$escapeHtml(e.macroId)+'" class="tf-btn-row"><div class="tf-settings-wrapper"><button id=\'filter-settings-'+soy.$$escapeHtml(e.macroId)+'\' class="filter-settings aui-button aui-button-subtle aui-dropdown2-trigger" aria-owns="filter-menu-view-'+soy.$$escapeHtml(e.macroId)+"-"+soy.$$escapeHtml(e.pageId)+'" aria-haspopup="true" data-container="" resolved="" aria-expanded="false"><span class="aui-icon aui-icon-small aui-iconfont-configure"></span><span class="tfac-unsaved">*</span></button><div id="filter-menu-view-'+soy.$$escapeHtml(e.macroId)+"-"+soy.$$escapeHtml(e.pageId)+'" class="aui-style-default aui-dropdown2" style="display: none; z-index: 3001;"><div class="aui-dropdown2-section"><ul class="aui-list-truncate first">'+(e.editable&&!e.disableSave?'<li><a class="filter-save cursor-pointer tf-disabled-link">'+soy.$$escapeHtml("Save changes")+'<span class="tfac-unsaved">*</span></a></li>':"")+'<li><a class="filter-add cursor-pointer">'+soy.$$escapeHtml("Add filter")+'</a></li><li><a class="filter-sort-reset cursor-pointer tf-disabled-link">'+soy.$$escapeHtml("Reset column sorting")+'</a></li><li><a class="export-file-pdf cursor-pointer">'+soy.$$escapeHtml("Export to PDF")+'</a></li><li><a class="export-file-csv cursor-pointer">'+soy.$$escapeHtml("Export to CSV")+'</a></li><li><a class="export-file-doc cursor-pointer">'+soy.$$escapeHtml("Export to Word")+'</a></li><li><a class="get-tf-url cursor-pointer"'+(e.isCloud?'style="display: none;"':"")+">"+soy.$$escapeHtml("Copy the filter URL")+'</a></li><li><a class="tf-change-settings cursor-pointer">'+soy.$$escapeHtml("Modify Settings")+'</a></li></ul></div><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a target="_blank" href="https://docs.stiltsoft.com/display/TFAC/How+to+use+Table+filter+macro?from=tf-view">'+soy.$$escapeHtml("Documentation")+'</a></li><li><a target="_blank" href="https://docs.stiltsoft.com/display/TFAC/Table+Filter+and+Charts+5.3.0?from=tf-view">'+soy.$$escapeHtml("What\u0027s new")+'</a></li><li><a target="_blank" href="https://www.surveygizmo.com/s3/3338736/Table-Filter-and-Charts-Survey?platform='+(e.isCloud?"cloud":"server")+'" class="tf-menu-star"><span><span class="aui-icon aui-icon-small aui-iconfont-star"></span>'+soy.$$escapeHtml("Rate our app")+'</span></a></li></ul></div></div></div></div></div></div></div></div></div><div class="sortable-container">';for(var l=e.comboBoxes,i=l.length,r=0;r<i;r++){var s=l[r];a+='<div class="filter-container selectfilter-element sortable '+(s.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(s.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="select '+(s.inverse?"inverse":"")+'" name="'+soy.$$escapeHtml(s.name)+'" style="width: '+soy.$$escapeHtml(s.columnWidth)+'px;" multiple data-width="'+soy.$$escapeHtml(s.columnWidth)+'px">';for(var o=s.options,n=o.length,c=0;c<n;c++){var d=o[c];a+='<option selected="selected"'+("-Empty-"==d?'class="tf-empty-option">'+soy.$$escapeHtml("-Empty-"):">"+soy.$$escapeHtml(d))+"</option>"}a+="</select></div>"}for(var p=e.edits,f=p.length,u=0;u<f;u++){var b=p[u];a+='<div class="filter-container userfilter-element sortable input '+(b.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(b.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="tf-resizeable" style="width: '+soy.$$escapeHtml(b.columnWidth)+'px;"><input class="user-filter text '+(b.inverse?"inverse":"")+'" type="text" name="'+soy.$$escapeHtml(b.name)+'" style="width: 100%; max-width: none;" value="'+soy.$$escapeHtml(b.defaultValue)+'" placeholder="'+soy.$$escapeHtml("Start typing...\u200b")+'" data-width="'+soy.$$escapeHtml(b.columnWidth)+'px"/></div></div>'}for(var h=e.numberFilters,m=h.length,v=0;v<m;v++){var g=h[v];a+='<div class="filter-container numberfilter-element sortable '+(g.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(g.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="range numbers" name="'+soy.$$escapeHtml(g.name)+'">'+soy.$$escapeHtml("from")+'<input class="number from text '+(g.inverse?"inverse":"")+'" type="text" name="'+soy.$$escapeHtml(g.name)+'" style="width: 90px;" value="'+soy.$$escapeHtml(g.defaultFromValue)+'" placeholder="'+soy.$$escapeHtml("Type value")+'"/>'+soy.$$escapeHtml("to")+'<input class="number to text '+(g.inverse?"inverse":"")+'" type="text" name="'+soy.$$escapeHtml(g.name)+'" style="width: 90px;" value="'+soy.$$escapeHtml(g.defaultToValue)+'" placeholder="'+soy.$$escapeHtml("Type value")+'"/></div></div>'}for(var w=e.dateFilters,y=w.length,$=0;$<y;$++){var x=w[$];a+='<div class="filter-container datefilter-element sortable '+(x.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(x.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="range dates" name="'+soy.$$escapeHtml(x.name)+'">'+soy.$$escapeHtml("from")+'<input class="date from text '+(x.inverse?"inverse":"")+'" type="text" name="'+soy.$$escapeHtml(x.name)+'" style="width: 93px;" value="'+soy.$$escapeHtml(x.defaultFromValue)+'" placeholder="'+soy.$$escapeHtml("Pick date")+'"/>'+soy.$$escapeHtml("to")+'<input class="date to text '+(x.inverse?"inverse":"")+'" type="text" name="'+soy.$$escapeHtml(x.name)+'" style="width: 93px;" value="'+soy.$$escapeHtml(x.defaultToValue)+'" placeholder="'+soy.$$escapeHtml("Pick date")+'"/></div></div>'}for(var T=e.iconFilters,C=T.length,S=0;S<C;S++){var k=T[S];a+='<div class="filter-container iconfilter-element sortable '+(k.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(k.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="icon-select '+(k.inverse?"inverse":"")+'" name="'+soy.$$escapeHtml(k.name)+'" style="width: '+soy.$$escapeHtml(k.columnWidth)+'px;" multiple data-width="'+soy.$$escapeHtml(k.columnWidth)+'px" data-html="true">';for(var I=k.options,D=I.length,F=0;F<D;F++){var A=I[F];a+='<option selected="selected"'+("-Empty-"==A?'class="tf-empty-option">'+soy.$$escapeHtml("-Empty-"):">"+soy.$$escapeHtml(A))+"</option>"}a+="</select></div>"}if(a+=e.globalFilter?'<div class="filter-container globalfilter-element sortable input '+(e.globalFilter.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.globalFilter.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><div class="tf-resizeable" style="width: '+soy.$$escapeHtml(e.globalFilter.columnWidth)+'px;"><input class="global-filter text '+(e.globalFilter.inverse?"inverse":"")+'" type="text" style="width: 100%; max-width: none;" value="'+soy.$$escapeHtml(e.globalFilter.defaultValue)+'" placeholder="'+soy.$$escapeHtml("Start typing...\u200b")+'" data-width="'+soy.$$escapeHtml(e.globalFilter.columnWidth)+'px"/></div></div>':"",e.hideColumns){a+='<div class="filter-container columnhider-element sortable '+(e.hideColumns.inverse?"inverse":"")+'"><label class="hideble"><span class="tf-label-name" title="'+soy.$$escapeHtml("Drag to reorder/remove the filter\nDouble-click to edit the filter label")+'">'+soy.$$escapeHtml(e.hideColumns.label)+'</span><span class="eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;=</span><span class="not-eq" title="'+soy.$$escapeHtml("Click to reverse the filter")+'">&nbsp;&ne;</span></label><select class="column-select '+(e.hideColumns.inverse?"inverse":"")+'" style="width: '+soy.$$escapeHtml(e.hideColumns.columnWidth)+'px;" multiple data-width="'+soy.$$escapeHtml(e.hideColumns.columnWidth)+'px">';for(var H=e.hideColumns.options,B=H.length,J=0;J<B;J++){var R=H[J];a+='<option selected="selected"'+("-Empty-"==R?'class="tf-empty-option">'+soy.$$escapeHtml("-Empty-"):">"+soy.$$escapeHtml(R))+"</option>"}a+="</select></div>"}a+='</div><div class="filter-container show-n-rows-only-message"><label>'+soy.$$escapeHtml(AJS.format("Showing the first {0} rows",e.showNRows))+'</label></div><div class="filter-container empty-message"><label>'+soy.$$filterNoAutoescape("Start \u003ca class=\u0022tf-add-start\u0022\u003eadding filters\u003c/a\u003e in the filter tools menu.")+'</label></div></form></div><div class="lockEnabled"><div class="filter-container filter-icon filter-logo default" title="'+soy.$$escapeHtml(AJS.format("Nothing filtered. Showing {0} rows",0))+'"></div><div class="lockPosition"><div class="filter-container"><label class="hideble">'+soy.$$escapeHtml("The filter is disabled at the moment.")+'</label></div><div class="tf-menu-buttons aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="tf-btn-container"><div class="tf-btn-row"><button class="filter-reset aui-button aui-button-subtle" disabled="disabled"></button><button class="enableLock aui-button aui-button-subtle" title="'+soy.$$escapeHtml("Enable all filters")+'"></button></div><div class="tf-btn-row settings-row"><div class="tf-settings-wrapper"><button class="filter-settings aui-button aui-button-subtle aui-dropdown2-trigger" aria-owns="filter-menu-view-lock-'+soy.$$escapeHtml(e.macroId)+"-"+soy.$$escapeHtml(e.pageId)+'"><span class="aui-icon aui-icon-small aui-iconfont-configure"></span></button><div id="filter-menu-view-lock-'+soy.$$escapeHtml(e.macroId)+"-"+soy.$$escapeHtml(e.pageId)+'" class="aui-style-default aui-dropdown2" style="display: none; z-index: 3001;"><div class="aui-dropdown2-section"><ul class="aui-list-truncate first"><li><a class="export-file-pdf cursor-pointer">'+soy.$$escapeHtml("Export to PDF")+'</a></li><li><a class="export-file-csv cursor-pointer">'+soy.$$escapeHtml("Export to CSV")+'</a></li><li><a class="export-file-doc cursor-pointer">'+soy.$$escapeHtml("Export to Word")+'</a></li></ul></div><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a target="_blank" href="https://docs.stiltsoft.com/display/TFAC/How+to+use+Table+filter+macro?from=tf-view">'+soy.$$escapeHtml("Documentation")+'</a></li><li><a target="_blank" href="https://docs.stiltsoft.com/display/TFAC/Table+Filter+and+Charts+5.3.0?from=tf-view">'+soy.$$escapeHtml("What\u0027s new")+'</a></li><li><a target="_blank" href="https://www.surveygizmo.com/s3/3338736/Table-Filter-and-Charts-Survey?platform='+(e.isCloud?"cloud":"server")+'" class="tf-menu-star"><span><span class="aui-icon aui-icon-small aui-iconfont-star"></span>'+soy.$$escapeHtml("Rate our app")+'</span></a></li></ul></div></div></div></div></div></div></div></div></div></div><div class="filter-container no-table-message"><div class="aui-message info aui-message-info"><p>'+soy.$$escapeHtml("Oops, it seems that you need to place a table or a macro generating a table within the Table Filter macro.")+'</p></div></div><div class="filter-container waiting-for-table"><div class="aui-message info aui-message-info"><p>'+soy.$$escapeHtml("The table is being loaded. Please wait for a bit ...")+'<span class="aui-icon aui-icon-wait" style="margin-left: 5px"></span></p></div></div><div class="tf-hider-wrapper" title="'+soy.$$escapeHtml("Hide filtration pane")+'"><div class="tf-hider"><span class="tf-hide-show-icon"></span></div></div></div><div id="tf-shower-'+soy.$$escapeHtml(e.macroId)+'" class="tf-shower-wrapper" title="'+soy.$$escapeHtml("Show filtration pane")+'"><div class="tf-shower"><span class="tf-hide-show-icon"></span></div></div>'}return a+=(e.isEditor?"":'<div id="tf-table-'+soy.$$escapeHtml(e.macroId)+'" class="tablefilter-table-wrapper '+(e.isCloud?"tf-cloud-table":"")+'">'+soy.$$filterNoAutoescape(e.body)+"</div>")+"</div>"},goog.DEBUG&&(a.panel.soyTemplateName="TableFilterTemplate.panel"),a.fail=function(e,t){return'<div class="tablefilter-outer-wrapper error"><div class="tableFilterCbStyle"><div class="filter-container"><div class="aui-message warning aui-message-warning"><p>'+("no_table"==e.failureCause?"Oops, it seems that you need to place a table or a macro generating a table within the Table Filter macro.":"license"==e.failureCause?AJS.format("Table Filter Plugin license is not active, please \u003ca href=\u0022{0}/plugins/servlet/upm#manage/com.stiltsoft.confluence.plugin.tablefilter.tablefilter\u0022\u003egenerate a trial license or purchase\u003c/a\u003e the product.",e.contextPath):"bad_request"==e.failureCause?"Oops! We are sorry but the Table Filter macro cannot be previewed on Confluence page.":"no_params"==e.failureCause?"table-filter.fail.no-params = Oops! It seems that the macro body is not reachable as the macro ID parameter is missing.":"Oops! We are sorry but the current complex table cannot be filtered.")+'</p></div></div></div><div class="tablefilter-table-wrapper">'+e.body+"</div></div>"},goog.DEBUG&&(a.fail.soyTemplateName="TableFilterTemplate.fail"),e.exports=a},59:function(e,t){$.fn.tableHeadFixer=function(e){return this.each((function(){t.call(this)}));function t(){var t=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)?'contenteditable="false"':"",a='<span class="tf-fixed-column-border left synchrony-exclude" '+t+'></span><span class="tf-fixed-column-border right synchrony-exclude" '+t+'></span><span class="tf-fixed-column-border bottom synchrony-exclude" '+t+"></span>",l=$.extend({},{head:!0,foot:!1,left:0,right:0,"z-index":1},e);function i(){if(l.head>0){var e=l.parent.scrollTop();l.headCells.css("top",e)}if(l.left>0){var t=l.parent.scrollLeft();l.leftColumns.css("left",t)}}function r(e,t){for(var a=l.left,i=0;i<a;i++){var r=e.children[i];if(r){var s=r.colSpan>1;s&&(i+=r.colSpan-1),r&&(!s||$(r).position().left+r.clientWidth<l.parentWidth)&&t(r)}}}l.table=this,l.parent.bind("scroll scroll-tf",i),l.head>0&&function(){for(var e=[],t=l.table.rows,i=0;i<l.head;i++){var r=t[i];if(r){var s=r.children;if(s.length)for(var o=0;o<s.length;o++){var n=s[o];n&&(e.push(n),l.left<=o&&n.insertAdjacentHTML("beforeend",a))}else l.head++}}l.headCells=$(e),l.headCells.addClass("tf-floating tf-float-head").css("top",0)}(),l.left>0&&function(){var e=l.table,t=[],i=e.rows;l.parentWidth=l.parent.width();for(var s=0;s<i.length;s++)r(i[s],(function(e){t.push(e),e.insertAdjacentHTML("beforeend",a)}));l.leftColumns=$(t),l.leftColumns.addClass("tf-floating").css("left",0)}(),function(){if(l.head>0&&l.left>0)for(var e=l.table.rows,t=0;t<l.head;t++){var a=e[t];if(a)for(var i=a.children,r=0;r<l.left;r++)i[r]&&(i[r].style["z-index"]=3)}}(),$(window).resize(i)}}},60:function(e,t,a){}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:81e5a8899fa0d6ed2586fd1b06cbd2d0', location = 'build/81e5a8899fa0d6ed2586.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[2],{0:function(e,t,a){"use strict";var r=a(7);function n(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function o(e){this.tokens=[].slice.call(e)}o.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():-1},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.pop());else this.tokens.unshift(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.shift());else this.tokens.push(e)}};var i={};[{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16le"}],heading:"Legacy miscellaneous encodings"}].forEach((function(e){e.encodings.forEach((function(e){e.labels.forEach((function(t){i[t]=e}))}))}));var s={},l="utf-8";function u(e,t){if(!(this instanceof u))return new u(e,t);var a;if(e=void 0!==e?String(e):l,t=n(t),this._encoding=(a=e,a=String(a).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(i,a)?i[a]:null),null===this._encoding||"replacement"===this._encoding.name)throw RangeError("Unknown encoding: "+e);var r=Boolean(t.NONSTANDARD_allowLegacyEncoding),o="utf-8"!==this._encoding.name&&"utf-16le"!==this._encoding.name&&"utf-16be"!==this._encoding.name;if(null===this._encoding||o&&!r)throw RangeError("Unknown encoding: "+e);if(!s[this._encoding.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");return this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(t.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{value:this._encoding.name}):this.encoding=this._encoding.name,this}function d(e,t){var a=e>>8,r=255&e;return t?[a,r]:[r,a]}function c(e,t){this.handler=function(t,a){if(n=65535,0<=(r=a)&&r<=n)return d(a,e);var r,n,o=d(55296+(a-65536>>10),e),i=d(56320+(a-65536&1023),e);return o.concat(i)}}u.prototype={encode:function(e,t){e=e?String(e):"",t=n(t);var a=this;this._streaming||(this._encoder=s[this._encoding.name](this._options)),this._streaming=Boolean(t.stream);var r,i=[],l=new o(function(e){for(var t=String(e),a=t.length,r=0,n=[];r<a;){var o=t.charCodeAt(r);if(o<55296||o>57343)n.push(o);else if(56320<=o&&o<=57343)n.push(65533);else if(55296<=o&&o<=56319)if(r===a-1)n.push(65533);else{var i=e.charCodeAt(r+1);if(56320<=i&&i<=57343){var s=1023&o,l=1023&i;n.push(65536+(s<<10)+l),r+=1}else n.push(65533)}r+=1}return n}(e));return l.tokens.forEach((function(e){r=a._encoder.handler(l,e),Array.isArray(r)?i.push.apply(i,r):i.push(r)})),new Uint8Array(i)}},s["utf-16le"]=function(e){return new c(!1,e)};var m=u,f=a(2),h=a(24),p=a.n(h);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var y={number:0,worklog:1,duration:2,date:3,worklogPlaces:[[" years"," year","y"],[" weeks"," week","w"],[" days"," day","d"],[" hours"," hour","h"],[" minutes"," minute","m"]],minute:6e4,hour:36e5,visualType:!0,textType:!1,mixedType:1,editorType:2,textNViewType:3,textNCellHtml:4,monthDayCount:[0,31,59,90,120,151,181,212,243,273,304,334],initChosen:function(e){e.find("option:contains("+"-Empty-"+")").addClass("tf-empty-option"),e.find("select").each((function(){var t=$(this);t.chosenTF({no_results_text:"No matches found. Press \u0027Enter\u0027 to add",placeholder_text_multiple:"icon"==t.data("type")?"Select items...":"Click and start typing...",display_selected_options:!1,width:"250px",addUserOption:!0,search_contains:!0,isHtml:t.data("html")}).change((function(t,a){a.selected?$(this).find("option").filter((function(){return this.textContent===a.selected})).prop("selected",!0):a.deselected&&$(this).find("option").filter((function(){return this.textContent===a.deselected})).prop("selected",!1),e.find(".search-choice:contains("+"-Empty-"+")").addClass("tf-empty-option")}))})),e.find(".search-choice:contains("+"-Empty-"+")").addClass("tf-empty-option")},unescapeStrings:function(e){var t=$("<div></div>"),a=[];return e.forEach((function(e){a.push(t.html(e).text())})),a},unescapeString:function(e){return y.unescapeStrings([e])[0]},i18nFilterValues:function(e){for(var t=0;t<e.length;t++)e[t]&&(e[t]=e[t].replace("-Empty-","-Empty-"))},unI18nFilterValues:function(e){for(var t=0;t<e.length;t++)e[t]&&(e[t]=e[t].replace("-Empty-","-Empty-"))},getMinValueByType:function(e){switch(e){case y.worklog:return y.minute;default:return 1}},getWorklog:function(e){e=e&&"string"==typeof e?e.split("|"):[365,5,8,"y w d h m"],isNaN(e[2])&&e.unshift(365),e[2]=y.hour*e[2];var t=[e[0]*e[2],e[1]*e[2],e[2],y.hour,y.minute],a=["y","w","d","h","m"],r=a,n=e[4];n?((r=n.split(" ")).length<5&&r.unshift("y"),n=r.map((function(e,t){var a=y.worklogPlaces[t].slice();return a[2]=e,a}))):n=y.worklogPlaces;var o=[],i=e[3].split(" ");return i.length<5&&i.unshift("y"),i.forEach((function(e){var n=a.indexOf(e);o.push({place:r[n],mult:t[n]})})),{mult:t,places:o,worklogPlaces:n}},addFloats:function(e,t){return parseFloat(parseFloat(e+t).toFixed(y.getDecimals(e,t)))},multFloats:function(e,t){return parseFloat(parseFloat(e*t).toFixed(y.getDecimals(e,0)+y.getDecimals(t,0)))},getDecimals:function(e,t){var a=(""+e).split("."),r=(""+t).split(".");return Math.min(Math.max(a[a.length-1].length,r[r.length-1].length),20)},normalizeTable:function(e){e.each((function(){var e=$(this);if(e.prepend(e.children("tbody").nextAll("thead")),y.isTableDynamicJiraIssues(e)&&!e[0].tHead){var t=e.parents(".flexigrid").find(".hDivBox thead").clone();t.hide(),e.prepend(t)}if(!e.hasClass("pivot-table-result")&&(e.find(".tf-header-hidden").remove(),e.find(".pivot-header").removeClass("pivot-header"),this.rows&&this.rows.length)){var a,r=0,n=1,o=[],i=!1,s=!0;do{var l=$(this.rows[r].children).not(".fake, .tf-numbering, .total-col, .tf-sparkline-header");a=s&&(i||0===l.filter("td").length),i=a&&this.rows.length>r+1&&0===$(this.rows[r+1].children).filter("td").length;var u=Math.max.apply(null,l.map((function(){return Math.max(this.rowSpan,i?Math.min(this.colSpan,2):1)})));if(s=s&&a,n=Math.max(n,u),r>0||n>1){$(this.rows[r]).addClass("pivot-header");var d=0;l.each((function(){for(;o.length>d&&o[d].rowSpan>1;)o[d++].rowSpan--;for(var e=this.colSpan;e>0;e--)o.length<=d&&(o[d]={html:""}),o[d].html+="&nbsp;"+this.innerHTML,o[d].rowSpan=this.rowSpan,d++}))}r++,n--}while(n>0&&this.rows.length>r);o.length&&$(this.rows[0]).before(p.a.mergedHeader({data:o}))}}))},isTableDynamicJiraIssues:function(e){var t=e.attr("id");return t&&-1!==t.indexOf("jiraissues_table_")},hasTableForUpdate:function(e){return e.hasClass("aui-nav-pagination")||e.is("table")||e.hasClass("user-profile-list-result")||"teamcity"===e.attr("id")||e.hasClass("profilelist")||e.hasClass("static-jira-issues_count")||e.hasClass("jira-table")||e.hasClass("pocketquery-view-container")||e.hasClass("attachments-container")||e.not(".issue-body-content").find("table").length||e.is("tbody")&&y.isTableDynamicJiraIssues(e.parent())},hasRowForUpdate:function(e){return e.is("tr")&&!e.hasClass("total-row")&&!e.hasClass("tf-header-hidden")},hasCharsForUpdate:function(e,t){return e.hasClass("jira-issue")||"select2-chosen"===t.className},isIgnoreUpdateNode:function(e){return"floating-scrollbar"===e.attr("id")},getRows:function(e,t,a){var r=[],n=e.classList.contains("attachments"),o=e.rows;if(o)for(var i=0;i<o.length;i++)!o[i].children.length||a&&!y.isRowVisible(o[i])||o[i].classList.contains("pivot-header")||!t&&o[i].classList.contains("total-row")||o[i].classList.contains("pagination-row")||o[i].parentNode.classList.contains("tableFloatingHeader")||o[i].classList.contains("issueRow")&&o[i].classList.contains("meta-data-container")||n&&o[i].classList.contains("attachment-summary")||r.push(o[i]);return $(r)},getCellPosition:function(e,t){var a=y.getCellPositions(e,t);return a.length?a[0]:null},getCellPositions:function(e,t){var a=[];if(e.length){var r=y.clearStringLowerCase(t);e[0].forEach((function(e,t){y.clearStringLowerCase(e)==r&&a.push(t)}))}return a},getColumnPosition:function(e,t){var a=y.getColumnPositions(e,t);return a.length?a[0]:null},getColumnPositions:function(e,t){var a=[],r=y.clearStringLowerCase(t);return e.eq(0).find("td, th").each((function(e){y.clearStringLowerCase(this.textContent)==r&&a.push(e)})),a},isRowVisible:function(e){return"none"!==e.style.display},clearString:function(e){return null==e?"":("string"!=typeof e&&(e=""+e),$.trim(e.replace(/\u00A0/g," ").replace(/\u200B/g,"").replace(/\uFEFF/g,"").replace(/\s{2,}/g," ")))},clearStringLowerCase:function(e){return y.clearString(e).toLocaleLowerCase()},getNthTd:function(e,t){return y.getNthTdElem(e,t).text()},getNthTdIcons:function(e,t){return y.getTdIcons(y.getNthTdElem(e,t))},getTdIcons:function(e){return e.find("img, ul.inline-task-list")},getTdIconsSrc:function(e){var t=[];return e.find("img").each((function(){t.push(this.src)})),0==t.length&&t.push(""),t},clearIconSrc:function(e){var t=e.indexOf("images/icons/emoticons/");return t>=0&&(e=e.substr(t,e.length)),e},getNthTdElem:function(e,t){return $(e.children[t])},formatNumberLeadingZeroes:function(e,t){var a=new Array(t).join("0")+e;return a.substring(a.length-t,a.length)},convertToDate:function(e,t,a){if($.isNumeric(e)){e=parseInt(e);var r=new Date(e+new Date(e).getTimezoneOffset()*y.minute);e=y.formatDate(r,t,a)}return e},formatDate:function(e,t,a){e=y.toDateObject(e),"object"===g(t)&&(t=t[t.length-1],a=a[a.length-1]);var r=t.toLowerCase().indexOf("hh:mm"),n=t,o="";if(r>=0&&(n=y.getDateFormatWithoutTime(n),o=y.formatTime(e,t)),n.indexOf("i")>=0&&(n=n.replace("i","m"),(e=new Date(e.getTime())).setMonth(e.getMonth()/3)),n.indexOf("w")>=0){n=n.replace("w","o").replace("w","");var i=e.getMonth(),s=e.getDate();i>1&&e.getYear()%4==0&&s++,(e=new Date(e.getTime())).setMonth(0),e.setDate((s+y.monthDayCount[i]-1)/7+1)}var l=$.datepicker.formatDate(n,e,y.localisations[a]);return 0===r?l=o+" "+l:r>0&&(l=l+" "+o),l},formatTime:function(e,t){e=y.toDateObject(e);var a=-1!==t.indexOf("HH:"),r=t.indexOf(":ss")>=0,n=e.getHours(),o="";a&&(o=n>11?" p.m.":" a.m.",0===n?n=12:n>12&&(n%=12));var i=y.formatNumberLeadingZeroes(n,2)+":"+y.formatNumberLeadingZeroes(e.getMinutes(),2);return r&&(i=i+":"+y.formatNumberLeadingZeroes(e.getSeconds(),2)),i+o},getTableSorterDateFormat:function(e){var t=e.toLowerCase()[0];return"m"===t?"mmddyyyy":"d"===t?"ddmmyyyy":"y"===t?"yyyymmdd":void 0},toDateObject:function(e){return"string"==typeof e||"number"==typeof e?new Date(e):e},isTodayKeyWord:function(e){var t=e.toLowerCase();return"today"===t||"heute"===t},dateToUTCTimestamp:function(e,t,a){if(!y.isTodayKeyWord(e)){try{var r=y.parseDate(e,t,a);e=r.getTime()-6e4*r.getTimezoneOffset()+""}catch(e){}e=e.replace(/,/g,"‚")}return e},parseDate:function(e,t,a,r){if(y.isTodayKeyWord(e))return(o=new Date).setHours(0,0,0,0),o;"string"==typeof t&&(t=[t],a=[a]);for(var n=0;n<t.length;n++){var o,i=t[n],s=i.toLowerCase().indexOf("hh:mm")>=0,l=i.indexOf("i")>=0,u=i.indexOf("w")>=0,d=i,c=e,m=[];if(s){var f=y.getDateTimeObject(e,i);d=f.dateFormat,c=f.dateString,m=f.time}else l&&(d=d.replace("i","m")),u&&(d=d.replace(/w/g,"o"));-1===d.toLowerCase().indexOf("m")&&(d="mm/"+d,c="01/"+c),-1===d.indexOf("d")&&(d="dd/"+d,c="01/"+c),-1===d.indexOf("y")&&(d="yy/"+d,c=(new Date).getFullYear()+"/"+c);try{o=$.datepicker.parseDate(d,c,y.localisations[a[n]])}catch(e){if(-1===e.indexOf("Extra/unparsed characters found in date: ")||r){if(n<t.length-1)continue;throw e}o=$.datepicker.parseDate(d,c.replace(e.split("Extra/unparsed characters found in date: ")[1],""),y.localisations[a[n]])}if(o){if(o.setHours(m[0]||0,m[1]||0,m[2]||0),l&&o.setMonth(3*o.getMonth()),u){var h=o.getMonth(),p=o.getDate();h>1&&o.getYear()%4==0&&p++,o.setMonth(0),o.setDate(1);var g=o.getDay();o.setDate(1-g),g>3&&o.setDate(o.getDate()+7),o.setDate(o.getDate()+7*(p+y.monthDayCount[h]-1))}return o}}return o},getDateTimeObject:function(e,t){var a=t,r=e,n=[];a=y.getDateFormatWithoutTime(a);var o=t.replace(a,"").trim(),i=e.indexOf(":");if(i>=0){i-=2;var s=e.substring(i,i+o.length).trim();r=e.replace(s,"").replace(/[a,p]\.?m\.?/i,"").trim();var l=e.replace(s,"").replace(r,"").trim().toLocaleLowerCase();n=s.split(":"),-1!==l.indexOf("pm")||-1!==l.indexOf("p.m")?"12"!==n[0]&&(n[0]=parseInt(n[0])+12):l.length&&(n[0]=n[0]%12)}return{dateFormat:a,timeFormat:o,timeString:s,dateString:r,time:n}},getDateFormatWithoutTime:function(e){return e.replace(/hh:mm/i,"").replace(":ss","").replace(/[a,p]\.?m\.?/i,"").trim()},getTimeFormatWithoutDate:function(e){return e.replace(y.getDateFormatWithoutTime(e),"").trim()},getTablesorterDateFormat:function(e){var t=e.replace(/\W+/g,"")[0].toLowerCase(),a=null;if("m"!=t)switch(t){case"d":a="ddmmyyyy";break;case"y":a="yyyymmdd";break;default:a=null}return a},setDateFormatForColumn:function(e,t,a,r,n,o,i,s){if(!e[o]){var l=i.not("#issuetable tr, .spreadsheets-sheet tr").find("td:eq("+o+") time").not('[data-macro-name="page-info"]');if(l.length){if(y.setDateMacroDateFormat(l,e,t,r,n,o),s){var u=y.getTimeFormatWithoutDate(a);0===a.toLowerCase().indexOf("hh:mm")?e[o]=u+" "+e[o]:e[o]=e[o]+" "+u}}else e[o]=a,t[o]=r}},setDateMacroDateFormat:function(e,t,a,r,n,o){if(e.length){var i=y.getDateMacroDateFormat(e,l,n),s=i.dateFormat,l=i.locale;t[o]=s,a[o]=l}},getDateMacroDateFormat:function(e,t,a){if(e.length)try{return y.parseDate(e[0].textContent,a,t),{dateFormat:a,locale:t}}catch(e){return{dateFormat:"dd M yy",locale:"en_US"}}},dateFormatAutocomplete:function(e,t){y.inputAutocomplete(e,t,[{label:"dd-mm-yy (28-04-2016)",value:"dd-mm-yy"},{label:"dd.mm.yy (28.04.2016)",value:"dd.mm.yy"},{label:"yy-mm-dd (2016-04-28)",value:"yy-mm-dd"},{label:"yy/mm/dd (2016/04/28)",value:"yy/mm/dd"},{label:"m/d/yy (4/28/2016)",value:"m/d/yy"},{label:"m/d/y (4/28/16)",value:"m/d/y"},{label:"d M yy (28 Apr 2016)",value:"d M yy"},{label:"d M, yy (28 Apr, 2016)",value:"d M, yy"},{label:"M dd, yy (Oct 07, 2019)",value:"M dd, yy"},{label:"MM yy (April 2016)",value:"MM yy"},{label:"yy Qi (2018 Q2)",value:"yy Qi"},{label:"yy-w (2019-34)",value:"yy-w"},{label:"m/d/y HH:mm (01/28/20 12:30 p.m.)",value:"m/d/y HH:mm"},{label:"dd.mm.yy hh:mm (08.12.2017 12:30)",value:"dd.mm.yy hh:mm"},{label:"dd-mm-yy hh:mm:ss (08-12-2017 12:30:00)",value:"dd-mm-yy hh:mm:ss"}],(function(){f.a.storeValue("tf-dateformat",e.val())}))},inputAutocomplete:function(e,t,a,r){e.autocomplete({source:a,minLength:0,appendTo:t,change:r,select:function(){e.trigger("selected")}}),e.focus((function(){e.autocomplete("search","")})).change(r);var n=e.autocomplete("widget");n?n.click((function(e){e.stopPropagation()})):WRM.require("com.stiltsoft.confluence.plugin.tablefilter.tablefilter:jquery-ui-resources",(function(){y.inputAutocomplete(e,t,a,r)}))},getLocaleDateFormat:function(e){var t=AJS.Meta.get("user-date-pattern");if("undefined"==typeof AP)try{t=t||window.parent.AJS.Meta.get("user-date-pattern")}catch(e){}return t?(-1!==(t=t.replace("yyyy","yy")).indexOf("MMM")?t=t.replace("MMM","M"):-1!==t.indexOf("MM")?t=t.replace("MM","mm"):-1!==t.indexOf("M")&&(t=t.replace("M","m")),t):e},getLocale:function(){var e=AJS.Meta.get("user-locale");if(!e)try{e=window.parent.AJS.Meta.get("user-locale")}catch(e){}return e?e.replace("-","_"):"en_US"},getAnyValueType:function(e,t,a,r,n,o){try{if(y.parseDate(e,n,o,r))return y.date}catch(e){}return y.getValueType(e,t,a,r)},getValueType:function(e,t,a,r){var n=this,o=r?null:n.number;if(void 0===e)return o;if("number"==typeof e)return y.number;if(new RegExp("^\\d{1,2}:\\d{2}").test(e))return n.duration;var i=e.replace(/,\s/g," ");return a.worklogPlaces.some((function(e){var t=!1;return e.some((function(e){if(new RegExp("^\\d+([\\.,]\\d+)?"+e).test(i))return o=n.worklog,t=!0,!0})),t})),null===o?isNaN(y.parseNumberQuietly(e,t))?null:n.number:o},parseAnyValueByType:function(e,t,a,r,n,o,i){return e===y.date?y.parseDate(t,o,i):y.parseValueByType(e,t,a,r,n)},parseValueByType:function(e,t,a,r,n){return t=this.clearString(t),e==this.worklog?this.parseWorklog(t,r):e==this.duration?this.parseDuration(t):n?this.parseNumberQuietly(t,a):this.parseNumber(t,a)},parseDuration:function(e){var t=!1,a=e.split(":");if(a.length>1){t=0;for(var r=[1e3,6e4,36e5],n=a.length-1,o=0;n>=0;n--,o++)t+=a[n]*r[o]}return t},parseWorklog:function(e,t){var a=!1;return e=e.replace(/,\s/g," "),t.worklogPlaces.forEach((function(r,n){r.some((function(r){var o=e.split(r);if(2==o.length){var i=t.mult[n]*o[0].replace(",",".");isNaN(i)||(!1===a&&(a=0),a+=i,e=o[1])}}))})),a},parseNumber:function(e,t){return parseFloat(y.prepareNumberStringForParsing(e,t).replace(/^[^\d-]*/g,""))},parseNumberQuietly:function(e,t){var a=y.prepareNumberStringForParsing(e,t);return/^[\+\-]?\d*\.?\d+(?:[Ee][\+\-]?\d+)?$/.test(a)?parseFloat(a):NaN},prepareNumberStringForParsing:function(e,t){return void 0===e&&(e=""),"."==t?e=e.replace(/,/g,""):","==t&&(e=e.replace(/\./g,"")),e.replace(/\s/g,"").replace(/,/g,".").replace("$","")},getNumberFormatter:function(e){var t=e.replace(/-?\d([\d\s.,]*\d+)?[.,]?\d*/,"{%s}");return-1!==t.indexOf("{%s}")?function(e){return t.replace("{%s}",e)}:function(e){return e}},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},formatWorklog:function(e,t){var a=[];return t.places.forEach((function(r,n){var o,i=e/r.mult;(o=n<t.places.length-1||1===r.mult?Math.floor(i):Math.round(10*i)/10)&&(a.push(o+r.place),e-=o*r.mult)})),a.join(" ")},formatDuration:function(e){var t=[],a=!0;return[36e5,6e4,1e3].forEach((function(r,n){var o=Math.floor(e/r);(o||n)&&(t.push(!a&&o<10?"0"+o:o),e-=o*r,a=!1)})),t.join(":")},formatAnyValueByType:function(e,t,a,r,n,o){return t===y.date?y.formatDate(e,n,o):y.formatValueByType(e,t,a,r)},formatValueByType:function(e,t,a,r){return t==this.worklog?this.formatWorklog(e,r):t==this.duration?this.formatDuration(e):a(e)},addExcerpt:function(e,t){var a=y.getExcerpt(e).filter((function(){return $(this).closest(".original-table,.tj-source,."+t).hasClass(t)}));return y.getExcerptInclude(e,a,t)},getExcerpt:function(e){return e.find('meta[name="table-excerpt-include"]').filter((function(){return-1===e.find(".pivot-content > .original-table, .table-joiner > .tj-source").find('meta[name="table-excerpt-include"]').index(this)}))},getExcerptInclude:function(e,t,a){return t.each((function(){var t=$(this).attr("content"),r=$("div.table-excerpt").filterByAttr("data-id",t);r.addClass(a),e=e.add(r)})),e},addIframe:function(e,t,a){var r=!1;try{var n=e.find("iframe").not('.hidden, .gliffy-html5-container, [id^="com.bilith.lref.confluence-gdrive"], .youtube-player');if(n.length){var o=n.contents();r=!0;var i=function(){e=e.add(o.find("html").addClass(t)).data("hasFrame",!0),a(e)},s=null,l=function(){i();var e=function(e){e.classList&&e.classList.contains("resize-sensor")||e.id&&-1!==e.id.indexOf("sizzle")||(clearTimeout(s),s=setTimeout(i,100))};window.MutationObserver?new MutationObserver((function(t){t.some((function(t){if(t.addedNodes.length)return Array.prototype.forEach.call(t.addedNodes,(function(t){e(t)})),!0}))})).observe(o[0],{childList:!0,subtree:!0}):o.bind("DOMNodeInserted",e)};n.load((function(){o=n.contents(),l()})),o.ready(l),e=e.add(o.find("html").addClass(t))}}catch(e){}return e.data("hasFrame",r)},setPaginationMsg:function(e){if("hidden"!==f.a.getStoredValue("tf-hide-pagination")){var t=e.find(".aui-nav-pagination"),a=$();t.length&&0===t.find(".tfac-pagination").length&&(a=$(p.a.paginationMsg()),t.last().append(a));var r=e.find(".refresh-issues-bottom");if(r.length&&0===r.find(".tfac-pagination").length){var n=$(p.a.jiraIssuesMsg());r.append(n),a=a.add(n)}a.find(".hide").click((function(){a.remove(),f.a.storeValue("tf-hide-pagination","hidden")}))}},hasTabs:function(e){return e.find(".aui-tabs").length>0},hasLoadingContent:function(e){return!$("body.content-preview").length&&e.find(".jim-sortable-dark-layout, table.ppr > caption").filter((function(){return"none"!==$(this).css("display")})).length>0},hasAnyTFACUnfinishedContent:function(e,t){return y.hasTFACUnfinishedContent(e,t,".tablefilter-table-wrapper","tf-ready")||t.find(".pivot-content").data("pivot-not-ready")||t.find(".table-joiner").data("tj-not-ready")},hasTFACUnfinishedContent:function(e,t,a,r){for(var n=t.find(a).add(t.filter(a)).find("table").filter(e),o=0;o<n.length;o++)if(!n.eq(o).data(r))return!0;return!1},hasInactiveTab:function(e){var t=e.parents(".tabs-pane");return t.length&&!t.eq(0).hasClass("active-pane")},onTabChange:function(e,t){y.hasTabs(e)&&e.find(".aui-tabs").bind("tabSelect",(function(){t()}))},getTables:function(e,t,a){return y.getTablesAndRows(e,t,a).tables},getRelevantRows:function(e,t){var a=[];return t?(e.forEach((function(e){var t=[],r=e.eq(0).find("td,th");r.each((function(){var e=$(this);t.push(!(e.hasClass("tf-hidden-column")||2!==r.length&&e.hasClass("pivot-total-column")))})),a.push(t)})),a):(e.forEach((function(e){var t=[];e.each((function(){t.push(y.isRowVisible(this)&&(2==e.length||!this.classList.contains("pivot-total")))})),a.push(t)})),a)},getMaxRowspan:function(e){var t=1;return e.find("td, th").each((function(e,a){t=Math.max(a.rowSpan,t)})),t-1},getTableNodes:function(e,t){return e.find(t||"table").not("#i_confiform_registration_form table").filter((function(){return-1===e.find(".pivot-content > .original-table, .table-joiner > .tj-source").find("table").index(this)&&-1===e.find("table:not(.wysiwyg-macro) table").index(this)}))},getTablesAndRows:function(e,t,a,r){var n=y.getTableNodes(e);return y.getTablesAndRowsFromTables(n,t,a,r)},getTablesAndRowsFromTables:function(e,t,a,r,n){var o=[],i=[],s=y.getCellValueGetter(t);return e.each((function(){var e=y.getRows(this,r,n);i.push(e),o.push(y.getRowsValues(e,a,s))})),r&&(o=y.transpose(o)),{tables:o,rows:i,$tables:e}},getTablesRowsValues:function(e,t,a){var r=[],n=y.getCellValueGetter(t);return e.forEach((function(e){r.push(y.getRowsValues(e,a,n))})),r},getRowsValues:function(e,t,a){!t||t instanceof Object||(t={skip:[t],include:[]});var r=[];return e.each((function(){for(var e=[],n=this.children,o=0;o<n.length;o++){var i=n[o];if(!t||!t.skip.some((function(e){return i.classList.contains(e)}))||t.include.some((function(e){return i.classList.contains(e)}))){var s=$(i);e.push(a(s))}}e.length>0&&r.push(e)})),r},getCellValueGetter:function(e){return e===y.visualType?y.getCellVisualHtml:e===y.mixedType?y.getCellTextOrImg:e===y.textNViewType?y.getTextAndHTML:e===y.textNCellHtml?y.getTextAndCellHTML:e===y.editorType?y.getEditorCellText:y.getCellText},getTextAndHTML:function(e){return{text:y.getCellTextOrImg(e),html:e[0].innerHTML}},getTextAndCellHTML:function(e){return{text:y.getCellTextOrImg(e),html:e[0].outerHTML}},getCellText:function(e){return y.clearString(e[0].textContent)},getCellVisualHtml:function(e){var t="";return e.find("img, ul.inline-task-list").each((function(){t+=this.outerHTML})),t},getCellTextOrImg:function(e){var t=y.getCellText(e);if(!t){var a=e.find("img, ul.inline-task-list");a.length&&(t=a.is("img")?a[0].alt||a[0].src:a.find("li.checked").length?"Completed":"Incomplete")}return t},getEditorCellText:function(e){var t=y.getCellText(e);if(!t){var a=e.find("img.editor-inline-macro");if(a.length){var r=a.attr("data-macro-name");if("status"===r){var n=Confluence.MacroParameterSerializer.deserialize(a.attr("data-macro-parameters"));return n.title||n.colour||"Grey"}if("status-handy"===r)return Confluence.MacroParameterSerializer.deserialize(a.attr("data-macro-parameters")).Status;if("timestamp"===r)return decodeURIComponent(a.attr("src").split("=")[1]).replace(/\+/g," ");if("easy-dropdown-menu-status"===r)return Confluence.MacroParameterSerializer.deserialize(a.attr("data-macro-parameters"))["current-option-value"]}}return t},getPlainTableRowsReader:function(e){return y.textNViewType===e?function(e){return e.map((function(e){return e.text}))}:function(e){return e}},getCommonColumns:function(e,t){var a=y.getPlainTableRowsReader(t),r=[];return e.some((function(e){if(e.length)return r=a(e[0]),!0})),$.each(e,(function(e,t){t.length&&(r=$.grep(r,(function(e){return-1!==$.inArray(e,a(t[0]))})))})),r},getRawColumns:function(e){var t=[];return $.each(e,(function(e,a){a.length&&$.each(a[0],(function(e,a){-1==$.inArray(a,t)&&t.push(a)}))})),t},getColumns:function(e){return y.getRawColumns(e).sort()},hashCode:function(e){var t=0;if(0==e.length)return t;for(var a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t},getContentId:function(){return AJS.params.contentId||AJS.Meta.get("content-id")||AJS.params.pageId||AJS.Meta.get("page-id")},transpose:function(e){var t=[];return e.forEach((function(e){var a=e.length?e.length:0,r=e[0]instanceof Array?e[0].length:0;if(0===r||0===a)return[];var n,o,i=[];for(n=0;n<r;n++)for(i[n]=[],o=0;o<a;o++)i[n][o]=e[o][n];t.push(i)})),t},processMergedCells:function(e,t){var a=function(e){return"none"!==e.parentNode.style.display},r=function(e){return"none"!==e.style.display&&a(e)},n=function(e){if(r(e))for(;$.data(e,"childCell");){var t=$.data(e,"childCell")[0];if(a(t)){t.style.display="";break}e=t}},o=function(e){for(n(e);$.data(e,"parentCell")&&((e=$.data(e,"parentCell")[0]).rowSpan=e.rowSpan-1,!r(e)););},i=function(e){r(e)&&$.data(e,"childColCell")&&($.data(e,"childColCell")[0].style.display="")},s=function(e,t,a){for(var r=-1,n=0,o=e.children,i=0;i<o.length;i++){var s=o[i];if(a&&s===a)break;if((r+=s.colSpan)>=t)break;n+=1}return a?r+1:n};var l=e.not(".tfac-tj");l.each((function(e,a){var l=$(this);if(t||!l.data("tf-merged-done")){var u,d,c=l.data("tf-update-spans"),m=[],f=$(this.rows);for(f.children(".fake").remove(),f.children("[rowspan]").each((function(){m.push(this)}));m.length;){var h=$((u=m,d=void 0,d={cell:null,index:Number.MAX_VALUE,i:0},d=u.reduce((function(e,t,a){var r=s(t.parentNode,1e6,t);return e.index>r?{cell:t,index:r,i:a}:e}),d),u.splice(d.i,1),d.cell)),p=h[0].parentNode,g=s(p,1e5,h[0]),y=0;if(!c){var b=h.getClassStartsWith(/tf-rowspan-\d+/);b&&(h[0].rowSpan=b.split("-")[2])}h.removeClass(h.getClassStartsWith(/tf-rowspan-\d+/));var v=h[0].rowSpan-1;for(h.addClass("tf-rowspan-"+(v+1)),$.data(h[0],"rowspan",v+1),h.bind("hideCell",(function(){n(this)}));v>0&&(p=p.nextElementSibling);v--){y=s(p,g,!1);var S=h;h=h.clone(!0,!0),$.data(S[0],"childCell",h),$.data(h[0],"parentCell",S),h.attr("rowspan",-1),h[0].classList.add("fake","synchrony-exclude"),h[0].style.display="none",$.data(h[0],"rowspan",v),p.insertBefore(h[0],p.children[y]),h.unbind("hideCell").bind("hideCell",(function(){o(this)}))}}if(f.children("[colspan]").each((function(){var e=$(this);if(!c){var t=e.getClassStartsWith(/tf-colspan-\d+/);t&&(e[0].colSpan=t.split("-")[2])}e.removeClass(e.getClassStartsWith(/tf-colspan-\d+/));var a=e[0].colSpan;e.addClass("tf-colspan-"+a),$.data(e[0],"colspan",a),e.bind("hideCol",(function(){i(this)}));for(var n=a-1;n>0;n--){var o=e.clone(!0,!0);o.attr("colspan",-1),$.data(o[0],"colspan",n),$.data(o[0],"counted","counted"),o[0].style.display="none",o[0].classList.add("fake","synchrony-exclude"),$.data(o[0],"parentColCell",e),e.after(o),$.data(e[0],"childColCell",o),o.unbind("hideCol").bind("hideCol",(function(){var e=this;for(i(e);$.data(e,"parentColCell");)if(e=$.data(e,"parentColCell")[0],r(e)){e.colSpan=e.colSpan-1;break}})),(e=o).attr("rowspan")&&e[0].classList.add("tf-rowspan-bind")}})),f.children(".tf-rowspan-bind").each((function(){var e=$(this);if(e.hasClass("tf-rowspan-bind")){var t=e[0].parentNode,a=e[0].cellIndex,r=parseInt(e.attr("rowspan"))-1;for($.data(e[0],"rowspan",r+1),e.removeClass("tf-rowspan-bind"),e.bind("hideCell",(function(){n(this)}));r>0;r--){t=t.nextElementSibling;var i=e;e=$(t.children[a]),$.data(i[0],"childCell",e),e.length&&($.data(e[0],"parentCell",i),$.data(e[0],"rowspan",r),e.removeClass("tf-rowspan-bind"),e.unbind("hideCell").bind("hideCell",(function(){o(this)})))}}})),window.MutationObserver){var N=new MutationObserver((function(e){var t=$();e.forEach((function(e){e.addedNodes.length?t=$(e.addedNodes):e.removedNodes.length&&(t=$(e.removedNodes))})),t.filter("thead, tbody, tr,th,td").length&&($(a).data("tf-merged-done",!1),N.disconnect())}));N.observe(a,{childList:!0,subtree:!0})}}})),l.data("tf-merged-done",!0).data("tf-update-spans",!0)},sortSelectedOptions:function(e,t){for(var a=e.parent().find(".chosen-choices"),r=t.length-1;r>=0;r--)a.prepend(a.find(".search-choice").filter((function(){return this.textContent==t[r].replace(/\‚/g,",")})));return a},sortSelectOptions:function(e){var t=e.find("option");t.sort((function(e,t){return $(e).text()>$(t).text()?1:-1})),e.append(t)},createDialog:function(e,t,a){var r="\t",n="",o=r,i=n,s=!0;$("body").append(p.a.exportToCSV({macroId:a,separator:r,quote:n,headers:x(function(){var e=[],a=t.eq(0).find("th, td");a.length>0&&a.each((function(){var t=$(this);"none"!=t.css("display")?e.push(t.text()):!t.hasClass("fake")||t.hasClass("tf-hidden-column")||t.hasClass("pivot-hidden-column")||e.push("")}));return e}()),linkSeparator:f.a.getStoredValue("tf-csvexport-link-sep")||";",exportLinks:"false"==f.a.getStoredValue("tf-csvexport-link")}));var l=AJS.dialog2("#export-csv-dialog-"+a),u=$("#export-csv-dialog-"+a),d=u.find(".export-csv-separator"),c=u.find(".export-csv-quote"),m=u.find(".export-csv-headers"),h=u.find("#tf-csv-export-type"),g=u.find("#tf-csv-export-default-message"),b=u.find("#tf-csv-export-params"),v=u.find(".tf-csv-export-links"),S=u.find("#tf-csv-export-link-separator"),N=u.find("#csv-export-"+a),M=u.find("#csv-cancel-"+a);return d.bind("keyup",(function(){f.a.storeValue("tf-csvexport-sep",d.val().trim()),T()})),c.bind("keyup",(function(){f.a.storeValue("tf-csvexport-quote",c.val().trim()),T()})),h.change((function(){"custom"==h.val()?(g.hide(),b.show(),d.val(f.a.getStoredValue("tf-csvexport-sep")||","),c.val(f.a.getStoredValue("tf-csvexport-quote")||'"'),T(),s=!1):(g.show(),b.hide(),d.val("\t"),c.val('"'),T(),s=!0)})),v.change((function(){v.is(":checked")?(S.parent().show(),f.a.storeValue("tf-csvexport-link",!0)):(S.parent().hide(),f.a.storeValue("tf-csvexport-link",!1))})),S.change((function(){f.a.storeValue("tf-csvexport-link-sep",S.val())})),N.on("click",(function(){r=d.val(),n=c.val(),y.exportToCsv(e,r||",",n||'"',m.val()?w(m.val()):[],s,v.is(":checked"),S.val()),l.hide()})),M.on("click",(function(){l.hide(),AP.resize()})),l;function T(){var e=w(m.val());o=d.val(),i=c.val(),m.val(x(e))}function x(e){return i?i+e.join(i+(o||",")+i)+i:e.join(o||",")}function w(e){return i?e.slice(i.length,-i.length).split(i+(o||",")+i):e.split(o||",")}},exportToCsv:function(e,t,a,n,o,i,s){var l=e.table2CSV({separator:t,quote:a,headers:n,exportLinks:i,linkSeparator:s}),u="utf-16le";-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&(u="application/octet-stream");var d=l;if(o){var c=new m("utf-16le",{NONSTANDARD_allowLegacyEncoding:!0}).encode([l]);(d=new Uint8Array(2+c.length))[0]=255,d[1]=254,d.set(c,2)}var f=new Blob([d],{type:u});Object(r.saveAs)(f,"export.csv")},exportToPdf:function(e,t){var a=0,n=!1,o=e.hasClass("tf-cloud-table"),i=function(){0==a&&n&&(-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")?pdfMake.createPdf(c).getBase64((function(e){for(var t=atob(e),a=[],n=0;n<t.length;n+=512){for(var o=t.slice(n,n+512),i=new Array(o.length),s=0;s<o.length;s++)i[s]=o.charCodeAt(s);var l=new Uint8Array(i);a.push(l)}var u=new Blob(a,{type:"application/octet-stream"});Object(r.saveAs)(u,"export.pdf")})):pdfMake.createPdf(c).download("export.pdf"))};var s=function(e){var t,a,r,n,o,i,s,l=e&&"transparent"!=e?e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)[,]*(\d+)*/i):["noColor"];if(-1!==l[0].indexOf("rgba")){var u=(t=parseInt(l[1]),a=parseInt(l[2]),r=parseInt(l[3]),n=parseInt(l[4]),o=255,i=255,s=255,[Math.round((1-n)*o+n*t),Math.round((1-n)*i+n*a),Math.round((1-n)*s+n*r)]);l[1]=u[0],l[2]=u[1],l[3]=u[2]}return l&&5===l.length?"#"+("0"+parseInt(l[1],10).toString(16)).slice(-2)+("0"+parseInt(l[2],10).toString(16)).slice(-2)+("0"+parseInt(l[3],10).toString(16)).slice(-2):[255,255,255]},l=function(e,t){var a=0,r=0;t.length&&(r=t[0],t.shift());for(var n=0;n<e.length;n++){var o=$(e[n]);if(!o.hasClass("tf-hidden-column")&&!o.hasClass("pivot-hidden-column")&&"none"!==o[0].style.display){a+=o[0].colSpan;for(var i=o[0].rowSpan-1,s=0;s<i;s++)t[s]=(t[s]||0)+o[0].colSpan}}return a+r},u=function(e){var t=!1,a=$(e),r=a.width(),n=[];a.hasClass("fixed-table")?(a.find("col").filter((function(){return"none"!==this.style.display})).each((function(){n.push(parseInt($(this).css("width"))/d/1.2)})),r>770&&(t=!0)):r>870&&(t=!0);var o,i={headerRow:1,style:"tableStyle",table:{widths:n,body:[]},layout:{hLineColor:"#ddd",vLineColor:"#ddd",paddingLeft:function(){return 6},paddingRight:function(){return 6},paddingTop:function(){return 3},paddingBottom:function(){return 3}},pageOrientation:t?"landscape":"portrait",pageBreak:""},u=c.content.length;u&&c.content[u-1].pageOrientation!==i.pageOrientation&&(i.pageBreak="before");for(var m=-1,f=[],h={},p=0,g=0;p<e.rows.length;p++)if(o=e.rows[p],"none"!==$(o).css("display")){i.table.body.push([]);var y=l(o.cells,f);if(y>m){if(-1!=m)for(var b=0;b<g;b++)for(var v=0;v<y-m;v++)i.table.body[b].push({text:"\n",style:"cell",rowSpan:1,colSpan:1});m=y}for(var M=0,T=0;T<o.cells.length;T++){var x=$(o.cells[T]);if("none"!==x[0].style.display&&!x.hasClass("tf-hidden-column")&&!x.hasClass("pivot-hidden-column")){if(h[g]){for(;h[g][M];){for(var w=0;w<h[g][M];w++)i.table.body[g].push({text:"\n",style:"cell",rowSpan:1,colSpan:1,color:s(x.css("color")),fillColor:s(x.css("background-color"))});M+=h[g][M]}h[g][M]=0}var A=!1;"bold"==$(o).css("font-weight")&&(A=!0);var k={stack:S(x[0],[],[],[])[0],style:0===p||A?"header":"cell",rowSpan:parseInt(x.attr("rowspan"))||1,colSpan:parseInt(x.attr("colspan"))||1,color:s(x.css("color")),fillColor:s(x.css("background-color"))};N(k)||k.stack.push({text:"\n"}),i.table.body[g].push(k);for(var C=1;C<x[0].colSpan;C++)i.table.body[g].push({text:"\n",style:"cell",rowSpan:1,colSpan:1});for(w=1;w<x[0].rowSpan;w++)h[g+w]||(h[g+w]={}),h[g+w][M]=x[0].colSpan;M+=x[0].colSpan}if(T===o.cells.length-1){for(v=0;v<m-y;v++)i.table.body[g].push({text:"\n",style:"cell",rowSpan:1,colSpan:1,color:s(x.css("color")),fillColor:s(x.css("background-color"))});if(h[g]){for(;h[g][M];){for(w=0;w<h[g][M];w++)i.table.body[g].push({text:"\n",style:"cell",rowSpan:1,colSpan:1,color:s(x.css("color")),fillColor:s(x.css("background-color"))});M+=h[g][M]}h[g][M]=0}}}g+=1}for(p=0;p<m;p++)i.table.widths.push("auto");return i};pdfMake.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"}};var d=1.4,c={content:[],styles:{header:{fontSize:10,bold:!0,color:"#333333"},cell:{fontSize:10,color:"#333333"},tableStyle:{marginTop:10}},defaultStyle:{},pageOrientation:"portrait",pageBreak:""},m=!0,f=e.parent().find("#pngdataurl img"),h=0!==f.length;if(t&&h){var p=f.get(0).width,g=f.get(0).height,b=!1;p>590&&g>510&&(b=!0),p>590?(c.pageOrientation="landscape",g>510&&(g=510),p>800&&(p=800)):g>700&&(g=700);var v={image:f.attr("src"),alignment:"center",fit:[p,g],pageOrientation:c.pageOrientation};b&&(v.margin=[0,0,0,40]),c.content.push(v),m=!1}function S(e,t,r,n,l){var c=$(e);if("none"!=c.css("display")){var m=c.css("font-weight");$.each(e.childNodes,(function(){var e,f;if(3==this.nodeType){var h=this.nodeValue?this.nodeValue:"​";h.indexOf("\n")>=0&&(h=(h=h.trim())||"");var p={text:h,bold:"bold"===m||"700"===m,italics:"italic"===c.css("font-style"),alignment:c.css("text-align"),color:s(c.css("color")),background:c.css("background-color")&&"rgba(0, 0, 0, 0)"!=c.css("background-color")?s(c.css("background-color")):void 0,decoration:n,decorationColor:"black",fontSize:parseInt(c.css("font-size"))/d,link:l};c.hasClass("status-macro")&&(p.text=" "+p.text+" ",p.alignment=c.parent().css("text-align")),t.push(p),1==t.length&&r.push({text:t})}else if(1==this.nodeType){var g,b=function(e){var t=[],a=e.parent();""==e.css("text-decoration")&&a.css("text-decoration")&&(t="");"underline"!=e.css("text-decoration")&&"underline"!=a.css("text-decoration")||t.push("underline");"line-through"!=e.css("text-decoration")&&"line-through"!=a.css("text-decoration")||t.push("lineThrough");return t}($(this));if("TABLE"==this.tagName)r.push(u(this)),t=[];else if("IMG"==this.tagName){if(!o){var v={image:"",width:this.width/1.5};a++;var N=y.getBase64Image(this,(function(e){v.image=e,a--,i(),e&&(r.push(v),t=[])}));N&&(v.image=N,a--,r.push(v),t=[])}}else"P"==this.tagName?(r.push(S(this,[],[],b)[0]),t=[]):"UL"==this.tagName?(g=S(this,[],[],b)[0],r.push({ul:g}),t=[]):"OL"==this.tagName?(g=S(this,[],[],b)[0],r.push({ol:g}),t=[]):"LI"==this.tagName?(g=S(this,[],[],b)[0],r.push(g),t=[]):"STYLE"!=this.tagName&&(t=S(this,t,r,(e=b,f=n,e.concat(f.filter((function(t){return e.indexOf(t)<0})))),l||this.href)[1])}}))}return[r,t]}function N(e){return e.stack&&e.stack.some((function(e){return M(e)}))}function M(e){return Array.isArray(e)?e.some((function(e){return T(e)})):T(e)}function T(e){return!(!e.text&&!e.image)||(e.ol||e.ul?(e.ol||e.ul).some((function(e){return M(e)||N(e)})):e.table?e.table.body.some((function(e){return e.some((function(e){return N(e)}))})):N(e))}"none"!==e.css("display")&&(e.find("table").not(".tablefilter-table-wrapper table table").not("#i_confiform_registration_form table").each((function(){var e=$(this);if("none"==e.css("display"))return!0;e.find("thead.tableFloatingHeader tr").hide(),e.find("tr:not(:has(td,th))").hide();var a=e.width();(a>1200&&(c.styles.header.fontSize=6,c.styles.cell.fontSize=6,d=14/6),!m||t&&h)||a>(e.hasClass("fixed-table")?770:870)&&(c.pageOrientation="landscape");c.content.push(u(this)),e.find("thead:eq(1) tr").show(),m=!1})),e.find("table").each((function(){$(this).data("counted-for-pdf",!1)}))),n=!0,i()},exportToDoc:function(e,t){for(var a=e.clone(),r=e.find("img"),n=a.find("img"),o=0;o<r.length;o++)n[o].width=r[o].width,n[o].height=r[o].height;a.find(".lockDisabled, .lockEnabled").remove(),a.find(".pivot-controls").remove(),a.find("tr").filter((function(){return"none"==$(this).css("display")})).remove(),a.find(".tf-header-hidden, .tf-hidden-column, .pivot-hidden-column").remove(),a.find("thead.tableFloatingHeader").remove(),a.find("td,th").filter((function(){return"none"==$(this).css("display")})).remove(),a.find("a[href]").each((function(){$(this).attr("href",this.href)})),a.find(".pivot-null-value").remove(),t&&(a.is(".chart-body.chart-hidden")&&a.find("table").remove(),a.first().prepend(e.parent().find("#pngdataurl").clone()),0!==a.find(".pivot-content").length&&a.find(".original-table").remove()),a.wordExport("export")},getBase64Image:function(e,t){var a=document.createElement("canvas");a.width=e.naturalWidth,a.height=e.naturalHeight;var r=a.getContext("2d");try{return r.drawImage(e,0,0),a.toDataURL()}catch(o){(a=document.createElement("canvas")).width=e.naturalWidth,a.height=e.naturalHeight,r=a.getContext("2d");var n=new Image;return n.setAttribute("crossOrigin","anonymous"),n.onload=function(){r.drawImage(n,0,0),t(a.toDataURL())},n.onerror=function(){t("")},n.src=e.src,""}},initDatePickerLocalisations:function(e){AJS.DatePicker.prototype.localisations.monthNames?AJS.DatePicker.prototype.localisations=this.localisations[e]:AJS.DatePicker.prototype.localisations[e]=this.localisations[e]},getLongestWordInArr:function(e){return e.reduce((function(e,t){return e.length<t.length?t:e}),"")},chartColors:["#8eb021","#d04437","#3572b0","#f6c342","#654982","#f691b2","#2484c1","#65a620","#7b6888","#d8d23a","#e98125","#6ada6a","#0c6197","#e4a14b","#8cc3e9","#a3acb2","#69a6f9","#cc1010","#31383b"],localisations:{ar_SA:{monthNames:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],dayNamesShort:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],dayNamesMin:["ح","ن","ث","ر","خ","ج","س"],firstDay:0,isRTL:!0,showMonthAfterYear:!1,yearSuffix:""},az_AZ:{monthNames:["Yanvar","Fevral","Mart","Aprel","May","İyun","İyul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"],monthNamesShort:["Yan","Fev","Mar","Apr","May","İyun","İyul","Avq","Sen","Okt","Noy","Dek"],dayNames:["Bazar","Bazar ertəsi","Çərşənbə axşamı","Çərşənbə","Cümə axşamı","Cümə","Şənbə"],dayNamesShort:["B","Be","Ça","Ç","Ca","C","Ş"],dayNamesMin:["B","B","Ç","С","Ç","C","Ş"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},be_BY:{monthNames:["Студзень","Люты","Сакавік","Красавік","Травень","Чэрвень","Ліпень","Жнівень","Верасень","Кастрычнік","Лістапад","Сьнежань"],monthNamesShort:["Сту","Лют","Сак","Кра","Тра","Чэр","Ліп","Жні","Вер","Кас","Ліс","Сьн"],dayNames:["нядзеля","панядзелак","аўторак","серада","чацьвер","пятніца","субота"],dayNamesMin:["Нд","Пн","Аў","Ср","Чц","Пт","Сб"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bg_BG:{monthNames:["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],monthNamesShort:["Яну","Фев","Мар","Апр","Май","Юни","Юли","Авг","Сеп","Окт","Нов","Дек"],dayNames:["Неделя","Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота"],dayNamesShort:["Нед","Пон","Вто","Сря","Чет","Пет","Съб"],dayNamesMin:["Не","По","Вт","Ср","Че","Пе","Съ"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},bs_BA:{monthNames:["Januar","Februar","Mart","April","Maj","Juni","Juli","August","Septembar","Oktobar","Novembar","Decembar"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:["Nedelja","Ponedeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"],dayNamesShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayNamesMin:["Ne","Po","Ut","Sr","Če","Pe","Su"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},ca_ES:{monthNames:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],monthNamesShort:["gen","feb","març","abr","maig","juny","jul","ag","set","oct","nov","des"],dayNames:["diumenge","dilluns","dimarts","dimecres","dijous","divendres","dissabte"],dayNamesShort:["dg","dl","dt","dc","dj","dv","ds"],dayNamesMin:["dg","dl","dt","dc","dj","dv","ds"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},cs_CZ:{monthNames:["leden","únor","březen","duben","květen","červen","červenec","srpen","září","říjen","listopad","prosinec"],monthNamesShort:["led","úno","bře","dub","kvě","čer","čvc","srp","zář","říj","lis","pro"],dayNames:["neděle","pondělí","úterý","středa","čtvrtek","pátek","sobota"],dayNamesShort:["ne","po","út","st","čt","pá","so"],dayNamesMin:["ne","po","út","st","čt","pá","so"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},da_DK:{monthNames:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNames:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"],dayNamesShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayNamesMin:["Sø","Ma","Ti","On","To","Fr","Lø"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},de_CH:{monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},de_DE:{monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],monthNamesShort:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dayNames:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],dayNamesShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},el_GR:{monthNames:["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],monthNamesShort:["Ιαν","Φεβ","Μαρ","Απρ","Μαι","Ιουν","Ιουλ","Αυγ","Σεπ","Οκτ","Νοε","Δεκ"],dayNames:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"],dayNamesShort:["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],dayNamesMin:["Κυ","Δε","Τρ","Τε","Πε","Πα","Σα"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},en_GB:{dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],firstDay:0,isRTL:!1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],showMonthAfterYear:!1,yearSuffix:""},en_US:{dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],firstDay:0,isRTL:!1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],showMonthAfterYear:!1,yearSuffix:""},es_AR:{monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},es_MX:{monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},es_VE:{monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},es_ES:{monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},et_EE:{monthNames:["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],monthNamesShort:["Jaan","Veebr","Märts","Apr","Mai","Juuni","Juuli","Aug","Sept","Okt","Nov","Dets"],dayNames:["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"],dayNamesShort:["Pühap","Esmasp","Teisip","Kolmap","Neljap","Reede","Laup"],dayNamesMin:["P","E","T","K","N","R","L"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},eu_ES:{monthNames:["urtarrila","otsaila","martxoa","apirila","maiatza","ekaina","uztaila","abuztua","iraila","urria","azaroa","abendua"],monthNamesShort:["urt.","ots.","mar.","api.","mai.","eka.","uzt.","abu.","ira.","urr.","aza.","abe."],dayNames:["igandea","astelehena","asteartea","asteazkena","osteguna","ostirala","larunbata"],dayNamesShort:["ig.","al.","ar.","az.","og.","ol.","lr."],dayNamesMin:["ig","al","ar","az","og","ol","lr"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},fa_IR:{monthNames:["ژانویه","فوریه","مارس","آوریل","مه","ژوئن","ژوئیه","اوت","سپتامبر","اکتبر","نوامبر","دسامبر"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["يکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنجشنبه","جمعه","شنبه"],dayNamesShort:["ی","د","س","چ","پ","ج","ش"],dayNamesMin:["ی","د","س","چ","پ","ج","ش"],firstDay:6,isRTL:!0,showMonthAfterYear:!1,yearSuffix:""},fi_FI:{monthNames:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],monthNamesShort:["Tammi","Helmi","Maalis","Huhti","Touko","Kesä","Heinä","Elo","Syys","Loka","Marras","Joulu"],dayNamesShort:["Su","Ma","Ti","Ke","To","Pe","La"],dayNames:["Sunnuntai","Maanantai","Tiistai","Keskiviikko","Torstai","Perjantai","Lauantai"],dayNamesMin:["Su","Ma","Ti","Ke","To","Pe","La"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},fr_BE:{monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},fr_CA:{monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avril","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},fr_FR:{monthNames:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],monthNamesShort:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},hi_IN:{monthNames:["जनवरी ","फरवरी","मार्च","अप्रेल","मई","जून","जूलाई","अगस्त ","सितम्बर","अक्टूबर","नवम्बर","दिसम्बर"],monthNamesShort:["जन","फर","मार्च","अप्रेल","मई","जून","जूलाई","अग","सित","अक्ट","नव","दि"],dayNames:["रविवार","सोमवार","मंगलवार","बुधवार","गुरुवार","शुक्रवार","शनिवार"],dayNamesMin:["रवि","सोम","मंगल","बुध","गुरु","शुक्र","शनि"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},hu_HU:{monthNames:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],monthNamesShort:["Jan","Feb","Már","Ápr","Máj","Jún","Júl","Aug","Szep","Okt","Nov","Dec"],dayNames:["Vasárnap","Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat"],dayNamesShort:["Vas","Hét","Ked","Sze","Csü","Pén","Szo"],dayNamesMin:["V","H","K","Sze","Cs","P","Szo"],firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},in_ID:{monthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","Nopember","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agus","Sep","Okt","Nop","Des"],dayNames:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],dayNamesMin:["Mg","Sn","Sl","Rb","Km","jm","Sb"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},is_IS:{monthNames:["Janúar","Febrúar","Mars","Apríl","Maí","Júní","Júlí","Ágúst","September","Október","Nóvember","Desember"],monthNamesShort:["Jan","Feb","Mar","Apr","Maí","Jún","Júl","Ágú","Sep","Okt","Nóv","Des"],dayNames:["Sunnudagur","Mánudagur","Þriðjudagur","Miðvikudagur","Fimmtudagur","Föstudagur","Laugardagur"],dayNamesShort:["Sun","Mán","Þri","Mið","Fim","Fös","Lau"],dayNamesMin:["Su","Má","Þr","Mi","Fi","Fö","La"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},it_IT:{monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gi","Ve","Sa"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},iw_IL:{monthNames:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],monthNamesShort:["ינו","פבר","מרץ","אפר","מאי","יוני","יולי","אוג","ספט","אוק","נוב","דצמ"],dayNames:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],dayNamesMin:["א'","ב'","ג'","ד'","ה'","ו'","שבת"],firstDay:0,isRTL:!0,showMonthAfterYear:!1,yearSuffix:""},ja_JP:{monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","火","水","木","金","土"],dayNamesMin:["日","月","火","水","木","金","土"],firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},ka_GE:{monthNames:["იანვარი","თებერვალი","მარტი","აპრილი","მაისი","ივნისი","ივლისი","აგვისტო","სექტემბერი","ოქტომბერი","ნოემბერი","დეკემბერი"],monthNamesShort:["იან","თებ","მარ","აპრ","მაი","ივნ","ივლ","აგვ","სექ","ოქტ","ნოე","დეკ"],dayNames:["კვირა","ორშაბათი","სამშაბათი","ოთხშაბათი","ხუთშაბათი","პარასკევი","შაბათი"],dayNamesShort:["კვ","ორშ","სამ","ოთხ","ხუთ","პარ","შაბ"],dayNamesMin:["კვ","ორშ","სამ","ოთხ","ხუთ","პარ","შაბ"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},ko_KR:{monthNames:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],monthNamesShort:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayNames:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],dayNamesShort:["일","월","화","수","목","금","토"],dayNamesMin:["일","월","화","수","목","금","토"],firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"년"},lt_LT:{monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],monthNamesShort:["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rugp","Rugs","Spa","Lap","Gru"],dayNames:["sekmadienis","pirmadienis","antradienis","trečiadienis","ketvirtadienis","penktadienis","šeštadienis"],dayNamesShort:["sek","pir","ant","tre","ket","pen","šeš"],dayNamesMin:["Se","Pr","An","Tr","Ke","Pe","Še"],firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:""},lv_LV:{monthNames:["Janvāris","Februāris","Marts","Aprīlis","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],monthNamesShort:["Jan","Feb","Mar","Apr","Mai","Jūn","Jūl","Aug","Sep","Okt","Nov","Dec"],dayNames:["svētdiena","pirmdiena","otrdiena","trešdiena","ceturtdiena","piektdiena","sestdiena"],dayNamesShort:["svt","prm","otr","tre","ctr","pkt","sst"],dayNamesMin:["Sv","Pr","Ot","Tr","Ct","Pk","Ss"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},mk_MK:{monthNames:["Јануари","Февруари","Март","Април","Мај","Јуни","Јули","Август","Септември","Октомври","Ноември","Декември"],monthNamesShort:["Јан","Фев","Мар","Апр","Мај","Јун","Јул","Авг","Сеп","Окт","Ное","Дек"],dayNames:["Недела","Понеделник","Вторник","Среда","Четврток","Петок","Сабота"],dayNamesShort:["Нед","Пон","Вто","Сре","Чет","Пет","Саб"],dayNamesMin:["Не","По","Вт","Ср","Че","Пе","Са"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},nl_BE:{monthNames:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],monthNamesShort:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},nl_NL:{monthNames:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],monthNamesShort:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],dayNames:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],dayNamesShort:["zon","maa","din","woe","don","vri","zat"],dayNamesMin:["zo","ma","di","wo","do","vr","za"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},no_NO:{monthNames:["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],monthNamesShort:["jan","feb","mar","apr","mai","jun","jul","aug","sep","okt","nov","des"],dayNamesShort:["søn","man","tir","ons","tor","fre","lør"],dayNames:["søndag","mandag","tirsdag","onsdag","torsdag","fredag","lørdag"],dayNamesMin:["sø","ma","ti","on","to","fr","lø"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},pl_PL:{monthNames:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],monthNamesShort:["sty","lu","mar","kw","maj","cze","lip","sie","wrz","pa","lis","gru"],dayNames:["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],dayNamesShort:["Nie","Pn","Wt","Śr","Czw","Pt","So"],dayNamesMin:["N","Pn","Wt","Śr","Cz","Pt","So"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},pt_BR:{monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},pt_PT:{monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],dayNames:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayNamesMin:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},ro_RO:{monthNames:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],monthNamesShort:["Ian","Feb","Mar","Apr","Mai","Iun","Iul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Duminică","Luni","Marţi","Miercuri","Joi","Vineri","Sâmbătă"],dayNamesShort:["Dum","Lun","Mar","Mie","Joi","Vin","Sâm"],dayNamesMin:["Du","Lu","Ma","Mi","Jo","Vi","Sâ"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},ru_RU:{monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["янв","фев","мар","фпр","мая","июн","июл","фвг","сен","окт","ноя","дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},sk_SK:{monthNames:["január","február","marec","apríl","máj","jún","júl","august","september","október","november","december"],monthNamesShort:["Jan","Feb","Mar","Apr","Máj","Jún","Júl","Aug","Sep","Okt","Nov","Dec"],dayNames:["nedeľa","pondelok","utorok","streda","štvrtok","piatok","sobota"],dayNamesShort:["Ned","Pon","Uto","Str","Štv","Pia","Sob"],dayNamesMin:["Ne","Po","Ut","St","Št","Pia","So"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},sl_SL:{monthNames:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Avg","Sep","Okt","Nov","Dec"],dayNames:["Nedelja","Ponedeljek","Torek","Sreda","Četrtek","Petek","Sobota"],dayNamesShort:["Ned","Pon","Tor","Sre","Čet","Pet","Sob"],dayNamesMin:["Ne","Po","To","Sr","Če","Pe","So"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},sr_SR:{monthNames:["Јануар","Фебруар","Март","Април","Мај","Јун","Јул","Август","Септембар","Октобар","Новембар","Децембар"],monthNamesShort:["Јан","Феб","Мар","Апр","Мај","Јун","Јул","Авг","Сеп","Окт","Нов","Дец"],dayNames:["Недеља","Понедељак","Уторак","Среда","Четвртак","Петак","Субота"],dayNamesShort:["Нед","Пон","Уто","Сре","Чет","Пет","Суб"],dayNamesMin:["Не","По","Ут","Ср","Че","Пе","Су"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},sv_SE:{monthNames:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],dayNamesShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],dayNames:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],dayNamesMin:["Sö","Må","Ti","On","To","Fr","Lö"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},th_TH:{monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthNamesShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],dayNames:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayNamesShort:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],dayNamesMin:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},tr_TR:{monthNames:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],monthNamesShort:["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],dayNames:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"],dayNamesShort:["Pz","Pt","Sa","Ça","Pe","Cu","Ct"],dayNamesMin:["Pz","Pt","Sa","Ça","Pe","Cu","Ct"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},uk_UA:{monthNames:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],monthNamesShort:["Січ","Лют","Бер","Кві","Тра","Чер","Лип","Сер","Вер","Жов","Лис","Гру"],dayNames:["неділя","понеділок","вівторок","середа","четвер","п’ятниця","субота"],dayNamesShort:["нед","пнд","вів","срд","чтв","птн","сбт"],dayNamesMin:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},vi_VN:{monthNames:["Tháng Một","Tháng Hai","Tháng Ba","Tháng Tư","Tháng Năm","Tháng Sáu","Tháng Bảy","Tháng Tám","Tháng Chín","Tháng Mười","Tháng Mười Một","Tháng Mười Hai"],monthNamesShort:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayNames:["Chủ Nhật","Thứ Hai","Thứ Ba","Thứ Tư","Thứ Năm","Thứ Sáu","Thứ Bảy"],dayNamesShort:["CN","T2","T3","T4","T5","T6","T7"],dayNamesMin:["CN","T2","T3","T4","T5","T6","T7"],firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},zh_CN:{monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},zh_TW:{monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"}}};$.extend({getUrlHashVars:function(){for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("#")+1).split("&"),r=0;r<a.length;r++)e=a[r].split("="),t.push(e[0]),t[e[0]]=decodeURIComponent(e[1]);return t},getUrlHashVar:function(e){return $.getUrlHashVars()[e]}}),$.fn.changeElementType=function(e){var t={};$.each(this[0].attributes,(function(e,a){t[a.nodeName]=a.nodeValue})),this.replaceWith((function(){return $("<"+e+"/>",t).append($(this).contents())}))},$.fn.filterByAttr=function(e,t){return this.filter((function(){return this.attributes[e].textContent===t}))},$.fn.getClassStartsWith=function(e){var t=this.length?this[0].className.match(e):null;return t?t[0]:null};t.a=y},2:function(e,t,a){"use strict";var r={loadScriptsBeforeExport:function(e){window.pdfMake?e():r.loadResource("com.stiltsoft.confluence.plugin.tablefilter.tablefilter:export-pdf-resources",e)},getCurrentUserFullName:function(){return AJS.params.currentUserFullname},getCurrentUserName:function(){return AJS.params.remoteUser},saveMacroParams:function(e,t){$.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"POST",cache:!1,url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/save-tf",dataType:"json",data:e,error:function(e){r.showError(e,t)}})},showError:function(e,t){var a=-1!==e.responseText.indexOf("com.atlassian.confluence.api.service.exceptions.ReadOnlyException"),r=$('<div id="tfac-message"></div>');t.append(r),AJS.messages.error(r,{body:a?"This Confluence site is temporarily in the read-only mode. You cannot make any changes right now.":"Oops! An unexpected error occurred! Please see logs for details.",closeable:!0}),setTimeout((function(){r.remove()}),5e3)},loadResource:function(e,t){$.ajax({contentType:"application/x-www-form-urlencoded; charset=utf-8",type:"GET",url:Confluence.getContextPath()+"/rest/table-filter/1.0/service/load-resource",dataType:"text",data:{key:e},success:function(e){$("head").append(e),t()}})},setCookie:function(e,t,a){var r=a?JSON.stringify(t):t;document.cookie=e+"="+encodeURIComponent(r)+"; max-age=259200000"},getCookie:function(e,t){if(0!=document.cookie.length){var a=new RegExp("[; ]"+e+"=([^\\s;]*)"),r=(" "+document.cookie).match(a);if(r)return t?JSON.parse(decodeURIComponent(r[1])):decodeURIComponent(r[1])}return""},storeValue:function(e,t){localStorage.setItem(e,t)},getStoredValue:function(e){return localStorage.getItem(e)},removeValue:function(e){return localStorage.removeItem(e)}};t.a=r},24:function(e,t){if(window.TableUtilsTemplate=window.TableUtilsTemplate||{},void 0===a)var a={};a.exportToCSV=function(e,t){return'<section role="dialog" id="export-csv-dialog-'+e.macroId+'" class="aui-layer aui-dialog2 aui-dialog2-medium tf-csv-export-dialog" aria-hidden="true" data-aui-remove-on-hide="true" data-aui-modal="true"><header class="aui-dialog2-header"><h2 class="aui-dialog2-header-main">'+"Export Options"+'</h2></header><div class="aui-dialog2-content"><form class="aui" onsubmit="return false;"><div class="export-csv-input tf-csv-export-links-wrapper"><input class="checkbox tf-csv-export-links" type="checkbox"'+(e.exportLinks?"":'checked="checked"')+"><label>"+"Export clickable links"+'</label></div><div class="export-csv-input" style="width: 49%; margin-right: 0;"><label class="tf-csv-export-link-separator-label">'+"List Separator"+'</label><select class="select" id="tf-csv-export-link-separator"><option value=";" '+(";"==e.linkSeparator?"selected":"")+'>;</option><option value="," '+(","==e.linkSeparator?"selected":"")+'>,</option></select></div><select class="select" id="tf-csv-export-type"><option value="default">'+"Default settings"+'</option><option value="custom">'+"Custom settings"+'</option></select><div id="tf-csv-export-default-message">'+"Please use the default settings for exporting data to CSV. These parameters are optimized for most spreadsheet management applications, such as MS Excel and others."+'</div><div id="tf-csv-export-params"><div><div class="export-csv-input" style="width: 49%;"><label>'+"Delimiter character"+'</label><div><input class="text export-csv-separator" type="text" style="width: 100%; max-width: none;" placeholder="'+"Start typing...\u200b"+'" data-width="150px" value="'+e.separator+'" /></div></div><div class="export-csv-input" style="width: 49%; margin-right: 0 !important;"><label>'+"Quote character"+'</label><div><input class="text export-csv-quote" type="text" style="width: 100%; max-width: none;" placeholder="'+"Start typing...\u200b"+'" data-width="150px" value="'+e.quote+'" /></div></div></div><div class="export-csv-textarea"><label>'+"Export table header"+'</label><textarea class="textarea max-textarea export-csv-headers" rows="3" cols="54">'+e.headers+'</textarea></div></div></form></div><footer class="aui-dialog2-footer"><div class="aui-dialog2-footer-actions"><button id="csv-export-'+e.macroId+'" class="aui-button aui-button-primary">'+"Export"+'</button><button id="csv-cancel-'+e.macroId+'" class="aui-button aui-button-link">'+"Cancel"+"</button></div></footer></section>"},goog.DEBUG&&(a.exportToCSV.soyTemplateName="TableUtilsTemplate.exportToCSV"),a.userMentionPopup=function(e,t){return'<div class="ajs-content-hover aui-box-shadow tf-user-mention-popup"><div class="contents" style="width: 300px;"><div class="profile-macro hipchat-status-applied"><div class="vcard"><a class="userLogoLink" data-username="admin" href="" target="_blank"><img class="userLogo logo" src="'+e.logoUrl+'" alt="User icon: '+e.username+'" title="'+e.username+'" data-fallback-img-loaded-listener="true" width="48" height="48"></a><div class="values"><h4><a href="'+e.baseUrl+"/display/~"+e.username+'" class="url fn confluence-userlink" data-username="'+e.username+'" target="_blank">'+e.displayName+'</a></h4><a href="mailto:'+e.email+'" title="Send Email to '+e.displayName+'" class="email" target="_self">'+e.email+"</a></div></div></div></div></div>"},goog.DEBUG&&(a.userMentionPopup.soyTemplateName="TableUtilsTemplate.userMentionPopup"),a.paginationMsg=function(e,t){return'<li class="tfac-pagination">'+a.displayedRowsMsg(null)+"</li>"},goog.DEBUG&&(a.paginationMsg.soyTemplateName="TableUtilsTemplate.paginationMsg"),a.jiraIssuesMsg=function(e,t){return'<span class="tfac-pagination">'+a.displayedRowsMsg(null)+"</span>"},goog.DEBUG&&(a.jiraIssuesMsg.soyTemplateName="TableUtilsTemplate.jiraIssuesMsg"),a.displayedRowsMsg=function(e,t){return'<a><span class="aui-icon aui-icon-small aui-iconfont-info"></span></a>'+soy.$$escapeHtml("Only currently displayed rows of the table can be filtered, aggregated and visualized.")+'<span class="aui-icon aui-icon-small aui-iconfont-remove-label hide" title="'+soy.$$escapeHtml("Hide this message")+'"></span>'},goog.DEBUG&&(a.displayedRowsMsg.soyTemplateName="TableUtilsTemplate.displayedRowsMsg"),a.mergedHeader=function(e,t){for(var a='<tr class="tf-header-hidden synchrony-exclude" contenteditable="false">',r=e.data,n=r.length,o=0;o<n;o++){a+="<th>"+r[o].html+"</th>"}return a+="</tr>"},goog.DEBUG&&(a.mergedHeader.soyTemplateName="TableUtilsTemplate.mergedHeader"),e.exports=a}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:0171f00fb86c20d2cd832ba2ace88355', location = 'build/0171f00fb86c20d2cd83.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[4],{23:function(e,t,n){e.exports={ResizeSensor:n(35),ElementQueries:n(49)}},35:function(e,t,n){"use strict";var i,r;"undefined"!=typeof window&&window,void 0===(r="function"==typeof(i=function(){if("undefined"==typeof window)return null;var e="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(t){return e.setTimeout(t,20)};function n(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,r=0,o=e.length;if(i)for(;r<o;r++)t(e[r]);else t(e)}function i(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}function r(e,t){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))}var o=function(e,s){function d(){var e,t,n=[];this.add=function(e){n.push(e)},this.call=function(i){for(e=0,t=n.length;e<t;e++)n[e].call(this,i)},this.remove=function(i){var r=[];for(e=0,t=n.length;e<t;e++)n[e]!==i&&r.push(n[e]);n=r},this.length=function(){return n.length}}function a(e,n){if(e)if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new d,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.dir="ltr",e.resizeSensor.className="resize-sensor";var o={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},s={position:"absolute",left:"0px",top:"0px",transition:"0s"};r(e.resizeSensor,o);var a=document.createElement("div");a.className="resize-sensor-expand",r(a,o);var l=document.createElement("div");r(l,s),a.appendChild(l);var u=document.createElement("div");u.className="resize-sensor-shrink",r(u,o);var c=document.createElement("div");r(c,s),r(c,{width:"200%",height:"200%"}),u.appendChild(c),e.resizeSensor.appendChild(a),e.resizeSensor.appendChild(u),e.appendChild(e.resizeSensor);var h,f,m=window.getComputedStyle(e),p=m?m.getPropertyValue("position"):null;"absolute"!==p&&"relative"!==p&&"fixed"!==p&&(e.style.position="relative");var v=i(e),y=0,g=0,w=!0,S=0,x=function(){if(w){if(0===e.offsetWidth&&0===e.offsetHeight)return void(S||(S=t((function(){S=0,x()}))));w=!1}var n,i;n=e.offsetWidth,i=e.offsetHeight,l.style.width=n+10+"px",l.style.height=i+10+"px",a.scrollLeft=n+10,a.scrollTop=i+10,u.scrollLeft=n+10,u.scrollTop=i+10};e.resizeSensor.resetSensor=x;var z=function(){f=0,h&&(y=v.width,g=v.height,e.resizedAttached&&e.resizedAttached.call(v))},b=function(){v=i(e),(h=v.width!==y||v.height!==g)&&!f&&(f=t(z)),x()},E=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};E(a,"scroll",b),E(u,"scroll",b),t(x)}}n(e,(function(e){a(e,s)})),this.detach=function(t){o.detach(e,t)},this.reset=function(){e.resizeSensor.resetSensor()}};if(o.reset=function(e){n(e,(function(e){e.resizeSensor.resetSensor()}))},o.detach=function(e,t){n(e,(function(e){e&&(e.resizedAttached&&"function"==typeof t&&(e.resizedAttached.remove(t),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached))}))},"undefined"!=typeof MutationObserver){var s=new MutationObserver((function(e){for(var t in e)if(e.hasOwnProperty(t))for(var n=e[t].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&o.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(e){s.observe(document.body,{childList:!0,subtree:!0})}))}return o})?i.call(t,n,t,e):i)||(e.exports=r)},49:function(e,t,n){"use strict";var i,r,o;"undefined"!=typeof window&&window,r=[n(35)],void 0===(o="function"==typeof(i=function(e){var t=function(){var t,n={},i=[];function r(e){e||(e=document.documentElement);var t=window.getComputedStyle(e,null).fontSize;return parseFloat(t)||16}function o(e,t){var n=t.split(/\d/),i=n[n.length-1];switch(t=parseFloat(t),i){case"px":return t;case"em":return t*r(e);case"rem":return t*r();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var o=document.documentElement.clientWidth/100,s=document.documentElement.clientHeight/100;return t*(0,Math["vmin"===i?"min":"max"])(o,s);default:return t}}function s(e,t){var i,r,s,d,a,l,u,c;this.element=e;var h=["min-width","min-height","max-width","max-height"];this.call=function(){for(i in s=function(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}(this.element),l={},n[t])n[t].hasOwnProperty(i)&&(r=n[t][i],d=o(this.element,r.value),a="width"===r.property?s.width:s.height,c=r.mode+"-"+r.property,u="","min"===r.mode&&a>=d&&(u+=r.value),"max"===r.mode&&a<=d&&(u+=r.value),l[c]||(l[c]=""),u&&-1===(" "+l[c]+" ").indexOf(" "+u+" ")&&(l[c]+=" "+u));for(var e in h)h.hasOwnProperty(e)&&(l[h[e]]?this.element.setAttribute(h[e],l[h[e]].substr(1)):this.element.removeAttribute(h[e]))}}function d(t,n){t.elementQueriesSetupInformation||(t.elementQueriesSetupInformation=new s(t,n)),t.elementQueriesSensor||(t.elementQueriesSensor=new e(t,(function(){t.elementQueriesSetupInformation.call()})))}function a(e,r,o,s){if(void 0===n[e]){n[e]=[];var d=i.length;t.innerHTML+="\n"+e+" {animation: 0.1s element-queries;}",t.innerHTML+="\n"+e+" > .resize-sensor {min-width: "+d+"px;}",i.push(e)}n[e].push({mode:r,property:o,value:s})}function l(e){var t;if(document.querySelectorAll&&(t=e?e.querySelectorAll.bind(e):document.querySelectorAll.bind(document)),t||"undefined"==typeof $$||(t=$$),t||"undefined"==typeof jQuery||(t=jQuery),!t)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return t}function u(t){var n=[],i=[],r=[],o=0,s=-1,d=[];for(var a in t.children)if(t.children.hasOwnProperty(a)&&t.children[a].tagName&&"img"===t.children[a].tagName.toLowerCase()){n.push(t.children[a]);var l=t.children[a].getAttribute("min-width")||t.children[a].getAttribute("data-min-width"),u=t.children[a].getAttribute("data-src")||t.children[a].getAttribute("url");r.push(u);var c={minWidth:l};i.push(c),l?t.children[a].style.display="none":(o=n.length-1,t.children[a].style.display="block")}function h(){var e,a=!1;for(e in n)n.hasOwnProperty(e)&&i[e].minWidth&&t.offsetWidth>i[e].minWidth&&(a=e);if(a||(a=o),s!==a)if(d[a])n[s].style.display="none",n[a].style.display="block",s=a;else{var l=new Image;l.onload=function(){n[a].src=r[a],n[s].style.display="none",n[a].style.display="block",d[a]=!0,s=a},l.src=r[a]}else n[a].src=r[a]}s=o,t.resizeSensorInstance=new e(t,h),h()}var c=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,h=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim;function f(e){var t,n,i,r;for(e=e.replace(/'/g,'"');null!==(t=c.exec(e));)for(n=t[1]+t[3],i=t[2];null!==(r=h.exec(i));)a(n,r[1],r[2],r[3])}function m(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||f(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?f(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||f(t):4===e[n].type?m(e[n].cssRules||e[n].rules):3===e[n].type&&e[n].styleSheet.hasOwnProperty("cssRules")&&m(e[n].styleSheet.cssRules)}var p=!1;this.init=function(){var n="animationstart";void 0!==document.documentElement.style.webkitAnimationName?n="webkitAnimationStart":void 0!==document.documentElement.style.MozAnimationName?n="mozanimationstart":void 0!==document.documentElement.style.OAnimationName&&(n="oanimationstart"),document.body.addEventListener(n,(function(t){var n=t.target,r=n&&window.getComputedStyle(n,null),o=r&&r.getPropertyValue("animation-name");if(o&&-1!==o.indexOf("element-queries")){n.elementQueriesSensor=new e(n,(function(){n.elementQueriesSetupInformation&&n.elementQueriesSetupInformation.call()}));var s=window.getComputedStyle(n.resizeSensor,null).getPropertyValue("min-width");s=parseInt(s.replace("px","")),d(t.target,i[s])}})),p||((t=document.createElement("style")).type="text/css",t.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img {width: 100%;}",t.innerHTML+="\n@keyframes element-queries { 0% { visibility: inherit; } }",document.getElementsByTagName("head")[0].appendChild(t),p=!0);for(var r=0,o=document.styleSheets.length;r<o;r++)try{document.styleSheets[r].href&&document.styleSheets[r].href.indexOf("file://"),m(document.styleSheets[r].cssRules||document.styleSheets[r].rules||document.styleSheets[r].cssText)}catch(e){}!function(){for(var e=l()("[data-responsive-image],[responsive-image]"),t=0,n=e.length;t<n;t++)u(e[t])}()},this.findElementQueriesElements=function(e){!function(e){var t=l(e);for(var i in n)if(n.hasOwnProperty(i))for(var r=t(i,e),o=0,s=r.length;o<s;o++)d(r[o],i)}(e)},this.update=function(){this.init()}};return t.update=function(){t.instance.update()},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor):e.resizeSensorInstance&&(e.resizeSensorInstance.detach(),delete e.resizeSensorInstance)},t.init=function(){t.instance||(t.instance=new t),t.instance.init()},t.findElementQueriesElements=function(e){t.instance.findElementQueriesElements(e)},t.listen=function(){!function(e){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval((function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))}),10);else window.onload=e}(t.init)},t})?i.apply(t,r):i)||(e.exports=o)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:4e384cefbbd8ac440b20b04189770b81', location = 'build/4e384cefbbd8ac440b20.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[3],{8:function(e,n,t){var r,i,o;i=[],void 0===(o="function"==typeof(r=function(){"use strict";var e=["decimals","thousand","mark","prefix","suffix","encoder","decoder","negativeBefore","negative","edit","undo"];function n(e){return e.split("").reverse().join("")}function t(e,n){return e.substring(0,n.length)===n}function r(e,n,t){if((e[n]||e[t])&&e[n]===e[t])throw new Error(n)}function i(e){return"number"==typeof e&&isFinite(e)}function o(e,t,r,o,f,u,s,a,c,p,l,d){var h,g,v,w,x,m=d,y="",b="";return u&&(d=u(d)),!!i(d)&&(!1!==e&&0===parseFloat(d.toFixed(e))&&(d=0),d<0&&(h=!0,d=Math.abs(d)),!1!==e&&(x=e,w=(w=d).toString().split("e"),d=(+((w=(w=Math.round(+(w[0]+"e"+(w[1]?+w[1]+x:x)))).toString().split("e"))[0]+"e"+(w[1]?+w[1]-x:-x))).toFixed(x)),-1!==(d=d.toString()).indexOf(".")?(v=(g=d.split("."))[0],r&&(y=r+g[1])):v=d,t&&(v=n(v).match(/.{1,3}/g),v=n(v.join(n(t)))),h&&a&&(b+=a),o&&(b+=o),h&&c&&(b+=c),b+=v,b+=y,f&&(b+=f),p&&(b=p(b,m)),b)}function f(e,n,r,o,f,u,s,a,c,p,l,d){var h,g="";return l&&(d=l(d)),!(!d||"string"!=typeof d)&&(a&&t(d,a)&&(d=d.replace(a,""),h=!0),o&&t(d,o)&&(d=d.replace(o,"")),c&&t(d,c)&&(d=d.replace(c,""),h=!0),f&&function(e,n){return e.slice(-1*n.length)===n}(d,f)&&(d=d.slice(0,-1*f.length)),n&&(d=d.split(n).join("")),r&&(d=d.replace(r,".")),h&&(g+="-"),""!==(g=(g+=d).replace(/[^0-9\.\-.]/g,""))&&(g=Number(g),s&&(g=s(g)),!!i(g)&&g))}function u(n,t,r){var i,o=[];for(i=0;i<e.length;i+=1)o.push(n[e[i]]);return o.push(r),t.apply("",o)}return function n(t){if(!(this instanceof n))return new n(t);"object"==typeof t&&(t=function(n){var t,i,o,f={};for(void 0===n.suffix&&(n.suffix=n.postfix),t=0;t<e.length;t+=1)if(void 0===(o=n[i=e[t]]))"negative"!==i||f.negativeBefore?"mark"===i&&"."!==f.thousand?f[i]=".":f[i]=!1:f[i]="-";else if("decimals"===i){if(!(o>=0&&o<8))throw new Error(i);f[i]=o}else if("encoder"===i||"decoder"===i||"edit"===i||"undo"===i){if("function"!=typeof o)throw new Error(i);f[i]=o}else{if("string"!=typeof o)throw new Error(i);f[i]=o}return r(f,"mark","thousand"),r(f,"prefix","negative"),r(f,"prefix","negativeBefore"),f}(t),this.to=function(e){return u(t,o,e)},this.from=function(e){return u(t,f,e)})}})?r.apply(n,i):r)||(e.exports=o)}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:a68e3b9d10ecffdda242797f60f10d0a', location = 'build/a68e3b9d10ecffdda242.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[1],{7:function(e,t,n){(function(n){var o,a,i;a=[],void 0===(i="function"==typeof(o=function(){"use strict";function t(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){r(o.response,t,n)},o.onerror=function(){},o.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,r=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(e,n,r){var c=i.URL||i.webkitURL,s=document.createElement("a");n=n||e.name||"download",s.download=n,s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?a(s):o(s.href)?t(e,n,r):a(s,s.target="_blank")):(s.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(s.href)}),4e4),setTimeout((function(){a(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,i){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,i),n);else if(o(e))t(e,n,i);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){a(r)}))}}:function(e,n,o,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,o);var r="application/octet-stream"===e.type,c=/constructor/i.test(i.HTMLElement)||i.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||r&&c)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},l.readAsDataURL(e)}else{var f=i.URL||i.webkitURL,u=f.createObjectURL(e);a?a.location=u:location.href=u,a=null,setTimeout((function(){f.revokeObjectURL(u)}),4e4)}});i.saveAs=r.saveAs=r,e.exports=r})?o.apply(t,a):o)||(e.exports=i)}).call(this,n(27))}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:1ca6aeb07e895e7bc5e182aa52d34709', location = 'build/1ca6aeb07e895e7bc5e1.js' */
(window.webpackJsonpTFAC=window.webpackJsonpTFAC||[]).push([[0],{27:function(n,o){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(n){"object"==typeof window&&(t=window)}n.exports=t}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.plugin.tablefilter.tablefilter:tablefilter-resources', location = 'build/tablefilter.js' */
!function(e){function r(r){for(var n,i,l=r[0],a=r[1],f=r[2],p=0,s=[];p<l.length;p++)i=l[p],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&s.push(o[i][0]),o[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(c&&c(r);s.length;)s.shift()();return u.push.apply(u,f||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,l=1;l<t.length;l++){var a=t[l];0!==o[a]&&(n=!1)}n&&(u.splice(r--,1),e=i(i.s=t[0]))}return e}var n={},o={27:0},u=[];function i(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=n,i.d=function(e,r,t){i.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,r){if(1&r&&(e=i(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)i.d(t,n,function(r){return e[r]}.bind(null,n));return t},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="/";var l=window.webpackJsonpTFAC=window.webpackJsonpTFAC||[],a=l.push.bind(l);l.push=r,l=l.slice();for(var f=0;f<l.length;f++)r(l[f]);var c=a;u.push([57,0,1,3,4,2,7,6,5,8]),t()}({12:function(e,r){e.exports=jQuery},57:function(e,r,t){"use strict";t.r(r);t(26),t(31),t(28),t(29),t(58),t(32);var n=t(0),o=t(10);window.TableUtils=n.a,window.TableFilter=o.a},58:function(e,r,t){}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-hipchat-integration-plugin:hipchat-presence-resources', location = 'presence/presence.soy' */
// This file was automatically generated from presence.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.HipChat.Presence.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.HipChat == 'undefined') { Confluence.Templates.HipChat = {}; }
if (typeof Confluence.Templates.HipChat.Presence == 'undefined') { Confluence.Templates.HipChat.Presence = {}; }


Confluence.Templates.HipChat.Presence.badge = function(opt_data, opt_ignored) {
  return '<span class="hipchat-status aui-icon aui-icon-small hipchat-icon-' + soy.$$escapeHtml(opt_data.statusCode) + '" data-status="' + soy.$$escapeHtml(opt_data.statusCode) + '" title="' + soy.$$escapeHtml(opt_data.statusMessage) + '">' + soy.$$escapeHtml(opt_data.statusMessage) + '</span>';
};
if (goog.DEBUG) {
  Confluence.Templates.HipChat.Presence.badge.soyTemplateName = 'Confluence.Templates.HipChat.Presence.badge';
}


Confluence.Templates.HipChat.Presence.chatBar = function(opt_data, opt_ignored) {
  return '<div class="hipchat-chatbar aui-buttons"><button class="aui-button hipchat-chat" title="' + soy.$$escapeHtml('Unable to start chat as this user is not known in Hipchat.') + '" aria-disabled="true"><span><span class="aui-icon aui-icon-small hipchat-icon-chat">' + soy.$$escapeHtml('Chat') + '</span></span></button><button class="aui-button hipchat-voice" title="' + soy.$$escapeHtml('Unable to start voice calls as this user is not known in Hipchat.') + '" aria-disabled="true" data-call-type="voice"><span><span class="aui-icon aui-icon-small hipchat-icon-voice">' + soy.$$escapeHtml('Voice') + '</span></span></button><button class="aui-button hipchat-video" title="' + soy.$$escapeHtml('Unable to start video calls as this user is not known in Hipchat.') + '" aria-disabled="true" data-call-type="video"><span><span class="aui-icon aui-icon-small hipchat-icon-video">' + soy.$$escapeHtml('Video') + '</span></span></button></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.HipChat.Presence.chatBar.soyTemplateName = 'Confluence.Templates.HipChat.Presence.chatBar';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-hipchat-integration-plugin:hipchat-presence-resources', location = 'presence/presence.js' */
(function(d){var f=AJS.DarkFeatures.isEnabled("hipchat.chatbar");var a={hipChatCall:function(g,h){if(!g){return}return"hipchat://hipchat.com/user/"+encodeURI(g)+(h?"?call="+encodeURI(h):"")}};var c=AJS.contextPath()+"/rest/hipchat/integration/1.0/users/";var b=function(g){return function(j){var i=d(this);var h=i.attr("data-user-id");var k=i.attr("data-caller-id");if(!k){return}var l=i.attr("data-call-type");if(!g&&l){return}window.location.replace(a.hipChatCall(k,l));AJS.trigger("analyticsEvent",{name:"hipchat.chatbar."+(l||"chat"),data:{userId:h}});j.preventDefault()}};var e=function(g){return function(i){if(!i||!i.presence){return}var j=i.userId;var h=i.hipChatUserId;var k;var m;var l=d(g).find(".hipchat-chatbar .aui-button");l.attr("data-user-id",j);l.attr("data-caller-id",h);l.click(b(i.presence.is_online));if(i.presence.is_online){if(i.presence.show==="xa"||i.presence.show==="away"){k="away";m="Away"}else{if(i.presence.show==="dnd"){k="dnd";m="Do not disturb"}else{k="available";m="Available"}}l.filter(".hipchat-chat").attr("title","Start chat with this user in Hipchat.").removeAttr("aria-disabled");l.filter(".hipchat-voice").attr("title","Start a voice call with this user in Hipchat.").removeAttr("aria-disabled");l.filter(".hipchat-video").attr("title","Start a video call with this user in Hipchat.").removeAttr("aria-disabled")}else{k="offline";m="Offline";l.filter(".hipchat-chat").attr("title","Start chat with this user in Hipchat.").removeAttr("aria-disabled");l.filter(".hipchat-voice").attr("title","Unable to start voice calls as this user is not known in Hipchat.");l.filter(".hipchat-video").attr("title","Unable to start video calls as this user is not known in Hipchat.")}if(i.presence.status){m+=" ("+i.presence.status+")"}d("div.values",g).append(Confluence.Templates.HipChat.Presence.badge({statusCode:k,statusMessage:m}));AJS.trigger("analyticsEvent",{name:"hipchat.presence.user.found",data:{userId:i.userId}})}};d(document).bind("ajaxComplete",function(i,g,h){if(/userinfopopup\.action/.test(h.url)){d.each(d(".vcard"),function(n,p){var m=d(p);var k=m.closest(".contents");var l=k.find(".profile-macro").first();var o=k.find(".actions").first();if(l.hasClass("hipchat-status-applied")||!o.length){return}l.addClass("hipchat-status-applied");if(f){o.addClass("hipchat-chatbar-support");o.append(Confluence.Templates.HipChat.Presence.chatBar());o.find(".ajs-menu-bar").addClass("aui-buttons");o.find(".ajs-button > a").addClass("aui-button");o.find(".user-popup-more").addClass("aui-button");o.find(".user-popup-more > span > span").addClass("aui-icon aui-icon-small aui-iconfont-more").text("")}var q=d(".userLogoLink",m).attr("data-username");var j=c+encodeURIComponent(q);d.getJSON(j,e(k)).fail(function(t){if(t.status===404){try{var r=JSON.parse(t.responseText);if(r.userId){AJS.trigger("analyticsEvent",{name:"hipchat.presence.user.unknown",data:{userId:r.userId}})}}catch(s){}}})})}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:help-dialog-extension', location = '/jira/help-dialog.js' */
Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.Editor.push({context:"editor.actions",descKey:"Insert Jira Issue/Filter"+":",keys:[["Ctrl+Shift+J"]]});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:initialise-metrics-collection', location = '/js/initialise-metrics.js' */
define("collaborative-editing-initialise-metrics-collection",["confluence/legacy"],function(a){return function(){var b={"confluence.editor":!0,"confluence.editor.preload":!0,"confluence.editor.quick.fetchContent":!0,"confluence.editor.tinymce":!0,"confluence.editor.synchrony":!0,"confluence.editor.synchrony.CR":!0,"confluence.editor.synchrony.connect":!0,"confluence.editor.synchrony.deps":!0,"confluence.editor.synchrony.init":!0,"confluence.editor.synchrony.jsLoad":!0,"confluence.editor.synchrony.snapshot":!0,
"confluence.editor.synchrony.unmarshal":!0},c={"confluence.editor.synchrony.connect":!0};a.registerPerformanceSession&&a.registerPerformanceSession("confluence.editor.quickedit.loading.times",b,c)}});require("confluence/module-exporter").safeRequire("collaborative-editing-initialise-metrics-collection",function(a){a()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:blueprint-first-time-tooltip-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/first-time-tooptip.js' */
AJS.bind("sidebar.finished-loading",function(){var a=AJS.Meta.get("blueprint-index-popup-key");AJS.debug("Index key for "+a);a&&Confluence.Blueprint.showIndexPagePopup(a)});
Confluence.Blueprint=AJS.$.extend(Confluence.Blueprint,{showIndexPagePopup:function(a){var b=AJS.$(AJS.$("li.blueprint."+a)[0]);a=b.text();b=AJS.$(".icon",b);var c=AJS.InlineDialog(b.is(":visible")?b:AJS.$(".acs-nav-sections .quick-links-section"),"blueprintIndexSidebarPopup",function(a){return function(b,c,d){b.html(Confluence.Templates.Blueprints.sidebarIndexPagePopup({indexPageTitle:a.toLowerCase()}));d()}}(a),{addActiveClass:!1,hideDelay:null,noBind:!0});AJS.$(document).bind("showLayer",function(a){AJS.$("body").unbind("click.blueprintIndexSidebarPopup.inline-dialog-check")});
c.show();(function(a){AJS.$(document).on("click","#dismiss-index-popup",function(){a.hide();return!1})})(c);AJS.bind("quickedit.success",function(){c.hide()})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:blueprint-first-time-tooltip-resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/sidebar-index-page-popup.soy' */
// This file was automatically generated from sidebar-index-page-popup.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Blueprints.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }


Confluence.Templates.Blueprints.sidebarIndexPagePopup = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml(AJS.format('Find your {0} here',opt_data.indexPageTitle)) + '</h2><p>' + soy.$$escapeHtml(AJS.format('You\x27\x27ve created a {0} page. A shortcut in your sidebar has been added where you can find other {0} in this space.',opt_data.indexPageTitle)) + '</p><br/><form>' + aui.buttons.button({text: 'Dismiss', id: 'dismiss-index-popup'}) + '</form>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.sidebarIndexPagePopup.soyTemplateName = 'Confluence.Templates.Blueprints.sidebarIndexPagePopup';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-from-template-macro.js' */
AJS.toInit(function(b){b(document).tooltip({live:'.create-from-template-button[aria-disabled\x3d"true"]',gravity:"n",title:"data-tooltip",delayIn:250,delayOut:0});b(".create-from-template-button").each(function(){var a=b(this);"true"!==a.attr("aria-disabled")&&a.click(function(){a.addClass("launching-dialog");Confluence.Blueprint.loadDialogAndOpenTemplate(a.data());return!1})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/create-from-template-macro.soy' */
// This file was automatically generated from create-from-template-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Blueprints.CreateFromTemplate.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }
if (typeof Confluence.Templates.Blueprints.CreateFromTemplate == 'undefined') { Confluence.Templates.Blueprints.CreateFromTemplate = {}; }


Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate = function(opt_data, opt_ignored) {
  return '<a class=\'aui-button create-from-template-button\'' + ((! opt_data.hasCreatePermission) ? 'aria-disabled=\'true\' data-tooltip="' + soy.$$escapeHtml('Sorry, you don\x27t have permission to create content. Contact your space administrator to request access.') + '"' : '') + 'data-space-key=\'' + soy.$$escapeHtml(opt_data.spaceKey) + '\' href=\'' + soy.$$escapeHtml(opt_data.createContentUrl) + '\'' + ((opt_data.title) ? 'data-title=\'' + soy.$$escapeHtml(opt_data.title) + '\'' : '') + ((opt_data.templateId) ? 'data-template-id=\'' + soy.$$escapeHtml(opt_data.templateId) + '\'' : '') + ((opt_data.contentBlueprintId) ? 'data-content-blueprint-id=\'' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '\'' : '') + '>' + soy.$$escapeHtml(opt_data.buttonLabel) + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate.soyTemplateName = 'Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.contributors:contributors-web-resources', location = 'com/atlassian/confluence/contributors/scripts/contributors.js' */
require(["ajs","underscore"],function(c,f){c.toInit(function(b){b("div.contributors-macro-ajax-container").each(function(){var a=b(this),d=b.parseJSON(f.unescape(a.find(".contributors-macro-parameters")[0].innerHTML));a.text("Generating contributors information...");b.ajax({dataType:"json",url:Confluence.getContextPath()+"/rest/com.atlassian.confluence.contributors/1.0/contributors",data:d,success:function(e){e.errorMessage?a.text(e.errorMessage):(a.html(Confluence.ContributorsMacro.renderContent(e)),
a.find(".show-hidden-contributors").click(function(){a.find(".hidden-contributor").removeClass("hidden");b(this).parent().remove();return!1}))},error:function(b,f,d){a.text("Failed to retrieve contributors information"+": "+d)}})})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.contributors:contributors-web-resources', location = 'com/atlassian/confluence/contributors/templates/contributors-macro.soy' */
// This file was automatically generated from contributors-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.ContributorsMacro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.ContributorsMacro == 'undefined') { Confluence.ContributorsMacro = {}; }


Confluence.ContributorsMacro.ajaxContainer = function(opt_data, opt_ignored) {
  return '<div class="contributors-macro-ajax-container"><div style="display; none;" class="contributors-macro-parameters">' + soy.$$escapeHtml(opt_data.macroParameters) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.ajaxContainer.soyTemplateName = 'Confluence.ContributorsMacro.ajaxContainer';
}


Confluence.ContributorsMacro.renderContent = function(opt_data, opt_ignored) {
  return '<div class="plugin-contributors">' + ((opt_data.layoutStyle == 'FLAT') ? Confluence.ContributorsMacro.flatLayout(opt_data) : (opt_data.layoutStyle == 'LIST') ? Confluence.ContributorsMacro.listLayout(opt_data) : '<span>Unknown layout style</span>') + '</div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.renderContent.soyTemplateName = 'Confluence.ContributorsMacro.renderContent';
}


Confluence.ContributorsMacro.flatLayout = function(opt_data, opt_ignored) {
  return '<div class="plugin-contributors"><span><span>' + Confluence.ContributorsMacro.flatContributorsList({contributors: opt_data.visibleContributors, showCount: opt_data.showCount, showTime: opt_data.showTime}) + ((opt_data.hiddenContributors.length > 0) ? ',' : '') + '</span>' + ((opt_data.hiddenContributors.length > 0) ? '<span class="hidden hidden-contributor">' + Confluence.ContributorsMacro.flatContributorsList({contributors: opt_data.hiddenContributors, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</span><span><a href="#" class="show-hidden-contributors" title="' + soy.$$escapeHtml(AJS.format('{0} more...',opt_data.hiddenContributors.length)) + '">...</a></span>' : '') + '</span></div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.flatLayout.soyTemplateName = 'Confluence.ContributorsMacro.flatLayout';
}


Confluence.ContributorsMacro.listLayout = function(opt_data, opt_ignored) {
  var output = '<div class="plugin-contributors"><ul class="contributors-list">';
  var contributorList39 = opt_data.visibleContributors;
  var contributorListLen39 = contributorList39.length;
  for (var contributorIndex39 = 0; contributorIndex39 < contributorListLen39; contributorIndex39++) {
    var contributorData39 = contributorList39[contributorIndex39];
    output += '<li>' + Confluence.ContributorsMacro.contributor({contributor: contributorData39, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</li>';
  }
  if (opt_data.hiddenContributors.length > 0) {
    output += '<li><a href="#" class="show-hidden-contributors" title="' + soy.$$escapeHtml(AJS.format('{0} more...',opt_data.hiddenContributors.length)) + '">...</a></li>';
    var contributorList52 = opt_data.hiddenContributors;
    var contributorListLen52 = contributorList52.length;
    for (var contributorIndex52 = 0; contributorIndex52 < contributorListLen52; contributorIndex52++) {
      var contributorData52 = contributorList52[contributorIndex52];
      output += '<li class="hidden hidden-contributor">' + Confluence.ContributorsMacro.contributor({contributor: contributorData52, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</li>';
    }
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.listLayout.soyTemplateName = 'Confluence.ContributorsMacro.listLayout';
}


Confluence.ContributorsMacro.flatContributorsList = function(opt_data, opt_ignored) {
  var output = '';
  var contributorList62 = opt_data.contributors;
  var contributorListLen62 = contributorList62.length;
  for (var contributorIndex62 = 0; contributorIndex62 < contributorListLen62; contributorIndex62++) {
    var contributorData62 = contributorList62[contributorIndex62];
    output += ((! (contributorIndex62 == 0)) ? ',' : '') + Confluence.ContributorsMacro.contributor({contributor: contributorData62, showCount: opt_data.showCount, showTime: opt_data.showTime});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.flatContributorsList.soyTemplateName = 'Confluence.ContributorsMacro.flatContributorsList';
}


Confluence.ContributorsMacro.contributor = function(opt_data, opt_ignored) {
  return Confluence.Templates.User.usernameLink({username: opt_data.contributor.idString, fullName: opt_data.contributor.fullNameString, canView: false}) + ' ' + ((opt_data.showCount) ? soy.$$escapeHtml(opt_data.contributor.totalCount) : '') + ' ' + ((opt_data.showTime) ? '(' + soy.$$escapeHtml(opt_data.contributor.relativeLastActiveTimeStr) + ')' : '');
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.contributor.soyTemplateName = 'Confluence.ContributorsMacro.contributor';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = 'templates/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace JIRA.Template.Util.Issue.Status.
 */

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Template == 'undefined') { JIRA.Template = {}; }
if (typeof JIRA.Template.Util == 'undefined') { JIRA.Template.Util = {}; }
if (typeof JIRA.Template.Util.Issue == 'undefined') { JIRA.Template.Util.Issue = {}; }
if (typeof JIRA.Template.Util.Issue.Status == 'undefined') { JIRA.Template.Util.Issue.Status = {}; }


JIRA.Template.Util.Issue.Status.issueStatusResolver = function(opt_data, opt_ignored) {
  return '' + ((! opt_data.issueStatus) ? '<span class="aui-icon aui-icon-small aui-iconfont-help jira-issue-status-render-error" title="' + soy.$$escapeHtml('No issue status information was provided') + '"></span>' : (opt_data.issueStatus.statusCategory) ? JIRA.Template.Util.Issue.Status.issueStatus(opt_data) : JIRA.Template.Util.Issue.Status.iconStatus({name: opt_data.issueStatus.name, iconUrl: opt_data.issueStatus.iconUrl, description: opt_data.issueStatus.description, isCompact: opt_data.isCompact}));
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.issueStatusResolver.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatusResolver';
}


JIRA.Template.Util.Issue.Status.iconStatus = function(opt_data, opt_ignored) {
  return '<img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" width="16" height="16" alt="' + soy.$$escapeHtml(opt_data.name) + '" title="' + soy.$$escapeHtml(opt_data.name) + ((opt_data.description) ? ' - ' + soy.$$escapeHtml(opt_data.description) : '') + '" class="jira-issue-status-icon">' + ((! opt_data.isCompact) ? ' ' + soy.$$escapeHtml(opt_data.name) : '');
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.iconStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.iconStatus';
}


JIRA.Template.Util.Issue.Status.issueStatus = function(opt_data, opt_ignored) {
  return '' + JIRA.Template.Util.Issue.Status.statusLozenge({name: opt_data.issueStatus.name, categoryKey: opt_data.issueStatus.statusCategory.key, colorName: opt_data.issueStatus.statusCategory.colorName, description: opt_data.issueStatus.description, isSubtle: opt_data.isSubtle, isCompact: opt_data.isCompact, maxWidth: opt_data.maxWidth});
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.issueStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatus';
}


JIRA.Template.Util.Issue.Status.statusLozenge = function(opt_data, opt_ignored) {
  var output = '';
  var maxWidth__soy46 = opt_data.maxWidth ? opt_data.maxWidth : 'medium';
  var tooltipContent__soy47 = '<span class="jira-issue-status-tooltip-title">' + soy.$$escapeHtml(opt_data.name) + '</span>' + ((opt_data.description) ? '<br><span class="jira-issue-status-tooltip-desc">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '');
  output += '<span class=" jira-issue-status-lozenge aui-lozenge ' + JIRA.Template.Util.Issue.Status.statusLozengeClasses(opt_data) + ((opt_data.isSubtle && ! opt_data.isCompact) ? ' aui-lozenge-subtle' : '') + ((opt_data.isCompact) ? ' jira-issue-status-lozenge-compact' : '') + ' jira-issue-status-lozenge-max-width-' + soy.$$escapeHtml(maxWidth__soy46) + '" data-tooltip="' + soy.$$escapeHtml(tooltipContent__soy47) + '">' + soy.$$escapeHtml(opt_data.name) + '</span>';
  return output;
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.statusLozenge.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozenge';
}


JIRA.Template.Util.Issue.Status.statusLozengeClasses = function(opt_data, opt_ignored) {
  return 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.colorName ? opt_data.colorName : 'medium-gray') + ' ' + ((opt_data.categoryKey) ? 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.categoryKey) : '');
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.statusLozengeClasses.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozengeClasses';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = '/js/issue-status-plugin.js' */
AJS.$(function(){if(AJS.$.fn.tooltip){AJS.$(".jira-issue-status-lozenge[data-tooltip]").tooltip({aria:true,gravity:AJS.$.fn.tipsy.autoWE,delayIn:100,html:true,live:true,title:"data-tooltip",className:"jira-issue-status-tooltip"})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = 'soy/jira-metadata.soy' */
// This file was automatically generated from jira-metadata.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Metadata.Jira.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Metadata == 'undefined') { Confluence.Templates.Metadata = {}; }
if (typeof Confluence.Templates.Metadata.Jira == 'undefined') { Confluence.Templates.Metadata.Jira = {}; }


Confluence.Templates.Metadata.Jira.metadata = function(opt_data, opt_ignored) {
  var output = '<div id="jira-metadata-dialog" class="rendered-content"><h2 class="title">' + soy.$$escapeHtml('Jira links') + '</h2><div class="items-section">';
  var groupList6 = opt_data.groups;
  var groupListLen6 = groupList6.length;
  for (var groupIndex6 = 0; groupIndex6 < groupListLen6; groupIndex6++) {
    var groupData6 = groupList6[groupIndex6];
    if (groupData6.items.length) {
      switch (groupData6.type) {
        case 'ISSUES':
          output += Confluence.Templates.Metadata.Jira.renderGroup({items: groupData6.items, headingText: 'Issues', type: groupData6.type, links: groupData6.links});
          break;
        case 'SPRINTS':
          output += Confluence.Templates.Metadata.Jira.renderGroup({items: groupData6.items, headingText: 'Sprints', type: groupData6.type, links: groupData6.links});
          break;
        case 'VERSIONS':
          output += Confluence.Templates.Metadata.Jira.renderGroup({items: groupData6.items, headingText: 'Versions', type: groupData6.type, links: groupData6.links});
          break;
        case 'EPICS':
          output += Confluence.Templates.Metadata.Jira.renderGroup({items: groupData6.items, headingText: 'Epics', type: groupData6.type, links: groupData6.links});
          break;
      }
    }
  }
  output += '</div>' + Confluence.Templates.Metadata.Jira.renderAuthPrompts({appLinks: opt_data.unauthorisedAppLinks}) + Confluence.Templates.Metadata.Jira.renderJiraErrors(opt_data) + '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.metadata.soyTemplateName = 'Confluence.Templates.Metadata.Jira.metadata';
}


Confluence.Templates.Metadata.Jira.featureDiscovery = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-feature-discovery"><h2>' + soy.$$escapeHtml('View related Jira items here') + '</h2><p>' + soy.$$escapeHtml('Now you can see which epics, sprints, versions and issues relate to this page.') + '</p><div class="aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner">' + aui.buttons.button({text: 'Show me', extraClasses: 'showme'}) + aui.buttons.button({text: 'Don\x27t show again', type: 'link', extraClasses: 'close'}) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.featureDiscovery.soyTemplateName = 'Confluence.Templates.Metadata.Jira.featureDiscovery';
}


Confluence.Templates.Metadata.Jira.nometadata = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog" class="rendered-content">' + aui.message.warning({content: '<p>' + soy.$$escapeHtml('Jira links cannot be displayed. Either you do not have correct Jira permissions or the links have been removed.') + '</p>'}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.nometadata.soyTemplateName = 'Confluence.Templates.Metadata.Jira.nometadata';
}


Confluence.Templates.Metadata.Jira.renderAuthPrompts = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.appLinks.length) {
    var param66 = '';
    if (opt_data.appLinks.length == 1) {
      var appLink__soy69 = opt_data.appLinks[0];
      param66 += '<p>' + soy.$$filterNoAutoescape(AJS.format('{0}Login \x26amp; Approve{1} to retrieve data from {2}','<a class="jira-metadata-auth-link" href="#" data-href="' + appLink__soy69.authorisationUrl + '">','</a>',appLink__soy69.htmlSafeName)) + '</p>';
    } else {
      param66 += '<p>' + soy.$$escapeHtml('Authenticate to retrieve data from the following instances:') + '</p>';
      var appLinkList78 = opt_data.appLinks;
      var appLinkListLen78 = appLinkList78.length;
      for (var appLinkIndex78 = 0; appLinkIndex78 < appLinkListLen78; appLinkIndex78++) {
        var appLinkData78 = appLinkList78[appLinkIndex78];
        param66 += '<div><a class="jira-metadata-auth-link" href="#" data-href="' + soy.$$escapeHtml(appLinkData78.authorisationUrl) + '">' + soy.$$escapeHtml(appLinkData78.name) + '</a></div>';
      }
    }
    output += aui.message.hint({content: param66});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.renderAuthPrompts.soyTemplateName = 'Confluence.Templates.Metadata.Jira.renderAuthPrompts';
}


Confluence.Templates.Metadata.Jira.renderGroup = function(opt_data, opt_ignored) {
  var output = '<div class="jira-metadata-section ' + soy.$$escapeHtml(opt_data.type) + '-section"><div class="section-label"><span class="icon"></span><span>' + soy.$$escapeHtml(opt_data.headingText) + '</span></div><ul class="jira-metadata-list jira-' + soy.$$escapeHtml(opt_data.type) + '-list">';
  var itemList94 = opt_data.items;
  var itemListLen94 = itemList94.length;
  for (var itemIndex94 = 0; itemIndex94 < itemListLen94; itemIndex94++) {
    var itemData94 = itemList94[itemIndex94];
    output += '<li class="jira-metadata-item"><span class="item-label"><a href="' + soy.$$escapeHtml("") + '/plugins/servlet/jira-metadata/redirect?u=' + soy.$$escapeUri(itemData94.url) + '&t=' + soy.$$escapeHtml(opt_data.type) + '" title="' + soy.$$escapeHtml(itemData94.name) + '">' + soy.$$escapeHtml(itemData94.name) + '</a>' + ((itemData94.status) ? '&nbsp;' + ((itemData94.status.statusCategory) ? JIRA.Template.Util.Issue.Status.issueStatusResolver({issueStatus: itemData94.status, isSubtle: true}) : '<span class="item-status">(' + soy.$$escapeHtml(itemData94.status.name) + ')</span>') : '') + '</span>' + ((itemData94.description != '') ? '<span class="item-subtext">' + soy.$$escapeHtml(itemData94.description) + '</span>' : '') + '</li>';
  }
  output += '</ul><ul class="jira-metadata-list ' + soy.$$escapeHtml(opt_data.type) + '-more-link">';
  var linkList130 = opt_data.links;
  var linkListLen130 = linkList130.length;
  for (var linkIndex130 = 0; linkIndex130 < linkListLen130; linkIndex130++) {
    var linkData130 = linkList130[linkIndex130];
    output += '<li class="jira-metadata-item"><a href="' + soy.$$escapeHtml("") + '/plugins/servlet/jira-metadata/redirect?u=' + soy.$$escapeUri(linkData130.url) + '&t=' + soy.$$escapeHtml(opt_data.type) + '&more">' + soy.$$escapeHtml(AJS.format('View {0} more in {1}',linkData130.numItems,linkData130.appName)) + '</a></li>';
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.renderGroup.soyTemplateName = 'Confluence.Templates.Metadata.Jira.renderGroup';
}


Confluence.Templates.Metadata.Jira.loadingMetadata = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog"><h2 class="title">' + soy.$$escapeHtml('Jira links') + '</h2><div class="spinner-container"><div class="spinner"></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.loadingMetadata.soyTemplateName = 'Confluence.Templates.Metadata.Jira.loadingMetadata';
}


Confluence.Templates.Metadata.Jira.renderJiraErrors = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.errors.length == 1) {
    var error__soy150 = opt_data.errors[0];
    output += aui.message.warning({content: '<p>' + soy.$$escapeHtml('Unable to retrieve Jira metadata.') + ' ' + soy.$$escapeHtml(error__soy150.errorMessage) + '</p>'});
  } else if (opt_data.errors.length > 1) {
    var param159 = '<p>' + soy.$$escapeHtml('Unable to retrieve Jira metadata. The following errors occurred:') + '</p><ul>';
    var errorList163 = opt_data.errors;
    var errorListLen163 = errorList163.length;
    for (var errorIndex163 = 0; errorIndex163 < errorListLen163; errorIndex163++) {
      var errorData163 = errorList163[errorIndex163];
      param159 += '<li>' + soy.$$escapeHtml(errorData163.errorMessage) + '</li>';
    }
    param159 += '</ul>';
    output += aui.message.warning({content: param159});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.renderJiraErrors.soyTemplateName = 'Confluence.Templates.Metadata.Jira.renderJiraErrors';
}


Confluence.Templates.Metadata.Jira.unknownError = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog" class="rendered-content">' + aui.message.warning({content: '<p>' + soy.$$escapeHtml('Unable to retrieve Jira metadata. Could not connect to Confluence') + '</p>'}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.Jira.unknownError.soyTemplateName = 'Confluence.Templates.Metadata.Jira.unknownError';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = '/js/jira-metadata.js' */
AJS.toInit(function(c){function h(a,n){k(a,n);d.removeClass("hidden");d.attr("href")||(f=AJS.InlineDialog(d,"jira-metadata-dialog",function(a,c,d){AJS.trigger("analytics",{name:"confluence.jira.metadata.expanded"});b&&l?d():(b=a,d(),m(a));return!1},{hideDelay:null}),d.click(function(){c("#jira-metadata-dialog").is(":visible")&&f.hide()}));d&&!AJS.Meta.get("blueprint-index-popup-key")&&Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").shouldShow("linked-issues-dropdown")&&
(p(),d.one("click",function(){Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").markDiscovered("linked-issues-dropdown")}))}function k(a,b){b||(b=c("\x3cspan/\x3e").addClass("aui-icon aui-icon-small aui-iconfont-jira"),c("#content-metadata-jira").text(1==a?"1 Jira link":AJS.format("{0} Jira links",a)).prepend(b))}function p(){e=AJS.InlineDialog(d,"jira-metadata-discovery",function(a,b,c){a.html(Confluence.Templates.Metadata.Jira.featureDiscovery());
a.find(".showme").on("click",function(){Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").markDiscovered("linked-issues-dropdown");e.hide();f.show()});a.find(".close").on("click",function(){Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").markDiscovered("linked-issues-dropdown");e.hide()});c()},{noBind:!0,closeOthers:!1,hideDelay:null});e.show();Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").addDiscoveryView("linked-issues-dropdown")}
function m(){b&&0<b.height()&&b.css("height",b.height());b.html(Confluence.Templates.Metadata.Jira.loadingMetadata());b.find(".spinner").spin("medium");c.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata?pageId\x3d"+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",error:function(a){b&&b.css("height","");b.html(Confluence.Templates.Metadata.Jira.unknownError())},success:function(a){b&&b.css("height","");l=!0;k(a.count,!1);0!==a.count||a.unauthorisedAppLinks&&
0<a.unauthorisedAppLinks.length||0!=a.errors.length?a=Confluence.Templates.Metadata.Jira.metadata(a):(AJS.trigger("analytics",{name:"confluence.jira.metadata.error.no-metadata"}),a=Confluence.Templates.Metadata.Jira.nometadata());b.html(a);setTimeout(function(){b.find("#jira-metadata-dialog").addClass("show")},0);q()},complete:function(){c("#jira-metadata-dialog .icon-close").click(function(a){a.stopPropagation();c(this).closest(".closable").remove()})}})}function q(){c(".jira-metadata-auth-link").click(function(a){a.preventDefault();
AppLinks.authenticateRemoteCredentials(c(this).data("href"),m,function(){})})}var l=!1,f,b,d=c("#content-metadata-jira"),e,g=AJS.Meta.get("jira-metadata-count");0<g?h(g,AJS.Meta.get("jira-metadata-count-incomplete")):-1==g&&c.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata/aggregate?pageId\x3d"+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",cache:!1,success:function(a){0<a.count&&h(a.count,a.incomplete)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.form.select2', location = 'aui.chunk.e98f266c80e6a85c8888--b3a3f524b48e82c57a62.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.form.select2"],{"02/N":function(e,t){var s;void 0===(s=jQuery).fn.each2&&s.extend(s.fn,{each2:function(e){for(var t=s([0]),i=-1,n=this.length;++i<n&&(t.context=t[0]=this[i])&&!1!==e.call(t[0],i,t););return this}}),function(e,t){"use strict";if(window.Select2===t){var s,i,n,o,a,c,l,r,h={x:0,y:0},u={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case u.LEFT:case u.RIGHT:case u.UP:case u.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case u.SHIFT:case u.CTRL:case u.ALT:return!0}return!!e.metaKey},isFunctionKey:function(e){return(e=e.which?e.which:e)>=112&&e<=123}},d={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z"};c=e(document),r=1,o=function(){return r++},c.on("mousemove",(function(e){h.x=e.pageX,h.y=e.pageY})),s=I(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(s){var i,n,a,c,r,u=".select2-results";this.opts=s=this.prepareOpts(s),this.id=s.id,s.element.data("select2")!==t&&null!==s.element.data("select2")&&s.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(s.element.attr("id")||"autogen"+o()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=(a=function(){return s.element.closest("body")},r=!1,function(){return!1===r&&(c=a(),r=!0),c}),S(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",s.element.attr("style")),this.container.css(P(s.containerCss)),this.container.addClass(P(s.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",b),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),S(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(P(s.dropdownCssClass)),this.dropdown.data("select2",this),this.dropdown.on("click",b),this.results=i=this.container.find(u),this.search=n=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",b),this.results.on("mousemove",(function(s){var i=h;i!==t&&i.x===s.pageX&&i.y===s.pageY||e(s.target).trigger("mousemove-filtered",s)})),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",u,this.bind(this.highlightUnderEvent)),function(e,t){var s=C(e,(function(e){t.trigger("scroll-debounced",e)}));t.on("scroll",(function(e){f(e.target,t.get())>=0&&s(e)}))}(80,this.results),this.dropdown.on("scroll-debounced",u,this.bind(this.loadMoreIfNeeded)),e(this.container).on("change",".select2-input",(function(e){e.stopPropagation()})),e(this.dropdown).on("change",".select2-input",(function(e){e.stopPropagation()})),e.fn.mousewheel&&i.mousewheel((function(e,t,s,n){var o=i.scrollTop();n>0&&o-n<=0?(i.scrollTop(0),b(e)):n<0&&i.get(0).scrollHeight-i.scrollTop()+n<=i.height()&&(i.scrollTop(i.get(0).scrollHeight-i.height()),b(e))})),w(n),n.on("keyup-change input paste",this.bind(this.updateResults)),n.on("focus",(function(){n.addClass("select2-focused")})),n.on("blur",(function(){n.removeClass("select2-focused")})),this.dropdown.on("mouseup",u,this.bind((function(t){e(t.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(t),this.selectHighlighted(t))}))),this.dropdown.on("click mouseup mousedown",(function(e){e.stopPropagation()})),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==s.maximumInputLength&&this.search.attr("maxlength",s.maximumInputLength);var d=s.element.prop("disabled");d===t&&(d=!1),this.enable(!d);var p=s.element.prop("readonly");p===t&&(p=!1),this.readonly(p),l=l||function(){var t=e("<div class='select2-measure-scrollbar'></div>");t.appendTo("body");var s={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),s}(),this.autofocus=s.element.prop("autofocus"),s.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.nextSearchTerm=t},destroy:function(){var e=this.opts.element,s=e.data("select2");this.close(),this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),s!==t&&(s.container.remove(),s.dropdown.remove(),e.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:g(e.attr("locked"),"locked")||g(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(s){var i,n,o,a,c=this;if("select"===(i=s.element).get(0).tagName.toLowerCase()&&(this.select=n=s.element),n&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],(function(){if(this in s)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")})),"function"!=typeof(s=e.extend({},{populateResults:function(i,n,o){var a,l=this.opts.id;(a=function(i,n,r){var h,u,d,p,f,g,m,v,w,C;for(h=0,u=(i=s.sortResults(i,n,o)).length;h<u;h+=1)p=!(f=!0===(d=i[h]).disabled)&&l(d)!==t,g=d.children&&d.children.length>0,(m=e("<li></li>")).addClass("select2-results-dept-"+r),m.addClass("select2-result"),m.addClass(p?"select2-result-selectable":"select2-result-unselectable"),f&&m.addClass("select2-disabled"),g&&m.addClass("select2-result-with-children"),m.addClass(c.opts.formatResultCssClass(d)),(v=e(document.createElement("div"))).addClass("select2-result-label"),(C=s.formatResult(d,v,o,c.opts.escapeMarkup))!==t&&v.html(C),m.append(v),g&&((w=e("<ul></ul>")).addClass("select2-result-sub"),a(d.children,w,r+1),m.append(w)),m.data("select2-data",d),n.append(m)})(n,i,0)}},e.fn.select2.defaults,s)).id&&(o=s.id,s.id=function(e){return e[o]}),e.isArray(s.element.data("select2Tags"))){if("tags"in s)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+s.element.attr("id");s.tags=s.element.data("select2Tags")}if(n?(s.query=this.bind((function(e){var s,n,o,a={results:[],more:!1},l=e.term;o=function(t,s){var i;t.is("option")?e.matcher(l,t.text(),t)&&s.push(c.optionToData(t)):t.is("optgroup")&&(i=c.optionToData(t),t.children().each2((function(e,t){o(t,i.children)})),i.children.length>0&&s.push(i))},s=i.children(),this.getPlaceholder()!==t&&s.length>0&&(n=this.getPlaceholderOption())&&(s=s.not(n)),s.each2((function(e,t){o(t,a.results)})),e.callback(a)})),s.id=function(e){return e.id},s.formatResultCssClass=function(e){return e.css}):"query"in s||("ajax"in s?((a=s.element.data("ajax-url"))&&a.length>0&&(s.ajax.url=a),s.query=x.call(s.element,s.ajax)):"data"in s?s.query=T(s.data):"tags"in s&&(s.query=O(s.tags),s.createSearchChoice===t&&(s.createSearchChoice=function(t){return{id:e.trim(t),text:e.trim(t)}}),s.initSelection===t&&(s.initSelection=function(t,i){var n=[];e(m(t.val(),s.separator)).each((function(){var t={id:this,text:this},i=s.tags;e.isFunction(i)&&(i=i()),e(i).each((function(){if(g(this.id,t.id))return t=this,!1})),n.push(t)})),i(n)}))),"function"!=typeof s.query)throw"query function not defined for Select2 "+s.element.attr("id");return s},monitorSource:function(){var e,s,i=this.opts.element;i.on("change.select2",this.bind((function(e){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()}))),e=this.bind((function(){var e=i.prop("disabled");e===t&&(e=!1),this.enable(!e);var s=i.prop("readonly");s===t&&(s=!1),this.readonly(s),S(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(P(this.opts.containerCssClass)),S(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(P(this.opts.dropdownCssClass))})),i.on("propertychange.select2",e),this.mutationCallback===t&&(this.mutationCallback=function(t){t.forEach(e)}),(s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)!==t&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new s(this.mutationCallback),this.propertyObserver.observe(i.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(t){var s=e.Event("select2-selecting",{val:this.id(t),object:t});return this.opts.element.trigger(s),!s.isDefaultPrevented()},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e!==this.enabledInterface&&(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){e===t&&(e=!0),this._enabled!==e&&(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(e){return e===t&&(e=!1),this._readonly!==e&&(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,s,i,n,o,a=this.dropdown,c=this.container.offset(),r=this.container.outerHeight(!1),h=this.container.outerWidth(!1),u=a.outerHeight(!1),d=e(window),p=d.width(),f=d.height(),g=d.scrollLeft()+p,m=d.scrollTop()+f,v=c.top+r,w=c.left,C=v+u<=m,b=c.top-u>=this.body().scrollTop(),S=a.outerWidth(!1),y=w+S<=g;a.hasClass("select2-drop-above")?(s=!0,!b&&C&&(i=!0,s=!1)):(s=!1,!C&&b&&(i=!0,s=!0)),i&&(a.hide(),c=this.container.offset(),r=this.container.outerHeight(!1),h=this.container.outerWidth(!1),u=a.outerHeight(!1),g=d.scrollLeft()+p,m=d.scrollTop()+f,v=c.top+r,y=(w=c.left)+(S=a.outerWidth(!1))<=g,a.show()),this.opts.dropdownAutoWidth?(o=e(".select2-results",a)[0],a.addClass("select2-drop-auto-width"),a.css("width",""),(S=a.outerWidth(!1)+(o.scrollHeight===o.clientHeight?0:l.width))>h?h=S:S=h,y=w+S<=g):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(v-=(t=this.body().offset()).top,w-=t.left),y||(w=c.left+h-S),n={left:w,width:h},s?(n.bottom=f-c.top,n.top="auto",this.container.addClass("select2-drop-above"),a.addClass("select2-drop-above")):(n.top=v,n.bottom="auto",this.container.removeClass("select2-drop-above"),a.removeClass("select2-drop-above")),n=e.extend(n,P(this.opts.dropdownCss)),a.css(n)},shouldOpen:function(){var t;return!this.opened()&&(!1!==this._enabled&&!0!==this._readonly&&(t=e.Event("select2-opening"),this.opts.element.trigger(t),!t.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),!0)},opening:function(){var t,s=this.containerId,i="scroll."+s,n="resize."+s,o="orientationchange."+s;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),0==(t=e("#select2-drop-mask")).length&&((t=e(document.createElement("div"))).attr("id","select2-drop-mask").attr("class","select2-drop-mask"),t.hide(),t.appendTo(this.body()),t.on("mousedown touchstart click",(function(t){var s,i=e("#select2-drop");i.length>0&&((s=i.data("select2")).opts.selectOnBlur&&s.selectHighlighted({noFocus:!0}),s.close({focus:!0}),t.preventDefault(),t.stopPropagation())}))),this.dropdown.prev()[0]!==t[0]&&this.dropdown.before(t),e("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),t.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var a=this;this.container.parents().add(window).each((function(){e(this).on(n+" "+i+" "+o,(function(e){a.positionDropdown()}))}))},close:function(){if(this.opened()){var t=this.containerId,s="scroll."+t,i="resize."+t,n="orientationchange."+t;this.container.parents().add(window).each((function(){e(this).off(s).off(i).off(n)})),this.clearDropdownAlignmentPreference(),e("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return P(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var t,s,i,n,o,a,c,l=this.results;(s=this.highlight())<0||(0!=s?(t=this.findHighlightableChoices().find(".select2-result-label"),n=(i=e(t[s])).offset().top+i.outerHeight(!0),s===t.length-1&&(c=l.find("li.select2-more-results")).length>0&&(n=c.offset().top+c.outerHeight(!0)),n>(o=l.offset().top+l.outerHeight(!0))&&l.scrollTop(l.scrollTop()+(n-o)),(a=i.offset().top-l.offset().top)<0&&"none"!=i.css("display")&&l.scrollTop(l.scrollTop()+a)):l.scrollTop(0))},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")},moveHighlight:function(t){for(var s=this.findHighlightableChoices(),i=this.highlight();i>-1&&i<s.length;){var n=e(s[i+=t]);if(n.hasClass("select2-result-selectable")&&!n.hasClass("select2-disabled")&&!n.hasClass("select2-selected")){this.highlight(i);break}}},highlight:function(t){var s,i,n=this.findHighlightableChoices();if(0===arguments.length)return f(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1),t<0&&(t=0),this.removeHighlight(),(s=e(n[t])).addClass("select2-highlighted"),this.ensureHighlightVisible(),(i=s.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(i),choice:i})},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(t){var s=e(t.target).closest(".select2-result-selectable");if(s.length>0&&!s.is(".select2-highlighted")){var i=this.findHighlightableChoices();this.highlight(i.index(s))}else 0==s.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),s=this.resultsPage+1,i=this,n=this.search.val(),o=this.context;0!==t.length&&t.offset().top-e.offset().top-e.height()<=this.opts.loadMorePadding&&(t.addClass("select2-active"),this.opts.query({element:this.opts.element,term:n,page:s,context:o,matcher:this.opts.matcher,callback:this.bind((function(a){i.opened()&&(i.opts.populateResults.call(this,e,a.results,{term:n,page:s,context:o}),i.postprocessResults(a,!1,!1),!0===a.more?(t.detach().appendTo(e).text(i.opts.formatLoadMore(s+1)),window.setTimeout((function(){i.loadMoreIfNeeded()}),10)):t.remove(),i.positionDropdown(),i.resultsPage=s,i.context=a.context,this.opts.element.trigger({type:"select2-loaded",items:a}))}))}))},tokenize:function(){},updateResults:function(s){var i,n,o,a=this.search,c=this.results,l=this.opts,r=this,h=a.val(),u=e.data(this.container,"select2-last-term");if((!0===s||!u||!g(h,u))&&(e.data(this.container,"select2-last-term",h),!0===s||!1!==this.showSearchInput&&this.opened())){o=++this.queryCount;var d=this.getMaximumSelectionSize();if(!(d>=1&&(i=this.data(),e.isArray(i)&&i.length>=d&&k(l.formatSelectionTooBig,"formatSelectionTooBig"))))return a.val().length<l.minimumInputLength?(k(l.formatInputTooShort,"formatInputTooShort")?f("<li class='select2-no-results'>"+l.formatInputTooShort(a.val(),l.minimumInputLength)+"</li>"):f(""),void(s&&this.showSearch&&this.showSearch(!0))):void(l.maximumInputLength&&a.val().length>l.maximumInputLength?k(l.formatInputTooLong,"formatInputTooLong")?f("<li class='select2-no-results'>"+l.formatInputTooLong(a.val(),l.maximumInputLength)+"</li>"):f(""):(l.formatSearching&&0===this.findHighlightableChoices().length&&f("<li class='select2-searching'>"+l.formatSearching()+"</li>"),a.addClass("select2-active"),this.removeHighlight(),(n=this.tokenize())!=t&&null!=n&&a.val(n),this.resultsPage=1,l.query({element:l.element,term:a.val(),page:this.resultsPage,context:null,matcher:l.matcher,callback:this.bind((function(i){var n;o==this.queryCount&&(this.opened()?(this.context=i.context===t?null:i.context,this.opts.createSearchChoice&&""!==a.val()&&(n=this.opts.createSearchChoice.call(r,a.val(),i.results))!==t&&null!==n&&r.id(n)!==t&&null!==r.id(n)&&0===e(i.results).filter((function(){return g(r.id(this),r.id(n))})).length&&i.results.unshift(n),0===i.results.length&&k(l.formatNoMatches,"formatNoMatches")?f("<li class='select2-no-results'>"+l.formatNoMatches(a.val())+"</li>"):(c.empty(),r.opts.populateResults.call(this,c,i.results,{term:a.val(),page:this.resultsPage,context:null}),!0===i.more&&k(l.formatLoadMore,"formatLoadMore")&&(c.append("<li class='select2-more-results'>"+r.opts.escapeMarkup(l.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout((function(){r.loadMoreIfNeeded()}),10)),this.postprocessResults(i,s),p(),this.opts.element.trigger({type:"select2-loaded",items:i}))):this.search.removeClass("select2-active"))}))})));f("<li class='select2-selection-limit'>"+l.formatSelectionTooBig(d)+"</li>")}function p(){a.removeClass("select2-active"),r.positionDropdown()}function f(e){c.html(e),p()}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){var e;(e=this.search)[0]!==document.activeElement&&window.setTimeout((function(){var t,s=e[0],i=e.val().length;e.focus(),e.is(":visible")&&s===document.activeElement&&(s.setSelectionRange?s.setSelectionRange(i,i):s.createTextRange&&((t=s.createTextRange()).collapse(!1),t.select()))}),0)},selectHighlighted:function(e){var t=this.highlight(),s=this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data");s?(this.highlight(t),this.onSelect(s,e)):e&&e.noFocus&&this.close()},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==t?e.text():t)},getPlaceholderOption:function(){if(this.select){var e=this.select.children("option").first();if(this.opts.placeholderOption!==t)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===e.text()&&""===e.val())return e}},initContainerWidth:function(){var s=function(){var s,i,n,o,a;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if((s=this.opts.element.attr("style"))!==t)for(o=0,a=(i=s.split(";")).length;o<a;o+=1)if(null!==(n=i[o].replace(/\s/g,"").match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&n.length>=1)return n[1];return"resolve"===this.opts.width?(s=this.opts.element.css("width")).indexOf("%")>0?s:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px":null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==s&&this.container.css("width",s)}}),i=I(s,{createContainer:function(){return e(document.createElement("div")).attr({class:"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var s,i,n;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.search.focus(),(s=this.search.get(0)).createTextRange?((i=s.createTextRange()).collapse(!1),i.select()):s.setSelectionRange&&(n=this.search.val().length,s.setSelectionRange(n,n)),""===this.search.val()&&this.nextSearchTerm!=t&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(e.Event("select2-open"))},close:function(e){this.opened()&&(this.parent.close.apply(this,arguments),e=e||{focus:!0},this.focusser.removeAttr("disabled"),e.focus&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},destroy:function(){e("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,s=this.container,i=this.dropdown;this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=t=s.find(".select2-choice"),this.focusser=s.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+o()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind((function(e){if(this.isInterfaceEnabled())if(e.which!==u.PAGE_UP&&e.which!==u.PAGE_DOWN)switch(e.which){case u.UP:case u.DOWN:return this.moveHighlight(e.which===u.UP?-1:1),void b(e);case u.ENTER:return this.selectHighlighted(),void b(e);case u.TAB:return void this.selectHighlighted({noFocus:!0});case u.ESC:return this.cancel(e),void b(e)}else b(e)}))),this.search.on("blur",this.bind((function(e){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind((function(){this.search.focus()})),0)}))),this.focusser.on("keydown",this.bind((function(e){if(this.isInterfaceEnabled()&&e.which!==u.TAB&&!u.isControl(e)&&!u.isFunctionKey(e)&&e.which!==u.ESC){if(!1!==this.opts.openOnEnter||e.which!==u.ENTER){if(e.which==u.DOWN||e.which==u.UP||e.which==u.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void b(e)}return e.which==u.DELETE||e.which==u.BACKSPACE?(this.opts.allowClear&&this.clear(),void b(e)):void 0}b(e)}}))),w(this.focusser),this.focusser.on("keyup-change input",this.bind((function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}}))),t.on("mousedown","abbr",this.bind((function(e){var t;this.isInterfaceEnabled()&&(this.clear(),(t=e).preventDefault(),t.stopImmediatePropagation(),this.close(),this.selection.focus())}))),t.on("mousedown",this.bind((function(t){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),b(t)}))),i.on("mousedown",this.bind((function(){this.search.focus()}))),t.on("focus",this.bind((function(e){b(e)}))),this.focusser.on("focus",this.bind((function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")}))).on("blur",this.bind((function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(e.Event("select2-blur")))}))),this.search.on("focus",this.bind((function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")}))),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(t){var s=this.selection.data("select2-data");if(s){var i=e.Event("select2-clearing");if(this.opts.element.trigger(i),i.isDefaultPrevented())return;var n=this.getPlaceholderOption();this.opts.element.val(n?n.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==t&&(this.opts.element.trigger({type:"select2-removed",val:this.id(s),choice:s}),this.triggerChange({removed:s}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,(function(s){s!==t&&null!==s&&(e.updateSelection(s),e.close(),e.setPlaceholder())}))}},isPlaceholderOptionSelected:function(){var e;return!!this.getPlaceholder()&&((e=this.getPlaceholderOption())!==t&&e.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===t||null===this.opts.element.val())},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),s=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=e.find("option").filter((function(){return this.selected}));t(s.optionToData(i))}:"data"in t&&(t.initSelection=t.initSelection||function(s,i){var n=s.val(),o=null;t.query({matcher:function(e,s,i){var a=g(n,t.id(i));return a&&(o=i),a},callback:e.isFunction(i)?function(){i(o)}:e.noop})}),t},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===t?t:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==t){if(this.select&&this.getPlaceholderOption()===t)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,s){var i=0,n=this;if(this.findHighlightableChoices().each2((function(e,t){if(g(n.id(t.data("select2-data")),n.opts.element.val()))return i=e,!1})),!1!==s&&(!0===t&&i>=0?this.highlight(i):this.highlight(0)),!0===t){var o=this.opts.minimumResultsForSearch;o>=0&&this.showSearch(A(e.results)>=o)}},showSearch:function(t){this.showSearchInput!==t&&(this.showSearchInput=t,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!t),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!t),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",t))},onSelect:function(e,t){if(this.triggerSelect(e)){var s=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.nextSearchTerm=this.opts.nextSearchTerm(e,this.search.val()),this.close(),t&&t.noFocus||this.focusser.focus(),g(s,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var s,i,n=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),n.empty(),null!==e&&(s=this.opts.formatSelection(e,n,this.opts.escapeMarkup)),s!==t&&n.append(s),(i=this.opts.formatSelectionCssClass(e,n))!==t&&n.addClass(i),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.container.addClass("select2-allowclear")},val:function(){var e,s=!1,i=null,n=this,o=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],arguments.length>1&&(s=arguments[1]),this.select)this.select.val(e).find("option").filter((function(){return this.selected})).each2((function(e,t){return i=n.optionToData(t),!1})),this.updateSelection(i),this.setPlaceholder(),s&&this.triggerChange({added:i,removed:o});else{if(!e&&0!==e)return void this.clear(s);if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,(function(e){n.opts.element.val(e?n.id(e):""),n.updateSelection(e),n.setPlaceholder(),s&&n.triggerChange({added:e,removed:o})}))}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e){var s,i=!1;if(0===arguments.length)return(s=this.selection.data("select2-data"))==t&&(s=null),s;arguments.length>1&&(i=arguments[1]),e?(s=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),i&&this.triggerChange({added:e,removed:s})):this.clear(i)}}),n=I(s,{createContainer:function(){return e(document.createElement("div")).attr({class:"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),s=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=[];e.find("option").filter((function(){return this.selected})).each2((function(e,t){i.push(s.optionToData(t))})),t(i)}:"data"in t&&(t.initSelection=t.initSelection||function(s,i){var n=m(s.val(),t.separator),o=[];t.query({matcher:function(s,i,a){var c=e.grep(n,(function(e){return g(e,t.id(a))})).length;return c&&o.push(a),c},callback:e.isFunction(i)?function(){for(var e=[],s=0;s<n.length;s++)for(var a=n[s],c=0;c<o.length;c++){var l=o[c];if(g(a,t.id(l))){e.push(l),o.splice(c,1);break}}i(e)}:e.noop})}),t},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},destroy:function(){e("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,s=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(s);var i=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",(function(t){i.search[0].focus(),i.selectChoice(e(this))})),this.search.attr("id","s2id_autogen"+o()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind((function(){this.isInterfaceEnabled()&&(this.opened()||this.open())}))),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind((function(s){if(this.isInterfaceEnabled()){++this.keydowns;var i=t.find(".select2-search-choice-focus"),n=i.prev(".select2-search-choice:not(.select2-locked)"),o=i.next(".select2-search-choice:not(.select2-locked)"),a=function(t){var s=0,i=0;if("selectionStart"in(t=e(t)[0]))s=t.selectionStart,i=t.selectionEnd-s;else if("selection"in document){t.focus();var n=document.selection.createRange();i=document.selection.createRange().text.length,n.moveStart("character",-t.value.length),s=n.text.length-i}return{offset:s,length:i}}(this.search);if(i.length&&(s.which==u.LEFT||s.which==u.RIGHT||s.which==u.BACKSPACE||s.which==u.DELETE||s.which==u.ENTER)){var c=i;return s.which==u.LEFT&&n.length?c=n:s.which==u.RIGHT?c=o.length?o:null:s.which===u.BACKSPACE?(this.unselect(i.first()),this.search.width(10),c=n.length?n:o):s.which==u.DELETE?(this.unselect(i.first()),this.search.width(10),c=o.length?o:null):s.which==u.ENTER&&(c=null),this.selectChoice(c),b(s),void(c&&c.length||this.open())}if((s.which===u.BACKSPACE&&1==this.keydowns||s.which==u.LEFT)&&0==a.offset&&!a.length)return this.selectChoice(t.find(".select2-search-choice:not(.select2-locked)").last()),void b(s);if(this.selectChoice(null),this.opened())switch(s.which){case u.UP:case u.DOWN:return this.moveHighlight(s.which===u.UP?-1:1),void b(s);case u.ENTER:return this.selectHighlighted(),void b(s);case u.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case u.ESC:return this.cancel(s),void b(s)}if(s.which!==u.TAB&&!u.isControl(s)&&!u.isFunctionKey(s)&&s.which!==u.BACKSPACE&&s.which!==u.ESC){if(s.which===u.ENTER){if(!1===this.opts.openOnEnter)return;if(s.altKey||s.ctrlKey||s.shiftKey||s.metaKey)return}this.open(),s.which!==u.PAGE_UP&&s.which!==u.PAGE_DOWN||b(s),s.which===u.ENTER&&b(s)}}}))),this.search.on("keyup",this.bind((function(e){this.keydowns=0,this.resizeSearch()}))),this.search.on("blur",this.bind((function(t){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),t.stopImmediatePropagation(),this.opts.element.trigger(e.Event("select2-blur"))}))),this.container.on("click",s,this.bind((function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),this.focusSearch(),t.preventDefault()))}))),this.container.on("focus",s,this.bind((function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())}))),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,(function(s){s!==t&&null!==s&&(e.updateSelection(s),e.close(),e.clearSearch())}))}},clearSearch:function(){var e=this.getPlaceholder(),s=this.getMaxSearchWidth();e!==t&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(e).addClass("select2-default"),this.search.width(s>0?s:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var s=[],i=[],n=this;e(t).each((function(){f(n.id(this),s)<0&&(s.push(n.id(this)),i.push(this))})),t=i,this.selection.find(".select2-search-choice").remove(),e(t).each((function(){n.addSelectedChoice(this)})),n.postprocessResults()},tokenize:function(){var e=this.search.val();null!=(e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts))&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,t){this.triggerSelect(e)&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),!this.select&&this.opts.closeOnSelect||this.postprocessResults(e,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(s){var i,n,o=!s.locked,a=e("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),c=e("<li class='select2-search-choice select2-locked'><div></div></li>"),l=o?a:c,r=this.id(s),h=this.getVal();(i=this.opts.formatSelection(s,l.find("div"),this.opts.escapeMarkup))!=t&&l.find("div").replaceWith("<div>"+i+"</div>"),(n=this.opts.formatSelectionCssClass(s,l.find("div")))!=t&&l.addClass(n),o&&l.find(".select2-search-choice-close").on("mousedown",b).on("click dblclick",this.bind((function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind((function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()}))).dequeue(),b(t))}))).on("focus",this.bind((function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))}))),l.data("select2-data",s),l.insertBefore(this.searchContainer),h.push(r),this.setVal(h)},unselect:function(t){var s,i,n=this.getVal();if(0===(t=t.closest(".select2-search-choice")).length)throw"Invalid argument: "+t+". Must be .select2-search-choice";if(s=t.data("select2-data")){for(;(i=f(this.id(s),n))>=0;)n.splice(i,1),this.setVal(n),this.select&&this.postprocessResults();var o=e.Event("select2-removing");o.val=this.id(s),o.choice=s,this.opts.element.trigger(o),o.isDefaultPrevented()||(t.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(s),choice:s}),this.triggerChange({removed:s}))}},postprocessResults:function(e,t,s){var i=this.getVal(),n=this.results.find(".select2-result"),o=this.results.find(".select2-result-with-children"),a=this;n.each2((function(e,t){f(a.id(t.data("select2-data")),i)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))})),o.each2((function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")})),-1==this.highlight()&&!1!==s&&a.highlight(0),!this.opts.createSearchChoice&&!n.filter(".select2-result:not(.select2-selected)").length>0&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&k(a.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+a.opts.formatNoMatches(a.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-v(this.search)},resizeSearch:function(){var t,s,i,n,o=v(this.search);t=function(t){if(!a){var s=t[0].currentStyle||window.getComputedStyle(t[0],null);(a=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:s.fontSize,fontFamily:s.fontFamily,fontStyle:s.fontStyle,fontWeight:s.fontWeight,letterSpacing:s.letterSpacing,textTransform:s.textTransform,whiteSpace:"nowrap"})).attr("class","select2-sizer"),e("body").append(a)}return a.text(t.val()),a.width()}(this.search)+10,s=this.search.offset().left,(n=(i=this.selection.width())-(s-this.selection.offset().left)-o)<t&&(n=i-o),n<40&&(n=i-o),n<=0&&(n=t),this.search.width(Math.floor(n))},getVal:function(){var e;return this.select?null===(e=this.select.val())?[]:e:m(e=this.opts.element.val(),this.opts.separator)},setVal:function(t){var s;this.select?this.select.val(t):(s=[],e(t).each((function(){f(this,s)<0&&s.push(this)})),this.opts.element.val(0===s.length?"":s.join(this.opts.separator)))},buildChangeDetails:function(e,t){t=t.slice(0),e=e.slice(0);for(var s=0;s<t.length;s++)for(var i=0;i<e.length;i++)g(this.opts.id(t[s]),this.opts.id(e[i]))&&(t.splice(s,1),s>0&&s--,e.splice(i,1),i--);return{added:t,removed:e}},val:function(s,i){var n,o=this;if(0===arguments.length)return this.getVal();if((n=this.data()).length||(n=[]),!s&&0!==s)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(i&&this.triggerChange({added:this.data(),removed:n}));if(this.setVal(s),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),i&&this.triggerChange(this.buildChangeDetails(n,this.data()));else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,(function(t){var s=e.map(t,o.id);o.setVal(s),o.updateSelection(t),o.clearSearch(),i&&o.triggerChange(o.buildChangeDetails(n,o.data()))}))}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],s=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each((function(){t.push(s.opts.id(e(this).data("select2-data")))})),this.setVal(t),this.triggerChange()},data:function(t,s){var i,n,o=this;if(0===arguments.length)return this.selection.find(".select2-search-choice").map((function(){return e(this).data("select2-data")})).get();n=this.data(),t||(t=[]),i=e.map(t,(function(e){return o.opts.id(e)})),this.setVal(i),this.updateSelection(t),this.clearSearch(),s&&this.triggerChange(this.buildChangeDetails(n,this.data()))}}),e.fn.select2=function(){var s,o,a,c,l,r=Array.prototype.slice.call(arguments,0),h=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],u=["opened","isFocused","container","dropdown"],d=["val","data"],p={search:"externalSearch"};return this.each((function(){if(0===r.length||"object"==typeof r[0])(s=0===r.length?{}:e.extend({},r[0])).element=e(this),"select"===s.element.get(0).tagName.toLowerCase()?l=s.element.prop("multiple"):(l=s.multiple||!1,"tags"in s&&(s.multiple=l=!0)),(o=l?new n:new i).init(s);else{if("string"!=typeof r[0])throw"Invalid arguments to select2 plugin: "+r;if(f(r[0],h)<0)throw"Unknown method: "+r[0];if(c=t,(o=e(this).data("select2"))===t)return;if("container"===(a=r[0])?c=o.container:"dropdown"===a?c=o.dropdown:(p[a]&&(a=p[a]),c=o[a].apply(o,r.slice(1))),f(r[0],u)>=0||f(r[0],d)&&1==r.length)return!1}})),c===t?this:c},e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,s,i){var n=[];return y(e.text,s.term,n,i),n.join("")},formatSelection:function(e,s,i){return e?i(e.text):t},sortResults:function(e,t,s){return e},formatResultCssClass:function(e){return t},formatSelectionCssClass:function(e,s){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var s=t-e.length;return"Please enter "+s+" more character"+(1==s?"":"s")},formatInputTooLong:function(e,t){var s=e.length-t;return"Please delete "+s+" character"+(1==s?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return p(""+t).toUpperCase().indexOf(p(""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:function(e,s,i,n){var o,a,c,l,r,h=e,u=!1;if(!n.createSearchChoice||!n.tokenSeparators||n.tokenSeparators.length<1)return t;for(;;){for(a=-1,c=0,l=n.tokenSeparators.length;c<l&&(r=n.tokenSeparators[c],!((a=e.indexOf(r))>=0));c++);if(a<0)break;if(o=e.substring(0,a),e=e.substring(a+r.length),o.length>0&&(o=n.createSearchChoice.call(this,o,s))!==t&&null!==o&&n.id(o)!==t&&null!==n.id(o)){for(u=!1,c=0,l=s.length;c<l;c++)if(g(n.id(o),n.id(s[c]))){u=!0;break}u||i(o)}}return h!==e?e:void 0},escapeMarkup:E,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(e){return null},nextSearchTerm:function(e,s){return t}},e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:x,local:T,tags:O},util:{debounce:C,markMatch:y,escapeMarkup:E,stripDiacritics:p},class:{abstract:s,single:i,multi:n}}}function p(e){var t,s,i,n;if(!e||e.length<1)return e;for(t="",s=0,i=e.length;s<i;s++)n=e.charAt(s),t+=d[n]||n;return t}function f(e,t){for(var s=0,i=t.length;s<i;s+=1)if(g(e,t[s]))return s;return-1}function g(e,s){return e===s||e!==t&&s!==t&&(null!==e&&null!==s&&(e.constructor===String?e+""==s+"":s.constructor===String&&s+""==e+""))}function m(t,s){var i,n,o;if(null===t||t.length<1)return[];for(n=0,o=(i=t.split(s)).length;n<o;n+=1)i[n]=e.trim(i[n]);return i}function v(e){return e.outerWidth(!1)-e.width()}function w(s){var i="keyup-change-value";s.on("keydown",(function(){e.data(s,i)===t&&e.data(s,i,s.val())})),s.on("keyup",(function(){var n=e.data(s,i);n!==t&&s.val()!==n&&(e.removeData(s,i),s.trigger("keyup-change"))}))}function C(e,s,i){var n;return i=i||t,function(){var t=arguments;window.clearTimeout(n),n=window.setTimeout((function(){s.apply(i,t)}),e)}}function b(e){e.preventDefault(),e.stopPropagation()}function S(t,s,i){var n,o,a=[];(n=t.attr("class"))&&e((n=""+n).split(" ")).each2((function(){0===this.indexOf("select2-")&&a.push(this)})),(n=s.attr("class"))&&e((n=""+n).split(" ")).each2((function(){0!==this.indexOf("select2-")&&(o=i(this))&&a.push(o)})),t.attr("class",a.join(" "))}function y(e,t,s,i){var n=p(e.toUpperCase()).indexOf(p(t.toUpperCase())),o=t.length;n<0?s.push(i(e)):(s.push(i(e.substring(0,n))),s.push("<span class='select2-match'>"),s.push(i(e.substring(n,n+o))),s.push("</span>"),s.push(i(e.substring(n+o,e.length))))}function E(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,(function(e){return t[e]}))}function x(s){var i,n=null,o=s.quietMillis||100,a=s.url,c=this;return function(l){window.clearTimeout(i),i=window.setTimeout((function(){var i=s.data,o=a,r=s.transport||e.fn.select2.ajaxDefaults.transport,h={type:s.type||"GET",cache:s.cache||!1,jsonpCallback:s.jsonpCallback||t,dataType:s.dataType||"json"},u=e.extend({},e.fn.select2.ajaxDefaults.params,h);i=i?i.call(c,l.term,l.page,l.context):null,o="function"==typeof o?o.call(c,l.term,l.page,l.context):o,n&&n.abort(),s.params&&(e.isFunction(s.params)?e.extend(u,s.params.call(c)):e.extend(u,s.params)),e.extend(u,{url:o,dataType:s.dataType,data:i,success:function(e){var t=s.results(e,l.page);l.callback(t)}}),n=r.call(c,u)}),o)}}function T(t){var s,i,n=t,o=function(e){return""+e.text};e.isArray(n)&&(n={results:i=n}),!1===e.isFunction(n)&&(i=n,n=function(){return i});var a=n();return a.text&&(o=a.text,e.isFunction(o)||(s=a.text,o=function(e){return e[s]})),function(t){var s,i=t.term,a={results:[]};""!==i?(s=function(n,a){var c,l;if((n=n[0]).children){for(l in c={},n)n.hasOwnProperty(l)&&(c[l]=n[l]);c.children=[],e(n.children).each2((function(e,t){s(t,c.children)})),(c.children.length||t.matcher(i,o(c),n))&&a.push(c)}else t.matcher(i,o(n),n)&&a.push(n)},e(n().results).each2((function(e,t){s(t,a.results)})),t.callback(a)):t.callback(n())}}function O(s){var i=e.isFunction(s);return function(n){var o=n.term,a={results:[]};e(i?s():s).each((function(){var e=this.text!==t,s=e?this.text:this;(""===o||n.matcher(o,s))&&a.results.push(e?this:{id:this,text:this})})),n.callback(a)}}function k(t,s){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error(s+" must be a function or a falsy value")}function P(t){return e.isFunction(t)?t():t}function A(t){var s=0;return e.each(t,(function(e,t){t.children?s+=A(t.children):s++})),s}function I(t,s){var i=function(){};return(i.prototype=new t).constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,s),i}}(jQuery)},tW0B:function(e,t,s){"use strict";s.r(t);s("6fSn");var i=s("+x/D"),n=(s("02/N"),i.a.fn.select2),o="aui-select2-container",a="aui-select2-drop aui-dropdown2",c="aui-has-avatar";i.a.fn.auiSelect2=function(e){var t;if(i.a.isPlainObject(e)){var s=i.a.extend({},e),l=s.hasAvatar?" "+c:"";s.containerCssClass=o+l+(s.containerCssClass?" "+s.containerCssClass:""),s.dropdownCssClass=a+l+(s.dropdownCssClass?" "+s.dropdownCssClass:""),(t=Array.prototype.slice.call(arguments,1)).unshift(s)}else t=arguments.length?arguments:[{containerCssClass:o,dropdownCssClass:a}];return n.apply(this,t)}}},[["tW0B","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.d7c46c2734","aui.splitchunk.fb15cffa72","aui.splitchunk.56dfb54d0c","aui.splitchunk.908fe798b4","aui.splitchunk.462ee5f9ef","aui.splitchunk.26116b3cbd","aui.splitchunk.50dca3e042"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.inline-dialog2', location = 'aui.chunk.912883d40232412930d0--f808c38ece6dca6dfe0d.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.inline-dialog2"],[],[["Rvtc","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.vendors--084821f40b","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.dd803a46b4","aui.splitchunk.994e478d48","aui.splitchunk.e54c7c7304","aui.splitchunk.fb15cffa72","aui.splitchunk.f1e06f97a4","aui.splitchunk.f673ef53ac","aui.splitchunk.8659b532c1","aui.splitchunk.d0110a864f","aui.splitchunk.afa5039e04","aui.splitchunk.bff3715233","aui.splitchunk.c750721820","aui.splitchunk.6d6f245ed3","aui.splitchunk.084821f40b","aui.splitchunk.5b8c290363","aui.splitchunk.baa83dbaf9","aui.splitchunk.36cd9d521c","aui.splitchunk.d925afe2c0","aui.splitchunk.5b7fdbd666","aui.splitchunk.8a641c03a4","aui.splitchunk.d727dd207f","aui.splitchunk.543254b237"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.requirementyogi:requirement-view', location = 'js/requirement-view.js' */
!function(){var __webpack_modules__={6095:function(){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var RY=window.RY=window.RY||{};AJS.$((function($){var fn,_get,$byline=$("#ry-byline-link"),contentId=AJS.Meta.get("content-id")||AJS.Meta.get("page-id"),spaceKey=AJS.Meta.get("space-key");function fetchAllRequirementHistory(callback){var $dialog=$("#requirementyogi-byline-dialog"),spaceKey=AJS.Meta.get("space-key"),list=[];$(".requirement-macro, .requirement-link-macro").each((function(){var $this=$(this);if(($this.attr("data-space-key")||spaceKey)==spaceKey){var key=$this.attr("data-requirement-key");list.push(key)}else $this.addClass("ry-cant-highlight-macro").attr("title","This requirement is not in the same space and can't be managed from here.")})),callback&&$dialog.find(".aui-spinner").removeClass("hidden"),RY.RequirementHistoryManager.get(spaceKey,list).then((function(data){callback&&($dialog.find(".aui-spinner").addClass("hidden"),callback(data))}))}if(RY.RequirementHistoryManager={cache:{},get:(fn=regeneratorRuntime.mark((function _callee(spaceKey,list){var listToFetch,_iterator,_step,key;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:listToFetch=[],_iterator=_createForOfIteratorHelper(list);try{for(_iterator.s();!(_step=_iterator.n()).done;)key=_step.value,RY.RequirementHistoryManager.cache[key]||listToFetch.push(key)}catch(err){_iterator.e(err)}finally{_iterator.f()}if(0!==listToFetch.length){_context.next=7;break}return _context.abrupt("return",Promise.resolve(RY.RequirementHistoryManager.cache));case 7:return _context.abrupt("return",new Promise((function(resolve,reject){$.ajax({url:AJS.contextPath()+"/rest/reqs/1/misc/"+encodeURIComponent(spaceKey)+"/history?"+$.param({reqs:listToFetch}),type:"GET",contentType:"application/json; charset=utf-8",success:function(data){for(var _i=0,_Object$keys=Object.keys(data);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];RY.RequirementHistoryManager.cache[key]=data[key]}resolve(RY.RequirementHistoryManager.cache)},error:function(jqXHR){RY.createXHRErrorHandler("Error while getting the baselines for each requirement")(jqXHR),reject("Error while getting the baselines for "+list.join(", "))}})})));case 8:case"end":return _context.stop()}}),_callee)})),_get=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2){return _get.apply(this,arguments)})},1==$byline.size()){$byline.attr("href","#"),$byline.css("padding-right: 0");var hrefSearchForDefinitions=AJS.contextPath()+"/requirementyogi/list.action?"+$.param({key:spaceKey,queryString:"page == "+contentId}),hrefSearchForLinks=AJS.contextPath()+"/requirementyogi/list.action?"+$.param({key:spaceKey,queryString:"page ~ "+contentId}),hrefDependencyMatrix=AJS.contextPath()+"/requirementyogi/dependencies.action?"+$.param({key:spaceKey,queryString:"page == "+contentId,queryString2:"page ~ "+contentId});$("body").append(PlaySQL.Requirements.bylineDialog({contentId:contentId,hrefSearchForDefinitions:hrefSearchForDefinitions,hrefSearchForLinks:hrefSearchForLinks,hrefDependencyMatrix:hrefDependencyMatrix})),$byline.attr("data-aui-trigger","").attr("aria-controls","requirementyogi-byline-dialog"),$("#requirementyogi-byline-dialog .ry-reindex").click((function(e){if(e.preventDefault(),"READ_ONLY"!==AJS.Meta.get("access-mode"))if("."===(AJS.Meta.get("page-title")||"").charAt(0)&&AJS.flag({type:"error",title:"Reindexation not available",body:'Titles starting with "." are reserved for Scroll Versions. We don\'t index such pages to avoid interfering with that addon.',close:"auto"}),$(".requirement-macro").removeClass("ry-error"),e.altKey){AJS.flag({type:"info",title:"Extracting requirements...",close:"auto"});var results=RY.extractAndSendRequirements(!0);AJS.log("== Manual reindexing of requirements on the page\nExecuting: RY.extractAndSendRequirements(true);\n"+results+"\n\n== End of reindexing information"),AJS.flag({type:"success",title:"Done",body:"<pre>"+AJS.escapeHtml(results)+"</pre>"})}else AJS.flag({type:"info",title:"Reindexing this page...",close:"auto"}),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/helpers/reindex/"+contentId+"?"+AJS.$.param({}),type:"PUT",contentType:"application/json; charset=utf-8",success:function(data){RY.extractAndSendRequirements(!0,null,(function(){AJS.flag({type:"success",title:"Success",body:"The page is reindexed. No need to reload."})}),(function(message){message&&-1!=message.indexOf("0 definitions to reindex")?window.location.reload():AJS.flag({type:"error",title:"Reindexation has failed",body:AJS.escapeHtml(message)})}))},error:RY.createXHRErrorHandler("Error while reindexing this page")});else AJS.flag({type:"error",title:"Reindexation can't be done while the instance is in read-only mode",close:"auto"})})),$("#requirementyogi-byline-dialog").on("aui-hide",(function(e){var $dialog=$(this);$dialog.find(".ry-byline-dialog-create-baseline").hasClass("hidden")||($dialog.find(".ry-byline-dialog-default").removeClass("hidden"),$dialog.find(".ry-byline-dialog-create-baseline").addClass("hidden"),$dialog.find(".baseline-suggestion-auto").remove())})),$("#requirementyogi-byline-dialog .ry-create-baseline-from-this-page, #requirementyogi-byline-dialog .ry-create-baseline-from-this-page-and-descendents").click((function(){if("READ_ONLY"!==AJS.Meta.get("access-mode")){var $dialog=$(this).closest("#requirementyogi-byline-dialog");$dialog.find(".ry-byline-dialog-default").addClass("hidden"),$dialog.find(".ry-byline-dialog-create-baseline").removeClass("hidden");var includeChildren=$(this).hasClass("ry-create-baseline-from-this-page-and-descendents"),pageName=AJS.Meta.get("page-title");$.ajax({url:AJS.contextPath()+"/rest/reqs/1/baseline/"+encodeURIComponent(AJS.Meta.get("space-key"))+"/0/suggest?"+$.param({pageName:pageName}),type:"GET",contentType:"application/json; charset=utf-8",success:function(data){for(var $template=$("#baseline-title-template"),i=0;i<data.length;i++){var $clone=$template.clone().insertAfter($template);$clone.find("label").text(data[i]);var id="baseline-suggestion-"+i;$clone.find("input").attr("id",id).attr("value",data[i]),$clone.find("label").attr("for",id),0==i&&$clone.attr("checked","true"),$clone.removeAttr("id").removeClass("hidden").addClass("baseline-suggestion-auto")}$dialog.find("#baseline-title-manual input.text").off(".bl-create").on("input.bl-create paste.bl-create click.bl-create",(function(){$dialog.find("#baseline-title-manual input.radio").prop("checked",!0)})),$dialog.find(".create-baseline").off(".bl-create").on("click.bl-create",(function(){var title=$dialog.find("input.radio[name=baseline-title-suggestion]:checked").val();title||(title=$dialog.find("#baseline-title-manual input.text").val().trim()),$dialog.find(".aui-spinner").removeClass("hidden"),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/baseline/"+encodeURIComponent(spaceKey)+"/2/create-instant",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({name:title,fromCeo:AJS.Meta.get("page-id"),fromCeoWithChildren:includeChildren})}).done((function(data){$dialog.removeAttr("open"),$dialog.find(".ry-byline-dialog-default").removeClass("hidden"),$dialog.find(".ry-byline-dialog-create-baseline").addClass("hidden"),$dialog.find(".aui-spinner").addClass("hidden");var url=data.indexUrl;AJS.flag({type:"success",title:"Baseline created",body:'You can view the baseline on <a href="'+AJS.contextPath()+url+'">this page</a>.'})})).error((function(jqXHR){$dialog.find(".aui-spinner").addClass("hidden"),RY.createXHRErrorHandler("The baseline couldn't be created.")(jqXHR)}))}))},error:RY.createXHRErrorHandler("Error while getting suggestions for the names of baselines in this space")})}else AJS.flag({type:"error",title:"Reindexation can't be done while the instance is in read-only mode",close:"auto"})})),$("#requirementyogi-byline-dialog .ry-compare-to-baseline").click((function(){var $dialog=$(this).closest("#requirementyogi-byline-dialog");$dialog.find(".ry-byline-dialog-default").addClass("hidden"),$dialog.find(".aui-spinner").removeClass("hidden"),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/baseline/"+encodeURIComponent(AJS.Meta.get("space-key")),type:"GET",contentType:"application/json; charset=utf-8",success:function(baselines){$dialog.find(".aui-spinner").addClass("hidden"),$dialog.find(".ry-byline-dialog-compare-to-baseline").removeClass("hidden");var $dropdown=$dialog.find("#compare-to-baseline");$dropdown.empty(),$dropdown.append('<option value="upgrade">Check for upgradeable requirements links</option>'),$dropdown.append('<option value="">Current-The active version of requirements</option>'),baselines.sort((function(a,b){return b.baseline-a.baseline}));for(var i=0;i<baselines.length;i++)$dropdown.append($("<option>",{value:baselines[i].baseline,text:baselines[i].baseline+"-"+baselines[i].name}));fetchAllRequirementHistory()},error:function(jqXHR){$dialog.find(".aui-spinner").addClass("hidden"),$dialog.find(".ry-byline-dialog-default").removeClass("hidden"),RY.createXHRErrorHandler("Error while getting the names of baselines in this space")(jqXHR)}}),$dialog.off(".ry-dialog"),$dialog.on("click.ry-dialog",".compare",(function(e){var $itemsToReset=$(".ry-highlight-macro, .ry-cant-highlight-macro"),dropdownValue=$("#compare-to-baseline").val(),isCheckForUpgrades="upgrade"==dropdownValue,referenceBaseline=!isCheckForUpgrades&&parseInt(dropdownValue)||null,spaceKey=AJS.Meta.get("space-key");fetchAllRequirementHistory((function(data){$itemsToReset.removeClass("ry-highlight-macro ry-cant-highlight-macro").removeAttr("data-since-baseline").removeAttr("data-until-baseline").removeAttr("title"),$(".requirement-macro, .requirement-link-macro").each((function(){var $macro=$(this);if(($macro.attr("data-space-key")||spaceKey)==spaceKey){var key=$macro.attr("data-requirement-key"),baseline=parseInt($macro.attr("data-requirement-baseline"))||null,history=data[key];if(history&&history.length>0){for(var nextUnmodifiedBaseline=null,previousUnmodifiedBaseline=null,found=!1,modifiedSinceBaseline=!1,i=history.length-1;i>=0;i--)null!=history[i].baseline&&(!baseline||history[i].baseline<baseline)?history[i].modified&&(previousUnmodifiedBaseline=history[i].baseline):history[i].baseline==baseline?(found=!0,history[i].modified&&(previousUnmodifiedBaseline=history[i].baseline),nextUnmodifiedBaseline=history[i].baseline,modifiedSinceBaseline=!1):modifiedSinceBaseline||(history[i].modified?modifiedSinceBaseline=!0:nextUnmodifiedBaseline=history[i].baseline);if(!found){var history1=[];for(i=0;i<history.length;i++)history1.push("v"+history[i].baseline+"-"+(history[i].modified?"modified":""));return void AJS.logError("For requirement "+key+", baseline "+baseline+" was not found among the following baselines. Perhaps it has been deleted? "+JSON.stringify(history1))}if($macro.attr("data-since-baseline",previousUnmodifiedBaseline||"latest"),$macro.attr("data-until-baseline",nextUnmodifiedBaseline||"latest"),isCheckForUpgrades){if((null==nextUnmodifiedBaseline&&null!=baseline||nextUnmodifiedBaseline>baseline)&&$macro.addClass("ry-highlight-macro").attr("title","This requirement can be upgraded from baseline "+baseline+" to "+(nextUnmodifiedBaseline||"the latest")+" without modification."),null==previousUnmodifiedBaseline)return;modifiedSinceBaseline&&$macro.addClass("ry-highlight-macro")}else((referenceBaseline||1/0)>(nextUnmodifiedBaseline||1/0)||(previousUnmodifiedBaseline||1/0)>(referenceBaseline||1/0))&&$macro.addClass("ry-highlight-macro")}}}))}))})),$dialog.on("click.ry-dialog",".compare-reset",(function(e){$dialog.find(".ry-byline-dialog-default").removeClass("hidden"),$dialog.find(".ry-byline-dialog-compare-to-baseline").addClass("hidden"),$(".requirement-macro, .requirement-link-macro").removeClass("ry-highlight-macro ry-cant-highlight-macro").removeAttr("data-since-baseline").removeAttr("data-until-baseline").removeAttr("title"),$dialog.find(".aui-spinner").addClass("hidden")}))})),$("#requirementyogi-byline-dialog .ry-see-extraction-messages").on("click",(function(e){return e.preventDefault(),$(this).closest("div").find(".ry-extraction-messages").removeClass("hidden").text(RY.extractionMessages+"\n"),$(this).remove(),!1}))}}))},582:function(){"use strict";var RY=window.RY=window.RY||{},RY_KEY_MATCHER=/^[\u0020-\u002E\u0030-\u005B\u005D-\u007E\u00A0-\uFFEF]+$/;AJS.$((function($){Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler("com.playsql.requirementyogi:to-req-yogi",{onClick:function(selectionObject){RY.InlineCreationDialog.showCreateReqDialog(selectionObject)},shouldDisplay:function(selection){var result=Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY.apply(this,arguments);if(!result)return!1;var text=selection.toString(),matchesKeyFormat=RY_KEY_MATCHER.test($.trim(text));return matchesKeyFormat}})})),RY.InlineCreationDialog=RY.InlineCreationDialog||function($){var wikiContentText,selectionText,selectionObject,typeKeySeparator=/[._-]/,defaultDialogOptions={hideDelay:null,maxHeight:500};function addDelimiters(pattern){return/[\\\(\[*\.\?]/.test(pattern)||(pattern="\\w*"+pattern.replace(/[\.]/g,"\\$1")+"\\w*"),pattern}function countOccurrences(str,pattern){if(!pattern||!str)return 0;var regex=new RegExp("\\b"+pattern+"\\b","g"),match=str.match(regex);if(!match)return 0;for(var occurrences=0,i=0;i<match.length;i++)/[a-zA-Z0-9_.-]+/.test(match[i])&&occurrences++;return occurrences}function replaceReferences(pageId,replacements,formatting){for(var replacement=null,i=0;i<replacements.length;i++)if(replacements[i].pageId==pageId){if(null!=replacement)return void window.location.reload();replacement=replacements[i]}if(null==replacement)throw AJS.log("Replacing references: ",replacements),"No replacement found";var isLink="MAKE_REFERENCE"===replacement.action,surroundingRYLabel=document.createElement("a");surroundingRYLabel.setAttribute("data-requirement-key",replacement.key),surroundingRYLabel.setAttribute("id",(isLink?"req-link-":"req-")+replacement.key+(isLink?"-":"")),surroundingRYLabel.setAttribute("href",AJS.contextPath()+replacement.url),replacement.spaceKey&&surroundingRYLabel.setAttribute("data-space-key",replacement.spaceKey);var css=isLink?"requirement-link-macro":"requirement-macro",hasBorder=!0;if(formatting){var style="",parts=formatting.split(/; ?/);for(i=0;i++;i<parts.length)if(0===i)style+="color: "+parts[i]+"; ";else switch($.trim(parts[i])){case"bold":style+="font-weight: bold; ";break;case"italic":style+="font-style: italic; ";break;case"underlined":style+="text-decoration: underline; ";break;case"noborder":hasBorder=!1}surroundingRYLabel.setAttribute("style",style)}hasBorder&&(css+=" aui-label"),surroundingRYLabel.setAttribute("class",css),selectionObject.range.surroundContents(surroundingRYLabel)}function updateSuggestions(){var pattern,$content=$("#create-inline-requirement-form"),$inlineExplanation=$content.find(".create-inline-requirement-explanation"),$selectedType=$content.find("#req-type").find(":selected"),$newReqTypeName=$content.find("#type-name"),$typeCreationGroup=$content.find(".new-type-group"),$description=$content.find(".description-parent"),type=$selectedType.val(),ceoid=$selectedType.attr("data-ceoid"),reqKey=$.trim(selectionText);pattern="new"==ceoid?extractPattern(reqKey,$newReqTypeName.val()):"inline"==ceoid?extractPattern(reqKey):extractPattern(reqKey,type);var occurrences=countOccurrences(wikiContentText,addDelimiters(pattern));$inlineExplanation.toggleClass("hidden",!("inline"===ceoid)),$typeCreationGroup.toggleClass("hidden",!("new"===ceoid)),$description.toggleClass("hidden",!("inline"!==ceoid)),$(".for-all-on-page-group").toggleClass("hidden",!countOccurrences(wikiContentText,addDelimiters(reqKey))),$(".for-all-in-space-group").removeClass("hidden");var $transformAllSimilarGroup=$content.find(".transform-all-similar-group");$transformAllSimilarGroup.removeClass("hidden");var suggestedRegex=pattern.replace(/\./g,"\\.")+"[A-Za-z0-9._-]+";$transformAllSimilarGroup.find("#transform-all-similar").attr("data-pattern",suggestedRegex),0==$transformAllSimilarGroup.find("#pattern > input").val(suggestedRegex).size()&&$transformAllSimilarGroup.find("#pattern").text('"'+pattern+'"'),$transformAllSimilarGroup.find("#pattern-count").text(occurrences-1),$content.find(".req-key-reference").text(reqKey)}function extractPattern(key,type){var text;if(type){var position=key.indexOf(type),extraChar=key.charAt(position+type.length);text=typeKeySeparator.test(extraChar)?type+extraChar:type}else(text=key.replace(/^([A-Za-z0-9]+[^A-Za-z0-9]?).*$/,"$1"))===key&&(text=text.replace(/(\d+$)/,""));return text}return{showCreateReqDialog:function(selectionObjParam){if(RY.InlineCreationDialog.removeDialog(),selectionObject=selectionObjParam,selectionText=$.trim(selectionObject.text),RY_KEY_MATCHER.test(selectionText)){var options={preHideCallback:function(){return!$(".select2-drop-active").length},width:360,hideCallback:function(){RY.InlineCreationDialog.dialog=void 0}},newTypeSuggestion="Type "+selectionText,parts=selectionText.split(/[_.-]/);parts.length>1&&(newTypeSuggestion=parts[0]);RY.InlineCreationDialog.dialog=function(selectionObject,id,options,displayFn){var $target=$("<div>");!function(targetDimensions,$target){Confluence.DocThemeUtils.appendAbsolutePositionedElement($target),$target.css({top:targetDimensions.top,height:targetDimensions.height,left:targetDimensions.left,width:targetDimensions.width,"z-index":-9999,position:"absolute"}).addClass("create-requirement-yogi-dialog-target")}(selectionObject.area.average,$target);var originalCallback=options.hideCallback;options.hideCallback=function(){$target.remove(),originalCallback&&originalCallback()};var dialog=Confluence.ScrollingInlineDialog($target,id,displayFn,$.extend({},defaultDialogOptions,options));return dialog.show(),dialog}(selectionObject,"create-requirement-yogi-dialog",options,(function($content,trigger,showPopup){return $($content).html(PlaySQL.Requirements.inlineActionForm({requirementKey:selectionObject.text,newTypeSuggestion:newTypeSuggestion})),showPopup(),function(){var $content=$("#create-inline-requirement-form");$el=$(selectionObject.containingElement).closest(".wiki-content"),($el=$el.clone()).find("p, li, td, th, img, div, h1, h2, h3, h4, h5, h6, br").prepend("\n"),wikiContentText=$el.text(),window.setTimeout((function(){var $reqType=$content.find("#req-type"),$newReqTypeName=$content.find("#type-name");$reqType.focus(),$reqType.change((function(){var $selected=$(this).find(":selected");$selected.val(),$selected.attr("data-ceoid");updateSuggestions()})),$newReqTypeName.change((function(){updateSuggestions()})),updateSuggestions();var $color=$content.find("#type-color");$color.auiSelect2&&$color.auiSelect2({formatResult:function(state){return state.id?PlaySQL.Requirements.colorDropdownItem({color:state.id,name:state.text}):state.text},escapeMarkup:function(m){return m},dropdownParent:$("#type-color")});var updatePanelBackgroundColor=function(){var color=$color.val();$content.find(".new-type-group").css("border-left-color",color)};$color.change(updatePanelBackgroundColor),updatePanelBackgroundColor(),$content.on("click",".cancel",RY.InlineCreationDialog.removeDialog),$content.on("click",".refresh-types",(function(){loadTypes(!0)})),$content.on("click",".edit-pattern",(function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault(),$content.find("#pattern").html($("<input>",{placeholder:"Enter a regex pattern",title:"If using a regex, please end it with .*",id:"custom-pattern",name:"custom-pattern",value:$content.find("#transform-all-similar").attr("data-pattern")})),$content.find("#after-pattern-count").append(' – The pattern must be a regex of the complete key, <a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_blank">see regex documentation here</a>');var $customPattern=$content.find("#custom-pattern");return $customPattern.on("keyup change",(function(){window.setTimeout((function(){var pattern=$customPattern.val(),regex=addDelimiters(pattern),occurrencesInSelection=countOccurrences(selectionText,regex),occurrences=countOccurrences(wikiContentText,regex),$transformAllSimilar=$content.find(".transform-all-similar-group");$transformAllSimilar.find("#transform-all-similar").attr("data-pattern",pattern),$transformAllSimilar.find("#pattern-count").text(occurrences<1?0:occurrences-1),$transformAllSimilar.find("#warn-key-is-no-match").toggleClass("hidden",occurrencesInSelection>0)}),0)})),window.setTimeout((function(){$content.find("#transform-all-similar").attr("checked","true"),$content.find(".edit-pattern").remove()}),0),!1})),$content.submit((function(e){function sendRequirementType(payload,callback){$("#create-inline-requirement-form #form-message").text(""),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/types/"+encodeURI(AJS.Meta.get("space-key"))+"/createAndReplace",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(payload)}).done((function(data){callback(data)})).fail((function(jqXHR){$content.find(".aui-spinner").addClass("hidden"),RY.createXHRErrorHandler("The request couldn't be sent. Please try again later.")(jqXHR)}))}e.preventDefault(),$content.find(".aui-spinner").removeClass("hidden");var pageId=AJS.Meta.get("page-id");if("already-exists"==$content.find("[name=situation]").val()){var $applyInSpace=$content.find("#apply-in-space");sendRequirementType({reqKey:selectionText,sourceCeoId:pageId,applyToAllSimilarOccurrences:!1,applyToAllSpace:$applyInSpace.is(":checked"),defineInlineAsALink:!0},(function(data){0==data.replacements.length?$content.find("#form-message").text("No replacement was performed. Can you edit this page?"):(replaceReferences(pageId,data.replacements,null),RY.InlineCreationDialog.removeDialog())}))}else{var $selectedType=$reqType.find(":selected"),reqType=$selectedType.val(),ceoId=$selectedType.attr("data-ceoid"),reqTypeFormatting=$selectedType.attr("data-formatting"),typeName=$content.find("#type-name").val(),typeColor=$content.find("#type-color").val(),desc=$content.find("#description").val(),$transformAllSimilar=$content.find("#transform-all-similar"),pattern=($applyInSpace=$content.find("#apply-in-space"),$transformAllSimilar.attr("data-pattern")),formatting=typeColor&&"transparent"!=typeColor?typeColor+"; bold;":void 0;"inline"==ceoId?sendRequirementType({reqKey:selectionText,typeName:typeName,sourceCeoId:pageId,applyToAllSimilarOccurrences:typeName&&$transformAllSimilar.is(":checked")||!1,pattern:pattern,applyToAllSpace:$applyInSpace.is(":checked"),defineInline:!0,description:desc,formatting:null},(function(data){$content.find(".aui-spinner").addClass("hidden"),RY.showMessageBean("Transformation",data.messages),0==data.replacements.length?$content.find("#form-message").text("No replacement was performed. Can you edit this page?"):(replaceReferences(pageId,data.replacements,null),RY.InlineCreationDialog.removeDialog())})):"new"==ceoId?sendRequirementType({reqKey:selectionText,typeName:typeName,sourceCeoId:pageId,targetCeoId:null,applyToAllSimilarOccurrences:typeName&&$transformAllSimilar.is(":checked")||!1,pattern:pattern,applyToAllSpace:$applyInSpace.is(":checked"),defineInline:!1,description:desc,formatting:formatting},(function(data){$content.find(".aui-spinner").addClass("hidden"),RY.showMessageBean("Transformation",data.messages);var url=data.targetPageUrl;url?window.location.href=AJS.contextPath()+url:$content.find("#form-message").text("No replacement was performed. Can you edit this page?")})):(formatting=reqTypeFormatting,sendRequirementType({reqKey:selectionText,typeName:typeName=reqType,sourceCeoId:pageId,targetCeoId:ceoId,applyToAllSimilarOccurrences:typeName&&$transformAllSimilar.is(":checked")||!1,pattern:pattern,applyToAllSpace:$applyInSpace.is(":checked"),defineInline:!1,description:desc,formatting:formatting},(function(data){$content.find(".aui-spinner").addClass("hidden"),RY.showMessageBean("Transformation",data.messages),replaceReferences(pageId,data.replacements,formatting),RY.InlineCreationDialog.removeDialog()})))}return!1}));var requirementAlreadyExists=void 0;function loadTypes(refresh){$content.find("#req-type option[value != '']").remove(),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/types/"+encodeURIComponent(AJS.Meta.get("space-key"))+"?"+$.param({refresh:refresh}),type:"GET",contentType:"application/json; charset=utf-8"}).done((function(data){if(!requirementAlreadyExists){var $reqType=$content.find("#req-type"),$reqTypeLastItem=$content.find("#req-type option:last");!0;for(var match=null,uniqueKeys=[],duplicateKeys=[],i=0;i<data.length;i++){var itemName=data[i].name;-1!=uniqueKeys.indexOf(itemName)?duplicateKeys.push(itemName):uniqueKeys.push(itemName)}for(i=0;i<data.length;i++){var item=data[i],text=item.name;-1!=duplicateKeys.indexOf(item.name)&&(text+=" on "+item.ceoTitle),$("<option>",{value:item.name,"data-ceoid":item.ceoId,"data-formatting":item.formatting,text:text}).insertBefore($reqTypeLastItem),-1!=selectionText.indexOf(item.name)&&typeKeySeparator.test(selectionText.charAt(item.name.length))&&(match=item.name)}match?$reqType.val(match).change():updateSuggestions(),$reqType.focus()}})).always((function(){$content.find("#req-type-loading").remove()}))}loadTypes(!1),$.ajax({url:AJS.contextPath()+"/rest/reqs/1/requirement2/"+encodeURIComponent(AJS.Meta.get("space-key"))+"/"+encodeURIComponent(selectionText),type:"GET",contentType:"application/json; charset=utf-8"}).done((function(data){requirementAlreadyExists=!0,$content.find(".dialog-content").html(PlaySQL.Requirements.inlineActionFormForDuplicates({contextPath:AJS.contextPath(),requirement:data})).removeClass("hidden")})).fail((function(){requirementAlreadyExists=!1,$content.find(".dialog-content").removeClass("hidden")})).always((function(){$content.find("#req-type-loading").remove()}))}),0);var $el}(),!1}))}else AJS.flag({type:"error",title:"Alt + Shift + R lets you create requirements.",body:"You must select a requirement key first (such as REQ_001)."})},transformInline:function(){var sel=window.getSelection();if(!sel)throw"No selection in current window.";var range=sel.getRangeAt(0);if(!range)throw"No selection range in current window.";if(range.collapsed)throw"Selection is empty. Can't create a requirement.";var selectionObject=Confluence.HighlightAction.RangeHelper.getRangeOption(range);if(0!=$(range.startContainer).closest("#main-content").size()&&0!=$(range.endContainer).closest("#main-content").size()){var temp=Confluence.HighlightAction.RangeHelper.getUserSelectionRange;Confluence.HighlightAction.RangeHelper.getUserSelectionRange=function(){return!1},window.setTimeout((function(){Confluence.HighlightAction.RangeHelper.getUserSelectionRange=temp}),1500),this.showCreateReqDialog(selectionObject)}},dialog:void 0,removeDialog:function(){RY.InlineCreationDialog.dialog&&RY.InlineCreationDialog.dialog.remove(),$("#inline-dialog-create-requirement-yogi-dialog").remove(),RY.InlineCreationDialog.dialog=void 0}}}(AJS.$)},8049:function(){AJS.$((function($){var $tooltipables=$(".ry-tooltipable");$tooltipables.tooltip&&($tooltipables.tooltip({delayIn:0}),$(".ry-tooltipable-html").tooltip({delayIn:0,html:!0}))}))},6828:function(){function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}window.RY=window.RY||{};var RY=window.RY;RY.ellipse=function(message,length){return void 0===length&&(length=300),message&&message.length>length+10&&(message=message.substring(0,length)+"…"),message},RY.extractMessageFromXHR=function(jqXHR,length){var html=jqXHR.status+"-"+jqXHR.statusText;if(jqXHR.responseText){var text=jqXHR.responseText,position=text.indexOf("<message>");-1!==position&&(text=text.substr(position+"<message>".length));var indexOfTag=text.indexOf("<h3>Cause</h3>");-1!==indexOfTag&&(text=(text=(text=text.substr(indexOfTag)).replace(/<.*?>/g,"")).replace(/\s+/g," "));var errorFixAction=null,errorFixUrl=null;if("{"===text.charAt(0)||"["===text.charAt(0))try{var json=JSON.parse(text);if(json){if(json.errors&&json.errors.length>0){text="";var _step,_iterator=_createForOfIteratorHelper(json.errors);try{for(_iterator.s();!(_step=_iterator.n()).done;){var jiraError=_step.value;jiraError.applicationName&&jiraError.message?text+=jiraError.message+" (for "+jiraError.applicationName+" at "+jiraError.applicationUrl+")":text+=jiraError}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else json.message&&(text=json.message);errorFixUrl=json.errorFixUrl,errorFixAction=json.errorFixAction}}catch(err){}html+=": "+AJS.escapeHtml(RY.ellipse(text,300)),errorFixUrl&&(html+='<p><a href="'+AJS.escapeHtml(errorFixUrl)+'">'+(AJS.escapeHtml(errorFixAction)||"Click here to fix")+"</a></p>")}return html},RY.createXHRErrorHandler=function(message,onlyIfOAuthError){return function(jqXHR){(!onlyIfOAuthError||jqXHR.responseText&&-1!==jqXHR.responseText.toLowerCase().indexOf("oauth"))&&AJS.flag({type:"error",title:message,body:RY.extractMessageFromXHR(jqXHR,300)})}},RY.displayApplinkError=function(title,json){if(json.error){var html=json.error;json.errorFixUrl&&(html+='<br><a href="'+AJS.escapeHtml(json.errorFixUrl)+'">'+AJS.escapeHtml(json.errorFixAction||"Authenticate")+"</a>"),AJS.flag({type:"error",title:title,body:html})}},RY.bindFirst=function(event,handlerFn,$jQueryObject){if("string"!=typeof event)throw"the first argument should be an event";if("function"!=typeof handlerFn)throw"the second argument should be an event handler";if(!($jQueryObject instanceof jQuery))throw"the third argument should be a jQuery Object";$jQueryObject.on(event,handlerFn);var handlers=$("body").data("events")[event.split(".")[0]],handler=handlers.pop();handlers.splice(0,0,handler)},RY.getApplinks=function(callback){RY.getApplinks.cache?callback&&window.setTimeout((function(){callback(RY.getApplinks.cache)}),0):$.ajax({url:AJS.contextPath()+"/rest/jira-integration/1.0/servers",type:"GET",success:function(data){for(var jiraData=[],i=0;i<data.length;i++)jiraData.push({id:data[i].id,instance:data[i].name});RY.getApplinks.cache=jiraData,callback&&callback(jiraData)},error:RY.createXHRErrorHandler("Error getting the Jira applinks from the server")})},RY.decodeURIComponent=function(paramValue){var encodedWithoutPlus=(paramValue||"").replace(/\+/g," ");return decodeURIComponent(encodedWithoutPlus)},RY.decodedQueryParam=function(param,uri){var paramValue=uri.queryKey[param];return RY.decodeURIComponent(paramValue)},RY.btoa=function(text){var utf8Text=encodeURIComponent(text).replace(/%([0-9A-F]{2})/g,(function(match,p1){return String.fromCharCode("0x"+p1)}));return btoa(utf8Text)},RY.atob=function(base64EncodedUnicodeString){var percentEncodedText=atob(base64EncodedUnicodeString).split("").map((function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)})).join("");return decodeURIComponent(percentEncodedText)},RY.encodeMacroParam=function(param){return null==param?param:encodeURIComponent(param)},RY.decodeMacroParam=function(param){return null==param?param:decodeURIComponent(param)},RY.forEachInMessageBean=function(messages,callback){if(messages){if(messages.success){var _step2,_iterator2=_createForOfIteratorHelper(messages.success);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){callback("success",_step2.value)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}if(messages.info){var _step3,_iterator3=_createForOfIteratorHelper(messages.info);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){callback("info",_step3.value)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}if(messages.warnings){var _step4,_iterator4=_createForOfIteratorHelper(messages.warnings);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){callback("warning",_step4.value)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}if(messages.errors){var _step5,_iterator5=_createForOfIteratorHelper(messages.errors);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){callback("error",_step5.value)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}}},RY.showMessageBean=function(title,messages){RY.forEachInMessageBean(messages,(function(type,messageText){AJS.flag({type:type,title:title,body:AJS.escapeHtml(messageText)})}))},RY.htmlBuilder=function(element,attributes){function parseChildren(parent,attributes){if("string"==typeof attributes)parent.insertAdjacentHTML("beforeend",attributes);else if(attributes instanceof Element)parent.appendChild(attributes);else{if(!(attributes instanceof Array))throw"Unrecognized html element: "+JSON.stringify(attributes);var _step6,_iterator6=_createForOfIteratorHelper(attributes);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){parseChildren(parent,_step6.value)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}}var el=document.createElement(element);if(attributes instanceof Array)parseChildren(el,attributes);else if(attributes instanceof Element)el.appendChild(attributes);else if("string"==typeof attributes)el.innerHTML=attributes;else if(attributes instanceof Object)for(var _i=0,_Object$keys=Object.keys(attributes);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];"html"==key?parseChildren(el,attributes[key]):"text"==key?el.appendChild(document.createTextNode(attributes[key])):el.setAttribute(key,attributes[key])}return el},String.prototype.startsWith||(String.prototype.startsWith=function(search,startingAt){return this.substr(startingAt||0,search.length)===search}),String.prototype.endsWith||(String.prototype.endsWith=function(search,startingAt){return startingAt<this.length?startingAt|=0:startingAt=this.length,this.substr(startingAt-search.length,search.length)===search}),RY.renderTestResultsToEmoji=function(tests){for(var _i2=0,_Object$keys2=Object.keys(tests);_i2<_Object$keys2.length;_i2++){var _step7,_iterator7=_createForOfIteratorHelper(tests[_Object$keys2[_i2]]);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var testRef=_step7.value;testRef.result&&(RY.replaceEmojis?(testRef.resultRendered=RY.replaceEmojis(testRef.result)||null,testRef.resultEmojiOnly=RY.extractEmojiOnly&&RY.extractEmojiOnly(testRef.result)):testRef.resultRendered=testRef.result)}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}},RY.isEmptyObj=function(obj){return!(Object.keys(obj).length>0)&&JSON.stringify(obj)===JSON.stringify({})},RY.parseJSONSafe=function(value,defaultValue){if(!value)return defaultValue||null;try{return JSON.parse(value)}catch(e){return defaultValue||null}},RY.getUncheckedRequirements=function(queryString){var $checkboxes=$(".checkbox-requirement:not(:checked)");if(0===$checkboxes.length)return queryString;var result=queryString?"("+queryString+")":"";return $checkboxes.each((function(){var key=$(this).data("requirement-key");key&&-1==key.toString().indexOf("'")&&(result&&(result+=" AND "),result+="NOT key = '"+key+"'")})),result},RY.parseUrl=function(url){var urlToParse=url;0===urlToParse.indexOf("?")&&(urlToParse=urlToParse.substring(1));for(var queryString={},variables=urlToParse.split("&"),i=0;i<variables.length;i++)if(-1!==variables[i].indexOf("=")){var pair=variables[i].split("=");if(pair.length>1){var key=decodeURIComponent(pair[0]),value=decodeURIComponent(pair[1].replace(/\+/g,"%20"));void 0===queryString[key]?queryString[key]=value:"string"==typeof queryString[key]?queryString[key]=[queryString[key],value]:queryString[key].push(value)}}return queryString},RY.rebuildUrl=function(url,newParams){var params=RY.parseUrl(url);return params=Object.assign(params,newParams),"?"+RY.param(params)},RY.ajax=function(options){return new Promise((function(resolve,reject){$.ajax(options).done(resolve).fail(reject)}))},RY.quoteSearchTerm=function(term){return"'"+term.replace(/([\\'])/g,"\\$1")+"'"},RY.param=function(params){if(!params)return"";for(var keys=Object.keys(params),i=0;i<keys.length;i++){var param1=params[keys[i]];null==param1&&delete params[keys[i]]}return $.param(params)},RY.escapeForSearch=function(term){return term.replace(/([^a-zA-Z0-9&_\u00C0-\uFFEF])/g,"\\$1")},RY.isInt=function(str){var value=parseFloat(str);return!isNaN(value)&&Number.isInteger(value)}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}!function(){"use strict";__webpack_require__(6095);function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var RequirementCache={contents:{},get:function(spaceKey,reqKey,baseline){return RequirementCache.contents[spaceKey+","+reqKey+","+baseline]},put:function(spaceKey,reqKey,baseline,requirement){RequirementCache.contents[spaceKey+","+reqKey+","+baseline]=requirement},clear:function(){RequirementCache.contents={}}},IssueCache={listPerApplink:{},fetchIssueStatus:function(applink,issueKeys,callback){var cache=IssueCache.listPerApplink[applink];cache||(cache=IssueCache.listPerApplink[applink]=[]);var _step,issuesToFetch=[],_iterator=_createForOfIteratorHelper(issueKeys);try{for(_iterator.s();!(_step=_iterator.n()).done;){var issueKey=_step.value,cachedValue=cache[issueKey];cachedValue?callback(applink,cachedValue):issuesToFetch.push(issueKey)}}catch(err){_iterator.e(err)}finally{_iterator.f()}issuesToFetch.length>0&&$.ajax({url:AJS.contextPath()+"/rest/reqs/1/integration/"+encodeURIComponent(applink)+"/jira/issues?"+AJS.$.param({issues:issuesToFetch}),type:"GET",contentType:"application/json; charset=utf-8",success:function(list){var _step2,_iterator2=_createForOfIteratorHelper(list);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var item=_step2.value,issueKey=item.key;cache[issueKey]=item,callback(applink,item)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}},error:RY.createXHRErrorHandler("Error while retrieving the status of Jira issues.",!0)})}};RY&&(RY.RequirementCache=RequirementCache,RY.IssueCache=IssueCache);var requirement_view_lozenge_manager_RY=window.RY=window.RY||{};function requirement_view_excerpt_extractor_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return requirement_view_excerpt_extractor_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return requirement_view_excerpt_extractor_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function requirement_view_excerpt_extractor_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}requirement_view_lozenge_manager_RY.LozengeManager={updateDefinitions:function(requirementList){var pageId=AJS.Confluence.getContentId(),currentSpaceKey=AJS.Meta.get("space-key"),$allMacros=$(".requirement-macro, .requirement-link-macro");requirementList.forEach((function(requirement){var key=requirement.key,spaceKey=requirement.spaceKey,baseline="baseline"in requirement?requirement.baseline:"";requirement_view_lozenge_manager_RY.RequirementREST.formatRequirementDetails(requirement,pageId),requirement.htmlNeedsUpdating||RequirementCache.put(spaceKey,key,baseline,requirement);var $macros=$allMacros.filter((function(){var $this=$(this);return $this.attr("data-requirement-key")===key&&(($this.attr("data-space-key")||currentSpaceKey)===spaceKey&&$this.attr("data-baseline")===requirement.baseline)}));requirement.duplicateOriginalPages?$macros.addClass("ry-error-important"):"DELETED"===requirement.status?window.Scroll&&window.Scroll.Versions&&window.Scroll.Versions.Context&&window.Scroll.Versions.Context.page?window.Scroll.Versions.Context.page.isMasterPage?$macros.addClass("ry-error").attr("data-error-message","The requirement was deleted."):$macros.addClass("ry-error").attr("data-error-message",'The requirement doesn\'t exist. Since you are using Scroll Versions, check that the page of the requirement is published, since only requirements on "published" pages are indexed. <br><p>The requirement may also have been deleted.</p>'):$macros.addClass("ry-error").attr("data-error-message","The requirement was deleted."):"MOVED"===requirement.status?$macros.addClass("ry-error").attr("data-error-message","The requirement was moved to the space '"+requirement.newSpaceKey+"'. Please edit the page to update the macro."):"ACTIVE"!==requirement.status&&"ARCHIVED"!==requirement.status?$macros.addClass("ry-error").attr("data-error-message","The requirement is in an unknown status: "+requirement.status+"."):($macros.removeClass("ry-error ry-error-important"),requirement.formattingCss&&$macros.attr("style",requirement.formattingCss),requirement.formattingNoBorder&&$macros.removeClass("aui-label"),requirement.htmlNeedsUpdating&&$macros.addClass("requirement-needs-excerpt"),$macros.each((function(){var $macro=$(this),fields=$macro.attr("data-body-fields");if(fields){var html=null;fields.split(",").forEach((function(property){var value=null;if("description"==(property=property.trim()))value=requirement.htmlExcerpt;else if("@"==property.charAt(0))for(var propertyName=property.substr(1),i=0;i<requirement.properties.length;i++)if(requirement.properties[i].key==propertyName){value=requirement.properties[i].value;break}null!=value&&(null==html?html=value:html+=" - "+value)})),$macro.after(' <span class="requirement-link-macro-description">'+html+"</span>")}}))),$macros.addClass("resolved")}))}};var requirement_view_excerpt_extractor_RY=window.RY=window.RY||{};AJS.$((function($){var countDown=40,generalDependencies=[];function updateBylinePopup(result){$(".ry-see-extraction-messages").removeClass("hidden"),!0===result?$(".ry-see-extraction-messages").prepend('<span class="aui-icon aui-icon-small aui-iconfont-success">Saved successfully</span>&nbsp;'):!1===result&&$(".ry-see-extraction-messages").prepend('<span class="aui-icon aui-icon-small aui-iconfont-error">Failed</span>&nbsp;')}requirement_view_excerpt_extractor_RY.extractAndSendRequirements=function(force,$elements,callbackSuccess,callbackError){if("READ_ONLY"===AJS.Meta.get("access-mode")&&callbackError&&callbackError("Requirements can't be updated in read-only mode"),$(".jira-issue .issue-placeholder").size()>0&&countDown-- >0)return window.setTimeout((function(){requirement_view_excerpt_extractor_RY.extractAndSendRequirements(force,$elements,callbackSuccess,callbackError)}),500),"Jira issues are not loaded yet";try{requirement_view_excerpt_extractor_RY.extractionMessages="",updateBylinePopup();var loggingLastTable,spaceKey=AJS.Meta.get("space-key"),excerpts=[];if($elements||($elements=$(force?".requirement-macro:not(.ry-error)":".requirement-macro.requirement-needs-excerpt:not(.ry-error)")),requirement_view_excerpt_extractor_RY.isDebug&&console&&(console.clear&&console.clear(),AJS.log("=== Beginning of Requirement Yogi - RY.isDebug=true; RY.extractAndSendRequirements(true);")),generalDependencies=[],$elements.each((function(){var $macro=$(this),key=$macro.attr("data-requirement-key"),baseline=$macro.attr("data-requirement-baseline"),spaceKey2=$macro.attr("data-space-key");if(key&&!baseline&&(!spaceKey2||spaceKey2==spaceKey)&&1!==$macro.closest("td.fake, th.fake").size()){requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("RY Creating excerpt of:",$macro);var excerpt=null,excerptTable=function($macro,key){var $tr=$macro.closest("tr");if(0==$tr.size())return null;var ignoreAllColumnsByDefault=$(".requirement-property-macro.whole-doc.ignore-by-default").size()>0,ignoreAllColumnsByDefaultForDependencies=$(".requirement-property-macro.whole-doc.ignore-dependencies-by-default").size()>0,$table=$tr.closest("table"),$headerRow=$table.find("tr").first();if(2===$headerRow.children().size()&&1===$headerRow.children("td").size()&&1===$headerRow.children("th").size()&&$table.children("tbody").children("tr").size()>2)return function($macro,key,ignoreAllColumnsByDefault,ignoreAllColumnsByDefaultForDependencies){var result={};return $macro.closest("table").find("> tbody > tr").each((function(){var $tds=$(this).children();2==$tds.size()&&addContentsToColumnInResult($tds.eq(1),$tds.eq(0),result,key,ignoreAllColumnsByDefault,ignoreAllColumnsByDefaultForDependencies)})),generalDependencies.splice(0,1/0,{relationship:"parent",spaceKey:AJS.Meta.get("space-key"),key:key,baseline:null}),result}($macro,key,ignoreAllColumnsByDefault,ignoreAllColumnsByDefaultForDependencies);var isFirstRowUsedForTitles=$headerRow.find("> th").size()>0&&0===$headerRow.find("> td").size();if(!isFirstRowUsedForTitles&&!flagWasDisplayed){flagWasDisplayed=!0,requirement_view_excerpt_extractor_RY.isDebug?AJS.log("RY isFirstRowUsedForTitles:",isFirstRowUsedForTitles,"'> * > tr:first-child > th'="+$table.find("> * > tr:first-child > th").size(),"'> td, > th'="+$tr.find("> td, > th").size()):AJS.log("Requirement Yogi: The first row is not used for titles. Type the following command to get more details: RY.isDebug = true; RY.extractAndSendRequirements(true);");var $tdsInHeaders=$table.find("> *:first-child > tr:first-child > td");if($tdsInHeaders.size()>0&&$tdsInHeaders.find(".requirement-property-macro").size()>0){var $tdsWithGrayHeader=$tdsInHeaders.filter("[data-highlight-colour='grey']"),fullRow=requirement_view_excerpt_extractor_RY.ellipse($tr.text(),80);AJS.flag({type:"info",title:"Requirement Yogi",close:"manual",body:"The requirements were successfully seen on the page, but the header row of the table wasn't used"+($tdsWithGrayHeader.size()>0?" (even though "+$tdsWithGrayHeader.size()+" of them are grey)":"")+'. If you need to include it, edit the page and click "Header row". Excerpt: <i>'+AJS.escapeHtml(fullRow||"")+"</i>"})}}var result={};return function($macro,isFirstRowUsedForTitles,callback){var headers=[];isFirstRowUsedForTitles&&$macro.closest("table").find("tr").first().children("th:not(.fake)").each((function(){for(var $this=$(this),headerColspan=$this.attr("colSpan")||1,i=0;i<headerColspan;i++)headers.push($this)}));var $cell=$macro.closest("td, th"),rowspan=parseInt($cell.attr("rowSpan"))||1,table=function($tr,rowspan){for(var table=[],actualRowSpan=rowspan,$lastTr=$tr,i=1;i<rowspan;i++){var $next=$lastTr.next();$next.size()>0?$lastTr=$next:actualRowSpan--}var $trs=$lastTr.prevAll().add($lastTr);if($trs.each((function(){return table.push([])})),$trs.each((function(x,tr){$(tr).children(":not(.fake)").each((function(j,td){for(var $td=$(td),colspan=parseInt($td.attr("colSpan"))||1,rowspan=parseInt($td.attr("rowSpan"))||1,y=j;table[x][y];)y++;for(var row=x;row<x+rowspan&&row<table.length;row++)for(var col=y;col<y+colspan;col++)table[row][col]=td}))})),table.length<actualRowSpan)throw"Rowspan is ".concat(rowspan," but the table only has ").concat($trs.size()," rows, and the resulting matrix, ").concat(table.legnth,".");return table.slice(table.length-actualRowSpan)}($macro.closest("tr"),rowspan);if(table.length<1)throw"The macro couldn't be found in its parent table.";for(var alreadyProcessed=[],row=0;row<table.length;row++)for(var cells=table[row],i=0;i<cells.length;i++){var cell=cells[i];if(-1==alreadyProcessed.indexOf(cell)){alreadyProcessed.push(cell);var $header=isFirstRowUsedForTitles&&headers[i]||$();callback($(cell),$header)}}}($macro,isFirstRowUsedForTitles,(function($cell,$header){addContentsToColumnInResult($cell,$header,result,key,ignoreAllColumnsByDefault,ignoreAllColumnsByDefaultForDependencies)})),result}($macro,key),$h=$macro.closest("h1, h2, h3, h4, h5, h6"),$td=$macro.closest("td, th"),$p=$macro.closest("p"),$li=$macro.closest("li"),$other=$macro.parent(),properties=[],dependencies=generalDependencies.slice(),loggingCurrentTable=$macro.closest("table")[0]||$macro.closest("h1, h2, h3, h4, h5, h6, p, ul, ol")[0],loggingActivated=force||loggingLastTable!=loggingCurrentTable;if(loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\nSection starting with '"+key+"': ",loggingLastTable=loggingCurrentTable),null!=excerptTable){for(var fieldExcerpt,allNonIgnoredText=[],allText=[],titleExcerpt=[],_i=0,_Object$keys=Object.keys(excerptTable);_i<_Object$keys.length;_i++){var field=_Object$keys[_i],isExplicitlyIncluded=0==(fieldExcerpt=excerptTable[field]).ignore&&fieldExcerpt.text,isExplicitlyExcluded=1==fieldExcerpt.ignore,hasInterestingText=fieldExcerpt.text&&fieldExcerpt.text!=key,hasInterestingKey=!!field;fieldExcerpt.useAsTitle&&titleExcerpt.push(fieldExcerpt.text),fieldExcerpt.definedInMacro||((isExplicitlyIncluded||!isExplicitlyExcluded&&hasInterestingText)&&allNonIgnoredText.push(fieldExcerpt.text),hasInterestingText&&allText.push(fieldExcerpt.text)),isExplicitlyIncluded||!isExplicitlyExcluded&&hasInterestingKey&&hasInterestingText?(properties.push({type:"INLINE",key:field,value:fieldExcerpt.text,indexation:fieldExcerpt.indexation}),loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tProperty '"+field+"' included.")):loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tProperty '"+field+"' not included, because ",requirement_view_excerpt_extractor_RY.extractionMessages+=isExplicitlyExcluded?"it is explicitly excluded by RY Property macro.":hasInterestingKey?hasInterestingText?"2. An unknown reason":"the text is empty.":"the field name is too small."),!fieldExcerpt.ignoreDependencies&&fieldExcerpt.dependencies?(loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\t"+fieldExcerpt.dependencies.length+" dependencies in "+field),dependencies=dependencies.concat(fieldExcerpt.dependencies)):loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tDependencies with relationship='"+field+"' not included, because ",fieldExcerpt.ignoreDependencies?requirement_view_excerpt_extractor_RY.extractionMessages+="they're marked as ignored by the RY Property macro.":fieldExcerpt.dependencies?requirement_view_excerpt_extractor_RY.extractionMessages+="2. An unknown reason":requirement_view_excerpt_extractor_RY.extractionMessages+="2. There are no dependencies in this cell")}titleExcerpt.length?(excerpt=titleExcerpt.join(" - "),propertyExcerpter(properties,$macro.closest("tr")),loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tTitle: joining "+titleExcerpt.length+" texts designated by the RY Property macro.")):allNonIgnoredText.length?(excerpt=allNonIgnoredText.join(" - "),propertyExcerpter(properties,$macro.closest("tr")),loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tTitle: joining "+allNonIgnoredText.length+" texts.")):allText.length&&(excerpt=allText.join(" - "),propertyExcerpter(properties,$macro.closest("tr")),loggingActivated&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tTitle: joining "+allText.length+" texts."))}if(null==excerpt&&$h.length>0){var $wholeParagraph=function($h){var filter,$block=$("<div>"),before=!0,after=!1;switch($h[0].nodeName){case"H1":filter="h1";break;case"H2":filter="h1, h2";break;case"H3":filter="h1, h2, h3";break;case"H4":filter="h1, h2, h3, h4";break;case"H5":filter="h1, h2, h3, h4, h5";break;case"H6":filter="h1, h2, h3, h4, h5, h6";break;default:return $h}return $h.parent().children().each((function(){var $this=$(this);$this.is($h)?before=!1:!before&&$this.is(filter)&&(after=!0),before||after||$block.append($this.clone())})),$block}($h);excerpt=excerpter($wholeParagraph,key),propertyExcerpter(properties,$wholeParagraph),loggingActivated&&excerpt&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tAdded 1 text and "+properties.length+" properties from a <"+$h[0].nodeName+"> element.")}for(null==excerpt&&$td.length>0&&(excerpt=excerpter($td.next(),key),propertyExcerpter(properties,$td.next()),loggingActivated&&excerpt&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tAdded 1 text and "+properties.length+" properties from a <"+$td[0].nodeName+"> element.")),null==excerpt&&$p.length>0&&(excerpt=excerpter($p,key),propertyExcerpter(properties,$p),loggingActivated&&excerpt&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tAdded 1 text and "+properties.length+" properties from a <"+$p[0].nodeName+"> element.")),null==excerpt&&$li.length>0&&(excerpt=excerpter($li,key),propertyExcerpter(properties,$li),loggingActivated&&excerpt&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tAdded 1 text and "+properties.length+" properties from a <"+$li[0].nodeName+"> element.")),null==excerpt&&$other.length>0&&(excerpt=excerpter($other,key),propertyExcerpter(properties,$other),loggingActivated&&excerpt&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\n\tAdded 1 text and "+properties.length+" properties from the parent <"+$other[0].nodeName+">.")),excerpt=$.trim(excerpt||"");excerpt.startsWith("<br>")||excerpt.startsWith("<br/>");)excerpt=excerpt.startsWith("<br>")?excerpt.substr(4):excerpt.substr(5),excerpt=$.trim(excerpt);var params={key:key,spaceKey:AJS.Meta.get("space-key"),htmlExcerpt:excerpt,properties:properties,dependencies:dependencies};excerpts.push(params)}})),excerpts.length>0){requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("Sending excerpts among "+$(".requirement-macro").size()+" .requirement-macro (including "+$(".requirement-macro.requirement-needs-excerpt").size()+" needing an excerpt and force="+force+"): "+JSON.stringify(excerpts)),requirement_view_excerpt_extractor_RY.extractionMessages+="\n"+excerpts.length+" excerpts sent to server.";var url=AJS.contextPath()+"/rest/reqs/1/requirement2/"+encodeURIComponent(AJS.Meta.get("space-key"));$.ajax({url:url,type:"PUT",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(excerpts)}).done((function(data){requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("RY: Success"),requirement_view_excerpt_extractor_RY.RequirementCache.clear(),requirement_view_excerpt_extractor_RY.LozengeManager.updateDefinitions(data),requirement_view_excerpt_extractor_RY.extractionMessages+="\nServer answered successfully.",requirement_view_excerpt_extractor_RY.reindexationSuccess=!0,updateBylinePopup(!0),callbackSuccess&&callbackSuccess(requirement_view_excerpt_extractor_RY.extractionMessages)})).fail((function(jqXHR){var failureMessage="PUT "+url+" returns "+jqXHR.status+"-"+jqXHR.statusText+": "+jqXHR.responseText;AJS.flag({type:"error",title:"The requirements couldn't be reindexed for Requirement Yogi.",close:"manual",body:AJS.escapeHtml(requirement_view_excerpt_extractor_RY.ellipse(failureMessage,300))}),AJS.error("RY: Failure "+failureMessage),requirement_view_excerpt_extractor_RY.extractionMessages+="\n"+failureMessage,requirement_view_excerpt_extractor_RY.reindexationSuccess=!1,requirement_view_excerpt_extractor_RY.reindexationMessage=requirement_view_excerpt_extractor_RY.ellipse("Could not save requirements: "+failureMessage,120),updateBylinePopup(!1),callbackError&&callbackError(requirement_view_excerpt_extractor_RY.reindexationMessage)}))}else $elements.size()>0&&(requirement_view_excerpt_extractor_RY.extractionMessages+="\nNo excerpt sent to server."),requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("No excerpt found among "+$(".requirement-macro").size()+" .requirement-macro (including "+$(".requirement-macro.requirement-needs-excerpt").size()+" needing an excerpt and force="+force+")"),requirement_view_excerpt_extractor_RY.reindexationSuccess=!1,requirement_view_excerpt_extractor_RY.reindexationMessage=$(".requirement-macro").size()+" requirements on the page, 0 definitions to reindex.",updateBylinePopup(),callbackError&&callbackError(requirement_view_excerpt_extractor_RY.reindexationMessage)}catch(err){try{console.trace("RY Error: ",err)}catch(err2){}AJS.log("RY Error: ",err),AJS.error(err),requirement_view_excerpt_extractor_RY.reindexationSuccess=!1,requirement_view_excerpt_extractor_RY.reindexationMessage=""+err,requirement_view_excerpt_extractor_RY.extractionMessages+="\n\nException: "+err+"\nRequirements not saved.",updateBylinePopup(!1),callbackError&&callbackError(requirement_view_excerpt_extractor_RY.reindexationMessage)}return requirement_view_excerpt_extractor_RY.extractionMessages};var flagWasDisplayed=!1;function addContentsToColumnInResult($element,$header,result,key,ignoreAllColumnsByDefault,ignoreAllColumnsByDefaultForDependencies){var options={columnTitle:$.trim($header.text()).substr(0,200),useAsTitle:!1,mandatory:!1,ignore:!!ignoreAllColumnsByDefault||void 0,ignoreDependencies:!!ignoreAllColumnsByDefaultForDependencies||void 0},preparedElement=prepareHtmlForExcerpt($element),excerpt=excerpterForDisplayHtml(preparedElement,key),indexation=function($clone){if(!$clone)return null;$clone.find(".jira-issue").each((function(){var $this=$(this);$this.text($this.find(".jira-issue-key").text())}));var isList=!1,$lis=$clone.find("li");$lis.size()>0&&($lis.before("CONST1_CR"),isList=!0);var userMentions=[];$clone.find(".user-mention").each((function(){var username=$(this).attr("data-username");username&&-1==userMentions.indexOf(username)&&userMentions.push(username)})),$clone.find(".emoticon").each((function(){var _step,$img=$(this),_iterator=requirement_view_excerpt_extractor_createForOfIteratorHelper($img.attr("class").split(" "));try{for(_iterator.s();!(_step=_iterator.n()).done;){switch(_step.value){case"emoticon-smile":$img.text(":)");break;case"emoticon-sad":$img.text(":(");break;case"emoticon-cheeky":$img.text(":P");break;case"emoticon-laugh":$img.text(":D");break;case"emoticon-wink":$img.text(";)");break;case"emoticon-thumbs-up":$img.text("(y)");break;case"emoticon-thumbs-down":$img.text("(n)");break;case"emoticon-light-on":$img.text("(on)");break;case"emoticon-light-off":$img.text("(off)");break;case"emoticon-warning":$img.text("(!)");break;case"emoticon-yellow-star":$img.text("(*)");break;case"emoticon-red-star":$img.text("(*r)");break;case"emoticon-green-star":$img.text("(*g)");break;case"emoticon-blue-star":$img.text("(*b)");break;case"emoticon-tick":$img.text("(/)");break;case"emoticon-cross":$img.text("(x)");break;case"emoticon-information":$img.text("(i)");break;case"emoticon-plus":$img.text("(+)");break;case"emoticon-minus":$img.text("(-)");break;case"emoticon-question":$img.text("(?)");break;case"emoticon-heart":$img.text("<3");break;case"emoticon-broken-heart":$img.text("</3")}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}));var indexation,result=$clone.text().trim();result=(result=result.replace(/(^CONST1_CR|CONST1_CR$)/g,"").trim()).replace(/CONST1_CR\s*CONST1_CR/g,"CONST1_CR"),indexation=isList||-1!=result.indexOf("CONST1_CR")?{multivalues:result.split("CONST1_CR").map((function(item){return item.trim()}))}:{text:result.trim()};userMentions.length>0&&(indexation.userMentions=userMentions);return indexation}(preparedElement);readRYPropertyMacros($element,result,options),readRYPropertyMacros($header,result,options);var columnTitle=options.columnTitle,record=result[columnTitle]=result[columnTitle]||{};record.text&&record.text.trim()?excerpt.trim()&&(record.text+=" - "+excerpt):/^(\n*\s*\<br>\n*\s*)+$/.test(excerpt)?record.text="":record.text=excerpt,record.indexation=function(indexation1,indexation2){if(!indexation2)return indexation1;if(!indexation1)return indexation2;var result,multivalues=[],userMentions=[];indexation1.multivalues&&(multivalues=multivalues.concat(indexation1.multivalues));indexation2.multivalues&&(multivalues=multivalues.concat(indexation2.multivalues));indexation1.text&&indexation1.text.trim()&&multivalues.push(indexation1.text);indexation2.text&&indexation2.text.trim()&&multivalues.push(indexation2.text);result=multivalues.length>1?{multivalues:multivalues}:{text:multivalues[0]};indexation1.userMentions&&(userMentions=userMentions.concat(indexation1.userMentions));indexation2.userMentions&&(userMentions=userMentions.concat(indexation2.userMentions));userMentions.length>0&&(result.userMentions=userMentions);return result}(record.indexation,indexation),record.useAsTitle=record.useAsTitle||options.useAsTitle,record.ignore=record.ignore||options.ignore,record.ignoreDependencies=record.ignoreDependencies||options.ignoreDependencies,function($element,record,columnTitle){var dependencies=$element.find(".requirement-link-macro").map((function(){var $link=$(this),spaceKey=$link.attr("data-space-key")||AJS.Meta.get("space-key"),key=$link.attr("data-requirement-key"),baseline=parseInt($link.attr("data-requirement-baseline"))||null;return{relationship:columnTitle,spaceKey:spaceKey,key:key,baseline:baseline}})).toArray();record.dependencies=(record.dependencies||[]).concat(dependencies)}($element,record,columnTitle),requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("RY Finished with cell",record.text,record.useAsTitle,record.ignore,record.ignoreDependencies)}function readRYPropertyMacros($element,result,options){$element.find(".requirement-property-macro").each((function(){var $ryProperty=$(this),name=AJS.escapeHtml($ryProperty.attr("data-property")||""),value=AJS.escapeHtml($ryProperty.attr("data-value")||""),title="true"==$ryProperty.attr("data-title"),ryIgnore="true"==$ryProperty.attr("data-ignore"),ryIgnoreDependencies="true"==$ryProperty.attr("data-ignore-dependencies");name&&value?result[name]={text:value,useAsTitle:!1,ignore:!1,ignoreDependencies:!0,definedInMacro:!0}:(options.ignore=!1,name&&(options.columnTitle=AJS.escapeHtml(name),options.mandatory=!0),title&&(options.useAsTitle=!0),ryIgnore&&(options.ignore=!0),ryIgnoreDependencies&&(options.ignoreDependencies=!0)),requirement_view_excerpt_extractor_RY.isDebug&&AJS.log("RY property (name, value, title, ryIgnore, ryIgnoreDependencies): ",name,value,title,ryIgnore,ryIgnoreDependencies)}))}function excerpter($element,key){return 0==$element.length?null:excerpterForDisplayHtml(prepareHtmlForExcerpt($element),key)}function prepareHtmlForExcerpt($original){if(0==$original.length)return null;var $element=$original.clone();return function($element){$element.find(".select2-offscreen, .select2-display-none, script").remove(),$element.find(".select2-container-multi").each((function(){var $this=$(this);$this.find(".select2-search-field").remove(),$this.text($.trim($this.text().replace(/ +/g," ")))})),$element.find("select").each((function(){var $this=$(this),text=$.trim($this.find("option:selected").text());if(!text){var id=$this.attr("id");if(id){var $select=$(document.getElementById(id));$select.size()>0&&(text=$.trim($select.find("option:selected").text()))}}text&&$this.text(text)}))}($element),$element.find(".jira-issue").find(".aui-lozenge:last").remove(),$element.find(".requirement-macro").remove(),$element.find("p").before(" CONST1_CR"),$element.find("br").before(" CONST1_CR"),$element.find("tr").before(" CONST1_CR"),$element.find("td,th").before(" "),$element.find(".expand-content.expand-hidden").remove(),$element.find("time").each((function(){var $this=$(this),date=$(this).attr("datetime");$this.before(AJS.escapeHtml(date)),$this.remove()})),$element}function excerpterForDisplayHtml($element,key){if(!$element)return null;var $clone=$element.clone();$clone.find("a, img").each((function(){var prop=void 0;switch(this.nodeName){case"A":prop="href";break;case"IMG":prop="src";break;default:return}var url=this[prop];url&&this.setAttribute(prop,url)})),$clone.find("ul > li").before(" CONST1_CR-&nbsp;"),$clone.find("ol > li").each((function(){var $li=$(this),olNumber=$li.index()+1,depth=function($li){var depth=0,$parent=$li.closest("ol");for(;$parent.size()>0&&depth<10;)$parent=$parent.parent().closest("ol"),depth++;return depth}($li);depth%3==1||(depth%3==2?olNumber=String.fromCharCode(96+Math.min(Math.max(1,olNumber),26)):depth%3==0&&(olNumber=function(number){for(var numerals={x:10,ix:9,v:5,iv:4,i:1},roman="",_i2=0,_Object$keys2=Object.keys(numerals);_i2<_Object$keys2.length;_i2++)for(var _key=_Object$keys2[_i2];number>=numerals[_key];)roman+=_key,number-=numerals[_key];return roman}(olNumber))),$li.before(" CONST1_CR"+olNumber+".&nbsp;")}));var result=$.trim(cleanHtml($clone[0],{A:{mode:"html",attributes:["href"]},IMG:{mode:"html",attributes:["src","width","height","style","class"]},STRONG:{mode:"html"},EM:{mode:"html"},U:{mode:"html"},S:{mode:"html"},SUB:{mode:"html"},SUP:{mode:"html"},CODE:{mode:"html"},SPAN:{mode:"html",attributes:["style","class"],suppressNodeIfNoAttribute:!0},"*":{mode:"text"}}));return function(value,key){if(!value)return!1;if(!key)return!1;return new RegExp("^(\\s*CONST1_CR)*"+key+"(?!\\S)","g").test(value)}(result,key)&&(result=result.replace(key,"").trim()),result=(result=(result=result.replace(/(^CONST1_CR|CONST1_CR$)/g,"").trim()).replace(/CONST1_CR\s*CONST1_CR/g,"CONST1_CR")).replace(/CONST1_CR/g,"<br>\n")}function cleanHtml(element,filter){if(!element)return"";var node,nodeType=element.nodeType,nodeName=element.nodeName,ret="";if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){var filterInfo=filter[nodeName]||filter["*"];if(filterInfo)if("html"==filterInfo.mode){if(filterInfo.suppressNodeIfNoAttribute&&filterInfo.attributes){for(var attrs=element.attributes,suppress=!0,i=0;i<attrs.length;i++){var attrName=attrs[i].name,attrValue=attrs[i].value;if(-1!=filterInfo.attributes.indexOf(attrName)&&$.trim(attrValue)){suppress=!1;break}}if(suppress)return ret+=cleanHtml(element.childNodes,filter)}ret+="<"+nodeName.toLowerCase();for(attrs=element.attributes,i=0;i<attrs.length;i++){attrName=attrs[i].name,attrValue=attrs[i].value;filterInfo.attributes&&-1==filterInfo.attributes.indexOf(attrName)||(ret+=" "+attrName+'="'+AJS.escapeHtml(attrValue||"")+'"')}ret+=">",ret+=cleanHtml(element.childNodes,filter),ret+="</"+nodeName.toLowerCase()+">"}else for(i=0;node=element.childNodes[i];i++)ret+=cleanHtml(node,filter)}else if(3===nodeType||4===nodeType)return AJS.escapeHtml(element.nodeValue||"")}else for(i=0;node=element[i];i++)ret+=cleanHtml(node,filter);return ret}function propertyExcerpter(properties,$element){$element&&$element.find(".requirement-property-macro").add($(".requirement-property-macro.whole-doc")).each((function(){var $ryProperty=$(this),property=$.trim($ryProperty.attr("data-property")),value=$.trim($ryProperty.attr("data-value"));property&&value&&properties.push({type:"INLINE",key:AJS.escapeHtml(property||""),value:AJS.escapeHtml(value||"")})}))}var $dropdowns,forceExtractionAgain=!1;function reSendRequirements(){forceExtractionAgain=!0,window.setTimeout((function(){forceExtractionAgain&&(forceExtractionAgain=!1,requirement_view_excerpt_extractor_RY.extractAndSendRequirements(!0))}),600)}($dropdowns=AJS.$(".edm-dropdown-menu, .edm-dropdown-menu-multiple, .edm-dropdown-menu-non-predefined, span.edm-load.conf-macro,.edm-dropdown-menu-non-predefined-multiple, span.edm-load, span#edm-select2-candidate")).off(".ry-extraction"),$dropdowns.on("change.ry-extraction",reSendRequirements),$(document).delegate(".handy-status-option","click",(function(){reSendRequirements()}))}));__webpack_require__(582),__webpack_require__(6828),__webpack_require__(8049);var REQ_LINK_ANCHOR_REGEX=/^#req-link-(.+?)-(.+)-([0-9]+)?$/,REQ_ANCHOR_REGEX=/^#req-(.+)$/;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}var fn,_getRequirementDetails,requirement_view_rest_RY=window.RY=window.RY||{};function requirement_view_popup_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function requirement_view_popup_manager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){requirement_view_popup_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){requirement_view_popup_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}requirement_view_rest_RY.RequirementREST={getRequirementDetails:(fn=regeneratorRuntime.mark((function _callee(spaceKey,reqKey,baseline){var requirementDefinition;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!(requirementDefinition=RequirementCache.get(spaceKey,reqKey,baseline))){_context.next=5;break}return _context.abrupt("return",Promise.resolve(requirementDefinition));case 5:return _context.abrupt("return",new Promise((function(resolve,reject){$.ajax({url:AJS.contextPath()+"/rest/reqs/1/requirement2/"+encodeURIComponent(spaceKey)+"/"+encodeURIComponent(reqKey)+"?"+AJS.$.param({expand:"references",v:baseline||""}),type:"GET",contentType:"application/json; charset=utf-8"}).done((function(requirement){requirement_view_rest_RY.RequirementREST.formatRequirementDetails(requirement,AJS.Meta.get("page-id")),requirement.htmlNeedsUpdating||RequirementCache.put(spaceKey,reqKey,baseline,requirement),resolve(requirement)})).fail((function(jqXHR){404===jqXHR.status?reject("Requirement "+reqKey+" doesn't exist"):(AJS.flag({type:"error",title:"Error while getting requirement "+reqKey,body:requirement_view_rest_RY.extractMessageFromXHR(jqXHR,300)}),reject(requirement_view_rest_RY.extractMessageFromXHR(jqXHR,1e3)))}))})));case 6:case"end":return _context.stop()}}),_callee)})),_getRequirementDetails=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x,_x2,_x3){return _getRequirementDetails.apply(this,arguments)}),formatRequirementDetails:function(requirement,currentPageId){1===requirement.references.length&&requirement.references[0].pageId===currentPageId&&(requirement.references=[]),requirement.tests&&requirement_view_rest_RY.renderTestResultsToEmoji&&requirement_view_rest_RY.renderTestResultsToEmoji(requirement.tests)}};var requirement_view_popup_manager_RY=window.RY=window.RY||{},counterForDialogs=0;requirement_view_popup_manager_RY.RequirementPopupManager={settings:{displayOnclick:!1,popupDelay:0,collapseExcerpts:!0,initialized:!1,initialize:function(){return this.initialized?Promise.resolve(!1):new Promise((function(resolve){$.ajax({url:AJS.contextPath()+"/rest/reqs/1/settings",contentType:"application/json",type:"GET",success:function(data){var modified=requirement_view_popup_manager_RY.RequirementPopupManager.applySettings(data);resolve(modified)},error:function(){requirement_view_popup_manager_RY.RequirementPopupManager.settings.initialized=!0,resolve(!1)}})}))}},applySettings:function(settings,reinitialize){if(!requirement_view_popup_manager_RY.RequirementPopupManager.settings.initialized){var displayOnclick="true"===settings["popup-on-click"],modified=requirement_view_popup_manager_RY.RequirementPopupManager.settings.displayOnclick!==displayOnclick;return requirement_view_popup_manager_RY.RequirementPopupManager.settings.displayOnclick=displayOnclick,requirement_view_popup_manager_RY.RequirementPopupManager.settings.popupDelay=parseInt(settings["popup-delay"])||0,requirement_view_popup_manager_RY.RequirementPopupManager.settings.collapseExcerpts="false"!==settings["collapse-excerpts"],requirement_view_popup_manager_RY.RequirementPopupManager.settings.initialized=!0,(reinitialize||modified)&&requirement_view_popup_manager_RY.RequirementPopupManager.init(),modified}return!1},init:function(){var $body=$("body");$body.off(".ry-show-dialog-event"),requirement_view_popup_manager_RY.RequirementPopupManager.settings.displayOnclick?$body.on("click.ry-show-dialog-event",".requirement-link-macro, .requirement-macro",(function(e){var $this=$(this);if(!(e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||1!==e.which)){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var dialogId=$this.attr("aria-controls");if(dialogId){var $dialog=$("#"+dialogId);if($dialog.size()>0&&$dialog[0].open)return $dialog[0].open=!1,$this.removeAttr("aria-controls"),$this.removeAttr("data-aui-trigger"),!1}return requirement_view_popup_manager_RY.RequirementPopupManager.createInlineDialog($this),!1}})):($body.on("mouseenter.ry-show-dialog-event",".requirement-link-macro, .requirement-macro",(function(){var $this=$(this);requirement_view_popup_manager_RY.RequirementPopupManager.settings.initialize().then((function(modified){modified&&requirement_view_popup_manager_RY.RequirementPopupManager.settings.displayOnclick||(0===requirement_view_popup_manager_RY.RequirementPopupManager.settings.popupDelay?requirement_view_popup_manager_RY.RequirementPopupManager.createInlineDialog($this):window.setTimeout((function(){$this.is(":hover")&&requirement_view_popup_manager_RY.RequirementPopupManager.createInlineDialog($this)}),requirement_view_popup_manager_RY.RequirementPopupManager.settings.popupDelay))}))})),$body.on("click.ry-show-dialog-event",".requirement-link-macro, .requirement-macro",(function(e){e.preventDefault();var href=$(this).attr("href");e.metaKey||e.ctrlKey||2===e.which?window.open(href,"_blank"):window.location=href})))},createInlineDialog:function($trigger){var reqKey=$trigger.attr("data-requirement-key"),spaceKey=$trigger.attr("data-space-key")||AJS.Meta.get("space-key"),baseline=$trigger.attr("data-requirement-baseline"),title=$trigger.attr("title"),sinceBaseline=$trigger.attr("data-since-baseline"),untilBaseline=$trigger.attr("data-until-baseline"),isOriginal=$trigger.hasClass("requirement-macro"),id=counterForDialogs++,hash=reqKey+"-"+spaceKey+"-"+baseline+"-"+sinceBaseline+"-"+untilBaseline;$(".ry-requirement-popup").remove();var dialogId="ry-requirement-popup-"+id;$("body").prepend(PlaySQL.Requirements.generateAuiDialogPlaceholder({dialogId:dialogId,hash:hash}));var $dialog=$("#"+dialogId),dialog=$dialog[0];$trigger.attr("data-aui-trigger","").attr("aria-controls",dialogId),window.setTimeout(requirement_view_popup_manager_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var currentPageId,$content,requirementDefinition,popupDetails;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(dialog&&dialog.parentNode){_context.next=3;break}return AJS.error("The aui-inline-dialog can't be displayed for the requirement, for an obscure reason"),_context.abrupt("return");case 3:return dialog.open=!0,currentPageId=AJS.Confluence.getContentId(),$content=$dialog.find(".aui-inline-dialog-contents").addClass("inline-dialog-requirement-detail").attr("data-space-key",spaceKey).attr("data-requirement-key",reqKey).attr("data-baseline",baseline||""),_context.prev=6,_context.next=9,requirement_view_popup_manager_RY.RequirementREST.getRequirementDetails(spaceKey,reqKey,baseline);case 9:requirementDefinition=_context.sent,popupDetails={requirement:requirementDefinition,pageId:"0"!=currentPageId?currentPageId:void 0,spaceKey:spaceKey,isOriginal:isOriginal,sinceBaseline:sinceBaseline,untilBaseline:untilBaseline,title:title},requirement_view_popup_manager_RY.RequirementPopupManager.showRequirementDetails({$content:$content,$trigger:$trigger,popupDetails:popupDetails}),_context.next=17;break;case 14:_context.prev=14,_context.t0=_context.catch(6),requirement_view_popup_manager_RY.RequirementPopupManager.showRequirementDetails({$content:$content,$trigger:$trigger,error:_context.t0});case 17:case"end":return _context.stop()}}),_callee,null,[[6,14]])}))),0);var intervalId=window.setInterval((function(){0===$(".ry-requirement-popup .inline-dialog-requirement-detail:hover, .requirement-macro:hover, .requirement-link-macro:hover").size()&&(dialog.open=!1,window.clearTimeout(intervalId))}),350);return $dialog[0]},showRequirementDetails:function(options){var $content=options.$content,$trigger=options.$trigger,popupDetails=options.popupDetails,error=options.error;$trigger&&$trigger.hasClass("ry-error")?$content.html($trigger.attr("data-error-message")):error?$content.text(error):popupDetails&&popupDetails.requirement&&!popupDetails.requirement.key?$content.text("Error: The key is not provided."):($content.html(PlaySQL.Requirements.detailPopup({requirement:popupDetails.requirement,currentPageId:popupDetails.pageId,spaceKey:popupDetails.spaceKey,isOriginal:popupDetails.isOriginal,collapseExcerpts:requirement_view_popup_manager_RY.RequirementPopupManager.settings.collapseExcerpts,sinceBaseline:popupDetails.sinceBaseline,untilBaseline:popupDetails.untilBaseline,title:popupDetails.title})),requirement_view_popup_manager_RY.RequirementPopupManager.addJiraStatusInfo(popupDetails.requirement,$content),$content.find(".playsql-tipsy").tooltip({delayIn:0}),$content.off(".ry-popup-events"),$content.on("click.expand-req-details.ry-popup-events",".requirement-details, .requirement-details-expander",(function(e){return e.preventDefault(),$(".requirement-details").removeClass("collapsed"),$(".requirement-details-expander").remove(),$content.off("click.expand-req-details"),!1})),$content.on("mouseenter.ry-popup-events","a",(function(){this.hash&&this.host===window.location.host&&this.pathname===window.location.pathname&&this.hash&&0===this.hash.indexOf("#req-")&&REQ_LINK_ANCHOR_REGEX.test(this.hash)&&$(this.hash).addClass("ry-active-anchor-focus")})),$content.on("mouseleave.ry-popup-events","a",(function(){$(".ry-active-anchor-focus").removeClass("ry-active-anchor-focus")})),$content.on("click.ry-popup-events",".baseline-browser .aui-button",(function(e){var $this=$(this),previous=$this.hasClass("previous"),next=$this.hasClass("next"),$baselineName=$this.parent().find(".name"),baseline=$baselineName.attr("data-baseline")||1/0,displayed=!1;(previous||next)&&(window.setTimeout((function(){displayed||$baselineName.html('<aui-spinner size="small" style="display: inline-block"></aui-spinner>')}),300),requirement_view_popup_manager_RY.RequirementHistoryManager.get(popupDetails.requirement.spaceKey,[popupDetails.requirement.key]).then((function(cache){function displayError(message){displayed=!0;var $textZone=$content.find(".requirement-details");if($textZone.size()>0)for($textZone.text(message),$baselineName.empty();;){var $item=$textZone.next();if(!($item.size()>0))break;$item.remove()}else $content.text(message)}var requirementHistory=cache[popupDetails.requirement.key];if(requirementHistory){var item=null;if(previous){for(var i=0;i<requirementHistory.length;i++)if((requirementHistory[i].baseline||1/0)<baseline){item=requirementHistory[i];break}}else for(var _i=0;_i<requirementHistory.length&&!((requirementHistory[_i].baseline||1/0)<=baseline);_i++)item=requirementHistory[_i];null!=item?requirement_view_popup_manager_RY.RequirementREST.getRequirementDetails(popupDetails.requirement.spaceKey,popupDetails.requirement.key,item.baseline).then((function(requirement){displayed=!0,popupDetails.requirement=requirement,requirement_view_popup_manager_RY.RequirementPopupManager.showRequirementDetails(options)})).catch((function(reason){displayError(reason)})):displayError(previous?"No previous version":"No next version")}else displayError("Can't get the history of the requirement ".concat(popupDetails.requirement.key,"."))})))})))},addJiraStatusInfo:function(requirement,$content){var listPerApplink={};if(requirement.issues&&requirement.issues.length>0){for(var i=0;i<requirement.issues.length;i++){var applink=requirement.issues[i].applink,issueKey=requirement.issues[i].issueKey,found=!1,list=listPerApplink[applink];list?found=-1!=list.indexOf(issueKey):(list=[],listPerApplink[applink]=list),found||list.push(issueKey)}for(var _i2=0,_Object$keys=Object.keys(listPerApplink);_i2<_Object$keys.length;_i2++){var _applink=_Object$keys[_i2];requirement_view_popup_manager_RY.IssueCache.fetchIssueStatus(_applink,listPerApplink[_applink],(function(applink,item){var issueKey=item.key,fields=item.fields,status=fields&&fields.status,statusName=status&&status.name,issueStatusColorName=status&&status.statusCategory&&status.statusCategory.colorName,issueStatusCategoryKey=status&&status.statusCategory&&status.statusCategory.key;statusName&&$content.find(".ry-jira-status").filter((function(){var $span=$(this);return $span.attr("data-applink")===applink&&$span.attr("data-issue-key")===issueKey})).html(PlaySQL.Requirements.jiraStatus({issueStatusName:statusName,issueStatusColorName:issueStatusColorName,issueStatusCategoryKey:issueStatusCategoryKey}))}))}}}};var requirement_view_RY=window.RY=window.RY||{};AJS.$((function($){var pageId=AJS.Confluence.getContentId();if(pageId&&"0"!==pageId&&pageId==AJS.Meta.get("latest-page-id")){var numberOfRequirements=$(".wiki-content .ry-macro2").size();$.ajax({url:AJS.contextPath()+"/rest/reqs/1/misc/"+encodeURIComponent(AJS.Meta.get("space-key"))+"/"+pageId+"?"+$.param({numberOfRequirements:numberOfRequirements}),type:"GET",contentType:"application/json; charset=utf-8"}).done((function(data){if(data.settings&&requirement_view_RY.RequirementPopupManager.applySettings(data.settings),data["personal-queue-failed-items"]&&AJS.flag({type:"warning",title:"Jira synchronization failed",body:"<p>Requirement Yogi failed at notifying Jira about changes you've done.</p>"+'<p><a href="'.concat(AJS.contextPath(),'/requirementyogi/personal-queue.action">Click here</a> to review the details.</p>')}),data.limitReached)AJS.flag({type:"error",title:"Too many requirements",body:"The requirements couldn't be reindexed. There are too many of them on the page: "+numberOfRequirements+" for a limit of "+data.limitForPages+". Try creating two pages, or ask your administrator to change the limit."}),$(".ry-macro2").addClass("ry-error").attr("data-error-message","Too many requirements on the page."),requirement_view_RY.reindexationSuccess=!1,requirement_view_RY.reindexationMessage="Too many requirements on the page";else{if(requirement_view_RY.LozengeManager.updateDefinitions(data.requirements),$(".ry-macro2").filter(":not(.resolved)").addClass(".unresolved"),"READ_ONLY"===AJS.Meta.get("access-mode"))return requirement_view_RY.reindexationSuccess=!1,void(requirement_view_RY.reindexationMessage="Confluence is in read-only mode");var $needExcerpts=$(".requirement-macro.requirement-needs-excerpt").filter((function(){return!$(this).attr("data-baseline")}));$needExcerpts.size()>0?requirement_view_RY.extractAndSendRequirements(!1,$needExcerpts):(requirement_view_RY.reindexationSuccess=!0,requirement_view_RY.reindexationMessage="No requirement to reindex on the page")}})).fail((function(jqXHR){if(402===jqXHR.status)requirement_view_RY.reindexationSuccess=!1,requirement_view_RY.reindexationMessage="Licence is outdated";else{var message=requirement_view_RY.extractMessageFromXHR(jqXHR,300);AJS.flag({type:"error",title:"Couldn't get the requirement definitions",body:message}),requirement_view_RY.reindexationSuccess=!1,requirement_view_RY.reindexationMessage="Request to /rest/reqs/1/misc/"+encodeURIComponent(AJS.Meta.get("space-key"))+"/"+pageId+"?"+$.param({numberOfRequirements:numberOfRequirements})+" has failed: "+message}}))}else requirement_view_RY.reindexationSuccess=!0,requirement_view_RY.reindexationMessage="No reindex necessary because we are not on the latest page";if(requirement_view_RY.RequirementPopupManager.init(),window.location.hash&&0===window.location.hash.indexOf("#req")){var $macro,match=REQ_LINK_ANCHOR_REGEX.exec(window.location.hash);if(match){var spaceKey=requirement_view_RY.decodeURIComponent(match[1]),reqKey=requirement_view_RY.decodeURIComponent(match[2]),occurrence=parseInt(match[3])||1,$macros=$(".requirement-link-macro").filter((function(index,item){var $item=$(item);return $item.attr("data-requirement-key")===reqKey&&$item.attr("data-space-key")===spaceKey}));$macros.addClass("ry-active-anchor"),$macro=$macros.eq(occurrence-1)}else if(match=REQ_ANCHOR_REGEX.exec(window.location.hash)){var _reqKey=requirement_view_RY.decodeURIComponent(match[1]);$macro=$(".requirement-macro").filter((function(index,item){return $(item).attr("data-requirement-key")===_reqKey}))}$macro&&$macro.length&&($macro.addClass("ry-active-anchor-focus").focus(),window.scrollTo({top:$macro.offset().top-200,left:0,behavior:"smooth"}))}}))}()}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.requirementyogi:requirement-view', location = 'js/requirement-view.soy' */
// This file was automatically generated from requirement-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace PlaySQL.Requirements.
 */

if (typeof PlaySQL == 'undefined') { var PlaySQL = {}; }
if (typeof PlaySQL.Requirements == 'undefined') { PlaySQL.Requirements = {}; }


PlaySQL.Requirements.detailPopup = function(opt_data, opt_ignored) {
  var output = '<div class="identification">' + ((opt_data.requirement.htmlNeedsUpdating) ? '<span class="ry-updating-notification playsql-tipsy" title="This red badge means the requirement has changed and will be updated in a few seconds.">&#8226;</span>' : '') + '<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.requirement.genericUrl) + '" data-requirement-key="' + soy.$$escapeHtml(opt_data.requirement.key) + '" class="requirement-detail-popup-title aui-label">' + soy.$$escapeHtml(opt_data.requirement.key) + ((opt_data.requirement.baseline) ? ' v' + soy.$$escapeHtml(opt_data.requirement.baseline) : '') + '</a>' + ((opt_data.isOriginal) ? '&nbsp;<span class="aui-lozenge aui-lozenge-success">Original definition</span>' : ((opt_data.requirement.origin && opt_data.requirement.origin.type == 'excel') ? '&nbsp;<span class="aui-lozenge aui-lozenge-success">Excel</span>&nbsp;<a href="' + soy.$$escapeHtml(opt_data.requirement.origin.url) + '">' + soy.$$escapeHtml(opt_data.requirement.origin.title) + '</a>' + ((opt_data.spaceKey != opt_data.requirement.spaceKey) ? ' in space \'' + soy.$$escapeHtml(opt_data.requirement.spaceKey) + '\'' : '') : (opt_data.requirement.origin && opt_data.requirement.origin.type == 'imported') ? '&nbsp;<span class="aui-lozenge aui-lozenge-success">Imported</span>&nbsp;' + ((opt_data.requirement.origin.url && opt_data.requirement.origin.title) ? '<a href="' + soy.$$escapeHtml(opt_data.requirement.origin.url) + '">' + soy.$$escapeHtml(opt_data.requirement.origin.title) + '</a>' : (opt_data.requirement.origin.title) ? '<p>' + soy.$$escapeHtml(opt_data.requirement.origin.title) + '</p>' : '<p>Unknown document</p>') + ((opt_data.spaceKey != opt_data.requirement.spaceKey) ? ' in space \'' + soy.$$escapeHtml(opt_data.requirement.spaceKey) + '\'' : '') : '&nbsp;<span class="aui-lozenge aui-lozenge-moved">Link</span>' + ((opt_data.requirement.origin) ? '&nbsp;to&nbsp;<a href="' + soy.$$escapeHtml(opt_data.requirement.origin.url) + '">' + soy.$$escapeHtml(opt_data.requirement.origin.title) + '</a>' + ((opt_data.spaceKey != opt_data.requirement.spaceKey) ? ' in space \'' + soy.$$escapeHtml(opt_data.requirement.spaceKey) + '\'' : '') : '')) + ((opt_data.requirement.baseline) ? (opt_data.requirement.baselineDetails) ? '&nbsp;as of baseline ' + soy.$$escapeHtml(opt_data.requirement.baseline) + '-<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.requirement.baselineDetails.canonicalUrl) + '#">' + soy.$$escapeHtml(opt_data.requirement.baselineDetails.name) + '</a>' : '&nbsp;as of baseline ' + soy.$$escapeHtml(opt_data.requirement.baseline) : '')) + '<div class="baseline-browser" style="float: right"><span class="name" data-baseline="' + soy.$$escapeHtml(opt_data.requirement.baseline != null ? opt_data.requirement.baseline : '') + '" style="margin-right: 10px">' + ((opt_data.requirement.baseline && opt_data.requirement.baselineDetails) ? '<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.requirement.baselineDetails.canonicalUrl) + '#">v' + soy.$$escapeHtml(opt_data.requirement.baseline) + ((opt_data.requirement.baselineDetails.name) ? '&nbsp;-&nbsp;' + soy.$$escapeHtml(opt_data.requirement.baselineDetails.name) : '') + '</a>' : soy.$$escapeHtml(opt_data.requirement.baseline ? 'v' + opt_data.requirement.baseline : 'Current')) + '</span><button class="aui-button previous">&lt;</button><button class="aui-button next" ' + ((! opt_data.requirement.baseline) ? ' disabled ' : '') + '>&gt;</button></div></div>' + ((opt_data.sinceBaseline) ? '<div class="ry-since-baseline-info"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-new">' + ((opt_data.sinceBaseline == 'latest') ? 'Has changed since the last baseline' : 'Has been identical&nbsp;' + ((opt_data.untilBaseline) ? 'from baseline ' + soy.$$escapeHtml(opt_data.sinceBaseline) + ' to ' + soy.$$escapeHtml(opt_data.untilBaseline) : 'since baseline ' + soy.$$escapeHtml(opt_data.sinceBaseline))) + '</span></div>' : '') + ((opt_data.title) ? '<div><i>' + soy.$$escapeHtml(opt_data.title) + '</i></div>' : '');
  if (opt_data.requirement.duplicateOriginalPages) {
    output += '<p><span class="aui-lozenge aui-lozenge-error">Error</span> This requirement is defined in ' + soy.$$escapeHtml(opt_data.requirement.duplicateOriginalPages.length) + ' places. Please fix the issue:</p><ul class="ry-detail-links">';
    var refList134 = opt_data.requirement.duplicateOriginalPages;
    var refListLen134 = refList134.length;
    for (var refIndex134 = 0; refIndex134 < refListLen134; refIndex134++) {
      var refData134 = refList134[refIndex134];
      output += PlaySQL.Requirements.linkToPage({ref: refData134});
    }
    output += '</ul>';
  } else {
    output += '<div class="requirement-details ' + ((opt_data.collapseExcerpts) ? 'collapsed' : '') + '">' + ((opt_data.requirement.htmlExcerpt) ? '<p>' + soy.$$filterNoAutoescape(opt_data.requirement.htmlExcerpt) + '</p>' : '<p style="font-style:italic; opacity:.5;">(Empty)</p>') + '</div>' + ((opt_data.collapseExcerpts) ? (opt_data.requirement.htmlExcerpt && opt_data.requirement.htmlExcerpt.length > 100) ? '<p class="requirement-details-expander"><a href="#">Click to expand...</a></p>' : '' : '');
  }
  if (opt_data.requirement.properties.length != 0) {
    output += '<ul>';
    var propertyList162 = opt_data.requirement.properties;
    var propertyListLen162 = propertyList162.length;
    for (var propertyIndex162 = 0; propertyIndex162 < propertyListLen162; propertyIndex162++) {
      var propertyData162 = propertyList162[propertyIndex162];
      output += (propertyData162.display) ? '<li>' + ((propertyData162.searchUrl) ? '<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(propertyData162.searchUrl) + '" target="_blank">' + soy.$$escapeHtml(propertyData162.key) + '</a>' : soy.$$escapeHtml(propertyData162.key)) + ': ' + soy.$$filterNoAutoescape(propertyData162.value != null ? propertyData162.value : '') + ((propertyData162.type == 'EXTERNAL') ? ' *' : '') + '</li>' : '';
    }
    output += '</ul>';
  }
  if (opt_data.requirement.references.length != 0 || opt_data.requirement.issues.length != 0 || opt_data.requirement.dependencies.length != 0 || opt_data.requirement.reverseDependencies.length != 0) {
    output += '<p>See also:</p><ul class="ry-detail-links">';
    var linkList188 = opt_data.requirement.dependencies;
    var linkListLen188 = linkList188.length;
    for (var linkIndex188 = 0; linkIndex188 < linkListLen188; linkIndex188++) {
      var linkData188 = linkList188[linkIndex188];
      output += '<li><span class="aui-lozenge aui-lozenge-default requirement-dependency-lozenge" title="cites">PARENT &#8599;</span>' + ((linkData188.relationship != 'parent') ? ' (' + soy.$$escapeHtml(linkData188.relationship) + ') ' : '') + '&nbsp;<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(linkData188.url) + '"><span class="requirement-dependency-key">' + soy.$$escapeHtml(linkData188.key) + '</span>' + ((linkData188.baseline) ? ' v<span class="requirement-dependency-baseline">' + soy.$$escapeHtml(linkData188.baseline) + '</span>' : '') + '</a>' + ((opt_data.spaceKey != linkData188.spaceKey) ? ' in space \'<span class="requirement-cross-space-key">' + soy.$$escapeHtml(linkData188.spaceKey) + '</span>\'' : '') + '</li>';
    }
    var linkList214 = opt_data.requirement.reverseDependencies;
    var linkListLen214 = linkList214.length;
    for (var linkIndex214 = 0; linkIndex214 < linkListLen214; linkIndex214++) {
      var linkData214 = linkList214[linkIndex214];
      output += (linkIndex214 > 15 && opt_data.requirement.reverseDependencies.length > 25) ? (linkIndex214 == 16) ? '<li>...and ' + soy.$$escapeHtml(opt_data.requirement.reverseDependencies.length - linkIndex214) + ' more</li>' : '' : '<li><span class="aui-lozenge aui-lozenge-default requirement-dependency-lozenge" title="Is cited by">CHILD &#8600;</span> (' + soy.$$escapeHtml(linkData214.relationship) + ') &nbsp;<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(linkData214.url) + '"><span class="requirement-dependency-key">' + soy.$$escapeHtml(linkData214.key) + '</span>' + ((linkData214.baseline) ? ' v<span class="requirement-dependency-baseline">' + soy.$$escapeHtml(linkData214.baseline) + '</span>' : '') + '</a>' + ((opt_data.spaceKey != linkData214.spaceKey) ? ' in space \'<span class="requirement-cross-space-key">' + soy.$$escapeHtml(linkData214.spaceKey) + '</span>\'' : '') + '</li>';
    }
    var linkList244 = opt_data.requirement.references;
    var linkListLen244 = linkList244.length;
    for (var linkIndex244 = 0; linkIndex244 < linkListLen244; linkIndex244++) {
      var linkData244 = linkList244[linkIndex244];
      output += (! linkData244.isCoveredByDependency) ? '<li>' + ((linkData244.pageId == opt_data.currentPageId) ? '<span class="aui-lozenge aui-lozenge-moved">This page</span>' : '<span class="aui-lozenge aui-lozenge-moved requirement-link-lozenge">Link</span>') + '&nbsp;<a href="' + soy.$$escapeHtml(linkData244.url) + '">' + soy.$$escapeHtml(linkData244.title) + '</a></li>' : '';
    }
    var linkList259 = opt_data.requirement.issues;
    var linkListLen259 = linkList259.length;
    for (var linkIndex259 = 0; linkIndex259 < linkListLen259; linkIndex259++) {
      var linkData259 = linkList259[linkIndex259];
      output += '<li><span class="aui-lozenge aui-lozenge-new requirement-jira-lozenge">Jira</span> (' + soy.$$escapeHtml(linkData259.relationship) + ') &nbsp;<a href="' + soy.$$escapeHtml(linkData259.url) + '">' + soy.$$escapeHtml(linkData259.issueKey) + '</a>&nbsp;<span class="ry-jira-status" data-applink="' + soy.$$escapeHtml(linkData259.applink) + '" data-issue-key="' + soy.$$escapeHtml(linkData259.issueKey) + '"></span>&nbsp;' + soy.$$escapeHtml(linkData259.title) + '</li>';
    }
    output += '</ul>';
  }
  if (soy.$$getMapKeys(opt_data.requirement.tests).length > 0) {
    output += '<p>Tests:</p><ul>';
    var relationshipList278 = soy.$$getMapKeys(opt_data.requirement.tests);
    var relationshipListLen278 = relationshipList278.length;
    for (var relationshipIndex278 = 0; relationshipIndex278 < relationshipListLen278; relationshipIndex278++) {
      var relationshipData278 = relationshipList278[relationshipIndex278];
      output += '<li class="ry-test-result-in-popup"><span class="aui-lozenge aui-lozenge-moved" title="Relationship">' + soy.$$escapeHtml(relationshipData278) + '</span>';
      var testRefList282 = opt_data.requirement.tests[relationshipData278];
      var testRefListLen282 = testRefList282.length;
      for (var testRefIndex282 = 0; testRefIndex282 < testRefListLen282; testRefIndex282++) {
        var testRefData282 = testRefList282[testRefIndex282];
        output += '&nbsp;<span style="color:#777;">| </span><a href="' + soy.$$escapeHtml(testRefData282.url) + '" title="' + soy.$$escapeHtml(testRefData282.result != null ? testRefData282.result : '(no result)') + ' on ' + ((testRefData282.title) ? 'page \'' + soy.$$escapeHtml(testRefData282.title) + '\' created on ' + soy.$$escapeHtml(testRefData282.dateCreation) : 'page created on ' + soy.$$escapeHtml(testRefData282.dateCreation)) + '" >' + ((! testRefData282.isLatestTest && testRefData282.resultEmojiOnly) ? soy.$$filterNoAutoescape(testRefData282.resultEmojiOnly) : (testRefData282.resultRendered) ? soy.$$filterNoAutoescape(testRefData282.resultRendered != null ? testRefData282.resultRendered : '(no result)') : soy.$$escapeHtml(! testRefData282.result ? '(no result)' : testRefData282.result)) + '</a>';
      }
      output += '</li>';
    }
    output += '</ul>';
  }
  output += (opt_data.requirement.baselineDetails) ? '<p><a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.requirement.searchForVersionsUrl) + '">See all versions of this requirement</a></p>' : '';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.detailPopup.soyTemplateName = 'PlaySQL.Requirements.detailPopup';
}


PlaySQL.Requirements.generateAuiDialogPlaceholder = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="' + soy.$$escapeHtml(opt_data.dialogId) + '" class="ry-requirement-popup" alignment="bottom left" responds-to="hover" data-hash="' + soy.$$escapeHtml(opt_data.hash) + '">' + PlaySQL.Requirements.auiSpinner(null) + ' Loading the requirement...</aui-inline-dialog>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.generateAuiDialogPlaceholder.soyTemplateName = 'PlaySQL.Requirements.generateAuiDialogPlaceholder';
}


PlaySQL.Requirements.inlineActionForm = function(opt_data, opt_ignored) {
  var output = '<form action="#" method="post" id="create-inline-requirement-form" class="aui top-label"><div class="dialog-header hidden"><div class="title left-position"><h2 id="create-dialog-header">' + soy.$$escapeHtml('Define a new key') + '</h2></div><br class="clear" /></div><span id="req-type-loading">' + PlaySQL.Requirements.auiSpinner(null) + soy.$$escapeHtml('Loading...') + '</span><div class="dialog-content hidden"><div class="field-group hidden"><label for="req-key">' + soy.$$escapeHtml('Key') + '<span class="aui-icon icon-required"> required</span></label><input id="req-key" class="text long-field" value="' + soy.$$escapeHtml(opt_data.requirementKey) + '" maxlength="255" /></div><div class="field-group"><label for="req-type">' + soy.$$escapeHtml('Type') + '<span class="aui-icon icon-required"> required</span></label><select class="select long-field" id="req-type" name="reqtype" title="Type"><option value="" data-ceoid="inline">Inline</option><option value="" data-ceoid="new">New...</option></select><div class="description"><a href="#" class="refresh-types">' + soy.$$escapeHtml('Refresh') + '</a></div><div class="description create-inline-requirement-explanation">' + soy.$$escapeHtml('\x22Inline\x22 is the same as editing the page and inserting with [ Alt + Shift + R ].') + '</div></div><div class="new-type-group hidden"><div class="field-group"><label for="type-name">' + soy.$$escapeHtml('Type Name') + '<span class="aui-icon icon-required"> required</span></label><input id="type-name" class="text long-field" value="' + soy.$$escapeHtml(opt_data.newTypeSuggestion) + '" maxlength="255" /></div><div class="field-group"><label for="type-name">' + soy.$$escapeHtml('Type Color') + '</label><select class="select long-field" id="type-color" name="type-color"><option value="transparent">[ None ]</option><option value="#14892c">Green</option><option value="#d04437">Red</option><option value="#205081">Blue</option><option value="#f15c75">Pink</option><option value="#815b3a">Brown</option><option value="#654982">Violet</option><option value="#f6c342">Yellow</option><option value="#4a6785">Slate</option></select><div class="description">More formatting options are available in the index page</div></div></div><div class="field-group description-parent hidden">';
  var inlineRef__soy351 = '<span class="req-key-reference">REQ-001</span>';
  output += '<label for="description">' + soy.$$filterNoAutoescape(AJS.format('Description of {0}',inlineRef__soy351)) + '<span class="aui-icon icon-required"> required</span></label><textarea class="textarea long-field" id="description"></textarea></div><div class="checkbox for-all-on-page-group hidden"><input class="checkbox" type="checkbox" name="apply-in-page" id="apply-in-page" checked="on" disabled="on"><label for="apply-in-page">Make links for every "<span class="req-key-reference">REQ-001</span>" on this page.</label></div><div class="checkbox for-all-in-space-group"><input class="checkbox" type="checkbox" name="apply-in-space" id="apply-in-space" checked="on"><label for="apply-in-space">Make links for every "<span class="req-key-reference">REQ-001</span>" in this space.</label></div><div class="checkbox transform-all-similar-group hidden"><input class="checkbox" type="checkbox" name="transform-all-similar" id="transform-all-similar" data-pattern="The regex or text to look for"><label for="transform-all-similar">Create similar definitions for all <span id="pattern" title="It\'s a regex.">"REQ-"</span><a href="#" class="edit-pattern"><span class="aui-icon aui-icon-small aui-iconfont-edit-small playsql-tipsy">(Edit the pattern)</span></a>&nbsp; on this page (about <span id="pattern-count">0</span> other occurrences<span id="after-pattern-count"></span>). &nbsp;<span id="warn-key-is-no-match" class="hidden">Note: The key doesn\'t match your pattern.</span></label></div></div><div class="buttons-group"><div id="form-message" class="error"></div><input class="aui-button submit" type="submit" value="' + soy.$$escapeHtml('Create') + '" /><a class="cancel" href="#">' + soy.$$escapeHtml('Cancel') + '</a>' + PlaySQL.Requirements.auiSpinner({css: 'hidden'}) + '</div></form>';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.inlineActionForm.soyTemplateName = 'PlaySQL.Requirements.inlineActionForm';
}


PlaySQL.Requirements.inlineActionFormForDuplicates = function(opt_data, opt_ignored) {
  return '<input type="hidden" name="situation" value="already-exists" />' + ((opt_data.requirement.origin) ? '<p>The requirement ' + soy.$$escapeHtml(opt_data.requirement.key) + ' already exists on&nbsp;<a href="' + soy.$$escapeHtml(opt_data.requirement.origin.url) + '">' + soy.$$escapeHtml(opt_data.requirement.origin.title) + '</a>.</p>' : '<p>The requirement ' + soy.$$escapeHtml(opt_data.requirement.key) + ' already exists&nbsp; (<a href="' + soy.$$escapeHtml(opt_data.contextPath) + soy.$$escapeHtml(opt_data.requirement.genericUrl) + '">link</a>).</p>') + '<p>Do you want to create a link?</p><br><div class="checkbox for-all-in-space-group"><input class="checkbox" type="checkbox" name="apply-in-space" id="apply-in-space"><label for="apply-in-space">Make links for every "<span class="req-key-reference">' + soy.$$escapeHtml(opt_data.requirement.key) + '</span>" in this space.</label></div>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.inlineActionFormForDuplicates.soyTemplateName = 'PlaySQL.Requirements.inlineActionFormForDuplicates';
}


PlaySQL.Requirements.colorDropdownItem = function(opt_data, opt_ignored) {
  return '' + ((opt_data.color == 'transparent') ? '<span>' + soy.$$escapeHtml(opt_data.name) + '</span>' : '<span style="color: ' + soy.$$escapeHtml(opt_data.color) + '; font-weight: bold;">' + soy.$$escapeHtml(opt_data.name) + '</span>');
};
if (goog.DEBUG) {
  PlaySQL.Requirements.colorDropdownItem.soyTemplateName = 'PlaySQL.Requirements.colorDropdownItem';
}


PlaySQL.Requirements.autocompleteSearch = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<a href="#" class="aui-icon aui-icon-small aui-iconfont-close-dialog ry-close-autocomplete" style="position:absolute; right: 20px;">Close</a><p>Type a full-text search, or use the following fields:</p>';
  if (opt_data.suggestions && opt_data.suggestions.length > 0) {
    output += '<ul>';
    var suggestionList401 = opt_data.suggestions;
    var suggestionListLen401 = suggestionList401.length;
    for (var suggestionIndex401 = 0; suggestionIndex401 < suggestionListLen401; suggestionIndex401++) {
      var suggestionData401 = suggestionList401[suggestionIndex401];
      output += '<li>' + soy.$$filterNoAutoescape(suggestionData401);
    }
    output += '</ul>';
  } else {
    output += '<ul><li><b>key = ...</b> The key of the requirement. Keys are unique per space.<li><b>spaceKey = ...</b>\tThe space key of the requirement (case sensitive).</li><li><b>status = ...</b>\tThe status of the requirement (ACTIVE, DELETED, MOVED).</li><li><b>text = ...</b>\tThe contents of the requirement (Does not include the properties).</li><li><b>page = ...</b>\tThe ID of a page linked to the requirement.</li><li><b>excel = ...</b>\tThe ID of an Excel attachment containing requirements.</li><li><b>jira = ...</b>\tA Jira issue linked to the requirement.</li><li><b>jira@relationship = ...</b>\tA Jira issue linked with a specific relationship</li><li><b>@anyproperty = ...</b>\tA property with name "anyproperty"</li><li><b>to@arelationship = ...</b> - A dependency with the relationship "arelationship".</li><li><b>from@arelationship = ...</b> \u2013 A dependency with the relationship "arelationship".</li><li><b>isModified(\'...\')</b> \u2013 Only requirements modified since a specific baseline.</li><li><b>hasTest(\'expected result\')</b> \u2013 Requirements with this test result (or use \'%\').</li><li><b>hasTest(\'relationship\', \'expected result\')</b> \u2013 Requirements with this test result + relationship.</li><li><b>hasTest([\'relationship\', ] \'expected result\' [, \'page\'] )</b> \u2013 Requirements tested on a given page, with a specific relationship and a specific result.</li><li><b>hasLastTest()</b> \u2013 Same as hasTest(), but only on the last page for the given relationship.</li></ul><p>AND, OR and NOT are also available.</p>';
  }
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.autocompleteSearch.soyTemplateName = 'PlaySQL.Requirements.autocompleteSearch';
}


PlaySQL.Requirements.bylineDialog = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="requirementyogi-byline-dialog" alignment="bottom center"><div class="ry-byline-dialog-default"><img id="rytest-logo" src="' + soy.$$escapeHtml("") + '/download/resources/com.playsql.requirementyogi/img/requirement-yogi-horizontal-2-92px.png" alt="Requirement Yogi Logo" width="300"/><p>Links:</p><ul><li><a href="' + soy.$$escapeHtml(opt_data.hrefSearchForDefinitions) + '">View in search (requirement definitions only)</a></li><li><a href="' + soy.$$escapeHtml(opt_data.hrefSearchForLinks) + '">View in search (definitions and links)</a></li><li><a href="' + soy.$$escapeHtml(opt_data.hrefDependencyMatrix) + '">Dependency matrix</a></li><li><a href="#" class="ry-reindex">Re-index this page</a></li><li><a href="#" class="ry-create-baseline-from-this-page">Create baseline from this page</a> / <a href="#" class="ry-create-baseline-from-this-page-and-descendents">and its descendents</a></li><li><a href="#" class="ry-compare-to-baseline">Compare to baseline...</a></li></ul><p style="font-size: .8em;"><a href="#" class="ry-see-extraction-messages hidden" style="font-size: .8em;">Requirements have been (re-)indexed. See results.</a><pre class="ry-extraction-messages hidden" style="overflow-y:auto; max-height: 350px;"></pre></p></div><div class="ry-byline-dialog-create-baseline hidden"><h3>Create an instant baseline from this page</h3><fieldset class="group"><legend><span>Choose a title:</span></legend><div class="radio hidden" id="baseline-title-template"><input class="radio" type="radio" name="baseline-title-suggestion"><label>Baseline [number] from [Page Title]</label></div><div class="radio" id="baseline-title-manual"><input class="radio" type="radio" name="baseline-title-suggestion" value="" checked><label for="baseline-title-manual"><input class="text medium-text medium-field mediumfield" placeholder="Your title"></label></div></fieldset><button class="aui-button create-baseline" style="margin-top: 10px;">Create and freeze</button></div><div class="ry-byline-dialog-compare-to-baseline hidden"><h3>Compare requirements on this page to a baseline...</h3><div class="field-group"><div><select class="select" id="compare-to-baseline"></select></div></div><button class="aui-button aui-button-primary compare" style="margin-top: 10px;">Highlight</button><button class="aui-button compare-reset" style="margin-top: 10px;">Cancel</button></div>' + PlaySQL.Requirements.auiSpinner({css: 'hidden'}) + '</aui-inline-dialog>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.bylineDialog.soyTemplateName = 'PlaySQL.Requirements.bylineDialog';
}


PlaySQL.Requirements.messageList = function(opt_data, opt_ignored) {
  var output = '<div class="aui-message ' + soy.$$escapeHtml(opt_data.cssClass) + '"><p class="title">' + soy.$$escapeHtml(opt_data.title) + '</p><ul>';
  var messageList428 = opt_data.messages;
  var messageListLen428 = messageList428.length;
  for (var messageIndex428 = 0; messageIndex428 < messageListLen428; messageIndex428++) {
    var messageData428 = messageList428[messageIndex428];
    output += '<li>' + soy.$$filterNoAutoescape(messageData428) + '</li>';
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.messageList.soyTemplateName = 'PlaySQL.Requirements.messageList';
}


PlaySQL.Requirements.auiSpinner = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<aui-spinner class="aui-spinner ' + soy.$$escapeHtml(opt_data.css != null ? opt_data.css : '') + '" size="' + soy.$$escapeHtml(opt_data.size != null ? opt_data.size : 'medium') + '"' + ((opt_data.style) ? ' style="' + soy.$$escapeHtml(opt_data.style) + '" ' : '') + '>' + soy.$$escapeHtml(opt_data.message != null ? opt_data.message : 'Please wait...') + '</aui-spinner>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.auiSpinner.soyTemplateName = 'PlaySQL.Requirements.auiSpinner';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.requirementyogi:requirement-view', location = 'js/ry-common-objects.soy' */
// This file was automatically generated from ry-common-objects.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace PlaySQL.Requirements.
 */

if (typeof PlaySQL == 'undefined') { var PlaySQL = {}; }
if (typeof PlaySQL.Requirements == 'undefined') { PlaySQL.Requirements = {}; }


PlaySQL.Requirements.renderRequirement = function(opt_data, opt_ignored) {
  return '<a class="requirement-link-macro ' + ((! opt_data.req.cssStyle || ! opt_data.req.cssStyle.noBorder) ? ' aui-label ' : '') + '" href="' + soy.$$escapeHtml(opt_data.req.genericUrl ? "" + opt_data.req.genericUrl : '#') + '" data-requirement-key="' + soy.$$escapeHtml(opt_data.req.key) + '" data-space-key="' + soy.$$escapeHtml(opt_data.req.spaceKey) + '" data-requirement-baseline="' + soy.$$escapeHtml(opt_data.req.baseline != null ? opt_data.req.baseline : '') + '"' + ((opt_data.req.origin) ? ' data-requirement-type="' + soy.$$escapeHtml(opt_data.req.origin.type != null ? opt_data.req.origin.type : '') + '" ' : '') + ((opt_data.req.cssStyle) ? ' style="' + soy.$$escapeHtml(opt_data.req.cssStyle.css) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.req.key) + ((opt_data.req.baseline) ? (opt_data.req.baselineDetails && ! opt_data.showVersionOnly) ? '&nbsp;<a class="requirement-baseline-name" href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.req.baselineDetails.canonicalUrl) + '">' + soy.$$escapeHtml(opt_data.req.baselineDetails.name) + '</a>' : '&nbsp;v' + soy.$$escapeHtml(opt_data.req.baseline) : '') + '</a>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.renderRequirement.soyTemplateName = 'PlaySQL.Requirements.renderRequirement';
}


PlaySQL.Requirements.renderRequirementRef = function(opt_data, opt_ignored) {
  return '<a class="requirement-link-macro aui-label" href="' + soy.$$escapeHtml(opt_data.req.genericUrl ? "" + opt_data.req.genericUrl : '#') + '" data-requirement-key="' + soy.$$escapeHtml(opt_data.req.key) + '" data-space-key="' + soy.$$escapeHtml(opt_data.req.spaceKey) + '" data-requirement-baseline="' + soy.$$escapeHtml(opt_data.req.baseline != null ? opt_data.req.baseline : '') + '" >' + soy.$$escapeHtml(opt_data.req.key) + ((opt_data.req.baseline) ? '&nbsp;v' + soy.$$escapeHtml(opt_data.req.baseline) : '') + '</a>';
};
if (goog.DEBUG) {
  PlaySQL.Requirements.renderRequirementRef.soyTemplateName = 'PlaySQL.Requirements.renderRequirementRef';
}


PlaySQL.Requirements.jiraStatus = function(opt_data, opt_ignored) {
  var output = '';
  var colorName__soy59 = opt_data.issueStatusCategoryKey == 'new' ? '#42526e' : opt_data.issueStatusCategoryKey == 'indeterminate' ? '#0052cc' : opt_data.issueStatusCategoryKey == 'done' ? '#00875a' : opt_data.issueStatusColorName;
  var bgColor__soy60 = opt_data.issueStatusCategoryKey == 'new' ? '#dfe1e6' : opt_data.issueStatusCategoryKey == 'indeterminate' ? '#ddeafe' : opt_data.issueStatusCategoryKey == 'done' ? '#e3fcef' : opt_data.issueStatusBgColor;
  var borderColor__soy61 = opt_data.issueStatusCategoryKey == 'new' ? '#8893a4' : opt_data.issueStatusCategoryKey == 'indeterminate' ? '#4c9aff' : opt_data.issueStatusCategoryKey == 'done' ? '#acf5d2' : opt_data.issueStatusColorName;
  output += '<span class="aui-lozenge aui-lozenge-subtle aui-lozenge-default" style="' + ((colorName__soy59) ? 'color: ' + soy.$$escapeHtml(colorName__soy59) + ';' : '') + ((bgColor__soy60) ? 'background-color: ' + soy.$$escapeHtml(bgColor__soy60) + ';' : '') + ((borderColor__soy61) ? 'border-color: ' + soy.$$escapeHtml(borderColor__soy61) + ';' : '') + '" >' + ((opt_data.iconUrl) ? '<img class="icon" src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" title="Icon"/>&nbsp;' : '') + soy.$$escapeHtml(opt_data.issueStatusName) + '</span>';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.jiraStatus.soyTemplateName = 'PlaySQL.Requirements.jiraStatus';
}


PlaySQL.Requirements.showErrorsAndWarnings = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '';
  if (opt_data.errors) {
    var errorList89 = opt_data.errors;
    var errorListLen89 = errorList89.length;
    for (var errorIndex89 = 0; errorIndex89 < errorListLen89; errorIndex89++) {
      var errorData89 = errorList89[errorIndex89];
      output += '<div class="aui-message aui-message-error"><p class="title"><strong>' + soy.$$escapeHtml(opt_data.title != null ? opt_data.title : 'Error') + '</strong></p><p>' + soy.$$escapeHtml(errorData89) + '</p></div>';
    }
  }
  if (opt_data.warnings) {
    var warningList98 = opt_data.warnings;
    var warningListLen98 = warningList98.length;
    for (var warningIndex98 = 0; warningIndex98 < warningListLen98; warningIndex98++) {
      var warningData98 = warningList98[warningIndex98];
      output += '<div class="aui-message aui-message-warning"><p class="title"><strong>' + soy.$$escapeHtml(opt_data.title != null ? opt_data.title : 'Warning') + '</strong></p><p>' + soy.$$escapeHtml(warningData98) + '</p></div>';
    }
  }
  if (opt_data.infos) {
    var infoList107 = opt_data.infos;
    var infoListLen107 = infoList107.length;
    for (var infoIndex107 = 0; infoIndex107 < infoListLen107; infoIndex107++) {
      var infoData107 = infoList107[infoIndex107];
      output += '<div class="aui-message"><p class="title"><strong>' + soy.$$escapeHtml(opt_data.title != null ? opt_data.title : 'Info') + '</strong></p><p>' + soy.$$escapeHtml(infoData107) + '</p></div>';
    }
  }
  if (opt_data.success) {
    var itemList116 = opt_data.success;
    var itemListLen116 = itemList116.length;
    for (var itemIndex116 = 0; itemIndex116 < itemListLen116; itemIndex116++) {
      var itemData116 = itemList116[itemIndex116];
      output += '<div class="aui-message aui-message-confirmation aui-message-success"><p class="title"><strong>' + soy.$$escapeHtml(opt_data.title != null ? opt_data.title : 'Success') + '</strong></p><p>' + soy.$$escapeHtml(itemData116) + '</p></div>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.showErrorsAndWarnings.soyTemplateName = 'PlaySQL.Requirements.showErrorsAndWarnings';
}


PlaySQL.Requirements.linkToPage = function(opt_data, opt_ignored) {
  var output = '<li>';
  if (opt_data.ref.type == 'excel') {
    output += '<span class="aui-lozenge aui-lozenge-success">Excel</span>&nbsp;<a href="' + soy.$$escapeHtml(opt_data.ref.url != null ? opt_data.ref.url : '') + '" title="Document ID: ' + soy.$$escapeHtml(opt_data.ref.documentId != null ? opt_data.ref.documentId : '') + ' - Document version ID: ' + soy.$$escapeHtml(opt_data.ref.documentVersionId != null ? opt_data.ref.documentVersionId : 'current') + '">' + soy.$$escapeHtml(opt_data.ref.title != null ? opt_data.ref.title : 'Attachment: ' + opt_data.ref.attachmentId) + '</a>';
  } else if (opt_data.ref.type == 'imported') {
    output += '<span class="aui-lozenge aui-lozenge-success">Imported</span>&nbsp;<a href="' + soy.$$escapeHtml(opt_data.ref.url != null ? opt_data.ref.url : '') + '" title="Document ID: ' + soy.$$escapeHtml(opt_data.ref.documentId != null ? opt_data.ref.documentId : '') + ' - Document version ID: ' + soy.$$escapeHtml(opt_data.ref.documentVersionId != null ? opt_data.ref.documentVersionId : 'current') + '">' + soy.$$escapeHtml(opt_data.ref.title != null ? opt_data.ref.title : 'Attachment: ' + opt_data.ref.attachmentId) + '</a>';
  } else {
    output += '<span class="aui-lozenge aui-lozenge-success">Original</span>&nbsp;';
    var title__soy148 = '' + ((opt_data.ref.title && opt_data.ref.title.length > 2) ? soy.$$escapeHtml(opt_data.ref.title) : (opt_data.ref.type && opt_data.ref.type.length > 2) ? soy.$$escapeHtml(opt_data.ref.type) : 'Page: ' + soy.$$escapeHtml(opt_data.ref.pageId));
    output += '<a href="' + soy.$$escapeHtml(opt_data.ref.url != null ? opt_data.ref.url : '#') + '" title="Page id: ' + soy.$$escapeHtml(opt_data.ref.pageId) + ((opt_data.ref.version) ? ' - Version: ' + soy.$$escapeHtml(opt_data.ref.version) : '') + '">' + soy.$$escapeHtml(title__soy148) + '</a>' + ((opt_data.ref.type && ! opt_data.ref.type == 'page') ? ' (' + soy.$$escapeHtml(opt_data.ref.type) + ') ' : '');
  }
  output += '</li>';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.linkToPage.soyTemplateName = 'PlaySQL.Requirements.linkToPage';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.requirementyogi:requirement-view', location = 'js/requirements-search-result.soy' */
// This file was automatically generated from requirements-search-result.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace PlaySQL.Requirements.
 */

if (typeof PlaySQL == 'undefined') { var PlaySQL = {}; }
if (typeof PlaySQL.Requirements == 'undefined') { PlaySQL.Requirements = {}; }


PlaySQL.Requirements.requirementFilters = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.filterSuggestions.length > 0) {
    output += '<select class="requirement-action" id="ry-filter-suggestions-select" placeholder="Filters" style="width: 200px" ><option value="">Filters</option>';
    var keyList6 = opt_data.filterSuggestions;
    var keyListLen6 = keyList6.length;
    for (var keyIndex6 = 0; keyIndex6 < keyListLen6; keyIndex6++) {
      var keyData6 = keyList6[keyIndex6];
      output += '<optgroup class="ry-filter-suggestion-section" label="' + soy.$$escapeHtml(keyData6.left) + '">';
      var suggestionList10 = keyData6.right;
      var suggestionListLen10 = suggestionList10.length;
      for (var suggestionIndex10 = 0; suggestionIndex10 < suggestionListLen10; suggestionIndex10++) {
        var suggestionData10 = suggestionList10[suggestionIndex10];
        output += '<option value="' + soy.$$escapeHtml(suggestionData10.url) + '">&nbsp;&nbsp;&nbsp;&nbsp;' + soy.$$escapeHtml(suggestionData10.label) + '<span class="ry-filter-count"> (x' + soy.$$escapeHtml(suggestionData10.count) + ')</span></option>';
      }
      output += '</optgroup>';
    }
    output += '</select>';
  }
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.requirementFilters.soyTemplateName = 'PlaySQL.Requirements.requirementFilters';
}


PlaySQL.Requirements.description = function(opt_data, opt_ignored) {
  return '<div class="description requirement-action">[ Ctrl + Space ] for help, or lookup the <a href="https://documentation.play-sql.com/display/RY/Search+Syntax">search syntax</a>.</div><div class="description requirement-action">' + soy.$$escapeHtml(opt_data.explanation != null ? opt_data.explanation : '') + '</div>' + ((opt_data.count > 3) ? '<div class="description requirement-action">' + soy.$$escapeHtml(opt_data.count) + ' requirements.</div>' : '');
};
if (goog.DEBUG) {
  PlaySQL.Requirements.description.soyTemplateName = 'PlaySQL.Requirements.description';
}


PlaySQL.Requirements.requirementsSearchPagination = function(opt_data, opt_ignored) {
  return ((opt_data.paginationPrevUrl) ? '<li class="ajs-button normal pagination-for-search-result"><a class="search-result-pagination" href="' + soy.$$escapeHtml(opt_data.paginationPrevUrl) + '" tabindex="5">Previous</a>&nbsp;\u2013</li>' : '<li class="ajs-button normal pagination-for-search-result">Previous&nbsp;\u2013</li>') + '<li class="ajs-button normal pagination-for-search-result" id="pagination-count" data-requirements-count="' + soy.$$escapeHtml(opt_data.paginationCount) + '">' + soy.$$escapeHtml(opt_data.paginationStart) + '-' + soy.$$escapeHtml(opt_data.paginationEnd) + ' of ' + soy.$$escapeHtml(opt_data.paginationCount) + ' results&nbsp;\u2013</li>' + ((opt_data.paginationNextUrl) ? '<li class="ajs-button normal pagination-for-search-result"><a class="search-result-pagination" href="' + soy.$$escapeHtml(opt_data.paginationNextUrl) + '" tabindex="6">Next</a>&nbsp;\u2013</li>' : '<li class="ajs-button normal pagination-for-search-result">Next&nbsp;\u2013</li>');
};
if (goog.DEBUG) {
  PlaySQL.Requirements.requirementsSearchPagination.soyTemplateName = 'PlaySQL.Requirements.requirementsSearchPagination';
}


PlaySQL.Requirements.showResults = function(opt_data, opt_ignored) {
  var output = '<table class="aui aui-table-interactive aui-table-sortable requirement-table ' + ((opt_data.hasArchiveLines) ? ' with-archive' : '') + '"><thead><tr class="tablesorter-headerRow" id="requirements-header-row" ' + ((opt_data.count > 0) ? ' data-requirements-count="' + soy.$$escapeHtml(opt_data.count) + '"' : '') + '>' + ((opt_data.hasRequirementsEditPermission && opt_data.showActions) ? '<th class="tablesorter-header col-tick"><input class="checkbox" type="checkbox" id="select-all" tabindex="11"><a href="#actions" aria-owns="actions" aria-haspopup="true" aria-disabled="true" class="aui-button aui-style-default aui-dropdown2-trigger" id="select-all-actions" tabindex="12">Actions</a><div id="actions" class="aui-style-default aui-dropdown2"><ul class="aui-list-truncate">' + ((opt_data.hasRenamePermission) ? (opt_data.spaceKey) ? '<li><a id="action-rename" href="#" tabindex="13">Rename</a></li>' : '' : '<li aria-disabled="true"><a href="#" tabindex="13" class="playsql-tipsy-west disabled" title="You need to be administrator to rename requirments.">Rename &nbsp;<span class="aui-icon aui-icon-small aui-iconfont-locked">Padlock</span></a></li>') + ((opt_data.spaceKey) ? '<li><a id="action-makebaseline" href="#" tabindex="14">Make baseline</a></li>' : '') + ((opt_data.spaceKey) ? '<li><a id="action-create-jira-issues" href="#" tabindex="14">Create Jira issues</a></li>' : '') + ((opt_data.spaceKey) ? (opt_data.isRYTestActive) ? '<li><a id="action-createtestingprocedure" href="#" tabindex="14">Create RY Test Session procedure</a></li>' : '' : '') + '<li><a id="action-generatediff" href="#" tabindex="14">Generate Diff</a></li></ul></div></th>' : '') + '<th class="tablesorter-header col-key">' + ((opt_data.toAddToBaseline) ? ' <input class="checkbox" type="checkbox" id="select-all" tabindex="11">' : '') + ' Key</th><th class="tablesorter-header col-description">Description</th><th class="tablesorter-header col-links">Links</th></tr></thead><tbody>';
  var previousKey__soy94 = '';
  if (opt_data.count == 0) {
    output += '<tr><td colspan="4"><i>No requirement found.</i></td></tr>';
  } else {
    var tabindex__soy99 = 14;
    var resultList100 = opt_data.results;
    var resultListLen100 = resultList100.length;
    for (var resultIndex100 = 0; resultIndex100 < resultListLen100; resultIndex100++) {
      var resultData100 = resultList100[resultIndex100];
      var index__soy101 = tabindex__soy99 + 1 + resultIndex100;
      output += '<tr class="req-status-' + soy.$$escapeHtml(resultData100.status) + ((resultData100.status == 'ARCHIVED') ? ' is-archive-after-current' : '') + '">' + ((opt_data.hasRequirementsEditPermission || opt_data.toAddToBaseline) ? '<td class="col-tick"><input class="checkbox checkbox-requirement" type="checkbox" name="search-checkbox-' + soy.$$escapeHtml(resultData100.key) + '" id="search-checkbox-' + soy.$$escapeHtml(resultData100.key) + '" data-requirement-key="' + soy.$$escapeHtml(resultData100.key) + '" data-baseline="' + soy.$$escapeHtml(resultData100.baseline != null ? resultData100.baseline : '') + '" tabindex="' + soy.$$escapeHtml(index__soy101) + '"></td>' : '') + '<td class="col-key">' + PlaySQL.Requirements.renderRequirement({req: resultData100}) + '</td>';
      var html__soy125 = resultData100.htmlExcerpt != null ? resultData100.htmlExcerpt : '';
      output += '<td class="col-description">' + ((previousKey__soy94 == resultData100.key) ? '<span class="aui-lozenge">Removed</span>' : (resultData100.status == 'MOVED') ? '<span class="aui-lozenge aui-lozenge-moved">Moved</span>' : (resultData100.duplicateOriginalPages) ? '<span class="aui-lozenge aui-lozenge-error">Please fix: Defined on two pages</span>' : '') + soy.$$filterNoAutoescape(html__soy125) + '</td><td class="col-links"><ul>' + PlaySQL.Requirements.listRequirementsDetails({result: resultData100}) + '</ul></td></tr>';
    }
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.showResults.soyTemplateName = 'PlaySQL.Requirements.showResults';
}


PlaySQL.Requirements.listRequirementsDetails = function(opt_data, opt_ignored) {
  var output = '';
  if (! opt_data.result.origin) {
  } else if (opt_data.result.origin.type == 'page' || opt_data.result.origin.type == 'imported' || opt_data.result.origin.type == 'excel') {
    if (opt_data.result.duplicateOriginalPages && opt_data.result.duplicateOriginalPages.length > 0) {
      var duplicateList148 = opt_data.result.duplicateOriginalPages;
      var duplicateListLen148 = duplicateList148.length;
      for (var duplicateIndex148 = 0; duplicateIndex148 < duplicateListLen148; duplicateIndex148++) {
        var duplicateData148 = duplicateList148[duplicateIndex148];
        output += PlaySQL.Requirements.linkToPage({ref: duplicateData148});
      }
    } else {
      output += PlaySQL.Requirements.linkToPage({ref: opt_data.result.origin});
    }
  } else if (opt_data.result.status == 'MOVED') {
    output += '<li>This requirement was moved to ' + soy.$$escapeHtml(opt_data.result.newSpaceKey) + '</li>';
  } else if (opt_data.result.status == 'ACTIVE') {
    output += (opt_data.result.isExcelReq) ? '<li><span class="aui-lozenge aui-lozenge-success">Excel</span></li>' : '<li>This requirement was inserted by a user on a draft, but the page hasn\'t been created yet.<a href="#" class="delete-requirement" data-space-key="' + soy.$$escapeHtml(opt_data.result.spaceKey) + '" data-key="' + soy.$$escapeHtml(opt_data.result.key) + '">Delete now</a>.</li>';
  }
  var depList169 = opt_data.result.dependencies;
  var depListLen169 = depList169.length;
  for (var depIndex169 = 0; depIndex169 < depListLen169; depIndex169++) {
    var depData169 = depList169[depIndex169];
    output += '<li><span class="aui-lozenge aui-lozenge-default" title="cites">PARENT &#8599;</span>&nbsp;<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(depData169.url) + '">' + soy.$$escapeHtml(depData169.key) + ' ' + ((depData169.baseline) ? ' v' + soy.$$escapeHtml(depData169.baseline) : '') + '</a>' + ((opt_data.result.spaceKey != depData169.spaceKey) ? ' in space \'' + soy.$$escapeHtml(depData169.spaceKey) + '\'&nbsp;' : '') + '(' + soy.$$escapeHtml(depData169.relationship) + ')</li>';
  }
  var depList190 = opt_data.result.reverseDependencies;
  var depListLen190 = depList190.length;
  for (var depIndex190 = 0; depIndex190 < depListLen190; depIndex190++) {
    var depData190 = depList190[depIndex190];
    output += '<li><span class="aui-lozenge aui-lozenge-default" title="is cited by">CHILD &#8600;</span>&nbsp;<a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(depData190.url) + '">' + soy.$$escapeHtml(depData190.key) + ' ' + ((depData190.baseline) ? ' v' + soy.$$escapeHtml(depData190.baseline) : '') + '</a>' + ((opt_data.result.spaceKey != depData190.spaceKey) ? ' in space \'' + soy.$$escapeHtml(depData190.spaceKey) + '\'&nbsp;' : '') + '(' + soy.$$escapeHtml(depData190.relationship) + ')</li>';
  }
  var pageList211 = opt_data.result.references;
  var pageListLen211 = pageList211.length;
  for (var pageIndex211 = 0; pageIndex211 < pageListLen211; pageIndex211++) {
    var pageData211 = pageList211[pageIndex211];
    output += (! pageData211.isCoveredByDependency) ? '<li><span class="aui-lozenge aui-lozenge-moved">Link</span>&nbsp;<a href="' + soy.$$escapeHtml(pageData211.url) + '">' + soy.$$escapeHtml(pageData211.title) + '</a></li>' : '';
  }
  var issueList220 = opt_data.result.issues;
  var issueListLen220 = issueList220.length;
  for (var issueIndex220 = 0; issueIndex220 < issueListLen220; issueIndex220++) {
    var issueData220 = issueList220[issueIndex220];
    output += '<li><span class="aui-lozenge aui-lozenge-new">Jira</span>&nbsp;(' + soy.$$escapeHtml(issueData220.relationship) + ') &nbsp;<a href="' + soy.$$escapeHtml(issueData220.url) + '">' + soy.$$escapeHtml(issueData220.issueKey) + '</a> ' + soy.$$escapeHtml(issueData220.title) + '</li>';
  }
  var propList231 = opt_data.result.properties;
  var propListLen231 = propList231.length;
  for (var propIndex231 = 0; propIndex231 < propListLen231; propIndex231++) {
    var propData231 = propList231[propIndex231];
    output += (propData231.key && propData231.key[0] != '_' && propData231.display) ? '<li>' + soy.$$escapeHtml(propData231.key) + ': ' + soy.$$filterNoAutoescape(propData231.value != null ? propData231.value : '') + ((propData231.type == 'EXTERNAL') ? ' *' : '') + '</li>' : '';
  }
  if (opt_data.result.tests) {
    var relationshipList246 = soy.$$getMapKeys(opt_data.result.tests);
    var relationshipListLen246 = relationshipList246.length;
    for (var relationshipIndex246 = 0; relationshipIndex246 < relationshipListLen246; relationshipIndex246++) {
      var relationshipData246 = relationshipList246[relationshipIndex246];
      output += '</ul><p>' + soy.$$escapeHtml(relationshipData246) + ':</p><ul>';
      var testRefList250 = opt_data.result.tests[relationshipData246];
      var testRefListLen250 = testRefList250.length;
      for (var testRefIndex250 = 0; testRefIndex250 < testRefListLen250; testRefIndex250++) {
        var testRefData250 = testRefList250[testRefIndex250];
        output += '<li>' + ((testRefData250.result && testRefData250.result != '') ? '<a href="' + soy.$$escapeHtml(testRefData250.url) + '" title="' + soy.$$escapeHtml(testRefData250.dateCreation) + '">' + soy.$$filterNoAutoescape(testRefData250.resultRendered != null ? testRefData250.resultRendered : '(no result)') + ' </a>' : '<a href="' + soy.$$escapeHtml(testRefData250.url) + '" title="' + soy.$$escapeHtml(testRefData250.dateCreation) + '">(no result) </a>') + 'on page \'' + soy.$$escapeHtml(testRefData250.title) + '\'</li>';
      }
    }
  }
  return output;
};
if (goog.DEBUG) {
  PlaySQL.Requirements.listRequirementsDetails.soyTemplateName = 'PlaySQL.Requirements.listRequirementsDetails';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-loader', location = 'com/atlassian/confluence/plugins/createjiracontent/js/page-helper.js' */
AJS.toInit(function(e){var h="Loading...",f=!1,c=e("div.jira-issues-created");if(0<c.length){if(window.history&&window.history.replaceState){var d=window.location.href;d=d.substr(0,d.indexOf("JIRAIssuesCreated")-1);window.history.replaceState({},document.title,d)}var k=c.find("#jira-content-message-panel-error-warning"),g=c.find("#jira-content-message-panel-view-more-link");g.click(function(a){a.preventDefault();g.hide();k.show()});c.hasClass("success")&&
setTimeout(function(){c.hide()},1E4)}Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-jira-content:create-Jira-issue-summary",{onClick:function(a){if(!f){var b=e("\x3cdiv\x3e");Confluence.CreateJiraContent.Dialogs.appendDialogTarget(a.area.average,b);dialog=Confluence.ScrollingInlineDialog(b,"create-issue-loading-dialog",function(a,b,c){a.html('\x3cspan class\x3d"aui-icon aui-icon-wait"\x3e\x3c/span\x3e '+h);c();
return!1},{});dialog.show();f=!0}WRM.require("wr!com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources").done(function(){Confluence.CreateJiraContent.FeatureDiscovery.shouldShowFeatureDiscovery()?Confluence.CreateJiraContent.Dialogs.showFeatureDiscoveryDialog(a):Confluence.CreateJiraContent.Dialogs.showCreateIssueDialog(a);"undefined"!==typeof b&&b.remove()})},shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY});Confluence.CreateJiraContent=
{Dialogs:{}};Confluence.CreateJiraContent.Dialogs.appendDialogTarget=function(a,b){Confluence.DocThemeUtils.appendAbsolutePositionedElement(b);b.css({top:a.top,height:a.height,left:a.left,width:a.width,"z-index":-9999,position:"absolute"}).addClass("confluence-jira-content-dialog-target")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:soy-resources', location = 'soy/sidebar.soy' */
// This file was automatically generated from sidebar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Sidebar.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Sidebar == 'undefined') { Confluence.Templates.Sidebar = {}; }


Confluence.Templates.Sidebar.headerStyles = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.sidebarWidth) ? '<style>.ia-fixed-sidebar, .ia-splitter-left {width: ' + soy.$$escapeHtml(opt_data.sidebarWidth) + 'px;}.theme-default .ia-splitter #main {margin-left: ' + soy.$$escapeHtml(opt_data.sidebarWidth) + 'px;}.ia-fixed-sidebar {visibility: hidden;}</style>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.headerStyles.soyTemplateName = 'Confluence.Templates.Sidebar.headerStyles';
}


Confluence.Templates.Sidebar.sidebar = function(opt_data, opt_ignored) {
  return '<div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="' + soy.$$escapeHtml('Edit space details') + '"><div class="avatar"><div class="space-logo" data-key="' + soy.$$escapeHtml(opt_data.space.key) + '" data-name="' + soy.$$escapeHtml(opt_data.space.name) + '" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="' + soy.$$escapeHtml(opt_data.space.homeUrl) + '" title="' + soy.$$escapeHtml(opt_data.space.name) + '"><img class="avatar-img" src="' + soy.$$escapeHtml(opt_data.space.logoUrl) + '" alt="' + soy.$$escapeHtml(opt_data.space.name) + '"></a></div></div></div></div><div class="space-information-container"><div class="name"><a href="' + soy.$$escapeHtml(opt_data.space.homeUrl) + '" title="' + soy.$$escapeHtml(opt_data.space.name) + '">' + soy.$$escapeHtml(opt_data.space.name) + '</a></div><div class="flyout-handle icon aui-icon aui-icon-small aui-iconfont-edit"></div>' + ((opt_data.hasFavouriteSpacePermission || opt_data.accessMode == 'READ_ONLY') ? '<div class="favourite-space-icon ' + ((opt_data.accessMode == 'READ_ONLY') ? 'disabled' : '') + '">' + Confluence.Templates.Sidebar.renderFavouriteSpace(opt_data) + '</div>' : '') + '</div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="' + soy.$$escapeHtml(opt_data.hasCreatePermission) + '" data-quick-links-state="' + soy.$$escapeHtml(opt_data.quickLinksState) + '" data-page-tree-state="' + soy.$$escapeHtml(opt_data.pageTreeState) + '" data-nav-type="' + soy.$$escapeHtml(opt_data.navType) + '">' + Confluence.Templates.Sidebar.renderLinks(opt_data) + '</div></div>' + ((opt_data.contextualNav) ? Confluence.Templates.Sidebar.contextualNav(opt_data) : '') + '</div><div class="hidden"><a href="' + soy.$$escapeHtml(opt_data.space.browseSpaceUrl) + '" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>' + soy.$$escapeHtml('Space Details') + '</h2><div class="personal-space-logo-hint">' + soy.$$filterNoAutoescape(AJS.format('Your profile picture is used as the logo for your personal space. \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eChange your profile picture\x3c/a\x3e.',"" + '/users/profile/editmyprofilepicture.action')) + '</div><\/script></div></div>' + Confluence.Templates.Sidebar.renderSpaceToolsSection({advancedLinks: opt_data.advancedLinks, hasConfigurePermission: opt_data.hasConfigurePermission, currentlyViewed: opt_data.collectorToHighlight == 'spacebar-advanced', pageTreeState: opt_data.pageTreeState});
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.sidebar.soyTemplateName = 'Confluence.Templates.Sidebar.sidebar';
}


Confluence.Templates.Sidebar.renderFavouriteSpace = function(opt_data, opt_ignored) {
  return '<button class="' + ((opt_data.isFavouriteSpace) ? 'space-favourite-hidden ' : '') + 'space-favourite aui-icon aui-icon-small aui-iconfont-unstar" id="space-favourite-add" title="' + soy.$$escapeHtml('Add to my spaces') + '" aria-pressed="false"></button><button class="' + ((! opt_data.isFavouriteSpace) ? 'space-favourite-hidden ' : '') + 'space-favourite aui-icon aui-icon-small aui-iconfont-star" id="space-favourite-remove" title="' + soy.$$escapeHtml('Remove from my spaces') + '" aria-pressed="false"></button>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderFavouriteSpace.soyTemplateName = 'Confluence.Templates.Sidebar.renderFavouriteSpace';
}


Confluence.Templates.Sidebar.renderLinks = function(opt_data, opt_ignored) {
  return '<div class="acs-nav-sections">' + ((opt_data.mainLinks.length) ? Confluence.Templates.Sidebar.renderLinksSection({links: opt_data.mainLinks, sectionClass: 'main-links-section', collectorToHighlight: opt_data.collectorToHighlight}) : '') + ((opt_data.quickLinksState != 'hide') ? '<div class="quick-links-wrapper">' + ((opt_data.quickLinks.length) ? '<h5 class="ia-quick-links-header-title">' + soy.$$escapeHtml('Space shortcuts') + '</h5>' + Confluence.Templates.Sidebar.renderLinksSection({links: opt_data.quickLinks, sectionClass: 'quick-links-section tipsy-enabled', collectorToHighlight: null}) : (opt_data.hasConfigurePermission) ? '<h5 class="ia-quick-links-header-title">' + soy.$$escapeHtml('Space shortcuts') + '</h5><p class="tip">' + soy.$$filterNoAutoescape(AJS.format('Here you can add shortcut links to the most important content for your team or project. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3eConfigure sidebar\x3c/a\x3e.','','configure-sidebar')) + '</p>' : '') + '</div>' : '') + ((opt_data.hasSidebarCustomisation) ? Confluence.Templates.Sidebar.renderCustomContent(opt_data) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderLinks.soyTemplateName = 'Confluence.Templates.Sidebar.renderLinks';
}


Confluence.Templates.Sidebar.renderCustomContent = function(opt_data, opt_ignored) {
  return '<div class="custom-sidebar"><div class="custom-sidebar-content"><div class="content">' + soy.$$filterNoAutoescape(opt_data.sidebarCustomisation) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderCustomContent.soyTemplateName = 'Confluence.Templates.Sidebar.renderCustomContent';
}


Confluence.Templates.Sidebar.renderLinksSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.links.length) {
    output += '<div class="' + soy.$$escapeHtml(opt_data.sectionClass) + ' ' + ((opt_data.highlightSection) ? ' current-section' : '') + '"><ul class="acs-nav-list">';
    var linkList138 = opt_data.links;
    var linkListLen138 = linkList138.length;
    for (var linkIndex138 = 0; linkIndex138 < linkListLen138; linkIndex138++) {
      var linkData138 = linkList138[linkIndex138];
      output += '<li class="acs-nav-item ' + soy.$$escapeHtml(linkData138.styleClass) + ((opt_data.collectorToHighlight && linkData138.collectorKey == opt_data.collectorToHighlight) ? ' current-item" aria-current="true' : '') + '"' + ((linkData138.collectorKey) ? ' data-collector-key="' + soy.$$escapeHtml(linkData138.collectorKey) + '"' : '') + '><a class="acs-nav-item-link tipsy-enabled" href="' + soy.$$escapeHtml(linkData138.url) + '" data-collapsed-tooltip="' + soy.$$escapeHtml(linkData138.tooltip) + '">' + ((linkData138.styleClass == 'pinned_attachment') ? '<span class="aui-icon aui-icon-small aui-iconfont-attachment"></span>' : '<span class="icon"></span>') + '<span class="acs-nav-item-label">' + soy.$$escapeHtml(linkData138.title) + '</span></a></li>';
    }
    output += '</ul></div>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderLinksSection.soyTemplateName = 'Confluence.Templates.Sidebar.renderLinksSection';
}


Confluence.Templates.Sidebar.contextualNav = function(opt_data, opt_ignored) {
  return '<div class="ia-secondary-container tipsy-enabled" data-tree-type="' + ((opt_data.forBlogs) ? 'blogs' : (opt_data.forSettings) ? 'settings' : soy.$$escapeHtml(opt_data.navType)) + '">' + ((opt_data.pageTreeState != 'hide') ? (opt_data.forBlogs) ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title blog"><span class="icon"></span><span class="label">' + soy.$$escapeHtml('Blog') + '</span></h5></div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.contextualNav}) + '</div>' : (opt_data.forSettings) ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title settings"><span class="label">' + soy.$$escapeHtml('Advanced') + '</span></h5></div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.contextualNav}) + '</div>' : (opt_data.navType == 'page-tree') ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title page-tree"><span class="icon"></span><span class="label">' + soy.$$escapeHtml('Page tree') + '</span></h5></div>' + ((opt_data.pageTreeEmpty && opt_data.hasCreatePermission) ? '<p class="tip">' + soy.$$filterNoAutoescape(AJS.format('Get started by adding some pages to this space. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3eCreate page\x3c/a\x3e.',"" + '/pages/createpage.action?spaceKey=' + opt_data.space.key,'page-tree-create-child-page-link')) + '</p>' : '<div class="ia-secondary-content">' + soy.$$filterNoAutoescape(opt_data.contextualNav) + '</div>') : Confluence.Templates.Sidebar.Pages.renderPageContextualNav({pageContextualNav: opt_data.contextualNav, hasCreatePermission: opt_data.hasCreatePermission}) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.contextualNav.soyTemplateName = 'Confluence.Templates.Sidebar.contextualNav';
}


Confluence.Templates.Sidebar.pagetreeList = function(opt_data, opt_ignored) {
  var output = '<ul class="' + ((opt_data.isSubtree) ? 'ia-subpagetree' : 'ia-pagetree') + '">';
  var itemList220 = opt_data.pagetree;
  var itemListLen220 = itemList220.length;
  for (var itemIndex220 = 0; itemIndex220 < itemListLen220; itemIndex220++) {
    var itemData220 = itemList220[itemIndex220];
    output += Confluence.Templates.Sidebar.pagetreeItem(itemData220);
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.pagetreeList.soyTemplateName = 'Confluence.Templates.Sidebar.pagetreeList';
}


Confluence.Templates.Sidebar.throbber = function(opt_data, opt_ignored) {
  return '<div class="content-container"><div class="throbber-container"><div class="throbber"><div class="spinner"></div><span>' + soy.$$escapeHtml('Loading...') + '</span></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.throbber.soyTemplateName = 'Confluence.Templates.Sidebar.throbber';
}


Confluence.Templates.Sidebar.treeThrobber = function(opt_data, opt_ignored) {
  return '<ul class="ia-subpagetree"><li class="acs-tree-item leaf"><span class="node-title">' + soy.$$escapeHtml('Loading...') + '</span></li></ul>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.treeThrobber.soyTemplateName = 'Confluence.Templates.Sidebar.treeThrobber';
}


Confluence.Templates.Sidebar.pagetreeItem = function(opt_data, opt_ignored) {
  return '<li class="acs-tree-item' + ((opt_data.hasChildren) ? (opt_data.children.length) ? ' opened' : ' closed' : ' leaf') + ((opt_data.groupType) ? ' grouping' : '') + ((opt_data.active) ? ' current-item' : '') + '"' + ((opt_data.pageId) ? ' data-page-id="' + soy.$$escapeHtml(opt_data.pageId) + '"' : '') + ((opt_data.groupType) ? ' data-group-type="' + soy.$$escapeHtml(opt_data.groupType) + '" data-group-value="' + soy.$$escapeHtml(opt_data.groupValue) + '"' : '') + ((opt_data.hasChildren) ? ' aria-expanded="' + ((opt_data.children.length) ? 'true' : 'false') + '"' : '') + '>' + ((! opt_data.groupType) ? '<a href="' + soy.$$escapeHtml(opt_data.url) + '">' : '') + '<span class="icon aui-icon aui-icon-small ' + ((opt_data.hasChildren) ? (opt_data.children.length) ? 'aui-iconfont-expanded' : 'aui-iconfont-collapsed' : '') + '"></span><span class="node-title navigation-pseudo-link">' + soy.$$escapeHtml(opt_data.title) + '</span>' + ((! opt_data.groupType) ? '</a>' : '') + ((opt_data.children && opt_data.children.length > 0) ? Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.children, isSubtree: true}) : '') + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.pagetreeItem.soyTemplateName = 'Confluence.Templates.Sidebar.pagetreeItem';
}


Confluence.Templates.Sidebar.renderSpaceToolsSection = function(opt_data, opt_ignored) {
  var output = '<div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden">';
  var linkList299 = opt_data.advancedLinks;
  var linkListLen299 = linkList299.length;
  for (var linkIndex299 = 0; linkIndex299 < linkListLen299; linkIndex299++) {
    var linkData299 = linkList299[linkIndex299];
    output += '<div data-label="' + soy.$$escapeHtml(linkData299.title) + '" data-class="' + soy.$$escapeHtml(linkData299.styleClass) + '" data-href="' + soy.$$escapeHtml(linkData299.url) + '">' + soy.$$escapeHtml(linkData299.title) + '</div>';
  }
  output += ((opt_data.hasConfigurePermission) ? '<div data-label="' + soy.$$escapeHtml('Configure sidebar') + '" data-class="configure-sidebar" data-href="">' + soy.$$escapeHtml('Configure sidebar') + '</div>' : '') + '</div>' + aui.dropdown2.trigger({id: 'space-tools-menu-trigger', tagName: 'button', content: '<span class="aui-icon aui-icon-small aui-iconfont-configure">' + soy.$$escapeHtml('Configure') + '</span><span class="aui-button-label">' + soy.$$escapeHtml('Space tools') + '</span>', extraClasses: 'aui-button aui-button-subtle tipsy-enabled aui-dropdown2-trigger-arrowless ' + ((opt_data.currentlyViewed) ? ' current-item' : ''), menu: {id: 'space-tools-menu'}}) + aui.dropdown2.contents({id: 'space-tools-menu', extraClasses: 'aui-style-default space-tools-dropdown', extraAttributes: {'data-aui-alignment': 'top left'}}) + '<a href="#" role="button" class="expand-collapse-trigger aui-icon aui-icon-small ' + ((opt_data.pageTreeState == 'hide') ? 'aui-iconfont-chevron-double-right" aria-expanded="false"' : 'aui-iconfont-chevron-double-left" aria-expanded="true"') + '></a></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderSpaceToolsSection.soyTemplateName = 'Confluence.Templates.Sidebar.renderSpaceToolsSection';
}


Confluence.Templates.Sidebar.spaceToolsMenu = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.isAuiFiveSeven) {
    output += '<div class="space-tools-menu"><div class="aui-dropdown2-section"><ul class="space-tools-navigation">';
    var linkList348 = opt_data.spaceToolLinks;
    var linkListLen348 = linkList348.length;
    for (var linkIndex348 = 0; linkIndex348 < linkListLen348; linkIndex348++) {
      var linkData348 = linkList348[linkIndex348];
      output += '<li><a href="' + soy.$$escapeHtml(linkData348.href) + '" title="' + soy.$$escapeHtml(linkData348.label) + '">' + soy.$$escapeHtml(linkData348.label) + '</a></li>';
    }
    output += '</ul></div>';
    if (opt_data.spaceLinks.length > 0) {
      output += '<div class="aui-dropdown2-section"><ul class="space-operations">';
      var linkList361 = opt_data.spaceLinks;
      var linkListLen361 = linkList361.length;
      for (var linkIndex361 = 0; linkIndex361 < linkListLen361; linkIndex361++) {
        var linkData361 = linkList361[linkIndex361];
        output += '<li><a class="' + soy.$$escapeHtml(linkData361.className) + '" href="' + soy.$$escapeHtml(linkData361.href) + '" title="' + soy.$$escapeHtml(linkData361.label) + '">' + soy.$$escapeHtml(linkData361.label) + '</a></li>';
      }
      output += '</ul></div>';
    }
    output += '</div>';
  } else {
    output += aui.dropdown2.itemGroup({isTruncated: true, items: opt_data.spaceToolLinks, extraClasses: 'space-tools-navigation'}) + ((opt_data.spaceLinks.length > 0) ? aui.dropdown2.itemGroup({isTruncated: true, items: opt_data.spaceLinks, extraClasses: 'space-operations'}) : '');
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.spaceToolsMenu.soyTemplateName = 'Confluence.Templates.Sidebar.spaceToolsMenu';
}


Confluence.Templates.Sidebar.configure = function(opt_data, opt_ignored) {
  return '<div class="acs-nav-sections"><table id="acs-nav-list-main" class="acs-nav-list"></table><div class="acs-nav-list-quick-section' + ((opt_data.quickLinksState == 'hide') ? ' hidden-section' : '') + '"><div class="quick-links-header"><h5>' + soy.$$escapeHtml('Space shortcuts') + '</h5><a href="#" class="aui-icon aui-icon-small toggle-link ' + ((opt_data.quickLinksState == 'hide') ? 'aui-iconfont-add-circle" aria-disabled="true"' : 'aui-iconfont-plan-disabled" aria-disabled="false"') + ' data-tooltip="' + soy.$$escapeHtml('Hide/Show space shortcuts') + '"></a></div><table id="acs-nav-list-quick" class="acs-nav-list"></table><p class="tip">' + soy.$$escapeHtml('Click \x22Add link\x22 to add links to the sidebar.') + '</p><a class="acs-add-link" href="#"><span class="aui-icon aui-icon-small aui-iconfont-add-small"></span><span class="label">' + soy.$$escapeHtml('Add link') + '</span></a></div>' + ((opt_data.hasSidebarCustomisation) ? '<p class="tip">' + soy.$$filterNoAutoescape(AJS.format('You can continue editing your customized sidebar in the space admin. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3eGo to space admin\x3c/a\x3e.',opt_data.customContentAdminLink,'custom-sidebar-tip')) + '</p>' + Confluence.Templates.Sidebar.renderCustomContent(opt_data) : '') + '<div class="acs-nav-list-page-tree-section' + ((opt_data.pageTreeState == 'hide') ? ' hidden-section' : '') + '"><div class="page-tree-header"><h5>' + soy.$$escapeHtml('Navigation display options') + '</h5><a href="#" class="aui-icon aui-icon-small ' + ((opt_data.pageTreeState == 'hide') ? 'aui-iconfont-add-circle" aria-disabled="true"' : 'aui-iconfont-plan-disabled" aria-disabled="false"') + ' data-tooltip="' + soy.$$escapeHtml('Hide/Show navigation display options') + '"></a></div><form class="aui page-tree-options"><div class="radio"><input ' + ((opt_data.pageTreeState == 'hide') ? 'disabled ' : '') + ' class="radio acs-nav-type" type="radio" name="nav-type" value="pages" id="nav-type-pages" ' + ((! opt_data.pageTree) ? 'checked' : '') + '><label for="nav-type-pages">' + soy.$$escapeHtml('Child pages') + '</label></div><div class="radio"><input ' + ((opt_data.pageTreeState == 'hide') ? 'disabled ' : '') + ' class="radio acs-nav-type" type="radio" name="nav-type" value="page-tree" id="nav-type-tree" ' + ((opt_data.pageTree) ? 'checked' : '') + '><label for="nav-type-tree">' + soy.$$escapeHtml('Page tree') + '</label></div></form></div><button class="aui-style aui-button acs-done-link">' + soy.$$escapeHtml('Done') + '</button></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.configure.soyTemplateName = 'Confluence.Templates.Sidebar.configure';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:soy-resources', location = 'soy/sidebar-pages.soy' */
// This file was automatically generated from sidebar-pages.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Sidebar.Pages.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Sidebar == 'undefined') { Confluence.Templates.Sidebar = {}; }
if (typeof Confluence.Templates.Sidebar.Pages == 'undefined') { Confluence.Templates.Sidebar.Pages = {}; }


Confluence.Templates.Sidebar.Pages.renderPageContextualNav = function(opt_data, opt_ignored) {
  return '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">' + soy.$$escapeHtml('Child pages') + '</span></h5></div><div class="ia-secondary-parent-content">' + Confluence.Templates.Sidebar.Pages.parentPage({parentPage: opt_data.pageContextualNav.parentPage}) + '</div><div class="ia-secondary-current-content">' + Confluence.Templates.Sidebar.Pages.currentPage({currentPage: opt_data.pageContextualNav.currentPage}) + '</div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.Pages.childPages({children: opt_data.pageContextualNav, createPermission: opt_data.hasCreatePermission}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.renderPageContextualNav.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.renderPageContextualNav';
}


Confluence.Templates.Sidebar.Pages.childPages = function(opt_data, opt_ignored) {
  return '<div class="contextual-nav-child-pages">' + ((opt_data.children.initialChildPages.length) ? '<ul class="children">' + Confluence.Templates.Sidebar.Pages.renderChildren({children: opt_data.children.initialChildPages}) + '</ul>' + ((opt_data.children.remainingChildPages.length) ? '<ul class="more-children">' + Confluence.Templates.Sidebar.Pages.renderChildren({children: opt_data.children.remainingChildPages}) + '</ul><a class="more-children-link" href=""><span class="icon"></span><span class="label">' + soy.$$escapeHtml(AJS.format('{0} more child pages',opt_data.children.remainingChildPages.length)) + '</span></a>' : '') : '') + ((opt_data.createPermission && opt_data.children.createLink) ? '<a class="create-child-page-link" href="' + soy.$$escapeHtml(opt_data.children.createLink) + '"><span class="aui-icon aui-icon-small aui-iconfont-add-small"></span><span class="label">' + soy.$$escapeHtml('Create child page') + '</span></a>' : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.childPages.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.childPages';
}


Confluence.Templates.Sidebar.Pages.currentPage = function(opt_data, opt_ignored) {
  return '' + ((opt_data.currentPage) ? '<ul class="ia-secondary-currentPage-title wiki' + ((opt_data.currentPage.active) ? ' current-item' : '') + '"><li><span class="icon"></span><span class="label">' + soy.$$escapeHtml(opt_data.currentPage.title) + '</span></li></ul>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.currentPage.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.currentPage';
}


Confluence.Templates.Sidebar.Pages.parentPage = function(opt_data, opt_ignored) {
  return '' + ((opt_data.parentPage) ? '<ul class="parent ia-secondary-header-title wiki' + ((opt_data.parentPage.active) ? ' current-item' : '') + '"><li class="parent-item"><a class="parent-item-link" href="' + soy.$$escapeHtml(opt_data.parentPage.url) + '" title="' + soy.$$escapeHtml(opt_data.parentPage.title) + '"><span class="icon"></span><span class="label">' + soy.$$escapeHtml(opt_data.parentPage.title) + '</span></a></li></ul>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.parentPage.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.parentPage';
}


Confluence.Templates.Sidebar.Pages.renderChildren = function(opt_data, opt_ignored) {
  var output = '';
  var childList65 = opt_data.children;
  var childListLen65 = childList65.length;
  for (var childIndex65 = 0; childIndex65 < childListLen65; childIndex65++) {
    var childData65 = childList65[childIndex65];
    output += '<li class="child-item" data-page-id="' + soy.$$escapeHtml(childData65.pageId) + '"><span class="icon"></span><a href="' + soy.$$escapeHtml(childData65.url) + '" title="' + soy.$$escapeHtml(childData65.title) + '"><span class="label">' + soy.$$escapeHtml(childData65.title) + '</span></a></li>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.renderChildren.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.renderChildren';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.editor-loader:background-loading-editor', location = 'jscripts/editor-loader.js' */
define("confluence-editor-loader/editor-loader","jquery confluence/legacy wrm/context-path confluence/dark-features confluence/api/logger confluence/meta confluence/template-renderer confluence/aui-overrides ajs wrm window".split(" "),function(d,h,n,o,e,i,p,q,f,r,s){var b,c={_listening:false,_queuedHandlers:[],_watchHandler:function(){h.Editor.UI.toggleWatchPage(false)},_unwatchHandler:function(){h.Editor.UI.toggleWatchPage(true)},_createQueueAdder:function(a){return function(){c._listening&&c._queuedHandlers.push(a)}},
bind:function(){f.bind("watchpage.pageoperation",this._createQueueAdder(this._watchHandler));f.bind("unwatchpage.pageoperation",this._createQueueAdder(this._unwatchHandler))},setListening:function(a){this._listening=a},applyHandlers:function(){for(var a=this._queuedHandlers.pop();a;){a();a=this._queuedHandlers.pop()}}};c.setListening(true);c.bind();var l=function(){var a=d("#editor-preload-container");a.length||(a=d('<div id="editor-preload-container" style="display: none;"></div>'));return a},g,
m={getPreloadContainer:l,getEditorPreloadMarkup:function(){if(g)return g;h.debugTime("confluence.editor.preload");var a=n()+"/plugins/editor-loader/editor.action";return g=d.get(a,{parentPageId:i.get("parent-page-id"),pageId:i.get("page-id"),spaceKey:i.get("space-key"),atl_after_login_redirect:s.location.pathname,timeout:m.loadingTimeout})},resourcesLoaded:function(){return b&&b.state()==="resolved"},loadingTimeout:12E3,isEditorActive:function(){var a=d("#editor-preload-container");return a.length&&
a.is(":visible")},load:function(a,c){function g(){var a=[o.isEnabled("frontend.editor.v4")?"wrc!editor-v4":"wrc!editor-v3","wrc!editor","wrc!macro-browser","wrc!fullpage-editor"];return r.require(a).fail(function(a){e.logError("Failed to load editor resources",a)})}var k;if(b){b.fail(function(){c?c.call(this,arguments):e.log("EditorLoader: loadGuard - previous load failed.")});b.done(function(){a?b.done(function(){setTimeout(a,0)}):e.log("EditorLoader: loadGuard - editor is already loaded.")});k=
true}else k=void 0;if(!k){b=new d.Deferred;a&&b.done(a);c&&b.fail(c);var f=l();d("body").append(f);var j=new d.Deferred;i.get("page-id")?this.getEditorPreloadMarkup().always(function(a,b,c){if(b==="success"||b==="notmodified"){f.append(a);a=p.renderTemplate("dynamic-editor-metadata");d("head").append(a);q.metaToParams();e.debug("EditorLoader: Finished loading the editor template.");j.resolve();h.debugTimeEnd("confluence.editor.preload")}else j.reject("Error loading the Editor template: "+c.status+
" - "+c.statusText)}):j.resolve();j.pipe(g).done(function(){e.debug("EditorLoader: Finished loading the editor.");b.resolve()}).fail(function(){b.reject(arguments)})}},getEditorForm:function(){if(this.isEditorActive()){var a=require("tinymce");return d(a.activeEditor.getContainer()).closest("form")}return null}};return m});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor-loader/editor-loader","AJS.Confluence.EditorLoader");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.editor-loader:background-loading-editor', location = 'jscripts/block-and-buffer-keys.js' */
define("confluence-editor-loader/block-and-buffer-keys",[],function(){return{block:function(e){var d=[],f=function(a){a.preventDefault();a.stopPropagation();var c=a.which;c||(c=a.charCode?a.charCode:a.keyCode);13!==c&&48>c||d.push(c);a.preventDefault()};e.keypress(f);return function(){e.unbind("keypress",f);for(var a="",c=0;c<d.length;c++){var b;b=d[c];65535<b?(b-=65536,b=String.fromCharCode(55296+(b>>10),56320+(b&1023))):b=String.fromCharCode(b);a+=b}return a}}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor-loader/block-and-buffer-keys","AJS.Confluence.BlockAndBuffer");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/linkbrowser-editor-adapter.js' */
AJS.$(function(){$("body").hasClass("with-space-sidebar")&&(Confluence=Confluence||{},Confluence.Editor=Confluence.Editor||{},AJS.Rte=AJS.Rte||{},AJS.Rte.BookmarkManager=AJS.Rte.BookmarkManager||{},AJS.Rte.BookmarkManager.storeBookmark=AJS.$.noop,AJS.Rte.BookmarkManager.restoreBookmark=AJS.$.noop)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-ia.js' */
(function(E){Confluence.Sidebar={};AJS.toInit(function(b){function n(){AJS.trigger("sidebar.hide-overlays")}function l(a,c){b(document).tooltip(b.extend({gravity:"w",title:"data-tooltip",delayIn:500,delayOut:0,offset:5},c?c:{},{live:a}))}function v(){function a(){b(".tipsy").remove()}b(".acs-side-bar .quick-links-section").attr("data-collapsed-tooltip","Space shortcuts");b("#space-tools-menu-trigger").attr("data-collapsed-tooltip","Space tools");
"pages"==t.attr("data-tree-type")&&(b(".acs-side-bar .ia-secondary-container").attr("data-collapsed-tooltip","Child pages"),l(".collapsed .ia-secondary-container.tipsy-enabled",{title:"data-collapsed-tooltip"}));l(".expand-collapse-trigger");l(".ia-splitter-handle.tipsy-enabled");l(".collapsed .quick-links-section.tipsy-enabled, .collapsed .acs-nav-item \x3e a.tipsy-enabled, .collapsed #space-tools-menu-trigger.tipsy-enabled",{title:"data-collapsed-tooltip"});l(".configure-mode .acs-side-bar-space-info.tipsy-enabled",
{title:"data-configure-tooltip"});e.on("mousedown click scroll",n);b(window).on("scroll resize",n);AJS.bind("sidebar.hide-overlays",a);AJS.bind("sidebar.disable-tooltip",function(c,g){c=b(g).closest(".tipsy-enabled");if(1==c.size()){c.removeClass("tipsy-enabled").addClass("tipsy-disabled").attr("title","");if(c=c.data("tipsy"))c.hoverState="out";a()}});AJS.bind("sidebar.enable-all-tooltips",function(){b(".tipsy-disabled").removeClass("tipsy-disabled").addClass("tipsy-enabled")})}function y(a){"blogs"===
a?z(e,A):"pages"===a&&Confluence.Sidebar.Pages.installHandlers(e)}function A(a,c){var g=a.attr("data-group-type");a=a.attr("data-group-value");b.get(B+"/rest/ia/1.0/pagetree/blog/subtree",{spaceKey:C,groupType:g,groupValue:a}).done(c)}function z(a,c){a.delegate(".acs-tree-item \x3e .icon, .acs-tree-item \x3e .node-title","click",function(){var a=b(this).parent(),d=a.find("\x3e .icon");if(a.hasClass("opened"))a.children("ul").hide(),a.removeClass("opened").addClass("closed"),a.attr("aria-expanded",
!1),d.removeClass("aui-iconfont-expanded").addClass("aui-iconfont-collapsed");else if(a.hasClass("closed")){var e=a.children("ul");if(e.length)e.show();else{var f=b(Confluence.Templates.Sidebar.treeThrobber());a.append(f);c(a,function(c){c=b(Confluence.Templates.Sidebar.pagetreeList({pagetree:c,isSubtree:!0}));f.remove();c.appendTo(a)})}a.removeClass("closed").addClass("opened");a.attr("aria-expanded",!0);d.removeClass("aui-iconfont-collapsed").addClass("aui-iconfont-expanded")}})}function k(){var a=
u.offset().top,c=f.scrollTop(),g=f.scrollLeft();0>c||c>q.height()-f.height()||0>g||g>q.width()-f.width()||("fixed"!==b("#header").css("position")?d.css({top:Math.max(a-c,0)+"px",left:Math.min(-1*g,0)+"px"}):d.css({left:Math.min(-1*g,0)+"px"}))}function h(a){a=Math.max(a,55);a=Math.min(a,640);w.setItemQuietly("width",a);150>=a?(d.addClass("collapsed"),b(".expand-collapse-trigger").removeClass("aui-iconfont-chevron-double-left").addClass("aui-iconfont-chevron-double-right").attr("aria-expanded",!1),
r.attr("data-tooltip",Confluence.Sidebar.expandTooltip),AJS.trigger("sidebar.collapsed")):d.hasClass("collapsed")&&(d.removeClass("collapsed"),r.attr("data-tooltip",Confluence.Sidebar.collapseTooltip),b(".expand-collapse-trigger").removeClass("aui-iconfont-chevron-double-right").addClass("aui-iconfont-chevron-double-left").attr("aria-expanded",!0),AJS.trigger("sidebar.expanded"));d.width(a);x.eq(1).css("margin-left",a+"px");D.css("margin-left",d.outerWidth()+"px")}var f=b(window),q=b(document),m=
Math.min(285,f.width()/3),w=AJS.storageManager("confluence","sidebar"),B=AJS.contextPath(),C=AJS.Meta.get("space-key"),p=AJS.Meta.get("use-keyboard-shortcuts")?" "+"(\u2009[\u2009)":"";Confluence.Sidebar.collapseTooltip="Collapse sidebar"+p;Confluence.Sidebar.expandTooltip="Expand sidebar"+p;var x=b(".ia-splitter").children(),u=b(".ia-splitter-left");if(!(1>u.length)){var e=b(".acs-side-bar"),d=u.find(".ia-fixed-sidebar"),
r=b("\x3cdiv\x3e",{"class":"ia-splitter-handle tipsy-enabled","data-tooltip":Confluence.Sidebar.collapseTooltip}).appendTo(d);b("\x3cdiv\x3e",{"class":"ia-splitter-handle-highlight confluence-icon-grab-handle"}).appendTo(r);var t=b(".ia-secondary-container"),D=b("#footer, #studio-footer");Confluence.Sidebar.throbberDiv=function(){var a=b(Confluence.Templates.Sidebar.throbber()),c=a.find(".spinner"),d=Raphael.spinner(c[0],10,"#666");a.find(".throbber").bind("remove",function(){d()});return a};t.length&&
y(t.attr("data-tree-type"));f.scroll(k);f.resize(k);f.on("touchend",k);q.ready(k);AJS.bind("confluence.header-resized",k);b("#header-precursor img").load(k);Confluence.Sidebar.applyTooltip=l;v();AJS.bind("sidebar.exit-configure-mode",v);p=w.getItem("width")||m;h(150<p?p:55);(function(){q.on("mousewheel",".ia-scrollable-section",function(a,c){var d=b(this).scrollTop(),e=b(this).get(0).scrollHeight-b(this).innerHeight()-1;(0<c&&0>=d||0>c&&d>=e)&&a.preventDefault();a.stopPropagation()})})();d.css("visibility",
"visible");k();(function(){function a(){if(!Confluence.Sidebar.Configure.mode){var a=d.width();55<a?150>=a?(m=285,h(m)):(m=a,h(55)):h(m)}}var c=b("body"),e=!1,f=function(a){a.preventDefault();x.one("selectstart",function(a){a.preventDefault()});e=!1;c.on("mousemove.ia-splitter",function(a){Confluence.Sidebar.Configure.mode&&285>a.pageX||(h(a.pageX),e=!0)});c.one("mouseup mouseleave",function(){150>=d.width()?h(55):m=d.width();c.off("mousemove.ia-splitter")})};r.on("mousedown.ia-splitter",function(a){f(a);
n()}).click(function(){e?e=!1:a()});Confluence.Sidebar.toggle=a})();setTimeout(function(){Confluence.Sidebar.createFlyouts(e)},0);AJS.trigger("sidebar.finished-loading");f.one("pagetree-children-loaded",function(){var a=b(".plugin_pagetree_current");a.length&&(a=a.offset(),a.top>e.height()/2&&e.scrollTop(a.top-e.height()/3),a.left>e.width()/2&&e.scrollLeft(a.left-e.width()/2))});AJS.bind("sidebar.enter-configure-mode",function(){n();285>d.width()&&(Confluence.Sidebar.widthBeforeConfiguring=d.width(),
h(285));d.addClass("configure-mode")});AJS.bind("sidebar.exit-configure-mode",function(){n();Confluence.Sidebar.widthBeforeConfiguring&&(h(Confluence.Sidebar.widthBeforeConfiguring),Confluence.Sidebar.widthBeforeConfiguring=void 0);d.removeClass("configure-mode")})}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/configurable-nav.js' */
(function(d){AJS.Confluence.ConfigurableNav=AJS.RestfulTable.extend({initialize:function(b){var a=this;a.options=d.extend(!0,this._getDefaultOptions(b),b,{columns:[{id:"title"}]});a._events=a._events||AJS.RestfulTable.Events;a._event=a._event||AJS.RestfulTable.Events;a.classNames=AJS.RestfulTable.ClassNames;a.dataKeys=AJS.RestfulTable.DataKeys;a.$table=b.$el.addClass(this.classNames.RESTFUL_TABLE).addClass(this.classNames.ALLOW_HOVER).addClass("aui").addClass(a.classNames.LOADING);a.$table.prepend('\x3ccolgroup\x3e\x3ccol span\x3d"1" class\x3d"aui-restfultable-order"\x3e\x3ccol span\x3d"1"\x3e\x3ccol span\x3d"1" class\x3d"aui-restfultable-operations"\x3e\x3c/colgroup\x3e');
a.$tbody=d("\x3ctbody/\x3e");a._models=this._createCollection();a._rowClass=AJS.Confluence.ConfigurableNav.Row;a.editRows=[];a.enableReordering();a._models.bind("remove",function(b){d.each(a.getRows(),function(c,d){d.model===b&&(d.hasFocus()&&a._createRow&&a._createRow.trigger(a._event.FOCUS),a.removeRow(d))})});this.fetchInitialResources();Confluence.Sidebar.applyTooltip(".aui-iconfont-add-circle, .aui-iconfont-cross-circle, .aui-iconfont-plan-disabled",{gravity:"ne"})},enableReordering:function(){var b=
this;this.$tbody.sortable({handle:"."+this.classNames.DRAG_HANDLE,helper:function(a,c){a=c.clone(!0).addClass(b.classNames.MOVEABLE);a.children().each(function(a){d(this).width(c.children().eq(a).width())});return a},start:function(a,c){var e=c.placeholder.find("td");c.item.addClass(b.classNames.MOVEABLE).children().each(function(a){d(this).width(e.eq(a).width())});c.placeholder.html('\x3ctd colspan\x3d"'+b.getColumnCount()+'"\x3e\x26nbsp;\x3c/td\x3e').css("visibility","visible");b.getRowFromElement(c.item[0]).trigger(b._event.MODAL)},
stop:function(a,c){jQuery(c.item[0]).is(":visible")&&(c.item.removeClass(b.classNames.MOVEABLE).children().attr("style",""),c.placeholder.removeClass(b.classNames.ROW),b.getRowFromElement(c.item[0]).trigger(b._event.MODELESS))},update:function(a,c){a={};var e=b.getRowFromElement(c.item[0]);if(e){var f=function(a,b,c){d(b).trigger(a,c);d(b).trigger(a,c);b.id&&d(b).trigger(b.id+"-"+a,c)};c=b.options.reverseOrder?c.item.next():c.item.prev();c.length?(c=b.getRowFromElement(c).model,a.after=c.url()):a.position=
"First";a.spaceKey=AJS.Meta.get("space-key");d.ajax({url:e.model.url()+"/move",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(a),complete:function(){e.hideLoading()},success:function(a){f(AJS.RestfulTable.Events.REORDER_SUCCESS,b,[a])},error:function(a){var c=d.parseJSON(a.responseText||a.data);f(AJS.RestfulTable.Events.SERVER_ERROR,b,[c,a])}});e.showLoading()}},axis:"y",delay:0,containment:"document",cursor:"move",scroll:!0,zIndex:8E3});this.$tbody.bind("selectstart mousedown",
function(a){return!d(a.target).is("."+b.classNames.DRAG_HANDLE)})}});AJS.Confluence.ConfigurableNav.ReadView=AJS.RestfulTable.CustomReadView.extend({render:function(b){return _.template('\x3cspan class\x3d"acs-nav-item-link" title\x3d"\x3c%\x3dtitle%\x3e"\x3e\x3cspan class\x3d"'+("pinned_attachment"==b.styleClass?"aui-icon aui-icon-small aui-iconfont-attachment":"icon")+'"\x3e\x3c/span\x3e\x3cspan class\x3d"acs-nav-item-label"\x3e\x3c%\x3dtitle%\x3e\x3c/span\x3e\x3c/span\x3e')({title:AJS.escapeHtml(b.title)})}});
AJS.Confluence.ConfigurableNav.Row=AJS.RestfulTable.Row.extend({render:function(){var b=this,a=this.model.toJSON(),c=d("\x3ctd class\x3d'aui-restfultable-operations' /\x3e").append(this.renderOperations(a.canHide,a.hidden)),e=d('\x3ctd class\x3d"'+this.classNames.ORDER+'"/\x3e').append(this.renderDragHandle());b._event=b._event||b._events;b.$el.attr("data-id",this.model.id);b.$el.append(e);d.each(b.columns,function(c,e){c=d("\x3ctd /\x3e");var g=a[e.id];g&&b.$el.attr("data-"+e.id,g);e=(new AJS.Confluence.ConfigurableNav.ReadView).render(a);
c.append(e);b.$el.append(c)});b.$el.append(c);a.canHide&&a.hidden&&b.$el.addClass("hidden-link");b.$el.addClass(this.classNames.ROW+" "+b.classNames.READ_ONLY+" acs-nav-item "+a.styleClass);b.trigger(this._event.RENDER,this.$el,a);b.$el.trigger(this._event.CONTENT_REFRESHED,[b.$el]);return b},renderOperations:function(b,a){var c=this,e=d('\x3ca href\x3d"#" class\x3d"aui-icon aui-icon-small"/\x3e');if(b){var f=function(a){a.hasClass("aui-iconfont-plan-disabled")?a.attr("data-tooltip","Hide link"):
a.attr("data-tooltip","Show link")};e.addClass(a?"aui-iconfont-add-circle show-link":"aui-iconfont-plan-disabled hide-link").click(function(b){b.preventDefault();d.ajax({url:c.model.url()+(a?"/show":"/hide"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:AJS.Meta.get("space-key")})}).done(function(){e.closest(".acs-nav-item").toggleClass("hidden-link");e.toggleClass("aui-iconfont-plan-disabled").toggleClass("aui-iconfont-add-circle");
e.toggleClass("hide-link").toggleClass("show-link");f(e)})});f(e)}else e.addClass("aui-iconfont-cross-circle delete-link tipsy-enabled").click(function(a){a.preventDefault();"hide"!=d(".acs-nav").data("quick-links-state")&&(AJS.trigger("sidebar.disable-tooltip",this),c.destroy())}).attr("data-tooltip","Remove link");return e},destroy:function(){this.model.destroy({data:{spaceKey:AJS.Meta.get("space-key")}})}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-pages.js' */
(function(a){var d=AJS.Meta.get("context-path");Confluence.Sidebar.Pages={installHandlers:function(c){c.find(".more-children-link").click(function(b){b.preventDefault();c.find("ul.more-children").show();a(this).hide()})},quickLinksContent:function(){return(new a.Deferred).resolve(a(".acs-side-bar .quick-links-wrapper").html())},childPageCollapsedContent:function(){var c=a(".acs-side-bar .ia-secondary-header"),b=a(".acs-side-bar .ia-secondary-parent-content"),d=a(".acs-side-bar .ia-secondary-current-content"),
e=a(".acs-side-bar .ia-secondary-content");return(new a.Deferred).resolve(a("\x3cdiv\x3e").append(a("\x3cdiv\x3e").addClass("acs-side-bar-flyout-wiki-wrapper").append(c.clone()).append(b.clone()).append(d.clone()).append(e.clone())).html())},pageTreeCollapsedContent:function(){var c=a(".page-tree-flyout-content");return 0==c.length?a.ajax({url:d+"/rest/ia/1.0/space/childPagesContextualNav",data:{pageId:AJS.Meta.get("page-id")}}).pipe(function(b){b=a("\x3cdiv\x3e").addClass("acs-side-bar-flyout-wiki-wrapper").append(Confluence.Templates.Sidebar.Pages.renderPageContextualNav({pageContextualNav:b,
hasCreatePermission:a(".acs-nav").data("has-create-permission")}));a("body").append(a("\x3cdiv\x3e").addClass("page-tree-flyout-content hidden").append(b.clone()));return b}):(new a.Deferred).resolve(c.html())}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-links.js' */
AJS.$(function(){function u(b){var e=a(".space-information-container .favourite-space-icon");e.addClass("disabled");if("add"===b){var l="PUT";var d="confluence.space-sidebar.favourite.click"}else l="DELETE",d="confluence.space-sidebar.favourite-remove.click";a.ajax({url:f+"/rest/experimental/relation/user/current/favourite/toSpace/"+h,type:l,dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:h})}).done(function(){var c=a("#space-favourite-add"),n=a("#space-favourite-remove");
"add"===b?(c.prop("data-favourited","true"),c.attr("aria-pressed","true"),n.attr("aria-pressed","false"),n.show(),c.hide()):(c.prop("data-favourited","false"),c.attr("aria-pressed","false"),n.attr("aria-pressed","true"),c.show(),n.hide())}).fail(function(a){var b=require("confluence/message-controller");b.showError(b.parseError(a),b.Location.FLAG)}).always(function(){e.removeClass("disabled")});AJS.trigger("analyticsEvent",{name:d})}function w(){AJS.trigger("sidebar-before-enter-configure-mode");
var b=a(".custom-sidebar-content"),e=b.length;if(e){var l=f+"/spaces/custompagecontent.action?key\x3d"+h;var m=b.children().html()}p=d.data("nav-type");Confluence.Sidebar.Configure.mode=!0;v=a(".acs-nav-sections .acs-nav-item.current-item").data("collector-key");g=Confluence.Sidebar.throbberDiv();b=a(".acs-nav-sections");g.height(b.height());q.hide();b.replaceWith(g);e=Confluence.Templates.Sidebar.configure({pageTree:"page-tree"===p,quickLinksState:d.data("quick-links-state"),pageTreeState:d.data("page-tree-state"),
hasSidebarCustomisation:e,customContentAdminLink:l,sidebarCustomisation:m,accessMode:AJS.Meta.get("access-mode")});k=a(e).hide();g.after(k);x();y();Confluence.Sidebar.Configure.MainLinks=new AJS.Confluence.ConfigurableNav({$el:a("#acs-nav-list-main"),resources:{all:f+"/rest/ia/1.0/link/main?spaceKey\x3d"+h+"\x26includeHidden\x3dtrue",self:f+"/rest/ia/1.0/link"}});Confluence.Sidebar.Configure.QuickLinks=new AJS.Confluence.ConfigurableNav({$el:a("#acs-nav-list-quick"),resources:{all:f+"/rest/ia/1.0/link/quick?spaceKey\x3d"+
h,self:f+"/rest/ia/1.0/link"},reverseOrder:!0});var c={};a("#acs-nav-list-main").one(AJS.RestfulTable.Events.INITIALIZED,function(){c.main=!0;c.quick&&(g.replaceWith(k),k.show())});a("#acs-nav-list-quick").one(AJS.RestfulTable.Events.INITIALIZED,function(){c.quick=!0;c.main&&(g.replaceWith(k),k.show())});a(".acs-nav-type").change(function(b){r("nav-type",a(this).val(),function(a){q.data("tree-type",a);d.data("nav-type",a)})});a(".acs-done-link").click(function(b){b.preventDefault();a(".acs-done-link").attr("aria-disabled",
!0).prop("disabled",!0);z()});a(".quick-links-header a").click(function(a){a.preventDefault();a="hide"===d.data("quick-links-state")?"show":"hide";r("quick-links-state",a,A)});a(".page-tree-header a").click(function(b){b.preventDefault();b="hide"===d.data("page-tree-state")?"show":"hide";var c=a(".acs-nav-type");"show"===b?c.attr("disabled",!1):c.attr("disabled",!0);r("page-tree-state",b,B)});AJS.$(".acs-side-bar-space-info").on("click.configurelogo",C);AJS.trigger("sidebar.enter-configure-mode")}
function C(a){var b=AJS.$(".acs-side-bar-space-info \x3e .flyout-handle");b.addClass("loading").spin();WRM.require("wr!com.atlassian.confluence.plugins.confluence-space-ia:avatar-picker",function(){AJS.trigger("deferred.spaceia.open.configure.space")}).always(function(){b.removeClass("loading").spinStop()});a.preventDefault()}function r(b,e,d){a.ajax({url:f+"/rest/ia/1.0/space/option",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:h,option:b,value:e}),success:function(a){d(e)}})}
function z(){if(p!==d.data("nav-type")||!0===t)location.reload(),t=!1;else{var b=a(".custom-sidebar-content"),e=b.length,l;e&&(l=b.children().html());g=Confluence.Sidebar.throbberDiv();g.height(k.height());k.replaceWith(g);Confluence.Sidebar.Configure.MainLinks.remove();Confluence.Sidebar.Configure.MainLinks.unbind();Confluence.Sidebar.Configure.QuickLinks.remove();Confluence.Sidebar.Configure.QuickLinks.unbind();a(document).unbind(AJS.RestfulTable.Events.INITIALIZED);a(document).unbind(AJS.RestfulTable.Events.ROW_ADDED);
a(document).unbind(AJS.RestfulTable.Events.ROW_REMOVED);q.show().css("display","");var m=function(){var b=a(Confluence.Templates.Sidebar.renderLinks({mainLinks:c.main,quickLinks:c.quick.reverse(),advancedLinks:c.advanced,hasConfigurePermission:!0,collectorToHighlight:v,quickLinksState:d.data("quick-links-state"),hasSidebarCustomisation:e,sidebarCustomisation:l}));g.replaceWith(b);Confluence.Sidebar.Configure.mode=!1;AJS.trigger("sidebar.exit-configure-mode")},c={};a.get(f+"/rest/ia/1.0/link/main",
{spaceKey:h,includeHidden:!1}).done(function(a){c.main=a;c.quick&&c.advanced&&m()});a.get(f+"/rest/ia/1.0/link/quick",{spaceKey:h}).done(function(a){c.quick=a;c.main&&c.advanced&&m()});a.get(f+"/rest/ia/1.0/link/advanced",{spaceKey:h}).done(function(a){c.advanced=a;c.main&&c.quick&&m()});Confluence.Sidebar.Configure.Logo&&Confluence.Sidebar.Configure.Logo.unbind()}}function x(){WRM.require("wr!com.atlassian.confluence.plugins.confluence-space-ia:link-dialog",function(){var b=new a.Deferred;a(".acs-add-link").click(function(e){b.done(function(){e.preventDefault();
"hide"!==d.data("quick-links-state")&&(Confluence.Sidebar.LinkAdapter.hijackLinkBrowser(),Confluence.Editor.LinkBrowser.open(),a("#recentlyviewed-panel-id").click())})}).addClass("acs-add-link-ready");AJS.Meta.get("space-key")?AJS.Confluence.EditorLoader.load(function(){b.resolve()},function(){AJS.log("Attempted to load editor for space ia side bar. Loading the editor failed.");b.reject()}):b.resolve()})}function y(){var b=a("#acs-nav-list-quick"),e=a(".acs-nav-sections .tip").hide(),d=function(){Confluence.Sidebar.Configure.QuickLinks.isEmpty()?
(b.hide(),e.show()):(e.hide(),b.show())};a(document).bind(AJS.RestfulTable.Events.INITIALIZED,d);a(document).bind(AJS.RestfulTable.Events.ROW_ADDED,d);a(document).bind(AJS.RestfulTable.Events.ROW_REMOVED,d)}function A(b){d.data("quick-links-state",b);"hide"===b?(a(".acs-nav-list-quick-section").addClass("hidden-section"),a(".quick-links-header a").removeClass("aui-iconfont-plan-disabled").addClass("aui-iconfont-add-circle").attr("aria-disabled",!0)):(a(".acs-nav-list-quick-section").removeClass("hidden-section"),
a(".quick-links-header a").removeClass("aui-iconfont-add-circle").addClass("aui-iconfont-plan-disabled").attr("aria-disabled",!1))}function B(b){d.data("page-tree-state",b);t=!0;"hide"===b?(a(".acs-nav-list-page-tree-section").addClass("hidden-section"),a(".page-tree-header a").removeClass("aui-iconfont-plan-disabled").addClass("aui-iconfont-add-circle").attr("aria-disabled",!0)):(a(".acs-nav-list-page-tree-section").removeClass("hidden-section"),a(".page-tree-header a").removeClass("aui-iconfont-add-circle").addClass("aui-iconfont-plan-disabled").attr("aria-disabled",
!1))}Confluence.Sidebar.Configure={mode:!1};var a=AJS.$,f=AJS.Meta.get("context-path"),h=AJS.Meta.get("space-key"),q=a(".acs-side-bar").find(".ia-secondary-container"),g,k,v,p,d=a(".acs-nav"),t=!1;a.ajaxSetup({cache:!1});a("body").on("click","#acs-configure-link, a.configure-sidebar",function(a){a.preventDefault();w()});a("#space-favourite-remove").on("click",function(){u("remove")});a("#space-favourite-add").on("click",function(){u("add")})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-space-tools.js' */
define("confluence-space-ia/sidebar-space-tools",["ajs","jquery","confluence/legacy"],function(b,a,c){return function(){var g=[],h=[],f=0===b.version.indexOf("5.7");if(!f){var k=a("#space-tools-menu-trigger");var e=a("#space-tools-menu")}f?a("#space-tools-web-items").children("div").each(function(){g.push({label:a(this).data("label"),href:a(this).data("href")})}):(b.warn("Remove legacy sidebar code when upgrade to AUI 5.8+"),e.on({"aui-dropdown2-show":function(){b.trigger("sidebar.disable-tooltip",
k)},"aui-dropdown2-hide":function(){b.trigger("sidebar.enable-all-tooltips")}}),a("#space-tools-web-items").children("div").each(function(){g.push({text:a(this).data("label"),href:a(this).data("href")})}));f?a("#space-tools-menu-additional-items").children("div").each(function(){h.push({className:a(this).data("class"),label:a(this).data("label"),href:a(this).data("href")})}):a("#space-tools-menu-additional-items").children("div").each(function(){h.push({extraClasses:a(this).data("class"),text:a(this).data("label"),
href:a(this).data("href")})});if(f){var m={hideDelay:null,width:170,displayShadow:!1,calculatePositions:function(a,b){b=b.target.offset();return{popupCss:{top:b.top-a.height(),left:b.left},arrowCss:{display:"none"}}},hideCallback:function(){b.trigger("sidebar.enable-all-tooltips")}};var l=b.InlineDialog(a("#space-tools-menu-trigger"),"space-tools",function(d,e,k){d.html(c.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:g,spaceLinks:h,isAuiFiveSeven:f}));a(e).one("click",function(b){a("#inline-dialog-space-tools").is(":visible")&&
setTimeout(function(){l.hide()},0)});b.trigger("sidebar.disable-tooltip",e);b.trigger("sidebar.spacetools-loaded");k();return!1},m);l.addClass("aui-dropdown2 aui-style-default space-tools-dropdown");b.bind("sidebar.hide-overlays",l.hide)}else e.html(c.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:g,spaceLinks:h})),b&&b.Confluence&&b.Confluence.Analytics&&b.Confluence.Analytics.setAnalyticsSource&&b.Confluence.Analytics.setAnalyticsSource(e.find("a:not(.configure-sidebar)"),"spacetools"),b.bind("sidebar.hide-overlays",
function(){e.filter('[aria-hidden\x3d"false"]').length&&a("#space-tools-menu-trigger").trigger("aui-button-invoke")});var d=a(".expand-collapse-trigger");d.click(function(a){a.preventDefault();c.Sidebar.toggle()});d.attr("data-tooltip",a(".ia-fixed-sidebar").hasClass("collapsed")?c.Sidebar.expandTooltip:c.Sidebar.collapseTooltip);d.attr("aria-label",a(".ia-fixed-sidebar").hasClass("collapsed")?c.Sidebar.expandTooltip:c.Sidebar.collapseTooltip);b.bind("sidebar.collapsed",function(){d.attr("data-tooltip",
c.Sidebar.expandTooltip);d.attr("aria-label",c.Sidebar.expandTooltip)});b.bind("sidebar.expanded",function(){d.attr("data-tooltip",c.Sidebar.collapseTooltip);d.attr("aria-label",c.Sidebar.collapseTooltip)})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-space-tools-require.js' */
require(["confluence-space-ia/sidebar-space-tools"],function(a){AJS.toInit(function(){a()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-flyouts.js' */
(function(c){function d(a,b,g,d){var f=AJS.InlineDialog(a,g,function(a,h,e){c(a).addClass("acs-side-bar-flyout ia-scrollable-section");c(a).empty().append(Confluence.Sidebar.throbberDiv());b().done(function(b){c(a).html(b)});AJS.trigger("sidebar.flyout-triggered",d);e();c(h).one("click",function(a){c("#inline-dialog-"+g).is(":visible")&&setTimeout(function(){f.hide()},0)});AJS.trigger("sidebar.disable-tooltip",h)},{gravity:"w",calculatePositions:e,useLiveEvents:!0,hideDelay:null,hideCallback:function(){AJS.trigger("sidebar.enable-all-tooltips")}});
AJS.bind("sidebar.hide-overlays",f.hide);return f}function e(a,b,d,e){a=b.target.offset();d=b.target.width();b=b.target.height();b={top:a.top+b/2-15,left:a.left+d+5,right:"auto"};a=c(window);b.maxHeight=a.height()+a.scrollTop()-b.top-20;return{popupCss:b,arrowCss:{top:9},gravity:"w"}}Confluence.Sidebar.createFlyouts=function(a){d(c(".collapsed .quick-links-section"),Confluence.Sidebar.Pages.quickLinksContent,"sidebar-quick-links-flyout",{flyout:"quick-links"});a=a.find(".ia-secondary-container");
a.length&&"pages"==a.attr("data-tree-type")&&d(c(".collapsed .ia-secondary-header-title.wiki"),Confluence.Sidebar.Pages.childPageCollapsedContent,"sidebar-children-flyout",{flyout:"children"});a.length&&"page-tree"==a.attr("data-tree-type")&&d(c(".collapsed .ia-secondary-header-title.page-tree"),Confluence.Sidebar.Pages.pageTreeCollapsedContent,"sidebar-page-tree-flyout",{flyout:"pagetree"})}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/external/jquery.mousewheel.min.js' */
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-logo.js' */
AJS.toInit(function(a){Confluence.Sidebar.Configure.Logo={};var g=a(".acs-side-bar-space-info div.name a"),d,f,h=function(e){d||(d=new e({onCrop:function(e,c){a.ajax({type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:AJS.Meta.get("space-key"),spaceName:c,logoDataURI:e}),url:AJS.Meta.get("context-path")+"/rest/ia/1.0/space/setLogo",success:function(b){var c=b.logoDownloadPath;a(".space-logo .avatar-img").attr("src",AJS.Meta.get("context-path")+c);b=b.name;g.attr("title",
b).text(b);d.hide()},error:function(b){d.setMessage("An error occurred while updating space details");d._removeSaveImageLoadingIcon()}})}}));d.show(a(".acs-side-bar-space-info div.name a").text());return!1},k=function(){function e(c,b,a,d){c=b.target.offset();a=b.target.width();b=b.target.height();return{popupCss:{top:c.top+b/2-15,left:c.left+a+5,right:"auto"},arrowCss:{top:9},gravity:"w"}}var d=function(c,b,d){a(c).addClass("acs-side-bar-flyout");a(c).empty();c.html(AJS.template.load("logo-config-content"));
c.unbind("mouseover mouseout");AJS.trigger("sidebar.disable-tooltip",b);d()};f||(f=AJS.InlineDialog(a(".acs-side-bar-space-info"),"space-logo-config",d,{gravity:"w",calculatePositions:e,useLiveEvents:!0,hideCallback:function(){AJS.trigger("sidebar.enable-all-tooltips")},hideDelay:null,noBind:!0,width:635}));f.show()};AJS.bind("sidebar-before-enter-configure-mode",function(){AJS.bind("deferred.spaceia.open.configure.space",function(a){AJS.Meta.get("space-key")=="~"+AJS.Meta.get("remote-user")?k():
require(["confluence-space-ia/avatar-picker/avatar-picker-dialog"],h);a.preventDefault();return!1})});Confluence.Sidebar.Configure.Logo.unbind=function(){a("#inline-dialog-space-logo-config .cancel").click();a(".acs-side-bar-space-info").off("click.configurelogo");AJS.unbind("deferred.spaceia.open.configure.space")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:help-dialog-extension', location = 'js/help-dialog.js' */
AJS.toInit(function($) {
    // Add the shortcut to the shortcuts dialog
    Confluence.KeyboardShortcuts && Confluence.KeyboardShortcuts.Autoformat.push(
        {
            action: "@",
            context: "autoformat.autocomplete",
            description: "Mention"
        });
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:utils', location = '/js/utils/dom.js' */
define("confluence/fh/utils/dom",["jquery","ajs","exports"],function(d,p,e){function g(a){if(!g.done||a)l=0!==d("#main .aui-page-panel-outer-content").length?d("#main .aui-page-panel-outer-content"):d("#main"),q=d("#header"),h=d("#main-header"),m=!1,r=d("#main-header #title-text"),g.done=!0}function t(){g();var a=parseInt(h.css("top"))+h.outerHeight();isNaN(a)||a===t.lastValue||(t.lastValue=a,p.trigger("sticky-table-headers.change.options",{fixedOffset:a,cacheHeaderHeight:!0}))}function k(a,b,c){if(c){k[c]=
k[c]||{};if(b===k[c].lastValue)return;k[c].lastValue=b}a.css({transform:"translateY("+b+"px)","-webkit-transform":"translateY("+b+"px)","-ms-transform":"translateY("+b+"px)"})}function u(a,b,c){var d={};c.forEach(function(b){d[b]=a.css(b)});b.css(d)}function w(a){g();if(f){var b=h.height(),c=a?b-r.height():b+parseInt(r.css("padding-top"));n||(n=f.find("h1"));n.css({paddingTop:c});a=a?b:n.outerHeight();f.height(a)}}var f,l,q,h,r,n,m;var x=["margin-top","margin-right","margin-left","margin-bottom"];
var y=["padding-top","padding-right","padding-left","padding-bottom"];var v=["font-family","font-size","font-style","font-weight"];e.forceInitialize=function(){g(!0)};e.addClassToPage=function(){var a=p.Meta.get("content-type");"page"!==a&&"blogpost"!==a||p.bind("init.rte",function(){d(tinymce.activeEditor.getWin().document).find("body#tinymce").addClass("page-edit")})};e.adjustMainHeaderSize=function(){g();h.css({width:l.outerWidth()-(parseInt(l.css("padding-left"))+parseInt(l.css("padding-right")))});
var a=!q.hasClass("fixed-header");w(a)};e.updateTableStickyHeaderOption=t;e.translateVertical=k;e.createMainHeaderPlaceHolder=function(){g();if(f)return f;f=d('\x3cdiv id\x3d"main-header-placeholder"\x3e\x3c/div\x3e');var a=d("#title-text"),b=a.find("a"),c=a.clone().removeAttr("id"),e=c.find("a");u(h,f,x.concat(y));f.css({height:h.outerHeight()});u(a,c,v.concat("text-decoration","letter-spacing","text-align","padding-right","padding-bottom","padding-left","margin-right","margin-bottom","margin-left"));
c.css({paddingTop:parseInt(a.css("padding-top"))+Math.round(a.offset().top-h.offset().top)});u(b,e,v.concat(x,y,v,"color","text-decoration","letter-spacing","text-align"));f.append(c);return f};e.removeMainHeaderPlaceHolder=function(){f&&f.remove()};e.scrollIfAnchor=function(a){var b;if(b="object"===typeof a)b=a,b=d.contains(document.querySelector("#header"),b.target);if(!b&&(a="string"===typeof a?a:d(this).attr("href"))){g();b=q.outerHeight();var c=d(a.replace(/(!|"|\$|%|&|'|\(|\)|\*|\+|,|\.|\/|:|;|<|=|>|\?|@|\[|\\|\]|\^|`|\{|\||\}|~)/g,
"\\$1"));if(c.length&&(m=!0,window.scrollTo(0,c.offset().top-b),history&&"pushState"in history))return history.pushState({},document.title,window.location.pathname+window.location.search+a),!1}};e.isScrollingToAnchorLink=function(){return m};e.unsetScrollingToAnchorLinkFlag=function(){m=!1};e.adjustMainHeaderPlaceHolderSize=w});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:handlers', location = '/js/handlers/page-view-handler.js' */
define("confluence/fh/handlers/page-view-handler",["confluence/fh/utils/dom","jquery","ajs","exports"],function(k,l,B,b){function q(b){if(!q.done||b)p=l("#header"),e=l("#main .aui-page-panel-outer-content"),0===e.length&&(e=l("#main")),a=l("#main-header"),l("#action-menu-link"),C=k.createMainHeaderPlaceHolder(),z=l(".ia-splitter-left .ia-fixed-sidebar"),f=a.prop("style"),D=e.prop("style"),E=Math.round(p.offset().top),d=p.height(),F=Math.round(a.offset().top)-d-(parseInt(e.css("padding-top"))+parseInt(a.css("margin-top"))),
q.done=!0}function G(){m&&0!==g&&(g=0,a.addClass("overlay-header"),a.css({top:d+"px",zIndex:100}),k.updateTableStickyHeaderOption())}var p,e,a,C,z,f,D,E,d,F,u=!1,m=!1,w=!1,A=0,g=0,r=0,x="by-other",H=function(){q();var b=k.isScrollingToAnchorLink();k.unsetScrollingToAnchorLinkFlag();var n=l(window).scrollTop(),c=n>E;c&&parseInt(z.css("top"))<d&&z.css({top:d+"px"});!u&&c?(u=!0,p.addClass("fixed-header"),C.css("padding-top",p.height())):c||(p.removeClass("fixed-header"),D.marginTop="",u=!1);c=n>F;!m&&
c?(m=!0,a.find("#title-text").hide(),a.css({position:"fixed",width:e.outerWidth()-(parseInt(e.css("padding-left"))+parseInt(e.css("padding-right"))),right:0,top:d+"px",marginTop:0,paddingTop:parseInt(e.css("padding-top"))+parseInt(a.css("margin-top")),paddingBottom:parseInt(e.css("padding-top"))+parseInt(a.css("margin-top")),paddingLeft:e.css("padding-left"),paddingRight:e.css("padding-right"),zIndex:100}),a.before(k.createMainHeaderPlaceHolder()),window.scrollTo(0,n)):c||(f.position="",f.width="",
f.right="",f.top="",f.marginTop="",f.paddingTop="",f.paddingBottom="",f.paddingLeft="",f.paddingRight="",f.zIndex="",a.removeClass("overlay-header"),a.find("#title-text").show(),w=m=!1,k.removeMainHeaderPlaceHolder());c=a.outerHeight();var t=A-n,y=parseInt(a.css("top"))+t;if(0>=n){g=r=0;var h=d}else if(b){r=0;g=c;h=d-c;var v=100}else if(m&&0<t){if(y>d)r=d,g=0,h=d,v=100;else if(r+=Math.abs(t),50<=r||n<=c)g-=Math.abs(t),h=y,v=100;n>c+50&&!w&&(a.addClass("overlay-header"),w=!0);x="by-scroll"}else m&&
0>t&&(y<d-c?(r=0,g=c,h=d-c,v=100):(g+=Math.abs(t),h=y));void 0!==v&&void 0!==h?a.css({top:h+"px",zIndex:v}):void 0!==h&&a.css({top:h+"px"});k.updateTableStickyHeaderOption();A=n};b.forceInitialize=function(){q(!0)};b.onScrollHandler=H;b.onHoverActionMenuLinkHandler=function(){q();G();x="by-hover"};b.onClickEditPageLinkHandler=function(){q();G();B.bind("quick-edit.viewport.saved",function(){p.removeAttr("style");k.removeMainHeaderPlaceHolder()});l(window).off("scroll",H).off("resize.confluence-fixed-headers-responsive");
B.trigger("analyticsEvent",{name:"view.edit.transition.edit.button.clicked",data:{method:x}})};b.isKeepDotDotDotButton=!1;b.__getShowMainHeaderBy=function(){return x};b.__getFixedHeader=function(){return u};b.__getFixedMainHeader=function(){return m};b.__setFixedHeader=function(a){u=a};b.__setFixedMainHeader=function(a){m=a};b.__setMainHeaderOverlay=function(a){w=a};b.__setScrollPosition=function(a){A=a};b.__setMovingDistance=function(a){g=a}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:confluence-fixed-headers-view-content-resources', location = '/js/confluence-fixed-headers.js' */
require(["confluence/fh/utils/dom","confluence/fh/handlers/page-view-handler","ajs","jquery"],function(c,d,e,a){e.toInit(function(){if(e.Meta.get("content-type")&&!(0<a("#main-content").find("style").length||a("body").hasClass("theme-documentation"))){var k=a("#header"),l=a("#main-header"),h=a("#main"),f=a("#content"),m=a("#editPageLink"),n=a("#action-menu-link"),p=["inline-dialog-notifications-miniview","inline-dialog-confluence-watch","inline-dialog-shareContentPopup","inline-dialog-ap-inline-dialog-content-confstats-connect-dev__confstats-live-watcher",
"inline-dialog-jira-metadata-dialog"];(new MutationObserver(function(a){c.adjustMainHeaderSize()})).observe(h[0],{attributes:!0,attributeFilter:["style"]});var g=new MutationObserver(function(a){"0px"===f.css("padding-right")&&f.css({paddingRight:"28px"})});g.observe(f[0],{attributes:!0,attributeFilter:["style"]});a(window).on("resize.confluence-fixed-headers-responsive",e.debounce(c.adjustMainHeaderSize,100)).on("scroll",d.onScrollHandler).scroll(e.debounceImmediate(function(){var b=a('.aui-dropdown2[aria-hidden\x3d"false"]');
b.length&&a('.aui-dropdown2-trigger[aria-owns\x3d"'+b.attr("id")+'"]').trigger("aui-button-invoke");b=a(".aui-inline-dialog:visible");b.length&&(b=b.filter(function(){var b=a(this),c=b.attr("id");return b.hasClass("non-persistence-dialog")||-1!==p.indexOf(c)}),b.css({display:"none"}),k.find(".aui-button.active, .aui-nav-imagelink.active").removeClass("active"),l.find(".aui-button.active, .aui-nav-imagelink.active").removeClass("active"),document.activeElement.blur())},250));d.isKeepDotDotDotButton&&
(h.addClass("floating-action-menu"),n.on("hover",d.onHoverActionMenuLinkHandler));m.click(function(){g&&g.disconnect();d.onClickEditPageLinkHandler()});setTimeout(function(){c.scrollIfAnchor(window.location.hash)});a("body").on("click",'a[href^\x3d"#"]',c.scrollIfAnchor)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like-namespace.js' */
define("confluence-like/like-namespace",["confluence/legacy"],function(a){return a.Likes||{}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-like/like-namespace","Confluence.Likes");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like.js' */
define("confluence-like/like",["ajs","confluence/legacy","jquery","confluence/meta","confluence/message-controller"],function(e,c,d,g,q){function r(a){return e.contextPath()+"/rest/likes/1.0/content/"+a+"/likes"}function v(){return 0<(g.get("remote-user")||"").length&&!1!==g.get("remote-user-has-licensed-access")}function t(a,b,h){var d=g.get("remote-user")||"";b=c.Likes.LikeSummaryFactory.getLikeSummary(a.likes,b,d);b.key||!n||"page"!==a.content_type&&"blogpost"!==a.content_type||(b.text="Be the first to like this");
a=[];a.push(b.text);a=a.concat(b.args);(a=e.format.apply(e,a))&&0<a.length?(n&&h.addClass("like-summary-margin-left"),h.html(a)):(h.removeClass("like-summary-margin-left"),h.empty());a&&(h.find(".likes").click(p.showLikeUsers),c.Binder.userHover())}function m(a,b,h){var k=g.get("remote-user")||"";if(void 0===a)throw Error("type is required");if(void 0===b)throw Error("contentId is required");if(void 0===h)throw Error("contentType is required");return function(){if("object"!==typeof this||!this.nodeType||
1!==this.nodeType||"A"!==this.nodeName)throw Error("this handler should be bound to a DOM anchor element");var u=d(this),f=arguments.callee,c=u.next(".like-summary");d.ajax({type:0===a?"POST":"DELETE",url:r(b),contentType:"application/json",data:{"atlassian-token":g.get("atlassian-token")},dataType:"json",timeout:1E4}).fail(function(d){var k;405===d.status?q.showError(q.parseError(d),q.Location.FLAG):k=0===a?"Like failed":"Unlike failed";d=c.siblings(".like-error");
0===d.length&&void 0!==k?c.after('\x3cspan class\x3d"like-error" title\x3d"'+k+'"\x3e\x3c/span\x3e'):d.attr("title",k);u.off("click").on("click",null,0===a?m(0,b,h):m(1,b,h)).find(".like-button-text").html(0===a?"Like":"Unlike")}).success(function(){c.attr("data-liked",0===a);c.parent().find(".like-error").remove();t(l[b],b,c)});x(u,a,f,k,b,h,c);return!1}}function x(a,b,h,k,c,f){a.off("click",null,h).on("click",null,0===b?m(1,c,f):m(0,c,f)).find(".like-button-text").html(0===
b?"Unlike":"Like");l[c]=l[c]||{content_type:f,likes:[]};0===b?l[c].likes.push({user:{name:k}}):l[c].likes=d.grep(l[c].likes,function(a){return a.user.name!==k});0===b&&e.trigger("analytics",{name:"confluence."+f+".like.create",data:{pageID:g.get("page-id")}})}var f,l={},n=v()&&"READ_ONLY"!==g.get("access-mode"),w=d.Deferred(),p={getLikesCache:function(){return w.promise()},showLikeUsers:function(a){a&&a.preventDefault();a=d(this);var b=a.data("content-id");
a.blur();f&&(f.remove(),f=void 0);f=new e.Dialog(400,365,"likes-dialog");f.addHeader("People who like this");f.addPanel("Panel 1","\x3cdiv class\x3d'spinner-container'\x3e\x3c/div\x3e");f.addCancel("Close",function(a){a.remove();f=void 0});f.getCurrentPanel().setPadding(0);f.show();d.ajax({type:"GET",url:r(b),data:{expand:"user",max:50},dataType:"json"}).done(function(a){f.popup.element.is(":visible")&&(a.showFollowActions=v(),f.getCurrentPanel().html(c.Templates.Likes.likesDialog(a)),
d("#likes-dialog").find(".likes-dialog-follow-button").click(function(){var a=d(this);d.ajax({type:"PUT",url:e.contextPath()+"/rest/likes/1.0/user/"+g.get("remote-user")+"/following?username\x3d"+a.data("username"),contentType:"application/json",dataType:"json"}).done(function(){a.replaceWith("Following")})}))})},appendAction:function(a){a=a.find(".comment-actions-primary");var b=a.find("li[class~\x3d'comment-date']"),h=d(c.Templates.Likes.commentLikeSection({showLikeButton:n}));
0===b.length?a.find("li:last-child").after(h):b.before(h)},reload:function(a){d.each(a,function(a,b){var e=d("#comment-"+a).find(".like-summary");t(b,a,e);l[a]=b});var b=d("#page-comments");!n&&b.find(".like-summary:empty").each(function(){d(this).closest(".comment-action-like").hide()});b.find(".comment").each(function(){p.updateComment(d(this),a)});w.resolve(l)},updateComment:function(a,b){var c=a.attr("id");if(!c)return!0;var f=(/^comment-(\d+)$/.exec(c)||[])[1];if(!f)throw Error('Expecting ID attribute of comment to be in format "comment-XXX", found: '+
c);b=b[f]&&g.get("remote-user")&&0<d.grep(b[f].likes,function(a){return a.user.name===g.get("remote-user")}).length;a.find(".like-button").click(b?m(1,f,"comment"):m(0,f,"comment")).find(".like-button-text").html(b?"Unlike":"Like")},init:function(){var a=d(c.Templates.Likes.likeSection({showLikeButton:n}));g.get("page-id")&&d.ajax({type:"GET",url:r(g.get("page-id")),data:{commentLikes:!0},dataType:"json"}).done(function(b){if(g.get("remote-user")){var c=
0<d.grep(b.likes,function(a){return a.user.name===g.get("remote-user")}).length,f=b.content_type;a.find(".like-button").click(c?m(1,g.get("page-id"),f):m(0,g.get("page-id"),f)).find(".like-button-text").html(c?"Unlike":"Like")}c=a.find(".like-summary");t(b,b.content_id,c);""!==c.html()||n||a.hide();d("\x3cdiv id\x3d'likes-and-labels-container'\x3e\x3c/div\x3e").insertBefore("#labels-section").append(a).append(d("#labels-section"));l[b.content_id]=b;p.reload(b.commentLikes)});
p.appendAction(d("#page-comments"))}};return p});require("confluence/module-exporter").safeRequire("confluence-like/like",function(e){var c=require("confluence/legacy"),d=require("ajs");c.Likes.getLikesCache=e.getLikesCache;d.PageGadget||window.parent.AJS&&window.parent.AJS.PageGadget||(d.toInit(e.init),c.Likes.showLikeUsers=e.showLikeUsers,c.Likes.appendAction=e.appendAction,c.Likes.reload=e.reload,c.Likes.updateComment=e.updateComment)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/com/atlassian/confluence/plugins/like/js/like-summary-factory.js' */
define("confluence-like/like-summary-factory",["ajs","confluence/templates","jquery"],function(a,g,h){var k={"likes.summary.you":"You like this","likes.summary.1.promoted":"{0} likes this","likes.summary.2.promoted":"{0} and {1} like this","likes.summary.3.promoted":"{0}, {1} and {2} like this","likes.summary.1.non-promoted":"{0} likes this","likes.summary.x.non-promoted":"\u003ca href=\u0022\u0022 {1}\u003e{0} people\u003c/a\u003e like this",
"likes.summary.you.1.promoted":"You and {0} like this","likes.summary.you.2.promoted":"You, {0} and {1} like this","likes.summary.you.3.promoted":"You, {0}, {1} and {2} like this","likes.summary.you.1.non-promoted":"You and {0} like this","likes.summary.you.x.non-promoted":"You and \u003ca href=\u0022\u0022 {1}\u003e{0} others\u003c/a\u003e like this","likes.summary.1.promoted.1.non-promoted":"{0} and {1} like this",
"likes.summary.1.promoted.x.non-promoted":"{0} and \u003ca href=\u0022\u0022 {2}\u003e{1} others\u003c/a\u003e like this","likes.summary.2.promoted.1.non-promoted":"{0}, {1} and {2} like this","likes.summary.2.promoted.x.non-promoted":"{0}, {1} and \u003ca href=\u0022\u0022 {3}\u003e{2} others\u003c/a\u003e like this","likes.summary.3.promoted.1.non-promoted":"{0}, {1}, {2} and {3} like this","likes.summary.3.promoted.x.non-promoted":"{0}, {1}, {2} and \u003ca href=\u0022\u0022 {4}\u003e{3} others\u003c/a\u003e like this","likes.summary.you.1.promoted.1.non-promoted":"You, {0} and {1} like this",
"likes.summary.you.1.promoted.x.non-promoted":"You, {0} and \u003ca href=\u0022\u0022 {2}\u003e{1} others\u003c/a\u003e like this","likes.summary.you.2.promoted.1.non-promoted":"You, {0}, {1} and {2} like this","likes.summary.you.2.promoted.x.non-promoted":"You, {0}, {1} and \u003ca href=\u0022\u0022 {3}\u003e{2} others\u003c/a\u003e like this","likes.summary.you.3.promoted.1.non-promoted":"You, {0}, {1}, {2} and {3} like this","likes.summary.you.3.promoted.x.non-promoted":"You, {0}, {1}, {2} and \u003ca href=\u0022\u0022 {4}\u003e{3} others\u003c/a\u003e like this"};
return{getLikeSummary:function(a,c,m){if(!a||0===a.length)return{key:"",text:""};if(!c)throw Error("contentId is required.");var l,e=[],f=[];h.each(a,function(a,b){b.user&&b.user.name==m?l=b:3>e.length&&b.user.followedByRemoteUser?e.push(b):f.push(b)});a=["likes.summary"];var d=[];null!=l&&a.push(".you");0<e.length&&(a.push("."),a.push(e.length),a.push(".promoted"),h.each(e,function(a,b){d.push(g.Likes.userLink(b))}));1===f.length?(a.push(".1.non-promoted"),d.push(g.Likes.userLink(f[0]))):1<f.length&&
(a.push(".x.non-promoted"),d.push(f.length),d.push('class\x3d"likes" data-content-id\x3d"'+c+'"'));c=a.join("");return{key:c,args:0===d.length?void 0:d,text:c in k?k[c]:""}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-like/like-summary-factory","Confluence.Likes.LikeSummaryFactory");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-like:content-like-resources', location = '/templates/com/atlassian/confluence/plugins/like/soy/like.soy' */
// This file was automatically generated from like.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Likes.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Likes == 'undefined') { Confluence.Templates.Likes = {}; }


Confluence.Templates.Likes.likeButton = function(opt_data, opt_ignored) {
  return '<a href="" class="like-button">' + ((opt_data.useIcon) ? '<span class="aui-icon aui-icon-small aui-iconfont-like"></span>' : '') + '<span class="like-button-text">' + soy.$$escapeHtml('Like') + '</span></a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Likes.likeButton.soyTemplateName = 'Confluence.Templates.Likes.likeButton';
}


Confluence.Templates.Likes.likeSection = function(opt_data, opt_ignored) {
  return '<div id="likes-section" class="no-print">' + ((opt_data.showLikeButton) ? Confluence.Templates.Likes.likeButton({useIcon: true}) : '') + '<span class="like-summary"></span></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Likes.likeSection.soyTemplateName = 'Confluence.Templates.Likes.likeSection';
}


Confluence.Templates.Likes.commentLikeSection = function(opt_data, opt_ignored) {
  return '<li class="comment-action-like">' + ((opt_data.showLikeButton) ? Confluence.Templates.Likes.likeButton({useIcon: false}) : '') + '<span class="like-summary"></span></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Likes.commentLikeSection.soyTemplateName = 'Confluence.Templates.Likes.commentLikeSection';
}


Confluence.Templates.Likes.likesDialog = function(opt_data, opt_ignored) {
  var output = '<div id="likes-dialog-body"><ol>';
  var likeList26 = opt_data.likes;
  var likeListLen26 = likeList26.length;
  for (var likeIndex26 = 0; likeIndex26 < likeListLen26; likeIndex26++) {
    var likeData26 = likeList26[likeIndex26];
    output += '<li><div class="avatar-container"><a href="' + soy.$$escapeHtml(likeData26.user.url) + '"><img class="like-user-avatar" src="' + soy.$$escapeHtml(likeData26.user.avatarUrl) + '"></a></div><div class="like-user"><a class="like-user-link" href="' + soy.$$escapeHtml(likeData26.user.url) + '">' + soy.$$escapeHtml(likeData26.user.fullName) + '</a></div>' + ((opt_data.showFollowActions) ? '<div class="follow-button-container aui-toolbar"><ul class="toolbar-group"><li class="toolbar-item">' + ((likeData26.user.followedByRemoteUser) ? soy.$$escapeHtml('Following') : '<button data-username="' + soy.$$escapeHtml(likeData26.user.name) + '" class="likes-dialog-follow-button toolbar-trigger">' + soy.$$escapeHtml('Follow') + '</button>') + '</li></ul></div>' : '') + '</li>';
  }
  output += '</ol></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Likes.likesDialog.soyTemplateName = 'Confluence.Templates.Likes.likesDialog';
}


Confluence.Templates.Likes.userLink = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.user.url) + '" class="confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.user.name) + '">' + soy.$$escapeHtml(opt_data.user.fullName) + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Likes.userLink.soyTemplateName = 'Confluence.Templates.Likes.userLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/user.soy' */
// This file was automatically generated from user.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }


Confluence.Templates.User.userLinkUrl = function(opt_data, opt_ignored) {
  return soy.$$escapeHtml("") + '/display/~' + soy.$$escapeUri(opt_data.username);
};
if (goog.DEBUG) {
  Confluence.Templates.User.userLinkUrl.soyTemplateName = 'Confluence.Templates.User.userLinkUrl';
}


Confluence.Templates.User.logo = function(opt_data, opt_ignored) {
  return '' + ((opt_data.profilePictureInfo['default'] && opt_data.username == opt_data.currentUsername) ? '<a ' + ((opt_data.canView) ? ' ' + ((! opt_data.disableUserHover) ? 'class="userLogoLink"' : '') + ' data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : '') + ' href="' + soy.$$escapeHtml("") + '/users/profile/editmyprofilepicture.action" title="' + soy.$$escapeHtml('Add a picture of yourself') + '"><img class="userLogo logo defaultLogo" src="' + soy.$$escapeHtml("/s/libiju/8703/4mhn8a/_") + '/images/icons/profilepics/add_profile_pic.svg" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml('Add a picture of yourself') + '"></a>' : (opt_data.profilePictureInfo.anonymous) ? '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/libiju/8703/4mhn8a/_") + '/images/icons/profilepics/anonymous.svg" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml('Anonymous') + '" title="' + soy.$$escapeHtml('Anonymous') + '">' : (opt_data.canView) ? '<a ' + ((! opt_data.disableUserHover) ? 'class="userLogoLink"' : '') + ' data-username="' + soy.$$escapeHtml(opt_data.username) + '" href="' + Confluence.Templates.User.userLinkUrl(opt_data) + '"><img class="userLogo logo" src="' + soy.$$escapeHtml(opt_data.profilePictureInfo.uriReference) + '" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml(opt_data.username) + '" title="' + soy.$$escapeHtml(opt_data.username) + '"></a>' : '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/libiju/8703/4mhn8a/_") + '/images/icons/profilepics/anonymous.svg" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml(opt_data.username) + '" title="' + soy.$$escapeHtml(opt_data.username) + '">');
};
if (goog.DEBUG) {
  Confluence.Templates.User.logo.soyTemplateName = 'Confluence.Templates.User.logo';
}


Confluence.Templates.User.usernameLink = function(opt_data, opt_ignored) {
  return '' + ((opt_data.username && opt_data.username != '') ? '<a href="' + Confluence.Templates.User.userLinkUrl(opt_data) + '"' + ((opt_data.canView) ? 'class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : 'class="url fn"') + '>' + ((opt_data.fullName && opt_data.fullName != '') ? soy.$$escapeHtml(opt_data.fullName) : soy.$$escapeHtml(opt_data.username)) + '</a>' : soy.$$escapeHtml('Anonymous'));
};
if (goog.DEBUG) {
  Confluence.Templates.User.usernameLink.soyTemplateName = 'Confluence.Templates.User.usernameLink';
}


Confluence.Templates.User.fullNameOrAnonymous = function(opt_data, opt_ignored) {
  return '' + ((opt_data.user && opt_data.user.fullName) ? soy.$$escapeHtml(opt_data.user.fullName) : soy.$$escapeHtml('Anonymous'));
};
if (goog.DEBUG) {
  Confluence.Templates.User.fullNameOrAnonymous.soyTemplateName = 'Confluence.Templates.User.fullNameOrAnonymous';
}


Confluence.Templates.User.usernameOrAnonymous = function(opt_data, opt_ignored) {
  return '' + ((opt_data.user && opt_data.user.name) ? soy.$$escapeHtml(opt_data.user.name) : soy.$$escapeHtml('Anonymous'));
};
if (goog.DEBUG) {
  Confluence.Templates.User.usernameOrAnonymous.soyTemplateName = 'Confluence.Templates.User.usernameOrAnonymous';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Icons.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Icons == 'undefined') { Confluence.Templates.Icons = {}; }


Confluence.Templates.Icons.contentIcon = function(opt_data, opt_ignored) {
  return '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon ' + soy.$$escapeHtml(opt_data.iconCss) + '" title="' + soy.$$escapeHtml(opt_data.iconTitle) + '">' + soy.$$escapeHtml(opt_data.iconTitle) + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.contentIcon.soyTemplateName = 'Confluence.Templates.Icons.contentIcon';
}


Confluence.Templates.Icons.contentIconFont = function(opt_data, opt_ignored) {
  return '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" title="' + soy.$$escapeHtml(opt_data.iconTitle) + '"><span class="aui-icon ' + soy.$$escapeHtml(opt_data.iconCss) + '">' + soy.$$escapeHtml(opt_data.iconTitle) + '</span></a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.contentIconFont.soyTemplateName = 'Confluence.Templates.Icons.contentIconFont';
}


Confluence.Templates.Icons.iconSpan = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<span class="icon' + ((opt_data.type) ? ' aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.type) : '') + ' ' + ((opt_data.additionalClasses) ? soy.$$escapeHtml(opt_data.additionalClasses) : '') + '">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</span>';
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.iconSpan.soyTemplateName = 'Confluence.Templates.Icons.iconSpan';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/captcha.soy' */
// This file was automatically generated from captcha.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Captcha.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Captcha == 'undefined') { Confluence.Templates.Captcha = {}; }


Confluence.Templates.Captcha.form = function(opt_data, opt_ignored) {
  var output = '<div class="captcha field-group"><label id="captcha-response-label" for="captcha-response"><span class="assistive">' + soy.$$escapeHtml('If you are unable to use this CAPTCHA please \x3ca href\x3d\x22administrators.action\x22 tabindex\x3d\x225\x22\x3econtact your administrator\x3c/a\x3e for assistance.') + '</span></label>' + Confluence.Templates.Captcha.image(opt_data) + '<input type="text" id="captcha-response" name="captchaResponse" value="" class="text" placeholder="' + soy.$$escapeHtml('Type the word above') + '">';
  if (opt_data.captchaErrors && opt_data.captchaErrors.length) {
    var errorList13 = opt_data.captchaErrors;
    var errorListLen13 = errorList13.length;
    for (var errorIndex13 = 0; errorIndex13 < errorListLen13; errorIndex13++) {
      var errorData13 = errorList13[errorIndex13];
      output += aui.message.warning({content: errorData13});
    }
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Captcha.form.soyTemplateName = 'Confluence.Templates.Captcha.form';
}


Confluence.Templates.Captcha.image = function(opt_data, opt_ignored) {
  return '<img src="' + soy.$$escapeHtml("") + '/jcaptcha?id=' + soy.$$escapeHtml(opt_data.captchaId) + '" class="captcha-image" alt="' + soy.$$escapeHtml('CAPTCHA image') + '"><input type="hidden" name="captchaId" value="' + soy.$$escapeHtml(opt_data.captchaId) + '" placeholder="' + soy.$$escapeHtml('Type the word above') + '">';
};
if (goog.DEBUG) {
  Confluence.Templates.Captcha.image.soyTemplateName = 'Confluence.Templates.Captcha.image';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/notifications.soy' */
// This file was automatically generated from notifications.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Notifications.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Notifications == 'undefined') { Confluence.Templates.Notifications = {}; }


Confluence.Templates.Notifications.notLoggedIn = function(opt_data, opt_ignored) {
  return '' + ((! opt_data.isUserAuthenticated) ? '<div id="anonymous-warning" class="aui-message aui-message-warning closeable">' + soy.$$filterNoAutoescape('You are not logged in. Any changes you make will be marked as \x3cspan class\x3d\x22smalltext\x22\x3eanonymous\x3c/span\x3e.') + ((! opt_data.isExternalUserManagementEnabled) ? ' ' + soy.$$filterNoAutoescape(AJS.format('You may want to \x3ca href\x3d\x22{0}\x22\x3eLog In\x3c/a\x3e if you already have an account.',opt_data.loginURL)) : '') + '</div>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Notifications.notLoggedIn.soyTemplateName = 'Confluence.Templates.Notifications.notLoggedIn';
}


Confluence.Templates.Notifications.actionErrors = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.actionErrors.length > 0) {
    output += '<div class="aui-message aui-message-error ' + ((opt_data.closeable) ? 'closeable' : '') + '"><p class="title">' + soy.$$escapeHtml('The following error(s) occurred:') + '</p><ul>';
    var errorHtmlList24 = opt_data.actionErrors;
    var errorHtmlListLen24 = errorHtmlList24.length;
    for (var errorHtmlIndex24 = 0; errorHtmlIndex24 < errorHtmlListLen24; errorHtmlIndex24++) {
      var errorHtmlData24 = errorHtmlList24[errorHtmlIndex24];
      output += '<li>' + soy.$$filterNoAutoescape(errorHtmlData24) + '</li>';
    }
    output += '</ul></div>';
  }
  output += '<div id="action-messages-notifications"></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Notifications.actionErrors.soyTemplateName = 'Confluence.Templates.Notifications.actionErrors';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'probe.js' */
!function(){var n,t,e,r,i,o,u,a,c,s,f,l,h,d,y,p,v,m,w;n=function(){return window}(),t=function(n){return!(!n.performance||!n.performance.now)}(n),e=[],r=function(n){return function(t){n.unshift({addReporter:t})}}(e),i=function(n){return function(t){for(;n.length;)t(n.splice(0,1)[0]);n.unshift=t,n.push=t}}(e),o=function(n,t){return function(e){n.push({end:{key:e.key,timestamp:t.performance.now()}})}}(e,n),u=function(n){return n.document}(n),a=function(n){return n.Promise}(n),c=function(){function n(){this._={}}var t=function(e){var r=e[0],i=e[1];i instanceof n?e.length>=3?Object.keys(i._).forEach(function(n){t([r,i._[n],n].concat(e.slice(2)))}):Object.keys(i._).forEach(function(n){t([r,i._[n],n])}):Array.isArray(i)&&r.apply(null,[i].concat(e.slice(2)))};n.prototype.forEach=function(n){t([n,this])},n.prototype.add=function(){for(var t=this,e=null,r=null,i=0;i<arguments.length;i++){if(r=arguments[i],i===arguments.length-1&&Array.isArray(t)){t.push(r);break}i<arguments.length-2&&!t._.hasOwnProperty(r)?t._[r]=new n:i!==arguments.length-2||t._.hasOwnProperty(r)||(t._[r]=[]),t=t._[r],e=r}};var e=function(n,t){if(0!==n.length){var r=n.pop(),i=r[0],o=r[1];i===t?e(n,i):o._.hasOwnProperty(t)&&delete o._[t],0===Object.keys(o).length&&e(n,i)}};return n.prototype.remove=function(){for(var n,t=!1,r=null,i=this,o=[[r,i]],u=null,a=0;a<arguments.length;a++)if(u=arguments[a],Array.isArray(i))n=i.indexOf(u),n>-1&&(i.splice(n,1),0===i.length&&o.length>1&&e(o,r),t=!0);else{if(!i._.hasOwnProperty(u))break;a===arguments.length-1&&(delete i._[u],0===Object.keys(i).length&&o.length>1&&e(o,r),t=!0),r=u,i=i._[u],o.push([r,i])}return t},n.prototype.get=function(n){return this._.hasOwnProperty(n)?this._[n]:[]},n}(),s=function(n,t,e,r){function i(n){return!n||null==n||"null"===n||"undefined"===n}function o(t,e,r){l||(c.observe(n,{attributes:!0,childList:!0,subtree:!0}),l=!0),s.add(t,e,r)}function u(t,e){var r=n.querySelectorAll(t);return r.length&&(i(e)||Array.prototype.every.call(r,function(n){return!n.querySelector(e)}))}function a(n,e){var r;n.forEach||(n=[n]),!i(e)&&Array.isArray(e)&&(e=e.join(", "));var a=new t(function(i,a){var c=[],f=[];n.forEach(function(n){var r,i;u(n,e)||(r=new t(function(t){o(n,e,t),i=function(){s.remove(n,e,t)},f.push(i)}),c.push(r))});var l=function(){f.forEach(function(n){n()})};t.all(c).then(l).then(i,a),r=function(){l(),a()}});return a.dismiss=r,a}var c,s,f=r.MutationObserver,l=!1;return f&&t?(s=new e,c=new f(function(){s.forEach(function(n,t,e){u(e,t)&&(n.forEach(function(n){n()}),s.remove(e,t))})}),a):void 0}(u,a,c,n),f=function(n){return!!n}(s),l=function(n){function t(){c(),n.body.classList.add(u)}function e(){function e(){n.body.classList.remove(u),n.removeEventListener(i,s),n.removeEventListener(o,c),r=null}if(r)return r;var c,s,f=!1;return r=new Promise(function(e,r){"visible"!==n.visibilityState?r():(s=function(){f=!0},c=function(n){n.animationName===a&&(f?r():e())},n.addEventListener(i,s),n.addEventListener(o,c),t())}),r.then(e,e),r}var r,i="visibilitychange",o="animationend",u="browser-metrics-visibility-test",a="browser-metrics-visibility-animation",c=function(){var t=n.createElement("style"),e=["."+u+" {","-webkit-animation-duration: 0.001s;","animation-duration: 0.001s;","-webkit-animation-name: "+a+";","animation-name: "+a+";","-webkit-animation-iteration-count: 1;","animation-iteration-count: 1;","}","@keyframes "+a+" {}","@-webkit-keyframes "+a+" {","from {}","to {}","}"].join("\n");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(n.createTextNode(e)),n.head.appendChild(t),c=function(){}};return e}(u),h=function(n,t,e,r,i){function o(n){return Array.isArray(n)||(n=[n]),n.map(function(n){return"string"==typeof n?{selector:n,hasNone:null}:n})}function u(n){return Array.isArray(n)||"string"==typeof n}function a(n){return u(n)&&(n={rules:n}),n.rules=o(n.rules),n.requirePaint="undefined"==typeof n.requirePaint?!1:n.requirePaint,n}return function(i,o){if(n){i=a(i);var u=function(){},c=new e(function(n,r){var o=[],a=i.rules.map(function(n){var e=new t(n.selector,n.hasNone);return o.push(function(){e.dismiss()}),e});u=function(){o.forEach(function(n){n()}),r()},e.all(a).then(function(n){}).then(n,r)});return c.cancel=u,i.requirePaint&&(c=c.then(r)),"function"==typeof o&&c.then(o),c}}}(f,s,a,l,n),d=function(n,t){function e(){return r}var r=!1;return n.addEventListener("DOMContentLoaded",function(){t.setTimeout(function(){r=!0})}),e}(u,n),y=function(n,t,e,r,i,o,u){function a(){c=null}var c;return function(o){var s="isInitial"in o?o.isInitial:i()===!1,f="threshold"in o?o.threshold:1e3,l="reporters"in o?o.reporters:[];r.push({start:{key:o.key,isInitial:s,threshold:f,timestamp:s?0:u.performance.now(),reporters:Array.isArray(l)?l:[l]}}),c&&(c.cancel(),a()),o.ready&&e&&(c=n(o.ready),c.then(function(){t({key:o.key})}).then(a,a))}}(h,o,f,e,d,a,n),p=function(n){return function(t){n.push({subscribe:t})}}(e),v=function(){return window}(),m=function(n){return n.performance}(v),w=function(n,t,e,r,i,o,u){var a=function(){};return u?{start:n?i:a,end:n?r:a,addReporter:n?t:a,delegateTo:n?e:a,subscribe:n?o:a}:void 0}(t,r,i,o,y,p,m),window["browser-metrics"]=w,window.define&&window.define("internal/browser-metrics",function(){return w})}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'internal/browser-metrics-aa-beacon.js' */
!function(){var e={};e=function(e){function n(e,n){Object.keys(n).forEach(function(r){e[r]=n[r]})}Object.defineProperty(e,"__esModule",{value:!0});var r,t=[],o=[];return e.addUrlCleaner=function(e){o.push(e)},e.cleanUrl=function(e){return o.reduce(function(n,r){var t=r(e);return t.length>n.length?t:n},"")},e.addReportMarshaller=function(e){t.push(e)},e.setEventQueue=function(e){r=e},e.beacon=function(e){var o={};t.forEach(function(r){var t=r(e);"object"==typeof t&&n(o,t)});var a={name:"browser.metrics.navigation",properties:o};(r||AJS.EventQueue).push(a)},e}(e),window["browser-metrics-aa-beacon"]=e,window.define&&window.define("internal/browser-metrics-aa-beacon",function(){return e})}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'loader.js' */
!function(){var n={},r={};r=function(n,r,i){function e(){t===u&&o&&(o(),o=null)}Object.defineProperty(n,"__esModule",{value:!0});var t=0,u=0,o=null,c={install:function(n){t+=1,n(function(){u+=1,e()})}};return r["browser-metrics-plugin"]=c,i.require(["wrc!browser-metrics-plugin.contrib"],function(){r.require(["internal/browser-metrics-plugin/collector"],function(n){o=function(){n.install()},e()})}),n}(r,n=window,n.WRM)}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:viewcontent', location = '/js/viewcontent.js' */
require(["confluence/api/event","internal/browser-metrics","ajs","jquery"],function(f,e,c,g){function b(i){if(!g(i.target).hasClass("full-load")){var h=i.data.type;if(c.Meta.getBoolean("collaborative-content")){var j="confluence."+h+".edit.collaborative.quick-view";e.start({key:j});c.bind("rte-collab-ready",function(){e.end({key:j});e.start({key:j+".connected"})});c.bind("synchrony.connected",function(){e.end({key:j+".connected"})})}else{if(!c.Meta.getBoolean("shared-drafts")){e.start({key:"confluence."+h+".edit.quick-view",ready:".active-richtext"})}}}}function a(){e.start({key:"confluence.file.preview.firstpage"});f.bind("confluence-previews.fileviewer.completed",function(){e.end({key:"confluence.file.preview.firstpage"})})}function d(){var j=c.Meta.get("content-type");var i=g("#confluence-ui.confluence-dashboard").length;var h=window.location.href.indexOf("/content-only/")>-1;if(j){if(!i&&!h){e.start({key:"confluence."+j+".view",ready:".wiki-content",isInitial:true})}g("#editPageLink").on("click",{type:j},b);g(".confluence-embedded-file-wrapper").on("click",a)}}c.toInit(d)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.gatekeeper.gatekeeper-plugin:who-can-view-entry', location = 'who-can-view-entry.js' */
!function(e){function n(n){for(var t,r,a=n[0],u=n[1],i=0,c=[];i<a.length;i++)r=a[i],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&c.push(o[r][0]),o[r]=0;for(t in u)Object.prototype.hasOwnProperty.call(u,t)&&(e[t]=u[t]);for(l&&l(n);c.length;)c.shift()()}var t={},o={"who-can-view-entry":0};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.e=function(e){var n=[];return 0===o[e]?Promise.resolve():o[e]?o[e][2]:(n.push(new Promise((function(n,t){o[e]=[n,t]})),new Promise((function(n,t){WRM.require("wrc!com.atlassian.confluence.plugins.gatekeeper.gatekeeper-plugin:"+e).then(n,t)}))),o[e][2]=Promise.all(n))},r.m=e,r.c=t,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r.oe=function(e){throw console.error(e),e},"undefined"!=typeof AJS&&(r.p=AJS.contextPath()+"/download/resources/com.atlassian.confluence.plugins.gatekeeper.gatekeeper-plugin:assets-ca2a18fe-74e1-4be9-9bfe-f31b927d4dc1/");var a=window.atlassianWebpackJsonp714631d0c4f9ce0999d5f515f37461f0=window.atlassianWebpackJsonp714631d0c4f9ce0999d5f515f37461f0||[],u=a.push.bind(a);a.push=n,a=a.slice();for(var i=0;i<a.length;i++)n(a[i]);var l=u;r(r.s=418)}({174:function(e,n){e.exports=require("ajs")},418:function(e,n,t){e.exports=t(419)},419:function(e,n,t){"use strict";var o,r=(o=t(174))&&o.__esModule?o:{default:o};"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;r.default.toInit((function(){var e=document.getElementById("who-can-view-button-ak-button");null!==e&&e.addEventListener("click",(function(e){e.preventDefault(),Promise.all([t.e("vendors~who-can-view-controller"),t.e("who-can-view-controller")]).then(t.t.bind(null,421,7)).then((function(e){(0,e.show)(!0)}))}))}))}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter-init', location = 'sh/asyncLoader.js' */
/**
 * Load the Code Macro resources via WRM.require(). This avoids any extra blocking resources being added to the <head>
 */
define('confluence/code-macro/async-loader', ['jquery', 'wrm', 'underscore'], function ($, WRM, _) {
    return function () {
        _.defer(function () {
            const $controlButtons = $('.codeHeader .collapse-source');
            _showSpinner($controlButtons);
            const $codeBlocks = $('#content').find('pre.syntaxhighlighter-pre');
            const wrmResources = [];
            const wrmPrefix = 'wr!com.atlassian.confluence.ext.newcode-macro-plugin:';

            if ($codeBlocks.length > 0) {
                const themeResourcePrefix = wrmPrefix + 'sh-theme-';
                wrmResources.push('wrc!code-macro');

                $codeBlocks.each(function () {
                    wrmResources.push(themeResourcePrefix + $(this).data('theme').toLowerCase());

                    // If the macro is using a custom language, we need to download it
                    const customLanguageResource = $(this).data('custom-language-resource');
                    if (typeof customLanguageResource !== 'undefined' && wrmResources.indexOf(customLanguageResource) === -1) {
                        wrmResources.push('wr!' + customLanguageResource);
                    }
                });
            } else {
                // Only the bidi marker resource
                wrmResources.push(wrmPrefix + 'code-macro-bidi');
            }

            WRM.require(wrmResources).done(function () {
                if (window.SyntaxHighlighter && typeof window.SyntaxHighlighter.highlight === 'function') {
                    window.SyntaxHighlighter.highlight();
                }
                _hideSpinner($controlButtons);
            });
        });

        /**
         * Hide the expand/collapse buttons until the highlighter is finished, and show a spinner instead
         * @param $controlButtons The expand/collapse buttons
         * @private
         */
        function _showSpinner($controlButtons) {
            $controlButtons.hide();
            // Avoiding searching the entire dom again
            _.forEach($controlButtons, function (button) {
                $(button).next('.collapse-spinner-wrapper').spin();
            });
        }

        /**
         * Show the expand/collapse buttons and hide the spinner once the highlighter is ready.
         * @param $controlButtons The expand/collapse buttons
         * @private
         */
        function _hideSpinner($controlButtons) {
            $controlButtons.show();
            $controlButtons.next('.collapse-spinner-wrapper').remove();
        }
    };
});

require('confluence/module-exporter').safeRequire('confluence/code-macro/async-loader', function (CodeMacroLoader) {
    AJS.toInit(CodeMacroLoader);
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugin.jslibs:skate-0.12.6', location = 'libs/skate/0.12.6/skate-0.12.6.js' */
(function e(g,c,j){function h(a,k){if(!c[a]){if(!g[a]){var d="function"==typeof require&&require;if(!k&&d)return d(a,!0);if(f)return f(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d;}d=c[a]={exports:{}};g[a][0].call(d.exports,function(c){var f=g[a][1][c];return h(f?f:c)},d,d.exports,e,g,c,j)}return c[a].exports}for(var f="function"==typeof require&&require,d=0;d<j.length;d++)h(j[d]);return h})({1:[function(b,g,c){Object.defineProperty(c,"__esModule",{value:!0});"use strict";
c.ATTR_IGNORE="data-skate-ignore";c.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"}},{}],2:[function(b,g){g.exports={get:function(c,b){if(c.__SKATE_DATA)return c.__SKATE_DATA[b]},set:function(c,b,h){c.__SKATE_DATA||(c.__SKATE_DATA={});c.__SKATE_DATA[b]=h;return c}}},{}],3:[function(b,g){function c(c){for(var f=c.length,b=0;b<f;b++){var i=c[b],o=i.addedNodes,i=i.removedNodes;o&&(o.length&&!p(o[0].parentNode))&&d(o);i&&i.length&&a(i)}}var j=function(c){return c&&c.__esModule?
c["default"]:c},h=j(b("./globals")),f=b("./lifecycle"),d=f.initElements,a=f.removeElements,k=j(b("./mutation-observer")),p=b("./utils").getClosestIgnoredElement;g.exports={register:function(a){a&&(k.fixIe(),this.unregister());h.observer||(a=new k(c),a.observe(document,{childList:!0,subtree:!0}),h.observer=a);return this},unregister:function(){h.observer&&(h.observer.disconnect(),h.observer=void 0);return this}}},{"./globals":4,"./lifecycle":5,"./mutation-observer":6,"./utils":9}],4:[function(b,g){window.__skate||
(window.__skate={observer:void 0,registry:{}});g.exports=window.__skate},{}],5:[function(b,g,c){function j(o,c,a){if(k.get(o,c.id+":lifecycle:"+a))return!0;k.set(o,c.id+":lifecycle:"+a,!0);return!1}function h(c,a){if(!j(c,a,"created")){m(c,a.prototype,!0);a.template&&a.template(c);var b=function(a,b){return function(f){if(!b)return a(c,f,c);for(var d=f.target;d&&d!==document&&d!==c.parentNode;){if(i.call(d,b))return a(c,f,d);d=d.parentNode}}};"object"===typeof a.events&&l(a.events,function(a,d){var f,
i;i=d.split(" ");f=i.shift();i=i.join(" ");c.addEventListener(f,b(a,i),!!i&&("blur"===f||"focus"===f))});var f=function(i,f,d,b){var k;a.attributes&&a.attributes[f]&&"function"===typeof a.attributes[f][i]?k=a.attributes[f][i]:a.attributes&&"function"===typeof a.attributes[f]?k=a.attributes[f]:"function"===typeof a.attributes&&(k=a.attributes);k&&k(c,{type:i,name:f,newValue:d,oldValue:b})},d,k=c.attributes,h=[],g=k.length;(new p(function(a){a.forEach(function(a){var c,i=a.attributeName,d=k[i];d&&null===
a.oldValue?c="created":d&&null!==a.oldValue?c="updated":d||(c="removed");f(c,i,d?d.value||d.nodeValue:void 0,a.oldValue)})})).observe(c,{attributes:!0,attributeOldValue:!0});for(d=0;d<g;d++)h.push(k[d]);for(d=0;d<g;d++){var n=h[d];f("created",n.nodeName,n.value||n.nodeValue)}a.created&&a.created(c)}}function f(c){for(var i=c.length,d=0;d<i;d++){var b=c[d];if(!(1!==b.nodeType||b.attributes[a])){for(var k=n.getForElement(b),g=k.length,m=0;m<g;m++){var l=b,p=k[m];h(l,p);j(l,p,"attached")||(l.removeAttribute(p.unresolvedAttribute),
l.setAttribute(p.resolvedAttribute,""),p.attached&&p.attached(l))}b=b.childNodes;b.length&&f(b)}}}function d(a){for(var c=a.length,i=0;i<c;i++){var f=a[i];if(1===f.nodeType){d(f.childNodes);for(var b=n.getForElement(f),g=b.length,j=0;j<g;j++){var h=f,m=b[j];m.detached&&m.detached(h);k.set(h,m.id+":lifecycle:attached",!1)}}}}g=function(a){return a&&a.__esModule?a["default"]:a};Object.defineProperty(c,"__esModule",{value:!0});"use strict";var a=b("./constants").ATTR_IGNORE,k=g(b("./data")),p=g(b("./mutation-observer")),
n=g(b("./registry")),b=b("./utils"),m=b.inherit,l=b.objEach,b=window.HTMLElement.prototype,i=b.matches||b.msMatchesSelector||b.webkitMatchesSelector||b.mozMatchesSelector||b.oMatchesSelector;c.triggerCreated=h;c.initElements=f;c.removeElements=d},{"./constants":1,"./data":2,"./mutation-observer":6,"./registry":7,"./utils":9}],6:[function(b,g){function c(a,c){return{addedNodes:null,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:null,target:a,
type:c||"childList"}}function j(a,c){var f=a.childNodes;if(f)for(var d=f.length,b=0;b<d;b++){var k=f[b];c(k);j(k,c)}}function h(a){if(n&&!m)return new n(a);this.callback=a;this.elements=[]}var f=b("./utils"),d=f.debounce,a=f.objEach,k=window.HTMLElement.prototype,p=window.HTMLElement.prototype.contains,n=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,m=!1,l=-1<window.navigator.userAgent.indexOf("Trident");h.fixIe=function(){if(l&&!m){var a=Object.getOwnPropertyDescriptor(k,
"innerHTML");Object.defineProperty(k,"innerHTML",{get:function(){return a.get.call(this)},set:function(c){j(this,function(a){var c=document.createEvent("MutationEvent");c.initMutationEvent("DOMNodeRemoved",!0,!1,null,null,null,null,null);a.dispatchEvent(c)});a.set.call(this,c)}});m=!0}};Object.defineProperty(h,"isFixingIe",{get:function(){return m}});h.prototype={observe:function(a,f){function b(a){h.push(a);n()}var k=this,j,g,h=[],l=[],n=d(function(){for(var b=h.length,d=0;d<b;d++){var n=h[d],r=
n.target;if(r){var n=n.type,q=r.parentNode;if(f.childList&&(f.subtree||q===a)){var s=m&&"DOMNodeRemoved"===n,t=j&&(1!==j.nodeType?!1:j.contains?j.contains(r):p.call(j,r));if(s||!t){if(!g||g.target!==q)l.push(g=c(q));"DOMNodeInserted"===n?(g.addedNodes||(g.addedNodes=[]),g.addedNodes.push(r)):(g.removedNodes||(g.removedNodes=[]),g.removedNodes.push(r));j=r}}}}k.callback(l);h=[];l=[];g=j=void 0}),t={},q=[],u=d(function(){var a=q.length;k.callback(q);q.splice(0,a)}),s={target:a,options:f,insertHandler:b,
removeHandler:b,attributeHandler:function(d){var b=d.target;if(f.attributes&&(f.subtree||b===a)){var k=d.attrName,g=d.prevValue,d=d.newValue,b=c(b,"attributes");b.attributeName=k;f.attributeOldValue&&(b.oldValue=t[k]||g||null);q.push(b);f.attributeOldValue&&(t[k]=d);u()}}};this.elements.push(s);f.childList&&(a.addEventListener("DOMNodeInserted",s.insertHandler),a.addEventListener("DOMNodeRemoved",s.removeHandler));f.attributes&&a.addEventListener("DOMAttrModified",s.attributeHandler);return this},
disconnect:function(){a(this.elements,function(a){a.target.removeEventListener("DOMNodeInserted",a.insertHandler);a.target.removeEventListener("DOMNodeRemoved",a.removeHandler);a.target.removeEventListener("DOMAttrModified",a.attributeHandler)});this.elements=[];return this}};g.exports=h},{"./utils":9}],7:[function(b,g){function c(a,c){return d(j.registry,a)&&-1<j.registry[a].type.indexOf(c)}var j,h=b("./globals");j=h&&h.__esModule?h["default"]:h;var f=b("./constants.js").types,d=b("./utils").hasOwn;
g.exports={clear:function(){j.registry={};return this},getForElement:function(a){var d=a.attributes,b=d.length,g=[],h=d.is,l=h&&(h.value||h.nodeValue),h=a.tagName.toLowerCase(),i=l||h,o;c(i,f.TAG)&&(i=j.registry[i],o=i["extends"],l?h===o&&g.push(i):o||g.push(i));for(l=0;l<b;l++)i=d[l].nodeName,c(i,f.ATTR)&&(i=j.registry[i],o=i["extends"],(!o||h===o)&&g.push(i));(d=a.classList)?a=d:(a=a.attributes,a=a["class"]&&a["class"].nodeValue.split(/\s+/)||[]);d=a.length;for(b=0;b<d;b++)i=a[b],c(i,f.CLASS)&&
(i=j.registry[i],o=i["extends"],(!o||h===o)&&g.push(i));return g},has:function(a){return d(j.registry,a)},set:function(a,c){if(this.has(a))throw Error('A definition of type "'+c.type+'" with the ID of "'+a+'" already exists.');j.registry[a]=c;return this},remove:function(a){this.has(a)&&delete j.registry[a];return this}}},{"./constants.js":1,"./globals":4,"./utils":9}],8:[function(b,g){function c(a,b){b=n(b||{},c.defaults);b.id=a;if(k.has(b.id))throw Error('A definition of type "'+b.type+'" with the ID of "'+
a+'" already exists.');k.set(b.id,b);i();h.register(b.remove);if(-1<b.type.indexOf(m.TAG)){var f=b,g=function(){var a;a=f["extends"];var b=f.id;a?(a=document.createElement(a),a.setAttribute("is",b)):a=document.createElement(b);f.prototype=g.prototype;d(a,f);return a};g.prototype=f.prototype;return g}}var j=function(a){return a&&a.__esModule?a["default"]:a},h=j(b("./document-observer")),f=b("./lifecycle"),d=f.triggerCreated,a=f.initElements,k=j(b("./registry")),p=b("./utils"),f=p.debounce,n=p.inherit,
j=j(b("./version")),m=b("./constants").types,l=!!document.attachEvent,i=f(function(){var b=function(){a(document.getElementsByTagName("html"))},c;c=l?"complete"===document.readyState:"interactive"===document.readyState||"complete"===document.readyState;c?b():l?window.addEventListener("load",b):document.addEventListener("DOMContentLoaded",b)});c.init=function(b){if(b)return"string"===typeof b&&(b=document.querySelectorAll(b)),a("undefined"===typeof b.length?[b]:b),b};c.types=m;c.version=j;c.defaults=
{attributes:void 0,events:void 0,"extends":"",id:"",prototype:{},resolvedAttribute:"resolved",template:void 0,type:m.ANY,unresolvedAttribute:"unresolved"};var o=window.skate;c.noConflict=function(){window.skate=o;return this};window.skate=c;g.exports=c},{"./constants":1,"./document-observer":3,"./lifecycle":5,"./registry":7,"./utils":9,"./version":10}],9:[function(b,g,c){function j(b,c){return Object.prototype.hasOwnProperty.call(b,c)}c.hasOwn=j;c.debounce=function(b){var c=!1;return function(){c||
(c=!0,setTimeout(function(){c=!1;b()},1))}};c.getClosestIgnoredElement=function(b){for(;b&&b!==document&&!(b instanceof DocumentFragment);){if(b.hasAttribute(h))return b;b=b.parentNode}};c.inherit=function(b,c,a){for(var g=Object.getOwnPropertyNames(c),h=g.length,j=0;j<h;j++){var m=g[j];if(a||void 0===b[m]){var l=Object.getOwnPropertyDescriptor(c,m);l.get||l.set||!l.writable||!l.enumerable||!l.configurable?Object.defineProperty(b,m,l):b[m]=c[m]}}return b};c.objEach=function(b,c){for(var a in b)j(b,
a)&&c(b[a],a)};Object.defineProperty(c,"__esModule",{value:!0});"use strict";var h=b("./constants").ATTR_IGNORE},{"./constants":1}],10:[function(b,g){g.exports="0.12.6"},{}]},{},[8]);(function(b){var g=b.skate.noConflict();define("atlassian/libs/skate-0.12.6",[],function(){return g})})(window);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:skate', location = '/includes/js/amd/shim/skate-amd.js' */
define("skate",["atlassian/libs/skate-0.12.6"],function(a){return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:soy-resources', location = 'soy/page-banner.soy' */
// This file was automatically generated from page-banner.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PageBanner.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PageBanner == 'undefined') { Confluence.Templates.PageBanner = {}; }


Confluence.Templates.PageBanner.banner = function(opt_data, opt_ignored) {
  var output = '<div id="page-metadata-banner"><ul class="banner">' + Confluence.Templates.PageBanner.renderSystemContentItems(opt_data);
  var itemList6 = opt_data.pageBannerItems;
  var itemListLen6 = itemList6.length;
  for (var itemIndex6 = 0; itemIndex6 < itemListLen6; itemIndex6++) {
    var itemData6 = itemList6[itemIndex6];
    output += Confluence.Templates.PageBanner.renderPageBannerItem(itemData6);
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.banner.soyTemplateName = 'Confluence.Templates.PageBanner.banner';
}


Confluence.Templates.PageBanner.renderSystemContentItems = function(opt_data, opt_ignored) {
  var output = '<li id="system-content-items" class="noprint">';
  var itemList12 = opt_data.systemContentItems;
  var itemListLen12 = itemList12.length;
  for (var itemIndex12 = 0; itemIndex12 < itemListLen12; itemIndex12++) {
    var itemData12 = itemList12[itemIndex12];
    output += Confluence.Templates.PageBanner.itemAnchor(soy.$$augmentMap(itemData12, {isSystemContentItem: true}));
  }
  output += '</li>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.renderSystemContentItems.soyTemplateName = 'Confluence.Templates.PageBanner.renderSystemContentItems';
}


Confluence.Templates.PageBanner.renderPageBannerItem = function(opt_data, opt_ignored) {
  return '<li class="' + ((! opt_data.suppressDefaultStyle) ? 'page-metadata-item noprint' : '') + ((opt_data.isAuiButton) ? 'has-button' : '') + '" ' + ((opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '-wrapper"' : '') + '>' + Confluence.Templates.PageBanner.itemAnchor(soy.$$augmentMap(opt_data, {isSystemContentItem: false})) + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.renderPageBannerItem.soyTemplateName = 'Confluence.Templates.PageBanner.renderPageBannerItem';
}


Confluence.Templates.PageBanner.itemAnchor = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.href) + '" title="' + soy.$$escapeHtml(opt_data.tooltip) + '" ' + ((opt_data.linkId) ? 'id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '') + ' ' + ((opt_data.styleClasses) ? 'class="' + soy.$$escapeHtml(opt_data.styleClasses) + '"' : '') + '>' + Confluence.Templates.PageBanner.itemIcon(opt_data) + ((! opt_data.isSystemContentItem) ? '<span>' + soy.$$escapeHtml(opt_data.label) + '</span>' : '') + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.itemAnchor.soyTemplateName = 'Confluence.Templates.PageBanner.itemAnchor';
}


Confluence.Templates.PageBanner.itemIcon = function(opt_data, opt_ignored) {
  return '' + ((opt_data.icon) ? '<img class="page-banner-item-icon" src="' + soy.$$escapeHtml(opt_data.icon.url) + '" style="height: ' + soy.$$escapeHtml(opt_data.icon.height) + 'px; width: ' + soy.$$escapeHtml(opt_data.icon.width) + 'px;"/>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.itemIcon.soyTemplateName = 'Confluence.Templates.PageBanner.itemIcon';
}


Confluence.Templates.PageBanner.draftStatusDiscovery = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="' + soy.$$escapeHtml(opt_data.elementId) + '" alignment="bottom left" open><p><strong>' + soy.$$escapeHtml('Didn\x27t publish?') + '</strong></p><p>' + soy.$$filterNoAutoescape(AJS.format('All good, we\x27\x27ve saved your changes! Find them any time under \x3ca href\x3d\x22{0}\x22\x3eRecently worked on\x3c/a\x3e. Just keep editing, and publish when you\x27\x27re ready.',opt_data.linkToMyWork)) + '</p><p><a class="aui-button">' + soy.$$escapeHtml('Okay, got it!') + '</a></p></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.draftStatusDiscovery.soyTemplateName = 'Confluence.Templates.PageBanner.draftStatusDiscovery';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner.js' */
define("confluence-page-banner/page-banner",["ajs","jquery","confluence/templates","confluence/legacy","skate"],function(d,c,p,q,e){function f(){var a=c("#system-content-items");0==a.children(":not(.hidden)").length?a.addClass("hidden"):a.removeClass("hidden")}function l(){g("#system-content-items a:not(.tipsy-disabled),.page-metadata-item a:not(.tipsy-disabled),.page-metadata-modification-info a.last-modified:not(tipsy-disabled),#draft-status-lozenge");c("#system-content-items a:not(.tipsy-disabled),.page-metadata-item a:not(.tipsy-disabled),.page-metadata-modification-info a.last-modified:not(tipsy-disabled),#draft-status-lozenge").click(function(a){h(c(a.target).closest("a"))});
c(window).on("click scroll resize",h)}function g(a){c(document).tooltip({live:a,gravity:"n",title:"title",delayIn:500})}function h(a){c(".tipsy").remove();a&&(a=c(a).data("tipsy"))&&(a.hoverState="out")}var k=function(a,b){a=c("#content-metadata-page-restrictions");a.removeClass("aui-iconfont-locked aui-iconfont-unlocked restricted");var e=b.hasRestrictions&&!(b.hasExplicitRestrictions||b.hasInheritedRestrictions);b.hasExplicitRestrictions||e?(a.addClass("aui-icon aui-icon-small aui-iconfont-locked restricted"),
b="Restrictions apply"):b.hasInheritedRestrictions?(a.addClass("aui-icon aui-icon-small aui-iconfont-unlocked restricted"),b="Restrictions apply"):(a.addClass("aui-icon aui-icon-small aui-iconfont-unlocked"),b=b.hasAnyExplicitRestrictions?"Restrictions apply":"Unrestricted");a.attr("title",b);g("#content-metadata-page-restrictions");f()},m=function(){f();d.bind("system-content-metadata.toggled-restrictions",k);
c("#page-metadata-banner").css("visibility","visible");l()},n=function(){d.unbind("system-content-metadata.toggled-restrictions",k)};(function(){e("system-metadata-restrictions",{type:e.types.CLASS,events:{click:function(a,b){b.preventDefault();d.trigger("system-content-metadata.open-restrictions-dialog")}},attached:m,detached:n})})()});require("confluence/module-exporter").safeRequire("confluence-page-banner/page-banner");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner-analytics.js' */
AJS.toInit(function(c){AJS.bind("breadcrumbs.expanded",function(){AJS.trigger("analyticsEvent",{name:"breadcrumbs-expanded"})});(function(){if(AJS.Confluence.Analytics&&AJS.Confluence.Analytics.setAnalyticsSource){var a=AJS.Confluence.Analytics.setAnalyticsSource,b=c("#breadcrumbs \x3e li");a(b.filter(":not(#ellipsis)").find("a"),"breadcrumbs");a(b.filter(".hidden-crumb").find("a"),"breadcrumbs-expanded");a(b.filter(":last").find("a"),"breadcrumbs-parent");var d=c("#com-atlassian-confluence").hasClass("theme-documentation")?
"breadcrumbs-homepage":"breadcrumbs-collector";a(b.filter(".first").find("a"),d)}else AJS.log("WARNING: Could not initialise analytics for the page banner: AJS.Confluence.Analytics.setAnalyticsSource is not defined.")})()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources', location = '/js/confluence-feature-discovery-plugin.js' */
(function(n){function k(a){void 0===d&&(d=JSON.parse(AJS.Meta.get("discovered-plugin-features")||"{}"));return a?d[a]||[]:d}function l(a,g){a=k(a);for(var f=0,e=a.length;f<e;f++)if(a[f]===g)return!0;return!1}Confluence.FeatureDiscovery={};var d,m=!1,p=WRM.data.claim("com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode");Confluence.FeatureDiscovery.forPlugin=function(a,g){function f(b){b=parseInt(e.getItem(b),10);return isNaN(b)?
0:b}var e=Confluence.storageManager("feature-discovery."+a);g=g||3;return{addDiscoveryView:function(b){var a=f(b)+1;e.setItem(b,a)},shouldShow:function(b,c){if(c=!0===c&&p){a:{c="com.atlassian.webdriver.discovery\x3d"+a+":"+b;for(var e=document.cookie.split(";"),d=0;d<e.length;d++){for(var h=e[d];" "===h.charAt(0);)h=h.substring(1);if(-1!==h.indexOf(c)){c=!0;break a}}c=!1}c=!c}return c||m||l(a,b)?!1:f(b)>=g?(this.markDiscovered(b),!1):m=!0},markDiscovered:function(b,c){l(a,b)||AJS.safeAjax({url:AJS.contextPath()+
"/rest/feature-discovery/1.0/discovered/"+a+"/"+b,type:"POST",data:{},success:function(){k(a).unshift(b);e.removeItem(b);AJS.trigger("feature-discovered",{pluginKey:a,featureKey:b});c&&n.isFunction(c)&&c()}})},listDiscovered:function(){return k(a).slice(0)}}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:status-lozenge-onboarding', location = 'js/status-lozenge-onboarding.js' */
define("confluence-page-banner/status-lozenge-onboarding",["ajs","jquery","confluence/templates","confluence/legacy"],function(d,a,e,b){d.toInit(function(){if(!b.FeatureDiscovery||!b.FeatureDiscovery.forPlugin||0===a("#draft-status-lozenge").length||0>document.referrer.indexOf("resumedraft.action")&&0>document.referrer.indexOf("editpage.action")?0:b.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-page-banner").shouldShow("recently-work-on-contributor-lozenge")){var c=a(e.PageBanner.draftStatusDiscovery({elementId:"dope-draft-discovery",
linkToMyWork:d.contextPath()+"/#recently-worked"}));a("#draft-status-lozenge").attr("aria-controls","dope-draft-discovery");a("body").append(c);c.find(".aui-button").click(function(){c.removeAttr("open");b.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-page-banner").markDiscovered("recently-work-on-contributor-lozenge")})}})});require("confluence/module-exporter").safeRequire("confluence-page-banner/status-lozenge-onboarding");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:view-comment', location = '/includes/js/comments.js' */
define("confluence/comments",["ajs","jquery","confluence/storage-manager","confluence/message-controller"],function(d,a,g,c){function f(b){confirm("Are you sure you want to delete the comment?")&&a.ajax({type:"DELETE",url:d.contextPath()+"/rest/api/content/"+b,contentType:"application/json",dataType:"json"}).done(function(){var a=document.location.search;-1===a.indexOf("showComments")?(a+=-1!==a.indexOf("?")?"&showComments=true":"?showComments=true",document.location.search=a):document.location.reload()}).fail(function(a){c.showError(c.parseError(a),
c.Location.FLAG)})}return{binder:{bindRemoveConfirmation:function(b){a("#comment-"+b+" .comment-action-remove a").click(function(a){a.preventDefault();f(b);return!1})}},initialiser:function(){var b=g("confluence","comments");if(a("#comments-section").length){a("#comments-section").find(".comment:odd").addClass("odd");a(".comment-action-remove a").click(function(){var b=a(this).attr("id").replace(/remove-comment-/g,"");f(b);return!1});var c=a("#addcomment.comment-text"),e=a("#comments-text-editor").find("textarea");
e.focus(function(){c.addClass("active")}).blur(function(){a.trim(e.val()).length||c.removeClass("active")}).bind("reset.default-text",function(){c.removeClass("active")});a("form[name='textcommentform']").submit(function(){var b=e.val();return!a.trim(b)?(alert("Comment text is empty. Cannot create empty comments."),!1):!0});a("#add-comment-rte").click(function(){e.hasClass("placeholded")||b.setItem("text-comment",a.trim(e.val()))});a("#addcomment #rte").length&&d.bind("init.rte",function(a,d){var c=b.getItem("text-comment");
c&&(d.editor.setContent(c),b.setItem("text-comment",""))})}}}});require("confluence/module-exporter").safeRequire("confluence/comments",function(d){require("confluence/legacy").Comments=d.binder;require("ajs").toInit(d.initialiser)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:browser', location = '/includes/js/api/browser.js' */
define("confluence/api/browser",[],function(){return function(a){function c(){return-1!==a.indexOf("Firefox/")}function b(){return-1!==a.indexOf("Edge/")}function d(){return-1!==a.indexOf("MSIE")||-1!==a.indexOf("Trident/")||b()}function e(){return-1!==a.indexOf("Chrome/")}function f(){return-1!==a.indexOf("Safari/")&&-1===a.indexOf("Chrome/")}function g(){return-1!==a.indexOf("PhantomJS")}return{isFirefox:c,notFirefox:function(){return!c()},isMSEdge:b,notMSEdge:function(){return!b()},isIE:d,notIE:function(){return!d()},
isChrome:e,notChrome:function(){return!e()},isSafari:f,notSafari:function(){return!f()},isPhantom:g,notPhantom:function(){return!g()},version:function(){if(d()){var b=a.match(/MSIE\s([\d.]+)/)||a.match(/rv:([\d.]+)/)||a.match(/Edge\/([\d.]+)/);return parseInt(b[1])}if(e())return parseInt(a.match(/Chrome\/([\d.]+)/)[1]);if(f())return parseInt(a.match(/Version\/([\d.]+)/)[1]);if(c())return parseInt(a.match(/Firefox\/([\d.]+)/)[1])},friendlyName:function(){if(b())return"MSEdge";if(d())return"IE";if(e())return"Chrome";
if(f())return"Safari";if(c())return"Firefox"}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-message', location = 'editor/page-editor-message.js' */
define("confluence-editor/editor/page-editor-message",["jquery","ajs","aui/flag","document","underscore"],function(f,i,g,h,d){var b=Object.create(null),e=Object.create(null);h.addEventListener("aui-flag-close",function(a){a&&a.target&&(b=d.filter(Object.keys(b),function(c){return!f(a.target).find("span").hasClass(c)}))});return{handleMessage:function(a,c,d){b[a]||(e[a]?delete e[a]:c&&(b[a]=g({title:c.title?c.title:"",type:c.type,close:c.close?c.close:"manual",persistent:!1,body:"<span class='"+a+
"'>"+c.message+"</span>"}),d&&d()))},closeMessages:function(a){d.each(a,function(a){b[a]&&(b[a].close(),delete b[a])})},isDisplayed:function(a){return a in b},displayedErrors:function(){return Object.keys(b)},suppressMessage:function(a){e[a]={}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-message', location = '/includes/js/page-message.js' */
define("confluence/page-message","ajs jquery confluence/meta window confluence/api/browser confluence-editor/editor/page-editor-message".split(" "),function(a,h,d,f,i,j){var e={},g=new i(f.navigator.userAgent);e._getQueryString=function(){return f.location.search};e.displayPageMessage=function(){var c=e._getQueryString(),b=d.get("editing-user");if(c.indexOf("editingLocked")!==-1&&b)a.MessageHandler.flag({type:"info",title:"Unable to edit",body:a.format("Collaborative editing is offline right now, and {0} is editing this page. Try again in a few minutes.",
a.escapeHtml(b)),close:"manual"});else if(c.indexOf("editingFailed")!==-1)a.MessageHandler.flag({type:"info",title:"Unable to edit",body:"Editing is unavailable right now. Try again in a few minutes.",close:"manual"});else if(c.indexOf("userLimitReached")!==-1){j.handleMessage("collab.edit.user.limit.reached",{type:"warning",title:"You can\u0027t edit this page right now",message:"\u003cp\u003eThis page is so popular, you\u0027ve reached the maximum number of simultaneous editors.\u003c/p\u003e\u003cp\u003eTry again when it\u0027s not so busy.\u003c/p\u003e",close:"manual"});a.Confluence.Analytics.publish("collab.edit.user.limit.reached",
{browserName:g.friendlyName(),browserVersion:g.version(),pageId:d.get("page-id"),editMode:"slow",numEditors:d.get("max-number-editors")})}else if(c.indexOf("spaceEditingRestriction")!==-1){b=d.get("space-key");c=d.get("content-type")==="blogpost"?"You can\u0027t edit blog posts in this space":"You can\u0027t edit pages in this space";b=d.get("context-path")+"/spaces/viewspacesummary.action?key="+encodeURIComponent(b);b=d.get("content-type")==="blogpost"?a.format("Ask a {0}space admin{1}, or the person who invited you, to give you \u0027\u0027add blog\u0027\u0027 permission in this space.",
'<a href="'+b+'">',"</a>"):a.format("Ask a {0}space admin{1}, or the person who invited you, to give you \u0027\u0027add page\u0027\u0027 permission in this space.",'<a href="'+b+'">',"</a>");c=a.MessageHandler.flag({type:"info",title:c,body:b,close:"manual"});h(c).addClass("spaceEditingRestriction")}};return e});require("confluence/module-exporter").safeRequire("confluence/page-message",function(a){require("ajs").toInit(a.displayPageMessage)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:legacy-scroll-to-hash-anchors', location = '/includes/js/legacy-scroll-to-hash-anchors.js' */
define("confluence/legacy-scroll-to-hash-anchors",["window","confluence/api/logger"],function(b,f){function g(){e=!0}function h(){var a,c;if(!(e||0<b.pageYOffset))for(c=b.location.hash;c;){var d=c;a=d.indexOf("-");d=d.indexOf("#");a=0>a?d:0>d?a:Math.min(d,a);if(0>a)break;c=c.substring(0,a).concat(c.substring(a+1));if(a=b.document.getElementById(c)){f.log("Legacy anchor found. Scrolling the page to ",a);b.location.hash="#"+c;break}}}var e=!1;return{bindToWindowEvents:function(){b.addEventListener("load",
h,{passive:!0});b.addEventListener("scroll",g,{passive:!0})}}});require("confluence/module-exporter").safeRequire("confluence/legacy-scroll-to-hash-anchors",function(b){b.bindToWindowEvents()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.4331a05956', location = 'aui.chunk.a9b3995682bf54306b81--9aa2ba6fc8bc84c1d826.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.4331a05956"],{LTUc:function(n,i,u){"use strict";u.d(i,"a",(function(){return t}));const t="-input"}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.splitchunk.489a76bc13', location = 'aui.chunk.083959fd7a03142c1502--2ac6ab029634ebc75540.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.splitchunk.489a76bc13"],{Jqxc:function(t,e,i){"use strict";var s=i("QFBp"),r=i("qT0E"),u=i.n(r),a=i("KloK"),h=u.a.Collection.extend({initialize:function(t,e){e||(e={}),e.matcher&&(this.matcher=e.matcher),e.model&&(this.model=e.model),this._idAttribute=(new this.model).idAttribute,this._maxResults=e.maxResults||5,this._queryData=e.queryData||{},this._queryParamKey=e.queryParamKey||"q",this._queryEndpoint=e.queryEndpoint||"",this.value=null,this.queryCache={},this.activeQueryCount=0,Object(s.bindAll)(this,"query","respond")},url:function(){return this._queryEndpoint},query:function(t){var e,i;this.value=t,i=this.getFilteredResults(t),this.respond(t,i),t&&this._queryEndpoint&&!this.hasQueryCache(t)&&this.shouldGetMoreResults(i)&&(e=this.fetch(t),this.activeQueryCount++,this.trigger("activity",{activity:!0}),e.always((()=>{this.activeQueryCount--,this.trigger("activity",{activity:!!this.activeQueryCount})})),e.done(((e,i,s)=>{this.addQueryCache(t,e,s)})),e.done((()=>{t=this.value,i=this.getFilteredResults(t),this.respond(t,i)})))},getQueryData:function(t){var e=Object(s.isFunction)(this._queryData)?this._queryData(t):this._queryData,i=Object(s.extend)({},e);return i[this._queryParamKey]=t,i},fetch:function(t){var e={add:!0,update:!0,remove:!1,data:this.getQueryData(t)};return u.a.Collection.prototype.fetch.call(this,e)},respond:function(t,e){return this.trigger("respond",{query:t,results:e}),e},matcher:function(t,e){},getFilteredResults:function(t){var e=[];return t?(e=this.filter((function(e){return!!this.matcher(e,t)}),this),this._maxResults&&(e=Object(s.first)(e,this._maxResults)),e):e},addQueryCache:function(t,e,i){var r=this.queryCache,u=this.parse(e,i);r[t]=Object(s.pluck)(u,this._idAttribute)},hasQueryCache:function(t){return this.queryCache.hasOwnProperty(t)},findQueryCache:function(t){return this.queryCache[t]},shouldGetMoreResults:function(t){return t.length<this._maxResults},setMaxResults:function(t){this._maxResults=t,this.value&&this.respond(this.value,this.getFilteredResults(this.value))}});Object(a.a)("ProgressiveDataSet",h),e.a=h}}]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.form.single-select', location = 'aui.chunk.bfd8e79a5b12f44bbb1d--2aac0a75f724b135acd5.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.form.single-select"],{lotK:function(e,t,i){"use strict";i.r(t),i.d(t,"SelectEl",(function(){return B}));i("6fSn");var n=i("+x/D"),u=(i("aGv7"),i("HH5i")),s=(i("oSOL"),i("4dFR")),a=i("l3AF"),o=Object(s.a)("aui-option",{created:function(e){Object.defineProperty(e,"value",{get:function(){return e.getAttribute("value")||Object(a.a)(this.textContent)},set:function(t){e.setAttribute("value",t)}})},prototype:{serialize:function(){var e={};return this.hasAttribute("img-src")&&(e["img-src"]=encodeURI(this.getAttribute("img-src"))),e.value=this.value,e.label=Object(a.a)(this.textContent),e}}}),c=i("TmQU"),l=i("P3rJ"),r=i("KloK"),d=i("+ay7"),h=i("Jqxc"),g=i("TK3y"),p=i("qT0E"),f=i.n(p).a.Model.extend({idAttribute:"label",getLabel:function(){return this.get("label")||this.get("value")}});function b(){this._suggestions=[],this._activeIndex=-1}b.prototype={onChange:function(){},onHighlightChange:function(){},get:function(e){return this._suggestions[e]},set:function(e){var t=this._suggestions;return this._suggestions=e||[],this.onChange(t),this},getNumberOfResults:function(){return this._suggestions.length},setHighlighted:function(e){if(e)for(var t=0;t<this._suggestions.length;t++)this._suggestions[t].id===e.id&&this.highlight(t);return this},highlight:function(e){return this._activeIndex=e,this.onHighlightChange(),this},highlightPrevious:function(){var e=this._activeIndex,t=0===e?e:e-1;return this.highlight(t),this},highlightNext:function(){var e=this._activeIndex,t=e===this._suggestions.length-1?e:e+1;return this.highlight(t),this},highlighted:function(){return this.get(this._activeIndex)},highlightedIndex:function(){return this._activeIndex}};var v=b,_=i("vbuG"),m=i("jEnx");function y(e,t){return e+"-"+t}function k(e,t){this.el=e,this.anchor=t}function w(e){Object(n.a)(e).find(".aui-select-active").removeClass("aui-select-active")}k.prototype={render:function(e,t,i){this.currListId=i;var n="";if(e.length){var s=t;e.forEach((function(e){var t=e.getLabel(),a=e.get("img-src"),o=a?'<img src="'.concat(encodeURI(a),'"/>'):"",c=e.get("new-value")?" (<em>".concat(u.a.getText("aui.select.new.value"),"</em>)"):"";n+='<li role="option" class="aui-select-suggestion" id="'.concat(y(i,s),'">').concat(o).concat(t).concat(c,"</li>"),s++})),t?this.el.querySelector("ul").innerHTML+=n:this.el.querySelector("ul").innerHTML=n}else t||(this.el.querySelector("ul").innerHTML='<li role="option" class="aui-select-no-suggestions">'.concat(u.a.getText("aui.select.no.suggestions"),"</li>"));return this},setActive:function(e){w(this.el),Object(n.a)(this.el).find("#"+y(this.currListId,e)).addClass("aui-select-active")},getActive:function(){return this.el.querySelector(".aui-select-active")},show:function(){var e;e=this,Object(n.a)(e.el).css("min-width",Object(n.a)(e.anchor).outerWidth()),Object(m.b)(this.el).show(),function(e){e.anchor&&!e._auiAlignment&&(e._auiAlignment=new _.a(e.el,e.anchor,{flipContainer:"scrollParent",positionFixed:!0,preventOverflow:!1,flip:!1})),e._auiAlignment&&(e._auiAlignment.enable(),e._auiAlignment.scheduleUpdate())}(this)},hide:function(){var e;w(this.el),Object(m.b)(this.el).hide(),(e=this)._auiAlignment&&e._auiAlignment.disable()},destroy:function(){var e;this.hide(),(e=this)._auiAlignment&&(e._auiAlignment.destroy(),delete e._auiAlignment),delete this.currListId},isVisible:function(){return Object(n.a)(this.el).is(":visible")}};var O=k,A=i("gjsO"),x=i.n(A)()('\n    <input type="text" class="text" autocomplete="off" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-expanded="false">\n    <select></select>\n    <datalist>\n        <content select="aui-option"></content>\n    </datalist>\n    <button class="aui-button" role="button" tabindex="-1" type="button"></button>\n    <div class="aui-popover" role="listbox" data-aui-alignment="bottom left" hidden>\n        <ul class="aui-optionlist" role="presentation"></ul>\n    </div>\n    <div class="aui-select-status assistive" aria-live="polite" role="status"></div>\n'),j=i("OEua"),S=i("LTUc"),C=i("I7um");function M(e){e._select.selectedIndex=-1,function(e){e._input.removeAttribute("style"),Object(n.a)(e._input).removeClass("aui-select-has-inline-image")}(e)}function q(e){return e._suggestionModel.getNumberOfResults()}function I(e,t){return 0===e.get("label").toLowerCase().indexOf(t.toLowerCase())}function E(e){e._suggestionsView.hide(),e._input.setAttribute("aria-expanded","false")}function V(e){var t=q(e)?0:-1;e._suggestionModel.highlight(t),E(e)}function D(e,t,i){e._autoHighlight=t,void 0===i&&(i=e._input.value),e._progressiveDataSet.query(i)}function T(e){var t=e._suggestionModel.highlighted()&&e._suggestionModel.highlighted().get("img-src");t&&function(e,t){Object(n.a)(e._input).addClass("aui-select-has-inline-image"),e._input.setAttribute("style","background-image: url("+encodeURI(t)+")")}(e,t)}function L(e,t){if(t){var i,n=document.createElement("option"),u=e._select,s=t.get("value")||t.get("label"),a=(i=t.getLabel(),(new DOMParser).parseFromString(i,"text/html").documentElement.textContent);n.setAttribute("selected",""),n.setAttribute("value",s),n.textContent=a,e._input.value=a,u.innerHTML="",u.options.add(n),u.dispatchEvent(new l.a("change",{bubbles:!0}))}}function H(e){L(e,e._suggestionModel.highlighted()),T(e),V(e)}function P(e){return new f(e.serialize())}function R(e){for(var t=[],i=0;i<e._datalist.children.length;i++){var n=e._datalist.children[i];t.push(P(n))}return t}function N(e){var t=e._dropdown.querySelector(".aui-select-active");return t&&t.id}function U(e,t){return n.a.map(t,(function(e){return e.id})).indexOf(e)}function K(e){e._progressiveDataSet=new h.a(R(e),{model:f,matcher:I,queryEndpoint:e._queryEndpoint,maxResults:20}),e._isSync=!e._queryEndpoint,e._progressiveDataSet.on("activity",(function(){e._progressiveDataSet.activeQueryCount&&!e._isSync?(!function(e){e._button.isBusy()||(e._button.busy(),e._input.setAttribute("aria-busy","true"),e._dropdown.setAttribute("aria-busy","true"))}(e),Object(g.a)(e).set("should-flag-new-suggestions",!1)):(!function(e){e._button.idle(),e._input.setAttribute("aria-busy","false"),e._dropdown.setAttribute("aria-busy","false")}(e),Object(g.a)(e).set("should-flag-new-suggestions",!0))})),e._progressiveDataSet.on("respond",(function(t){if(t.query&&!e._input.value)return;if(Object(g.a)(e).get("should-cancel-response"))return void(e._progressiveDataSet.activeQueryCount||Object(g.a)(e).set("should-cancel-response",!1));t.query||(t.results=R(e));var i=-1!==U(e._input.value,t.results),n=!e._input.value;if(!e.hasAttribute("can-create-values")||i||n||t.results.push(function(e){var t=new o;t.setAttribute("value",e._input.value);var i=P(t);return i.set("new-value",!0),i}(e)),!Object(g.a)(e).get("should-include-selected")){var s=U(e.value,t.results);s>=0&&t.results.splice(s,1)}const a=function(e,t){const i=e._suggestionModel.getNumberOfResults();return e._suggestionModel.set(),e._suggestionModel.set(t.results),i!==e._suggestionModel.getNumberOfResults()}(e,t),c=e._suggestionModel.highlighted()||t.results[0];e._autoHighlight&&(e._suggestionModel.setHighlighted(c),setTimeout((function(){e._input.setAttribute("aria-activedescendant",N(e))}),50)),e._input.setAttribute("aria-expanded","true"),!e._isSync&&a&&e._suggestionsView.getActive()&&Object(g.a)(e).get("should-flag-new-suggestions")&&(e.querySelector(".aui-select-status").innerHTML=u.a.getText("aui.select.new.suggestions")),e._suggestionsView.show()}))}function W(e){var t=e.value?"":e._input.value,i=""===e._input.value;Object(g.a)(e).set("should-include-selected",i),D(e,!0,t)}function F(e){(function(e){return e._progressiveDataSet.activeQueryCount>0})(e)&&Object(g.a)(e).set("should-cancel-response",!0)}function J(e){if(e._select.selectedIndex>=0)return e._select.options[e._select.selectedIndex].textContent}function Q(e){F(e),function(e){var t=!e.hasAttribute("no-empty-values"),i=!e._input.value,n=e._input.value!==J(e);if(i||n)if(t)M(e);else{var u=J(e);void 0===u?M(e):e._input.value=u}}(e),function(e){e._suggestionModel.highlight(-1)}(e),E(e)}const z=Object(s.a)("aui-select",{template:x,created:function(e){e._listId=Object(j.a)(),e._input=e.querySelector("input"),e._select=e.querySelector("select"),e._dropdown=e.querySelector(".aui-popover"),e._datalist=e.querySelector("datalist"),e._button=e.querySelector("button"),e._suggestionsView=new O(e._dropdown,e._input),e._suggestionModel=new v,e._suggestionModel.onChange=function(t){var i=[];e._suggestionModel._suggestions.forEach((function(e){t.some((function(t){return e.id===t.id}))||i.push(e)})),e._suggestionsView.render(i,t.length,e._listId)},e._suggestionModel.onHighlightChange=function(){var t=e._suggestionModel.highlightedIndex();e._suggestionsView.setActive(t),e._input.setAttribute("aria-activedescendant",N(e))}},attached:function(e){s.a.init(e),K(e),function(e){e._dropdown.id=e._listId,e.querySelector("button").setAttribute("aria-controls",e._listId)}(e),e._input.setAttribute("aria-controls",e._listId),e.setAttribute("tabindex","-1"),function(e){Object(n.a)(e._dropdown).on("mouseover","li",(function(t){q(e)&&e._suggestionModel.highlight(Object(n.a)(t.target).index())}))}(e),function(e){let t=!1;Object(n.a)(document).on("aui-close-layers-on-outer-click.single-select",(e=>{t&&(e.preventDefault(),t=!1)})),Object(n.a)(e._dropdown).on("mousedown","li",(function(i){if(!q(e))return!1;e._suggestionModel.highlight(Object(n.a)(i.target).index()),H(e),e._suggestionsView.hide(),Object(n.a)(e).closest(".aui-layer").length>0&&(t=!0),e._input.removeAttribute("aria-activedescendant")}))}(e),function(e){var t=e._datalist.querySelector("aui-option[selected]");t&&L(e,P(t))}(e),V(e),T(e)},detached:function(e){Object(n.a)(document).off("aui-close-layers-on-outer-click"),Object(C.a)(e).then((()=>{E(e),e._suggestionsView.destroy()}))},attributes:{id(e,t){e.id&&(e.querySelector("input").id=t.newValue+S.a)},name(e,t){e.querySelector("select").setAttribute("name",t.newValue)},placeholder(e,t){e.querySelector("input").setAttribute("placeholder",t.newValue)},src(e,t){e._queryEndpoint=t.newValue}},events:{"blur input":function(e){Q(e)},"mousedown button":function(e){document.activeElement!==e._input||e._dropdown.hasAttribute("hidden")||Object(g.a)(e).set("prevent-open-on-button-click",!0)},"click input":function(e){W(e)},"click button":function(e){var t=Object(g.a)(e);t.get("prevent-open-on-button-click")?t.set("prevent-open-on-button-click",!1):(Object(g.a)(e).set("button-clicked-prevent-dropdown-hide",!0),e.focus())},input:function(e){e._input.value?(Object(g.a)(e).set("should-include-selected",!0),D(e,!0)):Object(g.a)(e).get("button-clicked-prevent-dropdown-hide")?Object(g.a)(e).set("button-clicked-prevent-dropdown-hide",!1):E(e)},"keydown input":function(e,t){var i=e._input.value,n=!1;if(t.keyCode===d.a.ESCAPE)return F(e),void E(e);e._suggestionsView.isVisible()&&q(e)?t.keyCode===d.a.ENTER?(F(e),H(e),t.preventDefault()):t.keyCode===d.a.TAB?(!function(e){e._suggestionsView.isVisible()&&H(e)}(e),n=!0):t.keyCode===d.a.UP?(e._suggestionModel.highlightPrevious(),t.preventDefault()):t.keyCode===d.a.DOWN&&(e._suggestionModel.highlightNext(),t.preventDefault()):t.keyCode!==d.a.UP&&t.keyCode!==d.a.DOWN||(W(e),t.preventDefault()),n=n||t.defaultPrevented,setTimeout((function(){e._input.value===i||n||e.dispatchEvent(new l.a("input",{bubbles:!0}))}),0)}},prototype:{get value(){var e=this._select.options[this._select.selectedIndex];return e?e.value:""},set value(e){if(""===e)(n=this)._input.value="",n._select.innerHTML="";else if(e){var t=this._progressiveDataSet,i=t.findWhere({value:e})||t.findWhere({label:e});!i&&this.hasAttribute("can-create-values")&&(i=new f({value:e,label:e})),L(this,i)}var n;return this},get displayValue(){return this._input.value},blur:function(){return this._input.blur(),Q(this),this},focus:function(){return this._input.focus(),W(this),this}}});Object(c.a)("aui/select",z),Object(r.a)("select",z);var B=z}},[["lotK","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.vendors--95c789edf5","aui.splitchunk.vendors--9c48cc20a9","aui.splitchunk.vendors--084821f40b","aui.splitchunk.vendors--d2297af84a","aui.splitchunk.vendors--20e849aab3","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.dd803a46b4","aui.splitchunk.994e478d48","aui.splitchunk.d7c46c2734","aui.splitchunk.e54c7c7304","aui.splitchunk.fb15cffa72","aui.splitchunk.56dfb54d0c","aui.splitchunk.f1e06f97a4","aui.splitchunk.479fe6ee76","aui.splitchunk.f673ef53ac","aui.splitchunk.8659b532c1","aui.splitchunk.9c48cc20a9","aui.splitchunk.908fe798b4","aui.splitchunk.5f851f97df","aui.splitchunk.462ee5f9ef","aui.splitchunk.d0110a864f","aui.splitchunk.afa5039e04","aui.splitchunk.bff3715233","aui.splitchunk.26116b3cbd","aui.splitchunk.c750721820","aui.splitchunk.6d6f245ed3","aui.splitchunk.ed86a19e01","aui.splitchunk.50dca3e042","aui.splitchunk.084821f40b","aui.splitchunk.2e16019fb9","aui.splitchunk.baa83dbaf9","aui.splitchunk.f154095da3","aui.splitchunk.20e849aab3","aui.splitchunk.86ad04cc86","aui.splitchunk.4331a05956","aui.splitchunk.489a76bc13","aui.splitchunk.af1935061c"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = 'assets/core/js/playsql-common.js' */
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function(search, startingAt){
      return this.substr(startingAt || 0, search.length) === search;
  };
}

if (!String.prototype.endsWith) {
    String.prototype.endsWith = function (search, startingAt) {
        if (!(startingAt < this.length))
            startingAt = this.length;
        else
            startingAt |= 0; // round position
        return this.substr(startingAt - search.length, search.length) === search;
    };
}

(function($){
    PlaySQL = window.PlaySQL = window.PlaySQL || {};

    window.PlaySQL.Helpers = window.PlaySQL.Helpers || {};
    window.PlaySQL.Helpers.generateKey = function (name, defaultCase) {
        var diacritics = {
            "A": /[\300-\306]/g,
            "a": /[\340-\346]/g,
            "E": /[\310-\313]/g,
            "e": /[\350-\353]/g,
            "I": /[\314-\317]/g,
            "i": /[\354-\357]/g,
            "O": /[\322-\330]/g,
            "o": /[\362-\370]/g,
            "U": /[\331-\334]/g,
            "u": /[\371-\374]/g,
            "N": /[\321]/g,
            "n": /[\361]/g,
            "C": /[\307]/g,
            "c": /[\347]/g
        };
        var result = name;
        for (var d in diacritics) {
            if (!diacritics.hasOwnProperty(d)) continue;
            result = result.replace(diacritics[d], d);
        }
        if (defaultCase == "UPPER") {
            result = result.toUpperCase();
        } else if (defaultCase == "LOWER") {
            result = result.toLowerCase();
        } else {
            throw "Unknown case: " + defaultCase;
        }
        result = result
            .replace(/[- =+\/\\]/g, '')
            .replace(/[^a-zA-Z0-9_]/g, '')
            .replace(/^[_0-9]+|_$/g, '');

        return result;
    };

    window.PlaySQL.Helpers.toUpperCase = function toUpperCase(string) {
        return ("" + string).toUpperCase();
    }

    AJS.$(function(){
        AJS.$(".playsql-query-placeholder table[data-query-editor-url] thead tr.playsql-col-headers th a").first().each(function(){
            var $this = $(this),
                href = $this.closest("table").attr("data-query-editor-url");
            if (href) $this.attr("href", href);
        });
    });

    window.PlaySQL.Helpers.parseOrderByClause = function(clause) {
        var parsed = [],
            lengthParsed = 0,
            part, oPart;
        while (part = getNextExpression(clause.substr(lengthParsed), ',')) {
            lengthParsed += part.length;
            if (part.length == 0) break;
            oPart = {
                expression: part
            };
            chop(oPart, ',');
            chop(oPart, 'FIRST');
            chop(oPart, 'LAST');
            chop(oPart, 'NULLS');
            chop(oPart, 'ASC');
            chop(oPart, 'DESC');
            parsed.push({
                field: $.trim(oPart.expression),
                way: oPart.ASC ? "ASC" : oPart.DESC ? "DESC" : undefined,
                nulls: oPart.FIRST ? "FIRST" : oPart.LAST ? "LAST" : undefined
            });
        }
        return parsed;
    }

    window.PlaySQL.Helpers.parseSelectClause = function(clause) {
        var result = ["SELECT"],
            expression,
            eaten = "SELECT".length;
        while ((expression = getNextExpression(clause.substr(eaten+1), ",")).length > 0) {
            eaten += expression.length;
            result.push({
                def: chop($.trim(expression), ",")
            });
        }
        return result;
    }

    var FROM_OPERATORS = ["LEFT JOIN", "RIGHT JOIN", "FULL JOIN",
        "LEFT OUTER JOIN", "RIGHT OUTER JOIN", "FULL OUTER JOIN",
        "INNER JOIN", "JOIN", "CROSS JOIN"];
    function getOperator(text) {
        for (var i = 0; i < FROM_OPERATORS.length; i++)
            if (text.indexOf(FROM_OPERATORS[i]) == 0)
                return FROM_OPERATORS[i];
        return undefined;
    }

    window.PlaySQL.Helpers.parseFromClause = function(clause) {
        var parts = splitKeywords.apply(this, [clause.substr("FROM".length)].concat(FROM_OPERATORS)),
            expression;
        // Split FROM clauses when there are commas
        for (var i = 0; i < parts.length; i++) {
            var fromPart = parts[i],
                eaten = 0,
                result = [];
            if (fromPart.indexOf(",") != -1) {
                while ((expression = getNextExpression(fromPart.substr(eaten), ",")).length > 0) {
                    eaten += expression.length;
                    result.push($.trim(expression));
                }
                if (result.length > 1) {
                    parts.splice(i, 1);
                    for (var k = result.length - 1; k >= 0; k--) {
                        parts.splice(i, 0, result[k]);
                    }
                }
            }
        }
        for (var i = 0; i < parts.length; i++) {
            var part = $.trim(parts[i]),
                operator = getOperator(part),
                afterOperator = $.trim(part.substr(operator == undefined ? 0 : operator.length)),
                tableDef = getNextExpression(afterOperator, " "),
                aliasAndCriteria = tableDef.length < afterOperator.length ? $.trim(afterOperator.substr(tableDef.length)) : undefined,
                criteria = aliasAndCriteria != undefined ? splitKeywords(aliasAndCriteria, "ON") : undefined;
            parts[i] = {
                operator : operator,
                def: $.trim(tableDef),
                alias: criteria && $.trim(criteria[0]),
                criteria: criteria && criteria.length > 1 ? criteria.slice(1).join(" ") : undefined
            };
        }
        parts.unshift("FROM");
        return parts;
    }

    window.PlaySQL.Helpers.buildOrderByClause = function(parsed) {
        var elements = parsed.map(function(p){
            var expression = p.field;
            if (p.way) expression+= ' ' + p.way;
            if (p.nulls) expression+= ' NULLS ' + p.nulls;
            return expression;
        });
        return elements.join(", ");
    }

    function chop(oPart, lastWord) {
        if (typeof oPart != "object") {
            oPart = {expression: oPart};
        }

        var trimmed = $.trim(oPart.expression);
        if (trimmed.substr(trimmed.length - lastWord.length).toLowerCase() == lastWord.toLowerCase()) {
            oPart.expression = $.trim(trimmed.substr(0, trimmed.length - lastWord.length));
            oPart[lastWord] = true;
        } else {
            oPart[lastWord] = false;
        }
        return oPart.expression;
    }

    /** Gets the next full expression, without entering into parenthesis or quotes */
    function getNextExpression(clause, delimiter) {
        var expression = '',
            next,
            delimiterNN = delimiter != null ? delimiter.charAt(0) : undefined;
        for (var i = 0 ; i < clause.length ; i++) {
            expression += clause.charAt(i);
            next = clause.charAt(i);
            switch (next) {
                // HERE we should check for comments "--.*\n"
                case "(":
                    expression += getNextExpression(clause.substr(i+1), ')');
                    i = expression.length - 1;
                    break;
                case "'":
                    expression += getString(clause.substr(i+1), "'");
                    i = expression.length - 1;
                    break;
                case "\"":
                    expression += getString(clause.substr(i+1), "\"");
                    i = expression.length - 1;
                    break;
                case delimiterNN:
                    if (clause.substr(i, delimiter.length) == delimiter) {
                        return expression;
                    }
                    break;
            }
        }
        return expression;
    }

    function getString(clause, end) {
        var escaped = false,
            expression = '',
            next;
        for (var i = 0; i < clause.length; i++) {
            next = clause.charAt(i);
            if (escaped) {
                escaped = false;
            } else if (clause.substr(i, end.length) == end) {
                expression += end;
                return expression;
            } else if (next == '\\') {
                escaped = true;
            }
            expression += next;
        }
        return expression;
    }

    function splitKeywords(text, keyword1, keywordn) {
        var keywords = Array.prototype.slice.call(arguments, 1),
            NON_ALPHANUM = /[^a-zA-Z0-9_]/;
        for (var i=0 ; i < keywords.length ; i++) {
            var keyword = keywords[i];
            // Find all keywords in the string. If any is valid, split the work in 2.
            var position = 0;
            while ((position = text.toLowerCase().indexOf(keyword.toLowerCase(), position+1)) > 0) {
                // If we're matching the first letters of the text, we might be matching a keyword that's already complete
                var isSubKeyword = false;
                for (var j = 0; j < i; j++) {
                    var positionOfSubKeyword = keywords[j].indexOf(keyword);
                    if (positionOfSubKeyword == position) {
                        // Bingo, our keyword is part of keyword j, and keyword j starts at the beginning of text
                        isSubKeyword = true;
                        break;
                    }
                }
                if (isSubKeyword) continue;

                // If it's a full word
                if (NON_ALPHANUM.test(text.charAt(position-1))
                    && (text.length <= (position + keyword.length)
                    || NON_ALPHANUM.test(text.charAt(position + keyword.length)))) {
                    var firstHalf = text.substr(0, position),
                        secondHalf = text.substr(position),
                        firstChops = splitKeywords.apply(this, [firstHalf].concat(keywords)),
                        secondChops = splitKeywords.apply(this, [secondHalf].concat(keywords));
                    // We've split the array recursively. Just return.
                    return firstChops.concat(secondChops);
                }
            }
        }
        // Keywords not found
        return [text];
    }

    function isBalanced(expression) {
        var test = expression + "))";
        return getNextExpression(test, ")").length != test.length;
    }

    function mergeIncompleteExpressions(parts) {
        var result = [];
        for (var i = 0 ; i < parts.length ; i++) {
            var expression = parts[i];
            while (!isBalanced(expression)) {
                // Merge one more element
                i++;
                if (i >= parts.length) {
                    break;
                }
                expression += parts[i];
            }
            result.push(expression);
        }
        return result;
    }

    window.PlaySQL.Helpers.rebuildSQL = function(parsedSQL) {
        var result = "";
        for (var i = 0 ; i < parsedSQL.length ; i++) {
            var part = parsedSQL[i];
            if (part == undefined || part.length == 0) continue;
            if (part[0] == "SELECT") {
                result += "\n" + part[0];
                for (var j = 1; j < part.length; j++) {
                    var field = part[j];
                    if (j>1) result += ", ";
                    if (field.def != undefined) result += " " + field.def;
                    if (field.alias != undefined) result += " " + field.alias;
                }
            } else if (part[0] == "FROM") {
                result += "\n" + part[0];
                for (var j = 1; j < part.length; j++) {
                    var field = part[j];
                    if (j>1) result += "\n    ";
                    if (field.operator != undefined) result += " " + field.operator;
                    if (field.def != undefined) result += " " + field.def;
                    if (field.alias != undefined) result += " " + field.alias;
                    if (field.criteria != undefined) result += " " + field.criteria;
                }
            } else if (part.length > 1 && part[0] == "--" && part[1] == "Bilinear:") {
                // Do not insert that
            } else {
                result += "\n" + part[0];
                if (part.length > 0) {
                    result += " " + part.slice(1).join(" ");
                }
            }
        }
        return $.trim(result);
    }

    window.PlaySQL.Helpers.isSQLEqual = function(sql1, sql2) {
        if (typeof sql1 == "object") {
            sql1 = window.PlaySQL.Helpers.rebuildSQL(sql1);
        }
        if (typeof sql2 == "object") {
            sql2 = window.PlaySQL.Helpers.rebuildSQL(sql2);
        }
        sql1 = $.trim(sql1.replace(/\s+/g, ' '));
        sql2 = $.trim(sql2.replace(/\s+/g, ' '));
        return sql1 == sql2;
    }

    var SQL_ROOT_KEYWORDS = ["SELECT", "FROM", "WHERE", "ORDER BY", "GROUP BY", "HAVING", "LIMIT", "OFFSET", "--"];
    var SQL_ROOT_KEYWORDS_AND_ROWSTARTERS = SQL_ROOT_KEYWORDS.concat(["--"]);

    window.PlaySQL.Helpers.parseSQL = function(sql) {
        var parts = splitKeywords.apply(this, [sql].concat(SQL_ROOT_KEYWORDS_AND_ROWSTARTERS)),
            result = [];
        parts = mergeIncompleteExpressions(parts);
        for (var i=0 ; i < parts.length ; i++) {
            var part = parts[i],
                partUpper = part.toUpperCase();
            if (partUpper.indexOf("SELECT") == 0) {
                result.push(window.PlaySQL.Helpers.parseSelectClause(part));
            } else if (partUpper.indexOf("FROM") == 0) {
                result.push(window.PlaySQL.Helpers.parseFromClause(part));
            } else if (partUpper.indexOf("WHERE") == 0) {
                result.push([part.substr(0, "WHERE".length), part.substr("WHERE".length)]);
            } else if (partUpper.indexOf("ORDER BY") == 0) {
                result.push([part.substr(0, "ORDER BY".length), part.substr("ORDER BY".length)]);
            } else if (partUpper.indexOf("GROUP BY") == 0) {
                result.push([part.substr(0, "GROUP BY".length), part.substr("GROUP BY".length)]);
            } else {
                result.push([part]);
            }
        }

        try {
            var isBilinear = window.PlaySQL.Helpers.isSQLEqual(sql, result) ? "true" : "false";
            isBilinear = isBilinear
            && result.length > 1
            && result[0][0] == "SELECT"
            && result[1][0] == "FROM";
            result.push(["--", "Bilinear:", isBilinear]);
            result.bilinear = isBilinear;
        } catch (err) {
            // Do nothing
        }

        /** Get or set the clause */
        result.clause = function(clauseName, value) {
            for (var i = 0; i < this.length; i++) {
                if (this[i].length > 1 && this[i][0] == clauseName) {
                    // If the value is set... and if it's not already the value.
                    if (value != undefined && value !== this[i]) {
                        this[i].splice(0, this[i].length, value);
                    }
                    return this[i];
                }
            }
            if (value != undefined) {
                // Find a spot for it
                var keywordId = SQL_ROOT_KEYWORDS.indexOf(clauseName);
                if (keywordId == -1) {
                    this.push(value);
                    return this[this.length-1];
                } else {
                    // Try putting it before any next keyword
                    while (++keywordId < SQL_ROOT_KEYWORDS.length) {
                        for (var i = 0; i < this.length; i++) {
                            if (this[i].length > 1 && this[i][0] == clauseName) {
                                this.splice(i, 0, value);
                                return this[i];
                            }
                        }
                    }
                    // Not found. Append at the end.
                    this.push(value);
                    return this[this.length-1];
                }
            }
            return undefined;
        }

        return result;
    }

    window.PlaySQL.base64_decode = function (data) {
        // http://kevin.vanzonneveld.net
        // +   original by: Tyler Akins (http://rumkin.com)
        // +   improved by: Thunder.m
        // +      input by: Aman Gupta
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +   bugfixed by: Onno Marsman
        // +   bugfixed by: Pellentesque Malesuada
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +      input by: Brett Zamir (http://brett-zamir.me)
        // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // *     example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==');
        // *     returns 1: 'Kevin van Zonneveld'
        // mozilla has this native
        // - but breaks in 2.0.0.12!
        //if (typeof this.window['atob'] === 'function') {
        //    return atob(data);
        //}
        var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
        var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,
            ac = 0,
            dec = "",
            tmp_arr = [];

        if (!data) {
            return data;
        }

        data += '';

        do { // unpack four hexets into three octets using index points in b64
            h1 = b64.indexOf(data.charAt(i++));
            h2 = b64.indexOf(data.charAt(i++));
            h3 = b64.indexOf(data.charAt(i++));
            h4 = b64.indexOf(data.charAt(i++));

            bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;

            o1 = bits >> 16 & 0xff;
            o2 = bits >> 8 & 0xff;
            o3 = bits & 0xff;

            if (h3 == 64) {
                tmp_arr[ac++] = String.fromCharCode(o1);
            } else if (h4 == 64) {
                tmp_arr[ac++] = String.fromCharCode(o1, o2);
            } else {
                tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
            }
        } while (i < data.length);

        dec = tmp_arr.join('');

        return dec;
    };


    /*
     Copyright Vassilis Petroulias [DRDigit]

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
     */
    var B64 = {
        alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',
        lookup: null,
        ie: /MSIE /.test(navigator.userAgent),
        ieo: /MSIE [67]/.test(navigator.userAgent),
        decode: function (s) {
            var buffer = B64.fromUtf8(s),
                position = 0,
                len = buffer.length;
            if (B64.ieo) {
                result = [];
                while (position < len) {
                    if (buffer[position] < 128) result.push(String.fromCharCode(buffer[position++]));
                    else if (buffer[position] > 191 && buffer[position] < 224) result.push(String.fromCharCode(((buffer[position++] & 31) << 6) | (buffer[position++] & 63)));
                    else result.push(String.fromCharCode(((buffer[position++] & 15) << 12) | ((buffer[position++] & 63) << 6) | (buffer[position++] & 63)));
                }
                return result.join('').replace(/\0/g,"");
            } else {
                result = '';
                while (position < len) {
                    if (buffer[position] < 128) result += String.fromCharCode(buffer[position++]);
                    else if (buffer[position] > 191 && buffer[position] < 224) result += String.fromCharCode(((buffer[position++] & 31) << 6) | (buffer[position++] & 63));
                    else result += String.fromCharCode(((buffer[position++] & 15) << 12) | ((buffer[position++] & 63) << 6) | (buffer[position++] & 63));
                }
                return result.replace(/\0/g,"");
            }
        },
        fromUtf8: function (s) {
            var position = -1,
                len, buffer = [],
                enc = [undefined, undefined, undefined, undefined];
            if (!B64.lookup) {
                len = B64.alphabet.length;
                B64.lookup = {};
                while (++position < len)
                    B64.lookup[B64.alphabet[position]] = position;
                position = -1;
            }
            len = s.length;
            while (position < len) {
                enc[0] = B64.lookup[s.charAt(++position)];
                enc[1] = B64.lookup[s.charAt(++position)];
                buffer.push((enc[0] << 2) | (enc[1] >> 4));
                enc[2] = B64.lookup[s.charAt(++position)];
                if (enc[2] == 64) break;
                buffer.push(((enc[1] & 15) << 4) | (enc[2] >> 2));
                enc[3] = B64.lookup[s.charAt(++position)];
                if (enc[3] == 64) break;
                buffer.push(((enc[2] & 3) << 6) | enc[3]);
            }
            return buffer;
        }
    };
    window.PlaySQL.B64 = B64;

    window.PlaySQL.Totals = window.PlaySQL.Totals || {};

    window.PlaySQL.Totals.getTotal = function getTotal(totalsData, index, value) {
        if (typeof index == "object") {
            value = index;
            index = undefined;
        }
        if (value != undefined) {
            if (index == undefined) {
                totalsData = value;
            } else {
                while (totalsData.length < index) {
                    totalsData.push({});
                }
                if (totalsData.length == index) {
                    totalsData.push(value);
                } else {
                    totalsData[index] = value;
                }
            }
        }
        if (index == undefined) {
            return totalsData;
        } else {
            return totalsData.length > index ? totalsData[index] : undefined;
        }
    }

    window.PlaySQL.Totals.editTotal = function (totalsData, $cell) {
        $cell.attr('data-rendered', $cell.html());
        var index = $cell.index() - 1,
            value = PlaySQL.Totals.getTotal(totalsData, index),
            label = value && value.label || "",
            calculation = value && value.calculation || "";
        $cell.addClass("editing selected focused")
            .html(Confluence.Templates.PlaySQL.editTotalsCell({
                label: label,
                calculation: calculation}));
        $cell.find("input:first").focus();
        return false;
    };
    window.PlaySQL.Totals.addTotal = function(totals, $cell, position) {
        if (totals == undefined || totals.length == 0) return;
        var index = $cell.index() - 1,
            colspan = parseInt($cell.attr('colspan')),
            thisTotal = totals[index];
        if (colspan == undefined || colspan > 1) {
            if (colspan == undefined ) colspan = 2;
            colspan--;
            $cell.attr('colspan', colspan)
                .removeClass("selected focused");
            thisTotal.colspan = colspan;
            // This is inserting a copy of the total
            totals.splice(position < 0 ? index : index + 1, 0, thisTotal);
            // Insert cell on the side
            var $newCell = $("<td></td>");
            if (position < 0) $newCell.insertBefore($cell);
            else $newCell.insertAfter($cell);
            // Edit the cell
            window.PlaySQL.Totals.editTotal(totals, $newCell);
        } else {
            // How come the menu was proposed for a non-spanned cell?
        }
    };
    window.PlaySQL.Totals.removeTotal = function(totals, $cell, callbackSaveTotals) {
        var index = $cell.index() - 1,
            colspan = parseInt($cell.attr('colspan')),
            adjacentIndex = index > 0 ? index-1 : totals.length > 1 ? 1 : undefined,
            adjacentTotal = adjacentIndex != undefined ? totals[adjacentIndex] : undefined,
            $adjacentCell = adjacentIndex == undefined ? undefined : adjacentIndex > index ? $cell.next() : $cell.prev();
        if (adjacentIndex != undefined) {
            adjacentTotal.colspan = (parseInt($adjacentCell.attr('colspan')) || 1) + colspan;
            $adjacentCell.attr('colspan', adjacentTotal.colspan);
            $cell.remove();
        } else {
            // Just blank it out
            $cell.empty();
        }
        totals.splice(index, 1);
        if (callbackSaveTotals) callbackSaveTotals();
    };
    window.PlaySQL.Totals.saveTotal = function(totals, $cell) {
        window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
        var index = $cell.index() - 1,
            value = {
                label : $cell.find("input.totals-label").val(),
                calculation : $cell.find("input.totals-calculation").val(),
                colspan : $cell.attr('colspan'),
                name : "totals_" + index
            };
        $cell.empty().attr("data-label", value.label)
            .attr("data-calculation", value.calculation)
            .attr("colspan", value.colspan)
            .attr("data-name", value.name)
            .text(value.label)
            .removeClass("editing")
            .append($("<em></em>").text(" =" + value.calculation));
        totals[index] = value;
    };
    /** Update the span records of the totals and pagination */
    window.PlaySQL.Totals.updateColspans = function(totals, $placeholder) {
        if (totals == null) return;
        // 1. The Totals
        var $cells = $placeholder.find("tfoot .totals-row td:not(.right-padding)");
        if (totals.length == 0) return;
        if (totals.length < $cells.length) {
            throw "Totals: A model is missing... $1 models and $2 cells."
                .replace("$1", totals.length)
                .replace("$2", $cells.length);
        } else if (totals.length > $cells.length) {
            totals.splice(0, totals.length - $cells.length);
        }
        var totalSpan = 0,
            totalHeaderSpan = $placeholder.find("thead tr.playsql-col-headers th:not(:first-child):not(.add-column)").size(),
            span;
        for (var i = 0 ; i < totals.length ; i++) {
            span = parseInt($cells.eq(i).attr("colspan")) || 1;
            totals[i].colspan = span;
            totalSpan += span;
        }
        var diff = totalSpan - totalHeaderSpan;
        if (totals.length > 0 && diff < 0) {
            totals[0].colspan += Math.abs(diff);
        } else if (diff > 0) {
            $cells.each(function(i) {
                var $cell = $(this),
                    span = parseInt($cell.attr("colspan")) || 1,
                    exchange;
                if (span >= 1 + diff) {
                    exchange = span - Math.max(1, span - diff);
                    span = span - exchange;
                    diff = diff - exchange;
                    // Update the real life
                    $cell.attr("colspan", span);
                    totals[i].colspan = span;
                }
            });
        }
        // 2. The pagination
        // Beware, there are two pagination rows
        var $paginations = $placeholder.find(".pagination-row td:not(.right-padding)");
        $paginations.attr("colspan", totalHeaderSpan);
    };

    var replaceBuiltInVariablesCache = undefined;
    window.PlaySQL.Helpers.replaceBuiltInVariables = function(value) {
        if (value == null || value.indexOf("$") == -1) return value;
        if (!replaceBuiltInVariablesCache) {
            replaceBuiltInVariablesCache = {
                "$pageId": AJS.Meta.get("page-id"),
                "$spaceKey": AJS.Meta.get("space-key"),
                "$pageTitle": AJS.Meta.get("page-title"),
                "$userFullName": AJS.Meta.get("user-display-name"),
                "$user": AJS.Meta.get("remote-user")
            };
        }
        for (var key in replaceBuiltInVariablesCache) {
            if (!replaceBuiltInVariablesCache.hasOwnProperty(key)) continue;
            value = value.replace(key, replaceBuiltInVariablesCache[key]);
        }
        return value;
    };

    window.PlaySQL.Helpers.hasMinVersion = function(minVersion) {
        var version = AJS.Meta.get("version-number"),
            verT = version.split(/\./),
            minT = minVersion.split(/\./);

        if (verT.length < 3) return true;
        if (minT.length != 3) throw "Can't recognize version number: " + minVersion;

        for (var i = 0 ; i < 3 ; i++) {
            if (parseInt(verT[i]) < parseInt(minT[i])) return false;
            if (parseInt(verT[i]) > parseInt(minT[i])) return true;
        }
        return true;
    }

    window.PlaySQL.Helpers.parsePerms = function(perms) {
        var result = [];
        if (!perms) return result;
        if (typeof perms === "string") {
            perms = perms.split(/[ ,]+/);
        }
        for (var i = 0 ; i < perms.length ; i++) {
            switch (perms[i]) {
                case 'JT_EDIT':         perms.push('Q_VIEW_EDIT', 'EDIT_COLS_FE'); break;
                case 'Q_SAVE':          perms.push('Q_EDIT'); break;
                case 'Q_EDIT':          perms.push('Q_VIEW_EDIT', 'EDIT_TOTALS', 'EDIT_COLS_FE'); break;
                case 'CONTEXT_ADMIN':   perms.push('ADMIN_COLS', 'REMOVE_TABLE'); break;
                case 'ADMIN_COLS':      perms.push('EDIT', 'EDIT_TOTALS', 'ADD_COLS', 'EDIT_COLS_FE', 'EDIT_COLS_BE', 'REMOVE_COLS'); break;
                case 'EDIT':            perms.push('VIEW', 'ADD_ROWS', 'EDIT_CELLS', 'REMOVE_ROWS', 'EDIT_ROWS_METADATA', 'Q_VIEW_EDIT'); break;
                case 'Q_VIEW_EDIT':     perms.push('Q_VIEW'); break;
                case 'Q_VIEW':          perms.push('VIEW'); break;
            }
        }

        for (var i = 0 ; i < perms.length ; i++)
            if (result.indexOf(perms[i]) == -1)
                result.push(perms[i]);
        /**
         * Tells whether the user has a permission.
         * @param perm
         * @param column the column. Optional. Only provide the column if the permission is Q_VIEW_EDIT.
         * @returns {boolean}
         */
        result.hasPerm = function(perm, column) {
            var result = this.indexOf(perm) != -1;
            if (result && column
                && !column.formats["joint-id"]
                && !column.formats["joint-table"]) {
                // result = true, but this is not an editable column.
                return false;
            }
            return result;
        }
        return result;
    }

    window.PlaySQL.Helpers.intersect = function(perms1, perms2) {
        if(!perms2)
            return perms1;
        var result = [];
        for (var i=0 ; i < perms1.length ; i++) {
            if (perms2.indexOf(perms1[i]) != -1) {
                result.push(perms1[i]);
            }
        }
        if (!perms1.hasPerm) throw "window.PlaySQL.Helpers.intersect() requires authentic permissions as a first arg";
        result.hasPerm = perms1.hasPerm;
        return result;
    }
    window.PlaySQL.Helpers.parsePermsFromMacro = function(permLevel) {
        /** Returns the TablePerm corresponding to the user's setting in the macro (which is made of human-readable
         * values like Admin instead of ADMIN, etc.
         * @see TablePerm#translateFromMacro() for details */
        permLevel = PlaySQL.Helpers.toUpperCase(permLevel);
        switch (permLevel) {
            case "VIEW": return "VIEW";
            case "EDIT": return "EDIT";
            case "ADMIN":
            default:
                return "ADMIN_COLS";
        }
    }

    window.PlaySQL.Helpers.parsePagination = function(pagination) {
        var offset = pagination && pagination.offset || 0,
            limit = pagination && pagination.limit || 20, // Can't be zero, so can't div/0
            count = pagination && pagination.count || 0,
            pageEnd = Math.min(offset + limit - 1, count - 1),
            lastPage = Math.floor((count - 1) / limit) * limit;
        // If it fits in 1 page, or if the user clicked "see all" (in which case limit = 1,000,000)
        if (count < limit && offset == 0 && limit < 100000) return null;
        // Everything is 0-based in this object, but please make it 1-based for text you display
        return {
            offset: offset,
            limit: limit,
            count: count, // 1-based.
            pageEnd: pageEnd, // 1-based
            firstPage: offset == 0 ? undefined : 0,
            previousPage: offset == 0 ? undefined : Math.max(0, (Math.floor(offset/limit)-1) * limit),
            nextPage: offset >= lastPage ? undefined : Math.min(lastPage, (Math.floor(offset/limit)+1) * limit),
            lastPage: offset >= lastPage ? undefined : lastPage
        };
    }

    window.PlaySQL.Helpers.escapeSqlString = function(string, dialect) {
        string = string.replace(/[\0\n\r\b\t\\'"\x1a]/g, function (s) {
            switch (s) {
                case "\0":
                    return "\\0";
                case "\n":
                    return "\\n";
                case "\r":
                    return "\\r";
                case "\b":
                    return "\\b";
                case "\t":
                    return "\\t";
                case "\x1a":
                    return "\\Z";
                case "'":
                    return "''";
                case '"':
                    return '""';
                default:
                    return "\\" + s;
            }
        });
        return string;
    }



    window.PlaySQL.Helpers.checkNotNull = function(value, message) {
        if (value == undefined) {
            throw "Unexpectedly undefined value: " + value + "(" + message + ")";
        }
        if (value instanceof $) {
            if (value.size() == 0)
                throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
        }
        return value;
    }

    /** Returns an explanation about the selection in the inputBox.
     * @param inputBox the box, not jquery
     * @param range the range. Optional. Default is window.getSelection().getRangeAt(0).
     * */
    window.PlaySQL.Helpers.caretSelection = function (inputBox, range) {
        // Here's why we check ![type="date"]: If it's an actual date field, we can't get the cursor's position.
        // However: If it's a date field and the AUI datePicker kicked in, it transformed the type to [text] and
        // we can get the position.
        if ($(inputBox).attr("type") == "date") {
            return {};
        }
        if (inputBox.nodeName == 'INPUT' || inputBox.nodeName == 'TEXTAREA') {
            if ('selectionStart' in inputBox) {
                // Standard-compliant browsers
                return {
                    position: inputBox.selectionStart,
                    length: inputBox.selectionEnd - inputBox.selectionStart
                }
            } else if (document.selection) {
                // IE
                var sel = document.selection.createRange();
                var selLen = document.selection.createRange().text.length;
                sel.moveStart('character', -inputBox.value.length);
                return {
                    position: sel.text.length - selLen,
                    length: selLength,
                    el: inputBox
                }
            }
        } else if (inputBox.contentEditable == "true" && window.getSelection) {
            if (!range) {
                range = window.getSelection && (window.getSelection().rangeCount > 0) && window.getSelection().getRangeAt(0);
            }
            if (!range) return {};
            var preSelectionRange = range.cloneRange();
            // Modify this copy of a range so we can count the number of selected characters and deduce the start position
            preSelectionRange.selectNodeContents(inputBox);
            preSelectionRange.setEnd(range.startContainer, range.startOffset);
            return {
                position: preSelectionRange.toString().length,
                length: range.toString().length,
                range: range,
                el: range.startContainer
            };
        }
    }

    /**
     * Sets the beginning or end of the range to the desired position,
     * even if the node is comprised of child nodes.
     *
     * It is generally used for a window.getSelection(), but strictly speaking only
     * ranges are involved here.
     *
     * @param methodName the method to set the range. Default is 'setEnd'.
     **/
    window.PlaySQL.Helpers.setSelection = function (range, node, index, methodName) {
        methodName = methodName || 'setEnd';
        if (node.nodeType == node.TEXT_NODE) {
            if (index >= 0) {
                range[methodName](node, index);
                return true;
            } else {
                range[methodName](node, 0);
                return false;
            }
        } else {
            var childNodes = node.childNodes;
            for (var i = 0 ; i < childNodes.length ; i++) {
                if (index == 0) {
                    range[methodName](childNodes[i], 0);
                    return true;
                } else if (childNodes[i].textContent.length > index) {
                    return window.PlaySQL.Helpers.setSelection(range, childNodes[i], index, methodName);
                } else {
                    index -= childNodes[i].textContent.length;
                }
            }
            // We didn't find the element. Selecting the max.
            var lastChild = childNodes[childNodes.length - 1];
            while (lastChild.childNodes.length > 0)
                lastChild = lastChild.childNodes[lastChild.childNodes.length - 1];
            range[methodName](lastChild, lastChild.textContent.length);
            return false;
        }
    }

    window.PlaySQL.Helpers.isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;

    /** Analyzes an event and returns a canonical human-understandable key */
    window.PlaySQL.Helpers.getKeyCombinationDetail = function(e) {
        var code = e.keyCode,
            key = String.fromCharCode(code).toLowerCase(),
            onKeyDown = true;
        switch (code) {
            case 8: key = "backspace"; break;
            case 9: key = "tab"; break;
            case 13: key = "enter"; /*onKeyDown = false;*/ break;
            case 27: key = "esc"; break;
            case 37: key = "left"; break;
            case 38: key = "up"; break;
            case 39: key = "right"; break;
            case 40: key = "down"; break;
            case 46: key = "delete"; break;
            case 112: key = "f1"; break;
            case 113: key = "f2"; break;
        }
        var modifiers = [];
        if (e.altKey) modifiers.push("alt");
        if (e.shiftKey) modifiers.push("shift");
        if (window.PlaySQL.Helpers.isMac) {
            if (e.metaKey) modifiers.push("control");
        } else {
            if (e.ctrlKey) modifiers.push("control");
        }

        return {
            code: code,
            key: key,
            modifiers: modifiers,
            onKeyDown: onKeyDown,
            canonical: (modifiers.length ? modifiers.join("+") + "+" : "") + key
        };
    }

    function strip(text, opening, closing, escape) {
        for (var i = 0 ; i < text.length ; i++) {
            if (text.charAt(i) == opening) {
                var j = i + 1;
                while (j < text.length) {
                    if (text.charAt(j) == closing) {
                        break;
                    } else if (closing != undefined && text.charAt(j) == escape && text.charAt(j+1) == closing) {
                        j += 2;
                    } else {
                        j++;
                    }
                }
                text = text.substr(0, i + 1) + text.substr(j);
                i++;
            }
        }
        return text;
    }
    /** Parse a formula and hopes to return the text being entered at the current
     * position, and the enclosing formula
     */
    window.PlaySQL.Helpers.parseFunctionAtCaret = function(text) {
        text = strip(text, "'", "'", "\\");
        var currentExpression = text.match(/[a-zA-Z][\.a-zA-Z0-9]*$/),
            parentFunctions = text.match(/[a-zA-Z][a-zA-Z0-9]*\(/g),
            parentFunction, argList, argCount, currentTable;
        if (parentFunctions) {
            parentFunction = parentFunctions[parentFunctions.length-1];
            argList = text.substr(text.lastIndexOf(parentFunction));
            argCount = (argList + ",").match(/,/g).length - 1;
        }
        currentExpression = currentExpression && currentExpression[0];
        currentTable = currentExpression && currentExpression.indexOf(".") != -1 && currentExpression.substr(0, currentExpression.indexOf("."));
        parentFunction = parentFunction && parentFunction.substr(0, parentFunction.length - 1);
        return {
            currentTable:currentTable,
            current:currentExpression,
            parentFn:parentFunction,
            argCount:argCount
        };
    }

    var functionList = {};
    window.PlaySQL.Helpers.getFunctionList = function(context, spreadsheetId, callback) {
        if (functionList[spreadsheetId]) return callback(functionList[spreadsheetId]);
        var url = PlaySQL.SPI.baseUrl0("autocomplete", context, spreadsheetId, "functionList");
        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            data.constants = [
                { name: "TRUE", type: "Constant" },
                { name: "FALSE", type: "Constant" }
            ];
            functionList[spreadsheetId] = data;
            callback(data);
        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get autocomplete for function names");
        });
    }
    window.PlaySQL.Helpers.getAutocomplete = function(context, callback) {
        var url = PlaySQL.SPI.baseUrl0("autocomplete/" + context);
        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            callback(data);
        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get autocomplete for function names");
        });
    };
    window.PlaySQL.Helpers.extractMessageFromJqXHR = function(jqXHR, maxLength) {
        var message = undefined;
        var errorBase = Math.round(jqXHR.status/100) * 100;

        try {
            // If the BAD_REQUEST is specifically formatted by Play SQL
            var data = $.parseJSON(jqXHR.responseText);
            message = data.message || data.errorDescription;
            if (!message && data["stack-trace"]) {
                message = data["stack-trace"].replace(/([^\s<>]{20,100})[\s\S]*/m, "$1").substr(0, 200).trim();
            }
        } catch (err) {
            // Cut "<xml...><message>The message</message>"
            var messagePosition = jqXHR.responseText ? jqXHR.responseText.indexOf("<message>") : -1;
            if (messagePosition != -1) {
                message = jqXHR.responseText.substr(messagePosition + "<message>".length);
                messagePosition = message.indexOf("</message>");
                if (messagePosition != -1) {
                    message = message.substr(0, messagePosition);
                }
            }

            // Swallow and proceed to the next section
            AJS.log(err);
        }
        if (!message) {
            message = jqXHR.status + " " + jqXHR.statusText + " - " + jqXHR.responseText;
        }
        if (message && typeof maxLength != "undefined" && message.length > maxLength) {
            message = message.substr(0, maxLength - 3) + "…";
        }

        return message;
    };

    // Fetch the source, for the default case-sensibility of the dialect
    window.PlaySQL.fetchContextProperties = function(fetchTableList, context, callback) {
        context = context || PlaySQL.SPI.contextForPage;
        if (!context) return;
        var url = PlaySQL.SPI.baseUrl(context);
        $.ajax({
            url: url,
            type: fetchTableList ? 'GET' : 'HEAD',
            contentType: "application/json; charset=utf-8"
        }).done(function (data, status, jqXHR) {
            var defaultCase = jqXHR.getResponseHeader("X-DIALECT_DEFAULT_CASE"),
                mode = jqXHR.getResponseHeader("X-MODE");
            callback && callback(jqXHR, defaultCase, mode);
        });
    }

    window.PlaySQL.createSpreadsheet = function(context, spreadsheet, copyId, defaultCase, successCallback, failureCallback) {
        if (!spreadsheet) throw "Spreadsheet expected";
        if (!spreadsheet.name) throw "Spreadsheet key expected";
        if (!spreadsheet.label) throw "Spreadsheet label expected";
        if (!spreadsheet.columns) {
            spreadsheet.columns = [{
                    name: (defaultCase == "UPPER" ? "FIRSTCOLUMN" : "firstcolumn"),
                    label: "First column",
                    type: "TEXT"
                }, {
                    name: (defaultCase == "UPPER" ? "SECONDCOLUMN" : "secondcolumn"),
                    label: "Second column",
                    type: "TEXT"
                }];
        }
        context = context || PlaySQL.SPI.contextForPage;
        if (context == undefined) {
            alert("The space where the spreadsheet must be created wasn't specified");
            return;
        }
        var url = PlaySQL.SPI.baseUrl(context, spreadsheet.name);
        if (typeof copyId != "undefined") {
            url += "?copyOf=" + copyId;
        }
        AJS.$.ajax({
            url: url,
            type: 'PUT',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(spreadsheet)
        }).done(function(data){
            var hasOpener = false;
            try {
                hasOpener = window.opener &&
                    !window.opener.closed &&
                    window.opener.AJS &&
                    window.opener.AJS.MacroBrowser &&
                    window.opener.AJS.MacroBrowser.fields &&
                    window.opener.AJS.MacroBrowser.fields.spreadsheetId &&
                    window.opener.AJS.MacroBrowser.fields.spreadsheetId.updateSpreadsheet;
            } catch (err) {
                // Surely a CORS exception with window.opener coming from localhost / baseUrl
                hasOpener = false;
            }
            if (hasOpener) {
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.loadedSpreadsheetId = "please refresh anyway";
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.setValue(spreadsheet.name);
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.updateSpreadsheet();
                // That's when people use Hsql: We shouldn't make the Macro Browser access the db at the same time as changing page...
                successCallback && window.setTimeout(function(){successCallback(data);}, 700);
            } else {
                successCallback && successCallback(data);
            }
        }).fail(failureCallback);
    }

    /** This is the 'Confluence' implementation for the baseUrl */
    if (!window.PlaySQL.SPI) {
        var spaceKey = AJS.Meta.get("space-key");
        window.PlaySQL.SPI = {
            contextPath: AJS.contextPath(),
            getMetadata: AJS.Meta.get,
            baseUrl: function(endpoint, paths, queryParams) {
                return window.PlaySQL.SPI.baseUrl0.apply(this, []
                    .concat("/spreadsheets")
                    .concat(Array.prototype.slice.call(arguments))
                );
            },
            baseUrl0: function (endpoint, paths, queryParams) {
                // If you think you could reuse baseUrlForContext, don't forget that V8 engines can't perform
                // optimizations on sliced arguments, thus requiring you to write just as much code.
                var suffix = "";
                for (var i = 0; i < arguments.length; i++) {
                    var arg = arguments[i];
                    if (i == arguments.length - 1 && (typeof arg == "object")) {
                        suffix += "?" + $.param(arg);
                    } else if (typeof arg == "undefined") {
                        throw "Undefined argument in PlaySQL.SPI.baseUrl0(" + Array.prototype.join.call(arguments, ", ") + ")";
                    } else {
                        suffix += "/" + ("" + arg).replace(/^\/|\/$/g, "");
                    }
                }
                return AJS.contextPath() + "/rest/playsql2/1.0" + suffix;
            },
            /** This returns an URL for all the 'old' resources, which aren't designed like spreadsheets */
            baseUrlOld: function (endpoint, paths, queryParams) {
                // If you think you could reuse baseUrlForContext, don't forget that V8 engines can't perform
                // optimizations on sliced arguments, thus requiring you to write just as much code.
                var suffix = "";
                for (var i = 0; i < arguments.length; i++) {
                    var arg = arguments[i];
                    if (i == arguments.length - 1 && (typeof arg == "object")) {
                        suffix += "?" + $.param(arg);
                    } else if (typeof arg == "undefined") {
                        throw "Undefined argument in PlaySQL.SPI.baseUrl0(" + Array.prototype.join.call(arguments, ", ") + ")";
                    } else {
                        suffix += "/" + ("" + arg).replace(/^\/|\/$/g, "");
                    }
                }

                return AJS.contextPath() + "/rest/playsql/1.0" + suffix;
            },
            contextForPage: spaceKey ? "space:" + spaceKey : "name:unknown",
            /**
             * Returns the URL to another part of the application
             * @param target: a constant, such as "chart", "editor", "form", "warehouse-dashboard", "img"...
             * @param context the context
             * @param spreadsheetId the id of the spreadsheet
             * @param formId the id of the form (only if target=form)
             * @param recordId the row (only if target=form)
             * @param breadcrumbs the string serialization of the breadcrumb list, in string format.
             * @returns a string representing a URL
             */
            getRoute : function (target, context, spreadsheetId, formId, recordId, breadcrumbs) {
                switch (target) {
                    case "chart":
                        if(PlaySQL.type == "cloud") {
                            return PlaySQL.SPI.baseUrl0("warehouse", context, "editors", "c", spreadsheetId);
                        } else {
                            return PlaySQL.SPI.contextPath + "/playsql-base-plugin/chart-editor.action?" + $.param({
                                    id: spreadsheetId,
                                    key: context.split(":")[1]
                            });
                        }
                    case "editor":
                        if (PlaySQL.type == "cloud") {
                            return PlaySQL.SPI.baseUrl0("warehouse", context, "editors", "ss", spreadsheetId);
                        } else {
                            return PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?" + $.param({
                                key: context.split(":")[1],
                                spreadsheetId: spreadsheetId
                            });
                        }
                    case "form":
                        if (PlaySQL.type == "cloud") {
                            return PlaySQL.SPI.baseUrl0("warehouse", context, "editors", "ss", spreadsheetId)
                                + "/form/" + formId + "/" + recordId
                                + "?breadcrumbs=" + (breadcrumbs || "");
                        } else {
                            return PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?" + $.param({
                                key: context.split(":")[1],
                                spreadsheetId: spreadsheetId,
                                formId: formId,
                                recordId: recordId,
                                tab: target,
                                breadcrumbs: breadcrumbs || ""
                            });
                        }
                    case "warehouse-dashboard":
                        if (PlaySQL.type == "cloud") {
                            return PlaySQL.SPI.baseUrl0("warehouse", context, "view");
                        } else {
                            return PlaySQL.SPI.contextPath + "/playsql-base-plugin/index.action?" + $.param({
                                key: context.split(":")[1]
                            });
                        }
                    case "img":
                        var file = context;
                        if (PlaySQL.type == "cloud") {
                            return PlaySQL.SPI.contextPath + "/assets/core/img/" + file;
                        } else {
                            return PlaySQL.SPI.contextPath + "/download/resources/com.playsql.playsql-base-plugin/img/" + file;
                        }
                    default:
                        throw "Unknown route: " + target;
                }
            }
        };
        window.PlaySQL.I18n = AJS.I18n;
    }


    window.spreadsheet = {};
    PlaySQL.Helpers.CssObject = function($placeholder) {
        function getRule(criteria) {
            // 'this' is the array
            var rule;
            for (var i in this) {
                if (!this.hasOwnProperty(i)) continue;
                rule = this[i];
                if (!rule.appliesTo) continue;
                if (criteria.column && rule.appliesTo.column == criteria.column
                || criteria.selector == rule.appliesTo.selector == criteria.selector) {
                    return rule;
                }
            }
            rule = {
                appliesTo: criteria,
                body: {}
            };
            this.push(rule);
            return rule;
        }
        return {
            $placeholder : $placeholder,
            /** A module is a set of CSS rules with a name, so we can sweep all of them and replace them */
            module : function(module) {
                if (!this[module]) {
                    this[module] = [];
                    this[module].getRule = getRule;
                }
                return this[module];
            }
        };
    }

    /** Applies the 'css' tag of the spreadsheet. The object should be in the form of PlaySQL.Helpers.CssObject:
     * spreadsheet.css = {
     *     "module": [{
     *         appliesTo: { column: "ID", selector: undefined },
     *         body: { "css-prop" : "value" }
     *     }]
     * };
     * Only one module can be rendered at once.
     */
    PlaySQL.Helpers.applyCss = function(css, module) {
        if (!css) return;
        // Concat
        var stylesheet = "/* Dynamically generated by Play SQL */";
        var uniquePlaceholderIdentifier = css.$placeholder.attr("id");
        if (uniquePlaceholderIdentifier == null) {
            uniquePlaceholderIdentifier = "pssid-" + Math.floor(Math.random() * 1000);
            css.$placeholder.attr("id", uniquePlaceholderIdentifier);
        }
        var rulePrefix = "#" + uniquePlaceholderIdentifier + " ";
        for (var ruleName in css) {
            if (ruleName != module) continue;
            for (var j in css[ruleName]) {
                var rule = css[ruleName][j];
                if (typeof rule == "function") continue;
                if (!!rule.appliesTo.column) {
                    // We need to build it from the column name
                    rule.appliesTo.selector = undefined;
                    var $th = css.$placeholder.find("thead th[data-name='" + rule.appliesTo.column + "']");
                    if ($th.size() == 1) {
                        var oneBasedIndex = $th.index() + 1;
                        rule.appliesTo.selector =
                            rulePrefix + "tbody td:nth-child(" + oneBasedIndex + "), \n" +
                            rulePrefix + "thead tr.playsql-col-headers th:nth-child(" + oneBasedIndex + ")"
                    }
                }
                if (rule.appliesTo.selector && rule.body) {
                    for (var propName in rule.body)
                        if (rule.body[propName] == null)
                            delete rule.body[propName];

                    if (Object.keys(rule.body).length > 0) {
                        stylesheet += "\n\n" + rule.appliesTo.selector + " {";
                        for (var propName in rule.body) {
                            var propValue = rule.body[propName];
                            if (!!propValue) {
                                if (!(/^[-a-zA-Z0-9 .,()\n]*$/.test(propName))) {
                                    AJS.logError("Illegal css key: " + propName);
                                } else if ((/(\/\*|;)/.test(propValue))) {
                                    AJS.logError("Illegal css value: " + propValue);
                                } else {
                                    stylesheet += "\n " + propName + ":" + propValue + ";";
                                }
                            }
                        }
                        stylesheet += "\n}";
                    }
                }
            }
        }
        // Replace the <style> tag, pay attention it's the tag of the correct spreadsheet
        var id = "style-" + uniquePlaceholderIdentifier + "-" + module;
        var styleTag = document.getElementById(id);
        if (styleTag == null) {
            styleTag = document.createElement('style');
            styleTag.type = 'text/css';
            styleTag.id = id;
            document.getElementsByTagName('head')[0].appendChild(styleTag);
        }
        if (window.PlaySQL.debug) {
            AJS.log("Generated dynamic css for " + id, stylesheet);
        }
        styleTag.innerHTML = stylesheet;
    }

    PlaySQL.Helpers.parseMacroParams = function($macroNode) {
        var parameters = $macroNode.attr("data-macro-parameters");
        if (typeof parameters != "string") return {};
        var result = {};
        parameters = parameters.split("|");
        for (var i=0 ; i < parameters.length ; i++) {
            var keyValue = parameters[i];
            var separator = keyValue.indexOf("=");
            if (separator == -1) continue;
            var key = keyValue.substr(0, separator);
            var value = keyValue.substr(separator + 1);
            result[key] = value;
        }
        return result;
    }

    PlaySQL.Helpers.htmlBuilder = function(element, attributes) {
        function parseChildren(parent, attributes) {
            if (typeof attributes == "string") {
                parent.insertAdjacentHTML("beforeend", attributes);
            } else if (attributes instanceof Element) {
                parent.appendChild(attributes);
            } else if (attributes instanceof Array) {
                // It's the children
                for (var i=0 ; i < attributes.length ; i++) {
                    parseChildren(parent, attributes[i]);
                }
            } else {
                throw "Unrecognized html element: " + JSON.stringify(attributes);
            }
        }

        var el = document.createElement(element);
        if (attributes instanceof Array) {
            parseChildren(el, attributes);
        } else if (attributes instanceof Element) {
            el.appendChild(attributes);
        } else if (typeof attributes == "string") {
            el.innerHTML = attributes;
        } else if (attributes instanceof Object) {
            for (var key in attributes) {
                if (!attributes.hasOwnProperty(key)) continue;
                if (key == "html") {
                    parseChildren(el, attributes[key]);
                } else if (key == "text") {
                    el.appendChild(document.createTextNode(attributes[key]));
                } else {
                    el.setAttribute(key, attributes[key]);
                }
            }
        }
        return el;
    };

    // Opposite of $.params({ ... })
    // If 2 parameters have the same name, the second overrides the first.
    PlaySQL.Helpers.parseUrlQueryString = function(url) {
        if (url.indexOf("?") != -1) url = url.substr(url.indexOf("?") + 1);
        var parts = url.split("&");
        // Re-join lines which were inadvertently split by mistake
        for (var i = 1 ; i < parts.length ; i++) {
            if (/^(#[0-9]+|[a-z]+);/.test(parts[i])) {
                // The '&' was just an XML escape sequence. Joint it with the previous element.
                parts[i-1] += "&" + parts[i];
                parts.splice(i, 1);
            }
        }
        var result = {};
        for (var i=0 ; i < parts.length ; i++) {
            var part = parts[i];
            var key = decodeURIComponent(part.substr(0, part.indexOf("=")));
            var value = decodeURIComponent(part.substr(part.indexOf("=") + 1));
            if (key) {
                result[key] = value;
            } else {
                result[value] = null;
            }
        }
        return result;
    }

    PlaySQL.Helpers.readSpreadsheetData = function(data, status, request, spreadsheet, $placeholder) {
        var colNames = request.getResponseHeader("X-COL-NAMES").split(","),
            tableDef = data.tableDef;
        /*colLabels = request.getResponseHeader("X-COL-LABELS").split(","),
         colRenderers = request.getResponseHeader("X-COL-RENDERERS").split(","),
         colTypes = request.getResponseHeader("X-COL-TYPES").split(","),*/
        function findCol(name) {
            for (var i=0 ; i < tableDef.columns.length ; i++)
                if (tableDef.columns[i].name == name)
                    return tableDef.columns[i];
            throw "Column not found: " + name;
        }
        var columns = colNames.map(function(name, i){
            var colDefinition = findCol(name);
            return PlaySQL.Helpers.readColumnDefinition(i, colDefinition, $placeholder);
        });
        spreadsheet.columns = columns;
        spreadsheet.totals = tableDef.totals || [];
        spreadsheet.perms = window.PlaySQL.Helpers.intersect(window.PlaySQL.Helpers.parsePerms(tableDef.perms), spreadsheet.perms);
        spreadsheet.customEmptyMessage = tableDef.customEmptyMessage;
        spreadsheet.userParameters = PlaySQL.Helpers.filterBuiltInParameters(data.userParameters || []);
        spreadsheet.useForm = data.useForm;
        spreadsheet.orderbyClause = data.orderBy || "";
        spreadsheet.canEditImage = data.canEditImage;

        spreadsheet.defaultCase = request.getResponseHeader("X-DIALECT_DEFAULT_CASE");
        spreadsheet.dialect = request.getResponseHeader("X-DIALECT");
        if (spreadsheet.defaultCase != "LOWER" && spreadsheet.defaultCase != "UPPER") {
            $("#create-query-button, #create-spreadsheet-button").hide();
            throw "Invalid default case: " + defaultCase;
        }
        spreadsheet.mode = request.getResponseHeader("X-MODE"); // READ_ONLY or READ_WRITE
        spreadsheet.systemColumnsMode = data.systemColumnsMode;
        spreadsheet.label = tableDef.label;
        spreadsheet.pagination = window.PlaySQL.Helpers.parsePagination(data.pagination);
        spreadsheet.css = new window.PlaySQL.Helpers.CssObject($placeholder);

        PlaySQL.Helpers.renderCells(columns, data.data, spreadsheet);

        return spreadsheet;
    };

    // Calls each renderer for the cells
    PlaySQL.Helpers.renderCells = function(cols, data, spreadsheet) {

        if (!data) throw "Data is " + data;
        if (!spreadsheet) throw "Spreadsheet is " + spreadsheet;
        if (!cols) throw "'Cols' are " + cols;
        for (var rowIndex = 0 ; rowIndex < data.length ; rowIndex++ ) {
            var row = data[rowIndex];
            if (!(row instanceof Array)) {
                var message = "Row[" + rowIndex + "] is not an array but a strange object: " + (typeof row) + "#" + row;
                try {
                    for (var property in row) {
                        var number = parseInt(property, 10);
                        if (isNaN(number)) {
                            message += " ." + property + ("=" + data[property]).substr(0, 4);
                        } else {
                            message += "[" + number + "]";
                        }
                    }
                    message += " \nand data is:" + (typeof data) + ("#" + data).substr(0, 10);
                    for (var property1 in data) {
                        var number1 = parseInt(property1, 10);
                        if (isNaN(number1)) {
                            message += " ." + property1 + ("=" + data[property1]).substr(0, 4);
                        } else {
                            message += "[" + number1 + "]";
                        }
                    }
                } catch (err) {
                    // Do nothing
                }
                throw message;
            }
            if (row.length < 2) throw "row.length = " + row.length + " (should be > 2): " + row;
            var rowMetadataText = (row[1] || [])[0],
                rowMetadata;
            try {
                rowMetadata = AJS.$.parseJSON(rowMetadataText);
            } catch (err) {}
            // Do not replace this 'for' with a foreach: 'row', for a customer, contains the function .containsLabel(),
            // which isn't usual but may be the consequence of another plugin's invasive javascript?
            for (var cellIndex = 0 ; cellIndex < row.length ; cellIndex++) {
                // I've met a customer bug where:
                // cellIndex = "containsLabel"
                // renderer = undefined
                // cell.push = undefined
                // So I concluded 'cell' was a function, and 'row' was an object with the function "containsLabel",
                var cell = row[cellIndex],
                    col = cols[cellIndex],
                    renderer = window.PlaySQL.Spreadsheet.renderers[col.viewRenderer || col.renderer],
                    cellMetadata = rowMetadata && rowMetadata["c_" + col.name];
                if (!cell) throw "Cell [" + rowIndex + "][" + cellIndex + "] is undefined";
                if (!renderer) {
                    var message = "In data#" + (typeof data) + "[" + rowIndex + "#" + (typeof rowIndex) + "]#" + (typeof row) + ", ";
                    message += "cell " + cellIndex + "/" + cols.length + (cols.length != row.length ? " (which is different from the row's length of " + row.length : "");
                    message += ": Renderer " + renderer + " can't be found among those: ";
                    for (var key in window.PlaySQL.Spreadsheet.renderers) {
                        message += key + " ";
                    }
                    message += ". Properties of the object: " + row;
                    for (var propertyIterator in row) {
                        message += " ." + propertyIterator;
                    }
                    $(window).trigger("error-playsql", [ new Error(message) ]);
                    continue;
                }
                // Cell already contains [FE value, BE value].
                // Let's add the rendered content
                cell.push(renderer.renderCellContentsWithFK(cell[0], spreadsheet, col, cell[1]));
                // Let's add the css classes
                cell.push(PlaySQL.Helpers.buildCssClassesForCell(cell[0], cellMetadata));
                // And the styles
                cell.push(PlaySQL.Helpers.buildCssStylesForCell(cell[0], cellMetadata));
            }
        }
    }

    PlaySQL.Helpers.filterBuiltInParameters = function(userParameters) {
        if (!userParameters) return userParameters;
        var newList = [];
        for (var i = 0 ; i < userParameters.length ; i++) {
            if (!userParameters[i].builtIn) {
                userParameters[i].cleanName = userParameters[i].name.toLowerCase().replace(/[^a-z0-9]/g, "");
                newList.push(userParameters[i]);
            }
        }
        return newList;
    }

    PlaySQL.Helpers.readColumnDefinition = function(index, colDefinition, $placeholder) {
        var mainRenderer = PlaySQL.Helpers.checkNotNull(colDefinition.renderer, colDefinition);
        if (!PlaySQL.Spreadsheet.renderers[mainRenderer]) {
            throw "The renderer " + mainRenderer + " doesn't exist";
        }
        if (colDefinition.viewRenderer && !PlaySQL.Spreadsheet.renderers[colDefinition.viewRenderer]) {
            $(window).trigger("error-playsql", new Error("The view renderer " + colDefinition.viewRenderer + " doesn't exist"));
            colDefinition.viewRenderer = undefined;
        }
        return {
            name: colDefinition.name,
            label: colDefinition.label,
            type: colDefinition.type,
            length: colDefinition.length,
            formula: colDefinition.formula,
            renderer: mainRenderer,
            viewRenderer: colDefinition.viewRenderer,
            statusPK: colDefinition.statusPK,
            statusPosition: colDefinition.statusPosition,
            formats: colDefinition.formats || {},
            width: colDefinition.width,
            fk: colDefinition.fk,
            index: index,
            $placeholder: $placeholder,
            copy : function() {
                // Copy a subset of the column for the purpose of sending it to save
                return {
                    name: this.name,
                    label: this.label,
                    type: this.type,
                    length: this.length,
                    formula: this.formula,
                    renderer: this.renderer,
                    viewRenderer: this.viewRendrer,
                    statusPK: this.statusPK,
                    statusPosition: this.statusPosition,
                    width: this.width,
                    formats: $.extend(true, {}, this.formats),
                    fk: this.fk
                }
            }
        };
    }

    PlaySQL.Helpers.buildCssClassesForCell = function(value, cellMetadata) {
        if (cellMetadata && cellMetadata.formula) {
            return "formula";
        }
        if (value != undefined && value.charAt(0) == "=") {
            return "anti-formula";
        }
        return undefined;
    }

    PlaySQL.Helpers.buildCssStylesForCell = function(value, cellMetadata) {
        if (cellMetadata && cellMetadata["background-color"]) {
            return "background-color: " + cellMetadata["background-color"] + ";";
        }
        return undefined;
    }

    // Returns a function whose calls are swallowed if they happen within 'delay' of the
    // previous call. The returned function returns true every time it executes for real.
    PlaySQL.Helpers.debounce = function(callback, delay) {
        var lastCall = undefined;
        return function () {
            var now = Date.now();
            if (lastCall && lastCall + delay > now) {
                return false;
            }
            lastCall = now;
            callback.apply(this, arguments);
            return true;
        }
    };

    PlaySQL.Helpers.colorPicker = function($placeholder, canEdit, currentColor) {
        $placeholder.attr('data-color', currentColor);
        var $dropdown = $placeholder.next();

        var onColorClicked = function(e) {
            e.preventDefault();
            var $this = $(this).is(".color-item") ? $(this) : $(this).find("span"),
                color = $this[0].style.backgroundColor;
            if (color === "transparent" || /[^0-9]0\)$/.test(color)) color = null;
            $placeholder.attr('data-color', color);
            $placeholder.find('.aui-button-split-main span').css('background-color', color || '');
            $placeholder.trigger('playsql-color-changed');
        };
        $placeholder.siblings().andSelf().on('click', '.color-item, .aui-button-split-main', onColorClicked);

        if(canEdit) {
            var newId = 'playsql-color-picker-dropdown-' + Math.floor(Math.random() * 10000); // FIXME: check that this id is not already used
            $dropdown.attr('id', newId);
            var $arrow = $('<a>', {
                'class': 'aui-button aui-button-split-more aui-dropdown2-trigger',
                'aria-haspopup': true,
                'aria-controls': newId,
                'aria-owns': newId,
                style: 'vertical-align: bottom;'
            }).text('Color Picker').insertAfter($placeholder.find('.aui-button-split-main'));
        }

        var onArrowClicked = function() {
            var $arrow = $(this);
            // Ensure it happens after the dialog was displayed
            window.setTimeout(function(){
                var $el = $(".playsql-color-picker-dropdown:visible");
                if ($el.size() == 0 || !$arrow.is(":visible")) return;
                if ($el.offset().top > $arrow.offset().top + 50) {
                    $el.css("top", $arrow.offset().top + $arrow.outerHeight() + "px");
                    $el.css("left", $arrow.offset().left + "px");
                }
            }, 0);
        };
        $placeholder.parent().on('click', '.playsql-color-picker-background .aui-button-split-more', onArrowClicked);

        return $placeholder;
    };

    PlaySQL.Editors = $.extend(PlaySQL.Editors, {
        edit: function edit($placeholder, previewCallback) {
            var id = $placeholder.attr("id");
            var editor = window.ace.edit(id);
            editor.setTheme("ace/theme/clouds");
            editor.getSession().setMode("ace/mode/sql");
            editor.setShowPrintMargin(false);
            editor.setAutoresize = function setAutoresize(value, callback) {
                /** This function automatically resizes the editor as the user types.
                 * It cannot be removed.
                 * @param callback The function to call when a resize is performed: callback(newHeight).
                 */
                if (!value) throw "Cannot remove autoresize";
                editor.getSession().on('change', function () {
                    var minHeight = $placeholder.find(".ace_scrollbar-inner").height();
                    if (minHeight && $placeholder.height() < minHeight + 10) {
                        $placeholder.height(minHeight + 20);
                        editor.resize();
                        callback && callback(minHeight + 20);
                    }
                });
            };
            previewCallback && editor.commands.addCommand({
                name: 'preview',
                bindKey: {win: 'Ctrl-Enter',  mac: 'Command-Enter'},
                exec: previewCallback,
                readOnly: true // false if this command should not apply in readOnly mode
            });
            return editor;
        },
        loopUntilTrue: function(callback) {
            function perform() {
                if (callback && callback() === false) {
                    window.setTimeout(perform, 50);
                }
            }
            perform();
        }
    });

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = 'assets/core/js/playsql-popup.js' */
// This JS must be after playsql-common.js
(function($) {
    var PlaySQL = window.PlaySQL;
    PlaySQL.Popup = PlaySQL.Popup || {};
    /**
     * Creates a popup, aligned under $el.
     *
     * API:
     * To realign, use $popup.trigger("reposition");
     * To choose which el it's aligned to, $popup.data("playsql-popup-attached-to");
     *
     * @param id an ID. If another ID exists, it will remove it.
     * @param $el the element on which the popup should be aligned
     * @param removeAllPopups Optional. True by default. Removes any popup instead of just the one with the same ID.
     * @returns $popup, the popup, which you can fill.
     */
    PlaySQL.Popup.create = function(id, $el, removeAllPopups) {
        // Remove existing div
        // Create a div
        // Append it to the page
        // Position it under $el
        if (removeAllPopups || typeof removeAllPopups == "undefined") {
            $(".playsql-popup").addClass("hidden");
        }
        $("#" + id).remove();
        var $popup = $(PlaySQL.Helpers.htmlBuilder("div", {
            id: id,
            "class": "playsql-popup hidden",
            html: "&nbsp;"
        }));
        function reposition() {
            var $el = $popup.data("playsql-popup-attached-to");
            var offset = $el.offset();
            $popup.css("top", offset.top + $el.outerHeight());
            $popup.css("left", offset.left);
            var minWidth = $el.width();
            if (minWidth > 150 && minWidth < 600) {
                $popup.css("min-width", minWidth + "px");
            } else {
                $popup.css("min-width", "");
            }
        }
        $popup.data("playsql-popup-attached-to", $el);
        $popup.on("reposition.playsql-popup", reposition);
        reposition();
        $("body").append($popup);
        return $popup;
    };

    /**
     * Creates a menu, which is a popup with a specific layout
     * @param id If another popup with this ID exists, it will be removed.
     * @param $root the root element en which to attach this popup.
     * @returns
     */
    PlaySQL.Popup.createMenu = function(id, $root, options) {
        var options = $.extend({
            onMenuOpen: undefined
        }, options);
        var $popup = PlaySQL.Popup.create(id, $root, true);
        $popup.addClass("playsql-popup-menu");
        var $ul = $("<ul>");
        $popup.html($ul);

        function findInArray(array, fn) {
            for (var i=0 ; i < array.length ; i++)
                if (fn(array[i]))
                    return array[i];
            return null;
        }

        var result = {
            $popup: $popup,
            // If $root disappears, the popup is disposed of.
            // We can't change the root.
            // $input's selector is relative to $root.
            $root: $root,
            options: options,
            // Array of
            // {input: DOMElements or String (selector),
            //  positioning: string,
            //  clickHandler: fn,
            //  type: input or click
            // }
            // If inputs becomes empty, the popup is disposed of.
            inputs: [],
            windowIntervalHandlers: [],
            /**
             * Attaches the popup to an input
             * @param $input. jQuery (for immediate binding) or selector (for async binding).
             * @param $positioning optional. DOM elt or selector string. Note: If it starts with closest(...), then
             * we'll call the jQuery function closest(...), then apply the rest of the string to the find.
             */
            attach: function(type, $inputs, positioning, clickHandler) {
                if (typeof $inputs == "string") {
                    var selector = $inputs;
                    if (!findInArray(result.inputs, function(item) {return item.input == selector;})) {
                        result.inputs.push({
                            input: selector,
                            positioning: positioning,
                            clickHandler: clickHandler,
                            type: type
                        });
                        if (type == "input") {
                            $root.on("keydown.playsql-popup", selector, result.keyDownHandler);
                        } else if (type == "clickable") {
                            $root.on("click", selector, function(){
                                result.setPosition($(this));
                                result.show();
                            });
                        }
                    }
                } else if ($inputs instanceof $) {
                    $inputs.each(function () {
                        if (!findInArray(result.inputs, function(item){return item.input == this;})) {
                            result.inputs.push({
                                input: this,
                                positioning: positioning,
                                clickHandler: clickHandler,
                                type: type
                            });
                            var $input = $(this);
                            if (type == "input") {
                                // Add handlers to $input
                                // Must be on keydown if we want to 'return false' and prevent playsql-selection.js handlers.
                                $input.on("keydown.playsql-popup", result.keyDownHandler);
                            } else if (type == "clickable") {
                                $input.on("click", function(){
                                    result.setPosition($(this));
                                    result.show();
                                });
                            }
                            result.watchForDOMDeletion(this);
                        }
                    });
                } else {
                    throw "attach() must be called with a selector or a jQuery element" + $inputs;
                }
                return this;
            },
            /** { label, id-or-click-handler, arguments-to-be-passed-to-the-click-handler }. */
            addItem: function (labelHtml, fn, args) {
                var $li = $("<li></li>").appendTo($ul);
                $li.html(labelHtml);
                $li.data("value", fn);
                $li.find("> a").click(function (e) {
                    var href = $(this).attr("href");
                    if (!href || href == "#") {
                        e.preventDefault();
                    }
                });
                $li.mousedown(function(){
                    // The mousedown on an LI is triggered before the blur on $input,
                    // so we'll take this opportunity to prevent the blur from
                    // happening when the user clicks the autocomplete.
                    var $input = result.$popup.data("playsql-popup-attached-to-input");
                    $input && $input.addClass("no-blur-while-clicking-autocomplete");
                });
                var argumentsToApply = Array.prototype.slice.call(arguments, 2);
                $li.click(function (e) {
                    result.select(this);
                    var returnValue = undefined;
                    if (typeof fn == "function") {
                        var args = Array.prototype.slice.call(argumentsToApply);
                        args.unshift($(this), e);
                        returnValue = fn.apply(this, args);
                    }
                    // This line executes the 'truggerClickHandler()' in all cases, but returns
                    // either 'undefined', 'false' or 'true'.
                    var returnValue2 = result.triggerClickHandler(undefined, e);
                    returnValue = typeof returnValue != "undefined" ? typeof returnValue2 != "undefined" ? returnValue && returnValue2 : returnValue : returnValue2;
                    $popup.addClass("hidden");
                    return returnValue;
                });
                return this;
            },
            removeAll: function(){
                $popup.find("> ul > li").remove();
            },
            select: function(el) {
                $popup.find("> ul > li").removeClass("selected");
                if (typeof el == "undefined") {
                    // That's all, we've already removed the .selected
                } else if (el instanceof $ || el instanceof Node) {
                    $(el).addClass("selected");
                } else {
                    $popup.find("> ul > li").each(function(){
                        if ($(this).data("value") == el) {
                            $(this).addClass("selected");
                            return false;
                        }
                    });
                }
            },
            triggerClickHandler: function($input, e){
                if (!$input) {
                    $input = result.$popup.data("playsql-popup-attached-to-input");
                }
                var item = findInArray(result.inputs, function(item) {return $input.is(item.input);});

                if (item) {
                    var selectedId = result.getSelectedId();
                    var handler = item.clickHandler;
                    // e being the jQuery event
                    handler && handler(selectedId, e);
                }
            },
            getSelectedId: function() {
                var $selected = $popup.find("> ul > li.selected");
                return $selected.data("value");
            }, getPositioning: function ($input) {
                var item = findInArray(result.inputs, function(item) {return $input.is(item.input);});
                if (item) {
                    var $positioning = item.positioning;
                    if (typeof $positioning == "string") {
                        var selector = $positioning;
                        if (selector.indexOf("closest(") == 0) {
                            var closest = selector.substr("closest(".length, selector.indexOf(")") - "closest(".length);
                            $positioning = $input.closest(closest);
                            selector = selector.substr(selector.indexOf(")") + 1).trim();
                            if (selector) {
                                $positioning = $positioning.find(selector);
                            }
                        } else {
                            $positioning = $root.find(selector);
                        }
                    }
                    if ($positioning instanceof $ && $positioning.size() > 0) {
                        return $positioning.first();
                    } else {
                        return $input.first();
                    }
                }
                return null;
            }, keyDownHandler: function (e) {
                if ($popup.is(":visible")) {
                    switch (e.which) {
                        case 38: // Arrow UP
                        case 40: // Arrow DOWN
                        case 13: // Enter
                        case 27: // ESC
                            var $this = $(this);
                            if (!$this.is($popup.data("playsql-popup-attached-to-input"))) {
                                var $positioning = result.getPositioning($this);
                                $popup.data("playsql-popup-attached-to", $positioning);
                                $popup.data("playsql-popup-attached-to-input", $this);
                                $popup.trigger("reposition");
                            }
                            return result.keyDownInternalHandler(e, e.which);
                    }
                }
            }, keyDownInternalHandler: function(e, which){
                var $selected = $popup.find("> ul > li.selected");
                switch (which) {
                    case 13: // ENTER
                        if ($selected.size() == 0) {
                            var $lonelyElement = $popup.find("> ul > li");
                            if ($lonelyElement.size() == 1) {
                                $selected = $lonelyElement.addClass("selected");
                            }
                        }
                        if ($selected.size() == 1) {
                            $selected.click();
                            $popup.addClass("hidden");
                            e.preventDefault();
                            // If the click() triggered the handler, then the popup doesn't exist anymore at that point
                            // (or is hidden).
                            return false;
                        }
                        // We don't preventDefault or return false when ENTER happened without selecting an element.
                        return true;
                    case 27: // ESC
                        e.preventDefault();
                        $popup.addClass("hidden");
                        break;
                    case 38: // UP
                        e.preventDefault();
                        var $el = $selected.prev(":visible");
                        // Whether the selected element has no prev/next or if it's the last
                        if ($el.size() == 0) {
                            $el = $popup.find("> ul > li").last(":visible");
                        }
                        $selected.removeClass("selected");
                        $el.addClass("selected");
                        break;
                    case 40: // DOWN
                        e.preventDefault();
                        var $el = $selected.next(":visible");
                        // Whether the selected element has no prev/next or if it's the last
                        if ($el.size() == 0) {
                            $el = $popup.find("> ul > li").first(":visible");
                        }
                        $selected.removeClass("selected");
                        $el.addClass("selected");
                        break;
                }
                return false;
            }, show: function(){
                if ($popup.hasClass("hidden")) {
                    var $attachedToInput = $popup.data("playsql-popup-attached-to-input");
                    if ($attachedToInput instanceof $) {
                        var item = findInArray(result.inputs, function(item) {return $attachedToInput.is(item.input);});
                        if (result.options.onMenuOpen) {
                            result.options.onMenuOpen($attachedToInput, item);
                        }
                        $popup.removeClass("hidden");
                        if (item.type == "clickable") {
                            $("body").off(".playsql-popup-remove-menu");
                            window.setTimeout(function(){
                                $("body").one("click.playsql-popup-remove-menu", function(e) {
                                    window.setTimeout(function() {
                                        if (result.$popup[0] && !$.contains(result.$popup[0], e.target)) {
                                            result.$popup.addClass("hidden");
                                        }
                                    }, 0);
                                });
                            }, 0);
                        }
                    }
                }
                return this;
            }, setPosition: function($input){
                var $positioning = result.getPositioning($input);
                if ($positioning && !$positioning.is($popup.data("playsql-popup-attached-to"))) {
                    $popup.data("playsql-popup-attached-to", $positioning);
                    $popup.data("playsql-popup-attached-to-input", $input);
                    $popup.trigger("reposition");
                }
            }, cleanup: function(element){
                // If the popup or the $root was removed, remove everything.
                // If only one $inputs was removed, check the list of $inputs.
                if (!element || element == $root[0] || element == $popup[0]) {
                    $root && $root.off(".playsql-popup");
                    $popup && $popup.remove();
                    for (var i=0 ; i < result.windowIntervalHandlers.length ; i++) {
                        window.clearInterval(result.windowIntervalHandlers[i]);
                    }
                } else {
                    var $element = $(element).off(".playsql-popup");
                    var item = findInArray(result.inputs, function(item) {return $element.is(item);});
                    if (item) {
                        result.inputs.splice(result.inputs.indexOf(item), 1);
                    }
                    if (result.inputs.length == 0) {
                        result.cleanup();
                    }
                }
            }, watchForDOMDeletion: function(element){
                // This is an impl that has a 1s delay. But MutationObserver couldn't observe properly.
                var id = window.setInterval(function(){
                    if (!document.body.contains(element)) {
                        window.clearInterval(id);
                        result.cleanup(element);
                    }
                }, 1000);
                result.windowIntervalHandlers.push(id);
            }, isDestroyed: function() {
                return !document.body.contains($popup[0]);
            }
        };
        $ul.on("mouseenter", "li", function(){
            result.select(this);
        });
        result.watchForDOMDeletion($popup[0]);
        result.watchForDOMDeletion($root[0]);
        $popup.data("playsql-popup-details", result);
        return result;
    };

    PlaySQL.Popup.createAutocomplete = function(id, $root, autocompletion, options){
        options = $.extend({
            style: "contains", // "contains", "starts-with", "all"
            maxCount: 10,
            emptyMessage: "(No suggestion)",
            defaultPosition: "open"
        }, options);
        var menu = PlaySQL.Popup.createMenu(id, $root);
        menu.list = []; // id, space, text, html
        menu.list.dedupe = function (extraction, sorting){
            if (!extraction) extraction = function(item) {return item.id;};
            if (!sorting) sorting = function(a, b){return a < b ? -1 : a > b ? 1 : 0;};
            for (var i = 0 ; i < this.length ; i++) {
                var element = this[i];
                // Lowercase the text fields, because they're only used for the search.
                element.searchableText = element.text && element.text.toLowerCase() || "";
                // If the element appears again later, remove it
                var value = extraction(element);
                for (var j = this.length - 1 ; j > i ; j--) {
                    if (value == extraction(this[j]))
                        this.splice(j, 1); // No problem with the loops because it in indexes above the current position
                }
            }
            this.sort(sorting);
        };
        menu.findItem = function(id) {
            for (var i=0 ; i < menu.list.length ; i++)
                if (menu.list[i].id == id)
                    return menu.list[i];
            return null;
        }
        var query;
        var cachedQueries = [];
        function suggest(hasNewResults) {
            if (hasNewResults) {
                cachedQueries.push(query);
            }
            var sublist;
            query = query.toLowerCase();
            var limit = options.maxCount;
            if (options.style == "contains") {
                sublist = menu.list.filter(function(i) {return i.searchableText.indexOf(query) != -1 && (limit-->0);});
            } else if (options.style == "starts-with") {
                sublist = menu.list.filter(function(i) {return i.searchableText.indexOf(query) == 0 && (limit-->0);});
            } else {
                sublist = menu.list;
                sublist = sublist.slice(0, options.maxCount);
            }
            var selectedId = menu.getSelectedId();
            menu.removeAll();
            if (sublist.length > 0) {
                menu.show();
                sublist.forEach(function(el) {
                    var html = el.html || PlaySQL.Helpers.htmlBuilder("a", {
                            href:"#",
                            text: el.text
                        });
                    menu.addItem(html, el.id);
                });
                menu.select(selectedId);
            } else if (options.emptyMessage) {
                menu.$popup.children("ul").append(PlaySQL.Helpers.htmlBuilder("li", {
                    "class": "empty-message",
                    text: options.emptyMessage
                }));
            }
        }
        var originalMenuAttach = menu.attach;
        menu.attach = function(type, $inputs, positioning, clickHandler) {
            var result = originalMenuAttach.apply(this, arguments);
            // Also attach a handler for autocompletion.
            function inputHandler (e) {
                if (menu.isDestroyed()) {
                    $inputs.off(".playsql-popup");
                } else {
                    var $input = $(this);
                    // This is a breach of encapsulation: data("value") is set by spreadsheet-macro-renderers-entities.js.
                    $input.attr("data-value", null);
                    query = $input.val();
                    menu.setPosition($input);
                    if (cachedQueries.indexOf(query) == -1) {
                        autocompletion(query, menu.list, suggest);
                    } else {
                        suggest(false); // Results are already in the list.
                    }
                }
            };
            if ($inputs instanceof $) {
                $inputs.on("input.playsql-popup paste.playsql-popup", inputHandler);
            } else if (typeof $inputs == "string") {
                $root.on("input.playsql-popup paste.playsql-popup", $inputs, inputHandler);
            }
            return result;
        };
        if (options.defaultPosition == "open") {
            if ($inputs instanceof $) {
                menu.setPosition($inputs.first());
            } else {
                menu.setPosition($root.find($inputs).first());
            }
            menu.show();
        }
        return menu;
    }
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = '/assets/core/blueprint/playsql-blueprint.js' */
Confluence.Blueprint.setWizard('com.playsql.playsql-base-plugin:playsql-blueprint-webitem', function(wizard) {

	var defaultCase = null,
		mode = null,
		darkFeatures = [],
		listOfSpreadsheets = null;

	function updateVisibleTypes(mode) {
		if (mode == "READ_ONLY") {
			$(".bp-types .require-read-write").addClass("disabled");
			selectType($(".bp-types .selected"));
			var $addenum = $(".dialog-wizard-page-description p.addenum");
			if ($addenum.size() == 0) {
				$("<p>", {
					text: "Some types are disabled because the datasource is read-only.",
					"class": "addenum"
				}).appendTo(".dialog-wizard-page-description");
			} else {
				$addenum.removeClass("hidden");
			}
		} else {
			$(".bp-types .require-read-write").removeClass("disabled");
			$(".dialog-wizard-page-description p.addenum").removeClass("hidden");
		}
	}

	function selectType($template) {
		// If disabled, select the next possible
		var i = 0;
		while ($template.is(".disabled")) {
			if (i++ > 4) {
				$template.parent().children().removeClass("selected");
				break;
			}
			$template = $template.next(":visible:not(.disabled)").length != 0
				? $template.next(":visible:not(.disabled)")
				: $template.parent().children(":visible:not(.disabled)").first();
		}

		// Go ahead with the selection
		$template.addClass("selected").siblings().removeClass("selected");
		if ($template.hasClass("with-next")) {
        	$('.create-dialog-create-button:visible').text("Next");
		} else {
			$('.create-dialog-create-button:visible').text("Create");
		}
	}

	wizard.on('post-render.choose', function(e, state) {
		window.PlaySQL.fetchContextProperties(false, "space:" + state.wizardData.spaceKey, function(jqXHR, defaultCase1, mode1) {
			defaultCase = defaultCase1;
			mode = mode1;
			darkFeatures = jqXHR.getResponseHeader("X-DARK-FEATURES");
			darkFeatures = darkFeatures && darkFeatures.split(",") || [];
			var $types = $(".bp-types");
			if ($types.size() > 0) {
				$types.fadeIn(200);
				$types.attr('tabindex', 0).focus();
				updateVisibleTypes(mode);
				selectType($("#bp-create-spreadsheet"));
			}
			// Also fetch the list of tables, if the user creates a query
			window.PlaySQL.Helpers.getAutocomplete("space:" + state.wizardData.spaceKey, function(data) {
				try {
					var tableDDLs = data.tables && data.tables["current schema"],
						tableNames = data.tableNames;
					if (!tableDDLs && tableNames) return;
					listOfSpreadsheets = [{
						name: "",
						label: "- None -"
					}];
					for (var i = 0 ; i < tableDDLs.length ; i++) {
						var tableName = tableDDLs[i].name,
							tableLabel = tableDDLs[i].label,
							positionInTableNames = tableNames.indexOf(tableName);
						if (positionInTableNames >= 0) tableNames.splice(positionInTableNames, 1);
						listOfSpreadsheets.push({name: tableName, label: tableLabel});
					}
					for (var i = 0 ; i < tableNames.length ; i++) {
						listOfSpreadsheets.push({name: tableNames, label: tableNames});
					}
				} catch (err) {
					AJS.error(err);
				}
			});
		});

		$(".bp-types").on("click", ".template", function(){
			selectType($(this));
		}).on("dblclick", ".template", function(){
			$('.create-dialog-create-button:visible').click();
		}).keydown(function(e) {
			if (e.keyCode == 38 || e.keyCode == 40) {
				e.preventDefault();

				var $selected = $('.bp-types .template.selected'),
					$templates = $('.bp-types .template'),
					$newSelected;
				if (e.keyCode == 38) // up
					$newSelected = $selected.prev(":visible:not(.disabled)").length != 0
						? $selected.prev(":visible:not(.disabled)")
						: $selected.parent().children(":visible:not(.disabled)").last();
				else if (e.keyCode == 40) // down
					$newSelected = $selected.next(":visible:not(.disabled)").length != 0
						? $selected.next(":visible:not(.disabled)")
						: $selected.parent().children(":visible:not(.disabled)").first();
				selectType($newSelected);
			}
		}).hide().removeClass("hidden");
		//updateVisibleTypes(mode);
		//selectType($("#bp-create-spreadsheet"));
	});

	wizard.on('submit.choose', function(e, state) {
		var $selected = $(".bp-types .template.selected"),
			type = $selected.attr("id");
		if (type == "bp-create-spreadsheet") {
			state.nextPageId = "create-spreadsheet";
		} else if (type == "bp-create-query") {
			if (listOfSpreadsheets && listOfSpreadsheets.length > 1) {
				state.nextPageId = "create-query";
			} else {
				state.nextPageId = "create-redirect";
				state.wizardData.redirectUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/query-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true"
				});
			}
		} else if (type == "bp-create-joint-table") {
			state.nextPageId = "create-redirect";
			state.wizardData.redirectUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/joint-table-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true"
				});
		}
	});

	wizard.on('post-render.create-redirect', function(e, state) {
		// Submit immediately
		window.setTimeout(function(){
			$('.create-dialog-create-button:visible').click();
		}, 0);
	});

	wizard.on('submit.create-redirect', function(e, state) {
		if (!state.wizardData.redirectUrl) throw "A redirection url is expected when using the create-redirect wizard step";
		state.finalUrl = state.wizardData.redirectUrl;
	});

	wizard.on('post-render.create-spreadsheet', function(e, state) {
        function autocorrectKey ($ssName, $ssKey, defaultCase) {
            var keyup = function() {
                var val = $ssName.val(),
                    keyVal = $ssKey.val();
                if (keyVal === $ssKey.attr('data-generated-val') || keyVal == "") {
                    // Generate the key from the name
                    var generatedKey = window.PlaySQL.Helpers.generateKey(val, defaultCase);
                    keyVal != generatedKey && $ssKey.val(generatedKey).attr('data-generated-val', generatedKey);
                } else {
                    // Autocorrect the key
                    var correctKey = window.PlaySQL.Helpers.generateKey($ssKey.val(), defaultCase);
                    if (correctKey != $ssKey.val())
                        $ssKey.val(correctKey);
                }
            };
            $ssName.keyup(keyup);
            $ssKey.keyup(keyup);
        }

		autocorrectKey(
			state.$container.find("#spreadsheet-name"),
			state.$container.find("#spreadsheet-key"),
			defaultCase
		);
	});

	wizard.on('submit.create-spreadsheet', function(e, state) {
		var $nameField = state.$container.find("#spreadsheet-name"),
			$keyField = state.$container.find("#spreadsheet-key"),
			$errorField = $keyField.parent().find(".error");
		var name = $nameField.val(),
			key = $keyField.val(),
			spaceKey = state.wizardData.spaceKey || AJS.Meta.get("space-key"),
			spreadsheet = {
				name: key,
				label: name
			};
		$errorField.empty();
		if (!name || !key || !spaceKey) {
			$errorField.text("All fields are required");
			return false;
		}
		// Submit the spreadsheet
		window.PlaySQL.createSpreadsheet("space:" + spaceKey, spreadsheet, undefined, window.PlaySQL.defaultCase, function(){
			state.validationDeferred.resolve();
		}, function(data){
			var message = data.responseText;
			if (data && data.status == 409) {
				// Conflict, table already exists
			}
			if (message) {
				try {
					var data2 = $.parseJSON(data.responseText);
					if (data2.message) message = data2.message;
				} catch (err) {}
			}
			$errorField.text(message);
			state.validationDeferred.reject();
		});
		state.finalUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?" +
						$.param({key: spaceKey, spreadsheetId: key});
		state.async = true;
	});

	wizard.on('pre-render.create-query', function(e, state) {
		state.soyRenderContext['spreadsheets'] = listOfSpreadsheets;
	});

	wizard.on('submit.create-query', function(e, state) {
		state.finalUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/query-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true",
					from: state.$container.find("#table-name").val() || "your_table"
				});
	});
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = '/blueprint/playsql-blueprint.soy' */
// This file was automatically generated from playsql-blueprint.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.CreateExperience.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }
if (typeof Confluence.Templates.PlaySQL.CreateExperience == 'undefined') { Confluence.Templates.PlaySQL.CreateExperience = {}; }


Confluence.Templates.PlaySQL.CreateExperience.getStarted = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml('Product lists. Timetables. Bookings. Your data.') + '</h2><div id="playsql-blueprint-explanation"><ul><li>' + soy.$$escapeHtml('Create a spreadsheet') + '</li><li>' + soy.$$escapeHtml('Copy-paste excerpts into pages of the space') + '</li><li>' + soy.$$escapeHtml('Use queries for more advanced reports') + '</li></ul></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.getStarted.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.getStarted';
}


Confluence.Templates.PlaySQL.CreateExperience.choose = function(opt_data, opt_ignored) {
  return '<ol class="bp-types hidden" id="playsql-blueprint-types"><li class="template selected with-next require-read-write" id="bp-create-spreadsheet"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml('Spreadsheet') + '</div><div class="template-description">' + soy.$$escapeHtml('Spreadsheets store new data. It can be displayed on the pages of the space.') + '</div></div></li><li class="template with-next" id="bp-create-query"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml('Query') + '</div><div class="template-description">' + soy.$$escapeHtml('Display data from several tables. Write in the SQL language.') + '</div></div></li><li class="template require-read-write" id="bp-create-joint-table"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml('Joint Table') + '</div><div class="template-description">' + soy.$$escapeHtml('Keep the original data unmodified. Add comments of your own, or dates or figures.') + '</div></div></li></ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.choose.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.choose';
}


Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = ((opt_data.copyId != null) ? '<p>' + soy.$$escapeHtml(AJS.format('The current spreadsheet (with key \x27{0}\x27) will be duplicated as:',opt_data.copyId)) + '</p>' : '') + '<form class="aui" id="create-spreadsheet-form"><fieldset><div class="field-group"><label for="name">' + soy.$$escapeHtml('Spreadsheet Label') + '</label><input class="text" id="spreadsheet-name" name="name" autocomplete="off" ' + ((opt_data.name) ? 'value="' + soy.$$escapeHtml(opt_data.name) + '"' : '') + '/>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['name']) {
    var errorList43 = opt_data.fieldErrors['name'];
    var errorListLen43 = errorList43.length;
    for (var errorIndex43 = 0; errorIndex43 < errorListLen43; errorIndex43++) {
      var errorData43 = errorList43[errorIndex43];
      output += '<div class="error">' + soy.$$escapeHtml(errorData43) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div><div class="field-group"><label for="key">' + soy.$$escapeHtml('Key') + '</label><input class="text" id="spreadsheet-key" name="key" ' + ((opt_data.key) ? 'value="' + soy.$$escapeHtml(opt_data.key) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Used as a name for the table in the database') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['key']) {
    var errorList63 = opt_data.fieldErrors['key'];
    var errorListLen63 = errorList63.length;
    for (var errorIndex63 = 0; errorIndex63 < errorListLen63; errorIndex63++) {
      var errorData63 = errorList63[errorIndex63];
      output += '<div class="error">' + soy.$$escapeHtml(errorData63) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm';
}


Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<form class="aui"><fieldset><div class="field-group"><label for="name">' + soy.$$escapeHtml('From') + '</label><select class="select" id="table-name" name="table-name">';
  var spreadsheetList75 = opt_data.spreadsheets;
  var spreadsheetListLen75 = spreadsheetList75.length;
  for (var spreadsheetIndex75 = 0; spreadsheetIndex75 < spreadsheetListLen75; spreadsheetIndex75++) {
    var spreadsheetData75 = spreadsheetList75[spreadsheetIndex75];
    output += '<option value="' + soy.$$escapeHtml(spreadsheetData75.name) + '"' + ((opt_data.selectedSpreadsheet == spreadsheetData75.name) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(spreadsheetData75.label) + '</option>';
  }
  output += '</select><div class="description">' + soy.$$escapeHtml('Optional. Select a spreadsheet to start from.') + '</div><div class="error"></div></div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet';
}


Confluence.Templates.PlaySQL.CreateExperience.empty = function(opt_data, opt_ignored) {
  return '';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.empty.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.empty';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-base-web', location = 'assets/core/js/playsql-selection.js' */

(function($){
    window.PlaySQL = window.PlaySQL || {};

    window.PlaySQL.Selection = {
        forTable: function ($placeholder) {
            var that = $placeholder.data('PlaySQLSelection');
            if (that == undefined) {
                that = {};
                $placeholder.data('PlaySQLSelection', that);
                that.options = {
                    cellSecondClick: function ($cell) {
                        this.options.editCell.call(this, $cell);
                    },
                    rowSecondClick: undefined,
                    columnSecondClick: undefined,
                    baseSelector: ".playsql-spreadsheet-placeholder table",
                    // Could be optimized by not withholding the $placeholder inside the data() of thedit $placeholder
                    $placeholder: $placeholder,
                    css : new window.PlaySQL.Helpers.CssObject($placeholder),
                    colOf : function($cell) {
                        return {index: $cell.index()};
                    },
                    popupTrigger: undefined,
                    popupContentFn: undefined,
                    pasteHandler: undefined,
                    addRow: undefined,
                    pasteImage: undefined,
                    /** The cssClassMap allows to operate on other CSS classes than "selection" and "focused".
                     - Undefined = It uses "selected" and "focused",
                     - Any other name = It uses the name, and no focus.
                     It is useful when the user is editing a formula and we're highlighting cells.
                     If this mode is activated, only selection/keymove is active and not secondClicks.
                     */
                    cssClassMap: undefined
                };
                that.setOptions = function (options) {
                    $.extend(that.options, options);
                    return that;
                };
                that.init = function (options) {
                    that.setOptions(options);
                    if (that.alreadyInitialized) {
                        // Do nothing
                    } else {
                        that.alreadyInitialized = true;
                        window.PlaySQL.Selection.attach($placeholder, that, {
                            "click thead tr.playsql-col-headers th:not(:first-child)": columnClick,
                            "mousedown tbody > tr > th:first-child, tfoot > tr > th:first-child": rowClick,
                            "mousedown tbody > tr > td, tfoot > tr > td": cellClick,
                            "mouseenter thead > tr.playsql-col-headers > th:not(:first):not(:last)": headerMouseEnter,
                            "mouseleave thead > tr.playsql-col-headers  > th:not(:first):not(:last)": headerMouseLeave,
                            "mousedown .playsql-resize-handle": resizeHandleMousedown,
                            "click .playsql-resize-handle": dodgeClick,
                            "key enter": pressEnter,
                            "key esc": pressEsc,
                            "key down": moveDown,
                            "key up": moveUp,
                            "key left": moveLeft,
                            "key right": moveRight,
                            "key tab": nextTabOrder,
                            "key shift+tab": previousTabOrder,
                            "key control+a": selectAll
                        });
                        window.PlaySQL.Selection.attach($("#main"), that, {
                            "click" : function($element, e){
                                // If the clicked element is still attached to the DOM (e.g. if a click handler
                                // came in between)
                                if (e.target.parent != null) {
                                    if (this.options.$placeholder.has(e.target).length == 0) {
                                        // The click was outside the spreadsheet
                                        unselectAll.call(this);
                                    }
                                }
                            }
                        });
                        if (that.options.popupTrigger) {
                            that.options.popupContentFn.call(that);
                            window.PlaySQL.Selection.inlineDialog = {
                                hide: function () {
                                    $(that.options.popupTrigger).removeAttr('data-aui-trigger');
                                    $(that.options.popupTrigger).removeAttr('aria-controls');
                                    $("#inline-dialog-formula-help").remove();
                                }
                            };
                        }
                        options.onInit && options.onInit();
                    }
                    return that;
                };
                that.unselectAll = function() {
                    unselectAll.call(that);
                };
                that.mapCss = mapCss;
                that.callHandler = function(handlerName, event) {
                    var fn = null;
                    if (handlerName == "columnClick") fn = columnClick;
                    else if (handlerName == "rowClick") fn = rowClick;
                    else if (handlerName == "cellClick") fn = cellClick;
                    else if (handlerName == "headerMouseEnter") fn = headerMouseEnter;
                    else if (handlerName == "headerMouseLeave") fn = headerMouseLeave;
                    else if (handlerName == "resizeHandleMousedown") fn = resizeHandleMousedown;
                    else if (handlerName == "dodgeClick") fn = dodgeClick;
                    else if (handlerName == "pressEnter") fn = pressEnter;
                    else if (handlerName == "pressEsc") fn = pressEsc;
                    else if (handlerName == "moveDown") fn = moveDown;
                    else if (handlerName == "moveUp") fn = moveUp;
                    else if (handlerName == "moveLeft") fn = moveLeft;
                    else if (handlerName == "moveRight") fn = moveRight;
                    else if (handlerName == "nextTabOrder") fn = nextTabOrder;
                    else if (handlerName == "previousTabOrder") fn = previousTabOrder;
                    else if (handlerName == "selectAll") fn = selectAll;
                    if (fn) {
                        return fn.call(that, event);
                    } else {
                        throw "callHandler(): No such handler '" + handlerName + "'";
                    }
                }
            }

            return that;
        },

        /**
         * Quickly delegate events using jquery
         * @param $base the element to bind the handlers to
         * @param that the 'selection' object to apply the callback handlers to. Mandatory.
         * @param handlers an array in the form:{
         *  "event table > td": function,
         *  "key control+ctrl+meta+shift+alt+key": function // control = ctrl on windows, meta on mac
         * }
         */
        attach: function ($base, that, handlers) {
            var event, selector, cutPosition,
                keyboardBindings = [],
                hasKeyBindings = false;
            // Bind all handlers on the $placeholder
            for (var key in handlers) {
                if (!handlers.hasOwnProperty(key)) continue;
                cutPosition = key.indexOf(" ");
                event = cutPosition === -1 ? key : key.substring(0, cutPosition);
                selector = cutPosition === -1 ? undefined : key.substring(cutPosition + 1);
                if (event.indexOf("key") === 0) {
                    keyboardBindings.push({key:selector.split("+"), handler: handlers[key]});
                    hasKeyBindings = true;
                } else {
                    (function (event, selector, handler, that) {
                        $base.on(event, selector, function(e) {
                            return handler.call(that, $(this), e);
                        });
                    })(event, selector, handlers[key], that);
                }
            }

            if (hasKeyBindings) {
                $(window.document).on("keydown.playsql-key-bindings keypress.playsql-key-bindings", function(e) {
                    // Dismiss the event if no cell is selected on the spreadsheet
                    if ($base.find(that.mapCss(".focused")).size() == 0) return;
                    // Dismiss the event if a dialog is shown
                    var $popups = $(".aui-inline-dialog:visible, .aui-popup:visible, .aui-blanket:visible");
                    var isDialogShown = false;
                    $popups.each(function(){
                        var $this = $(this),
                            id = $this.attr("id") || ("." + $this.attr("class"));
                        // Don't dismiss the handler
                        if ($this.is("#inline-dialog-playsql-table-popup, .aui-datepicker-dialog")) return;
                        if ($this.is("#inline-dialog-formula-editor")) return;
                        if ($this.is("#inline-dialog-cell-properties")) return;
                        if ($this.is("#inline-dialog-selection-action-panel")) return;
                        if ($this.find(".ui-datepicker").size() > 0) return;
                        if ($this.attr("aria-hidden") == "true") return;
                        // Alright, dismiss the handler
                        AJS.log("Dismissing the key/click handler - A dialog is shown - " + id);
                        isDialogShown = true;
                        return false;
                    });
                    if (isDialogShown) return;
                    var $focus = $("*:focus"),
                        isFocusOutsidePlaceholder = $focus.size() == 1 && $base.has($focus).size() == 0;
                    if (isFocusOutsidePlaceholder) return;

                    var keyCombinationDetail = window.PlaySQL.Helpers.getKeyCombinationDetail(e),
                        key = keyCombinationDetail.key,
                        onKeyDown = keyCombinationDetail.onKeyDown,
                        modifiers = keyCombinationDetail.modifiers;

                    //console.trace("Captured ", key, modifiers.join(","), e.type, $base.attr("data-macro-spreadsheet-id"));

                    // Only execute left, up, right, down and ctrl+a on keydown. The others on keypress.
                    if (onKeyDown && e.type != 'keydown') return;
                    if (!onKeyDown && e.type == 'keydown') return;

                    function trigger(key, handler) {
                        if (handler) {
                            handler.call(that, e);
                        }
                    }

                    function isCorrectCombination(key, modifiers, keyCombination) {
                        // Check the character matches
                        if (key != keyCombination[keyCombination.length - 1]) return false;
                        // Check the modifiers match
                        if (modifiers.length + 1 != keyCombination.length) return false;
                        for (var j = 0 ; j < keyCombination.length - 1 ; j++) {
                            if (modifiers.indexOf(keyCombination[j]) == -1) return false;
                        }
                        return true;
                    }

                    for (var i in keyboardBindings) {
                        if (!keyboardBindings.hasOwnProperty(i)) continue;
                        if (isCorrectCombination(key, modifiers, keyboardBindings[i].key)) {
                            trigger(keyboardBindings[i].key, keyboardBindings[i].handler);
                        }
                    }
                });
            }
        }, bindMenu2 : function(id, hint, $elements, optionsCallback, openImmediately) {
            var trigger = '<a href="#" class="aui-dropdown2-trigger aui-dropdown2-trigger-arrowless playsql-menu-trigger" aria-controls="' + id + '" aria-owns="' + id + '">' +
                '<span class="aui-icon aui-icon-small aui-iconfont-arrow-down">' + hint + '</span>' +
                '</a>';
            $elements.append(trigger);
            $elements.on("mousedown", ".playsql-menu-trigger", function(e) {
                // A click on the trigger shouldn't trigger a click event on the TD/TH (which would edit the cell)
                // So we prevent the event from bubbling
                return false;
            });
            var menu = PlaySQL.Helpers.htmlBuilder("div", {
                "id": id,
                "class": "aui-style-default aui-dropdown2",
                "html": PlaySQL.Helpers.htmlBuilder("ul", [ ])
            });
            var $menu = $("#" + id).remove();
            $("#custom-menu").append(menu);

            $menu = $("#" + id).on({
                "aui-dropdown2-show": function () {
                    var $ul = $menu.find("ul:first").empty();
                    function addItem(label, fn, args) {
                        var $li = $("<li></li>").appendTo($ul),
                            $a = $("<a></a>", {
                                href: typeof fn == "string" ? fn : '#',
                                target: "_blank",
                                text: label
                            }).appendTo($li);
                        $a.click(function(e){
                            if (typeof fn == "function") {
                                e.preventDefault();
                                fn.apply(this, args.concat([$(this), e]));
                            }
                        });
                    }
                    // aui-dropdown2-show doesn't give us the originalEvent, so here's a
                    // hack to infer what click triggered the menu
                    var $cell = $("*:hover").closest(".playsql td").first();
                    var items = optionsCallback($cell);
                    for (var item in items) {
                        if (!keyboardBindings.hasOwnProperty(item)) continue;
                        addItem(items[item][0], items[item][1], items[item].slice(2));
                    }
                }
            });
        },
        /**
         * Setup the copy-paste. Once for a page only. It uses byPlaceholder($0) to dispatch the event
         * @param options { pasteHandler: spreadsheet.function(contenteditableDiv) }
         */
        setupCopyHandler: function(options) {
            options = options || {};
            var that = this;
            $(document).on("copy", function() {
                // 1. Check whether we're in the spreadsheet
                var selection = window.getSelection(),
                    isConnexe = selection.rangeCount <= 1,
                    uniqueRange = selection.rangeCount == 1 ? selection.getRangeAt(0) : undefined,
                    hasPopups = $(".aui-inline-dialog:visible, .aui-dialog:visible").size() > 0,
                    hasEditingFocusedCell = $("table.playsql td.editing *:focus").size() > 0;
                if (hasPopups || hasEditingFocusedCell) return;
                if (!isConnexe) return;
                if (uniqueRange) {
                    if (!uniqueRange.collapsed) {
                        var didUserSelectSomething = !uniqueRange.collapsed;
                        if (didUserSelectSomething) {
                            var isPlaySqlZeroWidthSpan = uniqueRange.toString() == String.fromCharCode(8203);
                            if (!isPlaySqlZeroWidthSpan) {
                                isPlaySqlZeroWidthSpan =
                                    uniqueRange.startContainer == uniqueRange.endContainer
                                    && uniqueRange.startOffset == 0
                                    && uniqueRange.endOffset == 1;
                                isPlaySqlZeroWidthSpan = isPlaySqlZeroWidthSpan && (
                                (uniqueRange.startContainer.nodeName == "DIV" && uniqueRange.startContainer.className == "zws-playsql") ||
                                (uniqueRange.startContainer.textContent == String.fromCharCode(8203)));
                            }
                            if (isPlaySqlZeroWidthSpan) {
                                didUserSelectSomething = false;
                            }
                        }
                        if (didUserSelectSomething) {
                            return;
                        }
                    }
                }

                // 2. Since nothing is selected, select the cells/rows/col
                // Note: We use .selected directly without mapping (mapCss()) because the copyHandler is page-level
                // and we can't make specifics for each ss. Therefore it is always the .selected with is copied and
                // not the .cell-ref-active classes.
                var $selected = $(".playsql-spreadsheet-placeholder .selected, .playsql-query-placeholder .selected"),
                    $copyDiv = $(".tmp-clipboard-contents").empty();
                if ($copyDiv.size() == 0) {
                    $copyDiv = $("<div></div>", { "class" : "tmp-clipboard-contents" }).appendTo($("body").first());
                }
                if ($selected.size() == 0) return;
                var $placeholder = $selected.closest(".playsql-spreadsheet-placeholder, .playsql-query-placeholder").first();
                $placeholder.find("tr[data-row-metadata]").each(function(){
                    var $this = $(this),
                        rowMetadata = $this.data("row-metadata");
                    if (rowMetadata) {
                        $this.attr("data-row-metadata", JSON.stringify(rowMetadata));
                    } else {
                        $this.removeAttr("data-row-metadata");
                    }
                });
                $placeholder = $placeholder.clone();
                $placeholder.appendTo($copyDiv);

                // Remove header and footer
                $placeholder.find(".pagination-row, .playsql-resize-handle, .right-padding > *, .zws-playsql").remove();
                $placeholder.find("tfoot").remove();
                // Remove all rows which don't have any cell selected
                $placeholder.find("tbody > tr").each(function(){
                    if ($(this).find("td.selected").size() == 0) {
                        $(this).remove();
                    }
                });
                // Remove all columns which don't have any cell selected
                $($placeholder.find("thead tr.playsql-col-headers th").get().reverse()).each(function(){
                    var $this = $(this),
                        index = $this.index(),
                        $cells = $placeholder.find("tbody tr > *:nth-child(" + (index+1) + ")");
                    if ($(this).attr("data-status-pk") == 'true' || $(this).attr("data-status-position") == 'true') return;
                    if ($this.hasClass(".right-padding") || !$cells.hasClass("selected")) {
                        // Well, remove...
                        $this.remove();
                        $cells.remove();
                    }
                });
                // Update the anchor on the top left
                $placeholder.find("thead > tr.playsql-col-headers > th:first a").text("...");
                $placeholder.find("td, th").removeClass("selected focused invalid cell-ref-active cell-ref-inactive").removeAttr("data-rendered");
                $placeholder.find("tr").each(deserializeCellMetadataToTD);
                var table = $copyDiv.find("table.playsql")[0];

                // Move all attributes from the div placeholder to the TABLE html element,
                // because divs are stripped (in Chrome)
                var attrs = $placeholder[0].attributes;
                for (var i=0 ; i < attrs.length ; i++) {
                    var attr = attrs[i];
                    if (attr.name && attr.name.indexOf("data-") == 0)
                        table.setAttribute(attr.name, attr.value);
                }
                // Avoid coying the styles, so styles don't get inlined in other destinations
                $(table).removeClass("playsql");

                var range = document.createRange(),
                    selection = window.getSelection();
                range.setStart(table, 0);
                range.setEnd(table, table.childNodes.length);

                selection.removeAllRanges();
                selection.addRange(range);
                window.setTimeout(function() {
                    selection = window.getSelection();
                    table = $(".tmp-clipboard-contents table")[0];
                    range.setStart(table, 0);
                    range.setEnd(table, table.childNodes.length);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }, 100);
            }).on("input keyup", ".zws-playsql", function(event){
                var $contenteditable = $(this);
                pasteText($contenteditable);
            }).on("paste", ".zws-playsql", function(event){
                var $contenteditable = $(this);
                var isFile = false;
                var clipboardData = event.originalEvent.clipboardData;
                var items = clipboardData.items;
                for (var index in items) {
                    var item = items[index];
                    if (item.type === 'text/html') {
                        // Avoid processing it as a file if there is an HTML version
                        break;
                    } else if (item.kind === 'file') {
                        if (!options.pasteImage) return;
                        var $focused = $(".playsql-spreadsheet-placeholder .focused");
                        var $placeholder = $focused.closest(".playsql-spreadsheet-placeholder");
                        if ($placeholder.length == 0) return;
                        var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);
                        if (!spreadsheet) return;
                        var result = options.pasteImage.call(spreadsheet, item);
                        if (!result) {
                            pasteText($contenteditable);
                        }
                    }
                }
                if (!isFile) {
                    pasteText($contenteditable);
                }
                //return false; // Or use event.preventDefault() or preventPropagation()
            });
            function pasteText ($contenteditable){
                if ($.trim($contenteditable.html()).length == 0 || $contenteditable.html() == "&#x200B;" || $contenteditable.html() == "\u200B") return;
                window.setTimeout(function () {
                    if (!options.pasteHandler) return;
                    var $focused = $(".playsql-spreadsheet-placeholder .focused"),
                        $placeholder = $focused.closest(".playsql-spreadsheet-placeholder");
                    if ($placeholder.length == 0) return;
                    var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);
                    if (!spreadsheet) return;
                    options.pasteHandler.call(spreadsheet, $contenteditable);
                }, 0);
            }
            function deserializeCellMetadataToTD() {
                var $tr = $(this),
                    $tds = $tr.children(),
                    $ths = $tr.closest("table").find("thead tr").first().children();
                var rowMetadataText = $tr.attr("data-row-metadata");
                var $td, colName, cellMetadata;
                if (!rowMetadataText) return;
                try {
                    var rowMetadata = typeof rowMetadataText == "string" ? $.parseJSON(rowMetadataText) : rowMetadataText;
                    if (!rowMetadata) return;
                } catch (err) {
                    return;
                }
                for (var i = 0 ; i < $tds.size() ; i++ ) {
                    colName = $ths.eq(i).attr("data-name");
                    // We may not find the colName for the padding column
                    if (!colName) continue;
                    cellMetadata = rowMetadata["c_" + colName];
                    $td = $tds.eq(i);
                    if (cellMetadata) {
                        for (var key in cellMetadata) {
                            if (!cellMetadata.hasOwnProperty(key)) continue;
                            $td.attr("data-cell-metadata-" + key, cellMetadata[key]);
                        }
                    }
                }
            }
        },
        /** This method should be called after every click/selection. It selects
         * a zws in a contenteditable div, so the user can copy, paste and type and
         * we'll catch these events.
         * @param that the playsql-selection object
         **/
        setNonCollapsedSelection : function (that, handlePaste) {
            // Check whether the user has consciously selected something
            var $placeholder = that.options.$placeholder,
                selection = window.getSelection(),
                uniqueRange = selection.rangeCount == 1 ? selection.getRangeAt(0) : undefined;
            // Abort if there's an alternate selection mode (formula editing)
            if (that.options.cssClassMap) return;
            // Abort if there's a textual selection
            if (uniqueRange && !uniqueRange.collapsed) return;
            // Abort if the user has selected any cell
            if ($(".playsql").find(that.mapCss(".selected")).length == 0) return;

            // Abort if the user is editing anything...
            // Go figure: When the caret is in the zws-playsql, IE9 declares it in the thead
            var $caret = $placeholder.find("*:focus:not(table.playsql > thead), " + that.mapCss(".editing.focused"));
            if ($caret.length > 0 && $caret.html().length > 0 && !$caret.html() == "\u200B" && !$caret.is(".zws-playsql *")) return;

            // Alright, make them select a zws
            var $th = $placeholder.find("th").first(),
                $zwsDiv = $th.find(".zws-playsql"),
                initialScroll = $(window).scrollLeft();
            if ($zwsDiv.size() == 0) {
                $zwsDiv = $("<div></div>", {
                    "class" : "zws-playsql",
                    "contenteditable": handlePaste ? "true" : "false",
                    html: "&#x200B;" // That's a zero-width space
                }).appendTo($th);

                // We want to bypass the keyboard shortcuts if the user is typing into zws-playsql
                $(document).on("keypress", function(e){
                    if (e && e.target && e.target.contentEditable == "true" && e.target.className) {
                        if ((e.target.className || "").indexOf("zws-playsql") != -1) {
                            e.stopImmediatePropagation();
                        }
                    }
                });

                // There are more than 70 'keypress' handlers on a Confluence page, and we want to be first to skip
                // them all. Note: We hope we don't bypass some useful key binding, apart from the keyboard shortcuts.
                var allEvents = $._data(document, "events").keypress;
                // Move our handler to the first position
                allEvents.unshift(allEvents.pop());

            } else {
                $zwsDiv.html("&#x200B;");
            }
            $zwsDiv.focus();
            var range = document.createRange(),
                el = $zwsDiv[0],
                selection = window.getSelection();
            range.setStart(el, 0);
            range.setEnd(el, el.childNodes.length);

            try {
                selection.removeAllRanges();
            } catch (err) {
                // Err is 800a025e and happens on removeAllRanges in IE (9 at least)
                document.selection && document.selection.clear && document.selection.clear();
            }
            selection.addRange(range);

            // Restore the left scroll
            $(window).scrollLeft(initialScroll);
        }
    };

    function checkNotNull(value, message) {
        if (value == undefined) {
            throw "Unexpectedly undefined value: " + value + "(" + message + ")";
        }
        if (value instanceof $) {
            if (value.size() == 0)
                throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
        }
        return value;
    }

    var pressEnter = function(e) {
        // We must prevent default, otherwise the form is submitted.
        e.preventDefault();
        var options = this.options,
            $placeholder = options.$placeholder,
            $editingCells = $placeholder.find(".editing"),
            hasEditingCells = $editingCells.size() != 0;
        if (hasEditingCells) {
            options.saveCells($editingCells);
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        } else {
            // Abort if there's an alternate selection mode (formula editing)
            if (this.options.cssClassMap) return false;
            $placeholder.find(this.mapCss(".focused")).each(function(){
                options.editCell($(this));
            });
        }
        return false;
    };

    var pressEsc = function(e) {
        var options = this.options,
            $placeholder = options.$placeholder,
            $beingEdited = $placeholder.find(".editing, .saving"),
            hasEdits = $beingEdited.size() != 0;
        if (hasEdits) {
            $beingEdited.each(function(){
                options.cancelEdit($(this));
            });
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        } else {
            // If there are open inline-dialogs, close them
            var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);
            if (spreadsheet.inlinedialog != null && spreadsheet.inlinedialog) {
                spreadsheet.inlinedialog.close();
            } else {
                // Otherwise, deselect all
                unselectAll.call(this);
            }
            // Formulas in edition: Close them
            window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, true);
        }
        return false;
    };

    /**
     * Returns true if the keypress event for up/down/left/right should be executed. Notably:
     * - It shouldn't be executed if the cell is being edited
     * - Except if the cursor (caret) is at the right of the text and the user is pressing right,
     *   or if the caret is at the left and the user is pressing left, etc.
     */
    function shouldCaptureKey(selection, $placeholder, e, handlerName) {
        var $cell = checkNotNull($placeholder.find(selection.mapCss(".focused"))),
            $widget = $cell.find("input:focus, select:focus, textarea:focus, div[contenteditable]:focus");
        if ($widget.size() == 1) {
            /* Think about:
             * Input (numbers)
             * Textarea (multiline text)
             * Datepicker
             * Page picker
             */
            // Generally, don't capture, except if pressing up, down, or if caret is at the beginning or end.
            if ($widget.is("input, textarea, div")) {
                if ((handlerName == 'moveDown' || handlerName == 'moveUp') && $widget.is("input")) {
                    if ($widget.parent().find(".autocomplete li:visible").size() != 0) {
                        // We're in a page picker with the drop-down open
                        return false;
                    }
                    // We're in an input box
                    return true;
                }
                // We're an input box (left, right) or a textarea (all directions)
                var caret = window.PlaySQL.Helpers.caretSelection($widget[0]),
                    length = ($widget.val() || $widget.text()).length;
                if (caret == undefined) return false;
                if ((handlerName == 'moveLeft' || handlerName == 'moveUp') && caret.position == 0 && caret.length == 0) return true;
                if ((handlerName == 'moveRight' || handlerName == 'moveDown') && caret.position == length) return true;
            } else if ($widget.is("select")) {
                if (handlerName == 'moveLeft') return true;
                if (handlerName == 'moveRight') return true;
            }
            return false;
        }
        return true;
    }

    var moveDown = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $row = $cell.parent(),
            $newRow = $row.next(),
            index = $cell.index(),
            $newCell;

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveDown")) return;

        if ($row.parent().is("thead")) {
            $newRow = $placeholder.find("tbody > tr:first-child");
        } else if ($row.is("tbody > tr:last-child") && this.options.canSelectFooter) {
            $newRow = $placeholder.find("tfoot > tr.totals-row");
            // Don't select the <th> or the right padding
            index = Math.max(index, 1);
            index = Math.min(index, $newRow.children(":not(.right-padding)").size() - 1);
        }

        $newCell = $newRow.children().eq(index);
        if ($newRow.size() != 0) {
            if (index == 0) {
                // Select row
                rowClick.call(this, $newCell);
                unbindDrag.call(this);
                e.preventDefault();
            } else {
                if ($newCell.size() == 1 && !$newCell.hasClass("right-padding")) {
                    e.preventDefault();
                    // Select cell
                    unselectAll.call(this);
                    $newCell.addClass(this.mapCss("selected focused"));
                    if (wasEditing) {
                        this.options.saveCells($cell);
                        this.options.editCell && this.options.editCell($newCell);
                    } else {
                        window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
                    }
                }
            }
        }
    }

    var moveUp = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $row = $cell.parent(),
            $newRow = $row.prev(),
            index = $cell.index(),
            $newCell;

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveUp")) return;

        if ($row.is("tbody > tr:first-child")) {
            var $header = $placeholder.find("thead > tr.playsql-col-headers").children().eq(Math.max(index, 1));
            columnClick.call(this, checkNotNull($header, index), e);
            e.preventDefault();
            return;
        } else if ($row.is("tfoot > tr")) {
            $newRow = $placeholder.find("tbody > tr:last-child");
        }
        $newCell = $newRow.children().eq(index);

        if ($newRow.size() != 0) {
            if (index == 0) {
                // Select row
                rowClick.call(this, $newCell);
                unbindDrag.call(this);
                e.preventDefault();
                return;
            } else {
                e.preventDefault();
                // Just select a cell
                unselectAll.call(this);
                $newCell.addClass(this.mapCss("selected focused"));
                if (wasEditing) {
                    this.options.saveCells($cell);
                    this.options.editCell && this.options.editCell($newCell);
                } else {
                    window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
                }
                return;
            }
        }
    }

    var moveLeft = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $newCell = $cell.prev();

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveLeft")) return;

        if ($newCell.is("thead > tr.playsql-col-headers > th")) {
            if ($newCell.index() == 0) {
                rowClick.call(this, checkNotNull($placeholder.find("tbody > tr > th").first()));
                unbindDrag.call(this);
                e.preventDefault();
            } else {
                columnClick.call(this, $newCell, e);
                e.preventDefault();
            }
        } else if ($newCell.is("tbody th")) {
            rowClick.call(this, $newCell);
            unbindDrag.call(this);
            e.preventDefault();
        } else if ($newCell.is("td")) {
            e.preventDefault();
            unselectAll.call(this);
            $newCell.addClass(this.mapCss("selected focused"));
            if (wasEditing) {
                this.options.saveCells($cell);
                this.options.editCell && this.options.editCell($newCell);
            } else {
                window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
            }
        }
    }

    var moveRight = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $newCell = $cell.next(":not(.right-padding, .hidden, .nohighlight)");

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveRight")) return;

        if ($cell.is("thead > tr > th")) {
            if ($newCell.size() != 0)
                columnClick.call(this, $newCell, e);
        } else if ($newCell.size() != 0) {
            unselectAll.call(this);
            $newCell.addClass(this.mapCss("selected focused"));
            e.preventDefault();
            if (wasEditing) {
                this.options.saveCells($cell);
                this.options.editCell && this.options.editCell($newCell);
            } else {
                window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
            }
        }
    }

    var nextTabOrder = function(e) {
        moveTabOrder.call(this, e, +1);
    }
    var previousTabOrder = function(e) {
        moveTabOrder.call(this, e, -1);
    }

    var moveTabOrder = function(e, increment) {
        function moveFocus($oldCell, $newCell) {
            $oldCell.removeClass(this.mapCss("focused"));
            $newCell.addClass(this.mapCss("focused"));

            if (!$newCell.hasClass(this.mapCss("selected"))) {
                // Moving inside a selection
                $oldCell.removeClass(this.mapCss("selected"));
                $newCell.addClass(this.mapCss("selected"));
            }

            if ($oldCell.hasClass("editing")) {
                // Save the previous cell
                this.options.saveCells($oldCell);
                // Make the cell editable
                this.options.editCell && this.options.editCell($newCell);
            }
        }
        var $placeholder = checkNotNull(this.options.$placeholder),
            $focused = $placeholder.find(this.mapCss(".focused")),
            $selected = $placeholder.find(this.mapCss(".selected")),
            $inputsInCell = $focused.find("input, div[contenteditable], textarea"),
            $focusedInput = $focused.find(":focus"),
            index = $selected.index($focused),
            newIndex = (index + increment) % $selected.size();

        if ($inputsInCell.size() > 1 && $focusedInput.size() == 1) {
            if (increment == 1 && $inputsInCell.last()[0] != $focusedInput[0]
                || increment == -1 && $inputsInCell.first()[0] != $focusedInput[0]) {
                // Let the natural tab operate
                AJS.log("Natural tab");
                return true;
            } else {
                // We're in the last/first input field of a cell. Normally we'd change cell,
                // except if we're editing a total
                if ($focusedInput.closest(".totals-row").size() > 0) {
                    AJS.log("Natural tab: Prevented");
                    e.preventDefault();
                    return false;
                }
            }
        }
        if ($focused.is("thead > tr.playsql-col-headers > th")) {
            // Just submit the column
            $focusedInput.blur();
            return false;
        }

        if (index != -1 && $selected.size() > 1) {
            moveFocus.call(this, $focused, $selected.eq(newIndex));
        } else if ($focused.size() != 0) {
            // Next cell in the row?
            var $newCell = increment > 0 ? $focused.next(":not(.right-padding)") : $focused.prev(":not(:first-child)");
            if ($newCell.size() != 1) {
                // Next row?
                $newCell = increment > 0
                    ? checkNotNull($focused.parent("tr")).next("tr").children("td").first()
                    : checkNotNull($focused.parent("tr")).prev("tr").children("td:not(.right-padding)").last();
            }
            if ($newCell.size() != 1) {
                // Top-left cell? Move around the spreadsheet
                if (increment < 0) {
                    $newCell = checkNotNull($placeholder.find("tbody td:not(.right-padding)").last());
                } else {
                    // Bottom-right cell? If edit -> add row, Otherwise go to top-left cell.
                    if ($focused.hasClass(this.mapCss("editing"))) {
                        this.options.addRow && this.options.addRow();
                    } else {
                        $newCell = checkNotNull($placeholder.find("tbody td").first());
                    }
                }
            }
            if ($newCell.size() == 1) {
                moveFocus.call(this, $focused, $newCell);
            }
        }

        e.preventDefault();
    }

    var selectAll = function() {
        var $cell = checkNotNull(this.options.$placeholder.find(this.mapCss(".focused") + ", .focused")),
            $widget = $cell.find("input:focus, select:focus, textarea:focus, div[contenteditable]:focus");

        // Abort if there's an alternate selection mode (formula editing)
        if (this.options.cssClassMap) return;
        // Abort if there is any cell in edition
        if ($widget.size() == 1) return;

        var $allCells = this.options.$placeholder.find("tbody tr > th, tbody tr > td:not(.right-padding)");
        $allCells.addClass(this.mapCss("selected")).removeClass(this.mapCss("focused"));
        $allCells.first().addClass(this.mapCss("focused"));
        window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
    }

    /**
     * Unselect all cells and remove menus
     * @param keepSelectedCells true if we should just remove the focus and the menus, and keep the selected cells
     */
    var unselectAll = function(keepSelectedCells) {
        // It wasn't possible to have 2 spreadsheets on the same page, so I've changed from
        // unselecting within the $placeholder and unselecting on the whole page.
        $(".playsql-spreadsheet-placeholder, .playsql-query-container").find(this.mapCss(".selected, .focused"))
            .removeClass((keepSelectedCells ? "" : this.mapCss("selected")) + " " + this.mapCss("focused") + " aui-dropdown2-trigger")
            .removeAttr('aria-controls aria-haspopup aria-owns');

        // Ensure no text is selected. Otherwize setNonCollapsedSelection() will quit, assuming something was selected.
        var selection = window.getSelection();
        var range = selection && (selection.rangeCount > 0) && selection.getRangeAt(0);
        if (range) range.collapse(true);
    }

    var columnClick = function($header, e) {
        var $placeholder = this.options.$placeholder,
            column = this.options.colOf($header);
        if (!column) return false;
        var index = column.index + 1;
        $cells = $placeholder.find("table.playsql > thead > tr.playsql-col-headers > *:nth-child(" + index + "), " +
        "table.playsql > tbody > tr:not(.playsql-message) > *:nth-child(" + index + ")");
        if ($cells.first().hasClass(this.mapCss("selected"))) {
            if (!$header.hasClass("editing")) {
                this.options.columnSecondClick && this.options.columnSecondClick($header);
            }
        } else if (!$cells.first().hasClass(this.mapCss("focused"))) {
            unselectAll.call(this);
            $cells.addClass(this.mapCss("selected"));
            $cells.first().addClass(this.mapCss("focused"));
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        }
        return false;
    };

    /** Select row */
    var rowClick = function($header, event) {
        if (event && event.type != "keydown" && (event.which || event.button) != 1) return;
        if ($header.hasClass(this.mapCss("selected"))) {
            // Abort if there's an alternate selection mode (formula editing)
            if (this.options.cssClassMap) return;
            this.options.rowSecondClick && this.options.rowSecondClick($header);
        } else {
            if ($header.is("tfoot th")) return true;

            unselectAll.call(this);
            var $cells = $header.parent().children("th, td"),
                $placeholder = this.options.$placeholder;
            $cells.addClass(this.mapCss("selected"));
            $cells.first().addClass(this.mapCss("focused"));
            var selectDragRow = function($tr) {
                if (!$placeholder.has($tr))
                    return;
                var $allTrs = $header.closest("table").find("tbody > tr"),
                    rowId1 = $tr.attr("data-row-id"),
                    rowId2 = checkNotNull($header.parent().attr("data-row-id")),
                    highlighted = false;
                if (rowId1 == undefined)
                // We're hovering over a tr which isn't in the body
                    return;
                $allTrs.each(function(){
                    var $tr = $(this),
                        rowId = $tr.attr("data-row-id");
                    if (rowId == rowId1 || rowId == rowId2) {
                        highlighted = !highlighted;
                        $tr.find("td, th").addClass(that.mapCss("selected"));
                    } else if (highlighted) {
                        $tr.find("td, th").addClass(that.mapCss("selected"));
                    } else {
                        $tr.find("td, th").removeClass(that.mapCss("selected"));
                    }
                });
                $placeholder.addClass("no-select");
            };
            window.PlaySQL.Selection.attach($(window.document), this, {
                "mouseover.select-drag tr" : selectDragRow,
                "mouseup.select-drag" : unbindDrag
            });

            // This timeout comes for a fix where a click on the <tr> didn't allow the copy.
            // When happened was, there was no text selected, as opposed to clicks on cells.
            // setNonCollapsedSelection() was doing its job, but the mouseup/click happened after
            // the current code (which is bound to mousedown), so whatever was selected was unselected
            // by the browser at the end of the click
            var that = this;
            window.setTimeout(function() {
                window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
            }, 0);
        }
    };

    // I've introduced mouseupTriggered because "unbindDrag" must be attached as soon as mousedown is here in order
    // not to miss the mouseup, but it can't be treated until after the setTimeout(0) of cellClick is done.
    var mouseupTriggered = false;
    var unbindDrag = function() {
        mouseupTriggered = true;
        $(window.document)
            .unbind("mouseover.select-drag")
            .unbind("mouseup.select-drag");
        if (this.options.$placeholder.hasClass("no-select")) {
            // This timeout was introduced to fix the copy of an area. The bug was: The user drag'n'selected a
            // few rows, the setNonCollapsedSelection() would select a &zws;, the mouseup would trigger a brower-level
            // caret positioning, effectively resetting to a collapsed range. We want setNonCollapsedSelection to
            // happen after this browser event.
            var that = this;
            that.options.$placeholder.removeClass("no-select");
            window.setTimeout(function() {
                window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
            }, 0);
        }
    }

    var cellClick = function($cell, event) {
        if (event.type != "keydown" && (event.which || event.button) != 1) return;
        // We don't handle clicks on the cell if the inner target of the click is a hyperlink.
        if ($(event.target).is("a")) return;
        // We had to bind 'cellClick' (and all attachments) to 'mousedown' instead of 'click', because we wanted
        // to capture the drag event (mousedown/mouseup lapse).
        //
        // It caused cellClick to behave differently, because the 'click' would happen after mousedown, disturbing
        // the focus. Therefore we introduced window.setTimeout().
        //
        // Then we noticed events happened in this order in IE9: mousedown, mouseup, mousedown.timeout(0). So it would
        // appear like the cursor was dragging a sticky selection.
        // We solved that by checking the current state of the mouse button.
        var that = this;
        mouseupTriggered = false;
        window.PlaySQL.Selection.attach($(window.document), that, {
            "mouseup.select-drag" : unbindDrag
        });
        window.setTimeout(function(){
            // Abort if the click is in the footer and it's not allowed to select it
            if ($cell.is("tfoot > tr > *") && !that.options.canSelectFooter) {
                return;
            }
            if ($cell.parent().hasClass("pagination-row")) {
                return;
            }
            if ($cell.hasClass("right-padding")) {
                return;
            }
            if ($cell.hasClass(that.mapCss("focused"))) {
                // Abort if there's an alternate selection mode (formula editing)
                if (that.options.cssClassMap) return;
                that.options.cellSecondClick && that.options.cellSecondClick.call(that, $cell);
                return;
            }
            // Special case to edit totals
            if ($cell.hasClass("edit-on-first-click")) {
                // Abort if there's an alternate selection mode (formula editing)
                if (that.options.cssClassMap) return;
                that.options.cellSecondClick && that.options.cellSecondClick.call(that, $cell);
                return;
            }
            if (!event || !(!window.PlaySQL.Helpers.isMac && event.ctrlKey || window.PlaySQL.Helpers.isMac && event.metaKey))
                unselectAll.call(that);
            else
                unselectAll.call(that, true);
            $cell.addClass(that.mapCss("selected focused"));

            if ($cell.hasClass(that.mapCss("editing"))) {
                return;
            }
            var $placeholder = that.options.$placeholder;
            var selectDragCell = function($cell) {
                if (!$placeholder.has($cell)) return;
                var $focused = $placeholder.find(that.mapCss(".focused")),
                    origCol = $focused.index(),
                    origRow = $focused.closest("tr").index(),
                    destCol = $cell.index(),
                    destRow = $cell.closest("tr").index(),
                    minCol = Math.min(origCol, destCol),
                    maxCol = Math.max(origCol, destCol),
                    minRow = Math.min(origRow, destRow),
                    maxRow = Math.max(origRow, destRow);
                if (!$cell.is($focused)) {
                    // We let the user select the text in one cell. If he moves over another
                    // cell, we disable selection.
                    $placeholder.addClass("no-select");
                }
                // Select all cells between that focused cell and $cell
                $placeholder.find("tbody tr > td").each(function(){
                    var $this = $(this),
                        col = $this.index(),
                        row = $this.closest("tr").index();
                    if (   col >= minCol && col <= maxCol
                        && row >= minRow && row <= maxRow) {
                        $this.addClass(that.mapCss("selected"));
                    } else {
                        $this.removeClass(that.mapCss("selected"));
                    }
                });
            };

            if (mouseupTriggered) {
                // Since the mouseup was already triggered, no need to attach the handler
            } else {
                window.PlaySQL.Selection.attach($(window.document), that, {
                    "mouseover.select-drag td" : selectDragCell
                });
            }

            // Yeg, select something so the 'copy' event can be raised
            window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
        }, 0);
    }

    var resizing = false,
        isHovering,
        minPageY, maxPageY;
    var headerMouseEnter = function($cell, e) {
        isHovering = true;
        if (resizing) return;
        var offset = $cell.offset(),
            width = $cell.outerWidth(),
            height = $cell.outerHeight(),
            left = offset.left + width - 6,
            top = offset.top - 1,
            $placeholder = $cell.closest(".playsql-spreadsheet-placeholder"),
            $handle = $placeholder.find(".playsql-resize-handle");

        // Find the closest positioned element, that's the one which "position:relative" is relative to
        var $container = $cell;
        while ($container.css("position") == "static" && $container.parent().size() > 0) {
            $container = $container.parent();
        }
        var containerTop = $container.offset().top,
            containerLeft = $container.offset().left;

        // Determine the upper and lower allowed bounds of the cursor
        minPageY = top - 20;
        maxPageY = top + height + 20;

        $handle.remove();
        $handle = $("<div>", { "class": "playsql-resize-handle" });
        $cell.append($handle);
        $handle.css({
            top: (top - containerTop) + "px",
            left: (left - containerLeft) + "px",
            height: height + "px"
        }).removeClass("hidden");
    }
    var headerMouseLeave = function($cell, e) {
        if (!resizing) {
            $(".playsql-resize-handle").addClass("hidden");
        }
    }
    var resizeHandleMousedown = function($handle, e) {
        resizing = true;
        var pageX = e.pageX,
            $cell = $handle.closest("th"),
            originalWidth = $cell.width(),
            originalLeft = parseInt($handle.css("left")),
            playsqlSelection = this;
        $handle.addClass("dragging");

        $(document).on('selectstart.playsql-resize', function (e) {
            e.preventDefault();
        });

        $(document).on("mousemove.playsql-resize", function(e) {
            var newPageY = e.pageY;
            isHovering = newPageY > minPageY && newPageY < maxPageY;
            if (!isHovering) {
                $handle.addClass("hidden");
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, null, false);
            } else {
                var newPageX = e.pageX,
                    newWidth = originalWidth - pageX + newPageX,
                    newLeft = originalLeft - pageX + newPageX;
                if (newWidth < 20) {
                    newWidth = 0;
                }
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, newWidth, false);
                $handle.css("left", newLeft + "px").removeClass("hidden");
            }
        });

        $(document).on("mouseup.playsql-resize", function(e) {
            e.preventDefault();
            $(document).off(".playsql-resize");
            $handle.removeClass("dragging");
            resizing = false;
            var width = isHovering ? $cell.width() : null;
            if (width != null && Math.abs(originalWidth - width) < 3) {
                // It's a header click. We let the fw decide whether it's a first or second click.
                $cell.click();
            } else {
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, width, true);
            }
        });
    };
    var dodgeClick = function($handle, e) {
        // Prevent the resize handle from feeling selected
        e.preventDefault();
        return false;
    }

    /** Depending on selection.options.cssClassMap, returns the equivalent CSS classes.
     * E.g.: mapClass("selected") returns "selected" by default.
     * When selection.options.cssClassMap == {"selected": "cell-ref-active"}, it returns "cell-ref-active"
     * @param cssClassName the name of the class. Several classes can be passed with a comma.
     * @return the mapped class names separated by a space
     */
    function mapCss(cssClassName) {
        if (!this.options.cssClassMap) return cssClassName;
        function isSpecialChar(a) {
            switch (a) {
                case '':
                case ' ':
                case ',':
                case '.':
                case '[':
                case ']':
                    return true;
                default:
                    return false;
            }
        }
        var parts = [""],
            state = false;
        // It loops on length+1 characters, because the last (virtual) one is considered
        // as a separator and it ensures the last class is transformed too.
        for (var i = 0 ; i <= cssClassName.length ; i++) {
            if (isSpecialChar(cssClassName.charAt(i))) {
                if (state) {
                    // The last string on "parts" is a CSS classname
                    var val = this.options.cssClassMap[parts[parts.length - 1]];
                    if (val) {
                        parts[parts.length - 1] = val;
                    }
                }
                state = false;
            } else {
                if (!state) parts.push("");
                state = true;
            }
            parts[parts.length - 1] += cssClassName.charAt(i);
        }
        var result = parts.join("");
        return result;
    }

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:chart-view', location = 'assets/core/charts/moment.min.js' */
//! moment.js
//! version : 2.18.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return sd.apply(null,arguments)}function b(a){sd=a}function c(a){return a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)}function d(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)}function e(a){var b;for(b in a)return!1;return!0}function f(a){return void 0===a}function g(a){return"number"==typeof a||"[object Number]"===Object.prototype.toString.call(a)}function h(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function i(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function j(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function k(a,b){for(var c in b)j(b,c)&&(a[c]=b[c]);return j(b,"toString")&&(a.toString=b.toString),j(b,"valueOf")&&(a.valueOf=b.valueOf),a}function l(a,b,c,d){return sb(a,b,c,d,!0).utc()}function m(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function n(a){return null==a._pf&&(a._pf=m()),a._pf}function o(a){if(null==a._isValid){var b=n(a),c=ud.call(b.parsedDateParts,function(a){return null!=a}),d=!isNaN(a._d.getTime())&&b.overflow<0&&!b.empty&&!b.invalidMonth&&!b.invalidWeekday&&!b.nullInput&&!b.invalidFormat&&!b.userInvalidated&&(!b.meridiem||b.meridiem&&c);if(a._strict&&(d=d&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour),null!=Object.isFrozen&&Object.isFrozen(a))return d;a._isValid=d}return a._isValid}function p(a){var b=l(NaN);return null!=a?k(n(b),a):n(b).userInvalidated=!0,b}function q(a,b){var c,d,e;if(f(b._isAMomentObject)||(a._isAMomentObject=b._isAMomentObject),f(b._i)||(a._i=b._i),f(b._f)||(a._f=b._f),f(b._l)||(a._l=b._l),f(b._strict)||(a._strict=b._strict),f(b._tzm)||(a._tzm=b._tzm),f(b._isUTC)||(a._isUTC=b._isUTC),f(b._offset)||(a._offset=b._offset),f(b._pf)||(a._pf=n(b)),f(b._locale)||(a._locale=b._locale),vd.length>0)for(c=0;c<vd.length;c++)d=vd[c],e=b[d],f(e)||(a[d]=e);return a}function r(b){q(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),wd===!1&&(wd=!0,a.updateOffset(this),wd=!1)}function s(a){return a instanceof r||null!=a&&null!=a._isAMomentObject}function t(a){return a<0?Math.ceil(a)||0:Math.floor(a)}function u(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=t(b)),c}function v(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;d<e;d++)(c&&a[d]!==b[d]||!c&&u(a[d])!==u(b[d]))&&g++;return g+f}function w(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function x(b,c){var d=!0;return k(function(){if(null!=a.deprecationHandler&&a.deprecationHandler(null,b),d){for(var e,f=[],g=0;g<arguments.length;g++){if(e="","object"==typeof arguments[g]){e+="\n["+g+"] ";for(var h in arguments[0])e+=h+": "+arguments[0][h]+", ";e=e.slice(0,-2)}else e=arguments[g];f.push(e)}w(b+"\nArguments: "+Array.prototype.slice.call(f).join("")+"\n"+(new Error).stack),d=!1}return c.apply(this,arguments)},c)}function y(b,c){null!=a.deprecationHandler&&a.deprecationHandler(b,c),xd[b]||(w(c),xd[b]=!0)}function z(a){return a instanceof Function||"[object Function]"===Object.prototype.toString.call(a)}function A(a){var b,c;for(c in a)b=a[c],z(b)?this[c]=b:this["_"+c]=b;this._config=a,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function B(a,b){var c,e=k({},a);for(c in b)j(b,c)&&(d(a[c])&&d(b[c])?(e[c]={},k(e[c],a[c]),k(e[c],b[c])):null!=b[c]?e[c]=b[c]:delete e[c]);for(c in a)j(a,c)&&!j(b,c)&&d(a[c])&&(e[c]=k({},e[c]));return e}function C(a){null!=a&&this.set(a)}function D(a,b,c){var d=this._calendar[a]||this._calendar.sameElse;return z(d)?d.call(b,c):d}function E(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function F(){return this._invalidDate}function G(a){return this._ordinal.replace("%d",a)}function H(a,b,c,d){var e=this._relativeTime[c];return z(e)?e(a,b,c,d):e.replace(/%d/i,a)}function I(a,b){var c=this._relativeTime[a>0?"future":"past"];return z(c)?c(b):c.replace(/%s/i,b)}function J(a,b){var c=a.toLowerCase();Hd[c]=Hd[c+"s"]=Hd[b]=a}function K(a){return"string"==typeof a?Hd[a]||Hd[a.toLowerCase()]:void 0}function L(a){var b,c,d={};for(c in a)j(a,c)&&(b=K(c),b&&(d[b]=a[c]));return d}function M(a,b){Id[a]=b}function N(a){var b=[];for(var c in a)b.push({unit:c,priority:Id[c]});return b.sort(function(a,b){return a.priority-b.priority}),b}function O(b,c){return function(d){return null!=d?(Q(this,b,d),a.updateOffset(this,c),this):P(this,b)}}function P(a,b){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+b]():NaN}function Q(a,b,c){a.isValid()&&a._d["set"+(a._isUTC?"UTC":"")+b](c)}function R(a){return a=K(a),z(this[a])?this[a]():this}function S(a,b){if("object"==typeof a){a=L(a);for(var c=N(a),d=0;d<c.length;d++)this[c[d].unit](a[c[d].unit])}else if(a=K(a),z(this[a]))return this[a](b);return this}function T(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function U(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Md[a]=e),b&&(Md[b[0]]=function(){return T(e.apply(this,arguments),b[1],b[2])}),c&&(Md[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function V(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function W(a){var b,c,d=a.match(Jd);for(b=0,c=d.length;b<c;b++)Md[d[b]]?d[b]=Md[d[b]]:d[b]=V(d[b]);return function(b){var e,f="";for(e=0;e<c;e++)f+=z(d[e])?d[e].call(b,a):d[e];return f}}function X(a,b){return a.isValid()?(b=Y(b,a.localeData()),Ld[b]=Ld[b]||W(b),Ld[b](a)):a.localeData().invalidDate()}function Y(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Kd.lastIndex=0;d>=0&&Kd.test(a);)a=a.replace(Kd,c),Kd.lastIndex=0,d-=1;return a}function Z(a,b,c){ce[a]=z(b)?b:function(a,d){return a&&c?c:b}}function $(a,b){return j(ce,a)?ce[a](b._strict,b._locale):new RegExp(_(a))}function _(a){return aa(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}))}function aa(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ba(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),g(b)&&(d=function(a,c){c[b]=u(a)}),c=0;c<a.length;c++)de[a[c]]=d}function ca(a,b){ba(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function da(a,b,c){null!=b&&j(de,a)&&de[a](b,c._a,c,a)}function ea(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function fa(a,b){return a?c(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||oe).test(b)?"format":"standalone"][a.month()]:c(this._months)?this._months:this._months.standalone}function ga(a,b){return a?c(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[oe.test(b)?"format":"standalone"][a.month()]:c(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function ha(a,b,c){var d,e,f,g=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],d=0;d<12;++d)f=l([2e3,d]),this._shortMonthsParse[d]=this.monthsShort(f,"").toLocaleLowerCase(),this._longMonthsParse[d]=this.months(f,"").toLocaleLowerCase();return c?"MMM"===b?(e=ne.call(this._shortMonthsParse,g),e!==-1?e:null):(e=ne.call(this._longMonthsParse,g),e!==-1?e:null):"MMM"===b?(e=ne.call(this._shortMonthsParse,g),e!==-1?e:(e=ne.call(this._longMonthsParse,g),e!==-1?e:null)):(e=ne.call(this._longMonthsParse,g),e!==-1?e:(e=ne.call(this._shortMonthsParse,g),e!==-1?e:null))}function ia(a,b,c){var d,e,f;if(this._monthsParseExact)return ha.call(this,a,b,c);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;d<12;d++){if(e=l([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function ja(a,b){var c;if(!a.isValid())return a;if("string"==typeof b)if(/^\d+$/.test(b))b=u(b);else if(b=a.localeData().monthsParse(b),!g(b))return a;return c=Math.min(a.date(),ea(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a}function ka(b){return null!=b?(ja(this,b),a.updateOffset(this,!0),this):P(this,"Month")}function la(){return ea(this.year(),this.month())}function ma(a){return this._monthsParseExact?(j(this,"_monthsRegex")||oa.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex):(j(this,"_monthsShortRegex")||(this._monthsShortRegex=re),this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex)}function na(a){return this._monthsParseExact?(j(this,"_monthsRegex")||oa.call(this),a?this._monthsStrictRegex:this._monthsRegex):(j(this,"_monthsRegex")||(this._monthsRegex=se),this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex)}function oa(){function a(a,b){return b.length-a.length}var b,c,d=[],e=[],f=[];for(b=0;b<12;b++)c=l([2e3,b]),d.push(this.monthsShort(c,"")),e.push(this.months(c,"")),f.push(this.months(c,"")),f.push(this.monthsShort(c,""));for(d.sort(a),e.sort(a),f.sort(a),b=0;b<12;b++)d[b]=aa(d[b]),e[b]=aa(e[b]);for(b=0;b<24;b++)f[b]=aa(f[b]);this._monthsRegex=new RegExp("^("+f.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+d.join("|")+")","i")}function pa(a){return qa(a)?366:365}function qa(a){return a%4===0&&a%100!==0||a%400===0}function ra(){return qa(this.year())}function sa(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return a<100&&a>=0&&isFinite(h.getFullYear())&&h.setFullYear(a),h}function ta(a){var b=new Date(Date.UTC.apply(null,arguments));return a<100&&a>=0&&isFinite(b.getUTCFullYear())&&b.setUTCFullYear(a),b}function ua(a,b,c){var d=7+b-c,e=(7+ta(a,0,d).getUTCDay()-b)%7;return-e+d-1}function va(a,b,c,d,e){var f,g,h=(7+c-d)%7,i=ua(a,d,e),j=1+7*(b-1)+h+i;return j<=0?(f=a-1,g=pa(f)+j):j>pa(a)?(f=a+1,g=j-pa(a)):(f=a,g=j),{year:f,dayOfYear:g}}function wa(a,b,c){var d,e,f=ua(a.year(),b,c),g=Math.floor((a.dayOfYear()-f-1)/7)+1;return g<1?(e=a.year()-1,d=g+xa(e,b,c)):g>xa(a.year(),b,c)?(d=g-xa(a.year(),b,c),e=a.year()+1):(e=a.year(),d=g),{week:d,year:e}}function xa(a,b,c){var d=ua(a,b,c),e=ua(a+1,b,c);return(pa(a)-d+e)/7}function ya(a){return wa(a,this._week.dow,this._week.doy).week}function za(){return this._week.dow}function Aa(){return this._week.doy}function Ba(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function Ca(a){var b=wa(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function Da(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Ea(a,b){return"string"==typeof a?b.weekdaysParse(a)%7||7:isNaN(a)?null:a}function Fa(a,b){return a?c(this._weekdays)?this._weekdays[a.day()]:this._weekdays[this._weekdays.isFormat.test(b)?"format":"standalone"][a.day()]:c(this._weekdays)?this._weekdays:this._weekdays.standalone}function Ga(a){return a?this._weekdaysShort[a.day()]:this._weekdaysShort}function Ha(a){return a?this._weekdaysMin[a.day()]:this._weekdaysMin}function Ia(a,b,c){var d,e,f,g=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],d=0;d<7;++d)f=l([2e3,1]).day(d),this._minWeekdaysParse[d]=this.weekdaysMin(f,"").toLocaleLowerCase(),this._shortWeekdaysParse[d]=this.weekdaysShort(f,"").toLocaleLowerCase(),this._weekdaysParse[d]=this.weekdays(f,"").toLocaleLowerCase();return c?"dddd"===b?(e=ne.call(this._weekdaysParse,g),e!==-1?e:null):"ddd"===b?(e=ne.call(this._shortWeekdaysParse,g),e!==-1?e:null):(e=ne.call(this._minWeekdaysParse,g),e!==-1?e:null):"dddd"===b?(e=ne.call(this._weekdaysParse,g),e!==-1?e:(e=ne.call(this._shortWeekdaysParse,g),e!==-1?e:(e=ne.call(this._minWeekdaysParse,g),e!==-1?e:null))):"ddd"===b?(e=ne.call(this._shortWeekdaysParse,g),e!==-1?e:(e=ne.call(this._weekdaysParse,g),e!==-1?e:(e=ne.call(this._minWeekdaysParse,g),e!==-1?e:null))):(e=ne.call(this._minWeekdaysParse,g),e!==-1?e:(e=ne.call(this._weekdaysParse,g),e!==-1?e:(e=ne.call(this._shortWeekdaysParse,g),e!==-1?e:null)))}function Ja(a,b,c){var d,e,f;if(this._weekdaysParseExact)return Ia.call(this,a,b,c);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),d=0;d<7;d++){if(e=l([2e3,1]).day(d),c&&!this._fullWeekdaysParse[d]&&(this._fullWeekdaysParse[d]=new RegExp("^"+this.weekdays(e,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[d]=new RegExp("^"+this.weekdaysShort(e,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[d]=new RegExp("^"+this.weekdaysMin(e,"").replace(".",".?")+"$","i")),this._weekdaysParse[d]||(f="^"+this.weekdays(e,"")+"|^"+this.weekdaysShort(e,"")+"|^"+this.weekdaysMin(e,""),this._weekdaysParse[d]=new RegExp(f.replace(".",""),"i")),c&&"dddd"===b&&this._fullWeekdaysParse[d].test(a))return d;if(c&&"ddd"===b&&this._shortWeekdaysParse[d].test(a))return d;if(c&&"dd"===b&&this._minWeekdaysParse[d].test(a))return d;if(!c&&this._weekdaysParse[d].test(a))return d}}function Ka(a){if(!this.isValid())return null!=a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Da(a,this.localeData()),this.add(a-b,"d")):b}function La(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Ma(a){if(!this.isValid())return null!=a?this:NaN;if(null!=a){var b=Ea(a,this.localeData());return this.day(this.day()%7?b:b-7)}return this.day()||7}function Na(a){return this._weekdaysParseExact?(j(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex):(j(this,"_weekdaysRegex")||(this._weekdaysRegex=ye),this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex)}function Oa(a){return this._weekdaysParseExact?(j(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(j(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=ze),this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Pa(a){return this._weekdaysParseExact?(j(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(j(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ae),this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Qa(){function a(a,b){return b.length-a.length}var b,c,d,e,f,g=[],h=[],i=[],j=[];for(b=0;b<7;b++)c=l([2e3,1]).day(b),d=this.weekdaysMin(c,""),e=this.weekdaysShort(c,""),f=this.weekdays(c,""),g.push(d),h.push(e),i.push(f),j.push(d),j.push(e),j.push(f);for(g.sort(a),h.sort(a),i.sort(a),j.sort(a),b=0;b<7;b++)h[b]=aa(h[b]),i[b]=aa(i[b]),j[b]=aa(j[b]);this._weekdaysRegex=new RegExp("^("+j.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+g.join("|")+")","i")}function Ra(){return this.hours()%12||12}function Sa(){return this.hours()||24}function Ta(a,b){U(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Ua(a,b){return b._meridiemParse}function Va(a){return"p"===(a+"").toLowerCase().charAt(0)}function Wa(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Xa(a){return a?a.toLowerCase().replace("_","-"):a}function Ya(a){for(var b,c,d,e,f=0;f<a.length;){for(e=Xa(a[f]).split("-"),b=e.length,c=Xa(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=Za(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&v(e,c,!0)>=b-1)break;b--}f++}return null}function Za(a){var b=null;if(!Fe[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Be._abbr,require("./locale/"+a),$a(b)}catch(a){}return Fe[a]}function $a(a,b){var c;return a&&(c=f(b)?bb(a):_a(a,b),c&&(Be=c)),Be._abbr}function _a(a,b){if(null!==b){var c=Ee;if(b.abbr=a,null!=Fe[a])y("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),c=Fe[a]._config;else if(null!=b.parentLocale){if(null==Fe[b.parentLocale])return Ge[b.parentLocale]||(Ge[b.parentLocale]=[]),Ge[b.parentLocale].push({name:a,config:b}),null;c=Fe[b.parentLocale]._config}return Fe[a]=new C(B(c,b)),Ge[a]&&Ge[a].forEach(function(a){_a(a.name,a.config)}),$a(a),Fe[a]}return delete Fe[a],null}function ab(a,b){if(null!=b){var c,d=Ee;null!=Fe[a]&&(d=Fe[a]._config),b=B(d,b),c=new C(b),c.parentLocale=Fe[a],Fe[a]=c,$a(a)}else null!=Fe[a]&&(null!=Fe[a].parentLocale?Fe[a]=Fe[a].parentLocale:null!=Fe[a]&&delete Fe[a]);return Fe[a]}function bb(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Be;if(!c(a)){if(b=Za(a))return b;a=[a]}return Ya(a)}function cb(){return Ad(Fe)}function db(a){var b,c=a._a;return c&&n(a).overflow===-2&&(b=c[fe]<0||c[fe]>11?fe:c[ge]<1||c[ge]>ea(c[ee],c[fe])?ge:c[he]<0||c[he]>24||24===c[he]&&(0!==c[ie]||0!==c[je]||0!==c[ke])?he:c[ie]<0||c[ie]>59?ie:c[je]<0||c[je]>59?je:c[ke]<0||c[ke]>999?ke:-1,n(a)._overflowDayOfYear&&(b<ee||b>ge)&&(b=ge),n(a)._overflowWeeks&&b===-1&&(b=le),n(a)._overflowWeekday&&b===-1&&(b=me),n(a).overflow=b),a}function eb(a){var b,c,d,e,f,g,h=a._i,i=He.exec(h)||Ie.exec(h);if(i){for(n(a).iso=!0,b=0,c=Ke.length;b<c;b++)if(Ke[b][1].exec(i[1])){e=Ke[b][0],d=Ke[b][2]!==!1;break}if(null==e)return void(a._isValid=!1);if(i[3]){for(b=0,c=Le.length;b<c;b++)if(Le[b][1].exec(i[3])){f=(i[2]||" ")+Le[b][0];break}if(null==f)return void(a._isValid=!1)}if(!d&&null!=f)return void(a._isValid=!1);if(i[4]){if(!Je.exec(i[4]))return void(a._isValid=!1);g="Z"}a._f=e+(f||"")+(g||""),lb(a)}else a._isValid=!1}function fb(a){var b,c,d,e,f,g,h,i,j={" GMT":" +0000"," EDT":" -0400"," EST":" -0500"," CDT":" -0500"," CST":" -0600"," MDT":" -0600"," MST":" -0700"," PDT":" -0700"," PST":" -0800"},k="YXWVUTSRQPONZABCDEFGHIKLM";if(b=a._i.replace(/\([^\)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s|\s$/g,""),c=Ne.exec(b)){if(d=c[1]?"ddd"+(5===c[1].length?", ":" "):"",e="D MMM "+(c[2].length>10?"YYYY ":"YY "),f="HH:mm"+(c[4]?":ss":""),c[1]){var l=new Date(c[2]),m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][l.getDay()];if(c[1].substr(0,3)!==m)return n(a).weekdayMismatch=!0,void(a._isValid=!1)}switch(c[5].length){case 2:0===i?h=" +0000":(i=k.indexOf(c[5][1].toUpperCase())-12,h=(i<0?" -":" +")+(""+i).replace(/^-?/,"0").match(/..$/)[0]+"00");break;case 4:h=j[c[5]];break;default:h=j[" GMT"]}c[5]=h,a._i=c.splice(1).join(""),g=" ZZ",a._f=d+e+f+g,lb(a),n(a).rfc2822=!0}else a._isValid=!1}function gb(b){var c=Me.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(eb(b),void(b._isValid===!1&&(delete b._isValid,fb(b),b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b)))))}function hb(a,b,c){return null!=a?a:null!=b?b:c}function ib(b){var c=new Date(a.now());return b._useUTC?[c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]:[c.getFullYear(),c.getMonth(),c.getDate()]}function jb(a){var b,c,d,e,f=[];if(!a._d){for(d=ib(a),a._w&&null==a._a[ge]&&null==a._a[fe]&&kb(a),null!=a._dayOfYear&&(e=hb(a._a[ee],d[ee]),(a._dayOfYear>pa(e)||0===a._dayOfYear)&&(n(a)._overflowDayOfYear=!0),c=ta(e,0,a._dayOfYear),a._a[fe]=c.getUTCMonth(),a._a[ge]=c.getUTCDate()),b=0;b<3&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;b<7;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[he]&&0===a._a[ie]&&0===a._a[je]&&0===a._a[ke]&&(a._nextDay=!0,a._a[he]=0),a._d=(a._useUTC?ta:sa).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[he]=24)}}function kb(a){var b,c,d,e,f,g,h,i;if(b=a._w,null!=b.GG||null!=b.W||null!=b.E)f=1,g=4,c=hb(b.GG,a._a[ee],wa(tb(),1,4).year),d=hb(b.W,1),e=hb(b.E,1),(e<1||e>7)&&(i=!0);else{f=a._locale._week.dow,g=a._locale._week.doy;var j=wa(tb(),f,g);c=hb(b.gg,a._a[ee],j.year),d=hb(b.w,j.week),null!=b.d?(e=b.d,(e<0||e>6)&&(i=!0)):null!=b.e?(e=b.e+f,(b.e<0||b.e>6)&&(i=!0)):e=f}d<1||d>xa(c,f,g)?n(a)._overflowWeeks=!0:null!=i?n(a)._overflowWeekday=!0:(h=va(c,d,e,f,g),a._a[ee]=h.year,a._dayOfYear=h.dayOfYear)}function lb(b){if(b._f===a.ISO_8601)return void eb(b);if(b._f===a.RFC_2822)return void fb(b);b._a=[],n(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,j=0;for(e=Y(b._f,b._locale).match(Jd)||[],c=0;c<e.length;c++)f=e[c],d=(h.match($(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&n(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),Md[f]?(d?n(b).empty=!1:n(b).unusedTokens.push(f),da(f,d,b)):b._strict&&!d&&n(b).unusedTokens.push(f);n(b).charsLeftOver=i-j,h.length>0&&n(b).unusedInput.push(h),b._a[he]<=12&&n(b).bigHour===!0&&b._a[he]>0&&(n(b).bigHour=void 0),n(b).parsedDateParts=b._a.slice(0),n(b).meridiem=b._meridiem,b._a[he]=mb(b._locale,b._a[he],b._meridiem),jb(b),db(b)}function mb(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&b<12&&(b+=12),d||12!==b||(b=0),b):b}function nb(a){var b,c,d,e,f;if(0===a._f.length)return n(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=q({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],lb(b),o(b)&&(f+=n(b).charsLeftOver,f+=10*n(b).unusedTokens.length,n(b).score=f,(null==d||f<d)&&(d=f,c=b));k(a,c||b)}function ob(a){if(!a._d){var b=L(a._i);a._a=i([b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],function(a){return a&&parseInt(a,10)}),jb(a)}}function pb(a){var b=new r(db(qb(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function qb(a){var b=a._i,d=a._f;return a._locale=a._locale||bb(a._l),null===b||void 0===d&&""===b?p({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),s(b)?new r(db(b)):(h(b)?a._d=b:c(d)?nb(a):d?lb(a):rb(a),o(a)||(a._d=null),a))}function rb(b){var e=b._i;f(e)?b._d=new Date(a.now()):h(e)?b._d=new Date(e.valueOf()):"string"==typeof e?gb(b):c(e)?(b._a=i(e.slice(0),function(a){return parseInt(a,10)}),jb(b)):d(e)?ob(b):g(e)?b._d=new Date(e):a.createFromInputFallback(b)}function sb(a,b,f,g,h){var i={};return f!==!0&&f!==!1||(g=f,f=void 0),(d(a)&&e(a)||c(a)&&0===a.length)&&(a=void 0),i._isAMomentObject=!0,i._useUTC=i._isUTC=h,i._l=f,i._i=a,i._f=b,i._strict=g,pb(i)}function tb(a,b,c,d){return sb(a,b,c,d,!1)}function ub(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return tb();for(d=b[0],e=1;e<b.length;++e)b[e].isValid()&&!b[e][a](d)||(d=b[e]);return d}function vb(){var a=[].slice.call(arguments,0);return ub("isBefore",a)}function wb(){var a=[].slice.call(arguments,0);return ub("isAfter",a)}function xb(a){for(var b in a)if(Re.indexOf(b)===-1||null!=a[b]&&isNaN(a[b]))return!1;for(var c=!1,d=0;d<Re.length;++d)if(a[Re[d]]){if(c)return!1;parseFloat(a[Re[d]])!==u(a[Re[d]])&&(c=!0)}return!0}function yb(){return this._isValid}function zb(){return Sb(NaN)}function Ab(a){var b=L(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._isValid=xb(b),this._milliseconds=+k+1e3*j+6e4*i+1e3*h*60*60,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=bb(),this._bubble()}function Bb(a){return a instanceof Ab}function Cb(a){return a<0?Math.round(-1*a)*-1:Math.round(a)}function Db(a,b){U(a,0,0,function(){var a=this.utcOffset(),c="+";return a<0&&(a=-a,c="-"),c+T(~~(a/60),2)+b+T(~~a%60,2)})}function Eb(a,b){var c=(b||"").match(a);if(null===c)return null;var d=c[c.length-1]||[],e=(d+"").match(Se)||["-",0,0],f=+(60*e[1])+u(e[2]);return 0===f?0:"+"===e[0]?f:-f}function Fb(b,c){var d,e;return c._isUTC?(d=c.clone(),e=(s(b)||h(b)?b.valueOf():tb(b).valueOf())-d.valueOf(),d._d.setTime(d._d.valueOf()+e),a.updateOffset(d,!1),d):tb(b).local()}function Gb(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Hb(b,c,d){var e,f=this._offset||0;if(!this.isValid())return null!=b?this:NaN;if(null!=b){if("string"==typeof b){if(b=Eb(_d,b),null===b)return this}else Math.abs(b)<16&&!d&&(b=60*b);return!this._isUTC&&c&&(e=Gb(this)),this._offset=b,this._isUTC=!0,null!=e&&this.add(e,"m"),f!==b&&(!c||this._changeInProgress?Xb(this,Sb(b-f,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?f:Gb(this)}function Ib(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Jb(a){return this.utcOffset(0,a)}function Kb(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Gb(this),"m")),this}function Lb(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var a=Eb($d,this._i);null!=a?this.utcOffset(a):this.utcOffset(0,!0)}return this}function Mb(a){return!!this.isValid()&&(a=a?tb(a).utcOffset():0,(this.utcOffset()-a)%60===0)}function Nb(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ob(){if(!f(this._isDSTShifted))return this._isDSTShifted;var a={};if(q(a,this),a=qb(a),a._a){var b=a._isUTC?l(a._a):tb(a._a);this._isDSTShifted=this.isValid()&&v(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Pb(){return!!this.isValid()&&!this._isUTC}function Qb(){return!!this.isValid()&&this._isUTC}function Rb(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function Sb(a,b){var c,d,e,f=a,h=null;return Bb(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:g(a)?(f={},b?f[b]=a:f.milliseconds=a):(h=Te.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:u(h[ge])*c,h:u(h[he])*c,m:u(h[ie])*c,s:u(h[je])*c,ms:u(Cb(1e3*h[ke]))*c}):(h=Ue.exec(a))?(c="-"===h[1]?-1:1,f={y:Tb(h[2],c),M:Tb(h[3],c),w:Tb(h[4],c),d:Tb(h[5],c),h:Tb(h[6],c),m:Tb(h[7],c),s:Tb(h[8],c)}):null==f?f={}:"object"==typeof f&&("from"in f||"to"in f)&&(e=Vb(tb(f.from),tb(f.to)),f={},f.ms=e.milliseconds,f.M=e.months),d=new Ab(f),Bb(a)&&j(a,"_locale")&&(d._locale=a._locale),d}function Tb(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function Ub(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function Vb(a,b){var c;return a.isValid()&&b.isValid()?(b=Fb(b,a),a.isBefore(b)?c=Ub(a,b):(c=Ub(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0}}function Wb(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(y(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Sb(c,d),Xb(this,e,a),this}}function Xb(b,c,d,e){var f=c._milliseconds,g=Cb(c._days),h=Cb(c._months);b.isValid()&&(e=null==e||e,f&&b._d.setTime(b._d.valueOf()+f*d),g&&Q(b,"Date",P(b,"Date")+g*d),h&&ja(b,P(b,"Month")+h*d),e&&a.updateOffset(b,g||h))}function Yb(a,b){var c=a.diff(b,"days",!0);return c<-6?"sameElse":c<-1?"lastWeek":c<0?"lastDay":c<1?"sameDay":c<2?"nextDay":c<7?"nextWeek":"sameElse"}function Zb(b,c){var d=b||tb(),e=Fb(d,this).startOf("day"),f=a.calendarFormat(this,e)||"sameElse",g=c&&(z(c[f])?c[f].call(this,d):c[f]);return this.format(g||this.localeData().calendar(f,this,tb(d)))}function $b(){return new r(this)}function _b(a,b){var c=s(a)?a:tb(a);return!(!this.isValid()||!c.isValid())&&(b=K(f(b)?"millisecond":b),"millisecond"===b?this.valueOf()>c.valueOf():c.valueOf()<this.clone().startOf(b).valueOf())}function ac(a,b){var c=s(a)?a:tb(a);return!(!this.isValid()||!c.isValid())&&(b=K(f(b)?"millisecond":b),"millisecond"===b?this.valueOf()<c.valueOf():this.clone().endOf(b).valueOf()<c.valueOf())}function bc(a,b,c,d){return d=d||"()",("("===d[0]?this.isAfter(a,c):!this.isBefore(a,c))&&(")"===d[1]?this.isBefore(b,c):!this.isAfter(b,c))}function cc(a,b){var c,d=s(a)?a:tb(a);return!(!this.isValid()||!d.isValid())&&(b=K(b||"millisecond"),"millisecond"===b?this.valueOf()===d.valueOf():(c=d.valueOf(),this.clone().startOf(b).valueOf()<=c&&c<=this.clone().endOf(b).valueOf()))}function dc(a,b){return this.isSame(a,b)||this.isAfter(a,b)}function ec(a,b){return this.isSame(a,b)||this.isBefore(a,b)}function fc(a,b,c){var d,e,f,g;return this.isValid()?(d=Fb(a,this),d.isValid()?(e=6e4*(d.utcOffset()-this.utcOffset()),b=K(b),"year"===b||"month"===b||"quarter"===b?(g=gc(this,d),"quarter"===b?g/=3:"year"===b&&(g/=12)):(f=this-d,g="second"===b?f/1e3:"minute"===b?f/6e4:"hour"===b?f/36e5:"day"===b?(f-e)/864e5:"week"===b?(f-e)/6048e5:f),c?g:t(g)):NaN):NaN}function gc(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return b-f<0?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)||0}function hc(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ic(){if(!this.isValid())return null;var a=this.clone().utc();return a.year()<0||a.year()>9999?X(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):z(Date.prototype.toISOString)?this.toDate().toISOString():X(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function jc(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a="moment",b="";this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",b="Z");var c="["+a+'("]',d=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",e="-MM-DD[T]HH:mm:ss.SSS",f=b+'[")]';return this.format(c+d+e+f)}function kc(b){b||(b=this.isUtc()?a.defaultFormatUtc:a.defaultFormat);var c=X(this,b);return this.localeData().postformat(c)}function lc(a,b){return this.isValid()&&(s(a)&&a.isValid()||tb(a).isValid())?Sb({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function mc(a){return this.from(tb(),a)}function nc(a,b){return this.isValid()&&(s(a)&&a.isValid()||tb(a).isValid())?Sb({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function oc(a){return this.to(tb(),a)}function pc(a){var b;return void 0===a?this._locale._abbr:(b=bb(a),null!=b&&(this._locale=b),this)}function qc(){return this._locale}function rc(a){switch(a=K(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function sc(a){return a=K(a),void 0===a||"millisecond"===a?this:("date"===a&&(a="day"),this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms"))}function tc(){return this._d.valueOf()-6e4*(this._offset||0)}function uc(){return Math.floor(this.valueOf()/1e3)}function vc(){return new Date(this.valueOf())}function wc(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function xc(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function yc(){return this.isValid()?this.toISOString():null}function zc(){return o(this)}function Ac(){
return k({},n(this))}function Bc(){return n(this).overflow}function Cc(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Dc(a,b){U(0,[a,a.length],0,b)}function Ec(a){return Ic.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Fc(a){return Ic.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)}function Gc(){return xa(this.year(),1,4)}function Hc(){var a=this.localeData()._week;return xa(this.year(),a.dow,a.doy)}function Ic(a,b,c,d,e){var f;return null==a?wa(this,d,e).year:(f=xa(a,d,e),b>f&&(b=f),Jc.call(this,a,b,c,d,e))}function Jc(a,b,c,d,e){var f=va(a,b,c,d,e),g=ta(f.year,0,f.dayOfYear);return this.year(g.getUTCFullYear()),this.month(g.getUTCMonth()),this.date(g.getUTCDate()),this}function Kc(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Lc(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function Mc(a,b){b[ke]=u(1e3*("0."+a))}function Nc(){return this._isUTC?"UTC":""}function Oc(){return this._isUTC?"Coordinated Universal Time":""}function Pc(a){return tb(1e3*a)}function Qc(){return tb.apply(null,arguments).parseZone()}function Rc(a){return a}function Sc(a,b,c,d){var e=bb(),f=l().set(d,b);return e[c](f,a)}function Tc(a,b,c){if(g(a)&&(b=a,a=void 0),a=a||"",null!=b)return Sc(a,b,c,"month");var d,e=[];for(d=0;d<12;d++)e[d]=Sc(a,d,c,"month");return e}function Uc(a,b,c,d){"boolean"==typeof a?(g(b)&&(c=b,b=void 0),b=b||""):(b=a,c=b,a=!1,g(b)&&(c=b,b=void 0),b=b||"");var e=bb(),f=a?e._week.dow:0;if(null!=c)return Sc(b,(c+f)%7,d,"day");var h,i=[];for(h=0;h<7;h++)i[h]=Sc(b,(h+f)%7,d,"day");return i}function Vc(a,b){return Tc(a,b,"months")}function Wc(a,b){return Tc(a,b,"monthsShort")}function Xc(a,b,c){return Uc(a,b,c,"weekdays")}function Yc(a,b,c){return Uc(a,b,c,"weekdaysShort")}function Zc(a,b,c){return Uc(a,b,c,"weekdaysMin")}function $c(){var a=this._data;return this._milliseconds=df(this._milliseconds),this._days=df(this._days),this._months=df(this._months),a.milliseconds=df(a.milliseconds),a.seconds=df(a.seconds),a.minutes=df(a.minutes),a.hours=df(a.hours),a.months=df(a.months),a.years=df(a.years),this}function _c(a,b,c,d){var e=Sb(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function ad(a,b){return _c(this,a,b,1)}function bd(a,b){return _c(this,a,b,-1)}function cd(a){return a<0?Math.floor(a):Math.ceil(a)}function dd(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||f<=0&&g<=0&&h<=0||(f+=864e5*cd(fd(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=t(f/1e3),i.seconds=a%60,b=t(a/60),i.minutes=b%60,c=t(b/60),i.hours=c%24,g+=t(c/24),e=t(ed(g)),h+=e,g-=cd(fd(e)),d=t(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function ed(a){return 4800*a/146097}function fd(a){return 146097*a/4800}function gd(a){if(!this.isValid())return NaN;var b,c,d=this._milliseconds;if(a=K(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+ed(b),"month"===a?c:c/12;switch(b=this._days+Math.round(fd(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function hd(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*u(this._months/12):NaN}function id(a){return function(){return this.as(a)}}function jd(a){return a=K(a),this.isValid()?this[a+"s"]():NaN}function kd(a){return function(){return this.isValid()?this._data[a]:NaN}}function ld(){return t(this.days()/7)}function md(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function nd(a,b,c){var d=Sb(a).abs(),e=uf(d.as("s")),f=uf(d.as("m")),g=uf(d.as("h")),h=uf(d.as("d")),i=uf(d.as("M")),j=uf(d.as("y")),k=e<=vf.ss&&["s",e]||e<vf.s&&["ss",e]||f<=1&&["m"]||f<vf.m&&["mm",f]||g<=1&&["h"]||g<vf.h&&["hh",g]||h<=1&&["d"]||h<vf.d&&["dd",h]||i<=1&&["M"]||i<vf.M&&["MM",i]||j<=1&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,md.apply(null,k)}function od(a){return void 0===a?uf:"function"==typeof a&&(uf=a,!0)}function pd(a,b){return void 0!==vf[a]&&(void 0===b?vf[a]:(vf[a]=b,"s"===a&&(vf.ss=b-1),!0))}function qd(a){if(!this.isValid())return this.localeData().invalidDate();var b=this.localeData(),c=nd(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function rd(){if(!this.isValid())return this.localeData().invalidDate();var a,b,c,d=wf(this._milliseconds)/1e3,e=wf(this._days),f=wf(this._months);a=t(d/60),b=t(a/60),d%=60,a%=60,c=t(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(m<0?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var sd,td;td=Array.prototype.some?Array.prototype.some:function(a){for(var b=Object(this),c=b.length>>>0,d=0;d<c;d++)if(d in b&&a.call(this,b[d],d,b))return!0;return!1};var ud=td,vd=a.momentProperties=[],wd=!1,xd={};a.suppressDeprecationWarnings=!1,a.deprecationHandler=null;var yd;yd=Object.keys?Object.keys:function(a){var b,c=[];for(b in a)j(a,b)&&c.push(b);return c};var zd,Ad=yd,Bd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Cd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Dd="Invalid date",Ed="%d",Fd=/\d{1,2}/,Gd={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Hd={},Id={},Jd=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Kd=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ld={},Md={},Nd=/\d/,Od=/\d\d/,Pd=/\d{3}/,Qd=/\d{4}/,Rd=/[+-]?\d{6}/,Sd=/\d\d?/,Td=/\d\d\d\d?/,Ud=/\d\d\d\d\d\d?/,Vd=/\d{1,3}/,Wd=/\d{1,4}/,Xd=/[+-]?\d{1,6}/,Yd=/\d+/,Zd=/[+-]?\d+/,$d=/Z|[+-]\d\d:?\d\d/gi,_d=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[+-]?\d+(\.\d{1,3})?/,be=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,ce={},de={},ee=0,fe=1,ge=2,he=3,ie=4,je=5,ke=6,le=7,me=8;zd=Array.prototype.indexOf?Array.prototype.indexOf:function(a){var b;for(b=0;b<this.length;++b)if(this[b]===a)return b;return-1};var ne=zd;U("M",["MM",2],"Mo",function(){return this.month()+1}),U("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),U("MMMM",0,0,function(a){return this.localeData().months(this,a)}),J("month","M"),M("month",8),Z("M",Sd),Z("MM",Sd,Od),Z("MMM",function(a,b){return b.monthsShortRegex(a)}),Z("MMMM",function(a,b){return b.monthsRegex(a)}),ba(["M","MM"],function(a,b){b[fe]=u(a)-1}),ba(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[fe]=e:n(c).invalidMonth=a});var oe=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,pe="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),qe="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),re=be,se=be;U("Y",0,0,function(){var a=this.year();return a<=9999?""+a:"+"+a}),U(0,["YY",2],0,function(){return this.year()%100}),U(0,["YYYY",4],0,"year"),U(0,["YYYYY",5],0,"year"),U(0,["YYYYYY",6,!0],0,"year"),J("year","y"),M("year",1),Z("Y",Zd),Z("YY",Sd,Od),Z("YYYY",Wd,Qd),Z("YYYYY",Xd,Rd),Z("YYYYYY",Xd,Rd),ba(["YYYYY","YYYYYY"],ee),ba("YYYY",function(b,c){c[ee]=2===b.length?a.parseTwoDigitYear(b):u(b)}),ba("YY",function(b,c){c[ee]=a.parseTwoDigitYear(b)}),ba("Y",function(a,b){b[ee]=parseInt(a,10)}),a.parseTwoDigitYear=function(a){return u(a)+(u(a)>68?1900:2e3)};var te=O("FullYear",!0);U("w",["ww",2],"wo","week"),U("W",["WW",2],"Wo","isoWeek"),J("week","w"),J("isoWeek","W"),M("week",5),M("isoWeek",5),Z("w",Sd),Z("ww",Sd,Od),Z("W",Sd),Z("WW",Sd,Od),ca(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=u(a)});var ue={dow:0,doy:6};U("d",0,"do","day"),U("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),U("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),U("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),U("e",0,0,"weekday"),U("E",0,0,"isoWeekday"),J("day","d"),J("weekday","e"),J("isoWeekday","E"),M("day",11),M("weekday",11),M("isoWeekday",11),Z("d",Sd),Z("e",Sd),Z("E",Sd),Z("dd",function(a,b){return b.weekdaysMinRegex(a)}),Z("ddd",function(a,b){return b.weekdaysShortRegex(a)}),Z("dddd",function(a,b){return b.weekdaysRegex(a)}),ca(["dd","ddd","dddd"],function(a,b,c,d){var e=c._locale.weekdaysParse(a,d,c._strict);null!=e?b.d=e:n(c).invalidWeekday=a}),ca(["d","e","E"],function(a,b,c,d){b[d]=u(a)});var ve="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),we="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),xe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),ye=be,ze=be,Ae=be;U("H",["HH",2],0,"hour"),U("h",["hh",2],0,Ra),U("k",["kk",2],0,Sa),U("hmm",0,0,function(){return""+Ra.apply(this)+T(this.minutes(),2)}),U("hmmss",0,0,function(){return""+Ra.apply(this)+T(this.minutes(),2)+T(this.seconds(),2)}),U("Hmm",0,0,function(){return""+this.hours()+T(this.minutes(),2)}),U("Hmmss",0,0,function(){return""+this.hours()+T(this.minutes(),2)+T(this.seconds(),2)}),Ta("a",!0),Ta("A",!1),J("hour","h"),M("hour",13),Z("a",Ua),Z("A",Ua),Z("H",Sd),Z("h",Sd),Z("k",Sd),Z("HH",Sd,Od),Z("hh",Sd,Od),Z("kk",Sd,Od),Z("hmm",Td),Z("hmmss",Ud),Z("Hmm",Td),Z("Hmmss",Ud),ba(["H","HH"],he),ba(["k","kk"],function(a,b,c){var d=u(a);b[he]=24===d?0:d}),ba(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),ba(["h","hh"],function(a,b,c){b[he]=u(a),n(c).bigHour=!0}),ba("hmm",function(a,b,c){var d=a.length-2;b[he]=u(a.substr(0,d)),b[ie]=u(a.substr(d)),n(c).bigHour=!0}),ba("hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[he]=u(a.substr(0,d)),b[ie]=u(a.substr(d,2)),b[je]=u(a.substr(e)),n(c).bigHour=!0}),ba("Hmm",function(a,b,c){var d=a.length-2;b[he]=u(a.substr(0,d)),b[ie]=u(a.substr(d))}),ba("Hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[he]=u(a.substr(0,d)),b[ie]=u(a.substr(d,2)),b[je]=u(a.substr(e))});var Be,Ce=/[ap]\.?m?\.?/i,De=O("Hours",!0),Ee={calendar:Bd,longDateFormat:Cd,invalidDate:Dd,ordinal:Ed,dayOfMonthOrdinalParse:Fd,relativeTime:Gd,months:pe,monthsShort:qe,week:ue,weekdays:ve,weekdaysMin:xe,weekdaysShort:we,meridiemParse:Ce},Fe={},Ge={},He=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ie=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Je=/Z|[+-]\d\d(?::?\d\d)?/,Ke=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Le=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Me=/^\/?Date\((\-?\d+)/i,Ne=/^((?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d?\d\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(?:\d\d)?\d\d\s)(\d\d:\d\d)(\:\d\d)?(\s(?:UT|GMT|[ECMP][SD]T|[A-IK-Za-ik-z]|[+-]\d{4}))$/;a.createFromInputFallback=x("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),a.ISO_8601=function(){},a.RFC_2822=function(){};var Oe=x("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=tb.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:p()}),Pe=x("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=tb.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:p()}),Qe=function(){return Date.now?Date.now():+new Date},Re=["year","quarter","month","week","day","hour","minute","second","millisecond"];Db("Z",":"),Db("ZZ",""),Z("Z",_d),Z("ZZ",_d),ba(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Eb(_d,a)});var Se=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var Te=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Ue=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;Sb.fn=Ab.prototype,Sb.invalid=zb;var Ve=Wb(1,"add"),We=Wb(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",a.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xe=x("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});U(0,["gg",2],0,function(){return this.weekYear()%100}),U(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Dc("gggg","weekYear"),Dc("ggggg","weekYear"),Dc("GGGG","isoWeekYear"),Dc("GGGGG","isoWeekYear"),J("weekYear","gg"),J("isoWeekYear","GG"),M("weekYear",1),M("isoWeekYear",1),Z("G",Zd),Z("g",Zd),Z("GG",Sd,Od),Z("gg",Sd,Od),Z("GGGG",Wd,Qd),Z("gggg",Wd,Qd),Z("GGGGG",Xd,Rd),Z("ggggg",Xd,Rd),ca(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=u(a)}),ca(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),U("Q",0,"Qo","quarter"),J("quarter","Q"),M("quarter",7),Z("Q",Nd),ba("Q",function(a,b){b[fe]=3*(u(a)-1)}),U("D",["DD",2],"Do","date"),J("date","D"),M("date",9),Z("D",Sd),Z("DD",Sd,Od),Z("Do",function(a,b){return a?b._dayOfMonthOrdinalParse||b._ordinalParse:b._dayOfMonthOrdinalParseLenient}),ba(["D","DD"],ge),ba("Do",function(a,b){b[ge]=u(a.match(Sd)[0],10)});var Ye=O("Date",!0);U("DDD",["DDDD",3],"DDDo","dayOfYear"),J("dayOfYear","DDD"),M("dayOfYear",4),Z("DDD",Vd),Z("DDDD",Pd),ba(["DDD","DDDD"],function(a,b,c){c._dayOfYear=u(a)}),U("m",["mm",2],0,"minute"),J("minute","m"),M("minute",14),Z("m",Sd),Z("mm",Sd,Od),ba(["m","mm"],ie);var Ze=O("Minutes",!1);U("s",["ss",2],0,"second"),J("second","s"),M("second",15),Z("s",Sd),Z("ss",Sd,Od),ba(["s","ss"],je);var $e=O("Seconds",!1);U("S",0,0,function(){return~~(this.millisecond()/100)}),U(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),U(0,["SSS",3],0,"millisecond"),U(0,["SSSS",4],0,function(){return 10*this.millisecond()}),U(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),U(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),U(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),U(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),U(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),J("millisecond","ms"),M("millisecond",16),Z("S",Vd,Nd),Z("SS",Vd,Od),Z("SSS",Vd,Pd);var _e;for(_e="SSSS";_e.length<=9;_e+="S")Z(_e,Yd);for(_e="S";_e.length<=9;_e+="S")ba(_e,Mc);var af=O("Milliseconds",!1);U("z",0,0,"zoneAbbr"),U("zz",0,0,"zoneName");var bf=r.prototype;bf.add=Ve,bf.calendar=Zb,bf.clone=$b,bf.diff=fc,bf.endOf=sc,bf.format=kc,bf.from=lc,bf.fromNow=mc,bf.to=nc,bf.toNow=oc,bf.get=R,bf.invalidAt=Bc,bf.isAfter=_b,bf.isBefore=ac,bf.isBetween=bc,bf.isSame=cc,bf.isSameOrAfter=dc,bf.isSameOrBefore=ec,bf.isValid=zc,bf.lang=Xe,bf.locale=pc,bf.localeData=qc,bf.max=Pe,bf.min=Oe,bf.parsingFlags=Ac,bf.set=S,bf.startOf=rc,bf.subtract=We,bf.toArray=wc,bf.toObject=xc,bf.toDate=vc,bf.toISOString=ic,bf.inspect=jc,bf.toJSON=yc,bf.toString=hc,bf.unix=uc,bf.valueOf=tc,bf.creationData=Cc,bf.year=te,bf.isLeapYear=ra,bf.weekYear=Ec,bf.isoWeekYear=Fc,bf.quarter=bf.quarters=Kc,bf.month=ka,bf.daysInMonth=la,bf.week=bf.weeks=Ba,bf.isoWeek=bf.isoWeeks=Ca,bf.weeksInYear=Hc,bf.isoWeeksInYear=Gc,bf.date=Ye,bf.day=bf.days=Ka,bf.weekday=La,bf.isoWeekday=Ma,bf.dayOfYear=Lc,bf.hour=bf.hours=De,bf.minute=bf.minutes=Ze,bf.second=bf.seconds=$e,bf.millisecond=bf.milliseconds=af,bf.utcOffset=Hb,bf.utc=Jb,bf.local=Kb,bf.parseZone=Lb,bf.hasAlignedHourOffset=Mb,bf.isDST=Nb,bf.isLocal=Pb,bf.isUtcOffset=Qb,bf.isUtc=Rb,bf.isUTC=Rb,bf.zoneAbbr=Nc,bf.zoneName=Oc,bf.dates=x("dates accessor is deprecated. Use date instead.",Ye),bf.months=x("months accessor is deprecated. Use month instead",ka),bf.years=x("years accessor is deprecated. Use year instead",te),bf.zone=x("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Ib),bf.isDSTShifted=x("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Ob);var cf=C.prototype;cf.calendar=D,cf.longDateFormat=E,cf.invalidDate=F,cf.ordinal=G,cf.preparse=Rc,cf.postformat=Rc,cf.relativeTime=H,cf.pastFuture=I,cf.set=A,cf.months=fa,cf.monthsShort=ga,cf.monthsParse=ia,cf.monthsRegex=na,cf.monthsShortRegex=ma,cf.week=ya,cf.firstDayOfYear=Aa,cf.firstDayOfWeek=za,cf.weekdays=Fa,cf.weekdaysMin=Ha,cf.weekdaysShort=Ga,cf.weekdaysParse=Ja,cf.weekdaysRegex=Na,cf.weekdaysShortRegex=Oa,cf.weekdaysMinRegex=Pa,cf.isPM=Va,cf.meridiem=Wa,$a("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===u(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=x("moment.lang is deprecated. Use moment.locale instead.",$a),a.langData=x("moment.langData is deprecated. Use moment.localeData instead.",bb);var df=Math.abs,ef=id("ms"),ff=id("s"),gf=id("m"),hf=id("h"),jf=id("d"),kf=id("w"),lf=id("M"),mf=id("y"),nf=kd("milliseconds"),of=kd("seconds"),pf=kd("minutes"),qf=kd("hours"),rf=kd("days"),sf=kd("months"),tf=kd("years"),uf=Math.round,vf={ss:44,s:45,m:45,h:22,d:26,M:11},wf=Math.abs,xf=Ab.prototype;return xf.isValid=yb,xf.abs=$c,xf.add=ad,xf.subtract=bd,xf.as=gd,xf.asMilliseconds=ef,xf.asSeconds=ff,xf.asMinutes=gf,xf.asHours=hf,xf.asDays=jf,xf.asWeeks=kf,xf.asMonths=lf,xf.asYears=mf,xf.valueOf=hd,xf._bubble=dd,xf.get=jd,xf.milliseconds=nf,xf.seconds=of,xf.minutes=pf,xf.hours=qf,xf.days=rf,xf.weeks=ld,xf.months=sf,xf.years=tf,xf.humanize=qd,xf.toISOString=rd,xf.toString=rd,xf.toJSON=rd,xf.locale=pc,xf.localeData=qc,xf.toIsoString=x("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",rd),xf.lang=Xe,U("X",0,0,"unix"),U("x",0,0,"valueOf"),Z("x",Zd),Z("X",ae),ba("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),ba("x",function(a,b,c){c._d=new Date(u(a))}),a.version="2.18.1",b(tb),a.fn=bf,a.min=vb,a.max=wb,a.now=Qe,a.utc=l,a.unix=Pc,a.months=Vc,a.isDate=h,a.locale=$a,a.invalid=p,a.duration=Sb,a.isMoment=s,a.weekdays=Xc,a.parseZone=Qc,a.localeData=bb,a.isDuration=Bb,a.monthsShort=Wc,a.weekdaysMin=Zc,a.defineLocale=_a,a.updateLocale=ab,a.locales=cb,a.weekdaysShort=Yc,a.normalizeUnits=K,a.relativeTimeRounding=od,a.relativeTimeThreshold=pd,a.calendarFormat=Yb,a.prototype=bf,a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:chart-view', location = 'assets/core/charts/chart.js' */
/*!
 * Chart.js
 * http://chartjs.org/
 * Version: 2.6.0
 *
 * Copyright 2017 Nick Downie
 * Released under the MIT license
 * https://github.com/chartjs/Chart.js/blob/master/LICENSE.md
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Chart=t()}}(function(){return function t(e,n,i){function a(r,l){if(!n[r]){if(!e[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[r]={exports:{}};e[r][0].call(d.exports,function(t){var n=e[r][1][t];return a(n?n:t)},d,d.exports,t,e,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(t,e,n){},{}],2:[function(t,e,n){function i(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,n=/^#([a-fA-F0-9]{6})$/,i=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/(\w+)/,r=[0,0,0],l=1,s=t.match(e);if(s){s=s[1];for(var u=0;u<r.length;u++)r[u]=parseInt(s[u]+s[u],16)}else if(s=t.match(n)){s=s[1];for(var u=0;u<r.length;u++)r[u]=parseInt(s.slice(2*u,2*u+2),16)}else if(s=t.match(i)){for(var u=0;u<r.length;u++)r[u]=parseInt(s[u+1]);l=parseFloat(s[4])}else if(s=t.match(a)){for(var u=0;u<r.length;u++)r[u]=Math.round(2.55*parseFloat(s[u+1]));l=parseFloat(s[4])}else if(s=t.match(o)){if("transparent"==s[1])return[0,0,0,0];if(r=y[s[1]],!r)return}for(var u=0;u<r.length;u++)r[u]=b(r[u],0,255);return l=l||0==l?b(l,0,1):1,r[3]=l,r}}function a(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,n=t.match(e);if(n){var i=parseFloat(n[4]),a=b(parseInt(n[1]),0,360),o=b(parseFloat(n[2]),0,100),r=b(parseFloat(n[3]),0,100),l=b(isNaN(i)?1:i,0,1);return[a,o,r,l]}}}function o(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,n=t.match(e);if(n){var i=parseFloat(n[4]),a=b(parseInt(n[1]),0,360),o=b(parseFloat(n[2]),0,100),r=b(parseFloat(n[3]),0,100),l=b(isNaN(i)?1:i,0,1);return[a,o,r,l]}}}function r(t){var e=i(t);return e&&e.slice(0,3)}function l(t){var e=a(t);return e&&e.slice(0,3)}function s(t){var e=i(t);return e?e[3]:(e=a(t))?e[3]:(e=o(t))?e[3]:void 0}function u(t){return"#"+x(t[0])+x(t[1])+x(t[2])}function d(t,e){return e<1||t[3]&&t[3]<1?c(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function c(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function h(t,e){if(e<1||t[3]&&t[3]<1)return f(t,e);var n=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgb("+n+"%, "+i+"%, "+a+"%)"}function f(t,e){var n=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgba("+n+"%, "+i+"%, "+a+"%, "+(e||t[3]||1)+")"}function g(t,e){return e<1||t[3]&&t[3]<1?p(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function p(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function m(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function v(t){return k[t.slice(0,3)]}function b(t,e,n){return Math.min(Math.max(e,t),n)}function x(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var y=t(6);e.exports={getRgba:i,getHsla:a,getRgb:r,getHsl:l,getHwb:o,getAlpha:s,hexString:u,rgbString:d,rgbaString:c,percentString:h,percentaString:f,hslString:g,hslaString:p,hwbString:m,keyword:v};var k={};for(var w in y)k[y[w]]=w},{6:6}],3:[function(t,e,n){var i=t(5),a=t(2),o=function(t){if(t instanceof o)return t;if(!(this instanceof o))return new o(t);this.valid=!1,this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var e;"string"==typeof t?(e=a.getRgba(t),e?this.setValues("rgb",e):(e=a.getHsla(t))?this.setValues("hsl",e):(e=a.getHwb(t))&&this.setValues("hwb",e)):"object"==typeof t&&(e=t,void 0!==e.r||void 0!==e.red?this.setValues("rgb",e):void 0!==e.l||void 0!==e.lightness?this.setValues("hsl",e):void 0!==e.v||void 0!==e.value?this.setValues("hsv",e):void 0!==e.w||void 0!==e.whiteness?this.setValues("hwb",e):void 0===e.c&&void 0===e.cyan||this.setValues("cmyk",e))};o.prototype={isValid:function(){return this.valid},rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){var t=this.values;return 1!==t.alpha?t.hwb.concat([t.alpha]):t.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values;return t.rgb.concat([t.alpha])},hslaArray:function(){var t=this.values;return t.hsl.concat([t.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=t<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return a.hexString(this.values.rgb)},rgbString:function(){return a.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return a.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return a.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return a.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return a.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return a.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return a.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){var t=this.values.rgb;return t[0]<<16|t[1]<<8|t[2]},luminosity:function(){for(var t=this.values.rgb,e=[],n=0;n<t.length;n++){var i=t[n]/255;e[n]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){var e=this.values.hsl;return e[2]+=e[2]*t,this.setValues("hsl",e),this},darken:function(t){var e=this.values.hsl;return e[2]-=e[2]*t,this.setValues("hsl",e),this},saturate:function(t){var e=this.values.hsl;return e[1]+=e[1]*t,this.setValues("hsl",e),this},desaturate:function(t){var e=this.values.hsl;return e[1]-=e[1]*t,this.setValues("hsl",e),this},whiten:function(t){var e=this.values.hwb;return e[1]+=e[1]*t,this.setValues("hwb",e),this},blacken:function(t){var e=this.values.hwb;return e[2]+=e[2]*t,this.setValues("hwb",e),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){var e=this.values.alpha;return this.setValues("alpha",e-e*t),this},opaquer:function(t){var e=this.values.alpha;return this.setValues("alpha",e+e*t),this},rotate:function(t){var e=this.values.hsl,n=(e[0]+t)%360;return e[0]=n<0?360+n:n,this.setValues("hsl",e),this},mix:function(t,e){var n=this,i=t,a=void 0===e?.5:e,o=2*a-1,r=n.alpha()-i.alpha(),l=((o*r===-1?o:(o+r)/(1+o*r))+1)/2,s=1-l;return this.rgb(l*n.red()+s*i.red(),l*n.green()+s*i.green(),l*n.blue()+s*i.blue()).alpha(n.alpha()*a+i.alpha()*(1-a))},toJSON:function(){return this.rgb()},clone:function(){var t,e,n=new o,i=this.values,a=n.values;for(var r in i)i.hasOwnProperty(r)&&(t=i[r],e={}.toString.call(t),"[object Array]"===e?a[r]=t.slice(0):"[object Number]"===e?a[r]=t:console.error("unexpected color value:",t));return n}},o.prototype.spaces={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},o.prototype.maxes={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o.prototype.getValues=function(t){for(var e=this.values,n={},i=0;i<t.length;i++)n[t.charAt(i)]=e[t][i];return 1!==e.alpha&&(n.a=e.alpha),n},o.prototype.setValues=function(t,e){var n,a=this.values,o=this.spaces,r=this.maxes,l=1;if(this.valid=!0,"alpha"===t)l=e;else if(e.length)a[t]=e.slice(0,t.length),l=e[t.length];else if(void 0!==e[t.charAt(0)]){for(n=0;n<t.length;n++)a[t][n]=e[t.charAt(n)];l=e.a}else if(void 0!==e[o[t][0]]){var s=o[t];for(n=0;n<t.length;n++)a[t][n]=e[s[n]];l=e.alpha}if(a.alpha=Math.max(0,Math.min(1,void 0===l?a.alpha:l)),"alpha"===t)return!1;var u;for(n=0;n<t.length;n++)u=Math.max(0,Math.min(r[t][n],a[t][n])),a[t][n]=Math.round(u);for(var d in o)d!==t&&(a[d]=i[t][d](a[t]));return!0},o.prototype.setSpace=function(t,e){var n=e[0];return void 0===n?this.getValues(t):("number"==typeof n&&(n=Array.prototype.slice.call(e)),this.setValues(t,n),this)},o.prototype.setChannel=function(t,e,n){var i=this.values[t];return void 0===n?i[e]:n===i[e]?this:(i[e]=n,this.setValues(t,i),this)},"undefined"!=typeof window&&(window.Color=o),e.exports=o},{2:2,5:5}],4:[function(t,e,n){function i(t){var e,n,i,a=t[0]/255,o=t[1]/255,r=t[2]/255,l=Math.min(a,o,r),s=Math.max(a,o,r),u=s-l;return s==l?e=0:a==s?e=(o-r)/u:o==s?e=2+(r-a)/u:r==s&&(e=4+(a-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),i=(l+s)/2,n=s==l?0:i<=.5?u/(s+l):u/(2-s-l),[e,100*n,100*i]}function a(t){var e,n,i,a=t[0],o=t[1],r=t[2],l=Math.min(a,o,r),s=Math.max(a,o,r),u=s-l;return n=0==s?0:u/s*1e3/10,s==l?e=0:a==s?e=(o-r)/u:o==s?e=2+(r-a)/u:r==s&&(e=4+(a-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),i=s/255*1e3/10,[e,n,i]}function o(t){var e=t[0],n=t[1],a=t[2],o=i(t)[0],r=1/255*Math.min(e,Math.min(n,a)),a=1-1/255*Math.max(e,Math.max(n,a));return[o,100*r,100*a]}function l(t){var e,n,i,a,o=t[0]/255,r=t[1]/255,l=t[2]/255;return a=Math.min(1-o,1-r,1-l),e=(1-o-a)/(1-a)||0,n=(1-r-a)/(1-a)||0,i=(1-l-a)/(1-a)||0,[100*e,100*n,100*i,100*a]}function s(t){return Z[JSON.stringify(t)]}function u(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var a=.4124*e+.3576*n+.1805*i,o=.2126*e+.7152*n+.0722*i,r=.0193*e+.1192*n+.9505*i;return[100*a,100*o,100*r]}function d(t){var e,n,i,a=u(t),o=a[0],r=a[1],l=a[2];return o/=95.047,r/=100,l/=108.883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*r-16,n=500*(o-r),i=200*(r-l),[e,n,i]}function c(t){return B(d(t))}function h(t){var e,n,i,a,o,r=t[0]/360,l=t[1]/100,s=t[2]/100;if(0==l)return o=255*s,[o,o,o];n=s<.5?s*(1+l):s+l-s*l,e=2*s-n,a=[0,0,0];for(var u=0;u<3;u++)i=r+1/3*-(u-1),i<0&&i++,i>1&&i--,o=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e,a[u]=255*o;return a}function f(t){var e,n,i=t[0],a=t[1]/100,o=t[2]/100;return 0===o?[0,0,0]:(o*=2,a*=o<=1?o:2-o,n=(o+a)/2,e=2*a/(o+a),[i,100*e,100*n])}function p(t){return o(h(t))}function m(t){return l(h(t))}function v(t){return s(h(t))}function x(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,a=Math.floor(e)%6,o=e-Math.floor(e),r=255*i*(1-n),l=255*i*(1-n*o),s=255*i*(1-n*(1-o)),i=255*i;switch(a){case 0:return[i,s,r];case 1:return[l,i,r];case 2:return[r,i,s];case 3:return[r,l,i];case 4:return[s,r,i];case 5:return[i,r,l]}}function y(t){var e,n,i=t[0],a=t[1]/100,o=t[2]/100;return n=(2-a)*o,e=a*o,e/=n<=1?n:2-n,e=e||0,n/=2,[i,100*e,100*n]}function k(t){return o(x(t))}function w(t){return l(x(t))}function M(t){return s(x(t))}function S(t){var e,n,i,a,o=t[0]/360,l=t[1]/100,s=t[2]/100,u=l+s;switch(u>1&&(l/=u,s/=u),e=Math.floor(6*o),n=1-s,i=6*o-e,0!=(1&e)&&(i=1-i),a=l+i*(n-l),e){default:case 6:case 0:r=n,g=a,b=l;break;case 1:r=a,g=n,b=l;break;case 2:r=l,g=n,b=a;break;case 3:r=l,g=a,b=n;break;case 4:r=a,g=l,b=n;break;case 5:r=n,g=l,b=a}return[255*r,255*g,255*b]}function C(t){return i(S(t))}function D(t){return a(S(t))}function I(t){return l(S(t))}function A(t){return s(S(t))}function P(t){var e,n,i,a=t[0]/100,o=t[1]/100,r=t[2]/100,l=t[3]/100;return e=1-Math.min(1,a*(1-l)+l),n=1-Math.min(1,o*(1-l)+l),i=1-Math.min(1,r*(1-l)+l),[255*e,255*n,255*i]}function _(t){return i(P(t))}function T(t){return a(P(t))}function F(t){return o(P(t))}function R(t){return s(P(t))}function L(t){var e,n,i,a=t[0]/100,o=t[1]/100,r=t[2]/100;return e=3.2406*a+o*-1.5372+r*-.4986,n=a*-.9689+1.8758*o+.0415*r,i=.0557*a+o*-.204+1.057*r,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:e*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i*=12.92,e=Math.min(Math.max(0,e),1),n=Math.min(Math.max(0,n),1),i=Math.min(Math.max(0,i),1),[255*e,255*n,255*i]}function V(t){var e,n,i,a=t[0],o=t[1],r=t[2];return a/=95.047,o/=100,r/=108.883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,e=116*o-16,n=500*(a-o),i=200*(o-r),[e,n,i]}function O(t){return B(V(t))}function z(t){var e,n,i,a,o=t[0],r=t[1],l=t[2];return o<=8?(n=100*o/903.3,a=7.787*(n/100)+16/116):(n=100*Math.pow((o+16)/116,3),a=Math.pow(n/100,1/3)),e=e/95.047<=.008856?e=95.047*(r/500+a-16/116)/7.787:95.047*Math.pow(r/500+a,3),i=i/108.883<=.008859?i=108.883*(a-l/200-16/116)/7.787:108.883*Math.pow(a-l/200,3),[e,n,i]}function B(t){var e,n,i,a=t[0],o=t[1],r=t[2];return e=Math.atan2(r,o),n=360*e/2/Math.PI,n<0&&(n+=360),i=Math.sqrt(o*o+r*r),[a,i,n]}function W(t){return L(z(t))}function N(t){var e,n,i,a=t[0],o=t[1],r=t[2];return i=r/360*2*Math.PI,e=o*Math.cos(i),n=o*Math.sin(i),[a,e,n]}function E(t){return z(N(t))}function H(t){return W(N(t))}function q(t){return J[t]}function j(t){return i(q(t))}function Y(t){return a(q(t))}function U(t){return o(q(t))}function X(t){return l(q(t))}function K(t){return d(q(t))}function G(t){return u(q(t))}e.exports={rgb2hsl:i,rgb2hsv:a,rgb2hwb:o,rgb2cmyk:l,rgb2keyword:s,rgb2xyz:u,rgb2lab:d,rgb2lch:c,hsl2rgb:h,hsl2hsv:f,hsl2hwb:p,hsl2cmyk:m,hsl2keyword:v,hsv2rgb:x,hsv2hsl:y,hsv2hwb:k,hsv2cmyk:w,hsv2keyword:M,hwb2rgb:S,hwb2hsl:C,hwb2hsv:D,hwb2cmyk:I,hwb2keyword:A,cmyk2rgb:P,cmyk2hsl:_,cmyk2hsv:T,cmyk2hwb:F,cmyk2keyword:R,keyword2rgb:q,keyword2hsl:j,keyword2hsv:Y,keyword2hwb:U,keyword2cmyk:X,keyword2lab:K,keyword2xyz:G,xyz2rgb:L,xyz2lab:V,xyz2lch:O,lab2xyz:z,lab2rgb:W,lab2lch:B,lch2lab:N,lch2xyz:E,lch2rgb:H};var J={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Z={};for(var Q in J)Z[JSON.stringify(J[Q])]=Q},{}],5:[function(t,e,n){var i=t(4),a=function(){return new u};for(var o in i){a[o+"Raw"]=function(t){return function(e){return"number"==typeof e&&(e=Array.prototype.slice.call(arguments)),i[t](e)}}(o);var r=/(\w+)2(\w+)/.exec(o),l=r[1],s=r[2];a[l]=a[l]||{},a[l][s]=a[o]=function(t){return function(e){"number"==typeof e&&(e=Array.prototype.slice.call(arguments));var n=i[t](e);if("string"==typeof n||void 0===n)return n;for(var a=0;a<n.length;a++)n[a]=Math.round(n[a]);return n}}(o)}var u=function(){this.convs={}};u.prototype.routeSpace=function(t,e){var n=e[0];return void 0===n?this.getValues(t):("number"==typeof n&&(n=Array.prototype.slice.call(e)),this.setValues(t,n))},u.prototype.setValues=function(t,e){return this.space=t,this.convs={},this.convs[t]=e,this},u.prototype.getValues=function(t){var e=this.convs[t];if(!e){var n=this.space,i=this.convs[n];e=a[n][t](i),this.convs[t]=e}return e},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(t){u.prototype[t]=function(e){return this.routeSpace(t,arguments)}}),e.exports=a},{4:4}],6:[function(t,e,n){e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},{}],7:[function(t,e,n){var i=t(28)();t(26)(i),t(40)(i),t(22)(i),t(25)(i),t(30)(i),t(21)(i),t(23)(i),t(24)(i),t(29)(i),t(32)(i),t(33)(i),t(31)(i),t(27)(i),t(34)(i),t(35)(i),t(36)(i),t(37)(i),t(38)(i),t(46)(i),t(44)(i),t(45)(i),t(47)(i),t(48)(i),t(49)(i),t(15)(i),t(16)(i),t(17)(i),t(18)(i),t(19)(i),t(20)(i),t(8)(i),t(9)(i),t(10)(i),t(11)(i),t(12)(i),t(13)(i),t(14)(i);var a=[];a.push(t(41)(i),t(42)(i),t(43)(i)),i.plugins.register(a),e.exports=i,"undefined"!=typeof window&&(window.Chart=i)},{10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,8:8,9:9}],8:[function(t,e,n){"use strict";e.exports=function(t){t.Bar=function(e,n){return n.type="bar",new t(e,n)}}},{}],9:[function(t,e,n){"use strict";e.exports=function(t){t.Bubble=function(e,n){return n.type="bubble",new t(e,n)}}},{}],10:[function(t,e,n){"use strict";e.exports=function(t){t.Doughnut=function(e,n){return n.type="doughnut",new t(e,n)}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t){t.Line=function(e,n){return n.type="line",new t(e,n)}}},{}],12:[function(t,e,n){"use strict";e.exports=function(t){t.PolarArea=function(e,n){return n.type="polarArea",new t(e,n)}}},{}],13:[function(t,e,n){"use strict";e.exports=function(t){t.Radar=function(e,n){return n.type="radar",new t(e,n)}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t){var e={hover:{mode:"single"},scales:{xAxes:[{type:"linear",position:"bottom",id:"x-axis-1"}],yAxes:[{type:"linear",position:"left",id:"y-axis-1"}]},tooltips:{callbacks:{title:function(){return""},label:function(t){return"("+t.xLabel+", "+t.yLabel+")"}}}};t.defaults.scatter=e,t.controllers.scatter=t.controllers.line,t.Scatter=function(e,n){return n.type="scatter",new t(e,n)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.bar={hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:.8,barPercentage:.9,gridLines:{offsetGridLines:!0}}],yAxes:[{type:"linear"}]}},t.controllers.bar=t.DatasetController.extend({dataElementType:t.elements.Rectangle,initialize:function(){var e,n=this;t.DatasetController.prototype.initialize.apply(n,arguments),e=n.getMeta(),e.stack=n.getDataset().stack,e.bar=!0},update:function(t){var e,n,i=this,a=i.getMeta().data;for(i._ruler=i.getRuler(),e=0,n=a.length;e<n;++e)i.updateElement(a[e],e,t)},updateElement:function(t,n,i){var a=this,o=a.chart,r=a.getMeta(),l=a.getDataset(),s=t.custom||{},u=o.options.elements.rectangle;t._xScale=a.getScaleForId(r.xAxisID),t._yScale=a.getScaleForId(r.yAxisID),t._datasetIndex=a.index,t._index=n,t._model={datasetLabel:l.label,label:o.data.labels[n],borderSkipped:s.borderSkipped?s.borderSkipped:u.borderSkipped,backgroundColor:s.backgroundColor?s.backgroundColor:e.getValueAtIndexOrDefault(l.backgroundColor,n,u.backgroundColor),borderColor:s.borderColor?s.borderColor:e.getValueAtIndexOrDefault(l.borderColor,n,u.borderColor),borderWidth:s.borderWidth?s.borderWidth:e.getValueAtIndexOrDefault(l.borderWidth,n,u.borderWidth)},a.updateElementGeometry(t,n,i),t.pivot()},updateElementGeometry:function(t,e,n){var i=this,a=t._model,o=i.getValueScale(),r=o.getBasePixel(),l=o.isHorizontal(),s=i._ruler||i.getRuler(),u=i.calculateBarValuePixels(i.index,e),d=i.calculateBarIndexPixels(i.index,e,s);a.horizontal=l,a.base=n?r:u.base,a.x=l?n?r:u.head:d.center,a.y=l?d.center:n?r:u.head,a.height=l?d.size:void 0,a.width=l?void 0:d.size},getValueScaleId:function(){return this.getMeta().yAxisID},getIndexScaleId:function(){return this.getMeta().xAxisID},getValueScale:function(){return this.getScaleForId(this.getValueScaleId())},getIndexScale:function(){return this.getScaleForId(this.getIndexScaleId())},getStackCount:function(t){var e,n,i=this,a=i.chart,o=i.getIndexScale(),r=o.options.stacked,l=void 0===t?a.data.datasets.length:t+1,s=[];for(e=0;e<l;++e)n=a.getDatasetMeta(e),n.bar&&a.isDatasetVisible(e)&&(r===!1||r===!0&&s.indexOf(n.stack)===-1||void 0===r&&(void 0===n.stack||s.indexOf(n.stack)===-1))&&s.push(n.stack);return s.length},getStackIndex:function(t){return this.getStackCount(t)-1},getRuler:function(){var t=this,n=t.getIndexScale(),i=n.options,a=t.getStackCount(),o=n.isHorizontal()?n.width:n.height,r=o/n.ticks.length,l=r*i.categoryPercentage,s=l/a,u=s*i.barPercentage;return u=Math.min(e.getValueOrDefault(i.barThickness,u),e.getValueOrDefault(i.maxBarThickness,1/0)),{stackCount:a,tickSize:r,categorySize:l,categorySpacing:r-l,fullBarSize:s,barSize:u,barSpacing:s-u,scale:n}},calculateBarValuePixels:function(t,e){var n,i,a,o,r,l,s=this,u=s.chart,d=s.getMeta(),c=s.getValueScale(),h=u.data.datasets,f=Number(h[t].data[e]),g=c.options.stacked,p=d.stack,m=0;if(g||void 0===g&&void 0!==p)for(n=0;n<t;++n)i=u.getDatasetMeta(n),i.bar&&i.stack===p&&i.controller.getValueScaleId()===c.id&&u.isDatasetVisible(n)&&(a=Number(h[n].data[e]),(f<0&&a<0||f>=0&&a>0)&&(m+=a));return o=c.getPixelForValue(m),r=c.getPixelForValue(m+f),l=(r-o)/2,{size:l,base:o,head:r,center:r+l/2}},calculateBarIndexPixels:function(t,e,n){var i=this,a=n.scale,o=i.chart.isCombo,r=i.getStackIndex(t),l=a.getPixelForValue(null,e,t,o),s=n.barSize;return l-=o?n.tickSize/2:0,l+=n.fullBarSize*r,l+=n.categorySpacing/2,l+=n.barSpacing/2,{size:s,base:l,head:l+s,center:l+s/2}},draw:function(){var t,n=this,i=n.chart,a=n.getMeta().data,o=n.getDataset(),r=a.length,l=0;for(e.canvas.clipArea(i.ctx,i.chartArea);l<r;++l)t=o.data[l],null===t||void 0===t||isNaN(t)||a[l].draw();e.canvas.unclipArea(i.ctx)},setHoverStyle:function(t){var n=this.chart.data.datasets[t._datasetIndex],i=t._index,a=t.custom||{},o=t._model;o.backgroundColor=a.hoverBackgroundColor?a.hoverBackgroundColor:e.getValueAtIndexOrDefault(n.hoverBackgroundColor,i,e.getHoverColor(o.backgroundColor)),o.borderColor=a.hoverBorderColor?a.hoverBorderColor:e.getValueAtIndexOrDefault(n.hoverBorderColor,i,e.getHoverColor(o.borderColor)),o.borderWidth=a.hoverBorderWidth?a.hoverBorderWidth:e.getValueAtIndexOrDefault(n.hoverBorderWidth,i,o.borderWidth)},removeHoverStyle:function(t){var n=this.chart.data.datasets[t._datasetIndex],i=t._index,a=t.custom||{},o=t._model,r=this.chart.options.elements.rectangle;o.backgroundColor=a.backgroundColor?a.backgroundColor:e.getValueAtIndexOrDefault(n.backgroundColor,i,r.backgroundColor),o.borderColor=a.borderColor?a.borderColor:e.getValueAtIndexOrDefault(n.borderColor,i,r.borderColor),o.borderWidth=a.borderWidth?a.borderWidth:e.getValueAtIndexOrDefault(n.borderWidth,i,r.borderWidth)}}),t.defaults.horizontalBar={hover:{mode:"label"},scales:{xAxes:[{type:"linear",position:"bottom"}],yAxes:[{position:"left",type:"category",categoryPercentage:.8,barPercentage:.9,gridLines:{offsetGridLines:!0}}]},elements:{rectangle:{borderSkipped:"left"}},tooltips:{callbacks:{title:function(t,e){var n="";return t.length>0&&(t[0].yLabel?n=t[0].yLabel:e.labels.length>0&&t[0].index<e.labels.length&&(n=e.labels[t[0].index])),n},label:function(t,e){var n=e.datasets[t.datasetIndex].label||"";return n+": "+t.xLabel}}}},t.controllers.horizontalBar=t.controllers.bar.extend({getValueScaleId:function(){return this.getMeta().xAxisID},getIndexScaleId:function(){return this.getMeta().yAxisID}})}},{}],16:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.bubble={hover:{mode:"single"},scales:{xAxes:[{type:"linear",position:"bottom",id:"x-axis-0"}],yAxes:[{type:"linear",position:"left",id:"y-axis-0"}]},tooltips:{callbacks:{title:function(){return""},label:function(t,e){var n=e.datasets[t.datasetIndex].label||"",i=e.datasets[t.datasetIndex].data[t.index];return n+": ("+t.xLabel+", "+t.yLabel+", "+i.r+")"}}}},t.controllers.bubble=t.DatasetController.extend({dataElementType:t.elements.Point,update:function(t){var n=this,i=n.getMeta(),a=i.data;e.each(a,function(e,i){n.updateElement(e,i,t)})},updateElement:function(n,i,a){var o=this,r=o.getMeta(),l=o.getScaleForId(r.xAxisID),s=o.getScaleForId(r.yAxisID),u=n.custom||{},d=o.getDataset(),c=d.data[i],h=o.chart.options.elements.point,f=o.index;e.extend(n,{_xScale:l,_yScale:s,_datasetIndex:f,_index:i,_model:{x:a?l.getPixelForDecimal(.5):l.getPixelForValue("object"==typeof c?c:NaN,i,f,o.chart.isCombo),y:a?s.getBasePixel():s.getPixelForValue(c,i,f),radius:a?0:u.radius?u.radius:o.getRadius(c),hitRadius:u.hitRadius?u.hitRadius:e.getValueAtIndexOrDefault(d.hitRadius,i,h.hitRadius)}}),t.DatasetController.prototype.removeHoverStyle.call(o,n,h);var g=n._model;g.skip=u.skip?u.skip:isNaN(g.x)||isNaN(g.y),n.pivot()},getRadius:function(t){return t.r||this.chart.options.elements.point.radius},setHoverStyle:function(n){var i=this;t.DatasetController.prototype.setHoverStyle.call(i,n);var a=i.chart.data.datasets[n._datasetIndex],o=n._index,r=n.custom||{},l=n._model;
l.radius=r.hoverRadius?r.hoverRadius:e.getValueAtIndexOrDefault(a.hoverRadius,o,i.chart.options.elements.point.hoverRadius)+i.getRadius(a.data[o])},removeHoverStyle:function(e){var n=this;t.DatasetController.prototype.removeHoverStyle.call(n,e,n.chart.options.elements.point);var i=n.chart.data.datasets[e._datasetIndex].data[e._index],a=e.custom||{},o=e._model;o.radius=a.radius?a.radius:n.getRadius(i)}})}},{}],17:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n=t.defaults;n.doughnut={animation:{animateRotate:!0,animateScale:!1},aspectRatio:1,hover:{mode:"single"},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var n=t.data,i=n.datasets,a=n.labels;if(i.length)for(var o=0;o<i[0].data.length;++o)e.push('<li><span style="background-color:'+i[0].backgroundColor[o]+'"></span>'),a[o]&&e.push(a[o]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var n=t.data;return n.labels.length&&n.datasets.length?n.labels.map(function(i,a){var o=t.getDatasetMeta(0),r=n.datasets[0],l=o.data[a],s=l&&l.custom||{},u=e.getValueAtIndexOrDefault,d=t.options.elements.arc,c=s.backgroundColor?s.backgroundColor:u(r.backgroundColor,a,d.backgroundColor),h=s.borderColor?s.borderColor:u(r.borderColor,a,d.borderColor),f=s.borderWidth?s.borderWidth:u(r.borderWidth,a,d.borderWidth);return{text:i,fillStyle:c,strokeStyle:h,lineWidth:f,hidden:isNaN(r.data[a])||o.data[a].hidden,index:a}}):[]}},onClick:function(t,e){var n,i,a,o=e.index,r=this.chart;for(n=0,i=(r.data.datasets||[]).length;n<i;++n)a=r.getDatasetMeta(n),a.data[o]&&(a.data[o].hidden=!a.data[o].hidden);r.update()}},cutoutPercentage:50,rotation:Math.PI*-.5,circumference:2*Math.PI,tooltips:{callbacks:{title:function(){return""},label:function(t,n){var i=n.labels[t.index],a=": "+n.datasets[t.datasetIndex].data[t.index];return e.isArray(i)?(i=i.slice(),i[0]+=a):i+=a,i}}}},n.pie=e.clone(n.doughnut),e.extend(n.pie,{cutoutPercentage:0}),t.controllers.doughnut=t.controllers.pie=t.DatasetController.extend({dataElementType:t.elements.Arc,linkScales:e.noop,getRingIndex:function(t){for(var e=0,n=0;n<t;++n)this.chart.isDatasetVisible(n)&&++e;return e},update:function(t){var n=this,i=n.chart,a=i.chartArea,o=i.options,r=o.elements.arc,l=a.right-a.left-r.borderWidth,s=a.bottom-a.top-r.borderWidth,u=Math.min(l,s),d={x:0,y:0},c=n.getMeta(),h=o.cutoutPercentage,f=o.circumference;if(f<2*Math.PI){var g=o.rotation%(2*Math.PI);g+=2*Math.PI*(g>=Math.PI?-1:g<-Math.PI?1:0);var p=g+f,m={x:Math.cos(g),y:Math.sin(g)},v={x:Math.cos(p),y:Math.sin(p)},b=g<=0&&0<=p||g<=2*Math.PI&&2*Math.PI<=p,x=g<=.5*Math.PI&&.5*Math.PI<=p||g<=2.5*Math.PI&&2.5*Math.PI<=p,y=g<=-Math.PI&&-Math.PI<=p||g<=Math.PI&&Math.PI<=p,k=g<=.5*-Math.PI&&.5*-Math.PI<=p||g<=1.5*Math.PI&&1.5*Math.PI<=p,w=h/100,M={x:y?-1:Math.min(m.x*(m.x<0?1:w),v.x*(v.x<0?1:w)),y:k?-1:Math.min(m.y*(m.y<0?1:w),v.y*(v.y<0?1:w))},S={x:b?1:Math.max(m.x*(m.x>0?1:w),v.x*(v.x>0?1:w)),y:x?1:Math.max(m.y*(m.y>0?1:w),v.y*(v.y>0?1:w))},C={width:.5*(S.x-M.x),height:.5*(S.y-M.y)};u=Math.min(l/C.width,s/C.height),d={x:(S.x+M.x)*-.5,y:(S.y+M.y)*-.5}}i.borderWidth=n.getMaxBorderWidth(c.data),i.outerRadius=Math.max((u-i.borderWidth)/2,0),i.innerRadius=Math.max(h?i.outerRadius/100*h:0,0),i.radiusLength=(i.outerRadius-i.innerRadius)/i.getVisibleDatasetCount(),i.offsetX=d.x*i.outerRadius,i.offsetY=d.y*i.outerRadius,c.total=n.calculateTotal(),n.outerRadius=i.outerRadius-i.radiusLength*n.getRingIndex(n.index),n.innerRadius=Math.max(n.outerRadius-i.radiusLength,0),e.each(c.data,function(e,i){n.updateElement(e,i,t)})},updateElement:function(t,n,i){var a=this,o=a.chart,r=o.chartArea,l=o.options,s=l.animation,u=(r.left+r.right)/2,d=(r.top+r.bottom)/2,c=l.rotation,h=l.rotation,f=a.getDataset(),g=i&&s.animateRotate?0:t.hidden?0:a.calculateCircumference(f.data[n])*(l.circumference/(2*Math.PI)),p=i&&s.animateScale?0:a.innerRadius,m=i&&s.animateScale?0:a.outerRadius,v=e.getValueAtIndexOrDefault;e.extend(t,{_datasetIndex:a.index,_index:n,_model:{x:u+o.offsetX,y:d+o.offsetY,startAngle:c,endAngle:h,circumference:g,outerRadius:m,innerRadius:p,label:v(f.label,n,o.data.labels[n])}});var b=t._model;this.removeHoverStyle(t),i&&s.animateRotate||(0===n?b.startAngle=l.rotation:b.startAngle=a.getMeta().data[n-1]._model.endAngle,b.endAngle=b.startAngle+b.circumference),t.pivot()},removeHoverStyle:function(e){t.DatasetController.prototype.removeHoverStyle.call(this,e,this.chart.options.elements.arc)},calculateTotal:function(){var t,n=this.getDataset(),i=this.getMeta(),a=0;return e.each(i.data,function(e,i){t=n.data[i],isNaN(t)||e.hidden||(a+=Math.abs(t))}),a},calculateCircumference:function(t){var e=this.getMeta().total;return e>0&&!isNaN(t)?2*Math.PI*(t/e):0},getMaxBorderWidth:function(t){for(var e,n,i=0,a=this.index,o=t.length,r=0;r<o;r++)e=t[r]._model?t[r]._model.borderWidth:0,n=t[r]._chart?t[r]._chart.config.data.datasets[a].hoverBorderWidth:0,i=e>i?e:i,i=n>i?n:i;return i}})}},{}],18:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){return n.getValueOrDefault(t.showLine,e.showLines)}var n=t.helpers;t.defaults.line={showLines:!0,spanGaps:!1,hover:{mode:"label"},scales:{xAxes:[{type:"category",id:"x-axis-0"}],yAxes:[{type:"linear",id:"y-axis-0"}]}},t.controllers.line=t.DatasetController.extend({datasetElementType:t.elements.Line,dataElementType:t.elements.Point,update:function(t){var i,a,o,r=this,l=r.getMeta(),s=l.dataset,u=l.data||[],d=r.chart.options,c=d.elements.line,h=r.getScaleForId(l.yAxisID),f=r.getDataset(),g=e(f,d);for(g&&(o=s.custom||{},void 0!==f.tension&&void 0===f.lineTension&&(f.lineTension=f.tension),s._scale=h,s._datasetIndex=r.index,s._children=u,s._model={spanGaps:f.spanGaps?f.spanGaps:d.spanGaps,tension:o.tension?o.tension:n.getValueOrDefault(f.lineTension,c.tension),backgroundColor:o.backgroundColor?o.backgroundColor:f.backgroundColor||c.backgroundColor,borderWidth:o.borderWidth?o.borderWidth:f.borderWidth||c.borderWidth,borderColor:o.borderColor?o.borderColor:f.borderColor||c.borderColor,borderCapStyle:o.borderCapStyle?o.borderCapStyle:f.borderCapStyle||c.borderCapStyle,borderDash:o.borderDash?o.borderDash:f.borderDash||c.borderDash,borderDashOffset:o.borderDashOffset?o.borderDashOffset:f.borderDashOffset||c.borderDashOffset,borderJoinStyle:o.borderJoinStyle?o.borderJoinStyle:f.borderJoinStyle||c.borderJoinStyle,fill:o.fill?o.fill:void 0!==f.fill?f.fill:c.fill,steppedLine:o.steppedLine?o.steppedLine:n.getValueOrDefault(f.steppedLine,c.stepped),cubicInterpolationMode:o.cubicInterpolationMode?o.cubicInterpolationMode:n.getValueOrDefault(f.cubicInterpolationMode,c.cubicInterpolationMode)},s.pivot()),i=0,a=u.length;i<a;++i)r.updateElement(u[i],i,t);for(g&&0!==s._model.tension&&r.updateBezierControlPoints(),i=0,a=u.length;i<a;++i)u[i].pivot()},getPointBackgroundColor:function(t,e){var i=this.chart.options.elements.point.backgroundColor,a=this.getDataset(),o=t.custom||{};return o.backgroundColor?i=o.backgroundColor:a.pointBackgroundColor?i=n.getValueAtIndexOrDefault(a.pointBackgroundColor,e,i):a.backgroundColor&&(i=a.backgroundColor),i},getPointBorderColor:function(t,e){var i=this.chart.options.elements.point.borderColor,a=this.getDataset(),o=t.custom||{};return o.borderColor?i=o.borderColor:a.pointBorderColor?i=n.getValueAtIndexOrDefault(a.pointBorderColor,e,i):a.borderColor&&(i=a.borderColor),i},getPointBorderWidth:function(t,e){var i=this.chart.options.elements.point.borderWidth,a=this.getDataset(),o=t.custom||{};return isNaN(o.borderWidth)?isNaN(a.pointBorderWidth)?isNaN(a.borderWidth)||(i=a.borderWidth):i=n.getValueAtIndexOrDefault(a.pointBorderWidth,e,i):i=o.borderWidth,i},updateElement:function(t,e,i){var a,o,r=this,l=r.getMeta(),s=t.custom||{},u=r.getDataset(),d=r.index,c=u.data[e],h=r.getScaleForId(l.yAxisID),f=r.getScaleForId(l.xAxisID),g=r.chart.options.elements.point,p=r.chart.data.labels||[],m=1===p.length||1===u.data.length||r.chart.isCombo;void 0!==u.radius&&void 0===u.pointRadius&&(u.pointRadius=u.radius),void 0!==u.hitRadius&&void 0===u.pointHitRadius&&(u.pointHitRadius=u.hitRadius),a=f.getPixelForValue("object"==typeof c?c:NaN,e,d,m),o=i?h.getBasePixel():r.calculatePointY(c,e,d),t._xScale=f,t._yScale=h,t._datasetIndex=d,t._index=e,t._model={x:a,y:o,skip:s.skip||isNaN(a)||isNaN(o),radius:s.radius||n.getValueAtIndexOrDefault(u.pointRadius,e,g.radius),pointStyle:s.pointStyle||n.getValueAtIndexOrDefault(u.pointStyle,e,g.pointStyle),backgroundColor:r.getPointBackgroundColor(t,e),borderColor:r.getPointBorderColor(t,e),borderWidth:r.getPointBorderWidth(t,e),tension:l.dataset._model?l.dataset._model.tension:0,steppedLine:!!l.dataset._model&&l.dataset._model.steppedLine,hitRadius:s.hitRadius||n.getValueAtIndexOrDefault(u.pointHitRadius,e,g.hitRadius)}},calculatePointY:function(t,e,n){var i,a,o,r=this,l=r.chart,s=r.getMeta(),u=r.getScaleForId(s.yAxisID),d=0,c=0;if(u.options.stacked){for(i=0;i<n;i++)if(a=l.data.datasets[i],o=l.getDatasetMeta(i),"line"===o.type&&o.yAxisID===u.id&&l.isDatasetVisible(i)){var h=Number(u.getRightValue(a.data[e]));h<0?c+=h||0:d+=h||0}var f=Number(u.getRightValue(t));return f<0?u.getPixelForValue(c+f):u.getPixelForValue(d+f)}return u.getPixelForValue(t)},updateBezierControlPoints:function(){function t(t,e,n){return Math.max(Math.min(t,n),e)}var e,i,a,o,r,l=this,s=l.getMeta(),u=l.chart.chartArea,d=s.data||[];if(s.dataset._model.spanGaps&&(d=d.filter(function(t){return!t._model.skip})),"monotone"===s.dataset._model.cubicInterpolationMode)n.splineCurveMonotone(d);else for(e=0,i=d.length;e<i;++e)a=d[e],o=a._model,r=n.splineCurve(n.previousItem(d,e)._model,o,n.nextItem(d,e)._model,s.dataset._model.tension),o.controlPointPreviousX=r.previous.x,o.controlPointPreviousY=r.previous.y,o.controlPointNextX=r.next.x,o.controlPointNextY=r.next.y;if(l.chart.options.elements.line.capBezierPoints)for(e=0,i=d.length;e<i;++e)o=d[e]._model,o.controlPointPreviousX=t(o.controlPointPreviousX,u.left,u.right),o.controlPointPreviousY=t(o.controlPointPreviousY,u.top,u.bottom),o.controlPointNextX=t(o.controlPointNextX,u.left,u.right),o.controlPointNextY=t(o.controlPointNextY,u.top,u.bottom)},draw:function(){var n=this,i=n.chart,a=n.getMeta(),o=a.data||[],r=i.chartArea,l=o.length,s=0;for(t.canvasHelpers.clipArea(i.ctx,r),e(n.getDataset(),i.options)&&a.dataset.draw(),t.canvasHelpers.unclipArea(i.ctx);s<l;++s)o[s].draw(r)},setHoverStyle:function(t){var e=this.chart.data.datasets[t._datasetIndex],i=t._index,a=t.custom||{},o=t._model;o.radius=a.hoverRadius||n.getValueAtIndexOrDefault(e.pointHoverRadius,i,this.chart.options.elements.point.hoverRadius),o.backgroundColor=a.hoverBackgroundColor||n.getValueAtIndexOrDefault(e.pointHoverBackgroundColor,i,n.getHoverColor(o.backgroundColor)),o.borderColor=a.hoverBorderColor||n.getValueAtIndexOrDefault(e.pointHoverBorderColor,i,n.getHoverColor(o.borderColor)),o.borderWidth=a.hoverBorderWidth||n.getValueAtIndexOrDefault(e.pointHoverBorderWidth,i,o.borderWidth)},removeHoverStyle:function(t){var e=this,i=e.chart.data.datasets[t._datasetIndex],a=t._index,o=t.custom||{},r=t._model;void 0!==i.radius&&void 0===i.pointRadius&&(i.pointRadius=i.radius),r.radius=o.radius||n.getValueAtIndexOrDefault(i.pointRadius,a,e.chart.options.elements.point.radius),r.backgroundColor=e.getPointBackgroundColor(t,a),r.borderColor=e.getPointBorderColor(t,a),r.borderWidth=e.getPointBorderWidth(t,a)}})}},{}],19:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.polarArea={scale:{type:"radialLinear",angleLines:{display:!1},gridLines:{circular:!0},pointLabels:{display:!1},ticks:{beginAtZero:!0}},animation:{animateRotate:!0,animateScale:!0},startAngle:-.5*Math.PI,aspectRatio:1,legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var n=t.data,i=n.datasets,a=n.labels;if(i.length)for(var o=0;o<i[0].data.length;++o)e.push('<li><span style="background-color:'+i[0].backgroundColor[o]+'"></span>'),a[o]&&e.push(a[o]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var n=t.data;return n.labels.length&&n.datasets.length?n.labels.map(function(i,a){var o=t.getDatasetMeta(0),r=n.datasets[0],l=o.data[a],s=l.custom||{},u=e.getValueAtIndexOrDefault,d=t.options.elements.arc,c=s.backgroundColor?s.backgroundColor:u(r.backgroundColor,a,d.backgroundColor),h=s.borderColor?s.borderColor:u(r.borderColor,a,d.borderColor),f=s.borderWidth?s.borderWidth:u(r.borderWidth,a,d.borderWidth);return{text:i,fillStyle:c,strokeStyle:h,lineWidth:f,hidden:isNaN(r.data[a])||o.data[a].hidden,index:a}}):[]}},onClick:function(t,e){var n,i,a,o=e.index,r=this.chart;for(n=0,i=(r.data.datasets||[]).length;n<i;++n)a=r.getDatasetMeta(n),a.data[o].hidden=!a.data[o].hidden;r.update()}},tooltips:{callbacks:{title:function(){return""},label:function(t,e){return e.labels[t.index]+": "+t.yLabel}}}},t.controllers.polarArea=t.DatasetController.extend({dataElementType:t.elements.Arc,linkScales:e.noop,update:function(t){var n=this,i=n.chart,a=i.chartArea,o=n.getMeta(),r=i.options,l=r.elements.arc,s=Math.min(a.right-a.left,a.bottom-a.top);i.outerRadius=Math.max((s-l.borderWidth/2)/2,0),i.innerRadius=Math.max(r.cutoutPercentage?i.outerRadius/100*r.cutoutPercentage:1,0),i.radiusLength=(i.outerRadius-i.innerRadius)/i.getVisibleDatasetCount(),n.outerRadius=i.outerRadius-i.radiusLength*n.index,n.innerRadius=n.outerRadius-i.radiusLength,o.count=n.countVisibleElements(),e.each(o.data,function(e,i){n.updateElement(e,i,t)})},updateElement:function(t,n,i){for(var a=this,o=a.chart,r=a.getDataset(),l=o.options,s=l.animation,u=o.scale,d=e.getValueAtIndexOrDefault,c=o.data.labels,h=a.calculateCircumference(r.data[n]),f=u.xCenter,g=u.yCenter,p=0,m=a.getMeta(),v=0;v<n;++v)isNaN(r.data[v])||m.data[v].hidden||++p;var b=l.startAngle,x=t.hidden?0:u.getDistanceFromCenterForValue(r.data[n]),y=b+h*p,k=y+(t.hidden?0:h),w=s.animateScale?0:u.getDistanceFromCenterForValue(r.data[n]);e.extend(t,{_datasetIndex:a.index,_index:n,_scale:u,_model:{x:f,y:g,innerRadius:0,outerRadius:i?w:x,startAngle:i&&s.animateRotate?b:y,endAngle:i&&s.animateRotate?b:k,label:d(c,n,c[n])}}),a.removeHoverStyle(t),t.pivot()},removeHoverStyle:function(e){t.DatasetController.prototype.removeHoverStyle.call(this,e,this.chart.options.elements.arc)},countVisibleElements:function(){var t=this.getDataset(),n=this.getMeta(),i=0;return e.each(n.data,function(e,n){isNaN(t.data[n])||e.hidden||i++}),i},calculateCircumference:function(t){var e=this.getMeta().count;return e>0&&!isNaN(t)?2*Math.PI/e:0}})}},{}],20:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.radar={aspectRatio:1,scale:{type:"radialLinear"},elements:{line:{tension:0}}},t.controllers.radar=t.DatasetController.extend({datasetElementType:t.elements.Line,dataElementType:t.elements.Point,linkScales:e.noop,update:function(t){var n=this,i=n.getMeta(),a=i.dataset,o=i.data,r=a.custom||{},l=n.getDataset(),s=n.chart.options.elements.line,u=n.chart.scale;void 0!==l.tension&&void 0===l.lineTension&&(l.lineTension=l.tension),e.extend(i.dataset,{_datasetIndex:n.index,_scale:u,_children:o,_loop:!0,_model:{tension:r.tension?r.tension:e.getValueOrDefault(l.lineTension,s.tension),backgroundColor:r.backgroundColor?r.backgroundColor:l.backgroundColor||s.backgroundColor,borderWidth:r.borderWidth?r.borderWidth:l.borderWidth||s.borderWidth,borderColor:r.borderColor?r.borderColor:l.borderColor||s.borderColor,fill:r.fill?r.fill:void 0!==l.fill?l.fill:s.fill,borderCapStyle:r.borderCapStyle?r.borderCapStyle:l.borderCapStyle||s.borderCapStyle,borderDash:r.borderDash?r.borderDash:l.borderDash||s.borderDash,borderDashOffset:r.borderDashOffset?r.borderDashOffset:l.borderDashOffset||s.borderDashOffset,borderJoinStyle:r.borderJoinStyle?r.borderJoinStyle:l.borderJoinStyle||s.borderJoinStyle}}),i.dataset.pivot(),e.each(o,function(e,i){n.updateElement(e,i,t)},n),n.updateBezierControlPoints()},updateElement:function(t,n,i){var a=this,o=t.custom||{},r=a.getDataset(),l=a.chart.scale,s=a.chart.options.elements.point,u=l.getPointPositionForValue(n,r.data[n]);void 0!==r.radius&&void 0===r.pointRadius&&(r.pointRadius=r.radius),void 0!==r.hitRadius&&void 0===r.pointHitRadius&&(r.pointHitRadius=r.hitRadius),e.extend(t,{_datasetIndex:a.index,_index:n,_scale:l,_model:{x:i?l.xCenter:u.x,y:i?l.yCenter:u.y,tension:o.tension?o.tension:e.getValueOrDefault(r.lineTension,a.chart.options.elements.line.tension),radius:o.radius?o.radius:e.getValueAtIndexOrDefault(r.pointRadius,n,s.radius),backgroundColor:o.backgroundColor?o.backgroundColor:e.getValueAtIndexOrDefault(r.pointBackgroundColor,n,s.backgroundColor),borderColor:o.borderColor?o.borderColor:e.getValueAtIndexOrDefault(r.pointBorderColor,n,s.borderColor),borderWidth:o.borderWidth?o.borderWidth:e.getValueAtIndexOrDefault(r.pointBorderWidth,n,s.borderWidth),pointStyle:o.pointStyle?o.pointStyle:e.getValueAtIndexOrDefault(r.pointStyle,n,s.pointStyle),hitRadius:o.hitRadius?o.hitRadius:e.getValueAtIndexOrDefault(r.pointHitRadius,n,s.hitRadius)}}),t._model.skip=o.skip?o.skip:isNaN(t._model.x)||isNaN(t._model.y)},updateBezierControlPoints:function(){var t=this.chart.chartArea,n=this.getMeta();e.each(n.data,function(i,a){var o=i._model,r=e.splineCurve(e.previousItem(n.data,a,!0)._model,o,e.nextItem(n.data,a,!0)._model,o.tension);o.controlPointPreviousX=Math.max(Math.min(r.previous.x,t.right),t.left),o.controlPointPreviousY=Math.max(Math.min(r.previous.y,t.bottom),t.top),o.controlPointNextX=Math.max(Math.min(r.next.x,t.right),t.left),o.controlPointNextY=Math.max(Math.min(r.next.y,t.bottom),t.top),i.pivot()})},setHoverStyle:function(t){var n=this.chart.data.datasets[t._datasetIndex],i=t.custom||{},a=t._index,o=t._model;o.radius=i.hoverRadius?i.hoverRadius:e.getValueAtIndexOrDefault(n.pointHoverRadius,a,this.chart.options.elements.point.hoverRadius),o.backgroundColor=i.hoverBackgroundColor?i.hoverBackgroundColor:e.getValueAtIndexOrDefault(n.pointHoverBackgroundColor,a,e.getHoverColor(o.backgroundColor)),o.borderColor=i.hoverBorderColor?i.hoverBorderColor:e.getValueAtIndexOrDefault(n.pointHoverBorderColor,a,e.getHoverColor(o.borderColor)),o.borderWidth=i.hoverBorderWidth?i.hoverBorderWidth:e.getValueAtIndexOrDefault(n.pointHoverBorderWidth,a,o.borderWidth)},removeHoverStyle:function(t){var n=this.chart.data.datasets[t._datasetIndex],i=t.custom||{},a=t._index,o=t._model,r=this.chart.options.elements.point;o.radius=i.radius?i.radius:e.getValueAtIndexOrDefault(n.pointRadius,a,r.radius),o.backgroundColor=i.backgroundColor?i.backgroundColor:e.getValueAtIndexOrDefault(n.pointBackgroundColor,a,r.backgroundColor),o.borderColor=i.borderColor?i.borderColor:e.getValueAtIndexOrDefault(n.pointBorderColor,a,r.borderColor),o.borderWidth=i.borderWidth?i.borderWidth:e.getValueAtIndexOrDefault(n.pointBorderWidth,a,r.borderWidth)}})}},{}],21:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.global.animation={duration:1e3,easing:"easeOutQuart",onProgress:e.noop,onComplete:e.noop},t.Animation=t.Element.extend({chart:null,currentStep:0,numSteps:60,easing:"",render:null,onAnimationProgress:null,onAnimationComplete:null}),t.animationService={frameDuration:17,animations:[],dropFrames:0,request:null,addAnimation:function(t,e,n,i){var a,o,r=this.animations;for(e.chart=t,i||(t.animating=!0),a=0,o=r.length;a<o;++a)if(r[a].chart===t)return void(r[a]=e);r.push(e),1===r.length&&this.requestAnimationFrame()},cancelAnimation:function(t){var n=e.findIndex(this.animations,function(e){return e.chart===t});n!==-1&&(this.animations.splice(n,1),t.animating=!1)},requestAnimationFrame:function(){var t=this;null===t.request&&(t.request=e.requestAnimFrame.call(window,function(){t.request=null,t.startDigest()}))},startDigest:function(){var t=this,e=Date.now(),n=0;t.dropFrames>1&&(n=Math.floor(t.dropFrames),t.dropFrames=t.dropFrames%1),t.advance(1+n);var i=Date.now();t.dropFrames+=(i-e)/t.frameDuration,t.animations.length>0&&t.requestAnimationFrame()},advance:function(t){for(var n,i,a=this.animations,o=0;o<a.length;)n=a[o],i=n.chart,n.currentStep=(n.currentStep||0)+t,n.currentStep=Math.min(n.currentStep,n.numSteps),e.callback(n.render,[i,n],i),e.callback(n.onAnimationProgress,[n],i),n.currentStep>=n.numSteps?(e.callback(n.onAnimationComplete,[n],i),i.animating=!1,a.splice(o,1)):++o}},Object.defineProperty(t.Animation.prototype,"animationObject",{get:function(){return this}}),Object.defineProperty(t.Animation.prototype,"chartInstance",{get:function(){return this.chart},set:function(t){this.chart=t}})}},{}],22:[function(t,e,n){"use strict";e.exports=function(t){var e=t.canvasHelpers={};e.drawPoint=function(e,n,i,a,o){var r,l,s,u,d,c;if("object"==typeof n&&(r=n.toString(),"[object HTMLImageElement]"===r||"[object HTMLCanvasElement]"===r))return void e.drawImage(n,a-n.width/2,o-n.height/2,n.width,n.height);if(!(isNaN(i)||i<=0)){switch(n){default:e.beginPath(),e.arc(a,o,i,0,2*Math.PI),e.closePath(),e.fill();break;case"triangle":e.beginPath(),l=3*i/Math.sqrt(3),d=l*Math.sqrt(3)/2,e.moveTo(a-l/2,o+d/3),e.lineTo(a+l/2,o+d/3),e.lineTo(a,o-2*d/3),e.closePath(),e.fill();break;case"rect":c=1/Math.SQRT2*i,e.beginPath(),e.fillRect(a-c,o-c,2*c,2*c),e.strokeRect(a-c,o-c,2*c,2*c);break;case"rectRounded":var h=i/Math.SQRT2,f=a-h,g=o-h,p=Math.SQRT2*i;t.helpers.drawRoundedRectangle(e,f,g,p,p,i/2),e.fill();break;case"rectRot":c=1/Math.SQRT2*i,e.beginPath(),e.moveTo(a-c,o),e.lineTo(a,o+c),e.lineTo(a+c,o),e.lineTo(a,o-c),e.closePath(),e.fill();break;case"cross":e.beginPath(),e.moveTo(a,o+i),e.lineTo(a,o-i),e.moveTo(a-i,o),e.lineTo(a+i,o),e.closePath();break;case"crossRot":e.beginPath(),s=Math.cos(Math.PI/4)*i,u=Math.sin(Math.PI/4)*i,e.moveTo(a-s,o-u),e.lineTo(a+s,o+u),e.moveTo(a-s,o+u),e.lineTo(a+s,o-u),e.closePath();break;case"star":e.beginPath(),e.moveTo(a,o+i),e.lineTo(a,o-i),e.moveTo(a-i,o),e.lineTo(a+i,o),s=Math.cos(Math.PI/4)*i,u=Math.sin(Math.PI/4)*i,e.moveTo(a-s,o-u),e.lineTo(a+s,o+u),e.moveTo(a-s,o+u),e.lineTo(a+s,o-u),e.closePath();break;case"line":e.beginPath(),e.moveTo(a-i,o),e.lineTo(a+i,o),e.closePath();break;case"dash":e.beginPath(),e.moveTo(a,o),e.lineTo(a+i,o),e.closePath()}e.stroke()}},e.clipArea=function(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()},e.unclipArea=function(t){t.restore()},e.lineTo=function(t,e,n,i){return n.steppedLine?("after"===n.steppedLine?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y),void t.lineTo(n.x,n.y)):n.tension?void t.bezierCurveTo(i?e.controlPointPreviousX:e.controlPointNextX,i?e.controlPointPreviousY:e.controlPointNextY,i?n.controlPointNextX:n.controlPointPreviousX,i?n.controlPointNextY:n.controlPointPreviousY,n.x,n.y):void t.lineTo(n.x,n.y)},t.helpers.canvas=e}},{}],23:[function(t,e,n){"use strict";e.exports=function(t){function e(e){e=e||{};var n=e.data=e.data||{};return n.datasets=n.datasets||[],n.labels=n.labels||[],e.options=a.configMerge(t.defaults.global,t.defaults[e.type],e.options||{}),e}function n(t){var e=t.options;e.scale?t.scale.options=e.scale:e.scales&&e.scales.xAxes.concat(e.scales.yAxes).forEach(function(e){t.scales[e.id].options=e}),t.tooltip._options=e.tooltips}function i(t){return"top"===t||"bottom"===t}var a=t.helpers,o=t.plugins,r=t.platform;t.types={},t.instances={},t.controllers={},a.extend(t.prototype,{construct:function(n,i){var o=this;i=e(i);var l=r.acquireContext(n,i),s=l&&l.canvas,u=s&&s.height,d=s&&s.width;return o.id=a.uid(),o.ctx=l,o.canvas=s,o.config=i,o.width=d,o.height=u,o.aspectRatio=u?d/u:null,o.options=i.options,o._bufferedRender=!1,o.chart=o,o.controller=o,t.instances[o.id]=o,Object.defineProperty(o,"data",{get:function(){return o.config.data},set:function(t){o.config.data=t}}),l&&s?(o.initialize(),void o.update()):void console.error("Failed to create chart: can't acquire context from the given item")},initialize:function(){var t=this;return o.notify(t,"beforeInit"),a.retinaScale(t),t.bindEvents(),t.options.responsive&&t.resize(!0),t.ensureScalesHaveIDs(),t.buildScales(),t.initToolTip(),o.notify(t,"afterInit"),t},clear:function(){return a.clear(this),this},stop:function(){return t.animationService.cancelAnimation(this),this},resize:function(t){var e=this,n=e.options,i=e.canvas,r=n.maintainAspectRatio&&e.aspectRatio||null,l=Math.floor(a.getMaximumWidth(i)),s=Math.floor(r?l/r:a.getMaximumHeight(i));if((e.width!==l||e.height!==s)&&(i.width=e.width=l,i.height=e.height=s,i.style.width=l+"px",i.style.height=s+"px",a.retinaScale(e),!t)){var u={width:l,height:s};o.notify(e,"resize",[u]),e.options.onResize&&e.options.onResize(e,u),e.stop(),e.update(e.options.responsiveAnimationDuration)}},ensureScalesHaveIDs:function(){var t=this.options,e=t.scales||{},n=t.scale;a.each(e.xAxes,function(t,e){t.id=t.id||"x-axis-"+e}),a.each(e.yAxes,function(t,e){t.id=t.id||"y-axis-"+e}),n&&(n.id=n.id||"scale")},buildScales:function(){var e=this,n=e.options,o=e.scales={},r=[];n.scales&&(r=r.concat((n.scales.xAxes||[]).map(function(t){return{options:t,dtype:"category",dposition:"bottom"}}),(n.scales.yAxes||[]).map(function(t){return{options:t,dtype:"linear",dposition:"left"}}))),n.scale&&r.push({options:n.scale,dtype:"radialLinear",isDefault:!0,dposition:"chartArea"}),a.each(r,function(n){var r=n.options,l=a.getValueOrDefault(r.type,n.dtype),s=t.scaleService.getScaleConstructor(l);if(s){i(r.position)!==i(n.dposition)&&(r.position=n.dposition);var u=new s({id:r.id,options:r,ctx:e.ctx,chart:e});o[u.id]=u,n.isDefault&&(e.scale=u)}}),t.scaleService.addScalesToLayout(this)},buildOrUpdateControllers:function(){var e=this,n=[],i=[];if(a.each(e.data.datasets,function(a,o){var r=e.getDatasetMeta(o);if(r.type||(r.type=a.type||e.config.type),n.push(r.type),r.controller)r.controller.updateIndex(o);else{var l=t.controllers[r.type];if(void 0===l)throw new Error('"'+r.type+'" is not a chart type.');r.controller=new l(e,o),i.push(r.controller)}},e),n.length>1)for(var o=1;o<n.length;o++)if(n[o]!==n[o-1]){e.isCombo=!0;break}return i},resetElements:function(){var t=this;a.each(t.data.datasets,function(e,n){t.getDatasetMeta(n).controller.reset()},t)},reset:function(){this.resetElements(),this.tooltip.initialize()},update:function(t,e){var i=this;if(n(i),o.notify(i,"beforeUpdate")!==!1){i.tooltip._data=i.data;var r=i.buildOrUpdateControllers();a.each(i.data.datasets,function(t,e){i.getDatasetMeta(e).controller.buildOrUpdateElements()},i),i.updateLayout(),a.each(r,function(t){t.reset()}),i.updateDatasets(),o.notify(i,"afterUpdate"),i._bufferedRender?i._bufferedRequest={lazy:e,duration:t}:i.render(t,e)}},updateLayout:function(){var e=this;o.notify(e,"beforeLayout")!==!1&&(t.layoutService.update(this,this.width,this.height),o.notify(e,"afterScaleUpdate"),o.notify(e,"afterLayout"))},updateDatasets:function(){var t=this;if(o.notify(t,"beforeDatasetsUpdate")!==!1){for(var e=0,n=t.data.datasets.length;e<n;++e)t.updateDataset(e);o.notify(t,"afterDatasetsUpdate")}},updateDataset:function(t){var e=this,n=e.getDatasetMeta(t),i={meta:n,index:t};o.notify(e,"beforeDatasetUpdate",[i])!==!1&&(n.controller.update(),o.notify(e,"afterDatasetUpdate",[i]))},render:function(e,n){var i=this;if(o.notify(i,"beforeRender")!==!1){var r=i.options.animation,l=function(t){o.notify(i,"afterRender"),a.callback(r&&r.onComplete,[t],i)};if(r&&("undefined"!=typeof e&&0!==e||"undefined"==typeof e&&0!==r.duration)){var s=new t.Animation({numSteps:(e||r.duration)/16.66,easing:r.easing,render:function(t,e){var n=a.easingEffects[e.easing],i=e.currentStep,o=i/e.numSteps;t.draw(n(o),o,i)},onAnimationProgress:r.onProgress,onAnimationComplete:l});t.animationService.addAnimation(i,s,e,n)}else i.draw(),l(new t.Animation({numSteps:0,chart:i}));return i}},draw:function(t){var e=this;e.clear(),void 0!==t&&null!==t||(t=1),e.transition(t),o.notify(e,"beforeDraw",[t])!==!1&&(a.each(e.boxes,function(t){t.draw(e.chartArea)},e),e.scale&&e.scale.draw(),e.drawDatasets(t),e.tooltip.draw(),o.notify(e,"afterDraw",[t]))},transition:function(t){for(var e=this,n=0,i=(e.data.datasets||[]).length;n<i;++n)e.isDatasetVisible(n)&&e.getDatasetMeta(n).controller.transition(t);e.tooltip.transition(t)},drawDatasets:function(t){var e=this;if(o.notify(e,"beforeDatasetsDraw",[t])!==!1){for(var n=(e.data.datasets||[]).length-1;n>=0;--n)e.isDatasetVisible(n)&&e.drawDataset(n,t);o.notify(e,"afterDatasetsDraw",[t])}},drawDataset:function(t,e){var n=this,i=n.getDatasetMeta(t),a={meta:i,index:t,easingValue:e};o.notify(n,"beforeDatasetDraw",[a])!==!1&&(i.controller.draw(e),o.notify(n,"afterDatasetDraw",[a]))},getElementAtEvent:function(e){return t.Interaction.modes.single(this,e)},getElementsAtEvent:function(e){return t.Interaction.modes.label(this,e,{intersect:!0})},getElementsAtXAxis:function(e){return t.Interaction.modes["x-axis"](this,e,{intersect:!0})},getElementsAtEventForMode:function(e,n,i){var a=t.Interaction.modes[n];return"function"==typeof a?a(this,e,i):[]},getDatasetAtEvent:function(e){return t.Interaction.modes.dataset(this,e,{intersect:!0})},getDatasetMeta:function(t){var e=this,n=e.data.datasets[t];n._meta||(n._meta={});var i=n._meta[e.id];return i||(i=n._meta[e.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}),i},getVisibleDatasetCount:function(){for(var t=0,e=0,n=this.data.datasets.length;e<n;++e)this.isDatasetVisible(e)&&t++;return t},isDatasetVisible:function(t){var e=this.getDatasetMeta(t);return"boolean"==typeof e.hidden?!e.hidden:!this.data.datasets[t].hidden},generateLegend:function(){return this.options.legendCallback(this)},destroy:function(){var e,n,i,l=this,s=l.canvas;for(l.stop(),n=0,i=l.data.datasets.length;n<i;++n)e=l.getDatasetMeta(n),e.controller&&(e.controller.destroy(),e.controller=null);s&&(l.unbindEvents(),a.clear(l),r.releaseContext(l.ctx),l.canvas=null,l.ctx=null),o.notify(l,"destroy"),delete t.instances[l.id]},toBase64Image:function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},initToolTip:function(){var e=this;e.tooltip=new t.Tooltip({_chart:e,_chartInstance:e,_data:e.data,_options:e.options.tooltips},e),e.tooltip.initialize()},bindEvents:function(){var t=this,e=t._listeners={},n=function(){t.eventHandler.apply(t,arguments)};a.each(t.options.events,function(i){r.addEventListener(t,i,n),e[i]=n}),t.options.responsive&&(n=function(){t.resize()},r.addEventListener(t,"resize",n),e.resize=n)},unbindEvents:function(){var t=this,e=t._listeners;e&&(delete t._listeners,a.each(e,function(e,n){r.removeEventListener(t,n,e)}))},updateHoverStyle:function(t,e,n){var i,a,o,r=n?"setHoverStyle":"removeHoverStyle";for(a=0,o=t.length;a<o;++a)i=t[a],i&&this.getDatasetMeta(i._datasetIndex).controller[r](i)},eventHandler:function(t){var e=this,n=e.tooltip;if(o.notify(e,"beforeEvent",[t])!==!1){e._bufferedRender=!0,e._bufferedRequest=null;var i=e.handleEvent(t);i|=n&&n.handleEvent(t),o.notify(e,"afterEvent",[t]);var a=e._bufferedRequest;return a?e.render(a.duration,a.lazy):i&&!e.animating&&(e.stop(),e.render(e.options.hover.animationDuration,!0)),e._bufferedRender=!1,e._bufferedRequest=null,e}},handleEvent:function(t){var e=this,n=e.options||{},i=n.hover,o=!1;return e.lastActive=e.lastActive||[],"mouseout"===t.type?e.active=[]:e.active=e.getElementsAtEventForMode(t,i.mode,i),i.onHover&&i.onHover.call(e,t.native,e.active),"mouseup"!==t.type&&"click"!==t.type||n.onClick&&n.onClick.call(e,t.native,e.active),e.lastActive.length&&e.updateHoverStyle(e.lastActive,i.mode,!1),e.active.length&&i.mode&&e.updateHoverStyle(e.active,i.mode,!0),o=!a.arrayEquals(e.active,e.lastActive),e.lastActive=e.active,o}}),t.Controller=t}},{}],24:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){return t._chartjs?void t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),void a.forEach(function(e){var n="onData"+e.charAt(0).toUpperCase()+e.slice(1),a=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:function(){var e=Array.prototype.slice.call(arguments),o=a.apply(this,e);return i.each(t._chartjs.listeners,function(t){"function"==typeof t[n]&&t[n].apply(t,e)}),o}})}))}function n(t,e){var n=t._chartjs;if(n){var i=n.listeners,o=i.indexOf(e);
o!==-1&&i.splice(o,1),i.length>0||(a.forEach(function(e){delete t[e]}),delete t._chartjs)}}var i=t.helpers,a=["push","pop","shift","splice","unshift"];t.DatasetController=function(t,e){this.initialize(t,e)},i.extend(t.DatasetController.prototype,{datasetElementType:null,dataElementType:null,initialize:function(t,e){var n=this;n.chart=t,n.index=e,n.linkScales(),n.addElements()},updateIndex:function(t){this.index=t},linkScales:function(){var t=this,e=t.getMeta(),n=t.getDataset();null===e.xAxisID&&(e.xAxisID=n.xAxisID||t.chart.options.scales.xAxes[0].id),null===e.yAxisID&&(e.yAxisID=n.yAxisID||t.chart.options.scales.yAxes[0].id)},getDataset:function(){return this.chart.data.datasets[this.index]},getMeta:function(){return this.chart.getDatasetMeta(this.index)},getScaleForId:function(t){return this.chart.scales[t]},reset:function(){this.update(!0)},destroy:function(){this._data&&n(this._data,this)},createMetaDataset:function(){var t=this,e=t.datasetElementType;return e&&new e({_chart:t.chart,_datasetIndex:t.index})},createMetaData:function(t){var e=this,n=e.dataElementType;return n&&new n({_chart:e.chart,_datasetIndex:e.index,_index:t})},addElements:function(){var t,e,n=this,i=n.getMeta(),a=n.getDataset().data||[],o=i.data;for(t=0,e=a.length;t<e;++t)o[t]=o[t]||n.createMetaData(t);i.dataset=i.dataset||n.createMetaDataset()},addElementAndReset:function(t){var e=this.createMetaData(t);this.getMeta().data.splice(t,0,e),this.updateElement(e,t,!0)},buildOrUpdateElements:function(){var t=this,i=t.getDataset(),a=i.data||(i.data=[]);t._data!==a&&(t._data&&n(t._data,t),e(a,t),t._data=a),t.resyncElements()},update:i.noop,transition:function(t){for(var e=this.getMeta(),n=e.data||[],i=n.length,a=0;a<i;++a)n[a].transition(t);e.dataset&&e.dataset.transition(t)},draw:function(){var t=this.getMeta(),e=t.data||[],n=e.length,i=0;for(t.dataset&&t.dataset.draw();i<n;++i)e[i].draw()},removeHoverStyle:function(t,e){var n=this.chart.data.datasets[t._datasetIndex],a=t._index,o=t.custom||{},r=i.getValueAtIndexOrDefault,l=t._model;l.backgroundColor=o.backgroundColor?o.backgroundColor:r(n.backgroundColor,a,e.backgroundColor),l.borderColor=o.borderColor?o.borderColor:r(n.borderColor,a,e.borderColor),l.borderWidth=o.borderWidth?o.borderWidth:r(n.borderWidth,a,e.borderWidth)},setHoverStyle:function(t){var e=this.chart.data.datasets[t._datasetIndex],n=t._index,a=t.custom||{},o=i.getValueAtIndexOrDefault,r=i.getHoverColor,l=t._model;l.backgroundColor=a.hoverBackgroundColor?a.hoverBackgroundColor:o(e.hoverBackgroundColor,n,r(l.backgroundColor)),l.borderColor=a.hoverBorderColor?a.hoverBorderColor:o(e.hoverBorderColor,n,r(l.borderColor)),l.borderWidth=a.hoverBorderWidth?a.hoverBorderWidth:o(e.hoverBorderWidth,n,l.borderWidth)},resyncElements:function(){var t=this,e=t.getMeta(),n=t.getDataset().data,i=e.data.length,a=n.length;a<i?e.data.splice(a,i-a):a>i&&t.insertElements(i,a-i)},insertElements:function(t,e){for(var n=0;n<e;++n)this.addElementAndReset(t+n)},onDataPush:function(){this.insertElements(this.getDataset().data.length-1,arguments.length)},onDataPop:function(){this.getMeta().data.pop()},onDataShift:function(){this.getMeta().data.shift()},onDataSplice:function(t,e){this.getMeta().data.splice(t,e),this.insertElements(t,arguments.length-2)},onDataUnshift:function(){this.insertElements(0,arguments.length)}}),t.DatasetController.extend=i.inherits}},{}],25:[function(t,e,n){"use strict";var i=t(3);e.exports=function(t){function e(t,e,n,a){var o,r,l,s,u,d,c,h,f,g=Object.keys(n);for(o=0,r=g.length;o<r;++o)if(l=g[o],d=n[l],e.hasOwnProperty(l)||(e[l]=d),s=e[l],s!==d&&"_"!==l[0]){if(t.hasOwnProperty(l)||(t[l]=s),u=t[l],c=typeof d,c===typeof u)if("string"===c){if(h=i(u),h.valid&&(f=i(d),f.valid)){e[l]=f.mix(h,a).rgbString();continue}}else if("number"===c&&isFinite(u)&&isFinite(d)){e[l]=u+(d-u)*a;continue}e[l]=d}}var n=t.helpers;t.elements={},t.Element=function(t){n.extend(this,t),this.initialize.apply(this,arguments)},n.extend(t.Element.prototype,{initialize:function(){this.hidden=!1},pivot:function(){var t=this;return t._view||(t._view=n.clone(t._model)),t._start={},t},transition:function(t){var n=this,i=n._model,a=n._start,o=n._view;return i&&1!==t?(o||(o=n._view={}),a||(a=n._start={}),e(a,o,i,t),n):(n._view=i,n._start=null,n)},tooltipPosition:function(){return{x:this._model.x,y:this._model.y}},hasValue:function(){return n.isNumber(this._model.x)&&n.isNumber(this._model.y)}}),t.Element.extend=n.inherits}},{3:3}],26:[function(t,e,n){"use strict";var i=t(3);e.exports=function(t){function e(t,e,n){var i;return"string"==typeof t?(i=parseInt(t,10),t.indexOf("%")!==-1&&(i=i/100*e.parentNode[n])):i=t,i}function n(t){return void 0!==t&&null!==t&&"none"!==t}function a(t,i,a){var o=document.defaultView,r=t.parentNode,l=o.getComputedStyle(t)[i],s=o.getComputedStyle(r)[i],u=n(l),d=n(s),c=Number.POSITIVE_INFINITY;return u||d?Math.min(u?e(l,t,a):c,d?e(s,r,a):c):"none"}var o=t.helpers={};o.each=function(t,e,n,i){var a,r;if(o.isArray(t))if(r=t.length,i)for(a=r-1;a>=0;a--)e.call(n,t[a],a);else for(a=0;a<r;a++)e.call(n,t[a],a);else if("object"==typeof t){var l=Object.keys(t);for(r=l.length,a=0;a<r;a++)e.call(n,t[l[a]],l[a])}},o.clone=function(t){var e={};return o.each(t,function(t,n){o.isArray(t)?e[n]=t.slice(0):"object"==typeof t&&null!==t?e[n]=o.clone(t):e[n]=t}),e},o.extend=function(t){for(var e=function(e,n){t[n]=e},n=1,i=arguments.length;n<i;n++)o.each(arguments[n],e);return t},o.configMerge=function(e){var n=o.clone(e);return o.each(Array.prototype.slice.call(arguments,1),function(e){o.each(e,function(e,i){var a=n.hasOwnProperty(i),r=a?n[i]:{};"scales"===i?n[i]=o.scaleMerge(r,e):"scale"===i?n[i]=o.configMerge(r,t.scaleService.getScaleDefaults(e.type),e):!a||"object"!=typeof r||o.isArray(r)||null===r||"object"!=typeof e||o.isArray(e)?n[i]=e:n[i]=o.configMerge(r,e)})}),n},o.scaleMerge=function(e,n){var i=o.clone(e);return o.each(n,function(e,n){"xAxes"===n||"yAxes"===n?i.hasOwnProperty(n)?o.each(e,function(e,a){var r=o.getValueOrDefault(e.type,"xAxes"===n?"category":"linear"),l=t.scaleService.getScaleDefaults(r);a>=i[n].length||!i[n][a].type?i[n].push(o.configMerge(l,e)):e.type&&e.type!==i[n][a].type?i[n][a]=o.configMerge(i[n][a],l,e):i[n][a]=o.configMerge(i[n][a],e)}):(i[n]=[],o.each(e,function(e){var a=o.getValueOrDefault(e.type,"xAxes"===n?"category":"linear");i[n].push(o.configMerge(t.scaleService.getScaleDefaults(a),e))})):i.hasOwnProperty(n)&&"object"==typeof i[n]&&null!==i[n]&&"object"==typeof e?i[n]=o.configMerge(i[n],e):i[n]=e}),i},o.getValueAtIndexOrDefault=function(t,e,n){return void 0===t||null===t?n:o.isArray(t)?e<t.length?t[e]:n:t},o.getValueOrDefault=function(t,e){return void 0===t?e:t},o.indexOf=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=0,i=t.length;n<i;++n)if(t[n]===e)return n;return-1},o.where=function(t,e){if(o.isArray(t)&&Array.prototype.filter)return t.filter(e);var n=[];return o.each(t,function(t){e(t)&&n.push(t)}),n},o.findIndex=Array.prototype.findIndex?function(t,e,n){return t.findIndex(e,n)}:function(t,e,n){n=void 0===n?t:n;for(var i=0,a=t.length;i<a;++i)if(e.call(n,t[i],i,t))return i;return-1},o.findNextWhere=function(t,e,n){void 0!==n&&null!==n||(n=-1);for(var i=n+1;i<t.length;i++){var a=t[i];if(e(a))return a}},o.findPreviousWhere=function(t,e,n){void 0!==n&&null!==n||(n=t.length);for(var i=n-1;i>=0;i--){var a=t[i];if(e(a))return a}},o.inherits=function(t){var e=this,n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return e.apply(this,arguments)},i=function(){this.constructor=n};return i.prototype=e.prototype,n.prototype=new i,n.extend=o.inherits,t&&o.extend(n.prototype,t),n.__super__=e.prototype,n},o.noop=function(){},o.uid=function(){var t=0;return function(){return t++}}(),o.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},o.almostEquals=function(t,e,n){return Math.abs(t-e)<n},o.almostWhole=function(t,e){var n=Math.round(t);return n-e<t&&n+e>t},o.max=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.max(t,e)},Number.NEGATIVE_INFINITY)},o.min=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.min(t,e)},Number.POSITIVE_INFINITY)},o.sign=Math.sign?function(t){return Math.sign(t)}:function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},o.log10=Math.log10?function(t){return Math.log10(t)}:function(t){return Math.log(t)/Math.LN10},o.toRadians=function(t){return t*(Math.PI/180)},o.toDegrees=function(t){return t*(180/Math.PI)},o.getAngleFromPoint=function(t,e){var n=e.x-t.x,i=e.y-t.y,a=Math.sqrt(n*n+i*i),o=Math.atan2(i,n);return o<-.5*Math.PI&&(o+=2*Math.PI),{angle:o,distance:a}},o.distanceBetweenPoints=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},o.aliasPixel=function(t){return t%2===0?0:.5},o.splineCurve=function(t,e,n,i){var a=t.skip?e:t,o=e,r=n.skip?e:n,l=Math.sqrt(Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)),s=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),u=l/(l+s),d=s/(l+s);u=isNaN(u)?0:u,d=isNaN(d)?0:d;var c=i*u,h=i*d;return{previous:{x:o.x-c*(r.x-a.x),y:o.y-c*(r.y-a.y)},next:{x:o.x+h*(r.x-a.x),y:o.y+h*(r.y-a.y)}}},o.EPSILON=Number.EPSILON||1e-14,o.splineCurveMonotone=function(t){var e,n,i,a,r=(t||[]).map(function(t){return{model:t._model,deltaK:0,mK:0}}),l=r.length;for(e=0;e<l;++e)if(i=r[e],!i.model.skip){if(n=e>0?r[e-1]:null,a=e<l-1?r[e+1]:null,a&&!a.model.skip){var s=a.model.x-i.model.x;i.deltaK=0!==s?(a.model.y-i.model.y)/s:0}!n||n.model.skip?i.mK=i.deltaK:!a||a.model.skip?i.mK=n.deltaK:this.sign(n.deltaK)!==this.sign(i.deltaK)?i.mK=0:i.mK=(n.deltaK+i.deltaK)/2}var u,d,c,h;for(e=0;e<l-1;++e)i=r[e],a=r[e+1],i.model.skip||a.model.skip||(o.almostEquals(i.deltaK,0,this.EPSILON)?i.mK=a.mK=0:(u=i.mK/i.deltaK,d=a.mK/i.deltaK,h=Math.pow(u,2)+Math.pow(d,2),h<=9||(c=3/Math.sqrt(h),i.mK=u*c*i.deltaK,a.mK=d*c*i.deltaK)));var f;for(e=0;e<l;++e)i=r[e],i.model.skip||(n=e>0?r[e-1]:null,a=e<l-1?r[e+1]:null,n&&!n.model.skip&&(f=(i.model.x-n.model.x)/3,i.model.controlPointPreviousX=i.model.x-f,i.model.controlPointPreviousY=i.model.y-f*i.mK),a&&!a.model.skip&&(f=(a.model.x-i.model.x)/3,i.model.controlPointNextX=i.model.x+f,i.model.controlPointNextY=i.model.y+f*i.mK))},o.nextItem=function(t,e,n){return n?e>=t.length-1?t[0]:t[e+1]:e>=t.length-1?t[t.length-1]:t[e+1]},o.previousItem=function(t,e,n){return n?e<=0?t[t.length-1]:t[e-1]:e<=0?t[0]:t[e-1]},o.niceNum=function(t,e){var n,i=Math.floor(o.log10(t)),a=t/Math.pow(10,i);return n=e?a<1.5?1:a<3?2:a<7?5:10:a<=1?1:a<=2?2:a<=5?5:10,n*Math.pow(10,i)};var r=o.easingEffects={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-1*t*(t-2)},easeInOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1*((t=t/1-1)*t*t+1)},easeInOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-1*((t=t/1-1)*t*t*t-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},easeInQuint:function(t){return 1*(t/=1)*t*t*t*t},easeOutQuint:function(t){return 1*((t=t/1-1)*t*t*t*t+1)},easeInOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return-1*Math.cos(t/1*(Math.PI/2))+1},easeOutSine:function(t){return 1*Math.sin(t/1*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t/1)-1)},easeInExpo:function(t){return 0===t?1:1*Math.pow(2,10*(t/1-1))},easeOutExpo:function(t){return 1===t?1:1*(-Math.pow(2,-10*t/1)+1)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){return t>=1?t:-1*(Math.sqrt(1-(t/=1)*t)-1)},easeOutCirc:function(t){return 1*Math.sqrt(1-(t=t/1-1)*t)},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){var e=1.70158,n=0,i=1;return 0===t?0:1===(t/=1)?1:(n||(n=.3),i<Math.abs(1)?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/n)))},easeOutElastic:function(t){var e=1.70158,n=0,i=1;return 0===t?0:1===(t/=1)?1:(n||(n=.3),i<Math.abs(1)?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*t)*Math.sin((1*t-e)*(2*Math.PI)/n)+1)},easeInOutElastic:function(t){var e=1.70158,n=0,i=1;return 0===t?0:2===(t/=.5)?1:(n||(n=1*(.3*1.5)),i<Math.abs(1)?(i=1,e=n/4):e=n/(2*Math.PI)*Math.asin(1/i),t<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/n)):i*Math.pow(2,-10*(t-=1))*Math.sin((1*t-e)*(2*Math.PI)/n)*.5+1)},easeInBack:function(t){var e=1.70158;return 1*(t/=1)*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return 1*((t=t/1-1)*t*((e+1)*t+e)+1)},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:function(t){return 1-r.easeOutBounce(1-t)},easeOutBounce:function(t){return(t/=1)<1/2.75?1*(7.5625*t*t):t<2/2.75?1*(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1*(7.5625*(t-=2.25/2.75)*t+.9375):1*(7.5625*(t-=2.625/2.75)*t+.984375)},easeInOutBounce:function(t){return t<.5?.5*r.easeInBounce(2*t):.5*r.easeOutBounce(2*t-1)+.5}};o.requestAnimFrame=function(){return"undefined"==typeof window?function(t){t()}:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),o.getRelativePosition=function(t,e){var n,i,a=t.originalEvent||t,r=t.currentTarget||t.srcElement,l=r.getBoundingClientRect(),s=a.touches;s&&s.length>0?(n=s[0].clientX,i=s[0].clientY):(n=a.clientX,i=a.clientY);var u=parseFloat(o.getStyle(r,"padding-left")),d=parseFloat(o.getStyle(r,"padding-top")),c=parseFloat(o.getStyle(r,"padding-right")),h=parseFloat(o.getStyle(r,"padding-bottom")),f=l.right-l.left-u-c,g=l.bottom-l.top-d-h;return n=Math.round((n-l.left-u)/f*r.width/e.currentDevicePixelRatio),i=Math.round((i-l.top-d)/g*r.height/e.currentDevicePixelRatio),{x:n,y:i}},o.addEvent=function(t,e,n){t.addEventListener?t.addEventListener(e,n):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},o.removeEvent=function(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=o.noop},o.getConstraintWidth=function(t){return a(t,"max-width","clientWidth")},o.getConstraintHeight=function(t){return a(t,"max-height","clientHeight")},o.getMaximumWidth=function(t){var e=t.parentNode,n=parseInt(o.getStyle(e,"padding-left"),10),i=parseInt(o.getStyle(e,"padding-right"),10),a=e.clientWidth-n-i,r=o.getConstraintWidth(t);return isNaN(r)?a:Math.min(a,r)},o.getMaximumHeight=function(t){var e=t.parentNode,n=parseInt(o.getStyle(e,"padding-top"),10),i=parseInt(o.getStyle(e,"padding-bottom"),10),a=e.clientHeight-n-i,r=o.getConstraintHeight(t);return isNaN(r)?a:Math.min(a,r)},o.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,null).getPropertyValue(e)},o.retinaScale=function(t){var e=t.currentDevicePixelRatio=window.devicePixelRatio||1;if(1!==e){var n=t.canvas,i=t.height,a=t.width;n.height=i*e,n.width=a*e,t.ctx.scale(e,e),n.style.height=i+"px",n.style.width=a+"px"}},o.clear=function(t){t.ctx.clearRect(0,0,t.width,t.height)},o.fontString=function(t,e,n){return e+" "+t+"px "+n},o.longestText=function(t,e,n,i){i=i||{};var a=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(a=i.data={},r=i.garbageCollect=[],i.font=e),t.font=e;var l=0;o.each(n,function(e){void 0!==e&&null!==e&&o.isArray(e)!==!0?l=o.measureText(t,a,r,l,e):o.isArray(e)&&o.each(e,function(e){void 0===e||null===e||o.isArray(e)||(l=o.measureText(t,a,r,l,e))})});var s=r.length/2;if(s>n.length){for(var u=0;u<s;u++)delete a[r[u]];r.splice(0,s)}return l},o.measureText=function(t,e,n,i,a){var o=e[a];return o||(o=e[a]=t.measureText(a).width,n.push(a)),o>i&&(i=o),i},o.numberOfLabelLines=function(t){var e=1;return o.each(t,function(t){o.isArray(t)&&t.length>e&&(e=t.length)}),e},o.drawRoundedRectangle=function(t,e,n,i,a,o){t.beginPath(),t.moveTo(e+o,n),t.lineTo(e+i-o,n),t.quadraticCurveTo(e+i,n,e+i,n+o),t.lineTo(e+i,n+a-o),t.quadraticCurveTo(e+i,n+a,e+i-o,n+a),t.lineTo(e+o,n+a),t.quadraticCurveTo(e,n+a,e,n+a-o),t.lineTo(e,n+o),t.quadraticCurveTo(e,n,e+o,n),t.closePath()},o.color=i?function(e){return e instanceof CanvasGradient&&(e=t.defaults.global.defaultColor),i(e)}:function(t){return console.error("Color.js not found!"),t},o.isArray=Array.isArray?function(t){return Array.isArray(t)}:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o.arrayEquals=function(t,e){var n,i,a,r;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(a=t[n],r=e[n],a instanceof Array&&r instanceof Array){if(!o.arrayEquals(a,r))return!1}else if(a!==r)return!1;return!0},o.callback=function(t,e,n){t&&"function"==typeof t.call&&t.apply(n,e)},o.getHoverColor=function(t){return t instanceof CanvasPattern?t:o.color(t).saturate(.5).darken(.1).rgbString()},o.callCallback=o.callback}},{3:3}],27:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){return t.native?{x:t.x,y:t.y}:r.getRelativePosition(t,e)}function n(t,e){var n,i,a,o,r,l=t.data.datasets;for(i=0,o=l.length;i<o;++i)if(t.isDatasetVisible(i))for(n=t.getDatasetMeta(i),a=0,r=n.data.length;a<r;++a){var s=n.data[a];s._view.skip||e(s)}}function i(t,e){var i=[];return n(t,function(t){t.inRange(e.x,e.y)&&i.push(t)}),i}function a(t,e,i,a){var o=Number.POSITIVE_INFINITY,l=[];return a||(a=r.distanceBetweenPoints),n(t,function(t){if(!i||t.inRange(e.x,e.y)){var n=t.getCenterPoint(),r=a(e,n);r<o?(l=[t],o=r):r===o&&l.push(t)}}),l}function o(t,n,o){var r=e(n,t),l=function(t,e){return Math.abs(t.x-e.x)},s=o.intersect?i(t,r):a(t,r,!1,l),u=[];return s.length?(t.data.datasets.forEach(function(e,n){if(t.isDatasetVisible(n)){var i=t.getDatasetMeta(n),a=i.data[s[0]._index];a&&!a._view.skip&&u.push(a)}}),u):[]}var r=t.helpers;t.Interaction={modes:{single:function(t,i){var a=e(i,t),o=[];return n(t,function(t){if(t.inRange(a.x,a.y))return o.push(t),o}),o.slice(0,1)},label:o,index:o,dataset:function(t,n,o){var r=e(n,t),l=o.intersect?i(t,r):a(t,r,!1);return l.length>0&&(l=t.getDatasetMeta(l[0]._datasetIndex).data),l},"x-axis":function(t,e){return o(t,e,!0)},point:function(t,n){var a=e(n,t);return i(t,a)},nearest:function(t,n,i){var o=e(n,t),r=a(t,o,i.intersect);return r.length>1&&r.sort(function(t,e){var n=t.getArea(),i=e.getArea(),a=n-i;return 0===a&&(a=t._datasetIndex-e._datasetIndex),a}),r.slice(0,1)},x:function(t,i,a){var o=e(i,t),r=[],l=!1;return n(t,function(t){t.inXRange(o.x)&&r.push(t),t.inRange(o.x,o.y)&&(l=!0)}),a.intersect&&!l&&(r=[]),r},y:function(t,i,a){var o=e(i,t),r=[],l=!1;return n(t,function(t){t.inYRange(o.y)&&r.push(t),t.inRange(o.x,o.y)&&(l=!0)}),a.intersect&&!l&&(r=[]),r}}}}},{}],28:[function(t,e,n){"use strict";e.exports=function(){var t=function(t,e){return this.construct(t,e),this};return t.defaults={global:{responsive:!0,responsiveAnimationDuration:0,maintainAspectRatio:!0,events:["mousemove","mouseout","click","touchstart","touchmove"],hover:{onHover:null,mode:"nearest",intersect:!0,animationDuration:400},onClick:null,defaultColor:"rgba(0,0,0,0.1)",defaultFontColor:"#666",defaultFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",defaultFontSize:12,defaultFontStyle:"normal",showLines:!0,elements:{},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');for(var n=0;n<t.data.datasets.length;n++)e.push('<li><span style="background-color:'+t.data.datasets[n].backgroundColor+'"></span>'),t.data.datasets[n].label&&e.push(t.data.datasets[n].label),e.push("</li>");return e.push("</ul>"),e.join("")}}},t.Chart=t,t}},{}],29:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){return i.where(t,function(t){return t.position===e})}function n(t,e){t.forEach(function(t,e){return t._tmpIndex_=e,t}),t.sort(function(t,n){var i=e?n:t,a=e?t:n;return i.weight===a.weight?i._tmpIndex_-a._tmpIndex_:i.weight-a.weight}),t.forEach(function(t){delete t._tmpIndex_})}var i=t.helpers;t.layoutService={defaults:{},addBox:function(t,e){t.boxes||(t.boxes=[]),e.fullWidth=e.fullWidth||!1,e.position=e.position||"top",e.weight=e.weight||0,t.boxes.push(e)},removeBox:function(t,e){var n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure:function(t,e,n){for(var i,a=["fullWidth","position","weight"],o=a.length,r=0;r<o;++r)i=a[r],n.hasOwnProperty(i)&&(e[i]=n[i])},update:function(t,a,o){function r(t){var e,n=t.isHorizontal();n?(e=t.update(t.fullWidth?k:I,D),A-=e.height):(e=t.update(C,S),I-=e.width),P.push({horizontal:n,minSize:e,box:t})}function l(t){var e=i.findNextWhere(P,function(e){return e.box===t});if(e)if(t.isHorizontal()){var n={left:Math.max(L,_),right:Math.max(V,T),top:0,bottom:0};t.update(t.fullWidth?k:I,w/2,n)}else t.update(e.minSize.width,A)}function s(t){var e=i.findNextWhere(P,function(e){return e.box===t}),n={left:0,right:0,top:O,bottom:z};e&&t.update(e.minSize.width,A,n)}function u(t){t.isHorizontal()?(t.left=t.fullWidth?h:L,t.right=t.fullWidth?a-f:L+I,t.top=q,t.bottom=q+t.height,q=t.bottom):(t.left=H,t.right=H+t.width,t.top=O,t.bottom=O+A,H=t.right)}if(t){var d=t.options.layout,c=d?d.padding:null,h=0,f=0,g=0,p=0;isNaN(c)?(h=c.left||0,f=c.right||0,g=c.top||0,p=c.bottom||0):(h=c,f=c,g=c,p=c);var m=e(t.boxes,"left"),v=e(t.boxes,"right"),b=e(t.boxes,"top"),x=e(t.boxes,"bottom"),y=e(t.boxes,"chartArea");n(m,!0),n(v,!1),n(b,!0),n(x,!1);var k=a-h-f,w=o-g-p,M=k/2,S=w/2,C=(a-M)/(m.length+v.length),D=(o-S)/(b.length+x.length),I=k,A=w,P=[];i.each(m.concat(v,b,x),r);var _=0,T=0,F=0,R=0;i.each(b.concat(x),function(t){if(t.getPadding){var e=t.getPadding();_=Math.max(_,e.left),T=Math.max(T,e.right)}}),i.each(m.concat(v),function(t){if(t.getPadding){var e=t.getPadding();F=Math.max(F,e.top),R=Math.max(R,e.bottom)}});var L=h,V=f,O=g,z=p;i.each(m.concat(v),l),i.each(m,function(t){L+=t.width}),i.each(v,function(t){V+=t.width}),i.each(b.concat(x),l),i.each(b,function(t){O+=t.height}),i.each(x,function(t){z+=t.height}),i.each(m.concat(v),s),L=h,V=f,O=g,z=p,i.each(m,function(t){L+=t.width}),i.each(v,function(t){V+=t.width}),i.each(b,function(t){O+=t.height}),i.each(x,function(t){z+=t.height});var B=Math.max(_-L,0);L+=B,V+=Math.max(T-V,0);var W=Math.max(F-O,0);O+=W,z+=Math.max(R-z,0);var N=o-O-z,E=a-L-V;E===I&&N===A||(i.each(m,function(t){t.height=N}),i.each(v,function(t){t.height=N}),i.each(b,function(t){t.fullWidth||(t.width=E)}),i.each(x,function(t){t.fullWidth||(t.width=E)}),A=N,I=E);var H=h+B,q=g+W;i.each(m.concat(b),u),H+=I,q+=A,i.each(v,u),i.each(x,u),t.chartArea={left:L,top:O,right:L+I,bottom:O+A},i.each(y,function(e){e.left=t.chartArea.left,e.top=t.chartArea.top,e.right=t.chartArea.right,e.bottom=t.chartArea.bottom,e.update(I,A)})}}}}},{}],30:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.defaults.global.plugins={},t.plugins={_plugins:[],_cacheId:0,register:function(t){var e=this._plugins;[].concat(t).forEach(function(t){e.indexOf(t)===-1&&e.push(t)}),this._cacheId++},unregister:function(t){var e=this._plugins;[].concat(t).forEach(function(t){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}),this._cacheId++},clear:function(){this._plugins=[],this._cacheId++},count:function(){return this._plugins.length},getAll:function(){return this._plugins},notify:function(t,e,n){var i,a,o,r,l,s=this.descriptors(t),u=s.length;for(i=0;i<u;++i)if(a=s[i],o=a.plugin,l=o[e],"function"==typeof l&&(r=[t].concat(n||[]),r.push(a.options),l.apply(o,r)===!1))return!1;return!0},descriptors:function(n){var i=n._plugins||(n._plugins={});if(i.id===this._cacheId)return i.descriptors;var a=[],o=[],r=n&&n.config||{},l=t.defaults.global.plugins,s=r.options&&r.options.plugins||{};return this._plugins.concat(r.plugins||[]).forEach(function(t){var n=a.indexOf(t);if(n===-1){var i=t.id,r=s[i];r!==!1&&(r===!0&&(r=e.clone(l[i])),a.push(t),o.push({plugin:t,options:r||{}}))}}),i.descriptors=o,i.id=this._cacheId,o}},t.pluginService=t.plugins,t.PluginBase=t.Element.extend({})}},{}],31:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e,n){return i.isArray(e)?i.longestText(t,n,e):t.measureText(e).width}function n(e){var n=i.getValueOrDefault,a=t.defaults.global,o=n(e.fontSize,a.defaultFontSize),r=n(e.fontStyle,a.defaultFontStyle),l=n(e.fontFamily,a.defaultFontFamily);return{size:o,style:r,family:l,font:i.fontString(o,r,l)}}var i=t.helpers;t.defaults.scale={display:!0,position:"left",gridLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineBorderDash:[],zeroLineBorderDashOffset:0,offsetGridLines:!1,borderDash:[],borderDashOffset:0},scaleLabel:{labelString:"",display:!1},ticks:{beginAtZero:!1,minRotation:0,maxRotation:50,mirror:!1,padding:0,reverse:!1,display:!0,autoSkip:!0,autoSkipPadding:0,labelOffset:0,callback:t.Ticks.formatters.values}},t.Scale=t.Element.extend({getPadding:function(){var t=this;return{left:t.paddingLeft||0,top:t.paddingTop||0,right:t.paddingRight||0,bottom:t.paddingBottom||0}},beforeUpdate:function(){i.callback(this.options.beforeUpdate,[this])},update:function(t,e,n){var a=this;return a.beforeUpdate(),a.maxWidth=t,a.maxHeight=e,a.margins=i.extend({left:0,right:0,top:0,bottom:0},n),a.longestTextCache=a.longestTextCache||{},a.beforeSetDimensions(),a.setDimensions(),a.afterSetDimensions(),a.beforeDataLimits(),a.determineDataLimits(),a.afterDataLimits(),a.beforeBuildTicks(),a.buildTicks(),a.afterBuildTicks(),a.beforeTickToLabelConversion(),a.convertTicksToLabels(),a.afterTickToLabelConversion(),a.beforeCalculateTickRotation(),a.calculateTickRotation(),a.afterCalculateTickRotation(),a.beforeFit(),a.fit(),a.afterFit(),a.afterUpdate(),a.minSize},afterUpdate:function(){i.callback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){i.callback(this.options.beforeSetDimensions,[this])},setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0},afterSetDimensions:function(){i.callback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){i.callback(this.options.beforeDataLimits,[this])},determineDataLimits:i.noop,afterDataLimits:function(){i.callback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){i.callback(this.options.beforeBuildTicks,[this])},buildTicks:i.noop,afterBuildTicks:function(){i.callback(this.options.afterBuildTicks,[this])},beforeTickToLabelConversion:function(){i.callback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){var t=this,e=t.options.ticks;t.ticks=t.ticks.map(e.userCallback||e.callback)},afterTickToLabelConversion:function(){i.callback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){i.callback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var t=this,e=t.ctx,a=t.options.ticks,o=n(a);e.font=o.font;var r=a.minRotation||0;if(t.options.display&&t.isHorizontal())for(var l,s,u=i.longestText(e,o.font,t.ticks,t.longestTextCache),d=u,c=t.getPixelForTick(1)-t.getPixelForTick(0)-6;d>c&&r<a.maxRotation;){var h=i.toRadians(r);if(l=Math.cos(h),s=Math.sin(h),s*u>t.maxHeight){r--;break}r++,d=l*u}t.labelRotation=r},afterCalculateTickRotation:function(){i.callback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){i.callback(this.options.beforeFit,[this])},fit:function(){var t=this,a=t.minSize={width:0,height:0},o=t.options,r=o.ticks,l=o.scaleLabel,s=o.gridLines,u=o.display,d=t.isHorizontal(),c=n(r),h=1.5*n(l).size,f=o.gridLines.tickMarkLength;if(d?a.width=t.isFullWidth()?t.maxWidth-t.margins.left-t.margins.right:t.maxWidth:a.width=u&&s.drawTicks?f:0,d?a.height=u&&s.drawTicks?f:0:a.height=t.maxHeight,l.display&&u&&(d?a.height+=h:a.width+=h),r.display&&u){var g=i.longestText(t.ctx,c.font,t.ticks,t.longestTextCache),p=i.numberOfLabelLines(t.ticks),m=.5*c.size;if(d){t.longestLabelWidth=g;var v=i.toRadians(t.labelRotation),b=Math.cos(v),x=Math.sin(v),y=x*g+c.size*p+m*p;a.height=Math.min(t.maxHeight,a.height+y),t.ctx.font=c.font;var k=t.ticks[0],w=e(t.ctx,k,c.font),M=t.ticks[t.ticks.length-1],S=e(t.ctx,M,c.font);0!==t.labelRotation?(t.paddingLeft="bottom"===o.position?b*w+3:b*m+3,t.paddingRight="bottom"===o.position?b*m+3:b*S+3):(t.paddingLeft=w/2+3,t.paddingRight=S/2+3)}else r.mirror?g=0:g+=t.options.ticks.padding,a.width=Math.min(t.maxWidth,a.width+g),t.paddingTop=c.size/2,t.paddingBottom=c.size/2}t.handleMargins(),t.width=a.width,t.height=a.height},handleMargins:function(){var t=this;t.margins&&(t.paddingLeft=Math.max(t.paddingLeft-t.margins.left,0),t.paddingTop=Math.max(t.paddingTop-t.margins.top,0),t.paddingRight=Math.max(t.paddingRight-t.margins.right,0),t.paddingBottom=Math.max(t.paddingBottom-t.margins.bottom,0))},afterFit:function(){i.callback(this.options.afterFit,[this])},isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},isFullWidth:function(){return this.options.fullWidth},getRightValue:function(t){return null===t||"undefined"==typeof t?NaN:"number"!=typeof t||isFinite(t)?"object"==typeof t?t instanceof Date||t.isValid?t:this.getRightValue(this.isHorizontal()?t.x:t.y):t:NaN},getLabelForIndex:i.noop,getPixelForValue:i.noop,getValueForPixel:i.noop,getPixelForTick:function(t,e){var n=this;if(n.isHorizontal()){var i=n.width-(n.paddingLeft+n.paddingRight),a=i/Math.max(n.ticks.length-(n.options.gridLines.offsetGridLines?0:1),1),o=a*t+n.paddingLeft;e&&(o+=a/2);var r=n.left+Math.round(o);return r+=n.isFullWidth()?n.margins.left:0}var l=n.height-(n.paddingTop+n.paddingBottom);return n.top+t*(l/(n.ticks.length-1))},getPixelForDecimal:function(t){var e=this;if(e.isHorizontal()){var n=e.width-(e.paddingLeft+e.paddingRight),i=n*t+e.paddingLeft,a=e.left+Math.round(i);return a+=e.isFullWidth()?e.margins.left:0}return e.top+t*e.height},getBasePixel:function(){return this.getPixelForValue(this.getBaseValue())},getBaseValue:function(){var t=this,e=t.min,n=t.max;return t.beginAtZero?0:e<0&&n<0?n:e>0&&n>0?e:0},draw:function(e){var a=this,o=a.options;if(o.display){var r,l,s=a.ctx,u=t.defaults.global,d=o.ticks,c=o.gridLines,h=o.scaleLabel,f=0!==a.labelRotation,g=d.autoSkip,p=a.isHorizontal();d.maxTicksLimit&&(l=d.maxTicksLimit);var m=i.getValueOrDefault(d.fontColor,u.defaultFontColor),v=n(d),b=c.drawTicks?c.tickMarkLength:0,x=i.getValueOrDefault(h.fontColor,u.defaultFontColor),y=n(h),k=i.toRadians(a.labelRotation),w=Math.cos(k),M=a.longestLabelWidth*w;s.fillStyle=m;var S=[];if(p){if(r=!1,(M+d.autoSkipPadding)*a.ticks.length>a.width-(a.paddingLeft+a.paddingRight)&&(r=1+Math.floor((M+d.autoSkipPadding)*a.ticks.length/(a.width-(a.paddingLeft+a.paddingRight)))),l&&a.ticks.length>l)for(;!r||a.ticks.length/(r||1)>l;)r||(r=1),r+=1;g||(r=!1)}var C="right"===o.position?a.left:a.right-b,D="right"===o.position?a.left+b:a.right,I="bottom"===o.position?a.top:a.bottom-b,A="bottom"===o.position?a.top+b:a.bottom;if(i.each(a.ticks,function(t,n){if(void 0!==t&&null!==t){var l=a.ticks.length===n+1,s=r>1&&n%r>0||n%r===0&&n+r>=a.ticks.length;if((!s||l)&&void 0!==t&&null!==t){var h,g,m,v;n===("undefined"!=typeof a.zeroLineIndex?a.zeroLineIndex:0)?(h=c.zeroLineWidth,g=c.zeroLineColor,m=c.zeroLineBorderDash,v=c.zeroLineBorderDashOffset):(h=i.getValueAtIndexOrDefault(c.lineWidth,n),g=i.getValueAtIndexOrDefault(c.color,n),m=i.getValueOrDefault(c.borderDash,u.borderDash),v=i.getValueOrDefault(c.borderDashOffset,u.borderDashOffset));var x,y,w,M,P,_,T,F,R,L,V="middle",O="middle";if(p){"bottom"===o.position?(O=f?"middle":"top",V=f?"right":"center",L=a.top+b):(O=f?"middle":"bottom",V=f?"left":"center",L=a.bottom-b);var z=a.getPixelForTick(n)+i.aliasPixel(h);R=a.getPixelForTick(n,c.offsetGridLines)+d.labelOffset,x=w=P=T=z,y=I,M=A,_=e.top,F=e.bottom}else{var B,W="left"===o.position,N=d.padding;d.mirror?(V=W?"left":"right",B=N):(V=W?"right":"left",
B=b+N),R=W?a.right-B:a.left+B;var E=a.getPixelForTick(n);E+=i.aliasPixel(h),L=a.getPixelForTick(n,c.offsetGridLines),x=C,w=D,P=e.left,T=e.right,y=M=_=F=E}S.push({tx1:x,ty1:y,tx2:w,ty2:M,x1:P,y1:_,x2:T,y2:F,labelX:R,labelY:L,glWidth:h,glColor:g,glBorderDash:m,glBorderDashOffset:v,rotation:-1*k,label:t,textBaseline:O,textAlign:V})}}}),i.each(S,function(t){if(c.display&&(s.save(),s.lineWidth=t.glWidth,s.strokeStyle=t.glColor,s.setLineDash&&(s.setLineDash(t.glBorderDash),s.lineDashOffset=t.glBorderDashOffset),s.beginPath(),c.drawTicks&&(s.moveTo(t.tx1,t.ty1),s.lineTo(t.tx2,t.ty2)),c.drawOnChartArea&&(s.moveTo(t.x1,t.y1),s.lineTo(t.x2,t.y2)),s.stroke(),s.restore()),d.display){s.save(),s.translate(t.labelX,t.labelY),s.rotate(t.rotation),s.font=v.font,s.textBaseline=t.textBaseline,s.textAlign=t.textAlign;var e=t.label;if(i.isArray(e))for(var n=0,a=0;n<e.length;++n)s.fillText(""+e[n],0,a),a+=1.5*v.size;else s.fillText(e,0,0);s.restore()}}),h.display){var P,_,T=0;if(p)P=a.left+(a.right-a.left)/2,_="bottom"===o.position?a.bottom-y.size/2:a.top+y.size/2;else{var F="left"===o.position;P=F?a.left+y.size/2:a.right-y.size/2,_=a.top+(a.bottom-a.top)/2,T=F?-.5*Math.PI:.5*Math.PI}s.save(),s.translate(P,_),s.rotate(T),s.textAlign="center",s.textBaseline="middle",s.fillStyle=x,s.font=y.font,s.fillText(h.labelString,0,0),s.restore()}if(c.drawBorder){s.lineWidth=i.getValueAtIndexOrDefault(c.lineWidth,0),s.strokeStyle=i.getValueAtIndexOrDefault(c.color,0);var R=a.left,L=a.right,V=a.top,O=a.bottom,z=i.aliasPixel(s.lineWidth);p?(V=O="top"===o.position?a.bottom:a.top,V+=z,O+=z):(R=L="left"===o.position?a.right:a.left,R+=z,L+=z),s.beginPath(),s.moveTo(R,V),s.lineTo(L,O),s.stroke()}}}})}},{}],32:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.scaleService={constructors:{},defaults:{},registerScaleType:function(t,n,i){this.constructors[t]=n,this.defaults[t]=e.clone(i)},getScaleConstructor:function(t){return this.constructors.hasOwnProperty(t)?this.constructors[t]:void 0},getScaleDefaults:function(n){return this.defaults.hasOwnProperty(n)?e.scaleMerge(t.defaults.scale,this.defaults[n]):{}},updateScaleDefaults:function(t,n){var i=this.defaults;i.hasOwnProperty(t)&&(i[t]=e.extend(i[t],n))},addScalesToLayout:function(n){e.each(n.scales,function(e){e.fullWidth=e.options.fullWidth,e.position=e.options.position,e.weight=e.options.weight,t.layoutService.addBox(n,e)})}}}},{}],33:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers;t.Ticks={generators:{linear:function(t,n){var i,a=[];if(t.stepSize&&t.stepSize>0)i=t.stepSize;else{var o=e.niceNum(n.max-n.min,!1);i=e.niceNum(o/(t.maxTicks-1),!0)}var r=Math.floor(n.min/i)*i,l=Math.ceil(n.max/i)*i;t.min&&t.max&&t.stepSize&&e.almostWhole((t.max-t.min)/t.stepSize,i/1e3)&&(r=t.min,l=t.max);var s=(l-r)/i;s=e.almostEquals(s,Math.round(s),i/1e3)?Math.round(s):Math.ceil(s),a.push(void 0!==t.min?t.min:r);for(var u=1;u<s;++u)a.push(r+u*i);return a.push(void 0!==t.max?t.max:l),a},logarithmic:function(t,n){var i,a,o=[],r=e.getValueOrDefault,l=r(t.min,Math.pow(10,Math.floor(e.log10(n.min)))),s=Math.floor(e.log10(n.max)),u=Math.ceil(n.max/Math.pow(10,s));0===l?(i=Math.floor(e.log10(n.minNotZero)),a=Math.floor(n.minNotZero/Math.pow(10,i)),o.push(l),l=a*Math.pow(10,i)):(i=Math.floor(e.log10(l)),a=Math.floor(l/Math.pow(10,i)));do o.push(l),++a,10===a&&(a=1,++i),l=a*Math.pow(10,i);while(i<s||i===s&&a<u);var d=r(t.max,l);return o.push(d),o}},formatters:{values:function(t){return e.isArray(t)?t:""+t},linear:function(t,n,i){var a=i.length>3?i[2]-i[1]:i[1]-i[0];Math.abs(a)>1&&t!==Math.floor(t)&&(a=t-Math.floor(t));var o=e.log10(Math.abs(a)),r="";if(0!==t){var l=-1*Math.floor(o);l=Math.max(Math.min(l,20),0),r=t.toFixed(l)}else r="0";return r},logarithmic:function(t,n,i){var a=t/Math.pow(10,Math.floor(e.log10(t)));return 0===t?"0":1===a||2===a||5===a||0===n||n===i.length-1?t.toExponential():""}}}}},{}],34:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){var n=s.color(t);return n.alpha(e*n.alpha()).rgbaString()}function n(t,e){return e&&(s.isArray(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function i(t){var e=t._xScale,n=t._yScale||t._scale,i=t._index,a=t._datasetIndex;return{xLabel:e?e.getLabelForIndex(i,a):"",yLabel:n?n.getLabelForIndex(i,a):"",index:i,datasetIndex:a,x:t._model.x,y:t._model.y}}function a(e){var n=t.defaults.global,i=s.getValueOrDefault;return{xPadding:e.xPadding,yPadding:e.yPadding,xAlign:e.xAlign,yAlign:e.yAlign,bodyFontColor:e.bodyFontColor,_bodyFontFamily:i(e.bodyFontFamily,n.defaultFontFamily),_bodyFontStyle:i(e.bodyFontStyle,n.defaultFontStyle),_bodyAlign:e.bodyAlign,bodyFontSize:i(e.bodyFontSize,n.defaultFontSize),bodySpacing:e.bodySpacing,titleFontColor:e.titleFontColor,_titleFontFamily:i(e.titleFontFamily,n.defaultFontFamily),_titleFontStyle:i(e.titleFontStyle,n.defaultFontStyle),titleFontSize:i(e.titleFontSize,n.defaultFontSize),_titleAlign:e.titleAlign,titleSpacing:e.titleSpacing,titleMarginBottom:e.titleMarginBottom,footerFontColor:e.footerFontColor,_footerFontFamily:i(e.footerFontFamily,n.defaultFontFamily),_footerFontStyle:i(e.footerFontStyle,n.defaultFontStyle),footerFontSize:i(e.footerFontSize,n.defaultFontSize),_footerAlign:e.footerAlign,footerSpacing:e.footerSpacing,footerMarginTop:e.footerMarginTop,caretSize:e.caretSize,cornerRadius:e.cornerRadius,backgroundColor:e.backgroundColor,opacity:0,legendColorBackground:e.multiKeyBackground,displayColors:e.displayColors,borderColor:e.borderColor,borderWidth:e.borderWidth}}function o(t,e){var n=t._chart.ctx,i=2*e.yPadding,a=0,o=e.body,r=o.reduce(function(t,e){return t+e.before.length+e.lines.length+e.after.length},0);r+=e.beforeBody.length+e.afterBody.length;var l=e.title.length,u=e.footer.length,d=e.titleFontSize,c=e.bodyFontSize,h=e.footerFontSize;i+=l*d,i+=l?(l-1)*e.titleSpacing:0,i+=l?e.titleMarginBottom:0,i+=r*c,i+=r?(r-1)*e.bodySpacing:0,i+=u?e.footerMarginTop:0,i+=u*h,i+=u?(u-1)*e.footerSpacing:0;var f=0,g=function(t){a=Math.max(a,n.measureText(t).width+f)};return n.font=s.fontString(d,e._titleFontStyle,e._titleFontFamily),s.each(e.title,g),n.font=s.fontString(c,e._bodyFontStyle,e._bodyFontFamily),s.each(e.beforeBody.concat(e.afterBody),g),f=e.displayColors?c+2:0,s.each(o,function(t){s.each(t.before,g),s.each(t.lines,g),s.each(t.after,g)}),f=0,n.font=s.fontString(h,e._footerFontStyle,e._footerFontFamily),s.each(e.footer,g),a+=2*e.xPadding,{width:a,height:i}}function r(t,e){var n=t._model,i=t._chart,a=t._chart.chartArea,o="center",r="center";n.y<e.height?r="top":n.y>i.height-e.height&&(r="bottom");var l,s,u,d,c,h=(a.left+a.right)/2,f=(a.top+a.bottom)/2;"center"===r?(l=function(t){return t<=h},s=function(t){return t>h}):(l=function(t){return t<=e.width/2},s=function(t){return t>=i.width-e.width/2}),u=function(t){return t+e.width>i.width},d=function(t){return t-e.width<0},c=function(t){return t<=f?"top":"bottom"},l(n.x)?(o="left",u(n.x)&&(o="center",r=c(n.y))):s(n.x)&&(o="right",d(n.x)&&(o="center",r=c(n.y)));var g=t._options;return{xAlign:g.xAlign?g.xAlign:o,yAlign:g.yAlign?g.yAlign:r}}function l(t,e,n){var i=t.x,a=t.y,o=t.caretSize,r=t.caretPadding,l=t.cornerRadius,s=n.xAlign,u=n.yAlign,d=o+r,c=l+r;return"right"===s?i-=e.width:"center"===s&&(i-=e.width/2),"top"===u?a+=d:a-="bottom"===u?e.height+d:e.height/2,"center"===u?"left"===s?i+=d:"right"===s&&(i-=d):"left"===s?i-=c:"right"===s&&(i+=c),{x:i,y:a}}var s=t.helpers;t.defaults.global.tooltips={enabled:!0,custom:null,mode:"nearest",position:"average",intersect:!0,backgroundColor:"rgba(0,0,0,0.8)",titleFontStyle:"bold",titleSpacing:2,titleMarginBottom:6,titleFontColor:"#fff",titleAlign:"left",bodySpacing:2,bodyFontColor:"#fff",bodyAlign:"left",footerFontStyle:"bold",footerSpacing:2,footerMarginTop:6,footerFontColor:"#fff",footerAlign:"left",yPadding:6,xPadding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,callbacks:{beforeTitle:s.noop,title:function(t,e){var n="",i=e.labels,a=i?i.length:0;if(t.length>0){var o=t[0];o.xLabel?n=o.xLabel:a>0&&o.index<a&&(n=i[o.index])}return n},afterTitle:s.noop,beforeBody:s.noop,beforeLabel:s.noop,label:function(t,e){var n=e.datasets[t.datasetIndex].label||"";return n&&(n+=": "),n+=t.yLabel},labelColor:function(t,e){var n=e.getDatasetMeta(t.datasetIndex),i=n.data[t.index],a=i._view;return{borderColor:a.borderColor,backgroundColor:a.backgroundColor}},afterLabel:s.noop,afterBody:s.noop,beforeFooter:s.noop,footer:s.noop,afterFooter:s.noop}},t.Tooltip=t.Element.extend({initialize:function(){this._model=a(this._options)},getTitle:function(){var t=this,e=t._options,i=e.callbacks,a=i.beforeTitle.apply(t,arguments),o=i.title.apply(t,arguments),r=i.afterTitle.apply(t,arguments),l=[];return l=n(l,a),l=n(l,o),l=n(l,r)},getBeforeBody:function(){var t=this._options.callbacks.beforeBody.apply(this,arguments);return s.isArray(t)?t:void 0!==t?[t]:[]},getBody:function(t,e){var i=this,a=i._options.callbacks,o=[];return s.each(t,function(t){var r={before:[],lines:[],after:[]};n(r.before,a.beforeLabel.call(i,t,e)),n(r.lines,a.label.call(i,t,e)),n(r.after,a.afterLabel.call(i,t,e)),o.push(r)}),o},getAfterBody:function(){var t=this._options.callbacks.afterBody.apply(this,arguments);return s.isArray(t)?t:void 0!==t?[t]:[]},getFooter:function(){var t=this,e=t._options.callbacks,i=e.beforeFooter.apply(t,arguments),a=e.footer.apply(t,arguments),o=e.afterFooter.apply(t,arguments),r=[];return r=n(r,i),r=n(r,a),r=n(r,o)},update:function(e){var n,u,d=this,c=d._options,h=d._model,f=d._model=a(c),g=d._active,p=d._data,m={xAlign:h.xAlign,yAlign:h.yAlign},v={x:h.x,y:h.y},b={width:h.width,height:h.height},x={x:h.caretX,y:h.caretY};if(g.length){f.opacity=1;var y=[];x=t.Tooltip.positioners[c.position](g,d._eventPosition);var k=[];for(n=0,u=g.length;n<u;++n)k.push(i(g[n]));c.filter&&(k=k.filter(function(t){return c.filter(t,p)})),c.itemSort&&(k=k.sort(function(t,e){return c.itemSort(t,e,p)})),s.each(k,function(t){y.push(c.callbacks.labelColor.call(d,t,d._chart))}),f.title=d.getTitle(k,p),f.beforeBody=d.getBeforeBody(k,p),f.body=d.getBody(k,p),f.afterBody=d.getAfterBody(k,p),f.footer=d.getFooter(k,p),f.x=Math.round(x.x),f.y=Math.round(x.y),f.caretPadding=c.caretPadding,f.labelColors=y,f.dataPoints=k,b=o(this,f),m=r(this,b),v=l(f,b,m)}else f.opacity=0;return f.xAlign=m.xAlign,f.yAlign=m.yAlign,f.x=v.x,f.y=v.y,f.width=b.width,f.height=b.height,f.caretX=x.x,f.caretY=x.y,d._model=f,e&&c.custom&&c.custom.call(d,f),d},drawCaret:function(t,e){var n=this._chart.ctx,i=this._view,a=this.getCaretPosition(t,e,i);n.lineTo(a.x1,a.y1),n.lineTo(a.x2,a.y2),n.lineTo(a.x3,a.y3)},getCaretPosition:function(t,e,n){var i,a,o,r,l,s,u=n.caretSize,d=n.cornerRadius,c=n.xAlign,h=n.yAlign,f=t.x,g=t.y,p=e.width,m=e.height;if("center"===h)l=g+m/2,"left"===c?(i=f,a=i-u,o=i,r=l+u,s=l-u):(i=f+p,a=i+u,o=i,r=l-u,s=l+u);else if("left"===c?(a=f+d+u,i=a-u,o=a+u):"right"===c?(a=f+p-d-u,i=a-u,o=a+u):(a=f+p/2,i=a-u,o=a+u),"top"===h)r=g,l=r-u,s=r;else{r=g+m,l=r+u,s=r;var v=o;o=i,i=v}return{x1:i,x2:a,x3:o,y1:r,y2:l,y3:s}},drawTitle:function(t,n,i,a){var o=n.title;if(o.length){i.textAlign=n._titleAlign,i.textBaseline="top";var r=n.titleFontSize,l=n.titleSpacing;i.fillStyle=e(n.titleFontColor,a),i.font=s.fontString(r,n._titleFontStyle,n._titleFontFamily);var u,d;for(u=0,d=o.length;u<d;++u)i.fillText(o[u],t.x,t.y),t.y+=r+l,u+1===o.length&&(t.y+=n.titleMarginBottom-l)}},drawBody:function(t,n,i,a){var o=n.bodyFontSize,r=n.bodySpacing,l=n.body;i.textAlign=n._bodyAlign,i.textBaseline="top";var u=e(n.bodyFontColor,a);i.fillStyle=u,i.font=s.fontString(o,n._bodyFontStyle,n._bodyFontFamily);var d=0,c=function(e){i.fillText(e,t.x+d,t.y),t.y+=o+r};s.each(n.beforeBody,c);var h=n.displayColors;d=h?o+2:0,s.each(l,function(r,l){s.each(r.before,c),s.each(r.lines,function(r){h&&(i.fillStyle=e(n.legendColorBackground,a),i.fillRect(t.x,t.y,o,o),i.strokeStyle=e(n.labelColors[l].borderColor,a),i.strokeRect(t.x,t.y,o,o),i.fillStyle=e(n.labelColors[l].backgroundColor,a),i.fillRect(t.x+1,t.y+1,o-2,o-2),i.fillStyle=u),c(r)}),s.each(r.after,c)}),d=0,s.each(n.afterBody,c),t.y-=r},drawFooter:function(t,n,i,a){var o=n.footer;o.length&&(t.y+=n.footerMarginTop,i.textAlign=n._footerAlign,i.textBaseline="top",i.fillStyle=e(n.footerFontColor,a),i.font=s.fontString(n.footerFontSize,n._footerFontStyle,n._footerFontFamily),s.each(o,function(e){i.fillText(e,t.x,t.y),t.y+=n.footerFontSize+n.footerSpacing}))},drawBackground:function(t,n,i,a,o){i.fillStyle=e(n.backgroundColor,o),i.strokeStyle=e(n.borderColor,o),i.lineWidth=n.borderWidth;var r=n.xAlign,l=n.yAlign,s=t.x,u=t.y,d=a.width,c=a.height,h=n.cornerRadius;i.beginPath(),i.moveTo(s+h,u),"top"===l&&this.drawCaret(t,a),i.lineTo(s+d-h,u),i.quadraticCurveTo(s+d,u,s+d,u+h),"center"===l&&"right"===r&&this.drawCaret(t,a),i.lineTo(s+d,u+c-h),i.quadraticCurveTo(s+d,u+c,s+d-h,u+c),"bottom"===l&&this.drawCaret(t,a),i.lineTo(s+h,u+c),i.quadraticCurveTo(s,u+c,s,u+c-h),"center"===l&&"left"===r&&this.drawCaret(t,a),i.lineTo(s,u+h),i.quadraticCurveTo(s,u,s+h,u),i.closePath(),i.fill(),n.borderWidth>0&&i.stroke()},draw:function(){var t=this._chart.ctx,e=this._view;if(0!==e.opacity){var n={width:e.width,height:e.height},i={x:e.x,y:e.y},a=Math.abs(e.opacity<.001)?0:e.opacity,o=e.title.length||e.beforeBody.length||e.body.length||e.afterBody.length||e.footer.length;this._options.enabled&&o&&(this.drawBackground(i,e,t,n,a),i.x+=e.xPadding,i.y+=e.yPadding,this.drawTitle(i,e,t,a),this.drawBody(i,e,t,a),this.drawFooter(i,e,t,a))}},handleEvent:function(t){var e=this,n=e._options,i=!1;if(e._lastActive=e._lastActive||[],"mouseout"===t.type?e._active=[]:e._active=e._chart.getElementsAtEventForMode(t,n.mode,n),i=!s.arrayEquals(e._active,e._lastActive),!i)return!1;if(e._lastActive=e._active,n.enabled||n.custom){e._eventPosition={x:t.x,y:t.y};var a=e._model;e.update(!0),e.pivot(),i|=a.x!==e._model.x||a.y!==e._model.y}return i}}),t.Tooltip.positioners={average:function(t){if(!t.length)return!1;var e,n,i=0,a=0,o=0;for(e=0,n=t.length;e<n;++e){var r=t[e];if(r&&r.hasValue()){var l=r.tooltipPosition();i+=l.x,a+=l.y,++o}}return{x:Math.round(i/o),y:Math.round(a/o)}},nearest:function(t,e){var n,i,a,o=e.x,r=e.y,l=Number.POSITIVE_INFINITY;for(i=0,a=t.length;i<a;++i){var u=t[i];if(u&&u.hasValue()){var d=u.getCenterPoint(),c=s.distanceBetweenPoints(e,d);c<l&&(l=c,n=u)}}if(n){var h=n.tooltipPosition();o=h.x,r=h.y}return{x:o,y:r}}}}},{}],35:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n=t.defaults.global;n.elements.arc={backgroundColor:n.defaultColor,borderColor:"#fff",borderWidth:2},t.elements.Arc=t.Element.extend({inLabelRange:function(t){var e=this._view;return!!e&&Math.pow(t-e.x,2)<Math.pow(e.radius+e.hoverRadius,2)},inRange:function(t,n){var i=this._view;if(i){for(var a=e.getAngleFromPoint(i,{x:t,y:n}),o=a.angle,r=a.distance,l=i.startAngle,s=i.endAngle;s<l;)s+=2*Math.PI;for(;o>s;)o-=2*Math.PI;for(;o<l;)o+=2*Math.PI;var u=o>=l&&o<=s,d=r>=i.innerRadius&&r<=i.outerRadius;return u&&d}return!1},getCenterPoint:function(){var t=this._view,e=(t.startAngle+t.endAngle)/2,n=(t.innerRadius+t.outerRadius)/2;return{x:t.x+Math.cos(e)*n,y:t.y+Math.sin(e)*n}},getArea:function(){var t=this._view;return Math.PI*((t.endAngle-t.startAngle)/(2*Math.PI))*(Math.pow(t.outerRadius,2)-Math.pow(t.innerRadius,2))},tooltipPosition:function(){var t=this._view,e=t.startAngle+(t.endAngle-t.startAngle)/2,n=(t.outerRadius-t.innerRadius)/2+t.innerRadius;return{x:t.x+Math.cos(e)*n,y:t.y+Math.sin(e)*n}},draw:function(){var t=this._chart.ctx,e=this._view,n=e.startAngle,i=e.endAngle;t.beginPath(),t.arc(e.x,e.y,e.outerRadius,n,i),t.arc(e.x,e.y,e.innerRadius,i,n,!0),t.closePath(),t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,t.fillStyle=e.backgroundColor,t.fill(),t.lineJoin="bevel",e.borderWidth&&t.stroke()}})}},{}],36:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n=t.defaults.global;t.defaults.global.elements.line={tension:.4,backgroundColor:n.defaultColor,borderWidth:3,borderColor:n.defaultColor,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",capBezierPoints:!0,fill:!0},t.elements.Line=t.Element.extend({draw:function(){var t,i,a,o,r=this,l=r._view,s=r._chart.ctx,u=l.spanGaps,d=r._children.slice(),c=n.elements.line,h=-1;for(r._loop&&d.length&&d.push(d[0]),s.save(),s.lineCap=l.borderCapStyle||c.borderCapStyle,s.setLineDash&&s.setLineDash(l.borderDash||c.borderDash),s.lineDashOffset=l.borderDashOffset||c.borderDashOffset,s.lineJoin=l.borderJoinStyle||c.borderJoinStyle,s.lineWidth=l.borderWidth||c.borderWidth,s.strokeStyle=l.borderColor||n.defaultColor,s.beginPath(),h=-1,t=0;t<d.length;++t)i=d[t],a=e.previousItem(d,t),o=i._view,0===t?o.skip||(s.moveTo(o.x,o.y),h=t):(a=h===-1?a:d[h],o.skip||(h!==t-1&&!u||h===-1?s.moveTo(o.x,o.y):e.canvas.lineTo(s,a._view,i._view),h=t));s.stroke(),s.restore()}})}},{}],37:[function(t,e,n){"use strict";e.exports=function(t){function e(t){var e=this._view;return!!e&&Math.pow(t-e.x,2)<Math.pow(e.radius+e.hitRadius,2)}function n(t){var e=this._view;return!!e&&Math.pow(t-e.y,2)<Math.pow(e.radius+e.hitRadius,2)}var i=t.helpers,a=t.defaults.global,o=a.defaultColor;a.elements.point={radius:3,pointStyle:"circle",backgroundColor:o,borderWidth:1,borderColor:o,hitRadius:1,hoverRadius:4,hoverBorderWidth:1},t.elements.Point=t.Element.extend({inRange:function(t,e){var n=this._view;return!!n&&Math.pow(t-n.x,2)+Math.pow(e-n.y,2)<Math.pow(n.hitRadius+n.radius,2)},inLabelRange:e,inXRange:e,inYRange:n,getCenterPoint:function(){var t=this._view;return{x:t.x,y:t.y}},getArea:function(){return Math.PI*Math.pow(this._view.radius,2)},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y,padding:t.radius+t.borderWidth}},draw:function(e){var n=this._view,r=this._model,l=this._chart.ctx,s=n.pointStyle,u=n.radius,d=n.x,c=n.y,h=t.helpers.color,f=1.01,g=0;n.skip||(l.strokeStyle=n.borderColor||o,l.lineWidth=i.getValueOrDefault(n.borderWidth,a.elements.point.borderWidth),l.fillStyle=n.backgroundColor||o,void 0!==e&&(r.x<e.left||e.right*f<r.x||r.y<e.top||e.bottom*f<r.y)&&(r.x<e.left?g=(d-r.x)/(e.left-r.x):e.right*f<r.x?g=(r.x-d)/(r.x-e.right):r.y<e.top?g=(c-r.y)/(e.top-r.y):e.bottom*f<r.y&&(g=(r.y-c)/(r.y-e.bottom)),g=Math.round(100*g)/100,l.strokeStyle=h(l.strokeStyle).alpha(g).rgbString(),l.fillStyle=h(l.fillStyle).alpha(g).rgbString()),t.canvasHelpers.drawPoint(l,s,u,d,c))}})}},{}],38:[function(t,e,n){"use strict";e.exports=function(t){function e(t){return void 0!==t._view.width}function n(t){var n,i,a,o,r=t._view;if(e(t)){var l=r.width/2;n=r.x-l,i=r.x+l,a=Math.min(r.y,r.base),o=Math.max(r.y,r.base)}else{var s=r.height/2;n=Math.min(r.x,r.base),i=Math.max(r.x,r.base),a=r.y-s,o=r.y+s}return{left:n,top:a,right:i,bottom:o}}var i=t.defaults.global;i.elements.rectangle={backgroundColor:i.defaultColor,borderWidth:0,borderColor:i.defaultColor,borderSkipped:"bottom"},t.elements.Rectangle=t.Element.extend({draw:function(){function t(t){return v[(x+t)%4]}var e,n,i,a,o,r,l,s=this._chart.ctx,u=this._view,d=u.borderWidth;if(u.horizontal?(e=u.base,n=u.x,i=u.y-u.height/2,a=u.y+u.height/2,o=n>e?1:-1,r=1,l=u.borderSkipped||"left"):(e=u.x-u.width/2,n=u.x+u.width/2,i=u.y,a=u.base,o=1,r=a>i?1:-1,l=u.borderSkipped||"bottom"),d){var c=Math.min(Math.abs(e-n),Math.abs(i-a));d=d>c?c:d;var h=d/2,f=e+("left"!==l?h*o:0),g=n+("right"!==l?-h*o:0),p=i+("top"!==l?h*r:0),m=a+("bottom"!==l?-h*r:0);f!==g&&(i=p,a=m),p!==m&&(e=f,n=g)}s.beginPath(),s.fillStyle=u.backgroundColor,s.strokeStyle=u.borderColor,s.lineWidth=d;var v=[[e,a],[e,i],[n,i],[n,a]],b=["bottom","left","top","right"],x=b.indexOf(l,0);x===-1&&(x=0);var y=t(0);s.moveTo(y[0],y[1]);for(var k=1;k<4;k++)y=t(k),s.lineTo(y[0],y[1]);s.fill(),d&&s.stroke()},height:function(){var t=this._view;return t.base-t.y},inRange:function(t,e){var i=!1;if(this._view){var a=n(this);i=t>=a.left&&t<=a.right&&e>=a.top&&e<=a.bottom}return i},inLabelRange:function(t,i){var a=this;if(!a._view)return!1;var o=!1,r=n(a);return o=e(a)?t>=r.left&&t<=r.right:i>=r.top&&i<=r.bottom},inXRange:function(t){var e=n(this);return t>=e.left&&t<=e.right},inYRange:function(t){var e=n(this);return t>=e.top&&t<=e.bottom},getCenterPoint:function(){var t,n,i=this._view;return e(this)?(t=i.x,n=(i.y+i.base)/2):(t=(i.x+i.base)/2,n=i.y),{x:t,y:n}},getArea:function(){var t=this._view;return t.width*Math.abs(t.y-t.base)},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y}}})}},{}],39:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){var n=s.getStyle(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?Number(i[1]):void 0}function n(t,n){var i=t.style,a=t.getAttribute("height"),o=t.getAttribute("width");if(t._chartjs={initial:{height:a,width:o,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",null===o||""===o){var r=e(t,"width");void 0!==r&&(t.width=r)}if(null===a||""===a)if(""===t.style.height)t.height=t.width/(n.options.aspectRatio||2);else{var l=e(t,"height");void 0!==r&&(t.height=l)}return t}function i(t,e,n,i,a){return{type:t,chart:e,native:a||null,x:void 0!==n?n:null,y:void 0!==i?i:null}}function a(t,e){var n=u[t.type]||t.type,a=s.getRelativePosition(t,e);return i(n,e,a.x,a.y,t)}function o(t){var e=document.createElement("iframe");return e.className="chartjs-hidden-iframe",e.style.cssText="display:block;overflow:hidden;border:0;margin:0;top:0;left:0;bottom:0;right:0;height:100%;width:100%;position:absolute;pointer-events:none;z-index:-1;",e.tabIndex=-1,s.addEvent(e,"load",function(){s.addEvent(e.contentWindow||e,"resize",t),t()}),e}function r(t,e,n){var a=t._chartjs={ticking:!1},r=function(){a.ticking||(a.ticking=!0,s.requestAnimFrame.call(window,function(){if(a.resizer)return a.ticking=!1,e(i("resize",n))}))};a.resizer=o(r),t.insertBefore(a.resizer,t.firstChild)}function l(t){if(t&&t._chartjs){var e=t._chartjs.resizer;e&&(e.parentNode.removeChild(e),t._chartjs.resizer=null),delete t._chartjs}}var s=t.helpers,u={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"};return{acquireContext:function(t,e){"string"==typeof t?t=document.getElementById(t):t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas);var i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(n(t,e),i):null},releaseContext:function(t){var e=t.canvas;if(e._chartjs){var n=e._chartjs.initial;["height","width"].forEach(function(t){var i=n[t];void 0===i||null===i?e.removeAttribute(t):e.setAttribute(t,i)}),s.each(n.style||{},function(t,n){e.style[n]=t}),e.width=e.width,delete e._chartjs}},addEventListener:function(t,e,n){var i=t.canvas;if("resize"===e)return void r(i.parentNode,n,t);var o=n._chartjs||(n._chartjs={}),l=o.proxies||(o.proxies={}),u=l[t.id+"_"+e]=function(e){n(a(e,t))};s.addEvent(i,e,u)},removeEventListener:function(t,e,n){var i=t.canvas;if("resize"===e)return void l(i.parentNode,n);var a=n._chartjs||{},o=a.proxies||{},r=o[t.id+"_"+e];r&&s.removeEvent(i,e,r)}}}},{}],40:[function(t,e,n){"use strict";var i=t(39);e.exports=function(t){t.platform={acquireContext:function(){},releaseContext:function(){},addEventListener:function(){},removeEventListener:function(){}},t.helpers.extend(t.platform,i(t))}},{39:39}],41:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e,n){var i,a=t._model||{},o=a.fill;if(void 0===o&&(o=!!a.backgroundColor),o===!1||null===o)return!1;if(o===!0)return"origin";if(i=parseFloat(o,10),isFinite(i)&&Math.floor(i)===i)return"-"!==o[0]&&"+"!==o[0]||(i=e+i),!(i===e||i<0||i>=n)&&i;switch(o){case"bottom":return"start";case"top":return"end";case"zero":return"origin";case"origin":case"start":case"end":return o;default:return!1}}function n(t){var e,n=t.el._model||{},i=t.el._scale||{},a=t.fill,o=null;if(isFinite(a))return null;if("start"===a?o=void 0===n.scaleBottom?i.bottom:n.scaleBottom:"end"===a?o=void 0===n.scaleTop?i.top:n.scaleTop:void 0!==n.scaleZero?o=n.scaleZero:i.getBasePosition?o=i.getBasePosition():i.getBasePixel&&(o=i.getBasePixel()),void 0!==o&&null!==o){if(void 0!==o.x&&void 0!==o.y)return o;if("number"==typeof o&&isFinite(o))return e=i.isHorizontal(),{x:e?o:null,y:e?null:o}}return null}function i(t,e,n){var i,a=t[e],o=a.fill,r=[e];if(!n)return o;for(;o!==!1&&r.indexOf(o)===-1;){if(!isFinite(o))return o;if(i=t[o],!i)return!1;if(i.visible)return o;r.push(o),o=i.fill}return!1}function a(t){var e=t.fill,n="dataset";return e===!1?null:(isFinite(e)||(n="boundary"),d[n](t))}function o(t){return t&&!t.skip}function r(t,e,n,i,a){var o;if(i&&a){for(t.moveTo(e[0].x,e[0].y),o=1;o<i;++o)u.canvas.lineTo(t,e[o-1],e[o]);for(t.lineTo(n[a-1].x,n[a-1].y),o=a-1;o>0;--o)u.canvas.lineTo(t,n[o],n[o-1],!0)}}function l(t,e,n,i,a,l){var s,u,d,c,h,f,g,p=e.length,m=i.spanGaps,v=[],b=[],x=0,y=0;for(t.beginPath(),s=0,u=p+!!l;s<u;++s)d=s%p,c=e[d]._view,h=n(c,d,i),f=o(c),g=o(h),f&&g?(x=v.push(c),y=b.push(h)):x&&y&&(m?(f&&v.push(c),g&&b.push(h)):(r(t,v,b,x,y),x=y=0,v=[],b=[]));r(t,v,b,x,y),t.closePath(),t.fillStyle=a,t.fill()}t.defaults.global.plugins.filler={propagate:!0};var s=t.defaults,u=t.helpers,d={dataset:function(t){var e=t.fill,n=t.chart,i=n.getDatasetMeta(e),a=i&&n.isDatasetVisible(e),o=a&&i.dataset._children||[];return o.length?function(t,e){return o[e]._view||null}:null},boundary:function(t){var e=t.boundary,n=e?e.x:null,i=e?e.y:null;return function(t){return{x:null===n?t.x:n,y:null===i?t.y:i}}}};return{id:"filler",afterDatasetsUpdate:function(o,r){var l,s,u,d,c=(o.data.datasets||[]).length,h=r.propagate,f=[];for(s=0;s<c;++s)l=o.getDatasetMeta(s),u=l.dataset,d=null,u&&u._model&&u instanceof t.elements.Line&&(d={visible:o.isDatasetVisible(s),fill:e(u,s,c),chart:o,el:u}),l.$filler=d,f.push(d);for(s=0;s<c;++s)d=f[s],d&&(d.fill=i(f,s,h),d.boundary=n(d),d.mapper=a(d))},beforeDatasetDraw:function(t,e){var n=e.meta.$filler;if(n){var i=n.el,a=i._view,o=i._children||[],r=n.mapper,u=a.backgroundColor||s.global.defaultColor;r&&u&&o.length&&l(t.ctx,o,r,a,u,i._loop)}}}}},{}],42:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){return t.usePointStyle?e*Math.SQRT2:t.boxWidth}function n(e,n){var i=new t.Legend({ctx:e.ctx,options:n,chart:e});a.configure(e,i,n),a.addBox(e,i),e.legend=i}var i=t.helpers,a=t.layoutService,o=i.noop;return t.defaults.global.legend={display:!0,position:"top",fullWidth:!0,reverse:!1,weight:1e3,onClick:function(t,e){var n=e.datasetIndex,i=this.chart,a=i.getDatasetMeta(n);a.hidden=null===a.hidden?!i.data.datasets[n].hidden:null,i.update()},onHover:null,labels:{boxWidth:40,padding:10,generateLabels:function(t){var e=t.data;return i.isArray(e.datasets)?e.datasets.map(function(e,n){return{text:e.label,fillStyle:i.isArray(e.backgroundColor)?e.backgroundColor[0]:e.backgroundColor,hidden:!t.isDatasetVisible(n),lineCap:e.borderCapStyle,lineDash:e.borderDash,lineDashOffset:e.borderDashOffset,lineJoin:e.borderJoinStyle,lineWidth:e.borderWidth,strokeStyle:e.borderColor,pointStyle:e.pointStyle,datasetIndex:n}},this):[]}}},t.Legend=t.Element.extend({initialize:function(t){i.extend(this,t),this.legendHitBoxes=[],this.doughnutMode=!1},beforeUpdate:o,update:function(t,e,n){var i=this;return i.beforeUpdate(),i.maxWidth=t,i.maxHeight=e,i.margins=n,i.beforeSetDimensions(),i.setDimensions(),i.afterSetDimensions(),i.beforeBuildLabels(),i.buildLabels(),i.afterBuildLabels(),i.beforeFit(),i.fit(),i.afterFit(),i.afterUpdate(),i.minSize},afterUpdate:o,beforeSetDimensions:o,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:o,beforeBuildLabels:o,buildLabels:function(){var t=this,e=t.options.labels,n=e.generateLabels.call(t,t.chart);e.filter&&(n=n.filter(function(n){return e.filter(n,t.chart.data)})),t.options.reverse&&n.reverse(),t.legendItems=n},afterBuildLabels:o,beforeFit:o,fit:function(){var n=this,a=n.options,o=a.labels,r=a.display,l=n.ctx,s=t.defaults.global,u=i.getValueOrDefault,d=u(o.fontSize,s.defaultFontSize),c=u(o.fontStyle,s.defaultFontStyle),h=u(o.fontFamily,s.defaultFontFamily),f=i.fontString(d,c,h),g=n.legendHitBoxes=[],p=n.minSize,m=n.isHorizontal();if(m?(p.width=n.maxWidth,p.height=r?10:0):(p.width=r?10:0,p.height=n.maxHeight),r)if(l.font=f,m){var v=n.lineWidths=[0],b=n.legendItems.length?d+o.padding:0;l.textAlign="left",l.textBaseline="top",i.each(n.legendItems,function(t,i){var a=e(o,d),r=a+d/2+l.measureText(t.text).width;v[v.length-1]+r+o.padding>=n.width&&(b+=d+o.padding,v[v.length]=n.left),g[i]={left:0,top:0,width:r,height:d},v[v.length-1]+=r+o.padding}),p.height+=b}else{var x=o.padding,y=n.columnWidths=[],k=o.padding,w=0,M=0,S=d+x;i.each(n.legendItems,function(t,n){var i=e(o,d),a=i+d/2+l.measureText(t.text).width;M+S>p.height&&(k+=w+o.padding,y.push(w),w=0,M=0),w=Math.max(w,a),M+=S,g[n]={left:0,top:0,width:a,height:d}}),k+=w,y.push(w),p.width+=k}n.width=p.width,n.height=p.height},afterFit:o,isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},draw:function(){var n=this,a=n.options,o=a.labels,r=t.defaults.global,l=r.elements.line,s=n.width,u=n.lineWidths;if(a.display){var d,c=n.ctx,h=i.getValueOrDefault,f=h(o.fontColor,r.defaultFontColor),g=h(o.fontSize,r.defaultFontSize),p=h(o.fontStyle,r.defaultFontStyle),m=h(o.fontFamily,r.defaultFontFamily),v=i.fontString(g,p,m);c.textAlign="left",c.textBaseline="top",c.lineWidth=.5,c.strokeStyle=f,c.fillStyle=f,c.font=v;var b=e(o,g),x=n.legendHitBoxes,y=function(e,n,i){if(!(isNaN(b)||b<=0)){c.save(),c.fillStyle=h(i.fillStyle,r.defaultColor),c.lineCap=h(i.lineCap,l.borderCapStyle),c.lineDashOffset=h(i.lineDashOffset,l.borderDashOffset),c.lineJoin=h(i.lineJoin,l.borderJoinStyle),c.lineWidth=h(i.lineWidth,l.borderWidth),c.strokeStyle=h(i.strokeStyle,r.defaultColor);var o=0===h(i.lineWidth,l.borderWidth);if(c.setLineDash&&c.setLineDash(h(i.lineDash,l.borderDash)),a.labels&&a.labels.usePointStyle){var s=g*Math.SQRT2/2,u=s/Math.SQRT2,d=e+u,f=n+u;t.canvasHelpers.drawPoint(c,i.pointStyle,s,d,f)}else o||c.strokeRect(e,n,b,g),c.fillRect(e,n,b,g);c.restore()}},k=function(t,e,n,i){c.fillText(n.text,b+g/2+t,e),n.hidden&&(c.beginPath(),c.lineWidth=2,c.moveTo(b+g/2+t,e+g/2),c.lineTo(b+g/2+t+i,e+g/2),c.stroke())},w=n.isHorizontal();d=w?{x:n.left+(s-u[0])/2,y:n.top+o.padding,line:0}:{x:n.left+o.padding,y:n.top+o.padding,line:0};var M=g+o.padding;i.each(n.legendItems,function(t,e){var i=c.measureText(t.text).width,a=b+g/2+i,r=d.x,l=d.y;w?r+a>=s&&(l=d.y+=M,d.line++,r=d.x=n.left+(s-u[d.line])/2):l+M>n.bottom&&(r=d.x=r+n.columnWidths[d.line]+o.padding,l=d.y=n.top+o.padding,d.line++),y(r,l,t),x[e].left=r,x[e].top=l,k(r,l,t,i),w?d.x+=a+o.padding:d.y+=M})}},handleEvent:function(t){var e=this,n=e.options,i="mouseup"===t.type?"click":t.type,a=!1;if("mousemove"===i){if(!n.onHover)return}else{if("click"!==i)return;if(!n.onClick)return}var o=t.x,r=t.y;if(o>=e.left&&o<=e.right&&r>=e.top&&r<=e.bottom)for(var l=e.legendHitBoxes,s=0;s<l.length;++s){var u=l[s];if(o>=u.left&&o<=u.left+u.width&&r>=u.top&&r<=u.top+u.height){if("click"===i){n.onClick.call(e,t.native,e.legendItems[s]),a=!0;break}if("mousemove"===i){n.onHover.call(e,t.native,e.legendItems[s]),a=!0;break}}}return a}}),{id:"legend",beforeInit:function(t){var e=t.options.legend;e&&n(t,e)},beforeUpdate:function(e){var o=e.options.legend,r=e.legend;o?(o=i.configMerge(t.defaults.global.legend,o),r?(a.configure(e,r,o),r.options=o):n(e,o)):r&&(a.removeBox(e,r),delete e.legend)},afterEvent:function(t,e){var n=t.legend;n&&n.handleEvent(e)}}}},{}],43:[function(t,e,n){"use strict";e.exports=function(t){function e(e,n){var a=new t.Title({ctx:e.ctx,options:n,chart:e});i.configure(e,a,n),i.addBox(e,a),e.titleBlock=a}var n=t.helpers,i=t.layoutService,a=n.noop;return t.defaults.global.title={display:!1,position:"top",fullWidth:!0,weight:2e3,fontStyle:"bold",padding:10,text:""},t.Title=t.Element.extend({initialize:function(t){var e=this;n.extend(e,t),e.legendHitBoxes=[];
},beforeUpdate:a,update:function(t,e,n){var i=this;return i.beforeUpdate(),i.maxWidth=t,i.maxHeight=e,i.margins=n,i.beforeSetDimensions(),i.setDimensions(),i.afterSetDimensions(),i.beforeBuildLabels(),i.buildLabels(),i.afterBuildLabels(),i.beforeFit(),i.fit(),i.afterFit(),i.afterUpdate(),i.minSize},afterUpdate:a,beforeSetDimensions:a,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:a,beforeBuildLabels:a,buildLabels:a,afterBuildLabels:a,beforeFit:a,fit:function(){var e=this,i=n.getValueOrDefault,a=e.options,o=t.defaults.global,r=a.display,l=i(a.fontSize,o.defaultFontSize),s=e.minSize;e.isHorizontal()?(s.width=e.maxWidth,s.height=r?l+2*a.padding:0):(s.width=r?l+2*a.padding:0,s.height=e.maxHeight),e.width=s.width,e.height=s.height},afterFit:a,isHorizontal:function(){var t=this.options.position;return"top"===t||"bottom"===t},draw:function(){var e=this,i=e.ctx,a=n.getValueOrDefault,o=e.options,r=t.defaults.global;if(o.display){var l,s,u,d=a(o.fontSize,r.defaultFontSize),c=a(o.fontStyle,r.defaultFontStyle),h=a(o.fontFamily,r.defaultFontFamily),f=n.fontString(d,c,h),g=0,p=e.top,m=e.left,v=e.bottom,b=e.right;i.fillStyle=a(o.fontColor,r.defaultFontColor),i.font=f,e.isHorizontal()?(l=m+(b-m)/2,s=p+(v-p)/2,u=b-m):(l="left"===o.position?m+d/2:b-d/2,s=p+(v-p)/2,u=v-p,g=Math.PI*("left"===o.position?-.5:.5)),i.save(),i.translate(l,s),i.rotate(g),i.textAlign="center",i.textBaseline="middle",i.fillText(o.text,0,0,u),i.restore()}}}),{id:"title",beforeInit:function(t){var n=t.options.title;n&&e(t,n)},beforeUpdate:function(a){var o=a.options.title,r=a.titleBlock;o?(o=n.configMerge(t.defaults.global.title,o),r?(i.configure(a,r,o),r.options=o):e(a,o)):r&&(t.layoutService.removeBox(a,r),delete a.titleBlock)}}}},{}],44:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n={position:"bottom"},i=t.Scale.extend({getLabels:function(){var t=this.chart.data;return(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels},determineDataLimits:function(){var t=this,n=t.getLabels();t.minIndex=0,t.maxIndex=n.length-1;var i;void 0!==t.options.ticks.min&&(i=e.indexOf(n,t.options.ticks.min),t.minIndex=i!==-1?i:t.minIndex),void 0!==t.options.ticks.max&&(i=e.indexOf(n,t.options.ticks.max),t.maxIndex=i!==-1?i:t.maxIndex),t.min=n[t.minIndex],t.max=n[t.maxIndex]},buildTicks:function(){var t=this,e=t.getLabels();t.ticks=0===t.minIndex&&t.maxIndex===e.length-1?e:e.slice(t.minIndex,t.maxIndex+1)},getLabelForIndex:function(t,e){var n=this,i=n.chart.data,a=n.isHorizontal();return i.yLabels&&!a?n.getRightValue(i.datasets[e].data[t]):n.ticks[t-n.minIndex]},getPixelForValue:function(t,e,n,i){var a,o=this,r=Math.max(o.maxIndex+1-o.minIndex-(o.options.gridLines.offsetGridLines?0:1),1);if(void 0!==t&&null!==t&&(a=o.isHorizontal()?t.x:t.y),void 0!==a||void 0!==t&&isNaN(e)){var l=o.getLabels();t=a||t;var s=l.indexOf(t);e=s!==-1?s:e}if(o.isHorizontal()){var u=o.width/r,d=u*(e-o.minIndex);return(o.options.gridLines.offsetGridLines&&i||o.maxIndex===o.minIndex&&i)&&(d+=u/2),o.left+Math.round(d)}var c=o.height/r,h=c*(e-o.minIndex);return o.options.gridLines.offsetGridLines&&i&&(h+=c/2),o.top+Math.round(h)},getPixelForTick:function(t,e){return this.getPixelForValue(this.ticks[t],t+this.minIndex,null,e)},getValueForPixel:function(t){var e,n=this,i=Math.max(n.ticks.length-(n.options.gridLines.offsetGridLines?0:1),1),a=n.isHorizontal(),o=(a?n.width:n.height)/i;return t-=a?n.left:n.top,n.options.gridLines.offsetGridLines&&(t-=o/2),e=t<=0?0:Math.round(t/o)},getBasePixel:function(){return this.bottom}});t.scaleService.registerScaleType("category",i,n)}},{}],45:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n={position:"left",ticks:{callback:t.Ticks.formatters.linear}},i=t.LinearScaleBase.extend({determineDataLimits:function(){function t(t){return l?t.xAxisID===n.id:t.yAxisID===n.id}var n=this,i=n.options,a=n.chart,o=a.data,r=o.datasets,l=n.isHorizontal(),s=0,u=1;n.min=null,n.max=null;var d=i.stacked;if(void 0===d&&e.each(r,function(e,n){if(!d){var i=a.getDatasetMeta(n);a.isDatasetVisible(n)&&t(i)&&void 0!==i.stack&&(d=!0)}}),i.stacked||d){var c={};e.each(r,function(o,r){var l=a.getDatasetMeta(r),s=[l.type,void 0===i.stacked&&void 0===l.stack?r:"",l.stack].join(".");void 0===c[s]&&(c[s]={positiveValues:[],negativeValues:[]});var u=c[s].positiveValues,d=c[s].negativeValues;a.isDatasetVisible(r)&&t(l)&&e.each(o.data,function(t,e){var a=+n.getRightValue(t);isNaN(a)||l.data[e].hidden||(u[e]=u[e]||0,d[e]=d[e]||0,i.relativePoints?u[e]=100:a<0?d[e]+=a:u[e]+=a)})}),e.each(c,function(t){var i=t.positiveValues.concat(t.negativeValues),a=e.min(i),o=e.max(i);n.min=null===n.min?a:Math.min(n.min,a),n.max=null===n.max?o:Math.max(n.max,o)})}else e.each(r,function(i,o){var r=a.getDatasetMeta(o);a.isDatasetVisible(o)&&t(r)&&e.each(i.data,function(t,e){var i=+n.getRightValue(t);isNaN(i)||r.data[e].hidden||(null===n.min?n.min=i:i<n.min&&(n.min=i),null===n.max?n.max=i:i>n.max&&(n.max=i))})});n.min=isFinite(n.min)?n.min:s,n.max=isFinite(n.max)?n.max:u,this.handleTickRangeOptions()},getTickLimit:function(){var n,i=this,a=i.options.ticks;if(i.isHorizontal())n=Math.min(a.maxTicksLimit?a.maxTicksLimit:11,Math.ceil(i.width/50));else{var o=e.getValueOrDefault(a.fontSize,t.defaults.global.defaultFontSize);n=Math.min(a.maxTicksLimit?a.maxTicksLimit:11,Math.ceil(i.height/(2*o)))}return n},handleDirectionalChanges:function(){this.isHorizontal()||this.ticks.reverse()},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForValue:function(t){var e,n=this,i=n.start,a=+n.getRightValue(t),o=n.end-i;return n.isHorizontal()?(e=n.left+n.width/o*(a-i),Math.round(e)):(e=n.bottom-n.height/o*(a-i),Math.round(e))},getValueForPixel:function(t){var e=this,n=e.isHorizontal(),i=n?e.width:e.height,a=(n?t-e.left:e.bottom-t)/i;return e.start+(e.end-e.start)*a},getPixelForTick:function(t){return this.getPixelForValue(this.ticksAsNumbers[t])}});t.scaleService.registerScaleType("linear",i,n)}},{}],46:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n=e.noop;t.LinearScaleBase=t.Scale.extend({handleTickRangeOptions:function(){var t=this,n=t.options,i=n.ticks;if(i.beginAtZero){var a=e.sign(t.min),o=e.sign(t.max);a<0&&o<0?t.max=0:a>0&&o>0&&(t.min=0)}void 0!==i.min?t.min=i.min:void 0!==i.suggestedMin&&(null===t.min?t.min=i.suggestedMin:t.min=Math.min(t.min,i.suggestedMin)),void 0!==i.max?t.max=i.max:void 0!==i.suggestedMax&&(null===t.max?t.max=i.suggestedMax:t.max=Math.max(t.max,i.suggestedMax)),t.min===t.max&&(t.max++,i.beginAtZero||t.min--)},getTickLimit:n,handleDirectionalChanges:n,buildTicks:function(){var n=this,i=n.options,a=i.ticks,o=n.getTickLimit();o=Math.max(2,o);var r={maxTicks:o,min:a.min,max:a.max,stepSize:e.getValueOrDefault(a.fixedStepSize,a.stepSize)},l=n.ticks=t.Ticks.generators.linear(r,n);n.handleDirectionalChanges(),n.max=e.max(l),n.min=e.min(l),a.reverse?(l.reverse(),n.start=n.max,n.end=n.min):(n.start=n.min,n.end=n.max)},convertTicksToLabels:function(){var e=this;e.ticksAsNumbers=e.ticks.slice(),e.zeroLineIndex=e.ticks.indexOf(0),t.Scale.prototype.convertTicksToLabels.call(e)}})}},{}],47:[function(t,e,n){"use strict";e.exports=function(t){var e=t.helpers,n={position:"left",ticks:{callback:t.Ticks.formatters.logarithmic}},i=t.Scale.extend({determineDataLimits:function(){function t(t){return u?t.xAxisID===n.id:t.yAxisID===n.id}var n=this,i=n.options,a=i.ticks,o=n.chart,r=o.data,l=r.datasets,s=e.getValueOrDefault,u=n.isHorizontal();n.min=null,n.max=null,n.minNotZero=null;var d=i.stacked;if(void 0===d&&e.each(l,function(e,n){if(!d){var i=o.getDatasetMeta(n);o.isDatasetVisible(n)&&t(i)&&void 0!==i.stack&&(d=!0)}}),i.stacked||d){var c={};e.each(l,function(a,r){var l=o.getDatasetMeta(r),s=[l.type,void 0===i.stacked&&void 0===l.stack?r:"",l.stack].join(".");o.isDatasetVisible(r)&&t(l)&&(void 0===c[s]&&(c[s]=[]),e.each(a.data,function(t,e){var a=c[s],o=+n.getRightValue(t);isNaN(o)||l.data[e].hidden||(a[e]=a[e]||0,i.relativePoints?a[e]=100:a[e]+=o)}))}),e.each(c,function(t){var i=e.min(t),a=e.max(t);n.min=null===n.min?i:Math.min(n.min,i),n.max=null===n.max?a:Math.max(n.max,a)})}else e.each(l,function(i,a){var r=o.getDatasetMeta(a);o.isDatasetVisible(a)&&t(r)&&e.each(i.data,function(t,e){var i=+n.getRightValue(t);isNaN(i)||r.data[e].hidden||(null===n.min?n.min=i:i<n.min&&(n.min=i),null===n.max?n.max=i:i>n.max&&(n.max=i),0!==i&&(null===n.minNotZero||i<n.minNotZero)&&(n.minNotZero=i))})});n.min=s(a.min,n.min),n.max=s(a.max,n.max),n.min===n.max&&(0!==n.min&&null!==n.min?(n.min=Math.pow(10,Math.floor(e.log10(n.min))-1),n.max=Math.pow(10,Math.floor(e.log10(n.max))+1)):(n.min=1,n.max=10))},buildTicks:function(){var n=this,i=n.options,a=i.ticks,o={min:a.min,max:a.max},r=n.ticks=t.Ticks.generators.logarithmic(o,n);n.isHorizontal()||r.reverse(),n.max=e.max(r),n.min=e.min(r),a.reverse?(r.reverse(),n.start=n.max,n.end=n.min):(n.start=n.min,n.end=n.max)},convertTicksToLabels:function(){this.tickValues=this.ticks.slice(),t.Scale.prototype.convertTicksToLabels.call(this)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForTick:function(t){return this.getPixelForValue(this.tickValues[t])},getPixelForValue:function(t){var n,i,a,o=this,r=o.start,l=+o.getRightValue(t),s=o.options,u=s.ticks;return o.isHorizontal()?(a=e.log10(o.end)-e.log10(r),0===l?i=o.left:(n=o.width,i=o.left+n/a*(e.log10(l)-e.log10(r)))):(n=o.height,0!==r||u.reverse?0===o.end&&u.reverse?(a=e.log10(o.start)-e.log10(o.minNotZero),i=l===o.end?o.top:l===o.minNotZero?o.top+.02*n:o.top+.02*n+.98*n/a*(e.log10(l)-e.log10(o.minNotZero))):0===l?i=u.reverse?o.top:o.bottom:(a=e.log10(o.end)-e.log10(r),n=o.height,i=o.bottom-n/a*(e.log10(l)-e.log10(r))):(a=e.log10(o.end)-e.log10(o.minNotZero),i=l===r?o.bottom:l===o.minNotZero?o.bottom-.02*n:o.bottom-.02*n-.98*n/a*(e.log10(l)-e.log10(o.minNotZero)))),i},getValueForPixel:function(t){var n,i,a=this,o=e.log10(a.end)-e.log10(a.start);return a.isHorizontal()?(i=a.width,n=a.start*Math.pow(10,(t-a.left)*o/i)):(i=a.height,n=Math.pow(10,(a.bottom-t)*o/i)/a.start),n}});t.scaleService.registerScaleType("logarithmic",i,n)}},{}],48:[function(t,e,n){"use strict";e.exports=function(t){function e(t){var e=t.options;return e.angleLines.display||e.pointLabels.display?t.chart.data.labels.length:0}function n(t){var e=t.options.pointLabels,n=f.getValueOrDefault(e.fontSize,g.defaultFontSize),i=f.getValueOrDefault(e.fontStyle,g.defaultFontStyle),a=f.getValueOrDefault(e.fontFamily,g.defaultFontFamily),o=f.fontString(n,i,a);return{size:n,style:i,family:a,font:o}}function i(t,e,n){return f.isArray(n)?{w:f.longestText(t,t.font,n),h:n.length*e+1.5*(n.length-1)*e}:{w:t.measureText(n).width,h:e}}function a(t,e,n,i,a){return t===i||t===a?{start:e-n/2,end:e+n/2}:t<i||t>a?{start:e-n-5,end:e}:{start:e,end:e+n+5}}function o(t){var o,r,l,s=n(t),u=Math.min(t.height/2,t.width/2),d={r:t.width,l:0,t:t.height,b:0},c={};t.ctx.font=s.font,t._pointLabelSizes=[];var h=e(t);for(o=0;o<h;o++){l=t.getPointPosition(o,u),r=i(t.ctx,s.size,t.pointLabels[o]||""),t._pointLabelSizes[o]=r;var g=t.getIndexAngle(o),p=f.toDegrees(g)%360,m=a(p,l.x,r.w,0,180),v=a(p,l.y,r.h,90,270);m.start<d.l&&(d.l=m.start,c.l=g),m.end>d.r&&(d.r=m.end,c.r=g),v.start<d.t&&(d.t=v.start,c.t=g),v.end>d.b&&(d.b=v.end,c.b=g)}t.setReductions(u,d,c)}function r(t){var e=Math.min(t.height/2,t.width/2);t.drawingArea=Math.round(e),t.setCenterPoint(0,0,0,0)}function l(t){return 0===t||180===t?"center":t<180?"left":"right"}function s(t,e,n,i){if(f.isArray(e))for(var a=n.y,o=1.5*i,r=0;r<e.length;++r)t.fillText(e[r],n.x,a),a+=o;else t.fillText(e,n.x,n.y)}function u(t,e,n){90===t||270===t?n.y-=e.h/2:(t>270||t<90)&&(n.y-=e.h)}function d(t){var i=t.ctx,a=f.getValueOrDefault,o=t.options,r=o.angleLines,d=o.pointLabels;i.lineWidth=r.lineWidth,i.strokeStyle=r.color;var c=t.getDistanceFromCenterForValue(o.reverse?t.min:t.max),h=n(t);i.textBaseline="top";for(var p=e(t)-1;p>=0;p--){if(r.display){var m=t.getPointPosition(p,c);i.beginPath(),i.moveTo(t.xCenter,t.yCenter),i.lineTo(m.x,m.y),i.stroke(),i.closePath()}if(d.display){var v=t.getPointPosition(p,c+5),b=a(d.fontColor,g.defaultFontColor);i.font=h.font,i.fillStyle=b;var x=t.getIndexAngle(p),y=f.toDegrees(x);i.textAlign=l(y),u(y,t._pointLabelSizes[p],v),s(i,t.pointLabels[p]||"",v,h.size)}}}function c(t,n,i,a){var o=t.ctx;if(o.strokeStyle=f.getValueAtIndexOrDefault(n.color,a-1),o.lineWidth=f.getValueAtIndexOrDefault(n.lineWidth,a-1),t.options.gridLines.circular)o.beginPath(),o.arc(t.xCenter,t.yCenter,i,0,2*Math.PI),o.closePath(),o.stroke();else{var r=e(t);if(0===r)return;o.beginPath();var l=t.getPointPosition(0,i);o.moveTo(l.x,l.y);for(var s=1;s<r;s++)l=t.getPointPosition(s,i),o.lineTo(l.x,l.y);o.closePath(),o.stroke()}}function h(t){return f.isNumber(t)?t:0}var f=t.helpers,g=t.defaults.global,p={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1},gridLines:{circular:!1},ticks:{showLabelBackdrop:!0,backdropColor:"rgba(255,255,255,0.75)",backdropPaddingY:2,backdropPaddingX:2,callback:t.Ticks.formatters.linear},pointLabels:{display:!0,fontSize:10,callback:function(t){return t}}},m=t.LinearScaleBase.extend({setDimensions:function(){var t=this,e=t.options,n=e.ticks;t.width=t.maxWidth,t.height=t.maxHeight,t.xCenter=Math.round(t.width/2),t.yCenter=Math.round(t.height/2);var i=f.min([t.height,t.width]),a=f.getValueOrDefault(n.fontSize,g.defaultFontSize);t.drawingArea=e.display?i/2-(a/2+n.backdropPaddingY):i/2},determineDataLimits:function(){var t=this,e=t.chart,n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;f.each(e.data.datasets,function(a,o){if(e.isDatasetVisible(o)){var r=e.getDatasetMeta(o);f.each(a.data,function(e,a){var o=+t.getRightValue(e);isNaN(o)||r.data[a].hidden||(n=Math.min(o,n),i=Math.max(o,i))})}}),t.min=n===Number.POSITIVE_INFINITY?0:n,t.max=i===Number.NEGATIVE_INFINITY?0:i,t.handleTickRangeOptions()},getTickLimit:function(){var t=this.options.ticks,e=f.getValueOrDefault(t.fontSize,g.defaultFontSize);return Math.min(t.maxTicksLimit?t.maxTicksLimit:11,Math.ceil(this.drawingArea/(1.5*e)))},convertTicksToLabels:function(){var e=this;t.LinearScaleBase.prototype.convertTicksToLabels.call(e),e.pointLabels=e.chart.data.labels.map(e.options.pointLabels.callback,e)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},fit:function(){this.options.pointLabels.display?o(this):r(this)},setReductions:function(t,e,n){var i=this,a=e.l/Math.sin(n.l),o=Math.max(e.r-i.width,0)/Math.sin(n.r),r=-e.t/Math.cos(n.t),l=-Math.max(e.b-i.height,0)/Math.cos(n.b);a=h(a),o=h(o),r=h(r),l=h(l),i.drawingArea=Math.min(Math.round(t-(a+o)/2),Math.round(t-(r+l)/2)),i.setCenterPoint(a,o,r,l)},setCenterPoint:function(t,e,n,i){var a=this,o=a.width-e-a.drawingArea,r=t+a.drawingArea,l=n+a.drawingArea,s=a.height-i-a.drawingArea;a.xCenter=Math.round((r+o)/2+a.left),a.yCenter=Math.round((l+s)/2+a.top)},getIndexAngle:function(t){var n=2*Math.PI/e(this),i=this.chart.options&&this.chart.options.startAngle?this.chart.options.startAngle:0,a=i*Math.PI*2/360;return t*n+a},getDistanceFromCenterForValue:function(t){var e=this;if(null===t)return 0;var n=e.drawingArea/(e.max-e.min);return e.options.reverse?(e.max-t)*n:(t-e.min)*n},getPointPosition:function(t,e){var n=this,i=n.getIndexAngle(t)-Math.PI/2;return{x:Math.round(Math.cos(i)*e)+n.xCenter,y:Math.round(Math.sin(i)*e)+n.yCenter}},getPointPositionForValue:function(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))},getBasePosition:function(){var t=this,e=t.min,n=t.max;return t.getPointPositionForValue(0,t.beginAtZero?0:e<0&&n<0?n:e>0&&n>0?e:0)},draw:function(){var t=this,e=t.options,n=e.gridLines,i=e.ticks,a=f.getValueOrDefault;if(e.display){var o=t.ctx,r=a(i.fontSize,g.defaultFontSize),l=a(i.fontStyle,g.defaultFontStyle),s=a(i.fontFamily,g.defaultFontFamily),u=f.fontString(r,l,s);f.each(t.ticks,function(l,s){if(s>0||e.reverse){var d=t.getDistanceFromCenterForValue(t.ticksAsNumbers[s]),h=t.yCenter-d;if(n.display&&0!==s&&c(t,n,d,s),i.display){var f=a(i.fontColor,g.defaultFontColor);if(o.font=u,i.showLabelBackdrop){var p=o.measureText(l).width;o.fillStyle=i.backdropColor,o.fillRect(t.xCenter-p/2-i.backdropPaddingX,h-r/2-i.backdropPaddingY,p+2*i.backdropPaddingX,r+2*i.backdropPaddingY)}o.textAlign="center",o.textBaseline="middle",o.fillStyle=f,o.fillText(l,t.xCenter,h)}}}),(e.angleLines.display||e.pointLabels.display)&&d(t)}}});t.scaleService.registerScaleType("radialLinear",m,p)}},{}],49:[function(t,e,n){"use strict";var i=t(1);i="function"==typeof i?i:window.moment,e.exports=function(t){function e(t,e){var n=t.options.time;if("string"==typeof n.parser)return i(e,n.parser);if("function"==typeof n.parser)return n.parser(e);if("function"==typeof e.getMonth||"number"==typeof e)return i(e);if(e.isValid&&e.isValid())return e;var a=n.format;return"string"!=typeof a&&a.call?(console.warn("options.time.format is deprecated and replaced by options.time.parser."),a(e)):i(e,a)}function n(t,e,n,i){for(var a,o=Object.keys(l),r=o.length,s=o.indexOf(t);s<r;s++){a=o[s];var u=l[a],d=u.steps&&u.steps[u.steps.length-1]||u.maxStep;if(void 0===d||Math.ceil((n-e)/(d*u.size))<=i)break}return a}function a(t,e,n,i){var a=l[n],o=a.size,r=Math.ceil((e-t)/o),s=1,u=e-t;if(a.steps)for(var d=a.steps.length,c=0;c<d&&r>i;c++)s=a.steps[c],r=Math.ceil(u/(o*s));else for(;r>i&&i>0;)++s,r=Math.ceil(u/(o*s));return s}function o(t,e,n){var a=[];if(t.maxTicks){var o=t.stepSize;a.push(void 0!==t.min?t.min:n.min);for(var r=i(n.min);r.add(o,t.unit).valueOf()<n.max;)a.push(r.valueOf());var l=t.max||n.max;a[a.length-1]!==l&&a.push(l)}return a}var r=t.helpers,l={millisecond:{size:1,steps:[1,2,5,10,20,50,100,250,500]},second:{size:1e3,steps:[1,2,5,10,30]},minute:{size:6e4,steps:[1,2,5,10,30]},hour:{size:36e5,steps:[1,2,3,6,12]},day:{size:864e5,steps:[1,2,5]},week:{size:6048e5,maxStep:4},month:{size:2628e6,maxStep:3},quarter:{size:7884e6,maxStep:4},year:{size:3154e7,maxStep:!1}},s={position:"bottom",time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm:ss a",hour:"MMM D, hA",day:"ll",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!1}};t.Ticks.generators.time=function(t,e){var n,a,r=t.isoWeekday;return"week"===t.unit&&r!==!1?(n=i(e.min).startOf("isoWeek").isoWeekday(r).valueOf(),a=i(e.max).startOf("isoWeek").isoWeekday(r),e.max-a>0&&a.add(1,"week"),a=a.valueOf()):(n=i(e.min).startOf(t.unit).valueOf(),a=i(e.max).startOf(t.unit),e.max-a>0&&a.add(1,t.unit),a=a.valueOf()),o(t,e,{min:n,max:a})};var u=t.Scale.extend({initialize:function(){if(!i)throw new Error("Chart.js - Moment.js could not be found! You must include it before Chart.js to use the time scale. Download at https://momentjs.com");t.Scale.prototype.initialize.call(this)},determineDataLimits:function(){var t,n=this,i=n.options.time,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,l=n.chart.data,s={labels:[],datasets:[]};r.each(l.labels,function(r,l){var u=e(n,r);u.isValid()&&(i.round&&u.startOf(i.round),t=u.valueOf(),a=Math.min(t,a),o=Math.max(t,o),s.labels[l]=t)}),r.each(l.datasets,function(l,u){var d=[];"object"==typeof l.data[0]&&null!==l.data[0]&&n.chart.isDatasetVisible(u)?r.each(l.data,function(r,l){var s=e(n,n.getRightValue(r));s.isValid()&&(i.round&&s.startOf(i.round),t=s.valueOf(),a=Math.min(t,a),o=Math.max(t,o),d[l]=t)}):d=s.labels.slice(),s.datasets[u]=d}),n.dataMin=a,n.dataMax=o,n._parsedData=s},buildTicks:function(){var i,o,l=this,s=l.options.time,u=l.dataMin,d=l.dataMax;if(s.min){var c=e(l,s.min);s.round&&c.round(s.round),i=c.valueOf()}s.max&&(o=e(l,s.max).valueOf());var h=l.getLabelCapacity(i||u),f=s.unit||n(s.minUnit,i||u,o||d,h);l.displayFormat=s.displayFormats[f];var g=s.stepSize||a(i||u,o||d,f,h);l.ticks=t.Ticks.generators.time({maxTicks:h,min:i,max:o,stepSize:g,unit:f,isoWeekday:s.isoWeekday},{min:u,max:d}),l.max=r.max(l.ticks),l.min=r.min(l.ticks)},getLabelForIndex:function(t,n){var i=this,a=i.chart.data.labels&&t<i.chart.data.labels.length?i.chart.data.labels[t]:"",o=i.chart.data.datasets[n].data[t];return null!==o&&"object"==typeof o&&(a=i.getRightValue(o)),i.options.time.tooltipFormat&&(a=e(i,a).format(i.options.time.tooltipFormat)),a},tickFormatFunction:function(t,e,n){var i=t.format(this.displayFormat),a=this.options.ticks,o=r.getValueOrDefault(a.callback,a.userCallback);return o?o(i,e,n):i},convertTicksToLabels:function(){var t=this;t.ticksAsTimestamps=t.ticks,t.ticks=t.ticks.map(function(t){return i(t)}).map(t.tickFormatFunction,t)},getPixelForOffset:function(t){var e=this,n=e.max-e.min,i=n?(t-e.min)/n:0;if(e.isHorizontal()){var a=e.width*i;return e.left+Math.round(a)}var o=e.height*i;return e.top+Math.round(o)},getPixelForValue:function(t,n,i){var a=this,o=null;if(void 0!==n&&void 0!==i&&(o=a._parsedData.datasets[i][n]),null===o&&(t&&t.isValid||(t=e(a,a.getRightValue(t))),t&&t.isValid&&t.isValid()&&(o=t.valueOf())),null!==o)return a.getPixelForOffset(o)},getPixelForTick:function(t){return this.getPixelForOffset(this.ticksAsTimestamps[t])},getValueForPixel:function(t){var e=this,n=e.isHorizontal()?e.width:e.height,a=(t-(e.isHorizontal()?e.left:e.top))/n;return i(e.min+a*(e.max-e.min))},getLabelWidth:function(e){var n=this,i=n.options.ticks,a=n.ctx.measureText(e).width,o=Math.cos(r.toRadians(i.maxRotation)),l=Math.sin(r.toRadians(i.maxRotation)),s=r.getValueOrDefault(i.fontSize,t.defaults.global.defaultFontSize);return a*o+s*l},getLabelCapacity:function(t){var e=this;e.displayFormat=e.options.time.displayFormats.millisecond;var n=e.tickFormatFunction(i(t),0,[]),a=e.getLabelWidth(n),o=e.isHorizontal()?e.width:e.height,r=o/a;return r}});t.scaleService.registerScaleType("time",u,s)}},{1:1}]},{},[7])(7)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:chart-view', location = 'assets/core/charts/chart-view.js' */
(function($){

    var PlaySQL = window.PlaySQL = window.PlaySQL || {};
    PlaySQL.Charts = PlaySQL.Charts || {};

    var chartTypes = PlaySQL.Charts.chartTypes = [
        new PieChartType(),
        new BarChartType(),
        new LineChartType()
    ]; // add here all the possible Chart Types

    var MAX_WIDTH = 1500;
    var MAX_HEIGHT = 800;
    var MAX_LIMIT = 999999999999; // It should rather be Math.min(2^63, Number.MAX_VALUE), but 999bn is enough.

    // this is the palette used for the colorpicker tool.
    var palette =
        [
            ["#d04437", "#205081", "#f5f5f5", "#333333", "#3772b0", "#ebf2f9"],
            ["#707070", "#14892c", "#f6c342", "#999999", "#cccccc", "#e9e9e9"],
            ["#815b3a", "#f79232", "#d39c3f", "#59afe1", "#4a6785", "#f691b2"],
            ["#84bbc6", "#8eb021", "#67ab49", "#654982", "#ac707a", "#f15c75"],
            ["#202020", "#404040", "#808080", "#bfbfbf", "#f2f2f2", "transparent"],
            [],
            ["#948a55", "#b3aa7c", "#c4bd9b", "#d5d1b5", "#e6e4d2", "#f0ece1"],
            ["#23518b", "#2a69a8", "#3173c4", "#4785d2", "#72a1dc", "#1f497e"],
            ["#622524", "#953736", "#d9a094", "#e6bab8", "#f5dcdb", "#c0514d"],
            ["#4e6326", "#72933d", "#c4d69b", "#d8e4bd", "#eff1de", "#9cbb59"],
            ["#253f61", "#346092", "#95b3d8", "#b9cee5", "#dfe6f4", "#4f82bd"],
            ["#b38808", "#f7c121", "#fcf9af", "#feffea", "#fefaec", "#fada7b"],
            ["#901929", "#d9253e", "#f0a7b1", "#f5c4cb", "#fae2e5", "#e66c7d"],
            ["#403154", "#654a7b", "#b4a2c7", "#ccc1db", "#e6e4ec", "#8065a2"],
            ["#215b68", "#32859c", "#93cddf", "#b7dfe8", "#dbeff4", "#4aacc7"],
            ["#994808", "#e16c0a", "#fab990", "#fdd5b5", "#feeada", "#f79646"]
        ];

    function stripHtml(text) {
        return text && text.replace(/<(?:.|\n)*?>/gm, '');
    }

    PlaySQL.Charts.newChartData = function (context, $placeholder) {
        return {
            id: undefined, // the id
            label: undefined, // the label
            source: {
                // Just FYI for the UI
                spreadsheets: undefined, // list of all spreadsheets
                queries: undefined, // list of all queries
                jointtables: undefined, // list of all joint tables
                columns: undefined, // columns available in the selected source,
                spreadsheetSql: undefined, // the SQL that was used to return the spreadsheetId, that's only FYI to
                // prefill the field in case the user clicks "Edit SQL"
                isSet: function() { return !!this.spreadsheetId || !!this.sql; },
                // Actual data
                context: context, // the context of the spreadsheet
                spreadsheetId: undefined, // name of the selected source (tablename, queryId, or undefined if SQL is present, etc)
                sql: undefined, // An override of the SQL
                columnsUsed: undefined // columns used in the chart
            },
            type: undefined, // the chart renderer
            chartCanvasElement: $placeholder.find(".chart-canvas")[0],
            showChart: function (){
                if (!this.chartCanvasElement) {
                    this.chartCanvasElement = document.getElementsByClassName('chart-canvas')[0].getContext('2d');
                }
                // TODO Do we have to empty the placeholder and the canvas?
                this.type.showChart(this, this.chartCanvasElement);
            },

            rawData: undefined, // data extracted from the database, not formatted

            transformedData: undefined, // data that can be used by the Chart library

            colors: {
                background: {},
                border: {},
                fill: {}
            },
            style: { // although this is useful only for line charts for now, it saves us some checks that make the code a lot more verbose
                pointStyle: {},
                pointRadius: {},
                lineTension: {}
            },

            options: {
                width: undefined,
                height: undefined
            },

            view: undefined
        };
    };

    PlaySQL.Charts.fromSerialized = function(psqlChartData, serialized) {
        try {
            var deserialized;
            if(typeof serialized === "object")
                deserialized = serialized; // sometimes 'serialized' is already deserialized by jQuery when we get it from data attributes
            else
                deserialized = JSON.parse(serialized);
            $.extend(true, psqlChartData.source, deserialized.source);
            psqlChartData.type = PlaySQL.Charts.getChartType(deserialized.type);
            $.extend(true, psqlChartData, deserialized.columns);
            $.extend(true, psqlChartData.colors, deserialized.colors);
            $.extend(true, psqlChartData.style, deserialized.style);
            $.extend(true, psqlChartData.options, deserialized.options);
            if (typeof deserialized.persistInDb != "undefined") {
                psqlChartData.persistInDb = deserialized.persistInDb;
            }
            return deserialized;
        } catch(e) {
            throw "Problem while reading the chart: " + e;
        }
    };

    // Skeleton to use to create a new chart
    function AbstractChartType() {
        this.id = "";
        this.name = "";
        this.img = "";
        this.desc = "";
        this.selectAxis = function(psqlChartData) {};
        this.saveAxis = function(psqlChartData, $errors) {};
        this.generateData = function(psqlChartData) {};
        this.showOptions = function(psqlChartData, $content, chartCanvasElement) {};
        this.showChart = function(psqlChartData, chartCanvasElement) {};
        this.serializeChart = function(psqlChartData) {
            return {
                source: {
                    spreadsheetId: psqlChartData.source.spreadsheetId,
                    sql: psqlChartData.source.sql,
                    columnsUsed: psqlChartData.source.columnsUsed
                },
                type: psqlChartData.type.id,
                columns: {
                    labelColumn: psqlChartData.labelColumn,
                    valueColumns: psqlChartData.valueColumns,
                    groupbyColumn: psqlChartData.groupbyColumn
                },
                colors: psqlChartData.colors,
                style: psqlChartData.style,
                options: psqlChartData.options
            };
        };
    }

    function PieChartType() {
        // Inherit from AbstractChartType
        AbstractChartType.call(this);
        this.id = "pie";
        this.name = "Pie Chart";
        this.img = PlaySQL.SPI.getRoute("img", "chart-pie-96px.png");
        this.desc = "A Pie chart allows you to show percentages in a total";
        this.selectAxis = function(psqlChartData, $content) {
            var labelColumns = []; // TODO : filter by type, place TEXT and VARCHAR first
            var valueColumns = [];

            psqlChartData.source.columns.forEach(function (column) {
                labelColumns.push(column); // label can be anything
                if(["INTEGER", "NUMERIC"].indexOf(column.type) != -1)
                    valueColumns.push(column);
            });

            // TODO : try to preselect (if 2 columns and one is integer, values=integer, labels=other)
            var html = Confluence.Templates.PlaySQL.chartPieAxis({
                labelColumns: labelColumns,
                valueColumns: valueColumns,
                selectedLabel: psqlChartData.labelColumn,
                selectedValue: psqlChartData.valueColumns && psqlChartData.valueColumns[0] || ''
            });
            $content.html(html);

            $content.find('#chart-pie-select-column-labels').change(function() {
                var $this = $(this);
                var selectedName = $this.val();
                var selectedLabel = $this.find('aui-option[value="' + selectedName + '"]').text();
                $this.next('#chart-pie-checkbox-aggregate').remove();
                $this.next('label').remove();
                var $btn = $('<input />', {
                    type: 'checkbox',
                    id: 'chart-pie-checkbox-aggregate',
                    style: "margin-left: 10px"
                });
                $this.after($btn);
                var $label = $('<label>', {
                    for: 'chart-pie-checkbox-aggregate',
                    style: "float: initial; margin-left: initial;"
                }).text("Aggregate by " + selectedLabel);
                $btn.after($label);

                $btn.change(function () {
                    function auioption(value, label, selected) {
                        return '<aui-option ' + (selected?'selected ':'') + 'value="' + AJS.escapeHtml(value) + '">' + AJS.escapeHtml(label) + '</aui-option>';
                    }

                    var options = '';
                    if($(this).prop('checked')) {
                        // Display "aggregate" options
                        var name = selectedName + '::count';
                        var label = 'COUNT ' + selectedLabel;
                        // if no value column was selected, or the column is not an aggregate function, select this one
                        var selected = (!psqlChartData.valueColumns || psqlChartData.valueColumns[0] === name
                            || psqlChartData.valueColumns[0].indexOf('::') === -1);
                        options += auioption(name, label, selected);
                        valueColumns.forEach(function (column) {
                            ["avg", "max", "min", "sum"].forEach(function (fn) {
                                name = column.name + '::' + fn;
                                label = fn.toUpperCase() + ' ' + column.label;
                                selected = (psqlChartData.valueColumns && psqlChartData.valueColumns[0] === name);
                                options += auioption(name, label, selected);
                            });
                        });
                    } else {
                        valueColumns.forEach(function (column) {
                            options += auioption(column.name, column.label);
                        });
                    }
                    var $auiselect = $('<aui-select id="chart-pie-select-column-values" placeholder="Select a column">'
                        + options + '</aui-select>');
                    $content.find('#chart-pie-select-column-values').replaceWith($auiselect);
                });
            });

            if (psqlChartData.labelColumn) {
                $content.find('#chart-pie-select-column-labels').trigger('change'); // add the "Aggregate" button
                if(psqlChartData.valueColumns && psqlChartData.valueColumns[0].indexOf('::') !== -1) {
                    window.setTimeout(function(){
                        $content.find('#chart-pie-checkbox-aggregate').prop('checked', true).trigger('change');
                    }, 0);
                }
            }
        };
        this.saveAxis = function (psqlChartData, $errors) {
            var labelColumn = $('#chart-pie-select-column-labels').val();
            var valueColumn = $('#chart-pie-select-column-values').val();
            if(labelColumn && valueColumn && labelColumn !== valueColumn) {
                psqlChartData.labelColumn = labelColumn;
                psqlChartData.valueColumns = [valueColumn];
                psqlChartData.source.columnsUsed = labelColumn + "," + valueColumn;
                return true;
            }
            $errors.html("You must select columns for label and values!");
            return false;
        };
        this.generateData = function (psqlChartData) {
            var data = psqlChartData.transformedData = {
                datasets: [{
                    backgroundColor: [],
                    data: []
                }],
                labels: []
            };

            var parts = psqlChartData.valueColumns[0].split('::');
            var valueColumn = parts[0];
            var aggregateFunction = parts[1];

            var labelColPos;
            var valueColPos;
            psqlChartData.rawData.tableDef.columns.forEach(function (column, i) {
                if(column.name === psqlChartData.labelColumn)
                    labelColPos = i;
                if(column.name === valueColumn)
                    valueColPos = i;
            });

            if(labelColPos == undefined || valueColPos == undefined) {
                AJS.flag({
                    type: 'error',
                    title: 'Error generating chart',
                    body: 'The label and/or value column could not be found. Please try to select your columns again.'
                });
                return;
            }

            switch(aggregateFunction) {
                case "count":
                    this.reduceDatasetWithCount(psqlChartData, labelColPos, valueColPos, data);
                    break;
                case "avg":
                    this.reduceDatasetWithAvg(psqlChartData, labelColPos, valueColPos, data);
                    break;
                case "max":
                    this.reduceDatasetWithMax(psqlChartData, labelColPos, valueColPos, data);
                    break;
                case "min":
                    this.reduceDatasetWithMin(psqlChartData, labelColPos, valueColPos, data);
                    break;
                case "sum":
                    this.reduceDatasetWithSum(psqlChartData, labelColPos, valueColPos, data);
                    break;
                default:
                    this.notReduceDataset(psqlChartData, labelColPos, valueColPos, data);
                    break;
            }
        };
        this.reduceDatasetWithCount = function(psqlChartData, labelColPos, valueColPos, data) {
            psqlChartData.rawData.data.forEach(function (row, i) {
                var value = stripHtml(row[valueColPos][0]);
                var labelIndex = data.labels.indexOf(value);
                if(labelIndex === -1) {
                    labelIndex = data.labels.push(value) -1;
                    var color = getOrAffect(psqlChartData.colors.background, value, getRandomColor());
                    data.datasets[0].backgroundColor[labelIndex] = color;
                    data.datasets[0].data[labelIndex] = 0;
                }
                data.datasets[0].data[labelIndex]++;
            });
        };
        // This function takes all the value with same label and puts them in an array. So data.datasets[0].data = [ [...], [...], ... ]
        this.helperReduceDataset = function(psqlChartData, labelColPos, valueColPos, data) {
            psqlChartData.rawData.data.forEach(function (row, i) {
                var label = stripHtml(row[labelColPos][0]);
                var value = stripHtml(row[valueColPos][0]);
                var labelIndex = data.labels.indexOf(label);
                if(labelIndex === -1) {
                    labelIndex = data.labels.push(label) -1;
                    var color = getOrAffect(psqlChartData.colors.background, label, getRandomColor());
                    data.datasets[0].backgroundColor[labelIndex] = color;
                    data.datasets[0].data[labelIndex] = [];
                }
                data.datasets[0].data[labelIndex].push(+value);
            });
        };
        this.reduceDatasetWithAvg = function(psqlChartData, labelColPos, valueColPos, data) {
            this.helperReduceDataset(psqlChartData, labelColPos, valueColPos, data);
            data.datasets[0].data = data.datasets[0].data.map(function (arr) {
                return arr.reduce(function (p, c) { return p + c/arr.length; }, 0);
            });
        };
        this.reduceDatasetWithMax = function(psqlChartData, labelColPos, valueColPos, data) {
            this.helperReduceDataset(psqlChartData, labelColPos, valueColPos, data);
            data.datasets[0].data = data.datasets[0].data.map(function (arr) {
                return arr.reduce(function (p, c) { return Math.max(p, c); });
            });
        };
        this.reduceDatasetWithMin = function(psqlChartData, labelColPos, valueColPos, data) {
            this.helperReduceDataset(psqlChartData, labelColPos, valueColPos, data);
            data.datasets[0].data = data.datasets[0].data.map(function (arr) {
                return arr.reduce(function (p, c) { return Math.min(p, c); });
            });
        };
        this.reduceDatasetWithSum = function(psqlChartData, labelColPos, valueColPos, data) {
            this.helperReduceDataset(psqlChartData, labelColPos, valueColPos, data);
            data.datasets[0].data = data.datasets[0].data.map(function (arr) {
                return arr.reduce(function (p, c) { return p + c; }, 0);
            })
        };
        this.notReduceDataset = function(psqlChartData, labelColPos, valueColPos, data) {
            psqlChartData.rawData.data.forEach(function (row, i) {
                // TODO : use cell [0] for now, but it should be useful to add a new rendered content
                var label = stripHtml(row[labelColPos][0]);
                var value = stripHtml(row[valueColPos][0]);
                data.labels.push(label);
                data.datasets[0].data.push(value);
                var color = getOrAffect(psqlChartData.colors.background, label, getRandomColor());
                data.datasets[0].backgroundColor.push(color);
            });
        };
        this.showOptions = function (psqlChartData, $content, ctx) {
            this.showChart(psqlChartData, ctx);

            psqlChartData.options.maintainAspectRatio = true;
            psqlChartData.options.height = psqlChartData.options.height || ($('#chart-canvas-container').height() + 'px');

            var elements = [];
            for(var i = 0; i < psqlChartData.transformedData.labels.length; ++i) {
                var label = psqlChartData.transformedData.labels[i];
                var color = psqlChartData.colors.background[label];
                var picker = Confluence.Templates.PlaySQL.colorPicker({
                    id: 'chart-options-color-' + label,
                    classes: 'chart-options-colorpicker',
                    palette: palette,
                    lastChosenColor: color
                });
                elements.push({label: label, element: soydata.VERY_UNSAFE.ordainSanitizedHtml(picker)});
            }
            // Those options are stored per series-name, so it's no use having duplicate names.
            removeDuplicateLabels(elements);
            var fieldsetColors = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Colors', options: elements});
            var slider = Confluence.Templates.PlaySQL.chartOptionsSlider({
                min: 0,
                max: 100,
                value: psqlChartData.options.cutoutPercentage || 0,
                id: 'chart-options-cutout',
                classes: ''
            });
            elements = [{label: 'Cutout', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(slider)}];
            slider = Confluence.Templates.PlaySQL.chartOptionsSlider({
                min: 0,
                max: MAX_WIDTH,
                value: +psqlChartData.options.height.replace('px', ''),
                id: 'chart-options-size',
                classes: ''
            });
            elements.push({label: 'Size', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(slider)});

            var checkbox = Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                id: 'chart-options-legend',
                classes: '',
                checked: true
            });
            elements.push({label: 'Show legend', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(checkbox)});

            checkbox = Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                id: 'chart-options-usepointstyle',
                classes: '',
                checked: false
            });
            elements.push({label: 'Use point style', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(checkbox)});
            var fieldsetGlobals = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Customize', options: elements});

            $content.find('#options').html(fieldsetColors).append(fieldsetGlobals);

            // hide options by default
            $('fieldset.group > ul').toggle();

            $('.chart-options-colorpicker').each(function () {
                PlaySQL.Helpers.colorPicker($(this), true);
            });

            $('#chart-options-cutout').on('input', function () {
                // we want a value of 100 to be rounded to 99 so we have at least one pixel of the chart (100 means no chart)
                var percentage = $(this).val() / 100 * 99;
                psqlChartData.options.cutoutPercentage = percentage;
                psqlChartData.view.update();
                $('#chart-options-cutout-value').html($(this).val());
            });

            $('.chart-options-colorpicker').on('playsql-color-changed', function () {
                var label = this.id.replace(/^chart-options-color-/, '');
                var val = $(this).data('attr-color');
                var num = psqlChartData.view.data.labels.indexOf(label);
                if(!isColor(val) || num === -1) return;
                psqlChartData.colors.background[label] = val;
                psqlChartData.view.data.datasets[0].backgroundColor[num] = val;
                psqlChartData.view.update();
            });

            // Yes, this control controls both height and width
            addHandlersToSlider(psqlChartData, $('#chart-options-size'), $('#chart-options-size-value'), "height", "height", MAX_WIDTH);
            addHandlersToSlider(psqlChartData, $('#chart-options-size'), $('#chart-options-size-value'), "width", "width", MAX_WIDTH);

            if(psqlChartData.options.height === '-1')
                $('#chart-options-size').val(MAX_WIDTH).trigger('change');

            $('#chart-options-legend').change(function () {
                psqlChartData.options.legend.display = $(this).prop('checked');
                psqlChartData.view.update();
            });
            $('#chart-options-usepointstyle').change(function () {
                psqlChartData.options.legend.labels.usePointStyle = $(this).prop('checked');
                psqlChartData.view.update();
            });
        };
        this.showChart = function(psqlChartData, ctx) {
            psqlChartData.options.tooltips = {
                callbacks: {
                    afterBody: function(tooltipItems, data) {
                        var tooltipItem = tooltipItems[0];
                        var dataset = data.datasets[tooltipItem.datasetIndex];
                        var value = dataset.data[tooltipItem.index];
                        var sum = dataset.data.reduce(function (p, c) { return p + c; }, 0);
                        return '(' + (value / sum * 100).toFixed(2) + '%)';
                    }
                }
            };
            psqlChartData.view = new Chart(ctx, {
                type: 'pie',
                data: psqlChartData.transformedData,
                options: psqlChartData.options
            });
            // The Chart library merges our options with the defaults, so we put them in our field
            psqlChartData.options = psqlChartData.view.options;
            // this is not a mistake. pie chart should have a square area, so we use height for both.
            //noinspection JSSuspiciousNameCombination
            psqlChartData.view.canvas.parentNode.style.width = psqlChartData.options.height; // yes, height, both
            psqlChartData.view.canvas.parentNode.style.height = psqlChartData.options.height;
        };
    }

    function BarChartType() {
        // Inherit from AbstractChartType
        AbstractChartType.call(this);
        this.id = "bar";
        this.name = "Bar Chart";
        this.img = PlaySQL.SPI.getRoute("img", "chart-bar-96px.png");
        this.desc = "A bar chart allows you to show numerical values and group them.";
        this.selectAxis = function(psqlChartData, $content) {
            var labelColumns = [];
            var valueColumns = [];
            var groupbyColumns = [];

            psqlChartData.source.columns.forEach(function (column) {
                labelColumns.push(column);
                groupbyColumns.push(column);
                if(["INTEGER", "NUMERIC"].indexOf(column.type) != -1) {
                    valueColumns.push(column);
                }
            });

            var html = Confluence.Templates.PlaySQL.chartBarAxis({
                labelColumns: labelColumns,
                valueColumns: valueColumns,
                groupbyColumns: groupbyColumns,
                selectedLabel: psqlChartData.labelColumn,
                selectedValue: psqlChartData.valueColumns && psqlChartData.valueColumns[0] || '',
                selectedGroupby: psqlChartData.groupbyColumn
            });
            $content.html(html);
        };
        this.saveAxis = function(psqlChartData, $errors) {
            var labelColumn = $('#chart-bar-select-column-labels').val();
            var valueColumn = $('#chart-bar-select-column-values').val();
            var groupbyColumn = $('#chart-bar-select-column-groupby').val();
            if(labelColumn && valueColumn && labelColumn !== valueColumn && labelColumn !== groupbyColumn) {
                // note that groupbyColumn can be undefined
                psqlChartData.labelColumn = labelColumn;
                psqlChartData.valueColumns = [valueColumn];
                psqlChartData.groupbyColumn = groupbyColumn;
                psqlChartData.source.columnsUsed = labelColumn + "," + valueColumn;
                if(groupbyColumn) psqlChartData.source.columnsUsed += "," + groupbyColumn;
                return true;
            }
            $errors.html("You must select columns for labels and values!");
            return false;
        };
        this.generateData = function(psqlChartData) {
            psqlChartData.transformedData = {
                datasets: [],
                labels: []
            };

            var labelColPos;
            var valueColPos;
            var groupbyColPos = -1;
            psqlChartData.rawData.tableDef.columns.forEach(function (column, i) {
                if(column.name === psqlChartData.labelColumn)
                    labelColPos = i;
                if(column.name === psqlChartData.valueColumns[0])
                    valueColPos = i;
                if(column.name === psqlChartData.groupbyColumn)
                    groupbyColPos = i;
            });
            if(labelColPos == undefined || valueColPos == undefined) {
                AJS.flag({
                    type: 'error',
                    title: 'Error generating chart',
                    body: 'The label and/or value columns could not be found. Please try to select the columns again.'
                });
                return;
            }


            psqlChartData.rawData.data.forEach(function (row) {
                var label = stripHtml(row[labelColPos][0]);
                var value = stripHtml(row[valueColPos][0]);
                var groupby = groupbyColPos !== -1 ? row[groupbyColPos][0] : "";
                groupby = stripHtml(groupby);
                // groupby = datasets[X].label
                var labelIndex = psqlChartData.transformedData.labels.indexOf(label);
                if(labelIndex === -1)
                    labelIndex = psqlChartData.transformedData.labels.push(label) - 1;

                var dataset = findTransformedDataset(psqlChartData, groupby);
                if(!dataset) {
                    // we use toString because, if the label/groupby is an integer, it will create blanks in the array-like object we use
                    var color = getOrAffect(psqlChartData.colors.background, groupby.toString(), getRandomColor());
                    var index = psqlChartData.transformedData.datasets.push({data: [], backgroundColor: color, label: groupby });
                    dataset = psqlChartData.transformedData.datasets[index - 1];
                }
                dataset.data[labelIndex] = value;
            });
        };
        this.showOptions = function(psqlChartData, $content, ctx) {
            this.showChart(psqlChartData, ctx); // first, show the chart so we can get values like width or height

            psqlChartData.options.maintainAspectRatio = false;
            var $container = $('#chart-canvas-container');
            psqlChartData.options.width = psqlChartData.options.width || ($container.width() + 'px');
            psqlChartData.options.height = psqlChartData.options.height || (Math.max($container.height(), $container.width()) + 'px');

            var elements = [];
            psqlChartData.transformedData.datasets.forEach(function (dataset) {
                var picker = Confluence.Templates.PlaySQL.colorPicker({
                    id: 'chart-options-colorpicker-' + dataset.label,
                    classes: 'chart-options-colorpicker',
                    lastChosenColor: dataset.backgroundColor,
                    palette: palette
                });
                elements.push({label: dataset.label, element: soydata.VERY_UNSAFE.ordainSanitizedHtml(picker)});
            });
            // Those options are stored per series-name, so it's no use having duplicate names.
            removeDuplicateLabels(elements);

            var fieldsetColors = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Colors', options: elements});
            var stacked = Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                id: 'chart-options-stacked',
                classes: '',
                checked: false
            });
            var width = Confluence.Templates.PlaySQL.chartOptionsSlider({
                min: 1,
                max: MAX_WIDTH,
                value: +psqlChartData.options.width.replace('px', ''),
                id: 'chart-options-width',
                classes: ''
            });
            var height = Confluence.Templates.PlaySQL.chartOptionsSlider({
                min: 1,
                max: MAX_HEIGHT,
                value: +psqlChartData.options.height.replace('px', ''),
                id: 'chart-options-height',
                classes: ''
            });
            var legend = Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                id: 'chart-options-legend',
                classes: '',
                checked: true
            });
            var usepointstyle = Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                id: 'chart-options-usepointstyle',
                classes: '',
                checked: false
            });
            elements = [
                {label: 'Stacked', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(stacked)},
                {label: 'Width', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(width)},
                {label: 'Height', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(height)},
                {label: 'Show legend', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(legend)},
                {label: 'Use point style', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(usepointstyle)}
            ];
            var fieldsetGlobals = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Customize', options: elements});

            elements = [
                {
                    label: 'Bar size: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsSlider({
                        id: 'chart-options-xaxis-barpercentage',
                        classes: 'chart-options-xaxis',
                        min: 0,
                        max: 1,
                        step: 0.01,
                        value: 0.9
                    }))
                },
                {
                    label: 'Category size: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsSlider({
                        id: 'chart-options-xaxis-categorypercentage',
                        classes: 'chart-options-xaxis',
                        min: 0,
                        max: 1,
                        step: 0.01,
                        value: 0.9
                    }))
                },
                {
                    label: 'Label: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsText({
                        id: 'chart-options-xaxis-label',
                        classes: 'chart-options-xaxis',
                        placeholder: 'Enter a label'
                    }))
                },
                {
                    label: 'Grid line width: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsNumber({
                        id: 'chart-options-xaxis-gridlinewidth',
                        classes: 'chart-options-xaxis',
                        min: 1,
                        max: 50,
                        value: 1
                    }))
                },
                {
                    label: 'Grid line color: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.colorPicker({
                        id: 'chart-options-xaxis-gridlinecolor',
                        classes: 'chart-options-xaxis',
                        lastChosenColor: '',
                        palette: palette
                    }))
                }
            ];
            var fieldsetXAxis = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'X Axis', options: elements});

            elements = [
                {
                    label: 'Type: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsSelect({
                        id: 'chart-options-yaxis-type',
                        classes: 'chart-options-yaxis',
                        values: [ 'linear', 'logarithmic' ],
                        labels: [ 'Linear', 'Logarithmic' ],
                        selected: psqlChartData.options.scales.yAxes[0].type
                    }))
                },
                {
                    label: 'Label: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsText({
                        id: 'chart-options-yaxis-label',
                        classes: 'chart-options-yaxis',
                        placeholder: 'Enter a label'
                    }))
                },
                {
                    label: 'Grid line width: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsNumber({
                        id: 'chart-options-yaxis-gridlinewidth',
                        classes: 'chart-options-yaxis',
                        min: 1,
                        max: 50,
                        value: 1
                    }))
                },
                {
                    label: 'Grid line color: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.colorPicker({
                        id: 'chart-options-yaxis-gridlinecolor',
                        classes: 'chart-options-yaxis',
                        lastChosenColor: '',
                        palette: palette
                    }))
                }
            ];
            var fieldsetYAxis = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Y Axis', options: elements});

            $content.find('#options').html(fieldsetColors).append(fieldsetXAxis).append(fieldsetYAxis).append(fieldsetGlobals);

            // hide options by default
            $('fieldset.group > ul').toggle();

            $('.chart-options-colorpicker').each(function () {
                PlaySQL.Helpers.colorPicker($(this), true);
            });

            $('#chart-options-stacked').change(function () {
                var checked = $(this).prop('checked');
                psqlChartData.options.scales.xAxes[0].stacked = checked;
                psqlChartData.options.scales.yAxes[0].stacked = checked;
                psqlChartData.view.update();
            });

            addHandlersToSlider(psqlChartData, $('#chart-options-width'),  $('#chart-options-width-value'),  "width", "width", MAX_WIDTH);
            addHandlersToSlider(psqlChartData, $('#chart-options-height'), $('#chart-options-height-value'), "height", "height", MAX_HEIGHT);

            $('.chart-options-colorpicker').on('playsql-color-changed', function () {
                var label = this.id.replace('chart-options-colorpicker-', '');
                var val = $(this).attr('data-color');
                if(!isColor(val)) return;
                psqlChartData.colors.background[label.toString()] = val;
                psqlChartData.transformedData.datasets.find(function (d) { return d.label === label; }).backgroundColor = val;
                psqlChartData.view.update();
            });

            $('#chart-options-xaxis-barpercentage').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].barPercentage = val;
                $('#chart-options-xaxis-barpercentage-value').text(val);
                psqlChartData.view.update();
            });
            $('#chart-options-xaxis-categorypercentage').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].categoryPercentage = val;
                $('#chart-options-xaxis-categorypercentage-value').text(val);
                psqlChartData.view.update();
            });
            $('#chart-options-xaxis-label').change(function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].scaleLabel = {
                    display: !!val,
                    labelString: val
                };
                psqlChartData.view.update();
            });
            $('#chart-options-xaxis-gridlinewidth').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].gridLines.lineWidth = val;
                psqlChartData.view.update();
            });
            var $xGridLineColor = $('#chart-options-xaxis-gridlinecolor');
            PlaySQL.Helpers.colorPicker($xGridLineColor, true);
            $xGridLineColor.on('playsql-color-changed', function () {
                var val = $(this).attr('data-color');
                psqlChartData.options.scales.xAxes[0].gridLines.color = val;
                psqlChartData.view.update();
            });

            $('#chart-options-yaxis-type').on('change', function () {
                var val = $(this).val();
                psqlChartData.options.scales.yAxes[0].type = val;
                psqlChartData.type.showChart(psqlChartData, ctx, true);
            });

            $('#chart-options-legend').change(function () {
                psqlChartData.options.legend.display = $(this).prop('checked');
                psqlChartData.view.update();
            });
            $('#chart-options-usepointstyle').change(function () {
                psqlChartData.options.legend.labels.usePointStyle = $(this).prop('checked');
                psqlChartData.view.update();
            });

            $('#chart-options-yaxis-label').change(function () {
                var label = $(this).val();
                psqlChartData.options.scales.yAxes[0].scaleLabel = {
                    display: !!label,
                    labelString: label
                };
                psqlChartData.view.update();
            });
            $('#chart-options-yaxis-gridlinewidth').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.yAxes[0].gridLines.lineWidth = val;
                psqlChartData.view.update();
            });
            var $yGridLineColor = $('#chart-options-yaxis-gridlinecolor');
            PlaySQL.Helpers.colorPicker($yGridLineColor, true);
            $yGridLineColor.on('playsql-color-changed', function () {
                var val = $(this).attr('data-color');
                psqlChartData.options.scales.yAxes[0].gridLines.color = val;
                psqlChartData.view.update();
            });
        };
        this.showChart = function(psqlChartData, ctx, force) {
            if(force) {
                // we destroy the last chart instance
                psqlChartData.view && psqlChartData.view.destroy();
            }

            psqlChartData.transformedData.datasets.sort(compareDatasets);
            psqlChartData.view = new Chart(ctx, {
                type: 'bar',
                data: psqlChartData.transformedData,
                options: psqlChartData.options
            });
            psqlChartData.options = psqlChartData.view.options;
            psqlChartData.view.canvas.parentNode.style.width = psqlChartData.options.width;
            psqlChartData.view.canvas.parentNode.style.height = psqlChartData.options.height;
        };
    }

    function LineChartType() {
        // Inherit from AbstractChartType
        AbstractChartType.call(this);
        this.id = "line";
        this.name = "Line Chart";
        this.img = PlaySQL.SPI.getRoute("img", "chart-line-96px.png");
        this.desc = "A Line chart allows you to show the evolution of data over the time";
        this.selectAxis = function(psqlChartData, $content) {
            var labelColumns = [];
            var valueColumns = [];

            psqlChartData.source.columns.forEach(function (column) {
                labelColumns.push(column);
                if(["INTEGER", "NUMERIC"].indexOf(column.type) !== -1)
                    valueColumns.push(column);
            });

            var html = Confluence.Templates.PlaySQL.chartLineAxis({
                labelColumns: labelColumns,
                valueColumns: valueColumns,
                selectedLabel: psqlChartData.labelColumn,
                selectedColumns: psqlChartData.valueColumns || []
            });
            $content.html(html);

            $('.chart-line-select-column-values')
                .on('click', '.aui-iconfont-arrow-up', function () {
                    var $column = $(this).parent();
                    var $listColumns = $('.chart-line-select-column-values div');
                    var index = $listColumns.index($column);
                    if(index > 0) {
                        // the column can be moved up
                        var $previous = $listColumns.get(index -1);
                        $column.insertBefore($previous);
                    }
            })  .on('click', '.aui-iconfont-arrow-down', function() {
                    var $column = $(this).parent();
                    var $listColumns = $('.chart-line-select-column-values div');
                    var index = $listColumns.index($column);
                    if(index < $listColumns.length - 1) {
                        // the column can be moved down
                        var $next = $listColumns.get(index +1);
                        $column.insertAfter($next);
                    }
            });
        };
        this.saveAxis = function(psqlChartData, $errors) {
            var labelColumn = $('#chart-line-select-column-labels').val();
            var valueColumns = [];
            $('.chart-line-select-column-values > div > input:checked').each(function () {
                valueColumns.push($(this).val());
            });

            if(labelColumn && valueColumns.length > 0) {
                psqlChartData.labelColumn = labelColumn;
                psqlChartData.valueColumns = valueColumns;
                psqlChartData.source.columnsUsed = labelColumn + ',' + valueColumns.join(',');
                return true;
            }
            $errors.text("You must select columns for label and values!");
            return false;
        };
        this.generateData = function(psqlChartData) {
            var data = psqlChartData.transformedData = {
                datasets: [],
                labels: []
            };

            var labelColPos;
            var valueColPos = [];
            psqlChartData.rawData.tableDef.columns.forEach(function (column, i) {
                if(column.name === psqlChartData.labelColumn) {
                    labelColPos = i;
                }
                if(psqlChartData.valueColumns.indexOf(column.name) !== -1) {
                    valueColPos.push(i);
                    var color = getOrAffect(psqlChartData.colors.border, column.name, getRandomColor());
                    var bgColor = getOrAffect(psqlChartData.colors.background, column.name, color);
                    var fill = getOrAffect(psqlChartData.colors.fill, column.name, false);
                    var pointStyle = getOrAffect(psqlChartData.style.pointStyle, column.name, 'circle');
                    var pointRadius = getOrAffect(psqlChartData.style.pointRadius, column.name, 3);
                    var lineTension = getOrAffect(psqlChartData.style.lineTension, column.name, 0.4);

                    data.datasets.push({
                        data: [],
                        label: column.name,
                        borderColor: color,
                        backgroundColor: bgColor,
                        fill: fill,
                        pointStyle: pointStyle,
                        pointRadius: pointRadius,
                        lineTension: lineTension
                    });
                }
            });

            if(labelColPos === undefined || valueColPos.length === 0) {
                AJS.flag({
                    type: 'error',
                    title: 'Error generating chart',
                    body: 'The label and/or value column could not be found. Please try to select your columns again.'
                });
                return;
            }

            psqlChartData.rawData.data.forEach(function (row, i) {
                var label = row[labelColPos][0];
                label = stripHtml(label);
                data.labels.push(label);
                valueColPos.forEach(function (colPos, j) {
                    var value = row[colPos][0];
                    value = stripHtml(value);
                    data.datasets[j].data.push(value);
                });
            });
        };
        this.showOptions = function(psqlChartData, $content, ctx) {
            this.showChart(psqlChartData, ctx);

            var $container = $('#chart-canvas-container');
            psqlChartData.options.maintainAspectRatio = false;
            psqlChartData.options.height = psqlChartData.options.height || $container.height() + 'px';
            psqlChartData.options.width = psqlChartData.options.width || $container.width() + 'px';
            var $options = $content.find('#options');

            var fillValues = ['false', 'origin', 'start', 'end'];
            var fillLabels = ['No filling', 'Fill to origin', 'Fill to start', 'Fill to end'];
            for(var i = 0; i < psqlChartData.transformedData.datasets.length; ++i) {
                // first loop to get the fill* arrays
                fillValues.push(i);
                fillLabels.push('Fill to ' + psqlChartData.transformedData.datasets[i].label);
            }

            for(var i = 0; i < psqlChartData.transformedData.datasets.length; ++i) {
                var label = psqlChartData.transformedData.datasets[i].label;
                var bgColor = psqlChartData.colors.background[label];
                var borderColor = psqlChartData.colors.border[label];
                var pointStyle = psqlChartData.style.pointStyle[label];
                var pointRadius = psqlChartData.style.pointRadius[label];
                var lineTension = psqlChartData.style.lineTension[label];

                var elements = [];
                var element = Confluence.Templates.PlaySQL.colorPicker({
                    id: 'chart-options-colorpicker-background-' + label,
                    classes: 'chart-options-colorpicker chart-options-colorpicker-background',
                    lastChosenColor: bgColor,
                    palette: palette
                });
                elements.push({label: 'Background color: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                var j = fillValues.indexOf(i);
                element = Confluence.Templates.PlaySQL.chartOptionsSelect({
                    id: 'chart-options-fill-' + label,
                    classes: 'chart-options-fill',
                    values: fillValues.filter(function (arr, index) { return index !== j; }),
                    labels: fillLabels.filter(function (arr, index) { return index !== j; }),
                    selected: psqlChartData.colors.fill[label] || fillValues[0],
                    canCreate: true
                });
                elements.push({label: 'Fill: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                element = Confluence.Templates.PlaySQL.colorPicker({
                    id: 'chart-options-colorpicker-border-' + label,
                    classes: 'chart-options-colorpicker chart-options-colorpicker-border',
                    lastChosenColor: borderColor,
                    palette: palette
                });
                elements.push({label: 'Border color: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                element = Confluence.Templates.PlaySQL.chartOptionsSelect({
                    id: 'chart-options-point-style-' + label,
                    classes: 'chart-options-point-style',
                    values: ['circle','cross','crossRot','dash','line','rect','rectRounded','rectRot','star','triangle'],
                    labels: ['Circle', 'Cross', 'Cross Rot', 'Dash', 'Line', 'Rect', 'Rect Rounded', 'Rect Rot', 'Star', 'Triangle' ],
                    selected: pointStyle
                });
                elements.push({label: 'Point style: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                element = Confluence.Templates.PlaySQL.chartOptionsNumber({
                    id: 'chart-options-point-radius-' + label,
                    classes: 'chart-options-point-radius',
                    value: pointRadius,
                    min: 0,
                    max: 20
                });
                elements.push({label: 'Point radius: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                element = Confluence.Templates.PlaySQL.chartOptionsSlider({
                    id: 'chart-options-line-tension-' + label,
                    classes: 'chart-options-line-tension',
                    min: 0,
                    max: 1,
                    value: lineTension,
                    step: 0.01
                });
                elements.push({label: 'Line Tension: ', element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)});

                var fieldset = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Dataset "'+ label + '"', options: elements});
                $options.append(fieldset);
            }

            var element = Confluence.Templates.PlaySQL.chartOptionsSelect({
                id: 'chart-options-xaxis-type',
                classes: 'chart-options-xaxis',
                values: [ 'category', 'time' ],
                labels: [ 'Text Labels', 'Time Scale' ],
                selected: psqlChartData.options.scales.xAxes[0].type
            });
            var elements = [
                {
                    label: 'Type: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)
                },
                {
                    label: 'Label: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsText({
                        id: 'chart-options-xaxis-label',
                        classes: 'chart-options-xaxis',
                        placeholder: 'Enter a label'
                    }))
                },
                {
                    label: 'Grid line width: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsNumber({
                        id: 'chart-options-xaxis-gridlinewidth',
                        classes: 'chart-options-xaxis',
                        min: 1,
                        max: 50,
                        value: 1
                    }))
                },
                {
                    label: 'Grid line color: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.colorPicker({
                        id: 'chart-options-xaxis-gridlinecolor',
                        classes: 'chart-options-xaxis',
                        lastChosenColor: '',
                        palette: palette
                    }))
                }
            ];

            var fieldset = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'X Axis', options: elements});
            $options.append(fieldset);

            element = Confluence.Templates.PlaySQL.chartOptionsSelect({
                id: 'chart-options-yaxis-type',
                classes: 'chart-options-yaxis',
                values: [ 'linear', 'logarithmic' ],
                labels: [ 'Linear', 'Logarithmic' ],
                selected: psqlChartData.options.scales.yAxes[0].type
            });
            elements = [
                {
                    label: 'Type: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(element)
                },
                {
                    label: 'Label: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsText({
                        id: 'chart-options-yaxis-label',
                        classes: 'chart-options-yaxis',
                        placeholder: 'Enter a label'
                    }))
                },
                {
                    label: 'Grid line width: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsNumber({
                        id: 'chart-options-yaxis-gridlinewidth',
                        classes: 'chart-options-yaxis',
                        min: 1,
                        max: 50,
                        value: 1
                    }))
                },
                {
                    label: 'Grid line color: ',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.colorPicker({
                        id: 'chart-options-yaxis-gridlinecolor',
                        classes: 'chart-options-yaxis',
                        lastChosenColor: '',
                        palette: palette
                    }))
                }
            ];
            fieldset = Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Y Axis', options: elements});
            $options.append(fieldset);

            $('.chart-options-colorpicker-background, .chart-options-colorpicker-border').each(function () {
                PlaySQL.Helpers.colorPicker($(this), true);
            });

            $('.chart-options-colorpicker-border').on('playsql-color-changed', function () {
                var label = this.id.replace(/^chart-options-colorpicker-border-/, '');
                var val = $(this).attr('data-color');
                if(!isColor(val)) return;
                psqlChartData.colors.border[label] = val;
                findViewDataset(psqlChartData, label).borderColor = val;
                psqlChartData.view.update();
            });

            $('.chart-options-colorpicker-background').on('playsql-color-changed', function () {
                var label = this.id.replace(/^chart-options-colorpicker-background-/, '');
                var val = $(this).attr('data-color');
                if(!isColor(val)) return;
                val = val.replace('rgb', 'rgba').replace(')', ', 0.5)');
                psqlChartData.colors.background[label] = val;
                var dataset = findViewDataset(psqlChartData, label);
                dataset.backgroundColor = val;
                psqlChartData.view.update();
            });

            $('.chart-options-fill').on('change', function () {
                var label = this.id.replace(/^chart-options-fill-/, '');
                var val = $(this).val();
                psqlChartData.colors.fill[label] = val;
                findViewDataset(psqlChartData, label).fill = val;
                psqlChartData.view.update();
            });

            $('.chart-options-point-style').on('change', function () {
                var label = this.id.replace(/^chart-options-point-style-/, '');
                var val = $(this).val();
                psqlChartData.style.pointStyle[label] = val;
                findViewDataset(psqlChartData, label).pointStyle = val;
                psqlChartData.view.update();
            });

            $('.chart-options-point-radius').on('change', function () {
                var label = this.id.replace(/^chart-options-point-radius-/, '');
                var val = $(this).val();
                psqlChartData.style.pointRadius[label] = val;
                findViewDataset(psqlChartData, label).pointRadius = val;
                psqlChartData.view.update();
            });

            $('.chart-options-line-tension').on('input', function () {
                var label = this.id.replace(/^chart-options-line-tension-/, '');
                var val = $(this).val();
                if(val < 0 || val > 1) return;
                psqlChartData.style.lineTension[label] = val;
                findViewDataset(psqlChartData, label).lineTension = val;
                $('#' + this.id + '-value').text(val);
                psqlChartData.view.update();
            });

            $('#chart-options-xaxis-type').on('change', function () {
                $('#chart-options-xaxis-timeformat').remove();
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].type = val;
                if(val === 'time') {
                    var optTime = getOrAffect(psqlChartData.options.scales.xAxes[0], 'time', {});
                    var element = $('<input>', {
                        type: 'text',
                        id: 'chart-options-xaxis-timeformat',
                        value: optTime.format || 'YYYY-MM-DD'
                    }).insertAfter($(this))
                        .on('change', function () {
                            optTime.format = $(this).val();
                            psqlChartData.type.showChart(psqlChartData, ctx, true);
                        });
                    if(optTime.format)
                        psqlChartData.type.showChart(psqlChartData, ctx, true);
                    return;
                }
                psqlChartData.type.showChart(psqlChartData, ctx, true);
            });
            $('#chart-options-xaxis-label').change(function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].scaleLabel = {
                    display: !!val,
                    labelString: val
                };
                psqlChartData.view.update();
            });
            $('#chart-options-xaxis-gridlinewidth').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.xAxes[0].gridLines.lineWidth = val;
                psqlChartData.view.update();
            });
            var $xGridLineColor = $('#chart-options-xaxis-gridlinecolor');
            PlaySQL.Helpers.colorPicker($xGridLineColor, true);
            $xGridLineColor.on('playsql-color-changed', function () {
                var val = $(this).attr('data-color');
                psqlChartData.options.scales.xAxes[0].gridLines.color = val;
                psqlChartData.view.update();
            });

            $('#chart-options-yaxis-type').on('change', function () {
                var val = $(this).val();
                psqlChartData.options.scales.yAxes[0].type = val;
                psqlChartData.type.showChart(psqlChartData, ctx, true);
            });
            $('#chart-options-yaxis-label').change(function () {
                var label = $(this).val();
                psqlChartData.options.scales.yAxes[0].scaleLabel = {
                    display: !!label,
                    labelString: label
                };
                psqlChartData.view.update();
            });
            $('#chart-options-yaxis-gridlinewidth').on('input', function () {
                var val = $(this).val();
                psqlChartData.options.scales.yAxes[0].gridLines.lineWidth = val;
                psqlChartData.view.update();
            });
            var $yGridLineColor = $('#chart-options-yaxis-gridlinecolor');
            PlaySQL.Helpers.colorPicker($yGridLineColor, true);
            $yGridLineColor.on('playsql-color-changed', function () {
                var val = $(this).attr('data-color');
                psqlChartData.options.scales.yAxes[0].gridLines.color = val;
                psqlChartData.view.update();
            });

            $options.append(Confluence.Templates.PlaySQL.chartOptionsFieldset({name: 'Customize', options: [
                {
                    label: 'Height',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsSlider({
                        min: 0,
                        max: MAX_HEIGHT,
                        value: (psqlChartData.options.height || '-1').replace('px', ''),
                        id: 'chart-options-height',
                        classes: ''
                    }))
                },
                {
                    label: 'Width',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsSlider({
                        min: 0,
                        max: MAX_WIDTH,
                        value: (psqlChartData.options.width || '-1').replace('px', ''),
                        id: 'chart-options-width',
                        classes: ''
                    }))
                },
                {
                    label: 'Legend',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                        id: 'chart-options-legend',
                        classes: '',
                        checked: true
                    }))
                },
                {
                    label: 'Use point style',
                    element: soydata.VERY_UNSAFE.ordainSanitizedHtml(Confluence.Templates.PlaySQL.chartOptionsCheckbox({
                        id: 'chart-options-usepointstyle',
                        classes: '',
                        checked: false
                    }))
                }
            ]}));

            addHandlersToSlider(psqlChartData, $('#chart-options-height'), $('#chart-options-height-value'), "height", "height", MAX_HEIGHT);
            addHandlersToSlider(psqlChartData, $('#chart-options-width'),  $('#chart-options-width-value'),  "width",  "width",  MAX_WIDTH);

            $('#chart-options-legend').change(function () {
                psqlChartData.options.legend.display = $(this).prop('checked');
                psqlChartData.view.update();
            });
            $('#chart-options-usepointstyle').change(function () {
                psqlChartData.options.legend.labels.usePointStyle = $(this).prop('checked');
                psqlChartData.view.update();
            });

            // hide options by default
            $('fieldset.group > ul').toggle();
        };
        this.showChart = function(psqlChartData, ctx, force) {
            if(force) {
                // we destroy the last chart instance
                psqlChartData.view && psqlChartData.view.destroy();
            }
            psqlChartData.view = new Chart(ctx, {
                type: 'line',
                data: psqlChartData.transformedData,
                options: psqlChartData.options
            });
            psqlChartData.options = psqlChartData.view.options;
            psqlChartData.view.canvas.parentNode.style.width = psqlChartData.view.options.width;
            psqlChartData.view.canvas.parentNode.style.height = psqlChartData.view.options.height;
        };
    }

    function getRandomColor() {
        // The following colors are from the AUI guidelines https://atlassian.design/server/foundations/colors/
        var colors = [ "#d04437", "#205081", "#f5f5f5", "#333333", "#3772b0", "#ebf2f9", "#707070", "#14892c", "#f6c342",
            "#999999", "#cccccc", "#e9e9e9", "#815b3a", "#f79232", "#f1a257", "#d39c3f", "#59afe1", "#4a6785", "#84bbc6", "#8eb021",
            "#67ab49", "#654982", "#ac707a", "#f15c75", "#f691b2"];
        return colors[Math.floor(Math.random()*colors.length)];
    }

    function isColor(val) {
        return !!val;
        /*
        if(!(typeof val === "string" || val instanceof String) || val.length < 1)
            return false;
        var hexRegexp = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
        var rgbRegexp = /^rgb\(\s?\d{1,3}\s?,\s?\d{1,3}\s?,\s?\d{1,3}\s?\)$/;
        var rgbaRegexp = /^rgba\(\s?\d{1,3}\s?,\s?\d{1,3}\s?,\s?\d{1,3}\s?,\s?([01]|(0\.\d+))\)$/;
        return val.match(hexRegexp) || val.match(rgbRegexp) || val.match(rgbaRegexp);
        */
    }

    function compareDatasets(d1, d2) {
        if(d1.label < d2.label) return -1;
        else if(d1.label > d2.label) return 1;
        return 0;
    }

    function findDataset(datasets, label) {
        return datasets.find(function (d) { return d.label === label; });
    }

    function findViewDataset(psqlChartData, label) {
        return findDataset(psqlChartData.view.data.datasets, label);
    }

    function findTransformedDataset(psqlChartData, label) {
        return findDataset(psqlChartData.transformedData.datasets, label);
    }

    function addHandlersToSlider(psqlChartData, $slider, $text, name, cssName, max) {
        $slider.on('input', function () {
            if($(this).val() == max) {
                $text.text("Max");
                psqlChartData.options[name] = '-1'; // special value
                $(psqlChartData.view.canvas.parentNode).css(cssName, "");
                $slider.val(max).trigger('change');
                return;
            }
            var value = $(this).val() + 'px';
            psqlChartData.options[name] = value;
            $(psqlChartData.view.canvas.parentNode).css(cssName, value);
            $text.text(value);
        });

        if(psqlChartData.options && psqlChartData.options[name] === '-1') {
            $slider.val(max).trigger('change');
            $text.text("Max");
        }
    }

    /*
     * Use when you have this kind of code:
     * var v = a.b.c.d || defaultValue;
     * a.b.c.d = v;
     * In this example, obj is a.b.c, target is d
     * This function will return the final value ('v').
     * Please note that a.b.c.d is transformed to a.b.c['d']
     * This allows you to use array as well as objects, but you need to quote the field name if you use an object.
     */
    function getOrAffect(obj, target, defVal) {
        var value = obj[target] || defVal;
        obj[target] = value;
        return value;
    }

    PlaySQL.Charts.readPlaceholder = function readPlaceholder($placeholder, callback) {

        var context = $placeholder.attr('data-context');
        var id = $placeholder.attr('data-chart-id');
        var width = $placeholder.attr('data-width');
        var height = $placeholder.attr('data-height');
        try {
            var chartJson = JSON.parse($placeholder.attr('data-chart-json'));
        } catch (err) {
            AJS.log("err" + err);
            chartJson = null;
        }
        if (!chartJson && !context) {
            throw "Not a placeholder for a chart: " + $placeholder[0];
        }
        //var permLevel = $placeholder.data('permlevel');

        var psqlChartData = PlaySQL.Charts.newChartData(context, $placeholder);

        if (chartJson) {
            if (chartJson.serialized) {
                // the following lines are used to build the chart if it already exist.
                chartJson.deserialized = PlaySQL.Charts.fromSerialized(psqlChartData, chartJson.serialized);
                if (!chartJson.deserialized) {
                    AJS.flag({
                        type: 'error',
                        title: 'Chart error',
                        body: 'Can\'t create the chart from the database, it may be corrupted'
                    });
                }
            }
            if (chartJson.id) {
                psqlChartData.id = chartJson.id;
                psqlChartData.label = chartJson.label;
            }
            if (width) psqlChartData.options.width = width;
            if (height) psqlChartData.options.height = height;
            callback && callback(psqlChartData);
        } else if (!!id && !!context) {
            // chartJson is null but the ID is available? Let's fetch the details of the chart.
            $.ajax({
                url: PlaySQL.SPI.baseUrl0("charts", context, id),
                type: "GET",
                contentType: "application/json; charset=utf-8",
                dataType: "json"
            }).success(function (data) {
                PlaySQL.Charts.fromSerialized(psqlChartData, data.serialized);
                psqlChartData.id = data.id;
                psqlChartData.label = data.label;
                if (width) psqlChartData.options.width = width;
                if (height) psqlChartData.options.height = height;
                callback && callback(psqlChartData);
            }).fail(function (jqXHR) {
                AJS.flag({
                    type: 'error',
                    title: 'Chart failed',
                    body: '<p>The data of the chart ' + chartJson.id + ' couldn\'t be retrieved from the server.</p>' + PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 200)
                });
            });
        }
    };

    PlaySQL.Charts.showChart = function showChart($placeholder, callback1) {
        PlaySQL.Charts.readPlaceholder($placeholder, function(psqlChartData){
            if(!psqlChartData.rawData) {
                PlaySQL.Charts.getData(psqlChartData, psqlChartData.source, callback);
            } else {
                callback();
            }
            function callback() {
                psqlChartData.type.generateData(psqlChartData);
                psqlChartData.showChart();
                callback1 && callback1(psqlChartData);
            }
        });

    };

    PlaySQL.Charts.getChartType = function(id) {
        for(var i = 0; i < chartTypes.length; ++i) {
            var type = chartTypes[i];
            if(type.id === id)
                return type;
        }
    };

    PlaySQL.Charts.getData = function(psqlChartData, source, callback) {
        var context = source.context;
        var columns = source.columnsUsed;
        columns = "ID,POSITION," + columns.replace(/::[^,]*/, ''); // particular syntax for aggregate functions, we need to delete that
        var tablename = source.spreadsheetId;
        var callback_arguments = Array.prototype.slice.call(arguments, 3);
        var ajaxHttpRequest;
        if (!!source.sql) {
            ajaxHttpRequest = {
                url: PlaySQL.SPI.baseUrl0("/spreadsheets", context, "QUERY-", "data", "preview", {
                    columns: columns,
                    limit: MAX_LIMIT
                }),
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({
                    sql: source.sql
                })
            };
        } else {
            ajaxHttpRequest = {
                url: PlaySQL.SPI.baseUrl0("/spreadsheets", context, tablename, "data"),
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                data: {
                    columns: columns,
                    limit: MAX_LIMIT
                }
            };
        }
        $.ajax(ajaxHttpRequest).success(function (data, status, request) {
            var spreadsheet = { options: {} };
            PlaySQL.Helpers.readSpreadsheetData(data, status, request, spreadsheet, {});
            psqlChartData.rawData = data;
            if(callback) {
                callback.apply(null, callback_arguments);
            }
        }).error(function(jqXHR) {
            AJS.flag({
                type: 'error',
                title: "Error while reading the data from this source",
                body: "<p>Please select another source.</p>" + PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 200)
            });
        });
    };

    AJS.bind("playsql-load-spreadsheets", function() {
        $('.chart-canvas-container').each(function () {
            PlaySQL.Charts.showChart($(this));
        });
    });

    function removeDuplicateLabels(options) {
        var keys = [];
        for (var i = 0 ; i < options.length ; i++) {
            if (keys.indexOf(options[i].label) !== -1) {
                options.splice(i, 1);
                i--;
                continue;
            } else {
                keys.push(options[i].label);
            }
        }
    }
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/playsql-macro-view.js' */
/** This is the legacy macro */
var PlaySQLMacro = (function() {
    var $ = AJS.$;

    function initialize($playsql) {
        if ($playsql.data("initialized")) {
            AJS.log("PlaySQL is already initialized.");
            return;
        }
        $playsql.data("initialized", true);

        var $placeholder = $playsql.closest('.playsql-placeholder');
        $placeholder.find('.playsql-user-parameters .submit-user-parameters').click(function(){
            PlaySQLMacro.load($placeholder);
        });
        $placeholder.find('.playsql-user-parameters input').keypress(function(e){
            if (e.keyCode == 13) {
                PlaySQLMacro.load($placeholder);
            }
        });
    }


    return {
        Renderer : {
            key : "abstract-renderer"
        },
        /** $playsql must be a "table.playsql" element. */
        initialize : initialize,
        /** $placeholder must be a jQuery object of <div class="playsql-placeholder" data-sql="SELECT * FROM PERSON"> */
        load : function ($placeholder) {
            var htmlRest = PlaySQL.SPI.baseUrlOld("/playsql/html"),
                data = $placeholder.data(),
                macroParameters = {},
                nonStringParameters = ['user-parameters', 'groupby'],
                $userParameters = $('.playsql-user-parameters input', $placeholder),
                ceoId = AJS.Meta.get("content-id") || AJS.Meta.get("page-id");
            for (var key in data) {
                if (!data.hasOwnProperty(key)) continue;
                var key2 = key.replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
                if (key2.indexOf('macro-') == 0) {
                    var name = key2.substring(6);
                    if (nonStringParameters.includes(name)) {
                        macroParameters[name] = $.parseJSON(data[key]);
                    } else {
                        macroParameters[name] = data[key];
                    }
                }
            }
            if ($userParameters.size() > 0 && macroParameters['user-parameters']) {
                var parameters = macroParameters['user-parameters'];
                $userParameters.each(function(i){
                    var $this = $(this),
                        name = $this.attr('name'),
                        val = $this.val(),
                        parameter = parameters[i];
                    if (parameter && name == parameter.name) {
                        parameter.value = val;
                    }
                });
            }
            if (!macroParameters.context || macroParameters.context == 'space:' || macroParameters.context == 'name:') {
                var spaceKey = AJS.Meta.get('space-key');
                if (spaceKey)
                    macroParameters.context = 'space:' + spaceKey;
            }
            for (var key in macroParameters) {
                if (macroParameters.hasOwnProperty(key)) continue;
                var value = macroParameters[key];
                if (value == undefined || value === "" || (key != "sql" && typeof value == "string" && value.indexOf("$") == 0))
                    delete macroParameters[key];
            }
            if (ceoId) macroParameters["ceoId"] = ceoId;
            $.ajax({
                url:htmlRest,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(macroParameters),
                timeout: 180000
            }).done(function(data) {
                $placeholder.html(data.html);
                if (!macroParameters.readonly) {
                    $placeholder.find("table.playsql").each(function() {
                        initialize($(this));
                    });
                }
            }).fail(function(jqXHR, errorMessage, errorObject){
                AJS.logError("PlaySQL: Error while retrieving data.", jqXHR, errorMessage, errorObject);
                $placeholder.html("Could not display PlaySQL: " + errorMessage);
            });
            $placeholder.find('table:first').addClass('loading');
        }
    };
})();

AJS.$(document).ready(function($) {
    // Initialise the playsql
    $("div.playsql-placeholder").each(function() {
        var $placeholder = $(this);
        PlaySQLMacro.load($placeholder);
    });
});


}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/built-in-renderers.js' */
/**
 * Those are all Renderer1 renderers.
 * I even wonder whether playsql-init is ever triggered.
 * @deprecated Use Renderer2 instead.
 **/
AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "default-renderer"
  }));
});


AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "string-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "integer-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "boolean-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "hidden-column-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "id-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "read-only-default-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "unknown-type-renderer"
  }));
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/browser-loader.js' */
/**
 * This file binds the click on the red top-left cell to the SQL textarea. 
 */
AJS.$(function($){
  
  function openBrowser(clickedElement) {
    var componentClickedPlaceholder = $(clickedElement).closest("div.playsql-placeholder");
    if (componentClickedPlaceholder.prev("form#query-form").is(":visible"))
    {
      return;
    }
    componentClickedPlaceholder.before(Confluence.Templates.PlaySQL.browserForm());
    $form = componentClickedPlaceholder.prev("form#query-form")
    if ($form.size() != 1) {
      throw "Browser was not inserted";
    }
    PlaySQLBrowser.initialize($form);
  }
  
  $(document).delegate("div:not(.playsql-query-placeholder, .playsql-spreadsheet-placeholder) > table.playsql thead tr th:first-child a", "click", function(e) {
    e.preventDefault();
    openBrowser(e.target);
  });

  $(".playsql-placeholder").each(function() {
    if ($(this).attr("data-open-browser"))
    {
      openBrowser(this);
    }
  });
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/browser.js' */
/**
 * This file loads the SQL browser, for any existing macro.
 * "SQL Browser" = textarea just before the div.playsql-placeholder
 * in which the user may enter SQL to update the placeholder and re-query the
 * results.
 */

var PlaySQLBrowser = PlaySQLBrowser || {}; 

(function($){

  var fieldAccessor = function(fieldNameInMacro, selector, overrides, isJSON, isSaved) {
    function getWiget(selector) {
      return PlaySQLBrowser.initialized.$queryForm.find(selector);
    };
    return $.extend({
      /** @param value string format of a value */
      setField : function(value) {
        if (getWiget(selector).size() == 0) {
          PlaySQLBrowser.initialized.showField2(fieldNameInMacro, value);
        }
        if (getWiget(selector).size() > 0) {
          getWiget(selector).val(value);
        }
      },
      /** @return value string format of a value */
      getField : function() {
        if (getWiget(selector))
          return getWiget(selector).val();
      },
      /** 
       * Sets the data() in string format
       * @param value string format of the value */
      set : function(value) {
        if (isJSON && typeof value == 'string') {
          value = $.parseJSON(value);
        } 
        PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro, value);
      },
      /** 
       * Gets the value from the data parameter (data is in string format).
       * @return value the object format of the value */
      getObject : function() {
        var value = PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro);
        if (isJSON && typeof value == "string") {
          value = $.parseJSON(value);
        }
        return value;
      },
      /** 
       * @return value the string format of the value */
      getString : function() {
        var value = PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro);
        if (isJSON && typeof value == "object") {
          value = JSON.stringify(value);
        }
        return value;
      },
      isJSON : function() {
        return isJSON;
      },
      isSaved : function() {
        return isSaved;
      }
    }, overrides);
  };

  PlaySQLBrowser.fields = {
    'sql' : fieldAccessor('macro-sql', '.sql', undefined, undefined, true),
    'timeout': fieldAccessor('macro-timeout', '#timeout', undefined, undefined, true),
    'context': fieldAccessor('macro-context', "#context-selector", undefined, undefined, true),
    'readonly' : fieldAccessor('readonly', undefined, undefined, undefined, false),
    'open-browser': fieldAccessor('macro-open-browser', undefined, undefined, undefined, false),
    'groupby': fieldAccessor('macro-groupby', undefined, {}, true, true),
    'built-in-parameters': fieldAccessor('macro-built-in-parameters', "#built-in-parameters", {
        getField : function() {
            if ($("#built-in-parameters:visible").size() == 1) {
                return true;
            } else {
                return false;
            }
        },
        setField : function(value) {
            if (value === 'true' || value === true) {
                PlaySQLBrowser.initialized.showField2('macro-built-in-parameters', value);
            }
        }

    }, false, true),
    'user-parameters': fieldAccessor('macro-user-parameters', undefined, {
      setField : function(values) {
        var values = $.parseJSON(values);
        $('*[name="user-parameter"]').closest('.field-group').remove();
        for (var i=0 ; i < values.length ; i++) {
          PlaySQLBrowser.initialized.showField('user-parameter', values[i]);
        }
      },
      getField : function() {
        var values = [];
        $('*[name="user-parameter"]').each(function(){
          var $this = $(this),
              $fieldGroup = $this.closest('.field-group'),
              name = $this.val(),
              label = $fieldGroup.find('*[name="user-parameter-label"]').val(),
              defaultValue = $fieldGroup.find('*[name="user-parameter-default"]').val();
          if (name) {
            values.push({
              name: name,
              label: label,
              defaultValue: defaultValue
            });
          }
        });
        return values.length == 0 ? null : JSON.stringify(values);
      }
    }, true, true)
  };
  
  
/**
 * Initializes the browser features.
 * @param $queryForm the form#query-form in which all elements of the browser can be found. 
 */ 
PlaySQLBrowser.initialize = function($queryForm){
  if (PlaySQLBrowser.initialized) {
    throw 'The browser for Play SQL has already been initialized';
  }
  var $ = AJS.$,
      $sqlInput = $queryForm.find("textarea.sql"),
      $submitBtn = $queryForm.find("input.submit-sql"),
      $placeholder = $queryForm.next(".playsql-placeholder"),
      $autocomplete = $('#autocomplete-sql'),
      autocompleteEntries = $('<ul/>'),
      autocompleteActivated = false;
  PlaySQLBrowser.initialized = {
      $sqlInput : $sqlInput,
      $placeholder : $placeholder,
      $queryForm : $queryForm
  }

  $submitBtn.click(function(e) {
    e.preventDefault();
    PlaySQLBrowser.synchronizeValues();
    PlaySQLBrowser.query();
  });
  
  // According to the datasource in the combo box, update the macro placeholder
  var datasources,
      datasourceAvailableCallback,
      whenDatasourcesAvailable = function(callBack) {
        if (datasources) {
          callBack(datasources);
        } else {
          datasourceAvailableCallback = callBack;
        }
      };
      
  $.ajax(PlaySQL.SPI.baseUrlOld('playsql/contexts')).done(function(data){
    if (data) {
      datasources = data;
      if (datasourceAvailableCallback) {
        datasourceAvailableCallback(data);
      }
    }
  });

  $sqlInput.keydown(function(e) {
    if (e.ctrlKey && (e.keyCode == 13 || e.keyCode == 10)) {
      $submitBtn.click();
    } else if (e.ctrlKey && (e.keyCode == 32)) {
      autocompleteActivated = true;
      window.setTimeout(autocomplete, 0);
    } else {
      window.setTimeout(function(){
        updateAutocomplete(getUserLastWord());
      }, 0);
    }
  }).blur(function(e) {
    $autocomplete.hide();
    autocompleteActivated = false;
  });

//  $queryForm.find(".hide-browser").click(function(e){
//    e.preventDefault();
//    $queryForm.remove();
//  });

  function autocomplete() {
      return;
  }

  function getUserLastWord() {
    var selStart = $sqlInput[0].selectionStart,
        snippet, lastWord;
    
    if (!selStart || !$sqlInput.val()) {return;}
    snippet = $sqlInput.val().substring(0, selStart);
    if (!snippet) { return; }
    lastWord = snippet.substring(snippet.lastIndexOf(' ') + 1);
    return lastWord;
  }

  /* After an autocomplete, As the user types, reduces the matched items */ 
  function updateAutocomplete(startingWith) {
    if (autocompleteEntries.length==0 || !autocompleteActivated) return;
    startingWith = startingWith.toUpperCase();
    startingWith = startingWith.substring(startingWith.lastIndexOf('.')+1);
    
    var // Copy the values
        $newList = $('<ul/>'),
        $startingWith = $('<b/>').text(startingWith);
    
    for (var idx=0 ; idx < autocompleteEntries.length ; idx++) {
      var entry = autocompleteEntries[idx];
      if (entry.text) {
        if (idx == 15 && autocompleteEntries.length > 16) {
          $('<li/>').text('...').appendTo($newList);
          break;
        }
        if (entry.text.toLowerCase().indexOf(startingWith.toLowerCase()) == 0) {
          $('<li/>').text(entry.text.substring(startingWith.length)).prepend($startingWith.clone()).appendTo($newList);
        }
      }
    }
    $autocomplete.html($newList.children());
  }
  
  
  var $addCombo = $("#addOption").click(function(){
    var $dropDown = $(this);
    $("option.unique", $dropDown).each(function(){
      var $option = $(this),
          name = $option.attr('value'),
          $fieldGroup = $("#" + name).parent();
      if ($fieldGroup.size() > 0 && $fieldGroup.is(":visible")) {
        $option.hide();
      } else {
        $option.show();
      }
    });
    
  }).change(function(){
    var name = $addCombo.val();
    if (name == 'initial') {
      return;
    }
    $(this).val("initial");
    if (!PlaySQLBrowser.initialized.showField(name)) {
      $("#addOptionError").removeClass('hidden');
      return;
    }
  });
  

  PlaySQLBrowser.initialized.showField2 = function(fieldNameInMacro, value) {
    // The first argument should be the name of the <option> tag
    // Translations between parameter name, name of the <option> and name of the #element
    var translations = {
        'macro-timeout' : 'timeout',
        'macro-context' : 'context-selector',
        'macro-built-in-parameters' : 'built-in-parameters',
        'macro-user-parameters' : 'user-parameter'
    },
        name = translations[fieldNameInMacro] || fieldNameInMacro;
    PlaySQLBrowser.initialized.showField(name, value);
  }
  
  /**
   * Shows a parameter of the form
   * @param name
   * @param value
   * @returns {Boolean} true if successful
   */
  PlaySQLBrowser.initialized.showField = function(name, value) {
    if (name == 'macro-context') name ='context-selector';
    var $option = $("option[value='" + name + "']", $addCombo),
        $fieldGroup = $("#" + name).parent();
    if ($option.size() == 0) {
      return false;
    }
    
    if (name == 'user-parameter' && !value) {
      value = {
          name : "$param1",
          label : "Enter the value",
          defaultValue : "My default value"
      }
    } else if (name == 'built-in-user-parameter' && value === undefined) {
        value = true;
    }
    
    // Add a new group
    var $newGroup = $(Confluence.Templates.PlaySQL.addParameter({name : name, value: value})).removeClass('hidden');
    $addCombo.parent().before($newGroup);

    if (name == 'context-selector') {
      whenDatasourcesAvailable(function(datasources){
        var context = $placeholder.data('macro-context'),
            contextHalves = context ? context.split(':') : [],
            spaceKey = contextHalves.length == 2 && contextHalves[0] == 'space' ? contextHalves[1] : undefined,
            currentSpaceKey = AJS.Meta.get('space-key'),
            contextName = contextHalves.length == 2 && contextHalves[0] == 'name' ? contextHalves[1] : undefined, 
            html = Confluence.Templates.PlaySQL.datasourceOptions({
              datasources: datasources, 
              spaceKey: spaceKey, 
              currentSpaceKey : currentSpaceKey,
              contextName: contextName
            }),
            $contextSelector = $("#context-selector");
        $contextSelector.html(html);
        if (value) {
          $contextSelector.val(value);
        }
        $contextSelector.change(function() {
          var value = $(this).val(),
              contextName = '',
              contextSpaceKey = '';
          if (!value) {
            // Leave empty strings
          } else if (value.indexOf('name:') == 0) {
            contextName = value.substring(5);
          } else if (value.indexOf('space:') == 0) {
            contextSpaceKey = value.substring(6);
          }
          $(".playsql-placeholder")
            .data('space-key', contextSpaceKey)
            .data('context-name', contextName);
        });
      });
    }
    return true;
  }
  
  $queryForm.delegate('.playsql-parameter-remove', 'click', function(e){
    e.preventDefault();
    var $button = $(this),
        $fieldGroup=$button.parent();
    if ($button.hasClass('remove-mode-delete')) {
      $fieldGroup.remove();
    } else if ($button.hasClass('remove-mode-hide')) {
      $fieldGroup.addClass('hidden');
    }
  });
  
  // Load the values from the placeholder into the fields
  PlaySQLBrowser.synchronizeValuesFromPlaceholder(PlaySQLBrowser.initialized.$placeholder);
}

PlaySQLBrowser.query = function() {
  PlaySQLMacro.load(PlaySQLBrowser.initialized.$placeholder);
}


// Sets the values passed as argument into the fields.
// Put all the values of the fields into the data of $placeholder,
// and returns them.
/**
 * Sets the values passed as argument into the fields.
 * Put all the values of the fields in to the data of $placeholder.
 * @param values the string format of the values
 * @return the data to save in the macro
 */
PlaySQLBrowser.synchronizeValues = function(values) {
  if (!PlaySQLBrowser.initialized) throw "The PlaySQL browser isn't open yet";
  var toReturn = {};
  values = values || {};
  /*values['groupby'] = JSON.stringify({
      fields : ['TABLE_SCHEMA'],
      aggregations : [{
        title: 'Total 1',
        expression: 'MAX(TABLE_NAME)'
      }],
      having : "TABLE_SCHEMA IS NOT NULL"
  };
  values['orderby'] = JSON.stringify({
      fields : [{
        field : 'TABLE_SCHEMA',
        ordering : 'ASC',
        nulls : 'LAST'
      }]
  };*/
  for (var fieldName in PlaySQLBrowser.fields) {
      if (!PlaySQLBrowser.fields.hasOwnProperty(fieldName)) continue;
    var field = PlaySQLBrowser.fields[fieldName],
        value = values[fieldName];
    if (typeof value != 'undefined') {
      field.setField(value);
    } else {
      value = field.getField();
    }
    // Update all 'data' parameters of the placeholder
    if (typeof value != 'undefined') {
      field.set(value);
      if (field.isSaved()) toReturn[fieldName] = value;
    } else {
      if (field.isSaved()) toReturn[fieldName] = field.getString();
    }
  }
  return toReturn;
}

// Loads all the values from the placeholder into the fields
PlaySQLBrowser.synchronizeValuesFromPlaceholder = function($placeholder) {
  for (var fieldName in PlaySQLBrowser.fields) {
    var field = PlaySQLBrowser.fields[fieldName],
        value = field.getString();
    if (value)
      field.setField(value);
  }
}

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'templates/browser-form.soy' */
// This file was automatically generated from browser-form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }


Confluence.Templates.PlaySQL.browserForm = function(opt_data, opt_ignored) {
  return '<form action="#" id="query-form" class="aui unsectioned aui-dd-parent playsql-browser"><fieldset><div class="field-group"><label for="sql">SQL</label><textarea name="sql" class="sql"></textarea></div><div class="field-group"><label for="addOption">More options</label><select class="select medium-field" id="addOption" name="addOption"><option value="initial">- Select an option -</option><option value="context-selector" class="unique">Context</option><option value="timeout" class="unique">Timeout</option><option value="built-in-parameters">Built-in Parameters</option><option value="user-parameter">User Parameter</option></select><div class="error hidden" id="addOptionError">An error happened while creating the field</div></div></fieldset><div class="buttons-container"><div class="buttons"><input class="submit-sql button" type="submit" />&nbsp;<a class="display-more" href="#">More...</a>&nbsp;</div></div><div class="aui-dd-trigger" /><ul class="aui-dropdown hidden" id="autocomplete-sql"><li class="dropdown-item">-</li></ul></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.browserForm.soyTemplateName = 'Confluence.Templates.PlaySQL.browserForm';
}


Confluence.Templates.PlaySQL.addParameter = function(opt_data, opt_ignored) {
  return '' + ((opt_data.name == 'context-selector') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Context', html: '<select class="select medium-field" id="context-selector" name="context-selector" title="context-selector"></select>', removeMode: 'hide'}) : (opt_data.name == 'timeout') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Timeout', html: '<input class="text short-field" type="text" id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" title="Timeout in milliseconds, e.g. 30000" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value) + '"' : '') + '>&nbsp;ms', removeMode: 'delete'}) : (opt_data.name == 'built-in-parameters') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Built-in Parameters', html: '<div class="free-text-in-form" type="text" id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value) + '"' : '') + '>$userName, $userFullName, $email, $creator, $lastModifier $ceoType, $ceoId, $pageId, $pageTitle, $parentPageId, $parentPageTitle, $spaceKey, $spaceName</div>', removeMode: 'delete'}) : (opt_data.name == 'user-parameter') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Replacement Parameter', html: '<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.name) + '"' : 'value="$param1"') + 'title="The string to replace in the query. One of: &quot;$param1&quot;, &quot;$!param1&quot; and &quot;?&quot;">&nbsp; Label:&nbsp;<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '-label" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.label) + '"' : '') + ' title="The prompt for the user">Default Value:&nbsp;<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '-default" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.defaultValue) + '"' : '') + ' title="The default value">', removeMode: 'delete'}) : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.addParameter.soyTemplateName = 'Confluence.Templates.PlaySQL.addParameter';
}


Confluence.Templates.PlaySQL.parameterLine = function(opt_data, opt_ignored) {
  return '<div class="field-group hidden"><button class="playsql-parameter-remove remove-mode-' + soy.$$escapeHtml(opt_data.removeMode) + ' button" title="Click to hide this option">Remove</button><label for="' + soy.$$escapeHtml(opt_data.name) + '">' + soy.$$escapeHtml(opt_data.label) + '</label>' + soy.$$filterNoAutoescape(opt_data.html) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.parameterLine.soyTemplateName = 'Confluence.Templates.PlaySQL.parameterLine';
}


Confluence.Templates.PlaySQL.datasourceOptions = function(opt_data, opt_ignored) {
  var output = '' + ((opt_data.spaceKey) ? '<option value="space:' + soy.$$escapeHtml(opt_data.spaceKey) + '" selected="selected">Space ' + soy.$$escapeHtml(opt_data.spaceKey) + '</option>' + ((! (opt_data.spaceKey == opt_data.currentSpaceKey)) ? '<option value="space:">Current Space</option>' : '') : (opt_data.contextName) ? '<option value="name:' + soy.$$escapeHtml(opt_data.contextName) + '" selected="selected">' + soy.$$escapeHtml(opt_data.contextName) + '</option><option value="space:">Current Space</option>' : '<option value="space:" selected="selected">Current Space</option>');
  var datasourceList110 = opt_data.datasources;
  var datasourceListLen110 = datasourceList110.length;
  for (var datasourceIndex110 = 0; datasourceIndex110 < datasourceListLen110; datasourceIndex110++) {
    var datasourceData110 = datasourceList110[datasourceIndex110];
    output += (datasourceData110.name) ? (! (opt_data.contextName == datasourceData110.name)) ? '<option value="name:' + soy.$$escapeHtml(datasourceData110.name) + '">$' + soy.$$escapeHtml(datasource.name) + '</option>' : '' : (datasourceData110.spaceKey) ? (! (opt_data.spaceKey == datasourceData110.spaceKey) && ! (opt_data.currentSpaceKey == datasourceData110.spaceKey)) ? '<option value="space:' + soy.$$escapeHtml(datasourceData110.spaceKey) + '">Space ' + soy.$$escapeHtml(datasourceData110.spaceKey) + '</option>' : '' : '';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.datasourceOptions.soyTemplateName = 'Confluence.Templates.PlaySQL.datasourceOptions';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro.js' */
(function($){

    var checkNotNull = window.PlaySQL.Helpers.checkNotNull;

    /**
     * @deprecated this id is not unique on the page
     * @param id
     * @returns {*}
     */
    function byId(id) {
        if (window.PlaySQL.Spreadsheet.spreadsheets[id]) {
            return window.PlaySQL.Spreadsheet.spreadsheets[id];
        }

        if (id.hasClass && id.hasClass("playsql-spreadsheet-placeholder")) {
            // The guy substituted a jquery element for the id. Swap that.
            return byPlaceholder(id);
        } else {
            var $placeholder = $(".playsql-spreadsheet-placeholder[data-macro-spreadsheet-id='" + id + "'");
            if ($placeholder.size() != 1) throw "No placeholder with ID " + id;
            return byPlaceholder($placeholder);
        }
    }
    function byPlaceholder($placeholder) {
        var spreadsheet = $placeholder.data('playsql-spreadsheet');
        if (spreadsheet) return spreadsheet;
        spreadsheet = {
            $placeholder: $placeholder,
            id : $placeholder.attr('data-macro-spreadsheet-id'),
            context : $placeholder.attr('data-macro-context'),
            label: undefined,
            columns: [],
            whereClause : $placeholder.attr('data-macro-where-clause') || '',
            whereClauseColumnFilters : undefined,
            whereClauseConsolidated : undefined,
            orderbyClause : $placeholder.attr('data-macro-orderby-clause') || '',
            displayColumns : $placeholder.attr('data-macro-display-columns') || '',
            pagination: undefined,
            permlevel : $placeholder.attr('data-macro-permlevel'),
            perms : window.PlaySQL.Helpers.parsePerms($placeholder.attr('data-macro-permlevel')),
            breadcrumbs: $placeholder.attr('data-macro-breadcrumbs') || "",
            customEmptyMessage : $placeholder.attr('data-macro-custom-empty-message'),
            decimalSeparator : '.',
            canEditImage : true,
            defaultCase: undefined,
            dialect: undefined,
            mode: undefined, // Mode: READ_ONLY or READ_WRITE
            systemColumnsMode: undefined, // JUST_USE or SYNTHETIC
            // When we want to pipe the requests to the server, we just create an array here.
            requestPipe : undefined,
            totals: undefined,

            /* If provided, this definition is used instead of the model
             * saved in the database for the time of this request. Optional.
             */
            queryModelOverride: undefined,
            /* The list of user parameters. To be displayed before the spreadsheet. */
            userParameters: [],
            /* If user parameters are present, whether the form should be displayed */
            useForm: undefined,
            options : {
                onDisplay: undefined,
                onSelectionSet: undefined,
                onChangeTotals: undefined,
                saveTotals: undefined,
                saveColumn: undefined
            },
            /* Disables focusing on cells while the js is editing the spreadsheet (pasteHandler) */
            disableFocusManagement: false
        };

        if (!spreadsheet.id) throw "No ID on placeholder " + $placeholder.html();
        $placeholder.data('playsql-spreadsheet', spreadsheet);

        /**
         * Builds and returns the base url for a rest request
         * @param endpoint the resource name, such as "/data". The last path can
         *          be an object, in this case it's considered as the query params
         */
        var baseUrl = function(endpoint, paths, queryParams) {
            var args = [spreadsheet.context + "/" + spreadsheet.id];
            for (var i = 0 ; i < arguments.length ; i++) {
                args.push(arguments[i]);
            }
            return PlaySQL.SPI.baseUrl.apply(this, args);
        }

        var baseUrlForContext = function(endpoint, paths, queryParams) {
            var args = [spreadsheet.context];
            for (var i = 0 ; i < arguments.length ; i++) {
                args.push(arguments[i]);
            }
            return PlaySQL.SPI.baseUrl.apply(this, args);
        }

        /** Loads the spreadsheet.
         */
        var load = function(urlParameters, requestOptions, afterSpreadsheetLoadCallback) {
            if($.browser.msie && $.browser.version <= 8) {
                checkNotNull($placeholder.find(".playsql-message-inner")).text("Internet Explorer 8 is not supported.");
                return;
            }
            spreadsheet.whereClauseConsolidated = window.PlaySQL.Spreadsheet.ColumnToolbar.buildWhereClause(spreadsheet.whereClause, spreadsheet.whereClauseColumnFilters, spreadsheet.dialect);
            notifyMacroBrowserIfExists(spreadsheet);
            var urlOptions = {
                whereClause : spreadsheet.whereClauseConsolidated,
                orderby : spreadsheet.orderbyClause,
                columns: spreadsheet.displayColumns
            };

            // At first load, we can send the provided user parameters
            $.each($placeholder[0].attributes, function(){
                if (this.specified && this.name.indexOf("data-user-parameter-") == 0) {
                    var attrName = this.name.substr("data-".length);
                    urlOptions[attrName] = this.value;
                }
            });

            // Also use the user-parameters of the URL
            var allUrlParameters = PlaySQL.Helpers.parseUrlQueryString(window.location.search);
            for (var parameterName in allUrlParameters) {
                if (parameterName.indexOf("user-parameter-") != -1) {
                    urlOptions[parameterName] = allUrlParameters[parameterName];
                }
            }

            // On subsequent calls we can send back the parameters returned by the first call
            if (!!spreadsheet.userParameters && spreadsheet.userParameters.length > 0) {
                for (var i = 0; i < spreadsheet.userParameters.length ; i++) {
                    var param = spreadsheet.userParameters[i];
                    if (!param.builtIn) {
                        var paramName = "user-parameter-" + param.cleanName;
                        if (typeof param.value != "undefined") {
                            urlOptions[paramName] = param.value;
                        }
                    }
                }
            }
            $.extend(urlOptions, urlParameters);

            if (!spreadsheet.id) {
                AJS.log("Placeholder has no spreadsheet id: ", $placeholder);
                return;
            }
            var displayCallback = function(data, status, request){
                PlaySQL.Helpers.readSpreadsheetData(data, status, request, spreadsheet, $placeholder);
                var columns = spreadsheet.columns;

                var errorMessage = data.errorMessage != undefined && data.errorMessage.length > 1 ? (data.errorMessage.charAt(0).toUpperCase() + data.errorMessage.slice(1)) : "";
                var html = Confluence.Templates.PlaySQL.fullTable({
                    name: spreadsheet.id,
                    columns: columns,
                    data: data.data,
                    totals: data.totals,
                    pagination: spreadsheet.pagination,
                    recoverableErrorMessage: errorMessage,
                    customEmptyMessage: spreadsheet.customEmptyMessage,
                    editorUrl: $placeholder.attr("data-editor-url"),
                    userParameters: spreadsheet.userParameters,
                    useForm: spreadsheet.useForm,
                    useCache: data.useCache,
                    squeeze: spreadsheet.squeeze,
                    whereClauseColumnFilters : spreadsheet.whereClauseColumnFilters,
                    canEditImage: data.canEditImage
                });

                // Remove the Position column
                columns.splice(1, 1);
                for (var index = 0 ; index < columns.length ; index++) {
                    columns[index].index = index;
                }

                $placeholder.html(html);
                bindSpreadsheet();
                triggerDisplayEvents();
                if (errorMessage) {
                    // Success without formulas
                    spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "PARTIAL_SUCCESS", data);
                } else {
                    // Total success
                    spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "SUCCESS", data);
                }
                if (afterSpreadsheetLoadCallback) {
                    afterSpreadsheetLoadCallback();
                }
            };
            var failCallback = function(jqXHR, error, reason){
                if (requestOptions && requestOptions.failureCallback) {
                    if (requestOptions.failureCallback(jqXHR) === false) {
                        return;
                    }
                }
                // Is it a 4xx error?
                if (Math.round(jqXHR.status/100) * 100 == 400) {
                    try {
                        // If the BAD_REQUEST is specially formatted by Play SQL
                        var data = $.parseJSON(jqXHR.responseText);
                        var message;
                        if (data.type == "SQL_SYNTAX") {
                            message = "There is an error in the SQL syntax: " + data.message;// + "\n" + data.sql;
                        } else {
                            message = data.message || data.errorDescription || "Error";
                        }
                        if (data.userParameters) {
                            spreadsheet.userParameters = PlaySQL.Helpers.filterBuiltInParameters(data.userParameters);
                        }

                        var html = Confluence.Templates.PlaySQL.fullTable({
                            name: spreadsheet.id,
                            columns: [],
                            data: [],
                            totals: undefined,
                            recoverableErrorMessage: message,
                            customEmptyMessage: spreadsheet.customEmptyMessage,
                            editorUrl: $placeholder.attr("data-editor-url"),
                            userParameters: spreadsheet.userParameters
                        });

                        $placeholder.html(html);
                        bindSpreadsheet();
                        triggerDisplayEvents();
                        // The error can be recovered because it comes from the user, and probably the userParameters
                        // were provided
                        spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "PARTIAL_FAILURE", data);
                        return;
                    } catch (err) {
                        // Swallow and proceed to the next section
                        AJS.log(err);
                    }
                }
                var message = "Sorry, the spreadsheet couldn't be displayed: " + reason
                        + " (HTTP status code: " + jqXHR.status + ")",
                    $area = $placeholder.find(".playsql-message-inner");
                AJS.logError("PlaySQL error: " + message + "\n" + jqXHR.responseText);
                if ($area.size() > 0) {
                    $area.text(message);
                    $placeholder.find(".hidden").text(jqXHR.responseText);
                } else {
                    window.PlaySQL.Messages.addMessage("error", message, "save-spreadsheet-bean")
                }
                // The response couldn't even be parsed and/or the error isn't 4xx.
                spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "FAILURE");
            }

            if (typeof spreadsheet.queryModelOverride != "undefined") {
                // "Preview" mode, where the queryModel is posted with the data
                var url = baseUrl("/data/preview", urlOptions);
                $.ajax({
                    url: url,
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    timeout: 180000,
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(spreadsheet.queryModelOverride)
                }).done(displayCallback).fail(failCallback);

            } else {
                // Normal mode
                var url = baseUrl("/data", urlOptions);
                $.ajax({
                    url: url,
                    type: 'GET',
                    contentType: "application/json; charset=utf-8",
                    timeout: 180000,
                    cache: false
                }).done(displayCallback).fail(failCallback);
            }
            return false;
        }
        var notifyMacroBrowserIfExists = function(){
            window.setTimeout(function() {
                try {
                    var macroFilterInput = window.parent &&
                        window.parent.document &&
                        window.parent.document.getElementById("macro-param-where-clause");
                    if (macroFilterInput) {
                        $(macroFilterInput).val(PlaySQL.spreadsheet.whereClauseConsolidated);
                    }
                } catch (err) {
                    AJS.log("Error while trying to notify the Macro Browser ", err);
                }
            });
        }

        /** This is where I bind all events on buttons and get the spreadsheet alive */
        var bindSpreadsheet = function() {
            var editorUrl = $placeholder.attr('data-editor-url');
            editorUrl = editorUrl ? editorUrl : PlaySQL.SPI.getRoute("editor", spreadsheet.context, spreadsheet.id);
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) {
                spreadsheet.$placeholder.find(".add-column a").addClass("hidden");
            }
            if (!spreadsheet.perms.hasPerm('ADD_ROWS')) {
                spreadsheet.$placeholder.find(".totals-row a").addClass("hidden");
            }
            if (spreadsheet.perms.hasPerm('EDIT_TOTALS')) {
                bindMenuForTotals();
            }

            var rowMenu = PlaySQL.Popup.createMenu("row-menu", spreadsheet.$placeholder, {
                onMenuOpen: function($trigger) {
                    $trigger = $trigger.closest("tr");
                    var rowId = $trigger.attr("data-row-id");
                    var rowIds = spreadsheet.$placeholder
                        .find(".selected")
                        .closest("tr")
                        .map(function (index, tr) {
                            return $(tr).attr("data-row-id");
                        });
                    if (rowIds.length == 0) {
                        rowIds = [rowId];
                    }

                    rowMenu.removeAll();
                    if (spreadsheet.perms.hasPerm('REMOVE_ROWS')) {
                        rowMenu.addItem('<a href="#">Delete</a>', function ($trigger, e, rowIds) {
                            e.preventDefault();
                            deleteRows(rowIds);
                            return false;
                        }, rowIds);
                    }
                    rowMenu.addItem(PlaySQL.Helpers.htmlBuilder("a", {
                        href: PlaySQL.SPI.getRoute("form", spreadsheet.context, spreadsheet.id, 0, rowId, spreadsheet.breadcrumbs),
                        text: "View detail",
                        target: "_top" // for PCloud
                    }));
                }
            }).attach("clickable", "tbody > tr > th:first-child", null);

            $placeholder.find("thead tr.playsql-col-headers th:first-child").html("<a href='" + editorUrl + "' target = '_top'>&nbsp;</a>");
            var sSelection = window.PlaySQL.Selection.forTable($placeholder),
                alreadyInitialized = sSelection.alreadyInitialized;

            sSelection.init({
                onInit: function(){
                    window.PlaySQL.Selection.attach($placeholder, sSelection, {
                        "click thead tr.playsql-col-headers th.add-column a": addColumn,
                        "click th.add-row a": function($this, e){
                            e.preventDefault();
                            addRow(undefined);
                            return false;
                        },
                        "key f2": displayCellProperties,
                        "key backspace": removeCellContents,
                        "key delete": removeCellContents
                    });
                },
                canSelectFooter: spreadsheet.perms.hasPerm('EDIT_TOTALS'),
                columnSecondClick : columnSecondClick,
                rowSecondClick : rowSecondClick,
                saveCells: function($cells) {
                    // We use a timeout because we need to leave enough time for the DatePicker to
                    // register the [enter] event, put their value in the $input, and save.
                    window.setTimeout(function(){
                        var totalsModified = false;
                        spreadsheet.requestPipe = spreadsheet.requestPipe || [];
                        $cells.each(function(){
                            var $cell = $(this);
                            if ($cell.is("tr.totals-row > *.editing")) {
                                if (spreadsheet.perms.hasPerm('EDIT_TOTALS')) {
                                    window.PlaySQL.Totals.saveTotal(spreadsheet.totals, $cell);
                                    totalsModified = true;
                                }
                            } else {
                                if (spreadsheet.perms.hasPerm('EDIT_CELLS') || spreadsheet.perms.hasPerm('Q_VIEW_EDIT')) {
                                    var cell = getCell($(this));
                                    cell.renderer.saveAndView();
                                }
                            }
                        });
                        spreadsheet.sprayRequestPipe();
                        if (totalsModified) {
                            saveTotals();
                        }
                    }, 0);
                },
                editCell: function($cell) {
                    if ($cell.parent().is("tr.totals-row") && !$cell.is(":last-child")) {
                        // We don't edit totals anymore - The user has to open the menu and click Edit
                    } else {
                        // Body cells
                        if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT')) return;
                        cellSecondClick($cell);
                    }
                },
                cancelEdit : function($cell) {
                    if ($cell.parent().is("tr.totals-row")) {
                        var rendered = $cell.attr("data-rendered");
                        if ($cell.hasClass("editing") && rendered !== undefined) {
                            window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
                            $cell.html(rendered).removeClass("editing");
                        }
                    } else {
                        var cell = getCell($cell);
                        cell.renderer.cancelEdit();
                    }
                },
                getCell : getCell,
                colOf : colOf,
                popupTrigger: ".totals-row .totals-calculation",
                popupContentFn: function() {
                    this.options.showPopup();
                },
                showPopup: function() {
                    var fields = {},
                        exampleTemplates = ['SUM(%s)', 'ROUND(AVG(%s))', 'MAX(%s)'],
                        exampleTemplatesVarchar = ['MAX(%s)'],
                        examples = [],
                        examplesVarchar = [],
                        fieldName, type, template,
                        isSystemField,
                        tableName = spreadsheet.id;
                    window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide && window.PlaySQL.Selection.inlineDialog.hide();
                    for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                        fieldName = spreadsheet.columns[i].name;
                        isSystemField = spreadsheet.columns[i].statusPK || spreadsheet.columns[i].statusPosition;
                        type = spreadsheet.columns[i].type;
                        if (typeof type == "undefined") {
                            type = "\"Undefined\"";
                        }
                        if (spreadsheet.defaultCase == "LOWER" && fieldName.toLowerCase() != fieldName
                            || spreadsheet.defaultCase == "UPPER" && fieldName.toUpperCase() != fieldName) {
                            fieldName = '"' + fieldName + '"';
                        }
                        fields[type] = (fields[type] || []).concat(fieldName);
                        if (!isSystemField) {
                            if (type == 'INTEGER' || type == 'NUMERIC') {
                                template = exampleTemplates[examples.length % exampleTemplates.length];
                                examples.push(template.replace('%s', fieldName));
                            } else if ((type == 'VARCHAR' || type == 'TEXT') && examplesVarchar.length < exampleTemplatesVarchar.length) {
                                template = exampleTemplatesVarchar[examplesVarchar.length % exampleTemplatesVarchar.length];
                                examplesVarchar.push(template.replace('%s', fieldName));
                            }
                        }
                    }
                    if (spreadsheet.defaultCase == "LOWER" && tableName.toLowerCase() != tableName
                        || spreadsheet.defaultCase == "UPPER" && tableName.toUpperCase() != tableName)
                        tableName = '"' + tableName + '"';
                    var $popup = $(Confluence.Templates.PlaySQL.formulaHelp({fields:fields, examples:examples.concat(examplesVarchar), tableName: tableName}));
                    $('body')
                        .append($popup);
                    var that = this;
                    $popup.on("click", ".examples a", function() {
                        $(that.popupTrigger).val($(this).text()).focus();
                        window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
                        return false;
                    });
                },
                pasteHandler: pasteHandler,
                addRow : addRow,
                updateColumnWidth : updateColumnWidth,
                pasteImage: pasteImage
            });

            if (!alreadyInitialized) {
                $placeholder.on("click", ".pagination-squeeze", function (e) {
                    e.preventDefault();
                    $(this).closest("table.playsql").toggleClass("squeeze-mode");
                    spreadsheet.squeeze = true;
                });
                $placeholder.on("click", ".pagination-number, .pagination-see-all-rows", function (e) {
                    e.preventDefault();
                    var offset = parseInt($(this).attr("data-offset"));
                    var limit = parseInt($(this).attr("data-limit"));
                    if (!isNaN(limit)) {
                        $(this).append('<aui-spinner size="small"></aui-spinner>');
                        spreadsheet.load({limit: limit});
                    } else if (!isNaN(offset)) {
                        // (...) As simple as that...
                        // So much tame weitin afore plementin't...
                        spreadsheet.load({offset: offset});
                    }
                });
                $placeholder.on("click", ".pagination-full-screen", function() {
                    var placeholder = $placeholder[0];
                    if ($placeholder.hasClass("fullscreen")) {
                        $placeholder.removeClass("fullscreen");
                        if(document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if(document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if(document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        }
                        $(".pagination-full-screen")
                            .removeClass("aui-iconfont-unfocus").addClass("aui-iconfont-focus")
                            .text("Full screen");
                        return;
                    } else {
                        $(".pagination-full-screen")
                            .addClass("aui-iconfont-unfocus").removeClass("aui-iconfont-focus")
                            .text("Exit full screen");
                        $placeholder.addClass("fullscreen");
                        if (!placeholder) {
                            AJS.error("Full screen request, but no placeholder");
                        } else if (placeholder.requestFullscreen) {
                            placeholder.requestFullscreen();
                        } else if (placeholder.mozRequestFullScreen) {
                            placeholder.mozRequestFullScreen();
                        } else if (placeholder.webkitRequestFullscreen) {
                            placeholder.webkitRequestFullscreen();
                        } else if (placeholder.msRequestFullscreen) {
                            placeholder.msRequestFullscreen();
                        } else {
                            AJS.error("Full screen request, but the browser doesn't support it");
                            return;
                        }
                    }
                });
                // People don't see the pagination because it's on the top right, so we're trying to
                // keep it within the viewport (align-left and padding-left=offset).
                var lastOffsetX = null;
                var movePaginationIntervalId = window.setInterval(function() {
                    var $acContent = $(".ac-content");
                    if ($acContent.size() === 0) {
                        $acContent = $(document.body);
                    }
                    if ($acContent.size() === 0) {
                        window.clearInterval(movePaginationIntervalId);
                        return;
                    }
                    var offsetX = Math.abs($acContent[0].getBoundingClientRect().x); // Value is be negative
                    if (offsetX === lastOffsetX) {
                        return;
                    } else {
                        lastOffsetX = offsetX;
                    }
                    var $td = $placeholder.find(".pagination-row td");
                    if ($td.size() === 0) {
                        window.clearInterval(movePaginationIntervalId);
                        return;
                    }
                    $td.css("padding-left", offsetX + "px");
                }, 200);
            }

            // Also bind the user parameters
            $placeholder.find(".playsql-user-parameters-form").on("click", ".submit", function(e){
                e.preventDefault();
                var $form = $(this).closest(".playsql-user-parameters-form");
                if (!!spreadsheet.userParameters) {
                    for (var i = 0 ; i < spreadsheet.userParameters.length ; i++) {
                        var param = spreadsheet.userParameters[i];
                        param.value = $form.find("#user-parameter-" + param.cleanName).val();
                    }
                }
                spreadsheet.load();
            });
            $placeholder.find("#user-parameter-refresh-query").on("click", function(e){
                e.preventDefault();
                spreadsheet.load({"refreshCache": "true"});
            });

            // Trigger event, so function handlers can be overridden
            // We pass the sSelection object rather than just override handlers because they may need the original
            // handlers
            spreadsheet.options.onSelectionSet && spreadsheet.options.onSelectionSet(sSelection);
        };

        var saveTotals = function() {
            var totals = spreadsheet.totals,
                urlOptions = {};

            if (!!spreadsheet.userParameters) {
                for (var i = 0; i < spreadsheet.userParameters.length ; i++) {
                    var param = spreadsheet.userParameters[i];
                    if (!param.builtIn && typeof param.value != "undefined") {
                        var paramName = "user-parameter-" + param.cleanName;
                        urlOptions[paramName] = param.value;
                    }
                }
            }

            var url = baseUrl("/totals", urlOptions);

            window.PlaySQL.Totals.updateColspans(totals, spreadsheet.$placeholder);

            var successCallback = function(data, status, request){
                if (!data.message) {
                    var $footer = $(Confluence.Templates.PlaySQL.totalsRow({
                        totals: data.totals,
                        pagination: spreadsheet.pagination,
                        columnCount: spreadsheet.columns.length - 1
                    }));
                    $placeholder.find("tfoot").html($footer.contents());
                    if (!spreadsheet.perms.hasPerm("ADD_ROWS")) {
                        $placeholder.find(".totals-row a").addClass("hidden");
                    }
                    spreadsheet.options.onChangeTotals && spreadsheet.options.onChangeTotals(spreadsheet);
                } else {
                    var message = data.errorMessage;
                    message = message.replace("ERROR: ", "");
                    $placeholder.find("tfoot td").first().text(message + ". Edit the total again to fix the formula.");
                }
            };
            var failureCallback = function(jqXHR, error, reason){
                if (jqXHR.status == 400) {
                    try {
                        var data = JSON.parse(jqXHR.responseText);
                        if (data != null) {
                            var message = data.message || data.errorDescription  || "Error";
                            message = message.replace("ERROR: ", "");
                            if (data.type == "SQL_SYNTAX") {
                                message += " - Edit the total again to fix the formula.";
                            }
                            $placeholder.find("tfoot td").first().text(message);
                            return;
                        }
                    } catch (err) {
                        // Can't manage the JSON. Proceed to the next section
                    }
                }
                window.PlaySQL.Messages.addMessage("error", "The settings for the totals couldn't be saved",
                    "change-totals", jqXHR.responseText);
            };

            if (spreadsheet.options.saveTotals) {
                spreadsheet.options.saveTotals(spreadsheet, urlOptions, successCallback, failureCallback);
            } else {
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(totals)
                }).done(successCallback)
                    .fail(failureCallback);
            }
        }

        var updateTotalsWithAjaxRequest = PlaySQL.Helpers.debounce(function() {
            var url = baseUrl("/totals");
            $.ajax({
                url: url,
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                cache: false
            }).done(function (data, status, request) {
                var $footer = $(Confluence.Templates.PlaySQL.totalsRow({
                    totals: data.totals,
                    pagination: spreadsheet.pagination,
                    columnCount: spreadsheet.columns.length - 1
                }));
                $placeholder.find("tfoot").html($footer.contents());
                bindMenuForTotals();
            }).fail(function (jqXHR, error, reason) {
                AJS.log("error", "The totals couldn't be retrieved",
                    "change-totals", jqXHR.responseText);
            });
        }, 500);

        var updateTotals = function(totals) {
            if (!spreadsheet.perms.hasPerm('EDIT_TOTALS'))
                return;
            if (totals) {
                var $footer = $(Confluence.Templates.PlaySQL.totalsRow({
                    totals: totals,
                    pagination: spreadsheet.pagination,
                    columnCount: spreadsheet.columns.length - 1
                }));
                $placeholder.find("tfoot").html($footer.contents());
                bindMenuForTotals();
            } else {
                updateTotalsWithAjaxRequest();
            }
        };

        var triggerDisplayEvents = function() {
            var cssWordWrap = spreadsheet.css && spreadsheet.css.module("word-wrap");
            for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                var column = spreadsheet.columns[i],
                    renderer = checkNotNull(window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer]);
                renderer.onColumnDisplay(spreadsheet, column);
                if (column.width != null) {
                    updateColumnWidth(column, column.width, false);
                }
                if (cssWordWrap) {
                    if (column.formats && column.formats.wordwrap == 'true') {
                        cssWordWrap.getRule({column: column.name}).body['white-space'] = 'pre-wrap';
                    } else {
                        cssWordWrap.getRule({column: column.name}).body['white-space'] = null;
                    }
                }
            }

            if (spreadsheet.selectedRecord) {
                var $row = $placeholder.find("tr[data-row-id=" + spreadsheet.selectedRecord + "] > *:not(.right-padding)");
                $row.addClass("selected");
                $row.first().addClass("focused");
                spreadsheet.selectedRecord = undefined;
            }

            window.PlaySQL.Helpers.applyCss(spreadsheet.css, "word-wrap");
        };

        var cellSecondClick = function ($cell) {
            var cell = getCell($cell);
            if (cell) {
                if (!$cell.hasClass("editing")) {
                    if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', cell.column)) return;
                    cell.renderer.edit();
                    cell.renderer.focus();
                } else if ($cell.find("*:focus").length == 0) {
                    cell.renderer.focus();
                }
            }
        }

        var columnSecondClick = function($header) {
            if ($header.hasClass("editing"))
                return;
            var column = colOf($header);
            spreadsheet.inlinedialog = window.PlaySQL.Spreadsheet.ColumnToolbar.create(spreadsheet, column, $header);
            spreadsheet.inlinedialog.show();
        }

        /** Updates the width of the column. If save is true, save, otherwise it's still the user dragging or
         * the spreadsheet initializing. */
        var updateColumnWidth = function($header, width, save) {
            // $header can either be the column definition or the $th.
            var column = $header instanceof $ ? colOf($header) : $header,
                newColumn = column.copy(),
                columnCss = spreadsheet.css.module("column-width").getRule({column: column.name});
            if (!($header instanceof $)) $header = null;
            if (width == null) {
                delete columnCss.body["min-width"];
                delete columnCss.body["max-width"];
                delete columnCss.body["width"];
                delete columnCss.body["font-size"];
            } else {
                if (width < 20) {
                    width = 0;
                    columnCss.body["font-size"] = "0";
                } else {
                    delete columnCss.body["font-size"];
                }
                columnCss.body["min-width"] = width + "px";
                columnCss.body["max-width"] = width + "px";
                columnCss.body["width"] = width + "px";
            }
            PlaySQL.Helpers.applyCss(spreadsheet.css, "column-width");
            if (save) {
                newColumn.width = width;
                // Attempt to save, don't tell anything in failure/success
                saveColumn($header, column, newColumn, ["WIDTH"]);
            }
        }

        var rowSecondClick = function($header) {
            window.setTimeout(function() {
                if ($("#menu-rows").attr("aria-hidden") == "true") {
                    $header.find(".aui-dropdown2-trigger").trigger("aui-button-invoke");
                }
            }, 100);
        }

        /**
         * Finds a <tr/>
         * @param position the position
         * @returns $row
         */
        var findRowByPosition = function(position) {
            var $row;
            if (position != undefined) {
                $row = $placeholder.find("tr[data-row-position='" + position + "']");
            } else {
                throw "Not implemented";
            }
            if ($row.size() == 0)
                throw "Couldn't find the row: " + position;
            return $row;
        }

        var findRowByPk = function(jointSpreadsheetKey, pk) {
            if (arguments.length == 1) {
                pk = jointSpreadsheetKey;
                jointSpreadsheetKey = undefined;
            }
            if (jointSpreadsheetKey == undefined && typeof pk === "string" && pk.indexOf("-") != -1) {
                jointSpreadsheetKey = pk.substr(0, pk.indexOf("-"));
                pk = pk.substr(pk.indexOf("-") + 1);
            }
            if (pk instanceof $ && pk.is("tr")) {
                return pk;
            } else if (jointSpreadsheetKey != undefined) {
                for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                    var formats = spreadsheet.columns[i].formats;
                    if (formats["joint-table"] == jointSpreadsheetKey) {
                        var nthChild = spreadsheet.columns[i].index + 1, // the nth-child is 1-based
                            $jointIdCell = $placeholder.find("td:nth-child(" + nthChild + ")[data-value='" + checkNotNull(pk) + "']");
                        return checkNotNull($jointIdCell, pk).parent();
                    }
                }
                throw "Can't find an ID column for " + spreadsheetKey;
            } else {
                var $row = $placeholder.find("tr[data-row-id='" + checkNotNull(pk) + "']");
                return checkNotNull($row, pk);
            }
        }

        var getRecordIds = function($cell, useJointId) {
            var id = $cell.closest("tr").attr("data-row-id"),
                result = {id:id};
            if (useJointId) {
                var cell = spreadsheet.getCell($cell),
                    jointId = cell.column.formats["joint-id"],
                    jointTable = cell.column.formats["joint-table"];
                if (jointTable) {
                    // This cell is the joint id
                    result.jointId = cell.$cell.attr("data-value");
                    result.jointIdName = cell.column.name;
                    result.jointIdCell = cell;
                    result.jointTable = jointTable;
                    result.jointFk = cell.column.formats["joint-fk"];
                } else if (jointId) {
                    var idCell = spreadsheet.getCell(id, jointId);
                    if (!idCell) throw "There is no cell for the column " + jointId + " on the row " + $cell.closest("tr").attr("data-row-id");
                    var idValue = idCell.$cell.attr("data-value");
                    result.jointId = idValue;
                    result.jointIdName = jointId;
                    result.jointIdCell = idCell;
                    result.jointTable = idCell.column.formats["joint-table"];
                    result.jointFk = idCell.column.formats["joint-fk"];
                }
            }
            return result;
        }

        /** Returns a cell handler.
         * Syntax: getCell($td) returns {cell} - Please pass the td, not an inner element.
         * Syntax: getCell($row, colName) returns {cell}
         * Syntax: getCell($row, colNumber) returns {cell}
         * Syntax: getCell([jointSpreadsheetKey,] rowPrimaryKey, colName) returns {cell}
         * Syntax: getCell([jointSpreadsheetKey,] rowPrimaryKey, colNumber) returns {cell}
         */
        var getCell = function(jointSpreadsheetKey, row, col) {
            var $cell,
                $row,
                column,
                isColumnHeader,
                renderer,
                rendererInstance,
                viewRenderer,
                viewRendererInstance,
                rowId;
            if (arguments.length == 2) {
                col = arguments[1];
                row = arguments[0];
                jointSpreadsheetKey = undefined;
                if (typeof row === "string" && row.indexOf("-") != -1) {
                    jointSpreadsheetKey = row.substr(0, row.indexOf("-"));
                    $row = findRowByPk(row);
                }
            } else if (arguments.length == 1) {
                row = arguments[0];
                jointSpreadsheetKey = undefined;
            }
            if (col == undefined) {
                if (row == undefined) return undefined;
                $cell = row;
                if (!$cell instanceof $)
                    throw "Cell isn't a jQuery object: " + $cell;
                if (!$cell.is("td, th")) {
                    AJS.log("Cell isn't a td/th: " + $cell + " (it's a " + $cell.prop("tagName") + ")");
                    return undefined;
                }
                if (!$cell.closest(".playsql-spreadsheet-placeholder").is(spreadsheet.$placeholder)) {
                    AJS.log("Cell isn't on the current spreadsheet");
                    return undefined;
                }
            } else if (jointSpreadsheetKey != undefined) {
                var $row = findRowByPk(jointSpreadsheetKey, row);

                if ($.isNumeric(col)) {
                    $cell = $row.children().eq(col);
                } else {
                    // The 'col' name is the name of the joint column
                    var colDefinition = colOf(jointSpreadsheetKey, col);
                    if (colDefinition == null) return undefined;
                    $cell = $row.children().eq(colDefinition.index);
                }
            } else {
                $row = findRowByPk(row);
                if ($.isNumeric(col)) {
                    $cell = $row.children().eq(col);
                } else {
                    var col2 = colOf(col);
                    if (col2 == undefined) return undefined;
                    $cell = $row.children().eq(col2.index);
                }
            }
            if ($cell.index() >= spreadsheet.columns.length) {
                return undefined;
            } else if ($cell.find(".playsql-message-inner").size() > 0) {
                return undefined;
            }
            column = spreadsheet.columns[$cell.index()];
            isColumnHeader = $cell.is("thead > tr.playsql-col-headers > th");
            renderer = isColumnHeader
                ? window.PlaySQL.Spreadsheet.renderers["header"]
                : window.PlaySQL.Spreadsheet.renderers[column.renderer];
            rendererInstance = renderer.forCell(spreadsheet, $cell);
            if (!isColumnHeader && column.viewRenderer) {
                viewRenderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer];
                viewRendererInstance = viewRenderer.forCell(spreadsheet, $cell);
            }
            rowId = $cell.closest("tr").attr("data-row-id");
            return {
                $cell: $cell,
                isColumnHeader: isColumnHeader,
                column : column,
                renderer : checkNotNull(rendererInstance, column.renderer),
                viewRenderer : viewRendererInstance,
                rowId: rowId
            }
        }

        var getRowMetadata = function($cell) {
            return $cell.closest("tr").data("row-metadata");
        }
        var getCellMetadata = function($cell, path) {
            var rowMetadata = getRowMetadata($cell),
                column = spreadsheet.columns[$cell.index()];
            var cellMetadata = rowMetadata && rowMetadata["c_" + column.name];
            if (cellMetadata && path) {
                return cellMetadata[path];
            } else {
                return cellMetadata;
            }
        }

        /** Given a cell (or header cell), find the column.
         * Usage: colOf($cell)
         * Usage: colOf("firstcolumn")
         * Usage: colOf(3)
         * Usage: colOf("spreadsheetKey", "firstcolumn")
         * */
        var colOf = function(spreadsheetKey, $cell) {
            if ($cell == undefined) {
                $cell = spreadsheetKey;
                spreadsheetKey = null;
            }
            if ($cell instanceof $)
                return spreadsheet.columns[$cell.index()];
            else if (typeof $cell == "string") {
                var colName = $cell;
                if (spreadsheetKey) {
                    var jointIdColumn = {};
                    for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                        var formats = spreadsheet.columns[i].formats;
                        if (formats["joint-table"] == spreadsheetKey) {
                            jointIdColumn = spreadsheet.columns[i];
                            break;
                        }
                    }
                    for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                        var formats = spreadsheet.columns[i].formats,
                            jointColumnName = formats["joint-column"] || spreadsheet.columns[i].name;
                        if (formats["joint-id"] == jointIdColumn.name && jointColumnName == colName) {
                            return spreadsheet.columns[i];
                        }
                    }
                    return undefined;
                } else {
                    for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                        if (spreadsheet.columns[i].name == colName)
                            return spreadsheet.columns[i];
                    }
                }
                return undefined;
            } else if (typeof $cell == "number") {
                var colIndex = $cell;
                return spreadsheet.columns[colIndex];
            }
            throw "colOf: Couldn't parse the argument: " + $cell;
        }

        /** Returns all cells for the provided column definition */
        var $findColumnCells = function(column, includeHeader) {
            if (!column) return $();
            var $allCells = this.$placeholder.find("tbody td:nth-child(" + (column.index+1) + ")");
            if (includeHeader) {
                $allCells = $allCells.add(this.$placeholder.find("thead th[data-name='" + column.name + "']"));
            }
            return $allCells;
        }

        var addRow = function(beforePosition) {
            addRows(1, beforePosition);
        }

        var addRows = function(count, beforePosition) {
            if (!spreadsheet.perms.hasPerm('ADD_ROWS')) return false;
            // Remove the message placeholder if present
            var $messageRow = $placeholder.find("tr.playsql-message");
            if ($messageRow.size() != 0) $messageRow.remove();

            var data = [],
                $newRows = [],
                colNames = spreadsheet.columns.map(function(column){return column.name;});
            colNames.splice(1, 0, "POSITION");

            for (var j = 0; j < count; j++) {
                var row = emptyRow(colNames.length);

                // Make the row
                var template = Confluence.Templates.PlaySQL.oneRow({row:row}),
                    $row;
                // Insert the row
                if (beforePosition)
                    $row = $(template).insertBefore(findRowByPosition(beforePosition));
                else
                    $row = $(template).appendTo($placeholder.find("tbody"));
                // Edit all cells
                $row.children("td").first().each(function(i) {
                    var $cell = $(this),
                        cell = getCell($cell);
                    cell.renderer.edit();
                    cell.renderer.focus();
                    $placeholder.find(".focused").removeClass("focused selected");
                    $cell.addClass("focused selected");
                });
                // Spin the row header
                window.PlaySQL.Messages.spin($row.find("th:first")).on(undefined, "The row is being created on the server side. You cannot submit cells until the row is ready.");
                // Keep'em until we get the answer from the REST servlquest
                data[j] = row.splice(1, 1); // We don't send much data because we're just creating rows
                $newRows[j] = $row;
            }
            colNames = ["POSITION"];

            // Ajax to get the ID
            var url = baseUrl("/data");
            $.ajax({
                url: url,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data),
                headers: {
                    "X-COL-NAMES": colNames
                }
            }).done(function(data, status, request){
                for (var i = 0 ; i < data.insertedData.length && i < $newRows.length ; i++) {
                    var idCell = getCell($newRows[i], 0);
                    idCell.renderer.setOriginalValue(data.insertedData[i], data.insertedData[i]);
                }
                dispatchCellValues(data.data, data.tableDef, data.totals);
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
                for (var i = 0 ; i < $newRows.length ; i++) {
                    var $row = $newRows[i];
                    if ($row.text().length < 10) {
                        $row.remove();
                    }
                    $row.children("td:not(:last-child)").addClass("invalid").attr("title", "The row couldn't be created.");
                }
            });
            return false;
        };

        var deleteRows = function (rowIds){
            rowIds.each(function(index, rowId) {
                deleteRow(rowId);
            });
        };

        var deleteRow = function (rowId){
            if (!spreadsheet.perms.hasPerm('REMOVE_ROWS')) return;
            var $row = findRowByPk(rowId),
                url = baseUrl("/data", checkNotNull(rowId));

            var spinner = window.PlaySQL.Messages.spin($row.children().first())
                .on(500, "Deleting the row");
            $.ajax({
                url: url,
                type: 'DELETE'
            }).done(function(data, status, request){
                $row.remove();
                dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be deleted because of a " +
                "communication error with the server. ", "save-spreadsheet-bean", jqXHR.responseText);
            });
        };

        var addJointRow = function(argument, callback) {
            if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) return;
            var $cell, cell;
            if (argument instanceof $) {
                $cell = argument;
                cell = spreadsheet.getCell($cell);
            } else if (argument && argument.$cell) {
                cell = argument;
                $cell = cell.$cell;
            } else {
                throw "Not implemented: addJointRow with argument " + argument;
            }
            window.PlaySQL.Messages.spin($cell).on(500, "The row is being created in the table on the server side. You cannot submit values until the row is ready.");
            if (!cell || !cell.column.formats) {
                window.PlaySQL.Messages.addMessage("error", "It seems like the properties of the joint table are incorrect. Please run the Joint Table wizard again.", "add-row");
                return;
            }
            var jointTable = cell.column.formats["joint-table"];
            var jointFkDestination = cell.column.formats["joint-fk-dest"],
                jointFk = cell.column.formats["joint-fk"];
            var pk = cell.rowId;
            if (jointFkDestination && jointFkDestination != "ID") {
                var jointFkDestinationCell = spreadsheet.getCell(pk, jointFkDestination);
                if (!jointFkDestinationCell) throw "The FK destination is " + jointFkDestination + " but there is no such " +
                    "column for the row " + pk;
                var jointFkDestinationValue =  jointFkDestinationCell.renderer.getValue();
                if (!jointFkDestinationValue) throw "The FK destination is " + jointFkDestinationValue + " but the value is " +
                    "void for the pk " + pk;
                pk = jointFkDestinationValue;
            }

            // Ajax to get the ID
            var url = PlaySQL.SPI.baseUrl(spreadsheet.context + "/" + jointTable + "/data"),
                colNames = "POSITION," + jointFk,
                data = [[[], [pk]]];
            $.ajax({
                url: url,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data),
                headers: {
                    "X-COL-NAMES": colNames
                }
            }).done(function(data, status, request){
                window.PlaySQL.Messages.spin($cell).off();
                if (data.insertedData.length != 1) {
                    window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
                } else {
                    cell.renderer.setOriginalValue(data.insertedData[0], data.insertedData[0]);
                }
                callback && callback();
                spreadsheet.dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.spin($cell).off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
            });
        }

        var removeJointRow = function($cell) {
            if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) return;
            var spinner = window.PlaySQL.Messages.spin($cell).on(500, "Deleting the row");
            var cell = spreadsheet.getCell($cell);
            if (!cell || !cell.column.formats) {
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "It seems like the properties of the joint table are incorrect. Please run the Joint Table wizard again.", "remove-row");
                return;
            }
            var jointTable = cell.column.formats["joint-table"],
                jointId = cell.column.name,
                pk = $cell.attr("data-value");
            if (!pk) return;

            // Ajax to remove the ID
            var url = PlaySQL.SPI.baseUrl(spreadsheet.context + "/" + jointTable + "/data/" + pk);

            $.ajax({
                url: url,
                type: 'DELETE'
            }).done(function(data, status, request){
                spinner.off();
                cell.renderer.setOriginalValue(null, null);
                for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                    var column = spreadsheet.columns[i];
                    if (column.formats["joint-id"] == jointId) {
                        var cellToDelete = spreadsheet.getCell($cell.parent(), column.index);
                        cellToDelete.$cell.empty().removeAttr("data-value").removeAttr("data-fe-value").removeClass("editing saving invalid");
                    }
                }
                spreadsheet.dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be deleted.", "remove-row", jqXHR.responseText);
            });
        }

        var recalculateFormulas = function($cells) {
            var rowId = $cells.size() == 1 ? $cells.closest("tr").attr("data-row-id") : undefined,
                options = { reindex: true };
            if (rowId != undefined) options.pkvalue = rowId;
            var url = spreadsheet.baseUrl("/metadata", options);
            $.ajax({
                url: url,
                type: 'PUT',
                dataType: "json"
            }).done(function(data, status, request){
                dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                var data;
                var message;
                var statusBracket = Math.floor(jqXHR.status/100) * 100;

                if (statusBracket == 400 || (statusBracket == 500 && jqXHR.responseText.charAt(0) == '{')) {
                    try {
                        data = JSON.parse(jqXHR.responseText);
                        if (data != null) {
                            message = data.message || data.errorDescription || "Error";
                        }
                    } catch (err) {
                        // Can't understand the json. No worries, keep going.
                    }
                }

                if (data && data.type == "FORMULA_ERROR") {
                    // If the cell couldn't be found, display the message with a popup
                    window.PlaySQL.Messages.addMessage("error", message, jqXHR.responseText);
                    return;
                }
            });
        }
        /**
         * Saves some cell's metadata, such as the formula
         * @param $cell
         * @param name name of the property
         * @param value the value, or null if the property must be deleted
         * @return true if some data was changed/saved, false otherwise
         */
        var saveCellMetadata = function($cell, name, value) {
            if (!$cell.is("td") || $cell.hasClass("right-padding")) return;
            if (!spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) return;
            var rowId = $cell.parent().attr("data-row-id"),
                column = checkNotNull(colOf($cell), $cell),
                // We make a deep copy because we don't want to modify the original metadata until it's
                // saved on the server side
                rowMetadata = $.extend(true, {}, getRowMetadata($cell)) || {},
                colName2 = "c_" + column.name;
            // If an update request was already piped, start with the rowMetadata of that request
            spreadsheet.requestPipe = spreadsheet.requestPipe || [];
            var indexPreviousRequest = undefined;
            for (var i in spreadsheet.requestPipe || []) {
                var req = spreadsheet.requestPipe[i];
                if (req.column == "POSITION" && req.rowId == rowId) {
                    rowMetadata = req.value ? $.parseJSON(req.value) : {};
                    indexPreviousRequest = i;
                    break;
                }
            }
            var property = {};
            property[name] = value;
            var properties = rowMetadata[colName2];
            if (!properties) {
                if (value == undefined) {
                    // No data to modify, there are no cellMetadata and the value is null.
                    return false;
                }
                rowMetadata[colName2] = property;
            } else {
                if (value == undefined || value == null) {
                    if (properties[name] == undefined) {
                        // No data to modify, there are cellMetadata but none for this property
                        return false;
                    }
                    delete properties[name];
                    if (Object.keys(properties).length == 0) {
                        delete rowMetadata[colName2];
                    }
                } else if (properties[name] == value) {
                    // No data to modify
                    return false;
                } else {
                    properties[name] = value;
                }
            }
            if (Object.keys(rowMetadata).length == 0) {
                rowMetadata = null;
            }

            // Now update the value in the POSITION column.
            if (indexPreviousRequest != undefined) {
                spreadsheet.requestPipe.splice(indexPreviousRequest, 1);
            }
            spreadsheet.requestPipe.push({
                spreadsheet: undefined,
                rowId : rowId,
                column : "POSITION",
                value: rowMetadata != null ? JSON.stringify(rowMetadata) : null
            });
            return true;
        }
        var saveCell = function($cell, value) {
            var rowId = $cell.parent().attr("data-row-id"),
                column = checkNotNull(colOf($cell), $cell),
                jointIdColumnName = column.formats && column.formats["joint-id"],
                data = [[value]],
                spreadsheetKey = null,
                columnName = column.name;
            if (jointIdColumnName) {
                columnName = column.formats["joint-column"] || columnName;
                var jointIdColumn = checkNotNull(colOf(jointIdColumnName), jointIdColumnName);
                spreadsheetKey = jointIdColumn.formats && jointIdColumn.formats["joint-table"];
                rowId = $cell.parent().children().eq(jointIdColumn.index).attr("data-value");
                if (rowId == null) {
                    window.PlaySQL.Messages.addMessage("error", "There is no row for the cell which is being saved.");
                    return;
                }
            }

            spreadsheet.requestPipe = spreadsheet.requestPipe || [];
            var changeRequest = {
                spreadsheet: spreadsheetKey,
                rowId: rowId,
                column: columnName,
                value: value
            };
            spreadsheet.requestPipe.push(changeRequest);
        }

        /** Processes the spreadsheet.requestPipe queue. It's in the form:
         * - spreadsheet (can be undefined)
         * - rowId
         * - column
         * - value (the value itself, no subarray)
         *
         * In return, call dispatchCellValues() or mark the cells in error.
         */
        var sprayRequestPipe = function() {
            if (spreadsheet.requestPipe == undefined) return;
            var requestPipe = spreadsheet.requestPipe,
                rows = [], // Rows' index is "spreadsheetid-rowid"
                req, row, url, rowId,
                colNames, data;
            spreadsheet.requestPipe = undefined;
            // Group by row
            for (var i = 0; i < requestPipe.length ; i++) {
                req = requestPipe[i];
                if (req == null) continue;
                // req.spreadsheet may be null or undefined
                rowId = (req.spreadsheet ? req.spreadsheet + "-" : "-") + req.rowId;
                rows[rowId] = rows[rowId] || [];
                var isColumnAlreadySet = false;
                for (var j = 0; j < rows[rowId].length ; j++)
                    if (rows[rowId][j].column == req.column) {
                        isColumnAlreadySet = true;
                        break;
                    }
                if (!isColumnAlreadySet)
                    rows[rowId].push(req);
            }

            // Submit... well, submit all rows... yeah, yeah separately, because
            // Postgres doesn't like recovering from an exception in a transaction, so we wouldn't know which
            // cells fail... that's gonna flush...
            for (var rowPk in rows) {
                if (!rows.hasOwnProperty(rowPk)) continue;
                //!\ this 'i' in the foreach loop takes the list of keys, it's very different from 0..rows.length because
                // the updates rows are not continuous.
                row = rows[rowPk];
                url = !row[0].spreadsheet ? baseUrl("/data", checkNotNull(row[0].rowId))
                                          : baseUrlForContext(row[0].spreadsheet, "/data", checkNotNull(row[0].rowId)),
                    colNames = row.map(function(cell) {return cell.column;}).join(",");
                data = row.map(function(cell) {return [cell.value];});
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(data),
                    headers: {
                        "X-COL-NAMES" : colNames
                    }
                }).done(function(data, status, request){
                    dispatchCellValues(data.data, data.tableDef, data.totals);
                }).fail(function(jqXHR, error, reason){
                    var colNames = this.headers["X-COL-NAMES"].split(",");
                    var urlParts = this.url.split("/");
                    var spreadsheetKey = urlParts[urlParts.length - 3];
                    var spreadsheetKey2 = spreadsheetKey != spreadsheet.id ? spreadsheetKey : null;
                    var rowId = urlParts[urlParts.length - 1];
                    var rowId2 = spreadsheetKey2 && (spreadsheetKey2 + "-" + rowId) || rowId;
                    var colName, cell;
                    var data;
                    var message;

                    var statusBracket = Math.floor(jqXHR.status/100) * 100;

                    if (statusBracket == 400 || (statusBracket == 500 && jqXHR.responseText.charAt(0) == '{')) {
                        try {
                            data = JSON.parse(jqXHR.responseText);
                            if (data != null) {
                                message = data.message || data.errorDescription || "Error";
                            }
                        } catch (err) {
                            // Can't understand the json. No worries, keep going.
                        }
                    }

                    for (var i = 0; i < colNames.length; i++) {
                        colName = $.trim(colNames[i]);
                        if (colName == "POSITION") {
                            // If the POSITION column was changed, it's a bit complicated.
                        } else {
                            cell = getCell(spreadsheetKey2, rowId, colName);
                            cell.renderer.markInError(message);
                        }
                    }

                    if (data && data.type == "FORMULA_ERROR") {
                        if (colName == "POSITION") {
                            var $row = findRowByPk(spreadsheetKey2, rowId),
                                $cellsWithFormula = $row && $row.find(".saving.formula"),
                                cell = $cellsWithFormula && getCell($cellsWithFormula),
                                errorList = data.errorList,
                                firstError = errorList && errorList.length > 0 && errorList[0],
                                firstErrorPosition = firstError && (firstError.line == 1) && firstError.position;
                            if (cell) {
                                cell.renderer.markInError(message);
                                cell.renderer.focus(firstErrorPosition);
                                return;
                            }
                        }
                        // If the cell couldn't be found, display the message with a popup
                        window.PlaySQL.Messages.addMessage("error", message, jqXHR.responseText);
                        return;
                    }
                });
            }
        };

        /** Shared method between saveCell, sprayRequestPipe and insert/remove rows:
         * It reads the data and the tableDef and updates them all. It's useful in order
         * to update all dependencies of a formula, whether you're inserting, deleting or
         * editing a row.
         * @param data the data - usually the data.data property of the JSON response
         * @param tableDef the table definition - usually the data.tableDef property.
         * @param totals Optional. The totals, as returned in the request, if the request contained them.
         */
        function dispatchCellValues(data, tableDef, totals) {
            for (var rowNum=0 ; rowNum < data.length ; rowNum++) {
                var id,
                    row = data[rowNum],
                    jointSpreadsheetKey = tableDef.name != spreadsheet.id ? tableDef.name : undefined,
                    rowMetadata = undefined;
                for (var i=0 ; i < tableDef.columns.length ; i++) {
                    var col = tableDef.columns[i];
                    if (col.statusPK) {
                        id = row[i][0];
                    } else if (id != undefined && col.statusPosition) {
                        rowMetadata = row[i][0];
                        try {
                            rowMetadata = $.parseJSON(rowMetadata) || {};
                        } catch (err) {
                            rowMetadata = {};
                        }
                        var $row = findRowByPk(jointSpreadsheetKey, id);
                        $row.data("row-metadata", rowMetadata);
                    } else if (id != undefined && !col.statusPosition) {
                        var cell = getCell(jointSpreadsheetKey, id, col.name),
                            cellMetadata = cell && getCellMetadata(cell.$cell);
                        if (cell == undefined) {
                            // Because of formulas and joint cells, it could happen that we get cells which aren't on the current page
                            continue;
                        } else if (!cell.$cell.hasClass("editing")) {
                            cell.renderer.setOriginalValue(row[i][0], row[i][1]);
                        }
                        cell.$cell.attr("style", PlaySQL.Helpers.buildCssStylesForCell(undefined, cellMetadata) || "");
                        if (cellMetadata && cellMetadata["formula"]) {
                            cell.$cell.addClass("formula");
                        } else {
                            cell.$cell.removeClass("formula");
                        }
                    }
                }
            }
            updateTotals(totals);
        }

        var saveColumn = function($header, column, newColumn, changes, successCallback, failureCallback) {
            function innerSuccessCallback(oldName) {
                if (changes.indexOf("RENAME") != -1 || changes.indexOf("CHLBL") != -1) {
                    // $header exists when called from the inline dialog, and doesn't when called
                    // from the "renderer-specific" sub-inline dialog, which doesn' matter because
                    // we don't modify the label there and the caller redraws the whole column
                    // anyway.
                    if ($header) {
                        var cell = checkNotNull(getCell($header));
                        cell.renderer.view();
                    }
                }
                // When renaming, if any row uses this column, then the full spreadsheet needs to be reloaded for
                // the metadata.
                if (changes.indexOf("RENAME") != -1) {
                    var rowsWithMetadata = $placeholder.find("tr[data-row-metadata]").filter(function() {
                        var metadata = $(this).data("row-metadata");
                        if (!metadata) return false;
                        if (!oldName || JSON.stringify(metadata).indexOf(oldName) == -1) return false;
                        return true;
                    });
                    if (rowsWithMetadata.length > 0) {
                        spreadsheet.load();
                    }
                }
                if (changes.indexOf("CHFMA") != -1) {
                    testSpreadsheet(column.name, function (success, value) {
                        if (success) {
                            spreadsheet.load();
                            successCallback && successCallback();
                        } else {
                            failureCallback && failureCallback(value);
                        }
                    });
                } else {
                    // in 'else' because only a CHFMA would be asynchronous
                    successCallback && successCallback();
                }
            }
            if (spreadsheet.options.saveColumn) {
                spreadsheet.options.saveColumn(spreadsheet, column, newColumn, changes,
                    innerSuccessCallback, failureCallback);
            } else {
                var after = "";
                if (changes.indexOf("MOVE") != -1) {
                    after = changes.indexOf("MOVE") != -1 ? newColumn.after : "";
                    delete newColumn.after;
                }

                var url = spreadsheet.baseUrl("/cols", checkNotNull(column.name), {
                        confirm: changes.join(","),
                        after: after
                    }),
                    data = newColumn;
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(data)
                }).done(function (data, status, request) {
                    var columnDef = window.PlaySQL.Spreadsheet.readColumnDefinition(column.index, data),
                        oldName = column.name;
                    column.name = columnDef.name;
                    column.label = columnDef.label;
                    column.type = columnDef.type;
                    column.length = columnDef.length;
                    column.formula = columnDef.formula;
                    column.renderer = columnDef.renderer;
                    column.viewRenderer = columnDef.viewRenderer;
                    column.formats = columnDef.formats;
                    column.width = columnDef.width;
                    innerSuccessCallback(oldName);
                }).fail(function (jqXHR, error, reason) {
                    try {
                        failureCallback && failureCallback(PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 200));
                        return;
                    } catch (err) {
                        // Swallow and proceed to the next section
                        AJS.log(err);
                    }
                });
            }
        }
        /** Do create the column in the back-end
         * At the time of calling, the column shouldn't be among the spreadsheet.columns.
         */
        var createColumn = function($cell, column) {
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) return;
            var url = baseUrl("/cols", checkNotNull(column.name)),
                data = {
                    name: checkNotNull(column.name),
                    type: checkNotNull(column.type),
                    label: checkNotNull(column.label),
                    renderer: checkNotNull(column.renderer),
                    viewRenderer: column.viewRenderer,
                    options: undefined
                };
            $.ajax({
                url: url,
                type: 'PUT',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data)
            }).done(function(data, status, request){
                var cell = getCell($cell),
                    col = colOf($cell);
                col.name = column.name;
                col.type = column.type;
                col.label = column.label;
                col.renderer = column.renderer;
                col.viewRenderer = column.viewRenderer;
                cell.renderer.view();
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.addMessage("error", "The column couldn't be created: " + column.label,
                    "change-col", jqXHR.responseText);
                $cell.removeClass("saving").addClass("invalid").attr("title", "The column couldn't be created");
            });
        }

        var emptyRow = function(length) {
            var result = [];
            for (var i = 0 ; i < length; i++) {
                result[i] = ["", "", ""]; // The third value is usually provided by renderCells()
            }
            return result;
        }

        function incrementColSpan($tds) {
            if ($tds == null || $tds.size() < 1) {
                return;
            }
            $tds.each(function(i, $td) {
                $td = $($td);
                var span = parseInt($td.attr('colspan')) || 1;
                $td.attr('colspan', span + 1);
            });
        }

        /** Manages adding a column in the HTML */
        var addColumnUI = function(column) {
            window.PlaySQL.Selection.forTable(column.$placeholder).unselectAll();

            // Enlarge TBODY
            column.$placeholder.find("tbody tr td:last-child").each(function() {
                var $this = $(this);
                if ($this.parent().is(".playsql-message")) {
                    incrementColSpan($this);
                } else {
                    var $td = $("<td></td>", {
                        "data-value": "",
                        "data-fe-value": "",
                        "data-rendered": ""
                    }).insertBefore($this);
                }
            });

            // Enlarge THEAD

            var $th = $("<th></th>", {
                "data-name": column.name,
                "data-type": column.type,
                "data-renderer": column.renderer,
                "data-view-renderer": column.viewRenderer,
                "data-status-pk": column.statusPK ? "true" : undefined,
                "data-status-position": column.statusPosition ? "true" : undefined,
                "text": column.label
            }).insertBefore(column.$placeholder.find("thead tr.playsql-col-headers th:last-child"));

            incrementColSpan(column.$placeholder.find("tr.pagination-row td:not(.right-padding)"));
            incrementColSpan(column.$placeholder.find("tr.playsql-message td:not(.right-padding)"));

            // Enlarge TBOTTOM
            incrementColSpan(column.$placeholder.find("tfoot tr td:not(:last-child)").last());

            return $th;
        }

        // Add a column on the front-end
        var addColumn = function($this, e) {
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) return;

            var column = {
                name: "",
                label: "New column",
                type: "TEXT",
                renderer: "link",
                viewRenderer: undefined,
                formats: {},
                width: null,
                $placeholder: $placeholder,
                index: spreadsheet.columns.length,
                copy: spreadsheet.columns[1].copy
            };

            var $th = addColumnUI(column);

            spreadsheet.columns.push(column);

            // Move the header to 'edit'
            var cell = getCell($th).renderer;
            cell.edit();
            cell.focus();

            saveTotals();

            e.preventDefault();
            return false;
        }

        var deleteColumn = function($cell) {
            if (!spreadsheet.perms.hasPerm('REMOVE_COLS')) return;
            window.PlaySQL.Selection.forTable($placeholder).unselectAll();
            var column = colOf($cell);

            // The column name could be empty if the user was still creating the column
            // and pressed Esc. Otherwise we ask him to confirm.
            if (column.name != "" && !confirm(("You are about to delete the column '$1' (label: $2). The operation cannot be cancelled " +
                "and the contents of the cells will be lost. Are you sure?")
                    .replace("$1", column.name).replace("$2", column.label))) {
                return false;
            }

            spreadsheet.columns.splice(column.index, 1);
            // Reindex the columns
            for (var index = 0 ; index < spreadsheet.columns.length ; index++) {
                spreadsheet.columns[index].index = index;
            }

            checkNotNull($placeholder.find("thead > tr.playsql-col-headers > *").eq(column.index)).remove();
            $placeholder.find("tbody td:nth-child(" + (column.index+1) + ")").remove();
            removeTotalAtColumn(spreadsheet.totals, column.index - 1);

            // We don't need to remove it server-side if we were just editing the column
            if (column.name) {
                var url = baseUrl("/cols", checkNotNull(column.name)),
                    data = {
                        name: checkNotNull(column.name),
                        type: checkNotNull(column.type),
                        label: checkNotNull(column.label),
                        options: undefined
                    };
                $.ajax({
                    url: url + "?" + $.param({ confirm: 'DELETE' }),
                    type: 'DELETE',
                    contentType: "application/json; charset=utf-8"
                }).done(function (data, status, request) {
                    // Do nothing, show nothing.
                    saveTotals();
                }).fail(function (jqXHR, error, reason) {
                    window.PlaySQL.Messages.addMessage("error", "The column couldn't be deleted: " + column.label,
                        "change-col", jqXHR.responseText);
                });
            } else {
                saveTotals();
            }

            return false;
        }

        /**
         * Move a column. If shift < 0, move to the left. If > 0, move to the right. If 0, noops.
         * @param $header
         * @param shift
         */
        var moveColumn = function(column, shift, successCallback, failureCallback) {
            var newColumn = column.copy();
            var theoreticalIndex;

            if (shift < 0) {
                theoreticalIndex = column.index - 1 + shift;
                if (theoreticalIndex < 0) theoreticalIndex = 0;
            } else if (shift > 0) {
                theoreticalIndex = column.index + shift;
                if (theoreticalIndex >= spreadsheet.columns.length) theoreticalIndex = spreadsheet.columns.length - 1;
            } else {
                throw "Invalid shift: " + shift;
            }

            if (theoreticalIndex == 0) {
                // We have to hard-code it because the column 'POSITION' is stripped
                // at display time
                newColumn.after = "POSITION";
            } else {
                newColumn.after = spreadsheet.columns[theoreticalIndex].name;
            }

            // We can afford not passing $header, because we're not using it in saveColumn
            // in this situation.
            saveColumn(undefined, column, newColumn, ["MOVE"], function(){
                successCallback && successCallback();
            }, function(message){
                failureCallback && failureCallback(message);
            });
        }

        /**
         * Remove the total for the right column
         * @param totals the totals array (the model)
         * @param columnIndex the column index, starting at 0 = the first column / the 0 index in totals (Column ID = -1)
         */
        var removeTotalAtColumn = function(totals, columnIndex) {
            if (!totals || totals.length == 0) return;
            var position = 0;
            $placeholder.find("tfoot > tr > *:not(:first-child):not(.right-padding)").each(function(index){
                var $th = $(this),
                    span = parseInt($th.attr("colspan")) || 1,
                    totalDef = totals[index];
                if (columnIndex >= position && columnIndex < position + span) {
                    // That's where we remove something
                    if (span >= 3) {
                        $th.attr("colspan", --span);
                        totalDef.colspan = span;
                        return false;
                    } else if (span == 2) {
                        $th.removeAttr("colspan");
                        totalDef.colspan = 1;
                        return false;
                    } else {
                        $th.remove();
                        totals.splice(index, 1);
                        return false;
                    }
                } else {
                    position += span;
                }
            });
        }

        /*var startRenameColumn = function($header) {
         var renderer = getCell($header).renderer;
         renderer.edit();
         renderer.focus();
         }*/

        var renderAllColumn = function(column) {
            var renderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer];
            $placeholder.find("tbody > tr > td:nth-child(" + (1+column.index) + ")").each(function(){
                var $cell = $(this),
                    beValue = $cell.attr('data-value'),
                    feValue = $cell.attr('data-fe-value');

                if (!$cell.hasClass("editing saving")) {
                    $cell.text(feValue);
                }
            });
        }

        var sortCol = function($header, way, nulls) {
            // Parse spreadsheet's order by clause
            var clause = window.PlaySQL.Helpers.parseOrderByClause(spreadsheet.orderbyClause),
                col = checkNotNull(colOf($header)),
                colname = '"' + col.name + '"',
                perform = true;
            way = way || 'REVERSE';
            for (var i = 0 ; i < clause.length ; i++) {
                if (clause[i].field.indexOf(colname) == 0) {
                    if (i == 0) {
                        if (way == clause[i].way && nulls == clause[i].nulls) return;
                        if (way == 'REVERSE') {
                            way = clause[i].way.toUpperCase() == 'ASC' ? 'DESC' : 'ASC';
                        } else if (way == 'NO-SORTING') {
                            clause.splice(i, 1);
                            perform = false;
                            break;
                        }
                        clause[i].way = way;
                        clause[i].nulls = nulls;
                        perform = false;
                        break;
                    } else {
                        // Delete and make it the primary sorting
                        clause.splice(i, 1);
                        break;
                    }
                }
            }
            if (perform && way != 'NO-SORTING') {
                if (way == 'REVERSE') way = 'ASC';
                var cast = col.type == 'VARCHAR' || col.type == 'TEXT' ? '::text'
                    : col.type == 'INTEGER' || col.type == 'BIG_INTEGER' || col.type == 'BOOLEAN' || col.type == 'DATE' || col.type == 'TIME' || col.type == 'NUMERIC' || col.type == 'DOUBLE' ? '::' + col.type
                    : '';
                clause.unshift({
                    field: colname, // + cast,
                    way: way,
                    nulls: nulls
                });
            }
            var clauseString = window.PlaySQL.Helpers.buildOrderByClause(clause);
            spreadsheet.orderbyClause = clauseString;
            AJS.log("ORDER BY " + clauseString);
            spreadsheet.load();
        };
        var pasteImage = function(clipboardDataItem){
            var $placeholder = this.$placeholder,
            $focused = $placeholder.find(".focused");
            var cell;
            cell = getCell($focused);
            if (cell.renderer.parent.key != "image") {
                // If it's not an image renderer, tell to paste as text. Example: the filename is pasted.
                return false;
            }

            var blob = clipboardDataItem.getAsFile();
            var reader = new FileReader();
            isFile = true;
            event.preventDefault();
            event.stopPropagation();
            reader.onload = function(event){
                cell.renderer.edit(reader.result);
            };
            reader.readAsDataURL(blob);
            reader.onerror = function(){
                AJS.flag({
                    type: 'error',
                    title: "Error while pasting the image"
                })
            };

            return true;
        };
        var pasteHandler = function($contenteditable) {
            // Make a big array of the values: { rows -> { cells -> [ value, formula ] } }
            var allValues = [],
                $placeholder = this.$placeholder,
                $focused = $placeholder.find(".focused"),
                $selected = $placeholder.find(".selected"),
                isPlaySQLPasteSource = $contenteditable.find("table > thead").length != 0,
                columnHeaders = [];
            if (isPlaySQLPasteSource) {
                columnHeaders = $contenteditable.find("table > thead th").map(function(i, el){return $(el).text();});
                // Remove the columns which contain a th, i.e. the ID column
                $contenteditable.find("table > tbody > tr:first > th").each(function(index, th){
                    columnHeaders.splice($(th).index(), 1);
                });
                // Chop the head off, keep the body, Vive la Revolution!
                $contenteditable.find("table > thead, table > tbody > tr > th").remove();
            }
            var $row, $cell, cell;
            $contenteditable.find("table tr").each(function(){
                var $tr = $(this),
                    $cells = $tr.find("th, td"),
                    row = [];
                $cells.each(function(){
                    var $cell = $(this),
                        value = $cell.attr("data-value"),
                        formula = $cell.attr("data-cell-metadata-formula");
                    if (typeof value == 'undefined') {
                        value = $cell.text();
                    }
                    row.push([value, formula]);
                });
                allValues.push(row);
            });
            if (allValues.length == 0) {
                // Did the person start typing?
                if ($.trim($contenteditable.html()).length > 0 && $contenteditable.html() != "&#x200B;" && $contenteditable.html() != "\u200B") {
                    var walker = document.createTreeWalker($contenteditable[0], NodeFilter.SHOW_ALL, null, false),
                        text = "",
                        blockNodes = ['DIV', 'BR', 'P', 'LI', 'DL', 'DD', 'DT', 'FORM', 'PRE', 'TR'];
                    while (node = walker.nextNode()) {
                        if (blockNodes.indexOf(node.nodeName) != -1) {
                            text += "\n";
                        } else if (node.nodeType == Node.TEXT_NODE) {
                            text += node.nodeValue;
                        }
                    }
                    var rows = $.trim(text).split(/\r?\n\r?/);
                    for (var i=0 ; i < rows.length ; i++) {
                        // The map() function returns the [value, formula] pair
                        allValues.push(rows[i].split(/\t/)
                            .map(function(e){return [e, undefined]}));
                    }

                    if (catchTextShortcuts(allValues)) {
                        $contenteditable.empty();
                        return;
                    }
                } else {
                    return;
                }
            }
            // Don't let foreign content in the table...
            $contenteditable.empty();
            if ($focused.is("tbody th")) {
                $focused = $focused.next(":not(.right-padding)");
            } else if ($focused.is("thead th")) {
                alert("You are attempting to paste into a full column. The contents will only be pasted into the visible rows.");
            }
            if ($focused.length == 0)
                return;
            var pasteAtOrigin = $selected.size() == 1;
            var pasteWithRepeat = allValues.length == 1;
            var pasteWithinSelection = $selected.size() > 1;
            if (pasteWithinSelection) {
                // If the user selects right-to-left, it leaves the last column as focused and originCol and originRow
                // are false. This command moves the focused cell to the top-left of the selection.
                $focused.removeClass("focused");
                $focused = $selected.first().addClass("focused");
            }
            var originCol = $focused.index();
            var originRow = $focused.closest("tr").index();
            var maxRows = $placeholder.find("> table > tbody tr").length - originRow;
            var missingRows = Math.max(0, allValues.length - maxRows);
            var spreadsheetWidth = spreadsheet.columns.length;
            var maxCols = spreadsheetWidth - originCol;
            var missingCols = allValues[0].length - maxCols;
            spreadsheet.disableFocusManagement = true;

            if (missingRows > 0) {
                this.addRows(missingRows);
            }
            var column;
            if (missingCols > 0) {
                var createMoreCols = spreadsheet.perms.hasPerm('ADD_COLS') &&
                    confirm("The data you're attempting to paste is wider than the number of columns. Do you want Play SQL to kindly create columns for you?");
                if (createMoreCols) {
                    var columnsToCreate = [],
                        columnNamesToCreate = [];
                    for (var i = spreadsheetWidth; i < spreadsheetWidth + missingCols; i++) {
                        column = {
                            name: spreadsheet.defaultCase == 'LOWER' ? "newcolumn" : "NEWCOLUMN",
                            label: "New column",
                            type: "TEXT",
                            length: undefined,
                            renderer: "link",
                            viewRenderer: undefined,
                            formats: {},
                            width: undefined,
                            $placeholder: $placeholder,
                            index: spreadsheet.columns.length
                        };
                        if (columnHeaders[i - originCol]) {
                            column.label = columnHeaders[i - originCol];
                            column.name = window.PlaySQL.Helpers.generateKey(column.label, spreadsheet.defaultCase);
                        }
                        column.name = getUniqueColumnName(spreadsheet.columns, column.name);
                        //column.name = getUniqueColumnName(columnsToCreate, column.name);

                        addColumnUI(column);
                        spreadsheet.columns.push(column);
                        columnsToCreate.push({
                            name: checkNotNull(column.name),
                            type: checkNotNull(column.type),
                            label: checkNotNull(column.label),
                            renderer: checkNotNull(column.renderer),
                            viewRenderer: undefined,
                            options: undefined
                        });
                        columnNamesToCreate.push(column.name);
                        maxCols++;
                    }

                    var url = baseUrl("/cols");
                    $.ajax({
                        url: url,
                        type: 'POST',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(columnsToCreate)
                    }).done(function(data, status, request){
                        var columns = data.columns;
                        for (var i=0 ; i < columns.length ; i++) {
                            var column = columns[i];
                            if (columnNamesToCreate.indexOf(column.name) == -1) {
                                continue;
                            }
                            var col = colOf(column.name),
                                cell = getCell($cell);
                            col.name = column.name;
                            col.type = column.type;
                            col.label = column.label;
                            col.renderer = column.renderer;
                            col.viewRenderer = column.viewRenderer;
                            cell.renderer.view();
                        }
                    }).fail(function(jqXHR, error, reason){
                        window.PlaySQL.Messages.addMessage("error", "The column couldn't be created: " + column.label,
                            "change-col", jqXHR.responseText);
                        $cell.addClass("invalid").attr("title", "The column couldn't be created");
                    });
                }
            }

            function paste(cell, value) {
                var formula = value[1],
                    value = value[0];
                if (cell) {
                    if (formula) {
                        spreadsheet.saveCellMetadata($cell, "formula", formula);
                    } else {
                        cell.renderer.edit(value);
                    }
                    cell.$cell.addClass("selected");
                }
            }
            // Get going, paste values in cells
            if (pasteWithRepeat) {
                $selected.closest("tr").each(function(){
                    var $row = $(this);
                    for (var col = 0 ; col < allValues[0].length ; col++) {
                        if (col >= maxCols) break;
                        $cell = $row.find("th, td").eq(col + originCol);
                        if (pasteWithinSelection && !$cell.hasClass("selected")) continue;
                        cell = getCell($cell);
                        paste(cell, allValues[0][col]);
                    }
                });
            } else if (pasteAtOrigin || pasteWithinSelection) {
                for (var row=0 ; row < allValues.length ; row++) {
                    $row = $placeholder.find("> table.playsql > tbody tr").eq(row + originRow);
                    for (var col = 0 ; col < allValues[row].length ; col++) {
                        if (col >= maxCols) break;
                        $cell = $row.find("th, td").eq(col + originCol);
                        if (pasteWithinSelection && !$cell.hasClass("selected")) continue;
                        cell = getCell($cell);
                        paste(cell, allValues[row][col]);
                    }
                }
            }

            window.PlaySQL.Selection.forTable($placeholder).unselectAll();
            spreadsheet.disableFocusManagement = false;
            cell = cell || getCell($focused);
            if (cell) {
                cell.$cell.addClass("selected focused");
                var muteDropdown = $placeholder.find(".editing").size() > 1;
                cell.renderer.focus(true, undefined, muteDropdown);
            }
            spreadsheet.sprayRequestPipe();
        }

        function bindMenuForTotals() {
            var totalsMenu = PlaySQL.Popup.createMenu("totals-menu", spreadsheet.$placeholder, {
                onMenuOpen: function($trigger) {
                    totalsMenu.removeAll();
                    totalsMenu.addItem('<a href="#">Edit</a>', function($li) {
                        window.setTimeout(function() {
                            $(".totals-row .totals-calculation").attr('data-aui-trigger', '');
                            $(".totals-row .totals-calculation").attr('aria-controls', "inline-dialog-formula-help");
                            $("#inline-dialog-formula-help").attr('open', true);
                        }, 0)
                        PlaySQL.Totals.editTotal(spreadsheet.totals, $trigger);
                    });
                    if (spreadsheet.totals.length > 0) {
                        if (parseInt($trigger.attr('colspan') || "1") >= 2) {
                            totalsMenu.addItem('<a href="#">Split cell (on the left)</a>', function($li) {
                                PlaySQL.Totals.addTotal(spreadsheet.totals, $trigger, -1);
                            });
                            if (parseInt($trigger.attr('colspan') || "1") >= 3) {
                                totalsMenu.addItem('<a href="#">Split cell (on the right)</a>', function($li) {
                                    PlaySQL.Totals.addTotal(spreadsheet.totals, $trigger, 1);
                                });
                            }
                        }
                        totalsMenu.addItem('<a href="#">Remove this total</a>', function($li) {
                            PlaySQL.Totals.removeTotal(spreadsheet.totals, $trigger, saveTotals);
                        });
                    }
                }
            }).attach("clickable", ".totals-row td:not(.right-padding):not(.editing)", null);
        }

        function catchTextShortcuts(allValues) {
            // It used to be that we'd catch '=' and display the column's formula editor. Not anymore:
            // now we have cell-local formulas and they're managed seamlessly by the cell renderer.
            // var text = allValues.toString()
            /*if (text == "=") {
                var $cell = $placeholder.find(".focused").first(),
                    cell = getCell($cell);
                if ($cell.index() > 0 && cell != undefined) {
                    cell.renderer.editFormula();
                    return true;
                }
            }*/
            return false;
        }

        /** Fetches 1 row of the spreadsheet, to check whether there's an error
         * @param colname the name of the column for which we want to return the sample value
         */
        var testSpreadsheet = function(colname, callback) {
            var url = baseUrl("/data", {
                limit: 1
            });

            $.ajax({
                url: url,
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                timeout: 180000,
                cache: false
            }).done(function(data, status, request){
                var colNames = request.getResponseHeader("X-COL-NAMES").split(","),
                    tableDef = data.tableDef,
                    colIndex, message;
                for (var i=0 ; i < tableDef.columns.length ; i++)
                    if (tableDef.columns[i].name == colname) {
                        colIndex = i;
                        break;
                    }
                if (colIndex == undefined) {
                    return callback(false, "Column " + colname + " doesn't exist");
                }
                var column = PlaySQL.Helpers.readColumnDefinition(colIndex, tableDef.columns[i], undefined),
                    value = data.data.length > 0 ? data.data[0][colIndex][0] : undefined;

                message = data.errorMessage;
                if (data.errorMessage) {
                    message = message.replace("Error with a calculated column:", "");
                    message = message.replace("ERROR: ", "");
                    message = message.replace(/: syntax error at or near ""[a-zA-Z0-9]+""/, "");
                    message = message.replace(/ Position: [\d]+/, "");
                    return callback(false, message);
                } else {
                    return callback(true, value);
                }
            }).fail(function(jqXHR, error, reason) {
                var message = "The test of the spreadsheet was unsuccessful: " + jqXHR.responseText;
                callback(false, message);
            });
        }

        function displayCellProperties(e) {
            window.PlaySQL.Spreadsheet.CellProperties.display(spreadsheet, $(".selected"));
        }

        function removeCellContents(e) {
            var $cells = $placeholder.find("td.selected:not(.right-padding)");
            if ($cells.size() == 0 || $cells.filter(".editing").size() > 0) return;
            // We don't want to let the browser go to the previous page (because of the Backspace key) if a
            // cell is selected
            e.preventDefault();

            if (spreadsheet.perms.hasPerm("EDIT_CELLS") || spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) {
                if ($cells.size() > 1) {
                    if (!confirm("Do you want to delete the contents of " + $cells.size() + " cells?")) return;
                }
                $cells.each(function () {
                    var $cell = $(this);
                    if ($cell.hasClass("joint-id-renderer")) {
                        if ($cell.find(".joint-id-remove").size() > 0) {
                            if (!confirm("This cell is a foreign key to a joint table. Do you want to delete the full row of the joint table?")) return;
                            spreadsheet.removeJointRow($cell);
                        }
                    } else if (spreadsheet.perms.hasPerm("EDIT_CELLS") || spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) {
                        spreadsheet.saveCell($cell, null);
                        if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                            spreadsheet.saveCellMetadata($cell, "formula", null);
                        }
                    }
                });
                spreadsheet.sprayRequestPipe();
            }
        }

        function getUniqueColumnName(columns, name) {
            for (var i = 0 ; i < columns.length ; i++) {
                var suggestedName = name + (i != 0 ? i : ""),
                    found = false;
                for (var j=0 ; j < columns.length ; j++) {
                    if (columns[j].name == suggestedName) {
                        found = true;
                        break;
                    }
                }
                if (!found) return suggestedName;
            }
            return "";
        }

        /** Reset the properties of the spreadsheet, as if never been touched by a user on this page */
        function reset() {
            // Reset the Order By and the Filters
            spreadsheet.orderbyClause = $placeholder.attr('data-macro-orderby-clause');
            spreadsheet.whereClauseColumnFilters = undefined;
            // Reset the User Parameters
            spreadsheet.userParameters = undefined;
        }

        // Append all methods to 'this' and return it
        var result = $.extend(spreadsheet, {
            load: load,
            reset: reset,
            // Finding elements
            colOf: colOf,
            getRecordIds: getRecordIds,
            getCell: getCell,
            getCellMetadata : getCellMetadata,
            getRowMetadata : getRowMetadata,
            findRowByPosition: findRowByPosition,
            findRowByPk: findRowByPk,
            $findColumnCells : $findColumnCells,
            // Actions on elements
            addRow: addRow,
            addRows: addRows,
            deleteRow: deleteRow,
            deleteRows: deleteRows,
            addJointRow: addJointRow,
            removeJointRow: removeJointRow,
            sprayRequestPipe: sprayRequestPipe,
            saveCell: saveCell,
            saveCellMetadata: saveCellMetadata,
            recalculateFormulas: recalculateFormulas,
            dispatchCellValues: dispatchCellValues,
            updateColumnWidth: updateColumnWidth,
            //renameColumn: renameColumn,
            saveColumn: saveColumn,
            createColumn: createColumn,
            deleteColumn: deleteColumn,
            moveColumn: moveColumn,
            renderAllColumn : renderAllColumn,
            sortCol: sortCol,
            pasteHandler: pasteHandler,
            pasteImage: pasteImage,
            // Helpers
            emptyRow: emptyRow,
            baseUrl: baseUrl,
            bindMenuForTotals: bindMenuForTotals
        });
        window.PlaySQL.Spreadsheet.spreadsheets[spreadsheet.id] = result;
        window.PlaySQL.spreadsheet = result;
        return result;
    } // End of byPlaceholder()

    function registerRenderer(renderer) {
        window.PlaySQL.Spreadsheet.renderers[renderer.key] = renderer;
    }

    // Event can be launched several times, but must be launched after playsql-spreadsheet-init.
    AJS.bind("playsql-load-spreadsheets", function() {
        var anchor = window.location.hash,
            recordId;
        if (anchor && anchor.indexOf("#")==0) {
            recordId = parseInt(anchor.substring(1));
            if (isNaN(recordId)) {
                recordId = undefined;
            }
        }

        $(".playsql-spreadsheet-placeholder").each(function(){
            try {
                var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($(this));
                spreadsheet.selectedRecord = recordId;
                spreadsheet.load();
            } catch (err) {
                AJS.log("Error while loading spreadsheet: ", err);
            }
        });
    });

    window.PlaySQL = window.PlaySQL || {};
    var PlaySQL = window.PlaySQL;
    window.PlaySQL.Spreadsheet = window.PlaySQL.Spreadsheet || {
        byId: byId,
        byPlaceholder: byPlaceholder,
        spreadsheets: {},
        renderers: {},
        readColumnDefinition: PlaySQL.Helpers.readColumnDefinition
    };

    $(function () {

        if (!window.PlaySQL.Spreadsheet.initialized) {
            AJS.trigger("playsql-spreadsheet-init", { register: registerRenderer });
            window.PlaySQL.Spreadsheet.initialized = true;
            window.PlaySQL.Selection.setupCopyHandler({
                pasteHandler: function($contenteditableDiv) {
                    // 'this' refers to the ss
                    return this.pasteHandler($contenteditableDiv);
                },
                pasteImage: function() {
                    return this.pasteImage.apply(this, arguments);
                }
            });
        }

        // Load spreadsheets by default, except if we're in the Query Editor
        if ($("body.query-editor-mode").size() === 0) {
            if (PlaySQL.setJwtHeaderForAjax) {
                PlaySQL.setJwtHeaderForAjax(() => {
                    AJS.trigger("playsql-load-spreadsheets");
                });
            } else {
                AJS.trigger("playsql-load-spreadsheets");
            }
        }
    });

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderer-base.js' */
(function($){
    /**
     * The API boundary is:
     * - The TD/TH belongs to spreadsheet-macro.js,
     * - The renderer is free with the innerHTML,
     * - The CSS class of the td/th is part of the API. The spreadsheet communicates with the renderers
     * through the methods of RendererBase; the renderers communicate with the spreadsheet using
     * the object passed in forCell(spreadsheet, $cell).
     *
     * Cells have a state cycle represented by the CSS classes:
     * - (none): The cell is in view mode.
     * - editing: The cell contains an HTML input or any kind of data-entry element.
     * cleaned by forCell().edit() as the last resort.
     * - saving: The cell is being saved. We're waiting for server feedback and we don't
     * know yet whether it is saved. Once we receive it we'll immediately switch to
     * view or invalid mode.
     * - invalid: The value in the cell is invalid. It can't be saved.
     *
     * Other css classes:
     * - selected, focused
     * - formula: The cell contains a formula / the formula editor. The 'formula' class
     * is supposed to be there as soon as we know it's a formula (=when we write the TD)
     * or when we detect it's a formula (=when the user types '=').
     * - anti-formula: The cell starts with a '=' but is not a formula. This class is set
     * at the same time as 'formula' (when we build the TD or when the user clicks 'remove
     * formula') and will be removed if the user removes the '='.
     */
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        var RendererBase = function() {
            return {
                key : "base-renderer",
                getI18nName : function() {
                    // Default implementation, please override...
                    return this.key;
                },
                isSystemRenderer : function() {
                    return true;
                },
                isSupportedType : function() {
                    throw "Not Implemented";
                },
                getDefaultType : function() {
                    throw "Not Implemented";
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value === null || value === undefined) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    value = AJS.escapeHtml(value);
                    if (column.formats.css) {
                        var styles = $.parseJSON(column.formats.css),
                            styleAttr = "";
                        for (var key in styles) {
                            if (!styles.hasOwnProperty(key)) continue;
                            styleAttr += key + ":" + styles[key] + ";";
                        }
                        value = outerHtml($("<span>", {
                            style: styleAttr,
                            html: value
                        })).replace(/\n/g, "<br>\n");
                    }

                    return value;
                },
                /**
                 * Same as renderCellContents, but when the contents needs to be hyperlinked to
                 * the target table. Actually you can preferably call renderCellContentsWithFK(), it
                 * will delegate safely to renderCellContents if there's no fk.
                 * @param value the value for the viewRenderer (=this)
                 * @param backEndValue the value for the editRenderer (FKRenderer)
                 * @param href the link to the target table/record
                 */
                renderCellContentsWithFK: function(value, spreadsheet, column, backEndValue, forForm) {
                    var renderedContents = this.renderCellContents(value, spreadsheet, column, forForm);
                    if (column.fk && column.fk.withUI) {
                        var fkRenderer = checkNotNull(window.PlaySQL.Spreadsheet.renderers[column.renderer]);
                        var href = fkRenderer.buildLink(spreadsheet, column, backEndValue);
                        renderedContents = "<a href=\"" + AJS.escapeHtml(href) + "\">" + renderedContents + "</a>";
                    }
                    return renderedContents;
                },
                onColumnDisplay : function(spreadsheet, column) {
                    // This method is triggered whenever the table is done displaying.
                    // Place additional code about cell rendering: binding handlers,
                    // displaying pictures or mapping external data.
                },
                createInputBox: function(value) {
                    return $("<input>", {
                        type: 'text',
                        value: value,
                        "autocomplete": "off" // against MSEdge
                    });
                },
                /** This is only a helper method you can use to override createInputBox */
                createTextareaBox: function(value) {

                    function resizeTextarea() {
                        var $this = $(this);
                        if (this.clientHeight != this.scrollHeight) {
                            $this.height(this.scrollHeight);
                        }
                    }

                    window.setTimeout(function(){
                        $(".playsql textarea.uninitialized, .playsql-form-macro textarea.uninitialized").each(function(){
                            $(this).removeClass("uninitialized");
                            resizeTextarea.apply(this);
                        });
                    }, 0);

                    return $("<textarea>", {
                        text: value,
                        height: 1,
                        "class": "uninitialized"
                    }).on("keyup.playsqlresizetextarea keydown.playsqlresizetextarea change.playsqlresizetextarea", resizeTextarea);
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    if (term.length > 0) {
                        window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterString(column, term, data);
                    }
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },


                /**
                 * Prepares the cell for edition
                 * @param spreadsheet
                 * @param $cell
                 * @param setValueByRef an array of the value to set. If provided, it will return "formula" if it
                 * starts with "=" and "ok" otherwise. It means it will override the status of the cell being a formula.
                 * @return the status:
                 *  - "ok" if it can be edited,
                 *  - "set" if the cell is already being edited and only the value must be set
                 *  - "formula" if it must be edited as a formula,
                 *  - "no" if it can't be edited
                 */
                checkBeforeEdit : function(spreadsheet, $cell, setValueByRef) {
                    if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) {
                        return "no";
                    }
                    if (setValueByRef[0]) {
                        if (setValueByRef[0].charAt(0) == "=" && !$cell.hasClass("anti-formula")) {
                            if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                return "formula";
                            } else {
                                $cell.addClass("anti-formula");
                            }
                        }
                    } else {
                        if ($cell.hasClass("formula")) {
                            if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                setValueByRef[0] = spreadsheet.getCellMetadata($cell, "formula");
                                return "formula";
                            } else {
                                $cell.addClass("anti-formula").removeClass("formula");
                            }
                        }
                    }
                    if ($cell.hasClass("editing") || $cell.hasClass("saving")) {
                        return "set";
                    }
                    if (setValueByRef[0] == "'") {
                        $cell.addClass("anti-formula");
                        setValueByRef[0] = "";
                    }
                    $cell.removeClass("formula");
                    // Check if it's a joint table
                    var recordIds = spreadsheet.getRecordIds($cell, true);
                    if (recordIds.jointIdName && !recordIds.jointId) {
                        spreadsheet.addJointRow(recordIds.jointIdCell.$cell);
                    }

                    return "ok";
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = this,
                        operations = {
                            parent : parent,
                            /**
                             * Switch the cell to edit mode
                             * @param setValue optional. Sets the value. If so, it will re-evaluate whether it's a formula. It means
                             * if you pass a value which doesn't start with '=', it will set this value, replacing the formula.
                             */
                            edit: function(setValue) {
                                var setValueByRef = [setValue],
                                    situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                                // If the value was changed, use it
                                setValue = setValueByRef[0];

                                switch (situation) {
                                    case "no": return;
                                    case "formula":
                                        /* TODO Formulas activation/deactivation here */
                                        window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                        return;
                                    case "ok": break;
                                    case "set": break;
                                        setValue = this.parseValue(setValue);
                                        if (setValue != undefined) {
                                            $cell.find("input, textarea").val(setValue);
                                            $cell.find("div[contenteditable]").text(setValue);
                                        }
                                        return;
                                    default:
                                        throw "Not Implemented: situation " + situation;
                                }

                                setValue = this.parseValue(setValue);
                                if (setValue == undefined) {
                                    setValue = $cell.attr('data-value');
                                }
                                feValue = $cell.attr("data-fe-value");

                                $cell.addClass("editing");
                                // Keep the old value for cancel
                                $cell.attr('data-rendered', $cell.html());
                                var $input = this.createInputBox(setValue, feValue);

                                $input.appendTo($cell.empty());

                                var rendererInstance = this;
                                $input.on("keyup.playsql-autocommit", function(){
                                    rendererInstance.validate(true);
                                }).on("blur.playsql-autocommit", function(){
                                    var $this = $(this),
                                        $cell = $this.closest("td");
                                    if ($this.hasClass("no-blur-while-clicking-autocomplete")) {
                                        $this.removeClass("no-blur-while-clicking-autocomplete");
                                        return;
                                    }
                                    if (!$cell.hasClass("aui-dropdown2-trigger") && !$cell.hasClass("no-autocommit")) {
                                        window.setTimeout(function() {
                                            rendererInstance.saveAndView();
                                            spreadsheet.sprayRequestPipe();
                                        }, 0);
                                    }
                                });
                            },
                            createInputBox : function(beValue, feValue) {
                                return parent.createInputBox(beValue, feValue);
                            },
                            parseValue : function(value) {
                                if (value == undefined) return value;
                                return $.trim(value);
                            },
                            /**
                             * Sets the focus on whatever HTML widget is central to this cell.
                             *
                             * No effect if the cell isn't in 'editing'.
                             *
                             * Beware to call this method on a 'click', not on a 'mousedown',
                             * because the 'click' event after a 'mousedown' resets the focus to the
                             * clicked element.
                             *
                             * @param muteDropdown Default false / undefined. Set to 'true' if you explicitly don't want
                             *                     any dropdown to show, for example if it's a foreign key and you've
                             *                     just pasted some content.
                             */
                            focus: function(withCaret, selEnd, muteDropdown) {
                                if ($cell.hasClass("editing") && !spreadsheet.disableFocusManagement) {
                                    var $input = checkNotNull($cell.find("input, textarea, div[contenteditable]")).focus();
                                    if (withCaret == undefined)
                                        $input.select();
                                    else if (withCaret == true) {
                                        var el = $input[0],
                                            value = el.value || el.textContent;
                                        el.selectionStart = el.selectionEnd = value.length;
                                    } else if (typeof withCaret == "number") {
                                        var el = $input[0],
                                            value = el.value || el.textContent;
                                        el.selectionStart = withCaret;
                                        el.selectionEnd = selEnd != undefined ? selEnd : value.length;
                                    }
                                }
                            },
                            /** Returns from any state to view, by rendering the value which was provided by the server side */
                            view: function(feValue, beValue, forForm) {
                                // Allow for the value being null
                                if (feValue === undefined) {
                                    beValue = $cell.attr("data-value");
                                    feValue = $cell.attr("data-fe-value");
                                }
                                var viewRenderer = spreadsheet.getCell($cell).viewRenderer;
                                var rendered = (viewRenderer || this).parent.renderCellContentsWithFK(feValue, spreadsheet, spreadsheet.colOf($cell), beValue, forForm);
                                $cell.html(rendered);
                                $cell.removeClass("editing saving invalid");
                                $cell.tipsy("disable");
                                $(".tipsy").remove();
                            },
                            getValue: function() {
                                return $cell.attr("data-value");
                            },
                            setOriginalValue: function(formulaValue, backendValue, forForm) {
                                this.view(formulaValue, backendValue, forForm);
                                $cell.attr("data-value", backendValue);
                                $cell.attr("data-fe-value", formulaValue);
                            },
                            validate: function(transformIfFormula) {
                                if ($cell.hasClass("formula")) {
                                    return window.PlaySQL.Spreadsheet.FormulaEditor.validate(spreadsheet, $cell, this);
                                }
                                var column = spreadsheet.colOf($cell),
                                    length = column.length,
                                    type = column.type,
                                    cellVal = operations.getInputBoxValue(),
                                    valid = true,
                                    message = "";
                                if (cellVal && cellVal.length > 0) {
                                    if (cellVal.charAt(0) != "=") {
                                        // Not relevant anymore
                                        $cell.removeClass("anti-formula");
                                    } else {
                                        // The cell starts with '='
                                        if (transformIfFormula === true
                                            && !$cell.hasClass("anti-formula")
                                            && spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                            /* TODO Formula activation/deactivation here */
                                            window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, cellVal);
                                            this.focus(true);
                                            return true;
                                        }
                                    }
                                } else {
                                    $cell.removeClass("anti-formula");
                                }
                                if (length) {
                                    if (cellVal != undefined && cellVal.length > length) {
                                        valid = false;
                                        message = "The maximum size is " + length;
                                    }
                                }
                                if (cellVal !== null && (type == "INTEGER" || type == "BIG_INTEGER")) {
                                    valid = valid && /^[ +-]?\d* *$/.test(cellVal);
                                    message = "An integer is expected";
                                }
                                if (valid) {
                                    $cell.removeClass("invalid").removeAttr("title");
                                    $cell.tipsy("disable");
                                    $cell.tipsy("hide");
                                } else {
                                    $cell.addClass("invalid").attr("title", message);
                                    $cell.tipsy({delayIn: 0});
                                    $cell.tipsy("enable");
                                    $cell.tipsy("show");
                                }
                                return valid;
                            },
                            /**
                             * Renders the cell with a temporary placeholder representing the value entered
                             * by the user. Then call spreadsheet.saveCell($cell, val) to actually save
                             * the cell. saveCell() is in charge of calling .view() with the server-side
                             * value.
                             *
                             * It's rendered with the editRenderer, because we haven't brought the value
                             * back for the viewRenderer.
                             *
                             * Adds the class 'saving' and removes 'editing'.
                             */
                            saveAndView: function() {
                                if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                                if (!this.validate()) {
                                    return;
                                }
                                var rowId = $cell.closest("tr").attr("data-row-id");
                                if (rowId == undefined || rowId == "") {
                                    return;
                                }
                                var column = spreadsheet.colOf($cell);
                                if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', column)) return;

                                if ($cell.hasClass("formula")) {
                                    window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                    return;
                                }

                                var val = this.getInputBoxValue(),
                                    previousValue = $cell.attr('data-value');
                                if (val == '') {
                                    val = null;
                                }
                                if (previousValue == val) {
                                    $cell.html($cell.attr('data-rendered')).removeClass('editing');
                                    return;
                                }

                                $cell.attr('data-value', val);
                                $cell.attr('data-fe-value', null);
                                // Keep the value for cancel
                                // $cell.attr('data-rendered', rendered);

                                $cell.text(("" + val).substr(0, 15) + "...").addClass("saving").removeClass("editing");
                                spreadsheet.saveCell($cell, val);
                                window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                            },
                            getInputBoxValue: function() {
                                var $input = $cell.find("input, textarea");
                                if ($input.size() > 0)
                                    return $input.val();
                                return $cell.find("div[contenteditable]").text();
                            },
                            cancelEdit: function() {
                                if ($cell.hasClass("formula")) {
                                    window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell, this);
                                    return;
                                }
                                var rendered = $cell.attr('data-rendered');
                                if (rendered == undefined) {
                                    $cell.empty().removeClass("editing");
                                } else {
                                    $cell.html(rendered).removeClass("editing");
                                }
                            },
                            markInError: function(reason) {
                                $cell.addClass("invalid").attr("title", reason || "The cell couldn't be saved. Check the input and try again.");
                                // Transform as a tooltip
                                $cell.tooltip({delayIn: 0}); // Call Confluence's default values
                                $cell.tipsy("enable");
                                $cell.tipsy("show");
                                if (!$cell.hasClass("editing")) {
                                    this.edit();
                                    $cell.removeClass("saving");
                                }
                            }
                        };
                    return operations;
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var formats = column.formats,
                        jointIdColumn = formats["joint-id"],
                        jointTable = formats["joint-table"],
                        jointColumn = formats["joint-column"],
                        jointFK = formats["joint-fk"];
                    if (jointColumn == column.name) jointColumn = undefined;
                    if (jointIdColumn) {
                        var idColumn = spreadsheet.colOf(jointIdColumn);
                        if (idColumn) {
                            jointTable = idColumn.formats["joint-table"];
                        }
                    }
                    if (jointIdColumn || jointTable) {
                        $div.append(Confluence.Templates.PlaySQL.columnPropertiesJoint({
                            jointIdColumn: jointIdColumn,
                            jointTable: jointTable,
                            jointColumn: jointColumn,
                            jointFK: jointFK
                        }));
                    }
                },
                getFormatValues : function($form, column) {
                    var result = {},
                        jointId = $form.find("#column-joint-id").val(),
                        jointColumn = $form.find("#column-joint-column").val(),
                        jointTable = $form.find("#column-joint-table").val(),
                        jointFK = $form.find("#column-joint-fk").val();
                    if (jointId) result["joint-id"] = jointId;
                    if (jointColumn && jointColumn != column.name) result["joint-column"] = jointColumn;
                    if (jointTable) result["joint-table"] = jointTable;
                    if (jointFK) result["joint-fk"] = jointFK;
                    return result;
                },
                onClickQuickRenderer : function (spreadsheet, column) {
                    // Do nothing, but return false so the process keeps going
                    return false;
                }
            };
        };

        window.PlaySQL.Spreadsheet.RendererBase = RendererBase;
        window.PlaySQL.Spreadsheet.rendererBase = new RendererBase();

        var DefaultRenderer = function() {
            var base = window.PlaySQL.Spreadsheet.rendererBase;
            return $.extend({}, base, {
                key: "as-string",
                getI18nName : function() {
                    return "Text"
                },
                isSupportedType : function(type) {
                    return "VARCHAR" == type || "TEXT" == type;
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                }
            });
        };
        api.register(new DefaultRenderer());

        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {
        var RendererBase = window.PlaySQL.Spreadsheet.RendererBase;
        var BinaryRenderer = function() {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "binary",
                getI18nName : function() {
                    return "binary";
                },
                isSupportedType : function(type) {
                    return type === "BYTEA";
                },
                getDefaultType : function() {
                    return "BYTEA";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value === null || value === undefined || value==="")
                        return "<span class='not-a-value'>&nbsp;</span>";
                    return AJS.escapeHtml(value);
                },
                forCell : function(spreadsheet, $cell){
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        focus: function (withCaret) {
                        },
                        edit: function (setValue) {
                        },
                    });
                }
            });
        };
        api.register(new BinaryRenderer());
        var MarkdownRenderer = function() {
            var base = new RendererBase();
            return $.extend({}, base, {
                key: "markdown",
                getI18nName : function() {
                    return "Markdown"
                },
                isSupportedType : function(type) {
                    return "VARCHAR" == type || "TEXT" == type;
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value === null || value === undefined) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    // We don't escape because the value comes from the server-side and has already been sanitized
                    return value;
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments);
                    $div.append(Confluence.Templates.PlaySQL.columnPropertiesMarkdown({}));
                    return result;
                }
            });
        };
        api.register(new MarkdownRenderer());

        /* Parses a user entry
         * @param decimalSeparator ".", "," or null if decimals should be truncated.
         * @return the number or null
         */
        function parseNumber(string, decimalSeparator) {
            if (string == undefined) return string;
            if (/^\s*-?[0-9]*\s*$/.test(string)) return $.trim(string);
            var result = "",
                hasNumberStarted = false,
                hasPeriodBeenMet = false,
                hasCommaBeenMet = false,
            // The Guessed is the last one that appears, and that doesn't appear twice.
                guessedDecimalSeparator = undefined;
            for (var i = 0; i < string.length ; i++) {
                var character = string[i];
                switch (true) {
                    case character == "-" && !hasNumberStarted:
                        result += character;
                        break;
                    case character == ".":
                        if (hasPeriodBeenMet) guessedDecimalSeparator = ",";
                        hasPeriodBeenMet = true;
                        result += character;
                        break;
                    case character == ",":
                        if (hasCommaBeenMet) guessedDecimalSeparator = ".";
                        hasCommaBeenMet = true;
                        result += character;
                        break;
                    case /\d/.test(character):
                        hasNumberStarted = true;
                        result += character;
                        break;
                }
            }
            if (guessedDecimalSeparator == undefined) {
                if (hasPeriodBeenMet && hasCommaBeenMet) {
                    guessedDecimalSeparator = result.indexOf(".") > result.indexOf(",") ? "." : ",";
                } else if (hasPeriodBeenMet ^ hasCommaBeenMet) {
                    guessedDecimalSeparator = hasPeriodBeenMet ? "." : ",";
                }
            }
            if (guessedDecimalSeparator == undefined) {
                return result;
            }
            if (guessedDecimalSeparator == decimalSeparator) {
                return result;
            }
            if (decimalSeparator == undefined) {
                result = result.substr(0, result.indexOf(decimalSeparator));
                result = result.replace(/,\./g, "");
                return result;
            }
            // Remove all thousand separators
            result = guessedDecimalSeparator == "." ? result.replace(/,/g, "") : result.replace(/\./g, "");
            result = result.replace(guessedDecimalSeparator, decimalSeparator);
            return result;
        }

        var NumericRenderer = function() {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "numeric",
                getI18nName : function() {
                    return "Decimal"
                },
                isSupportedType : function(type) {
                    return type == "INTEGER" || type == "BIG_INTEGER" || type == "NUMERIC" || type == "DOUBLE";
                },
                getDefaultType : function() {
                    return "NUMERIC";
                },
                isSystemRenderer : function() {
                    return false;
                },
                onColumnDisplay : function(spreadsheet, column) {
                    spreadsheet.$findColumnCells(column).addClass("numeric-renderer");
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autocompleteFilterNumber(column, term, data);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    var that = this;
                    return $.extend({}, parent, {
                        validate : function(transformIfFormula) {
                            var $input = $cell.find("input");
                            if ($input.size == 0) return false;
                            var originalVal = $input.val();
                            if ($cell.hasClass("formula") || !$cell.hasClass("anti-formula") && originalVal.charAt(0) == "=") {
                                /* TODO Formula activation/deactivation here */
                                return parent.validate(transformIfFormula);
                            }
                            var newVal = parseNumber(originalVal, spreadsheet.decimalSeparator);
                            if (newVal != originalVal) {
                                $input.val(newVal);
                                $input.attr("title", "Only numbers are accepted").tipsy({delayIn: 0});
                            }
                            return parent.validate(transformIfFormula);
                        }
                    });
                }
            });
        };
        api.register(new NumericRenderer());

        function formatNumber(value, format) {
            function ofMatch(regex, group) {
                var regexMatched = regex.exec(format);
                group = group || 0;
                if (regexMatched != null && regexMatched.length > group) {
                    return regexMatched[group];
                }
                return undefined;
            }
            function pad(str, length, reverse, maxLength) {
                if (maxLength != undefined) str = reverse ? str.substr(0, Math.min(str.length, maxLength)) : str.substr(-Math.min(str.length, maxLength));
                while (str.length < length) {
                    str = reverse ? str + "0" : "0" + str;
                }
                if (length == 0 && str == "0") return "";
                return str;
            }
            var colour = ofMatch(/^([a-z]+);/);
            if (colour != undefined) format = format.substr(format.indexOf(";") + 1);
            var styles = { },
                separatorsRegex = /[0#](.)[0#]/g,
                thousandSeparator = ofMatch(separatorsRegex, 1),
                decimalSeparator = ofMatch(separatorsRegex, 1),
                numbersBeforeDecimal = (decimalSeparator !== undefined ? format.split(decimalSeparator)[0] : format).replace(/[^0]/g, ''),
                numbersAfterDecimal = (decimalSeparator !== undefined ? format.split(decimalSeparator)[1] : "").replace(/[^0#]/g, ''),
                zeroesBeforeDecimal = numbersBeforeDecimal.length,
                zeroesAfterDecimal = numbersAfterDecimal.replace(/[^0]/g, '').length,
                maxAfterDecimal = numbersAfterDecimal.length,
            /*numberStart = Math.min(format.indexOf("0"), format.indexOf("#")),
             numberEnd = Math.min(format.indexOf("0"), format.indexOf("#")),*/
                decimalMultiple = Math.pow(10, maxAfterDecimal),
                integerPart = Math.abs(parseInt(value)).toString(),
                paddedIntegerPart = pad(integerPart, zeroesBeforeDecimal),
                separatedIntegerPart = paddedIntegerPart.replace(/\B(?=(\d{3})+(?!\d))/g, thousandSeparator != "#" ? thousandSeparator : ""),
                decimalPart = (Math.round(parseFloat(value.substr(value.indexOf(".") || value.indexOf(","))) * decimalMultiple)/decimalMultiple).toString().substr(2),
                paddedDecimalPart = pad(decimalPart, zeroesAfterDecimal, true, maxAfterDecimal),
                formattedValue = separatedIntegerPart + (paddedDecimalPart != "" ? decimalSeparator + paddedDecimalPart : "");

            value = format.replace(/[0#].*[0#]/, formattedValue);

            if (colour != null) {
                styles["color"] = colour;
            }

            return {
                value: value,
                styles: styles
            };
        }

        var IntegerRenderer = function() {
            var base = new NumericRenderer();
            return $.extend({}, base, {
                key: "integer",
                getI18nName : function() {
                    return "Integer"
                },
                getDefaultType : function() {
                    return "INTEGER";
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        // We don't need to customize the validate method, since the parent does it already
                    });
                }
            });
        };
        api.register(new IntegerRenderer());

        var CurrencyRenderer = function() {
            var parentBase = new NumericRenderer();
            return $.extend({}, parentBase, {
                key: "currency",
                getI18nName : function() {
                    return "Currency"
                },
                isSystemRenderer : function() {
                    return false;
                },
                isSupportedType : function(type) {
                    // TODO: Require an nine-figure license fee for those who use BIG_INTEGER on the Currency render
                    return type == "NUMERIC" || type == "DOUBLE" || type == "INTEGER" || type == "BIG_INTEGER";
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == undefined) return "<span class='not-a-value'>&nbsp;</span>";
                    var flt = parseFloat(value),
                        format;
                    if (isNaN(flt)) return "<span class='not-a-value'>&nbsp;</span>";
                    if (flt == 0) format = column.formats['equalZero'];
                    else if (flt < 0) {
                        format = column.formats['belowZero'];
                    }
                    if (format === undefined || format === "") {
                        format = column.formats['aboveZero'];
                        if (flt < 0 && format.indexOf("-") == -1)
                            format = format.replace(/([#0])/, "-$1");
                    }
                    if (format === undefined || format === "") {
                        format = "$ #,##0.######";
                        if (flt < 0) format = "darkred;$ -#,##0.######";
                    }
                    var formatted = formatNumber(value, format),
                        styles = column.formats && $.parseJSON(column.formats.css) || {},
                        columnErsatz;
                    $.extend(styles, formatted.styles);
                    columnErsatz = { formats : { css : $.toJSON(styles) }};
                    return parentBase.renderCellContents.call(this, formatted.value, spreadsheet, columnErsatz);
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = parentBase.appendRendererDetailsTo.apply(this, arguments),
                        aboveZero = column.formats && column.formats["aboveZero"],
                        equalZero = column.formats && column.formats["equalZero"],
                        belowZero = column.formats && column.formats["belowZero"];

                    $div.append(Confluence.Templates.PlaySQL.columnPropertiesCurrencyField({
                        aboveZero: aboveZero,
                        equalZero: equalZero,
                        belowZero: belowZero
                    }));
                    return result;
                },
                getFormatValues : function($form, column) {
                    return {
                        aboveZero: $form.find("#column-aboveZero").val(),
                        equalZero: $form.find("#column-equalZero").val(),
                        belowZero: $form.find("#column-belowZero").val()
                    };
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = parentBase.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        // No need to override validate(), because we inherit from NumericRenderer anyway
                    });
                }
            });
        };
        api.register(new CurrencyRenderer());

        function jointIdClickHandler(e) {
            e.preventDefault();
            var $this = $(this),
                add = $this.hasClass("joint-id-add"),
                remove = $this.hasClass("joint-id-remove"),
                $th = $this.closest(".joint-id-renderer"),
                $placeholder = $th.closest(".playsql-spreadsheet-placeholder");
            if ($th.size() == 0 || $placeholder.size() == 0) return;
            var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);

            if (add) {
                spreadsheet.addJointRow($th);
            } else if (remove) {
                spreadsheet.removeJointRow($th);
            }
        }

        var JointIdRenderer = function(){
            var base = new IntegerRenderer();
            return $.extend({}, base, {
                key: "joint-id",
                getI18nName : function() {
                    return "Joint ID"
                },
                onColumnDisplay : function(spreadsheet, column) {
                    base.onColumnDisplay.call(this, spreadsheet, column);
                    spreadsheet.$findColumnCells(column).addClass("joint-id-renderer");
                    spreadsheet.$placeholder.off("click.joint-table");
                    spreadsheet.$placeholder.on("click.joint-table", ".joint-id-add, .joint-id-remove", jointIdClickHandler);
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) {
                        if (value == null) return "";
                        return AJS.escapeHtml(value);
                    }
                    if (value === null || value === undefined) {
                        return '<span class="joint-id-value"></span>'
                             + '<a href="#" class="joint-id-add"><span class="aui-icon-small aui-iconfont-add"></span></a>';
                    }
                    value = AJS.escapeHtml("" + value);
                    return '<span class="joint-id-value">' + value + '</span>'
                         + '<a href="#" class="joint-id-remove"><span class="aui-icon-small aui-iconfont-remove"></span></a>';
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        edit: function() {
                            // Add or remove the row
                        },
                        setOriginalValue : function(value) {
                            if (value == null) {
                                $cell.removeAttr("data-value");
                            } else {
                                $cell.attr("data-value", value);
                            }
                            $cell.html(this.parent.renderCellContents(value, spreadsheet));
                        }
                    });
                }
            });
        };
        api.register(new JointIdRenderer());

        var IdRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "id",
                getI18nName : function() {
                    return "Identifier"
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        edit: function() {
                            // No-op: Don't edit the ID
                        },
                        setOriginalValue : function(value) {
                            if (value === null) value = "";
                            $cell.attr("data-value", value).text(value);
                            $cell.parent().attr("data-row-id", value);
                        }
                    });
                }
            });
        };
        api.register(new IdRenderer());

        var BooleanRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "boolean",
                getI18nName : function() {
                    return "Boolean"
                },
                isSupportedType : function(type) {
                    return type == "BOOLEAN";
                },
                getDefaultType : function() {
                    return "BOOLEAN";
                },
                isSystemRenderer : function() {
                    return false;
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){

                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    data.addEntry({
                        label: "TRUE",
                        tip: "constant",
                        sql: "$col = TRUE",
                        replaceColName: "$col"
                    });
                    data.addEntry({
                        label: "FALSE",
                        tip: "constant",
                        sql: "$col = FALSE",
                        replaceColName: "$col"
                    });
                    callback();
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    } else if (value == "true") {
                        return outerHtml($("<span></span>", {
                            "class": "aui-icon aui-icon-small aui-iconfont-success",
                            "text": value,
                            "title": value
                        }));
                    } else if (value == "false") {
                        return outerHtml($("<span></span>", {
                            "class": "aui-icon aui-icon-small aui-iconfont-remove",
                            "text": value,
                            "title": value
                        }));
                    }
                    return AJS.escapeHtml(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        /**
                         * @param muteDropdown Default false / undefined. Set to 'true' if you explicitly don't want
                         *                     any dropdown to show, for example if it's a foreign key and you've
                         *                     just pasted some content.
                         */
                        focus: function(arg1, arg2, muteDropdown) {
                            if ($cell.hasClass("editing") && !spreadsheet.disableFocusManagement) {
                                window.setTimeout(function() {
                                    var $select = $cell.find("select");
                                    if ($select.size() == 0) return; // Maybe the formulas kicked in
                                    if (!muteDropdown) {
                                        $select.focus().select();
                                    } else {
                                        $select.select();
                                    }
                                }, 0);
                            }
                        },
                        edit: function(setValue) {
                            var setValueByRef = [setValue],
                                    situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                                // If the value was changed, use it
                                setValue = setValueByRef[0];
                            switch (situation) {
                                case "no": return;
                                case "formula":
                                    /* TODO Formula activation/deactivation here */
                                    window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                    return;
                                case "ok": break;
                                case "set": break;
                                    setValue = this.parseValue(setValue);
                                    if (typeof setValue != "undefined") {
                                        if (setValue == "true") {
                                            $cell.find("select").val('true');
                                        } else if (setValue == "false") {
                                            $cell.find("select").val('false');
                                        } else {
                                            $cell.find("select").val('');
                                        }
                                    }
                                    return;
                                default:
                                    throw "Not Implemented: situation " + situation;
                            }

                            setValue = this.parseValue(setValue);
                            $cell.addClass("editing");
                            // Keep the old value for cancel
                            $cell.attr('data-rendered', $cell.html());
                            var $input = $("<select>", {
                                html: "<option value=''>No value</option>"
                                + "<option value='true'>True</option>"
                                + "<option value='false'>False</option>"
                            }).val(setValue !== undefined ? setValue : $cell.attr('data-value'));
                            $input.appendTo($cell.empty());

                            var rendererInstance = this;
                            $input.keyup(function(){rendererInstance.validate(true);})
                                .on("blur.playsql-autocommit", function(){
                                    var $this = $(this),
                                        $cell = $this.closest("td");
                                    if ($this.hasClass("no-blur-while-clicking-autocomplete")) {
                                        $this.removeClass("no-blur-while-clicking-autocomplete");
                                        return;
                                    }
                                    if (!$cell.hasClass("aui-dropdown2-trigger")) {
                                        rendererInstance.saveAndView();
                                        spreadsheet.sprayRequestPipe();
                                    }
                                });
                        },
                        parseValue: function(value) {
                            if (value == undefined) return value;
                            if ($.trim(value) == '') return '';
                            if (['true', 't', '1', 'yes', 'y'].indexOf(value.toLowerCase()) != -1) {
                                return "true";
                            } else if (['false', 'f', '0', 'no', 'n'].indexOf(value.toLowerCase()) != -1) {
                                return "false";
                            } else {
                                return value;
                            }
                        },
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if ($cell.hasClass("formula")) {
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }
                            if (!this.validate()) return;
                            if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) return;
                            var $input = checkNotNull($cell.find("select")),
                                val = $input.val();
                            $cell.attr('data-value', val);
                            $cell.attr('data-fe-value', null);
                            // Keep the value for cancel
                            $cell.attr('data-rendered', val);

                            $cell.text(val).addClass("saving").removeClass("editing");
                            spreadsheet.saveCell($cell, val);
                            window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                        }
                    });
                }
            });
        };
        api.register(new BooleanRenderer());

        var formatDate = function(date, format) {
            if (!date || !format) return date;
            if (!(date instanceof Date)) {
                // Format is expected to be yyyy-MM-dd, as per JDBC specs
                var dateComponents = date.split("-");
                if (dateComponents.length != 3) return dateComponents;
                date = new Date(parseInt(dateComponents[0]), parseInt(dateComponents[1])-1, parseInt(dateComponents[2]));
            }
            var ddd2 = date.getDay(),
                d = date.getDate(),
                M = date.getMonth() + 1,
                yyyy = date.getFullYear(),
                dd = (d < 10 ? "0" : "") + d,
                MM = (M < 10 ? "0" : "") + M,
                yy2 = yyyy % 100,
                yy = (yy2 < 10 ? "0" : "") + yy2,
                ddd = [ "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"][ddd2],
                dddd = [ "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"][ddd2],
                MMM = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][M-1],
                MMMM = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][M-1],
                result = format;
            // Mundane replacement...
            result = result.replace(/^(([^"]|"[^"]*")*)dddd/, '$1"' + dddd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)ddd/, '$1"' + ddd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)dd/, '$1"' + dd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)d/, '$1"' + d + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)yyyy/, '$1"' + yyyy + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)yy/, '$1"' + yy + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MMMM/, '$1"' + MMMM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MMM/, '$1"' + MMM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MM/, '$1"' + MM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)M/, '$1"' + M + '"');
            result = result.replace(/"/g, '');
            return result;
        }

        window.PlaySQL.Spreadsheet.formatDate = formatDate;

        var DateRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                parent: base,
                key: "date",
                getI18nName : function() {
                    return "Date Picker"
                },
                isSupportedType : function(type) {
                    return type == "DATE";
                },
                getDefaultType : function() {
                    return "DATE";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value && column.formats && column.formats.dateFormat) {
                        value = formatDate(value, column.formats.dateFormat);
                    }
                    return base.renderCellContents.call(this, value, spreadsheet, column);
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterDate(column, term, data);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        /*
                         * @param muteDropdown Default false / undefined. Set to 'true' if you explicitly don't want
                         *                     any dropdown to show, for example if it's a foreign key and you've
                         *                     just pasted some content.
                         */
                        focus: function(withCaret, selEnd, muteDropdown) {
                            if (!spreadsheet.disableFocusManagement && $cell.hasClass("editing")) {
                                var $input = $cell.find("input");
                                if ($input.datePicker) {
                                    // Yay! AUI 5.1's date picker is in!
                                    $(".aui-inline-dialog:has(.ui-datepicker), .aui-datepicker-dialog").remove();
                                }
                                parent.focus(withCaret, selEnd, muteDropdown);
                            }
                        },
                        edit: function(setValue) {
                            var setValueByRef = [setValue],
                                situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                            // If the value was changed, use it
                            setValue = setValueByRef[0];

                            switch (situation) {
                                case "no": return;
                                case "formula":
                                    /* TODO Formula activation/deactivation here */
                                    window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                    return;
                                case "ok": break;
                                case "set": break;
                                    setValue = this.parseValue(setValue);
                                    if (typeof setValue != 'undefined') $cell.find("input, textarea").val(setValue);
                                    return;
                                default:
                                    throw "Not Implemented: situation " + situation;
                            }

                            setValue = this.parseValue(setValue);
                            $cell.addClass("editing");
                            // Keep the old value for cancel
                            $cell.attr('data-rendered', $cell.html());
                            var $input = $("<input>", {
                                value: setValue != undefined ? setValue : $cell.attr('data-value'),
                                "class": "aui-date-picker"
                            });
                            $cell.html($input);
                            $input = $cell.find(".aui-date-picker");

                            var rendererInstance = this;
                            window.setTimeout(function() {
                                $input.attr("type", "date");
                                $input.datePicker && $input.datePicker({
                                    'overrideBrowserDefault': true
                                });
                                $input.click(); // Open the date picker
                                $input.on("change", function() {
                                    rendererInstance.saveAndView();
                                    spreadsheet.sprayRequestPipe();
                                });
                            }, 0);
                        },
                        validate: function(transformIfFormula) {
                            if ($cell.hasClass("editing")) {
                                var $input = $cell.find("input"),
                                    value = $input.val();
                                if (($cell.hasClass("formula") || !$cell.hasClass("anti-formula")) && value.indexOf("=") == 0) {
                                    /* TODO Formula activation/deactivation here */
                                    return parent.validate(transformIfFormula);
                                }
                                $input.val(this.parseValue(value));
                                var parentValue = parent.validate(transformIfFormula);
                                return parentValue;
                            }
                            return false;
                        },
                        parseValue: function(value) {
                            if (value == undefined) return value;
                            value = $.trim(value);
                            if (value == '') return value;
                            if (/[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}/.test(value)) return value;
                            if (/[0-9]{2}-[0-9]{2}-[0-9]{2}/.test(value)) return value.replace(/([0-9]{2})-([0-9]{2})-([0-9]{2})/, "20$1-$2-$3");
                            if (/[0-9]{4}[^0-9]+[0-9]{1,2}[^0-9]+[0-9]{1,2}/.test(value)) return value.replace(/([0-9]{4})([^0-9]+)([0-9]{1,2})([^0-9]+)([0-9]{1,2})/, "$1-$3-$5");
                            if (/[0-9]{1,2}[^0-9]+[0-9]{1,2}[^0-9]+[0-9]{4}/.test(value)) return value.replace(/([0-9]{1,2})([^0-9]+)([0-9]{1,2})([^0-9]+)([0-9]{4})/, "$5-$3-$1");
                            // Is there... text? In a DATE?
                            var parsed = new Date(value);
                            if (parsed instanceof Date && !isNaN(parsed.getTime())) {
                                // slice(-2) returns the last 2 chars of the string: It's padding with leading 0s.
                                return parsed.getFullYear() + '-' + ("0" + (parsed.getMonth()+1)).slice(-2) + '-' + ("0" + parsed.getDate()).slice(-2);
                            }
                            return '';
                        },
                        saveAndView : function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if ($cell.hasClass("formula")) {
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }
                            $(".aui-datepicker-dialog").remove();
                            var $input = $cell.find("input");
                            $input.val(this.parseValue($input.val()));
                            var parentValue = parent.saveAndView();
                            return parentValue;
                        }
                    });
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments),
                        dateFormat = column.formats && column.formats["dateFormat"];

                    $div.append(Confluence.Templates.PlaySQL.columnPropertiesDateFormatField({ dateFormat: dateFormat }));
                    return result;
                },
                getFormatValues : function($form, column) {
                    return {
                        dateFormat: $form.find("#column-dateFormat").val()
                    };
                }
            });
        };
        api.register(new DateRenderer());

        var HeaderRenderer = function() {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "header",
                getI18nName : function() {
                    return "Header"
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        view: function() {
                            var column = spreadsheet.colOf($cell);
                            $cell.empty()
                                .text(column.label)
                                .attr("data-name", column.name)
                                .attr("title", column.name)
                                .attr("data-type", column.type)
                                .attr("data-renderer", column.renderer);
                            if (column.statusPK) $cell.attr("data-status-pk", "true");
                            if (column.statusPosition) $cell.attr("data-status-position", "true");

                            $cell.removeClass("editing saving");
                        },
                        edit: function() {
                            if ($cell.hasClass("editing") || $cell.hasClass("saving"))
                                return;
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
                            var column = checkNotNull(spreadsheet.colOf($cell), $cell);
                            if (!!column.name) {
                                // We don't rename columns by pressing Enter on them anymore
                                return;
                            }

                            $cell.addClass("editing focused selected");
                            // Remove the magic menu
                            $cell.removeClass("aui-dropdown2-trigger")
                                .removeAttr('aria-controls aria-haspopup aria-owns');

                            $cell.attr('data-rendered', $cell.html());
                            var column = checkNotNull(spreadsheet.colOf($cell), $cell);

                            var $input = $("<input>", {
                                type: 'text',
                                "class": "column-label",
                                value: column.label
                            });
                            $cell.empty().append($input);
                            $input.on("blur.playsql-autocommit", function() {
                                spreadsheet.getCell($cell).renderer.saveAndView();
                                spreadsheet.sprayRequestPipe();
                            });
                        },
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
                            var label = $cell.find("input.column-label").val(),
                                column = spreadsheet.colOf($cell),
                                name = window.PlaySQL.Helpers.generateKey(label, spreadsheet.defaultCase);
                            if (!column.name) {
                                $cell.removeClass("editing invalid").addClass("saving").text(label);
                                var iterate = true;
                                while (iterate == true) {
                                    iterate = false;
                                    for (var i=0 ; i < spreadsheet.columns.length ; i++) {
                                        if (spreadsheet.columns[i].name == name) {
                                            name += "1";
                                            label += "1";
                                            iterate = true;
                                            break;
                                        }
                                    }
                                }
                                spreadsheet.createColumn($cell, {
                                    name: name,
                                    type: "TEXT",
                                    label: label,
                                    renderer: column.renderer,
                                    viewRenderer: column.viewRenderer,
                                    index: column.index
                                });
                            } else {
                                throw "The column shouldn't be editable inline.";
                            }
                        },
                        cancelEdit: function() {
                            var column = spreadsheet.colOf($cell);
                            if (column.name == "") {
                                spreadsheet.deleteColumn($cell);
                            } else {
                                parent.cancelEdit.apply(this, arguments);
                            }
                        }
                    });
                }
            });
        }
        api.register(new HeaderRenderer());

        var StatusRenderer = function() {
            var base = new RendererBase();
            return $.extend({}, base, {
                key: "status",
                getI18nName : function() {
                    return "Icon"
                },
                isSystemRenderer : function() {
                    return false;
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                splitMappings : function(serialized) {
                    if (serialized == undefined) {
                        return {};
                    } else {
                        try {
                            var value = $.parseJSON(serialized);
                            if (value) return value;
                            return {};
                        } catch (err) {
                            return {};
                        }
                    }
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    var statusList = column.formats["status"];
                    column.statusMappings = this.splitMappings(statusList);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterList(column, term, data, Object.keys(column.statusMappings));

                    if (term.length > 0) {
                        window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterString(column, term, data);
                    }
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }

                    if (!column.statusMappings) {
                        var statusList = column.formats["status"];
                        column.statusMappings = this.splitMappings(statusList);
                        for (var status in column.statusMappings) {
                            if (!column.statusMappings.hasOwnProperty(status)) continue;
                            if (column.statusMappings[status].indexOf("data:image") == 0
                                || column.statusMappings[status].indexOf("/") == 0
                                || column.statusMappings[status].indexOf("://") != -1) {
                                // Use a CSS instead
                                column.statusMappings[status] = addCssClass({
                                    "background-image": "url('" + column.statusMappings[status] + "')"
                                });
                            }
                        }
                    }
                    var data = column.statusMappings[value] || "";
                    if (data) {
                        var $span = $("<span></span>", {
                            "class": "playsql-status-value " + data,
                            "text": value,
                            "title": value
                        });

                        return $("<div></div>", {
                            html: $span
                        }).html();
                    } else {
                        return $("<div></div>", {
                            text: value
                        }).html();
                    }
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        /* Nothing to override */
                    });
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments),
                        statusses = column.formats && column.formats["status"];

                    var mappings = this.withDefaultFormatValues(column, this.splitMappings(statusses));
                    $div.append(Confluence.Templates.PlaySQL.columnPropertiesValueMappingField({ mappings: mappings }));

                    $("#value-mappings .add").click(function(){
                        $("#value-mappings tbody").append(
                            Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow({ key: "", value: "" })
                        );
                    });
                    $("#value-mappings").on("click", ".remove-mapping", function() {
                        $(this).closest("#value-mappings tr").remove();
                    });

                    return result;
                },
                getFormatValues : function($form, column) {
                    var mappings = {};
                    $form.find("#value-mappings tr").each(function(){
                        var $this = $(this),
                            key = $this.find("input[name='key']").val(),
                            value = $this.find("input[name='value']").val();
                        if (key != undefined && key != "") {
                            mappings[key] = value;
                        }
                    });

                    return { status: $.toJSON(mappings) };
                },
                withDefaultFormatValues : function(column, mappings) {
                    if (Object.keys(mappings).length == 0 && column.renderer != "status" && column.viewRenderer != "status") {
                        // Load values for the demo effect
                        return {
                            "true": "aui-icon aui-icon-small aui-iconfont-success",
                            "false": "aui-icon aui-icon-small aui-iconfont-remove",
                            "ok": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAASFBMVEX///8UiSwUiSwUiSwUiSwUiSwUiSz///8UiSxksXQjkDmn07Cj0a2DwZB+vox7vYlstXv2+/f0+fVAn1Tw9/Le7uHX6trS6NawFlV2AAAAB3RSTlMAEWaqu8zuQLwGJgAAAGZJREFUeF5tj0cSxCAMBDFpBue4+/+fGgGlA+W+TauUjGAdM86ayhDYCEPJkUoUI3Ul5H4N40jSGs/G9VtJelNqkk884otYJu7AnyoOTMBMFZwBbKzUoelOLfu2VrH9YV+n98/177+rqQbbMcOFQgAAAABJRU5ErkJggg=="
                        }
                    }
                    return mappings;
                }
            });
        };
        api.register(new StatusRenderer());


        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }
    });

    var dynamicCss = document.createElement('style'),
        dynamicCssCount = 0;
    dynamicCss.type = 'text/css';
    //dynamicCss.innerHTML = '.cssClass { color: #F00; }';
    document.getElementsByTagName('head')[0].appendChild(dynamicCss);

    function addCssClass(contents) {
        var html = dynamicCss.innerHTML,
            name = "dynamicRule" + (++dynamicCssCount),
            rules = "",
            content;
        for (var key in contents) {
            if (!contents.hasOwnProperty(key)) continue;
            content = contents[key];
            reducedQuotes = content.replace(/'[^'\\]*'/g, '').replace(/'[^"\\]*"/g, '')
            if (reducedQuotes.indexOf("'") != -1
                || reducedQuotes.indexOf('"') != -1
                || reducedQuotes.indexOf(";") != -1
                || reducedQuotes.indexOf("\\") != -1
            ) {
                AJS.logError("Illegal css string: " + content);
                continue;
            }
            if (!(/^[-a-zA-Z0-9 .]*$/.test(key))) {
                AJS.logError("Illegal css key: " + key);
            }
            rules += "\n    $key : $value ;".replace("$key", key).replace("$value", content);
        }

        var newRule = "\n.$name { $rules }".replace("$name", name).replace("$rules", rules);
        html += newRule;
        dynamicCss.innerHTML = html;

        AJS.log("Dynamic css: ", dynamicCss.innerHTML);
        return name;
    }
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-links.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {
        var JIRA_ISSUE = /^[A-Z-]+[0-9]+$/;

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        var LinkRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            window.PlaySQL.Spreadsheet.Applinks = {
                projects: {}
            };

            function getJIRAProject(name) {
                var projectKey = name && name.split("-")[0];
                if (!window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] || window.PlaySQL.Spreadsheet.Applinks.projects[projectKey].status == 'UNKNOWN') {
                    window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = { status: "SEARCHING" };

                    var url = PlaySQL.SPI.baseUrlOld("misc", "jiralinks", {issue: projectKey});
                    $.ajax({
                        url: url,
                        type: 'GET',
                        contentType: "application/json; charset=utf-8"
                    }).done(function (data, status, request) {
                        window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = {
                            status: "FOUND",
                            baseUrl: data.substr(0, data.length - projectKey.length - 1)
                        };
                        callbackAfterJIRAProjectFetched();
                    }).fail(function (jqXHR, error, reason) {
                        window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = { status: "UNKNOWN" };
                        AJS.log("Can't find JIRA project for " + projectKey);
                    });
                }
                return window.PlaySQL.Spreadsheet.Applinks.projects[projectKey];
            }

            function callbackAfterJIRAProjectFetched() {
                var $toRender = $("a.jira-issue-to-render");
                $toRender.each(function(){
                    var $this = $(this),
                        key = $this.attr('data-jira-key'),
                        project = getJIRAProject(key);
                    if (project.status == "FOUND") {
                        $this.attr('href', project.baseUrl + "/" + key).removeClass("jira-issue-to-render");
                    }
                });
            }

            function render(value) {
                var project = getJIRAProject(value);

                if (project.status == "FOUND") {
                    return outerHtml($("<a></a>", {
                        href: project.baseUrl + "/" + value,
                        "data-jira-key": value,
                        text: value
                    }));
                }
                return outerHtml($("<a></a>", {
                    href: undefined,
                    "data-jira-key": value,
                    "class": "jira-issue-to-render",
                    text: value
                }));
            }

            return $.extend({}, base, {
                key: "link",
                getI18nName : function() {
                    return "Link"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    // URL is at the beginning
                    if (value.indexOf(":") != -1 || value.indexOf("@") != -1) {
                        var protocolIndexOf = value.indexOf(":"),
                            spaceIndexOf = value.indexOf(" "),
                            linkText = value,
                            linkHref = value;
                        if (spaceIndexOf != -1) {
                            if (spaceIndexOf > protocolIndexOf) {
                                linkText = value.substring(spaceIndexOf + 1);
                                linkHref = value.substring(0, spaceIndexOf);
                            } else {
                                // Link in the middle of a text
                                value = AJS.escapeHtml(value);
                                var values = value.split(" ");
                                for (var i = 0 ; i < values.length ; i++) {
                                    var valueI = values[i];
                                    if (valueI.indexOf("javascript:") != -1) {
                                        values[i] = AJS.escapeHtml(valueI);
                                    } else if (/^[a-z][a-z0-9+.-]+:[^ ]/i.test(valueI)) {
                                        values[i] = "<a href='" + valueI + "'>" + AJS.escapeHtml(valueI) + "</a>";
                                    } else if (valueI.indexOf("@") != -1) {
                                        values[i] = "<a href='mailto:" + valueI + "'>" + AJS.escapeHtml(valueI) + "</a>";
                                    } else {
                                        values[i] = AJS.escapeHtml(valueI);
                                    }
                                }
                                return values.join(" ");
                            }
                        }
                        if (linkHref.indexOf("javascript:") != -1) {
                            return AJS.escapeHtml(linkText);
                        }
                        return outerHtml($("<a></a>", {
                            href: linkHref.indexOf("@") != -1 && linkHref.indexOf("mailto:") == -1 ? "mailto:" + linkHref : linkHref,
                            text: linkText
                        })).replace(/\n/g, "<br>\n");
                    }
                    // JIRA issues can only be rendered on the Server version
                    if (PlaySQL.type != "cloud" && JIRA_ISSUE.test(value)) {
                        return render(value);
                    }
                    return AJS.escapeHtml(value).replace(/\n/g, "<br>\n");
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var result = base.forCell.apply(this, arguments);
                    return $.extend(result, {
                        // Nothing to extend here
                    });
                }
            });
        };
        api.register(new LinkRenderer());

        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-entities.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        // Structure of the back-end value: contentId;spaceKey;title
        var PageRenderer = function(){
            var parent = new window.PlaySQL.Spreadsheet.RendererBase();

            var parent1 = $.extend({}, parent, {
                key: "confluencecontent",
                getI18nName : function() {
                    return "Page Picker"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    var valueObject = this.parseToObject(value);
                    if (valueObject == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    } else if (valueObject.id) {
                        var href = PlaySQL.SPI.contextPath + "/pages/viewpage.action?pageId=" + AJS.escapeHtml(valueObject.id);
                        var $link = $("<a>", {
                                href : href,
                                text: valueObject.title
                            });
                        return outerHtml($link);
                    } else {
                        return AJS.escapeHtml(valueObject.title).replace(/\n/g, "<br>\n");
                    }
                },
                createInputBox : function(value) {
                    // The value we display to the user should be user-friendly. It's when the autocomplete is triggered
                    // that the correct value is inserted.
                    var parts = this.parseToObject(value);
                    var text = value;
                    if (parts && parts.title) {
                        text = parts.title;
                    }
                    var $input = $(PlaySQL.Helpers.htmlBuilder("input", {
                        placeholder: "Page or blog",
                        "class": "playsql-autocomplete-confluencecontent",
                        value: text || "",
                        "data-value": value,
                        "autocomplete": "off"
                    }));
                    return $input;
                },
                parseToObject: function(value) {
                    if (typeof value == "string") {
                        var parts = value.split(";");
                        if (parts.length >= 3) {
                            return {
                                id: parts[0],
                                spaceKey: parts[1],
                                title: parts.slice(2).join(";")
                            };
                        } else if (value) {
                            return {
                                title: value
                            }
                        }
                    }
                    return null;
                },
                forCell: function(spreadsheet, $cell) {
                    var result = parent.forCell.apply(this, arguments);
                    return $.extend({}, result, {
                        createInputBox : function(beValue, feValue) {
                            var $input = result.createInputBox.apply(this, arguments);
                            var o = parent1.parseToObject(beValue);
                            if (o) {
                                $input.val(o.title);
                                $input.attr("data-value", beValue);
                            }
                            if (parent1.popup == null || parent1.popup.isDestroyed()) {
                                parent1.popup = PlaySQL.Popup.createAutocomplete("playsql-autocomplete-confluencecontent", spreadsheet.$placeholder,
                                    function (query, list, callback) {
                                        var spaceKey = AJS.Meta.get("space-key");
                                        $.ajax({
                                            url: PlaySQL.SPI.baseUrlOld("misc", "confluencecontent", {
                                                spaceKey: spaceKey,
                                                q: query
                                            }),
                                            success: function (data) {
                                                for (var i = 0 ; i < data.length ; i++) {
                                                    var item = data[i];
                                                    list.push({
                                                        text: item.label,
                                                        space: item.space,
                                                        html: Confluence.Templates.PlaySQL.autocompletePage({item: item, spaceKey: spaceKey}),
                                                        id: item.id + ";" + item.space + ";" + item.label
                                                    });
                                                }
                                                list.dedupe(function(item) {return item.id}, function(a, b) {
                                                    // Sort by title, but with the current space as first
                                                    a = a && (a.space == spaceKey ? " " : a.space) + ":" + a.text;
                                                    b = b && (b.space == spaceKey ? " " : b.space) + ":" + b.text;
                                                    return a < b ? -1 : a > b ? 1 : 0;
                                                });
                                                callback(true);
                                            },
                                            error: function (jqXHR) {
                                                $("#aui-flag-container").empty();
                                                AJS.flag({
                                                    type: 'error',
                                                    title: 'Autocompletion for pages',
                                                    close: "manual",
                                                    body: "Can't retrieve page titles: " + PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                                });
                                                callback(false);
                                            }
                                        });
                                    }, {
                                        defaultPosition: "closed"
                                    });
                            }
                            parent1.popup.attach("input", $input, "closest(td, .playsql-form-field)", function(selectedId, event){
                                event.preventDefault();
                                var selectedObject = parent1.popup.findItem(selectedId);
                                if (!selectedObject) return;
                                $input.val(selectedObject.text);
                                $input.attr("data-value", selectedId);
                                return false;
                            });
                            return $input;
                        },
                        getInputBoxValue: function() {
                            var $input = $cell.find("input");
                            if (!$.trim($input.val())) {
                                return null;
                            } else {
                                return $input.attr("data-value");
                            }
                        }
                    });
                }
            });
            return parent1;
        };
        api.register(new PageRenderer());

        // Structure of the back-end value: contentId;spaceKey;title
        var UserRenderer = function(){
            var parent = new window.PlaySQL.Spreadsheet.RendererBase();

            var parent1 = $.extend({}, parent, {
                key: "confluenceuser",
                getI18nName : function() {
                    return "User Picker"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    var valueObject = this.parseToObject(value);
                    if (valueObject == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    } else if (valueObject.type == "user") {
                        var href = PlaySQL.SPI.contextPath + "/display/~" + AJS.escapeHtml(valueObject.username);
                        var $link = $("<a>", {
                            href : href,
                            text: valueObject.title,
                            "class": "confluence-userlink user-mention",
                            "data-linked-resource-id": valueObject.userkey,
                            "data-linked-resource-type": "user",
                            "data-username": valueObject.username,
                            "data-base-url": AJS.Meta.get("base-url")
                        });
                        window.setTimeout(function(){
                            // to ensure user hover over user links work
                            Confluence.Binder.userHover();
                        }, 0);
                        return outerHtml($link);
                    } else if (valueObject.type == "group") {
                        return AJS.escapeHtml(valueObject.groupId).replace(/\n/g, "<br>\n");
                    } else {
                        return AJS.escapeHtml(valueObject.title).replace(/\n/g, "<br>\n");
                    }
                },
                createInputBox : function(value) {
                    // The value we display to the user should be user-friendly. It's when the autocomplete is triggered
                    // that the correct value is inserted.
                    var parts = this.parseToObject(value);
                    var text = value;
                    if (parts && parts.displayName) {
                        text = parts.displayName;
                    }
                    var $input = $(PlaySQL.Helpers.htmlBuilder("input", {
                        placeholder: "User or group",
                        "class": "playsql-autocomplete-user-group",
                        value: text || "",
                        "data-value": value,
                        "autocomplete": "off"
                    }));
                    return $input;
                },
                parseToObject: function(value) {
                    if (typeof value == "string") {
                        var parts = value.split(";");
                        if (parts.length >= 4) {
                            return {
                                username: parts[0],
                                type: parts[1],
                                userkey: parts[2],
                                title: parts.slice(3).join(";")
                            };
                        } else if (parts.length == 2) {
                            return {
                                groupId: parts[0],
                                type: parts[1],
                                title: parts[0]
                            };
                        } else if (value) {
                            return {
                                title: value
                            }
                        }
                    }
                    return null;
                },
                forCell: function(spreadsheet, $cell) {
                    var result = parent.forCell.apply(this, arguments);
                    return $.extend({}, result, {
                        createInputBox : function(beValue, feValue) {
                            var $input = result.createInputBox.apply(this, arguments);
                            var o = parent1.parseToObject(beValue);
                            if (o) {
                                $input.val(o.title);
                                $input.attr("data-value", beValue);
                            }
                            if (parent1.popup == null || parent1.popup.isDestroyed()) {
                                parent1.popup = PlaySQL.Popup.createAutocomplete("playsql-autocomplete-user-or-group", spreadsheet.$placeholder,
                                    function (query, list, callback) {
                                        $.ajax({
                                            url: PlaySQL.SPI.baseUrlOld("misc", "user-or-group", {
                                                q: query
                                            }),
                                            success: function (data) {
                                                for (var i = 0 ; i < data.length ; i++) {
                                                    var item = data[i];
                                                    list.push({
                                                        text: item.label,
                                                        html: Confluence.Templates.PlaySQL.autocompleteUserOrGroup({item: item}),
                                                        id: item.type == "user"
                                                            ? item.name + ";user;" + item.id + ";" + item.label
                                                            : item.id + ";group"
                                                    });
                                                }
                                                list.dedupe(function(item) {return item.id;}, function(a, b) {
                                                    // Sort by title, but with the current space as first
                                                    a = a && a.text;
                                                    b = b && b.text;
                                                    return a < b ? -1 : a > b ? 1 : 0;
                                                });
                                                callback(true);
                                            },
                                            error: function (jqXHR) {
                                                $("#aui-flag-container").empty();
                                                AJS.flag({
                                                    type: 'error',
                                                    title: 'Autocompletion for users or groups',
                                                    close: "manual",
                                                    body: "Can't retrieve page titles: " + PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                                });
                                                callback(false);
                                            }
                                        });
                                    }, {
                                        defaultPosition: "closed"
                                    });
                            }
                            parent1.popup.attach("input", $input, "closest(td, .playsql-form-field)", function(selectedId){
                                event.preventDefault();
                                var selectedObject = parent1.popup.findItem(selectedId);
                                if (!selectedObject) return false;
                                $input.val(selectedObject.text);
                                $input.attr("data-value", selectedId);
                                return false;
                            });
                            return $input;
                        },
                        getInputBoxValue: function() {
                            var $input = $cell.find("input");
                            if (!$.trim($input.val())) {
                                return null;
                            } else {
                                return $input.attr("data-value");
                            }
                        }
                    });
                }
            });
            return parent1;
        };
        api.register(new UserRenderer());
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-fk.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        var wizards = {
            step1: function($placeholder, spreadsheet, column) {
                // Objective of step1: Check whether we swap columns or not.
                // Swapping means we'll move the text of the origin column to the target table, and put IDs instead.
                $placeholder.find(".fkwiz-1").removeClass("hidden");
                function nextWizard(doSwap) {
                    $placeholder.find(".fkwiz-1").remove();
                    // window.setTimeout(function() {
                    //     $("#inline-dialog-col-properties").attr("open", true);
                    // }, 0);
                    wizards.step2($placeholder, spreadsheet, column, doSwap);
                }
                $placeholder.on("click", ".fkwiz-1-swap", function(e) {
                    nextWizard(true);
                }).on("click", ".fkwiz-1-dont-swap", function(e) {
                    nextWizard(false);
                });
            },
            step2: function($placeholder, spreadsheet, column, doSwap){
                // Objective of step2: Determine the target table
                wizards.getSpreadsheets(spreadsheet, function(spreadsheets){
                    //$("#inline-dialog-col-properties").attr("open", true);
                    $placeholder.find(".fkwiz-2").removeClass("hidden");
                    var $fkDropDown = $placeholder.find("#fk-table-name").auiSelect2({
                        multiple: false,
                        placeholder: "Choose or create a table...",
                        formatResult: function (s) {
                            return "<span class=\"fk-table-name result-title\">" + AJS.escapeHtml(s.label) + "</span>" +
                                "<br><span class=\"result-description\">" +
                                AJS.escapeHtml(s.action == "CREATE" ? "Create a table" : "Use table") +
                                "</span>";
                        },
                        formatSelection: function (s) {
                            return s.label ? AJS.escapeHtml(s.label) : "<span class=\"not-a-value\">Null</span>";
                        },
                        escapeMarkup: function (m) {
                            return m;
                        },
                        formatNoMatches: function (term) {
                            return "Keep typing...";
                        },
                        query: function (query) {
                            var term = query.term,
                                results = [];
                            for (var i=0 ; i < spreadsheets.length ; i++) {
                                var position = spreadsheets[i].label.toLowerCase().indexOf(term.toLowerCase());
                                if (position > 0 && results.length > 0) {
                                    results.splice(1, 0, spreadsheets[i]);
                                } else if (position != -1) {
                                    results.splice(0, 0, spreadsheets[i]);
                                } else if (spreadsheets[i].id.toLowerCase().indexOf(term.toLowerCase()) != -1) {
                                    results.push(spreadsheets[i]);
                                }
                            }
                            if (query.term.length > 2) {
                                results.splice(0, 0, {
                                    id: "CREATE#" + window.PlaySQL.Helpers.generateKey(query.term, spreadsheet.defaultCase || "LOWER") + '#' + query.term,
                                    label: query.term,
                                    action: "CREATE"
                                });
                            }
                            query.callback({results: results});
                        }
                    });

                    $fkDropDown.change(function() {
                        var targetSpreadsheetKey;
                        var targetSpreadsheetLabel;
                        var data = $(this).auiSelect2("data");
                        if (!data || !data.id) return;
                        $(".fkwiz-2").remove();
                        $(".fkwiz-spinner").removeClass("hidden");
                        if (data.id.indexOf("CREATE#") == 0) {
                            // CREATE is when the target table doesn't exist
                            var typeAndKeyAndLabel = data.id.split("#");
                            targetSpreadsheetKey = typeAndKeyAndLabel[1];
                            targetSpreadsheetLabel = typeAndKeyAndLabel[2];
                            wizards.step3(spreadsheet, column, doSwap, "CREATE", targetSpreadsheetKey, targetSpreadsheetLabel);
                        } else {
                            targetSpreadsheetKey = data.id;
                            targetSpreadsheetLabel = data.label;
                            wizards.step3(spreadsheet, column, doSwap, "EXISTING", targetSpreadsheetKey, targetSpreadsheetLabel);
                        }
                    });
                    /* Seems unnecessary, after we've removed the wrong rule from the spreadsheet-macro.css
                    $fkDropDown.on("select2-open", function(){
                        $(".select2-drop").css("z-index", "9999");
                    });*/
                    $fkDropDown.focus();
                });
            },

            step3: function(spreadsheet, column, doSwap, targetType, targetSpreadsheetKey, targetSpreadsheetLabel) {
                // In step3, we choose the display column
                $(".fkwiz-spinner").addClass("hidden");
                $(".fkwiz-3").removeClass("hidden");
                if (targetType == "EXISTING") {
                    $("#fk-display-column").auiSelect2({
                        multiple: false,
                        placeholder: "Choose a column...",
                        formatResult: function (s) {
                            var description = "";
                            if (s.action == "CREATE") {
                                description = "Create column";
                            } else if (s.disabled) {
                                description = "Unavailable - Types don't match";
                            } else {
                                description = "Display this column (" + AJS.escapeHtml(s.id) + ")";
                            }
                            return "<span class=\"result-title\">" + AJS.escapeHtml(s.label) + "</span>" +
                                "<br><span class=\"result-description\">" + description + "</span>";
                        },
                        formatSelection: function (s) {
                            return s.label ? AJS.escapeHtml(s.label) : "<span class=\"not-a-value\">Null</span>";
                        },
                        escapeMarkup: function (m) {
                            return m;
                        },
                        formatNoMatches: function (term) {
                            return "Keep typing...";
                        },
                        query: function (query) {
                            var term = query.term,
                                results = [];
                            if (query.term.length > 2) {
                                results.push({
                                    id: "CREATE#" + window.PlaySQL.Helpers.generateKey(query.term, spreadsheet.defaultCase || "LOWER") + '#' + query.term,
                                    label: query.term,
                                    action: "CREATE"
                                });
                            }
                            wizards.getTargetSpreadsheetDDL(spreadsheet, column, targetSpreadsheetKey, function(targetSpreadsheetDDL) {
                                for (var i = 0 ; i < targetSpreadsheetDDL.columns.length ; i++) {
                                    var targetColumnCandidate = targetSpreadsheetDDL.columns[i];
                                    if (targetColumnCandidate.statusPK || targetColumnCandidate.statusPosition) {
                                        continue;
                                    }
                                    var isMatching = targetColumnCandidate.label.toLowerCase().indexOf(term.toLowerCase()) != -1
                                                  || targetColumnCandidate.name.toLowerCase().indexOf(term.toLowerCase()) != -1;
                                    if (isMatching) {
                                        results.push({
                                            id: targetColumnCandidate.name,
                                            label: targetColumnCandidate.label,
                                            disabled : doSwap && column.type != targetColumnCandidate.type
                                        });
                                    }
                                }
                                query.callback({results: results});
                            });
                        }
                    }).change(function(){
                        var selectedColumn = $(this).auiSelect2("data");
                        if (!selectedColumn || !selectedColumn.id) {
                            AJS.log("No column selected.");
                            return;
                        }
                        var targetColumnType = "EXISTING";
                        var targetDisplayColumnKey = selectedColumn.id;
                        var targetDisplayColumnLabel = selectedColumn.label;
                        if (targetDisplayColumnKey.indexOf("CREATE#") == 0) {
                            targetColumnType = "CREATE";
                            targetDisplayColumnKey = targetDisplayColumnKey.substr("CREATE#".length);
                            targetDisplayColumnLabel = targetDisplayColumnKey.substr(targetDisplayColumnKey.indexOf("#") + 1);
                            targetDisplayColumnKey = targetDisplayColumnKey.substr(0, targetDisplayColumnKey.indexOf("#"));
                        }
                        $(".fkwiz-3").remove();
                        wizards.step4(spreadsheet, column, doSwap, targetType, targetSpreadsheetKey, targetSpreadsheetLabel, targetColumnType, targetDisplayColumnKey, targetDisplayColumnLabel);
                        // wizards.step4(spreadsheet, column, doSwap, isGhost);
                    /*}).on("select2-open", function() {
                        $(".select2-drop").css("z-index", 9999);*/
                    }).focus();
                } else {
                    // When we create a target table, the user just has to choose a label for the column
                    $("#inline-dialog-col-properties form").submit(submitForm);
                    $(".btn-submit").click(submitForm);
                    function submitForm(e) {
                        e.preventDefault();
                        var targetDisplayColumnLabel = $("#fk-display-column").val();
                        var targetDisplayColumnKey = window.PlaySQL.Helpers.generateKey(targetDisplayColumnLabel, spreadsheet.defaultCase || "LOWER");
                        $(".fkwiz-3").remove();
                        wizards.step4(spreadsheet, column, doSwap, targetType, targetSpreadsheetKey, targetSpreadsheetLabel, "CREATE", targetDisplayColumnKey, targetDisplayColumnLabel);
                        return false;
                    }
                }
            },
            step4: function(spreadsheet, column, doSwap,
                            targetType, targetSpreadsheetKey, targetSpreadsheetLabel,
                            targetColumnType, targetDisplayColumnKey, targetDisplayColumnLabel) {
                // Well, we've got all the data. Just need to send them to the server and relaunch.
                $(".fkwiz-spinner").removeClass("hidden").find("#spinner-text").text(" Creating the foreign key...");
                $("#inline-dialog-col-properties-submit-panel a").remove();
                $.ajax({
                    url: PlaySQL.SPI.baseUrl(spreadsheet.context, spreadsheet.id, 'fk', 'cols', column.name),
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        swap: doSwap,
                        withSQLConstraint: true, // If created through the UI, it always has both the SQL constraint and the UI
                        withUI: true,
                        create: targetType == "CREATE",
                        targetTableKey: targetSpreadsheetKey,
                        targetTableLabel: targetSpreadsheetLabel,
                        createColumn: targetColumnType == "CREATE",
                        targetDisplayColumnKey: targetDisplayColumnKey,
                        targetDisplayColumnLabel: targetDisplayColumnLabel
                    }),
                    dataType: "json"
                }).done(function (data) {
                    spreadsheet.inlinedialog.close();
                    spreadsheet.load();
                }).fail(function(jqXHR) {
                    var message = PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300);
                    $("#inline-dialog-col-properties .error").last().text(message);
                });
            },
            getSpreadsheets: function(spreadsheet, callback) {
                var thisFunction = this.getSpreadsheets;
                if (thisFunction.cache != null) {
                    callback && callback(thisFunction.cache);
                } else {
                    $.ajax({
                        url: PlaySQL.SPI.baseUrl(spreadsheet.context),
                        type: 'GET',
                        dataType: "json"
                    }).success(function (data) {
                        var spreadsheets = [];
                        for (var i = 0; i < data.length; i++) {
                            if (data[i][2] == 'SPREADSHEET') {
                                spreadsheets.push({
                                    id: data[i][0],
                                    label: data[i][1],
                                    action: "EXISTING"
                                });
                            }
                        }
                        thisFunction.cache = spreadsheets;
                        callback && callback(thisFunction.cache);
                    }).fail(function (jqXHR) {
                        AJS.flag({
                            type: 'error',
                            title: "Can't fetch the list of spreadsheets for " + spreadsheet.context,
                            body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                        });
                    });
                }
            },
            getTargetSpreadsheetDDL: function getTargetSpreadsheetDDL(spreadsheet, column, targetSpreadsheetKey, callback) {
                var thisFunction = checkNotNull(this.getTargetSpreadsheetDDL);
                thisFunction.cache = thisFunction.cache || {};
                if (thisFunction.cache[targetSpreadsheetKey]) {
                    return callback(thisFunction.cache[targetSpreadsheetKey]);
                }
                $.ajax({
                    url: PlaySQL.SPI.baseUrl(spreadsheet.context, targetSpreadsheetKey),
                    type: 'GET',
                    dataType: "json",
                    contentType: "application/json"
                }).done(function (data) {
                    thisFunction.cache[targetSpreadsheetKey] = data.tableDef;
                    callback && callback(data.tableDef);
                }).fail(function(jqXHR) {
                    AJS.flag({
                        type: 'error',
                        title: 'Error getting the table definition of the spreadsheet ' + targetSpreadsheetKey,
                        body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                    });
                });
            },
            removeForeignKey: function removeForeignKey(spreadsheet, column, justRemoveRenderer) {
                if (justRemoveRenderer) {
                    if (confirm("Do you want to remove the FK renderer? No data will be deleted, the link will remain but the ID will be displayed instead of the value.")) {
                        $.ajax({
                            url: PlaySQL.SPI.baseUrl(spreadsheet.context, spreadsheet.id, 'fk', 'cols', column.name),
                            type: 'POST',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify({
                                create: false,
                                createColumn: false,
                                withSQLConstraint: true,
                                withUI: false,
                                targetTableKey: column.fk.targetTable,
                                targetTableLabel: null,
                                targetDisplayColumnKey: null,
                                targetDisplayColumnLabel: null
                            }),
                            dataType: "json"
                        }).done(function (data) {
                            spreadsheet.inlinedialog.close();
                            spreadsheet.load();
                        }).fail(function (jqXHR) {
                            AJS.flag({
                                type: 'error',
                                title: "Error trying to display the original values of the foreign key",
                                body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                            });
                        });
                    }
                } else if (confirm("Do you want to remove the foreign key between '" + spreadsheet.label + "' and '" + column.fk.targetTable + "'? No data will be deleted, but the link will be removed. You will see the IDs instead of their values and the user is free to enter any new value. You can recreate the FK later.")) {
                    $.ajax({
                        url: PlaySQL.SPI.baseUrl(spreadsheet.context, spreadsheet.id, 'fk', 'cols', column.name),
                        type: 'DELETE',
                        dataType: "json"
                    }).done(function (data) {
                        spreadsheet.inlinedialog.close();
                        spreadsheet.load();
                    }).fail(function (jqXHR) {
                        var message = PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300);
                        $("#inline-dialog-col-properties .error").last().text(message);
                    });
                }
            }
        };

        var FKRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();

            return $.extend({}, base, {
                key: "foreign-key",
                getI18nName : function() {
                    return "Foreign Key"
                },
                isSupportedType : function(type) {
                    // We pretend that we support any type, because the wizard can move this column
                    // into another table
                    return true;
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    // This method is actually never called, because all fks have a viewRenderer
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    return AJS.escapeHtml(value);
                },
                buildLink: function(spreadsheet, column, value) {
                    if (typeof value != "undefined") {
                        var fkMetadata = checkNotNull(column.fk, "column.fk in buildLink()");
                        return PlaySQL.SPI.getRoute("form", spreadsheet.context, fkMetadata.targetTable, 0, value, spreadsheet.breadcrumbs);
                    } else {
                        return "#";
                    }
                },
                createInputBox : function(beValue, feValue) {
                    throw "IllegalStateException";
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = this;
                    var result = base.forCell.apply(this, arguments);
                    return $.extend(result, {
                        createInputBox : function(beValue, feValue) {
                            var dropDown = document.createElement("input");
                            dropDown.setAttribute("class", "fk-renderer-input");
                            var column = spreadsheet.colOf($cell);
                            window.setTimeout(function(){
                                function getFkValues(searchQuery, callback, failureCallback) {
                                    // The cache only exists if we're sure the value is in it.
                                    if (column.fkCacheForValues && typeof searchQuery == "string" && searchQuery.indexOf(column.fkCachedQuery) != -1) {
                                        searchQuery = searchQuery.toLowerCase();
                                        var results = column.fkCacheForValues.filter(function(e) {
                                            return e.searchField && e.searchField.toLowerCase().indexOf(searchQuery) != -1
                                                || e.id != null && e.id.indexOf(searchQuery) != -1;
                                        });
                                        callback(results);
                                    } else {
                                        $.ajax({
                                            url: PlaySQL.SPI.baseUrl(spreadsheet.context, column.fk.targetTable, 'fk', 'search', {
                                                q: searchQuery,
                                                displayField: column.fk.displayField ? column.fk.displayField : "",
                                                searchField: column.fk.searchField ? column.fk.searchField : "",
                                                pkField: column.fk.targetPK,
                                                limit: 50
                                            }),
                                            type: 'GET',
                                            dataType: "json"
                                        }).done(function (data) {
                                            var results = data.data.map(function (e) {
                                                return {
                                                    id: e[0][0],
                                                    // The advantage of returning the search field is, it's supposed to be
                                                    // a straight String and not rendered by the display field's renderer.
                                                    label: e.length >= 4 ? e[3][0] : e[2][0],
                                                    searchField: e.length >= 4 ? e[3][0] : null
                                                };
                                            });
                                            // Only cache if we have all results
                                            if (data.pagination.count <= results.length) {
                                                column.fkCachedQuery = searchQuery;
                                                column.fkCacheForValues = results;
                                            }
                                            results.unshift({ // Always add as the first value the NULL value
                                                id: null,
                                                label: '',
                                                searchField: '(null) ' // The space is important, so the user can search with a space for the null value
                                            });
                                            callback(results);
                                        }).error(function (jqXHR) {
                                            failureCallback("Can't fetch the results for '" + searchQuery + "'");
                                        });
                                    }
                                }
                                var $input = $cell.find(".fk-renderer-input");

                                $input
                                    .off(".playsql-autocommit")
                                    .val(beValue)
                                    .auiSelect2({
                                        multiple: false,
                                        placeholder: "",
                                        formatResult: function(s) {
                                            if (s.id == null) {
                                                return "<span class=\"not-a-value\">(No value)</span>";
                                            }
                                            return AJS.escapeHtml(s.id + " - " + (s != undefined ? s.label : "(Null)"));
                                        },
                                        formatSelection: function(s) {
                                            return s.label != undefined ? AJS.escapeHtml(s.id + " - " + (s.label != undefined ? s.label : "(Null)")) : "<span class=\"not-a-value\">Null</span>";
                                        },
                                        formatNoMatches: function(s) {
                                            return AJS.escapeHtml("No matches for " + s);
                                        },
                                        escapeMarkup: function(m) { return m; },
                                        initSelection: function ($input, callback) {
                                            // Keep the list of assumed values,
                                            // then before saving, check them all in the backend.
                                            var column = checkNotNull(spreadsheet.colOf($cell));
                                            if (!column.fkCacheForAssumedValues) {
                                                column.fkCacheForAssumedValues = [];
                                                column.fkPipeForAssumedValues = []; // Associative array, to avoid duplicates
                                            }
                                            if (column.fkCacheForAssumedValues[beValue]) {
                                                callback(column.fkCacheForAssumedValues[beValue]);
                                            } else if (column.fkCacheForAssumedValues[feValue]) {
                                                callback(column.fkCacheForAssumedValues[feValue]);
                                            } else {
                                                column.fkPipeForAssumedValues[beValue] = true;
                                                if (beValue != feValue && feValue)
                                                    column.fkPipeForAssumedValues[feValue] = true;
                                                callback({id: beValue, label: feValue || beValue, type: 'ASSUMED' })
                                            }

                                            window.setTimeout(function(){
                                                var listOfTerms = Object.keys(column.fkPipeForAssumedValues);
                                                if (listOfTerms.length > 0) {
                                                    column.fkPipeForAssumedValues = [];
                                                    getFkValues(listOfTerms, function(results){
                                                        // Add all returned values to the cache
                                                        for (var i = 0 ; i < results.length ; i++) {
                                                            var value = results[i];
                                                            if (value.id) {
                                                                column.fkCacheForAssumedValues[value.id] = value;
                                                                // We only override labels if there isn't an ID with this name already
                                                                if (!column.fkCacheForAssumedValues[value.label])
                                                                    column.fkCacheForAssumedValues[value.label] = value;
                                                            }
                                                        }
                                                    }, function(jqXHR){
                                                        AJS.flag({
                                                            title: "Error getting the values for the foreign key on column" + column.label,
                                                            type: 'error',
                                                            body: AJS.escapeHtml(PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300))
                                                        });
                                                    });
                                                }
                                            }, 500);
                                        },
                                        query: function(query) {
                                            var term = query.term;
                                            var results = [{ // Just add the null value by default
                                                id: null,
                                                label: '',
                                                searchField: '(null) ' // The space is important, in case people search for empty using a space
                                            }];
                                            query.callback({results: results});
                                            getFkValues(term, function(results){
                                                query.callback({results: results});
                                            }, function(error){
                                                query.callback({results: [{
                                                    id: "Error",
                                                    disabled: "true",
                                                    label: error
                                                }]});
                                            });
                                        }
                                    }).change(function(){
                                        result.saveAndView();
                                        spreadsheet.sprayRequestPipe();
                                    }).on("select2-open", function() {
                                        // Select2 adds a curtain on the whole page, with fixed ids
                                        $(".select2-drop .select2-input").on("keydown keypress", function(e) {
                                            var keyCombinationDetail = PlaySQL.Helpers.getKeyCombinationDetail(e);
                                            if (keyCombinationDetail != null && keyCombinationDetail.onKeyDown ^ e.type != "keydown") {
                                                var handler = null;
                                                if (keyCombinationDetail.canonical == "left" || keyCombinationDetail.canonical == "shift+tab") {
                                                    handler = "moveLeft";
                                                } else if (keyCombinationDetail.canonical == "right" || keyCombinationDetail.canonical == "tab") {
                                                    handler = "moveRight";
                                                }
                                                if (handler) {
                                                    // We need to ensure the cell has the class editing, because it ensures the next cell will
                                                    // be selected in edit mode.
                                                    // It happens that when we're editing a cell and we press TAB, the focus is lost first, which
                                                    // autocommits the cell, which removes the editing state. It doesn't happen with the right/left arrows.
                                                    var editingClassWasAdded = false;
                                                    if (!$cell.hasClass("editing")) {
                                                        editingClassWasAdded = true;
                                                        $cell.addClass("editing");
                                                    }
                                                    PlaySQL.Selection.forTable(spreadsheet.$placeholder).callHandler(handler, e);
                                                    $(".select2-drop").remove();
                                                    e.preventDefault();
                                                    e.stopPropagation();
                                                    if (editingClassWasAdded) {
                                                        $cell.removeClass("editing");
                                                    }
                                                }
                                            }
                                        });
                                    });
                                /* Seems unnecessary, after we've removed the wrong rule from the spreadsheet-macro.css
                                $input.on("select2-open", function(){
                                    $(".select2-drop").css("z-index", "9999"); // I don't know why, but select2-drop-mask is z-index 9998
                                });*/
                                if ($input.attr("data-playsql-auiselect2-focus") == "true") {
                                    $input.auiSelect2("open");
                                    $input.attr("data-playsql-auiselect2-focus", "false");
                                }
                                $input.attr("data-playsql-auiselect2-transformed", "true");
                            }, 0);
                            return $(dropDown);
                        },
                        /**
                         * Sets the focus on whatever HTML widget is central to this cell.
                         *
                         * No effect if the cell isn't in 'editing'.
                         *
                         * Beware to call this method on a 'click', not on a 'mousedown',
                         * because the 'click' event after a 'mousedown' resets the focus to the
                         * clicked element.
                         *
                         * @param muteDropdown Default false / undefined. Set to 'true' if you explicitly don't want
                         *                     any dropdown to show, for example if it's a foreign key and you've
                         *                     just pasted some content.
                         */
                        focus: function(withCaret, selEnd, muteDropdown) {
                            if ($cell.hasClass("editing") && !spreadsheet.disableFocusManagement) {
                                if (muteDropdown != true) {
                                    var $input = checkNotNull($cell.find("input.fk-renderer-input"));
                                    if ($input.attr("data-playsql-auiselect2-transformed") == "true") {
                                        $input.auiSelect2("open");
                                    } else {
                                        $input.attr("data-playsql-auiselect2-focus", "true")
                                    }
                                }
                            }
                        },
                        getInputBoxValue: function(){
                            var column = spreadsheet.colOf($cell);
                            var data = $cell.find(".fk-renderer-input").auiSelect2('data');
                            var val = data ? data.id : undefined;
                            if (data && data.type == 'ASSUMED') {
                                // Before saving, we need to replace the label with its ID.
                                var correspondingValue = column.fkCacheForAssumedValues && column.fkCacheForAssumedValues[val];
                                if (correspondingValue) {
                                    val = correspondingValue.id;
                                } else if (!val) { // if val is empty string or null, assume it's null
                                    return null;
                                } else {
                                    AJS.error("The value " + JSON.stringify(data) + " doesn't have a corresponding ID in the foreign key. The FK constraint may cause an exception when saving.");
                                }
                            }
                            if (val === null) {
                                return val;
                            }
                            try {
                                if (["INTEGER", "BIG_INTEGER", "NUMERIC", "DOUBLE"].indexOf(column.type) != -1) {
                                    return parseInt(val);
                                } else {
                                    return val;
                                }
                            } catch (err) {
                                alert("It is not possible to transform " + val + " into " + column.type);
                                throw "It is not possible to transform " + val + " into " + column.type;
                            }
                        }

                    });
                },
                onClickQuickRenderer: function(spreadsheet, column) {
                    // Config panel:
                    // - The target table
                    // - The display field
                    // - The search field
                    // - Cascade options
                    if (column.fk) {
                        // Actually, the button is 'active' and the user is trying to *remove* the fk
                        wizards.removeForeignKey(spreadsheet, column);
                    } else {
                        var $placeholder = $(".aui-inline-dialog-contents > .content .advanced-properties");
                        $placeholder.html(Confluence.Templates.PlaySQL.foreignKeyWizard({}));
                        $(".aui-inline-dialog-contents > content .aui-toolbar2, .aui-inline-dialog-contents.contents .btn-submmit").remove();
                        // window.setTimeout(function() {
                        //     $("#inline-dialog-col-properties").attr("open", true);
                        // }, 0);
                        if (["NUMERIC", "DOUBLE", "INTEGER", "BIG_INTEGER"].indexOf(column.type) != -1) {
                            wizards.step1($placeholder, spreadsheet, column);
                            // Preload the spreadsheets
                            wizards.getSpreadsheets(spreadsheet);
                        } else {
                            wizards.step2($placeholder, spreadsheet, column, true);
                        }
                    }
                    return true;
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments);
                    $div.find("aui-button[data-quick-renderer=foreign-key]").click(function(e){
                        e.preventDefault();
                        return false;
                    });
                    $div.find(".fk-remove").click(function(e) {
                        e.preventDefault();
                        wizards.removeForeignKey(spreadsheet, column);
                        return false;
                    });
                    $div.find(".fk-remove-renderer").click(function(e) {
                        wizards.removeForeignKey(spreadsheet, column, true);
                    });
                    $div.find(".display-another-column").click(function(e){
                        // We display the wizard again that allows selecting a new column.
                        // TODO Is that what I wanted ?
                        $(".aui-inline-dialog-contents.contents .advanced-properties").html(Confluence.Templates.PlaySQL.foreignKeyWizard({}));
                        $(".aui-inline-dialog-contents.contents .aui-toolbar2, .aui-inline-dialog-contents.contents .btn-submmit").remove();
                        wizards.step3(spreadsheet, column, true, "EXISTING", column.fk.targetTable, null);
                    });
                    return result;
                }
            });
        };
        api.register(new FKRenderer());
        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-image.js' */
(function($) {
    AJS.bind("playsql-spreadsheet-init", function(event, api) {
        var ImageRenderer = function () {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "image",
                getI18nName: function () {
                    return "Image"
                },
                isSupportedType: function (type) {
                    return "BYTEA" === type || "BINARY" === type || "BLOB" === type || "VARBINARY" === type;
                },
                getDefaultType: function () {
                    return "BYTEA";
                },
                isSystemRenderer: function () {
                    return false;
                },
                createInputBox: function (value) {
                    var $input;
                    if (!spreadsheet.canEditImage)
                        return;
                    $input = $("<input type =\"file\" accept = \".jpg, .jpeg, .png, .gif\">");
                    return $input;
                },
                onColumnDisplay : function(spreadsheet, column){
                    spreadsheet.$placeholder.off("click.imageViewerTrigger").on("click.imageViewerTrigger", "td > a.playsql-imageviewer-cell", function(event){
                        var maxRow = $(this).parent().parent().parent().children().size();
                        var tdIndex = $(this).parent().index() - 1;
                        if (!event.ctrlKey && !event.metaKey && event.which == 1 /* left button */) {
                            event.preventDefault();
                            event.stopPropagation();
                            $("body").append(Confluence.Templates.PlaySQL.imageViewer);
                            $('body').on("keydown.imageViewer", clickHandler);
                            $('#playsql-imageviewer').on('click', function(e) {
                                if (e.target !== this)
                                    return;
                                exit();
                            });
                            $('#playsql-imageviewer .nav.exit').on('click', exit);
                            $('#playsql-imageviewer-image').append(outerHtml($("<img>", {
                                "src": $('.focused').attr('data-value')
                            })));
                            $('#playsql-imageviewer .nav.previous').on("click", function(){
                                nextImage(false, maxRow, tdIndex);
                            });
                            $('#playsql-imageviewer .nav.next').on("click", function(){
                                nextImage(true, maxRow, tdIndex);
                            });
                        }
                    })
                },
                renderCellContents: function (value, spreadsheet, column, forForm) {
                    var width,
                        height;
                    if (value === null || value === undefined || value === "") {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    } else {
                        if (forForm) {
                            width = column.formats.columnWidthForm || column.formats.columnWidth || 64;
                            height = column.formats.columnHeightForm || column.formats.columnHeight || 64;
                        } else {
                            width = column.formats.columnWidth || 64;
                            height = column.formats.columnHeight || 64;
                        }
                        var url = value.concat("?") + $.param({width: width, height: height});
                        return Confluence.Templates.PlaySQL.imageViewerCell({
                            urlToImage: value,
                            urlToSrc: url,
                            maxWidth: width,
                            maxHeight: height
                        });

                    }
                },
                forCell: function (spreadsheet, $cell)  {
                    var parent = base.forCell.apply(this, arguments);
                    var readerErr = function (err) {
                        AJS.flag({
                            type: 'error',
                            title: "Error while reading the image",
                            body : AJS.escapeHtml(err.target.error || err)
                        })
                    };
                    return $.extend({}, parent, {
                        focus: function (withCaret) {

                        },
                        edit: function (setValue) {
                            var width;
                            var height;
                            var column = spreadsheet.colOf($cell);
                            var columnName = column.name;
                            var rowId = spreadsheet.getCell($cell).rowId;
                            $cell.addClass("editing");
                            $cell.attr('data-rendered', $cell.html());
                            width = spreadsheet.colOf($cell).formats.columnWidth || 64;
                            height = spreadsheet.colOf($cell).formats.columnHeight || 64;

                            if (setValue === undefined || rowId == null) { // rowId is null when creating a record
                                if (!spreadsheet.canEditImage)
                                    return;
                                var $input = $("<input type =\"file\" title=\"Press ESC to cancel edition\" accept = \".jpg, .jpeg, .png, .gif\">");
                                $input.appendTo($cell);
                                $input.change(function () {
                                    var reader = new FileReader();
                                    var urlToImage = PlaySQL.SPI.baseUrl(spreadsheet.context, spreadsheet.id, 'binarydata', columnName, rowId);
                                    reader.onload = function () {
                                        var base64 = reader.result;
                                        $.ajax({
                                            url: urlToImage,
                                            type: 'PUT',
                                            data: base64,
                                            success: function () {
                                                $cell.attr("data-rendered", $cell.html());
                                                $cell.html(Confluence.Templates.PlaySQL.imageViewerCell({
                                                    urlToImage: urlToImage,
                                                    urlToSrc: base64,
                                                    maxWidth: width,
                                                    maxHeight: height
                                                }));
                                                $cell.attr('data-fe-value', urlToImage);
                                                $cell.attr('data-value', urlToImage);
                                                base.onColumnDisplay(spreadsheet, column);
                                            }
                                        }).fail(function (jqXHR) {
                                            AJS.flag({
                                                type: 'error',
                                                title: "Error couldn't upload the image from the disk",
                                                body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                            });
                                        });
                                        $cell.removeClass("editing");
                                    };
                                    reader.onerror = readerErr;
                                    reader.readAsDataURL($input.get(0).files[0]);
                                    rowId = spreadsheet.getCell($cell).rowId;
                                })
                            } else {
                                // If the url is of the form /spreadsheets/{context}/{tablename}/binarydata/{columnName}/{pkvalue} ,
                                // then we don't download the image but we ask ImageResource to copy it over.
                                var urlToImage = PlaySQL.SPI.baseUrl(spreadsheet.context, spreadsheet.id, 'binarydata', columnName, rowId);
                                var regex = /\/spreadsheets\/([a-zA-Z0-9_:-]+)\/([a-zA-Z0-9_:-]+)\/binarydata\/([a-zA-Z0-9_:-]+)\/([0-9]+)/;
                                var match = regex.exec(setValue);
                                if (match) {
                                    if (!spreadsheet.canEditImage)
                                        return;
                                    $.ajax({
                                        url: urlToImage + "?" + $.param({
                                            fromTable : match[2],
                                            fromColumn : match[3],
                                            fromRow : match[4]
                                        }),
                                        type: 'PUT',
                                        contentType: "application/json; charset=utf-8",
                                        cache: false
                                    }).success(function () {
                                        var imageSrc;
                                        $cell.attr('data-fe-value', urlToImage);
                                        $cell.attr('data-value', urlToImage);
                                        imageSrc = urlToImage + "?" + $.param({
                                                width: width,
                                                height: height,
                                                random: Math.floor(Math.random() * 3200)
                                                // The random value is to force the server call
                                            });
                                        $cell.html(Confluence.Templates.PlaySQL.imageViewerCell({
                                            urlToImage: urlToImage,
                                            urlToSrc: imageSrc,
                                            maxWidth: width,
                                            maxHeight: height
                                        }));
                                    }).fail(function (jqXHR) {
                                        AJS.flag({
                                            type: 'error',
                                            title: "Error couldn't upload the image from the spreadsheet",
                                            body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                        });
                                    });
                                    $cell.removeClass("editing");
                                    $cell.removeAttr("data-rendered");
                                } else if (setValue.indexOf("https:") === 0) {
                                    if (!spreadsheet.canEditImage)
                                        return;
                                    var xhr = new XMLHttpRequest();
                                    xhr.open('GET', setValue + (setValue.includes("?") ? "&" : "?") + new Date().getTime(), true);
                                    xhr.responseType = 'blob';
                                    xhr.onload = function (e) {
                                        if (this.status === 200) {
                                            var blob = this.response;
                                            var reader = new FileReader();
                                            reader.readAsDataURL(blob);
                                            reader.onload = function () {
                                                base64 = reader.result;
                                                $.ajax({
                                                    url: urlToImage,
                                                    type: 'PUT',
                                                    data: base64,
                                                    success: function () {
                                                        $cell.html(Confluence.Templates.PlaySQL.imageViewerCell({
                                                            urlToImage: urlToImage,
                                                            urlToSrc: base64,
                                                            maxWidth: width,
                                                            maxHeight: height
                                                        }));
                                                        $cell.attr('data-fe-value', urlToImage);
                                                        $cell.attr('data-value', urlToImage);
                                                        base.onColumnDisplay(spreadsheet, column);
                                                    }
                                                }).fail(function (jqXHR) {
                                                    AJS.flag({
                                                        type: 'error',
                                                        title: "Error couldn't upload the image from internet",
                                                        body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                                    });
                                                })
                                            };
                                            reader.onerror = readerErr;
                                        } else {
                                            readerErr("We couldn't reach the server");
                                        }
                                    };
                                    xhr.onerror = readerErr;
                                    xhr.send();
                                    $cell.removeClass("editing");
                                    $cell.removeAttr("data-rendered");
                                } else if (setValue.indexOf("data:") === 0) {
                                    $.ajax({
                                        url: urlToImage,
                                        type: 'PUT',
                                        data: setValue,
                                        success: function () {
                                            var $img,
                                                $a;
                                            $cell.attr('data-fe-value', urlToImage);
                                            $cell.attr('data-value', urlToImage);

                                            $cell.html(Confluence.Templates.PlaySQL.imageViewerCell({
                                                urlToImage: urlToImage,
                                                urlToSrc: soydata.VERY_UNSAFE.ordainSanitizedUri(setValue),
                                                maxWidth: parseInt(width),
                                                maxHeight: height
                                            }));
                                            base.onColumnDisplay(spreadsheet, column);
                                        }
                                    }).fail(function (jqXHR) {
                                        AJS.flag({
                                            type: 'error',
                                            title: "Error couldn't upload the image",
                                            body: PlaySQL.Helpers.extractMessageFromJqXHR(jqXHR, 300)
                                        });
                                    });
                                    $cell.removeAttr("data-rendered");
                                    $cell.removeClass("editing");
                                }
                            }
                        },
                        createInputBox: function (beValue, feValue) {
                            return $("<input type =\"file\" accept = \".jpg, .jpeg, .png, .gif\">");
                        },
                        validate: function (transformIfFormula) {

                        },
                        renderCell: function (value) {
                            if (value === null || value === undefined) {
                                return "<span class='not-a-value'>&nbsp;</span>";
                            } else {
                                return outerHtml($("<img/>", {
                                    "class": "aui-icon aui-icon-small aui-iconfont-remove",
                                    "src": 'data:image/png;base64,' + value
                                }));
                            }
                        },
                        parseValue: function (value) {

                        },
                        saveAndView: function (val) {
                            spreadsheet.saveCell($cell, val);
                        }
                    });
                },
                appendRendererDetailsTo: function (spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments);
                    var columnWidth = column.formats && column.formats["columnWidth"];
                    var columnHeight = column.formats && column.formats["columnHeight"];
                    var columnWidthForm = column.formats && column.formats["columnWidthForm"];
                    var columnHeightForm = column.formats && column.formats["columnHeightForm"];
                    $div.append(Confluence.Templates.PlaySQL.columnPropertiesImage({
                        columnWidth: columnWidth,
                        columnHeight: columnHeight,
                        columnWidthForm: columnWidthForm,
                        columnHeightForm: columnHeightForm
                    }));
                    return result;
                },
                getFormatValues: function ($form, column) {
                    var width = $form.find("#columnWidth").val();
                    var height = $form.find("#columnHeight").val();
                    var widthForm = $form.find("#columnWidthForm").val();
                    var heightForm = $form.find("#columnHeightForm").val();
                    return {
                        columnWidth: width,
                        columnHeight: height,
                        columnWidthForm: widthForm,
                        columnHeightForm: heightForm
                    }
                }
            });
        };
        api.register(new ImageRenderer());
        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }
        function clickHandler(event){
            var maxRow = $(".focused").parent().parent().children().size();
            var tdIndex = $('.focused').index() - 1;
            if ($('#playsql-imageviewer').length === 0)
                return;
            if (event.keyCode === 27) exit();
            else if (event.keyCode === 37) nextImage(false, maxRow, tdIndex);
            else if (event.keyCode === 39) nextImage(true, maxRow, tdIndex);
            else if (event.keyCode != 40 && event.keyCode != 38) {
                return; // perform the original action
            }
            // Since exit() or nextImage() was called, prevent default action
            event.preventDefault();
            event.stopPropagation();
        }
        function exit() {
            $('body').off(".imageViewer");
            $('#playsql-imageviewer').remove();
        }
        function nextImage(isNext, maxRow, tdIndex){
            var nextIndex = isNext ? 1 : -1;
            var rowIndex = $('.focused').parent().index() + nextIndex;
            if (isNext){
                if (rowIndex === maxRow)
                    rowIndex = 0;
            } else {
                if (rowIndex === -1)
                    rowIndex = maxRow - 1;
            }
            var $td = $('.focused').parent().parent().find('tr').eq(rowIndex).find('td').eq(tdIndex);
            $('.focused').removeClass("focused");
            $('.selected').removeClass("selected");
            $td.addClass("focused");
            $td.addClass("selected");
            $("#playsql-imageviewer-image").html($('<img>').attr("src", $('.focused').attr('data-value')));
        }
    })
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-column-properties.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        window.PlaySQL.Spreadsheet.ColumnToolbar = {
            autoCompleteFilterSQL: function(column, term, data){
                // SQL?
                if (/[a-z =<>]/.test(term)) {
                    if (/(AND|OR|\(|\))/g.test(term.toUpperCase())) {
                        data.addEntry({
                            label: term.toUpperCase(),
                            tip: "keyword",
                            type: "strict",
                            sql: " " + term.toUpperCase() + " "
                        });
                    } else if (/^(IS\s*|IS\s+NULL|NULL)$/.test(term.toUpperCase())) {
                        data.addEntry({
                            label: "IS NULL",
                            tip: "keyword",
                            sql: "$col IS NULL",
                            replaceColName: "$col"
                        });
                    } else {
                        // And always display the raw user's entry
                        if (/\$col\b/.test(term)) {
                            data.addEntry({
                                label: AJS.escapeHtml(term.replace(/\$col\b/g, column.name)),
                                tip: "sql",
                                sql: term,
                                replaceColName: "$col"
                            });
                        }
                        if (term.indexOf("=") == 0) {
                            if ($.trim(term) != "=") {
                                data.addEntry({
                                    label: AJS.escapeHtml("$col " + term),
                                    tip: "sql",
                                    sql: "$col " + term,
                                    replaceColName: "$col"
                                });
                            }
                        } else {
                            /* Don't suggest a sql literal. Rather improve the filter.
                             data.addEntry({
                             label: AJS.escapeHtml(term),
                             tip: "sql literal",
                             sql: term
                             });*/
                        }
                    }
                } else if (term.length == 0) {
                    data.addEntry({
                        label: "AND",
                        tip: "keyword",
                        type: "strict",
                        sql: " AND "
                    });
                    data.addEntry({
                        label: "OR",
                        tip: "keyword",
                        type: "strict",
                        sql: " OR "
                    });
                }
            },
            autocompleteFilterNumber: function(column, term, data){
                var charAt0 = /^[=<>]/.test(term) && term.charAt(0),
                    potentialNumber = charAt0 && term.substr(1) || term,
                    number = /[.,][0-9]/.test(potentialNumber) ? parseFloat(potentialNumber) : parseInt(potentialNumber);
                if (/[ -.]*[0-9].*-.*/.test(term)) { // Two numbers?
                    // Dodge the first minus, in the case of "-3.14--3.13"
                    var position = term.indexOf("-", 1),
                        exprA = term.substr(0, position),
                        exprB = term.substr(position + 1),
                        numberA = /[.,][0-9]/.test(exprA) ? parseFloat(exprA) : parseInt(exprA),
                        numberB = /[.,][0-9]/.test(exprB) ? parseFloat(exprB) : parseInt(exprB);
                    if (!isNaN(numberA)) {
                        if (isNaN(numberB)) {
                            numberB = numberA + 1;
                        }
                        data.addEntry({
                            label: numberA + "&ndash;" + numberB,
                            sql: "$col BETWEEN ? AND ?",
                            tip: "between",
                            replaceColName: "$col",
                            arguments: [numberA, numberB]
                        });
                    }
                } else if (!isNaN(number)) { // One number?
                    if (!charAt0 || charAt0 == "=")
                        data.addEntry({
                            label: "= " + number,
                            sql: "$col = ?",
                            tip: "equals",
                            replaceColName: "$col",
                            arguments: [number]
                        });

                    if (!charAt0 || charAt0 == ">")
                        data.addEntry({
                            label: "&gt; " + number,
                            sql: "$col > ?",
                            tip: "min",
                            replaceColName: "$col",
                            arguments: [number]
                        });

                    if (!charAt0 || charAt0 == "<")
                        data.addEntry({
                            label: "&lt; " + number,
                            sql: "$col < ?",
                            tip: "max",
                            replaceColName: "$col",
                            arguments: [number]
                        });
                    data.addEntry({
                        label: number + "&ndash;" + (number+1),
                        sql: "$col BETWEEN ? AND ?",
                        tip: "between",
                        replaceColName: "$col",
                        arguments: [number, number+1]
                    });
                } else {
                    if (!term || charAt0 == "=")
                        data.addEntry({
                            label: "= 10",
                            sql: "$col = 10",
                            tip: "equals"
                        });
                    if (!term || charAt0 == "<")
                        data.addEntry({
                            label: "< 10",
                            sql: "$col < 10",
                            replaceColName: "$col",
                            tip: "max"
                        });
                    if (!term || charAt0 == ">")
                        data.addEntry({
                            label: "> 10",
                            sql: "$col > 10",
                            replaceColName: "$col",
                            tip: "min"
                        });
                    if (!term)
                        data.addEntry({
                            label: "10&ndash;20",
                            sql: "$col between 10 and 20",
                            replaceColName: "$col",
                            tip: "range"
                        });
                }
            },
            autoCompleteFilterString: function(column, term, data){
                if ($.trim(term).length > 0) {
                    data.addEntry({
                        label: "= " + AJS.escapeHtml(term),
                        tip: "equals",
                        sql: "UPPER($col) = UPPER(?)",
                        replaceColName: "$col",
                        arguments: [term]
                    });
                    if (term.indexOf("%") != -1) {
                        data.addEntry({
                            label: "LIKE '" + AJS.escapeHtml(term) + "'",
                            sql: "$col LIKE ?",
                            tip: "sql",
                            replaceColName: "$col",
                            arguments: [term]
                        });
                    } else {
                        if (window.PlaySQL && window.PlaySQL.spreadsheet && window.PlaySQL.spreadsheet.dialect && PlaySQL.spreadsheet.dialect.indexOf("MySQL") != -1) {
                            // MySQL is a long story
                            data.addEntry({
                                label: "%" + AJS.escapeHtml(term) + "%",
                                tip: "contains",
                                sql: "$col LIKE CONCAT('%', ?, '%')",
                                replaceColName: "$col",
                                arguments: [term]
                            });
                        } else {
                            // General, normal, sane, non-crazytamèreputain case
                            data.addEntry({
                                label: "%" + AJS.escapeHtml(term) + "%",
                                tip: "contains",
                                sql: "$col LIKE ('%' || ? || '%')",
                                replaceColName: "$col",
                                arguments: [term]
                            });
                        }
                    }
                }
            },
            autoCompleteFilterDate: function(column, term, data){
                var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder(column.$placeholder);
                if (spreadsheet.dialect != 'com.playsql.jdbc.dialect.PostgreSQLDDLDialect') {
                    data.addEntry({
                        label: "Dates are only supported for Postgres",
                        tip: "information",
                        sql: "",
                        type: "strict"
                    });
                    return;
                }
                var operator = /^[<>=]/.test(term) && term.charAt(0),
                    potentialValue = operator && term.substr(1) || term,
                    date, yyyymmdd;

                if ($.trim(potentialValue).length > 0) {
                    date = new Date(potentialValue);
                    if (!date || isNaN(date.getTime())) {
                        date = new Date();
                    }
                } else {
                    date = new Date();
                }
                var yyyy = date.getFullYear().toString();
                var mm = (date.getMonth()+1).toString();
                var dd  = date.getDate().toString();
                yyyymmdd = yyyy + "-" + (mm[1]?mm:"0"+mm[0]) + "-" + (dd[1]?dd:"0"+dd[0]);
                if (!operator || operator == "<")
                    data.addEntry({
                        label: "< " + date.toDateString(),
                        tip: "max",
                        sql: "$col <= ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
                if (!operator || operator == ">")
                    data.addEntry({
                        label: "> " + date.toDateString(),
                        tip: "min",
                        sql: "$col >= ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
                if (!operator || operator == "=")
                    data.addEntry({
                        label: "= " + date.toDateString(),
                        tip: "equals",
                        sql: "$col = ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
            },
            autoCompleteFilterList: function(column, term, data, list){
                for (var i=0 ; i < list.length ; i++) {
                    var word = list[i];
                    if (word.indexOf(term) != -1) {
                        data.addEntry({
                            label: AJS.escapeHtml(word),
                            tip: "value",
                            sql: "$col = ?",
                            replaceColName: "$col",
                            arguments: [word]
                        });
                    }
                }
            },
            buildWhereClause : function (whereClause, whereClauseColumnFilters, dialect) {
                var whereClause2 = "";
                if (whereClauseColumnFilters) {
                    function quoteColumnName(dialect, columnName) {
                        if (!!columnName) {
                            if (!!dialect && dialect.indexOf("MySQL") != -1) {
                                return '`' + columnName + '`';
                            } else {
                                // Assuming Postgres behaviour
                                return '"' + columnName + '"';
                            }

                        }
                        return columnName;
                    }
                    for(var columnName in whereClauseColumnFilters) {
                        if (!whereClauseColumnFilters.hasOwnProperty(columnName)) continue;
                        var filters = whereClauseColumnFilters[columnName],
                            quotedColumnName = quoteColumnName(dialect, columnName),
                            columnSQL = "",
                        // if strict, the next operand won't try to insert a conjunction like OR/AND
                            strict = true,
                            multiple = false;
                        if (filters) {
                            if (filters.length > 1) multiple = true;
                            for (var i=0 ; i < filters.length ; i++) {
                                var detail = filters[i],
                                    sql = detail.sql;
                                if (detail.arguments) {
                                    for (var j=0 ; j < detail.arguments.length ; j++) {
                                        var value = detail.arguments[j];
                                        if (typeof value != "number") {
                                            value = "'" + window.PlaySQL.Helpers.escapeSqlString(value) + "'";
                                        }
                                        sql = sql.replace("?", value);
                                    }
                                }
                                if (detail.replaceColName) {
                                    sql = sql.replace(/\$col\b/g, quotedColumnName);
                                }
                                if (!strict && detail.type != "strict") {
                                    columnSQL += " OR ";
                                }
                                columnSQL += sql;
                                strict = detail.type == "strict";
                            }
                        }
                        // If there's at least one condition, append it to the whereClause2 with AND
                        if (columnSQL != "") {
                            if (multiple) {
                                whereClause2 += " AND (" + columnSQL + ")";
                            } else {
                                whereClause2 += " AND " + columnSQL;
                            }
                        }
                    }
                }
                if (whereClause && whereClause2.indexOf(" AND ") == 0) {
                    return "(" + whereClause + ")" + whereClause2;
                } else if (whereClause) {
                    return whereClause;
                } else {
                    return whereClause2.substr(4);
                }
            },
            create: function (spreadsheet, column, $header) {
                // Check if there's already an inline dialog for this column
                if (spreadsheet.inlinedialog) {
                    if (spreadsheet.inlinedialog.column == column) {
                        return spreadsheet.inlinedialog;
                    }
                }

                var orderbyClause = window.PlaySQL.Helpers.parseOrderByClause(spreadsheet.orderbyClause),
                    orderbyDef = {},
                    renderer = window.PlaySQL.Spreadsheet.renderers[column.renderer],
                    viewRenderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer];

                for (var i=0 ; i < orderbyClause.length ; i++) {
                    if (orderbyClause[i].field == '"' + column.name + '"') {
                        orderbyDef = orderbyClause[i];
                        break;
                    }
                }
                column.rendererName = renderer ? renderer.getI18nName() : "?";
                column.viewRendererName = viewRenderer ? viewRenderer.getI18nName() : "?";
                var inlineDialog2Id = "#inline-dialog-col-properties";
                var inlineDialog2 = {
                    show: function() {
                        $header.attr('data-aui-trigger');
                        $header.attr('aria-controls', 'inline-dialog-col-properties');
                        $(inlineDialog2Id).remove();
                        $('body').append(Confluence.Templates.PlaySQL.columnPropertiesInlineDialog({
                            column: column,
                            orderbyDef: orderbyDef,
                            hasColFEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_FE'),
                            hasColBEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_BE')
                        }));
                        var $content = $(inlineDialog2Id);
                        $content.find(".sort-none, .sort-desc, .sort-asc").click(function (e) {
                            e.preventDefault();
                            var $this = $(this),
                                way = $this.hasClass("sort-desc") ? "DESC"
                                    : $this.hasClass("sort-asc") ? "ASC"
                                        : "NO-SORTING",
                                nulls = orderbyDef.nulls;
                            spreadsheet.sortCol($header, way, nulls);
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                            return false;
                        });
                        $content.find(".nulls-default, .nulls-first, .nulls-last").click(function (e) {
                            e.preventDefault();
                            var $this = $(this),
                                way = orderbyDef.way,
                                nulls = $this.hasClass("nulls-default") ? undefined
                                    : $this.hasClass("nulls-first") ? "FIRST"
                                        : "LAST";
                            spreadsheet.sortCol($header, way, nulls);
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                            return false;
                        });
                        $content.on("click", ".btn-properties", function (e) {
                            e.preventDefault();
                            window.PlaySQL.Spreadsheet.ColumnToolbar.displayProperties(spreadsheet, column, inlineDialog2);
                        });/*
                         $content.on("click", ".btn-properties1", function (e) {
                         e.preventDefault();
                         spreadsheet.inlinedialog.close();
                         displayColProps(spreadsheet, $header);
                         });*/

                        var allFilterAutocompleteData = [],
                            initialValue = [];
                        // Initialize with the spreadsheet's values
                        if (spreadsheet.whereClauseColumnFilters && spreadsheet.whereClauseColumnFilters[column.name]) {
                            var filters = spreadsheet.whereClauseColumnFilters[column.name];
                            for (var i=0 ; i < filters.length ; i++) {
                                var filter = filters[i];
                                allFilterAutocompleteData.push(filter);
                                initialValue.push(i);
                            }
                        }

                        function formatResult(state) {
                            if (!state.id) return state.text; // optgroup
                            var complement = allFilterAutocompleteData[state.id].tip;
                            if (complement) {
                                return allFilterAutocompleteData[state.id].label + '<span class="playsql-filter-tip">' + complement + '</span>';
                            } else {
                                return allFilterAutocompleteData[state.id].label;
                            }
                        }

                        function formatSelection(state) {
                            if (!state.id) return state.text; // optgroup
                            return allFilterAutocompleteData[state.id].label;
                        }

                        $content.find("#playsql-inline-filter5").auiSelect2({
                            multiple: true,
                            placeholder: "Filter",
                            formatResult: formatResult,
                            formatSelection: formatSelection,
                            escapeMarkup: function (m) {
                                return m;
                            },
                            formatNoMatches: function(term) {
                                return "Enter a filter"
                            },
                            query: function (query) {
                                var term = query.term,
                                    data = {
                                        results: [],
                                        addEntry: function (json) {
                                            allFilterAutocompleteData.push(json);
                                            this.results.push({id: allFilterAutocompleteData.length - 1, text: json.label});
                                            AJS.log("Added entry: ", allFilterAutocompleteData[allFilterAutocompleteData.length - 1]);
                                        }
                                    };
                                if (viewRenderer && viewRenderer.autoCompleteFilter) {
                                    viewRenderer && viewRenderer.autoCompleteFilter(spreadsheet, column, term, data, function () {
                                        query.callback(data);
                                    });
                                } else {
                                    data.addEntry({
                                        label: "No filter available for " + column.viewRendererName,
                                        sql: undefined
                                    });
                                }

                                query.callback(data);
                            },
                            initSelection: function($element, callback){
                                var data = [];
                                $($element.val().split(",")).each(function(){
                                    if (this != "" && typeof this != "undefined") {
                                        data.push({id: this, text: "-loading #" + this});
                                    }
                                });
                                if (data.length > 0) {
                                    $element.parent().addClass("hovered");
                                }
                                callback(data);
                            }
                        }).auiSelect2("val", initialValue)
                            .on("change", function(){
                                var values = $content.find("#playsql-inline-filter5").auiSelect2("val").map(function(id){
                                    return allFilterAutocompleteData[id];
                                });
                                $("#inline-dialog-col-properties .error").remove();
                                spreadsheet.whereClauseColumnFilters = spreadsheet.whereClauseColumnFilters || {};
                                var initialFilter = spreadsheet.whereClauseColumnFilters[column.name];
                                spreadsheet.whereClauseColumnFilters[column.name] = values;
                                spreadsheet.load(undefined, {failureCallback: function(jqXHR){
                                        if (Math.round(jqXHR.status/100) * 100 == 400) {
                                            try {
                                                // If the BAD_REQUEST is specially formatted by Play SQL
                                                var data = $.parseJSON(jqXHR.responseText);
                                                var message;
                                                if (data.type == "SQL_SYNTAX") {
                                                    message = data.message || data.errorDescription || "Error";// + "\n" + data.sql;
                                                } else {
                                                    message = data.message || data.errorDescription || "Error";
                                                }
                                                $("#inline-dialog-col-properties .aui-buttons").last().after("<br><span class=\"error\"></span><br>&nbsp;");
                                                $("#inline-dialog-col-properties .error").text(message);
                                                return false;
                                            } catch (err) {
                                                // Swallow and proceed to the next section
                                                AJS.log(err);
                                            }
                                        }
                                    }});
                            });


                        $content.find(".filter-input5").mouseenter(function () {
                            $(this).parent().addClass("hovered");
                            /*$content.find(".inline-filter5-on-hover-display").removeClass("hidden");
                             // Allow for the time for the fade-in effect
                             window.setTimeout(function(){$content.find(".inline-filter5-on-hover-display").addClass("hovered");}, 0);*/
                        });
                        $content.find("#apply-inline-filter").click(function(e){
                            e.preventDefault();
                            var values = $content.find("#playsql-inline-filter5").auiSelect2("val").map(function(id){
                                return allFilterAutocompleteData[id];
                            });
                            spreadsheet.whereClauseColumnFilters = spreadsheet.whereClauseColumnFilters || {};
                            spreadsheet.whereClauseColumnFilters[column.name] = values;
                            spreadsheet.inlinedialog.close();
                            spreadsheet.load();
                        });
                        $content.on("click", ".btn-cancel", function (e) {
                            e.preventDefault();
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        });
                        var $formulaField = $content.find(".column-formula");
                        $formulaField.blur(function () {
                            window.setTimeout(function () {
                                $formulaField.removeClass("aui-dropdown2-trigger")
                                    .removeAttr('aria-controls aria-haspopup aria-owns');
                            }, 100);
                        }).keyup(function (e) {
                            window.setTimeout(function () {
                                if ($formulaField.val() == "=") {
                                    if (!$formulaField.attr("aria-owns")) {
                                        $formulaField
                                            .attr('aria-owns', 'dropdown-wizards')
                                            .attr('aria-haspopup', 'true')
                                            .addClass('aui-dropdown2-trigger')
                                            .trigger("aui-button-invoke");
                                    }
                                } else {
                                    if ($("#dropdown-wizards:visible").length > 0) {
                                        $formulaField.trigger("aui-button-invoke");
                                    }
                                    $formulaField
                                        .attr('aria-owns', '')
                                        .attr('aria-haspopup', '')
                                        .removeClass('aui-dropdown2-trigger');
                                }
                            }, 0);
                        });
                        $(inlineDialog2Id).attr("open", true);
                    },
                    close: function() {
                        $header.removeAttr('data-aui-trigger');
                        $header.removeAttr('aria-controls');
                        $(inlineDialog2Id).attr("open", false);
                        $(".tipsy.tipsy-n, #null-sorting-dropdown").remove();
                        $("body, .playsql-spreadsheet-placeholder th").off(".playsql-inlinedialog");
                        if (spreadsheet.inlinedialog == this) {
                            spreadsheet.inlinedialog = undefined;
                        }
                    },
                    is: function (selector) {
                        return $(inlineDialog2Id).is(selector);
                    }
                };
                inlineDialog2.column = column;
                var onClickOutsideInlineDialog = function (e) {
                    if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return;
                    var target = e.target || this;
                    var $this = $(target);
                    if ($this.closest("#inline-dialog-col-properties, " +
                        "#null-sorting-dropdown, " +
                        "#select2-drop, #select2-drop-mask, #select2-drop-mask").size() > 0) return;
                    // If it's not in the DOM, it was detached, therefore it's probably the Configure button
                    if (!$.contains(document.documentElement, target)) return;
                    spreadsheet.inlinedialog.close();
                };
                $("body").on("click.playsql-inlinedialog", "*", onClickOutsideInlineDialog);
                // For elements which answer 'false' to clicks:
                $(".playsql-spreadsheet-placeholder th").on("click.playsql-inlinedialog", onClickOutsideInlineDialog);
                return inlineDialog2;
            }, // End of the 'create' function
            displayProperties : function(spreadsheet, column, inlinedialog){
                $(".tipsy.tipsy-n").remove();
                var deactivateDialogFunctions = false;
                var isFirst = true;
                var isLast = true;
                var position = spreadsheet.columns.indexOf(column);
                if (position + 1 != spreadsheet.columns.length) isLast = false;
                for (var i = 0; i < position ; i++)
                    if (!spreadsheet.columns[i].statusPK && !spreadsheet.columns[i].statusPK)
                        isFirst = false;
                // We brutally replace the inline dialog's contents with the new formg
                var template;
                if (column.fk && column.fk.withUI) {
                    template = Confluence.Templates.PlaySQL.columnPropertiesDetailsWhenFK({
                        column: column,
                        hasColFEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_FE'),
                        hasColBEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_BE'),
                        isFirst: isFirst,
                        isLast: isLast
                    });
                } else {
                    template = Confluence.Templates.PlaySQL.columnPropertiesDetails({
                        column: column,
                        hasColFEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_FE'),
                        hasColBEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_BE'),
                        isFirst: isFirst,
                        isLast: isLast,
                        canEditImage: spreadsheet.canEditImage
                    });
                }
                var $content = $("#inline-dialog-col-properties").children().html(template),
                    $header = column.$placeholder.find("th:nth-child(" + (column.index + 1) + ")");
                $(".btn-advanced").click(function(e){
                    e.preventDefault();

                    $(".remove-when-displaying-advanced").remove();
                    $(".hide-when-displaying-advanced").addClass("hidden");
                    window.PlaySQL.Spreadsheet.ColumnToolbar.displayAdvancedProperties(spreadsheet, column, inlinedialog);
                });

                // Select the default quick renderer, if any
                var bestGuess = getQuickRendererBestGuess(column);
                if (bestGuess != undefined) {
                    $content.find("[data-quick-renderer='" + bestGuess + "']").addClass("active");
                }
                if (column.fk) {
                    var message = "Foreign key to '" + column.fk.targetTable;
                    if (column.fk.displayField) {
                        message += "', column '" + column.fk.displayField + "'.";
                    } else {
                        message += "'.";
                    }
                    var $fkButton = $content.find("[data-quick-renderer='foreign-key']");
                    $fkButton.attr("title", message).tipsy({delayIn: 0});
                    $fkButton.addClass("active");
                }

                if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) {
                    $content.find(".quick-renderer").remove();
                } else {
                    $content.find(".quick-renderer").each(function (i) {
                        var $this = $(this),
                            action = $this.attr("data-quick-renderer"),
                            proposition = getProposedRenderer(action, column),
                            renderer = window.PlaySQL.Spreadsheet.renderers[proposition && proposition.renderer];
                        if (!renderer) {
                            $this.remove();
                        } else if (!renderer.isSupportedType(column.type)) {
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                                $this.remove();
                            }
                        } else if (renderer.key == "foreign-key") {
                            // We only display the FK options if we have permissions on the back-end
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                                $this.remove();
                            }
                        }
                    });
                }
                if (column.fk) {
                    var renderer = window.PlaySQL.Spreadsheet.renderers["foreign-key"];
                    renderer.appendRendererDetailsTo(spreadsheet, $content, column);
                }
                // Remove intermediary groups of button, to avoid the empty-space effect
                $content.find(".aui-buttons:empty").remove();
                $content.on("click", ".quick-renderer", function (e) {
                    e.preventDefault();
                    // This handler doesn't straight-up change the type of the column. It just applies
                    // the '.enforce' class, which is read upon submitting the column properties.
                    // Just in case, it also calls the renderer's onClickQuickRenderer, which can interrupt
                    // the process if they want to insert their own wizard. Which FK does.
                    var $this = $(this),
                        $parent = $this.closest(".aui-toolbar2");
                    $parent.find(".quick-renderer").removeClass("active");
                    $this.addClass("active enforce");
                    $(".tipsy.tipsy-n").remove();
                    var quickRendererDetail = QUICK_RENDERERS[$this.attr("data-quick-renderer")];
                    var newRenderer = window.PlaySQL.Spreadsheet.renderers[quickRendererDetail && quickRendererDetail.renderer];
                    if (newRenderer) {
                        var abort = newRenderer.onClickQuickRenderer(spreadsheet, column);
                        if (abort) {
                            deactivateDialogFunctions = true;
                        }
                    }
                });
                function saveColumnFormula(formula, viewRenderer) {
                    var changes = [],
                        newColumn = {
                            name: column.name,
                            label: column.label,
                            type: column.type,
                            formula: column.formula,
                            renderer: column.renderer,
                            viewRenderer: column.viewRenderer,
                            length: column.length,
                            width: column.width,
                            formats: column.formats
                        };
                    if (formula != newColumn.formula) {
                        changes.push("CHFMA");
                        newColumn.formula = formula;
                    }
                    if (viewRenderer != newColumn.viewRenderer) {
                        changes.push("CHRDR");
                        newColumn.viewRenderer = viewRenderer;
                    }
                    if (changes.length == 0) return;

                    spreadsheet.saveColumn($header, column, newColumn, changes, function () {
                        spreadsheet.load();
                    }, function (message) {
                        window.PlaySQL.Messages.addMessage("error", "The wizard couldn't update the formula. The spreadsheet will be reloaded", "wizard-formula", message);
                        spreadsheet.load();
                    });
                }

                function saveColumnFormulaFailure(message) {
                    window.PlaySQL.Messages.addMessage("error", "The wizard couldn't update the formula.", "wizard-formula", message);
                }

                function submitColumnPopupCallback() {
                    if (deactivateDialogFunctions) return true;
                    var $label = $content.find(".column-label"),
                        $name = $content.find(".column-name"),
                        $formula = $content.find(".column-formula"),
                        $type = $content.find("#column-type:visible"),
                        $renderer = $content.find("#column-renderer:visible"),
                        $viewRenderer = $content.find("#view-renderer:visible"),
                        $quickRenderer = $content.find(".quick-renderer.active.enforce").first(),
                        $wordWrap = $content.find(".column-word-wrap"),
                        $length = $content.find("#column-length:visible"),
                        $fkDisplayField = $content.find("#fk-display-field"),
                        $fkSearchField = $content.find("#fk-search-field"),
                        changes = [],
                        hasFormula = $formula.val(),
                        newColumn = {
                            name: column.name,
                            label: column.label,
                            type: column.type,
                            formula: column.formula,
                            renderer: column.renderer,
                            length: column.length,
                            width: column.width,
                            fk: column.fk ? {
                                targetTable: column.fk.targetTable,
                                onDelete: column.fk.onDelete,
                                onUpdate: column.fk.onUpdate,
                                targetPK: column.fk.targetPK,
                                displayField: column.fk.displayField,
                                searchField: column.fk.searchField,
                                withSQLConstraint: column.fk.withSQLConstraint,
                                withUI: column.fk.withUI
                            } : null,
                            formats: undefined
                        };
                    if ($label.size() > 0 && $label.val() != column.label) {
                        newColumn.label = $label.val();
                        if ($.trim(newColumn.label).length == 0) {
                            $("#inline-dialog-col-properties .error").last().text("A label is required.");
                            return;
                        }
                        changes.push("CHLBL");
                    }
                    if ($name.size() > 0 && $name.val() != column.name) {
                        newColumn.name = $.trim($name.val());
                        if (newColumn.name.length == 0) {
                            $("#inline-dialog-col-properties .error").last().text("A name is required. This is the key of the column.");
                            return;
                        }
                        if (spreadsheet.colOf(newColumn.name) != undefined) {
                            $("#inline-dialog-col-properties .error").last().text("Another column already uses this name.");
                            return;
                        }
                        changes.push("RENAME");
                    }
                    if ($formula.val() != (column.formula || "")) {
                        changes.push("CHFMA");
                        newColumn.formula = $formula.val();
                    }
                    if ($quickRenderer.size() == 1) {
                        // When we update with a quick renderer, we reuse the existing format details.
                        // We only reset format details if the "Advanced" panel was shown and quick renderers removed.
                        newColumn.formats = column.formats;
                        var action = $quickRenderer.attr("data-quick-renderer"),
                            proposition = getProposedRenderer(action, column);
                        var renderer = window.PlaySQL.Spreadsheet.renderers[proposition.renderer];
                        // We don't change the backend type:
                        // - If there's a formula. It's not a problem since we'll detect a potential type mismatch soon enough.
                        // - If the current type is compatible with the proposed renderer (unless the proposition requires enforcing the type)
                        if (hasFormula) {
                            // We change the renderer of the formula
                            changes.push("CHRDR");
                            newColumn.viewRenderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else if (renderer.isSupportedType(column.type) && (!proposition.updateType || !spreadsheet.perms.hasPerm('EDIT_COLS_BE'))) {
                            // We just change the renderer of the column
                            changes.push("CHRDR");
                            newColumn.renderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else if (spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                            // We change the back-end type of the column
                            changes.push("CHTYPE");
                            changes.push("CHRDR");
                            newColumn.type = renderer.getDefaultType();
                            newColumn.length = undefined;
                            newColumn.renderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else {
                            // The quick renderer shouldn't have been displayed anyway
                            message = "Unsupported type: " + column.type + " and can't change type to " + renderer.getDefaultType();
                            window.PlaySQL.Helpers.checkNotNull($("#inline-dialog-col-properties .error").last()).text(message);
                            return;
                        }
                    } else {
                        // We only look at the type/renderer/length/formatDetail fields if no Quick Renderer
                        // was selected
                        if ($type.size() > 0 && $type.val() != newColumn.type) {
                            changes.push("CHTYPE");
                            newColumn.type = $type.val();
                        }
                        if ($renderer.size() > 0 && $renderer.val() != newColumn.renderer) {
                            changes.push("CHRDR");
                            newColumn.renderer = $renderer.val();
                        }
                        if ($viewRenderer.size() > 0) {
                            newColumn.viewRenderer = $viewRenderer.val();
                            if (newColumn.viewRenderer == newColumn.renderer) newColumn.viewRenderer = undefined;
                            if (newColumn.viewRenderer == "") newColumn.viewRenderer = undefined;
                            if (newColumn.viewRenderer != column.viewRenderer) {
                                changes.push("CHRDR");
                                newColumn.viewRenderer = $viewRenderer.val();
                            }
                        }
                        if ($length.size() > 0 && $length.val() != newColumn.length) {
                            newColumn.length = parseInt($length.val());
                            if (isNaN(newColumn.length)) newColumn.length = undefined;
                            if (newColumn.length == undefined) {
                                $content.find(".for-length .error").last().text("The length is mandatory.");
                                return;
                            }
                            if (newColumn.length != column.length) changes.push("CHTYPE");
                        }
                        var newRenderer = window.PlaySQL.Spreadsheet.renderers[newColumn.viewRenderer || newColumn.renderer];
                        var oldFormats = column.formats,
                            newFormats = newRenderer.getFormatValues($content, newColumn);

                        function isEqual(newFormats, oldFormats) {
                            if ((newFormats == undefined) ^ (oldFormats == undefined)) {
                                return false;
                            } else if (newFormats != undefined && oldFormats != undefined) {
                                if (Object.keys(newFormats).length != Object.keys(oldFormats).length) {
                                    return false;
                                } else {
                                    for (var key in newFormats) {
                                        if (!newFormats.hasOwnProperty(key)) continue;
                                        if (newFormats[key] != oldFormats[key]) {
                                            return false;
                                        }
                                    }
                                }
                            }
                            return true;
                        }

                        if (!isEqual(newFormats, oldFormats)) {
                            changes.push("CHFMT");
                        }
                        newColumn.formats = newFormats;
                    }
                    if ($wordWrap.is(":checked")) {
                        newColumn.formats = newColumn.formats || {};
                        if (newColumn.formats.wordwrap != 'true') {
                            newColumn.formats.wordwrap = 'true';
                            changes.push("CHFMT");
                        }
                    } else {
                        if (newColumn.formats && newColumn.formats.wordwrap) {
                            delete newColumn.formats["wordwrap"];
                            changes.push("CHFMT");
                        }
                    }
                    if ($fkDisplayField.size() > 0) {
                        var displayField = $fkDisplayField.val();
                        if (displayField != column.fk.displayField) {
                            newColumn.fk.displayField = $fkDisplayField.val();
                            changes.push("CHFK");
                        }
                    }
                    if ($fkSearchField.size() > 0) {
                        var searchField = $fkSearchField.val();
                        if (searchField != column.fk.searchField) {
                            newColumn.fk.searchField = $fkSearchField.val();
                            changes.push("CHFK");
                        }
                    }

                    if (changes.length == 0) {
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        return;
                    }

                    spreadsheet.saveColumn($header, column, newColumn, changes, function () {
                        // Remove the cache of the StatusRenderer. Sorry for breaking encapsulation.
                        column.statusMappings = undefined;
                        spreadsheet.renderAllColumn(column);
                        if (changes.indexOf("CHFMT") != -1) {
                            var cssWordWrap = spreadsheet.css.module("word-wrap");
                            if (newColumn.formats && newColumn.formats.wordwrap == 'true') {
                                cssWordWrap.getRule({column: newColumn.name}).body['white-space'] = 'pre-wrap';
                            } else {
                                cssWordWrap.getRule({column: newColumn.name}).body['white-space'] = null;
                            }
                            window.PlaySQL.Helpers.applyCss(spreadsheet.css, "word-wrap");
                        }
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                    }, function (message) {
                        window.PlaySQL.Helpers.checkNotNull($("#inline-dialog-col-properties .error").last()).text(message);
                    });
                    return;
                }

                $content.find(".wizardForeignKey").click(function () {
                    window.PlaySQL.Spreadsheet.ColumnToolbar.wizardForeignKey(spreadsheet, $header, column, saveColumnFormula, saveColumnFormulaFailure);
                });
                $content.on("click", ".btn-delete", function (e) {
                    e.preventDefault();
                    if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                        alert("Permissions are required to delete columns");
                        return;
                    }
                    spreadsheet.inlinedialog.close();
                    spreadsheet.deleteColumn($header);
                });
                var shift = 0,
                    shiftTimeoutHandlerId = undefined,
                    shiftedColumn = undefined;
                function shiftTimeoutHandler() {
                    spreadsheet.moveColumn(shiftedColumn, shift, function(){
                        spreadsheet.load();
                        spreadsheet.inlinedialog.close();
                    }, function(message){
                        $content.find(".error").last().text("Couldn't move the column. " + message + " Please reload the spreadsheet");
                        window.setTimeout(function(){ spreadsheet.load(); }, 5000);
                    });
                    shift = 0;
                }
                $content.on("click", ".btn-move-left, .btn-move-right", function(e){
                    shiftedColumn = shiftedColumn || spreadsheet.colOf($header);
                    e.preventDefault();
                    if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                        alert("Permissions are required to move columns");
                        return;
                    }
                    var isLeft = $(this).hasClass("btn-move-left");
                    if (isLeft) shift--; else shift++;
                    if (shiftTimeoutHandlerId) window.clearTimeout(shiftTimeoutHandlerId);
                    shiftTimeoutHandlerId = window.setTimeout(shiftTimeoutHandler, 500);
                    // Provide visual feedback. We're destroying the sync bw DOM and internal state
                    // but we're reloading the spreadsheet a second later
                    if (isLeft) {
                        if ($header.index() > 1)
                            $header.insertBefore($header.prev());
                    } else {
                        if (!$header.next().is(".right-padding"))
                            $header.insertAfter($header.next());
                    }
                });
                $content.on("click", ".btn-submit", submitColumnPopupCallback);
                $content.on("keypress", function (e) {
                    if (e.which == 13) {
                        if (deactivateDialogFunctions) {
                            return true;
                        }
                        submitColumnPopupCallback();
                        return false;
                    } else if (e.which == 27) {
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        return false;
                    }
                });
                $content.find(".playsql-tipsy").tipsy();
            },
            displayAdvancedProperties : function(spreadsheet, column, inlinedialog) {
                var hasFormula = !!column.formula,
                    renderers = getRenderers(column.type),
                    $template = $(Confluence.Templates.PlaySQL.columnPropertiesAdvanced({
                        name: column.name,
                        hasFormula: hasFormula,
                        renderer: column.renderer,
                        viewRenderer: column.viewRenderer || column.renderer,
                        coltype: column.type,
                        length: column.length,
                        renderers: renderers,
                        dataTypes: DATA_TYPES,
                        canChangeBackEndCols : spreadsheet.perms.hasPerm('EDIT_COLS_BE')
                    }));
                $("#inline-dialog-col-properties .advanced-properties > tbody").append($template);
                // window.setTimeout(function() {
                //     $("#inline-dialog-col-properties").attr("open", true); //Pure hack, I could'nt figure out why the inline dialog closes
                // }, 0);

                function updateFieldType() {
                    var $select = $("#column-type"),
                        val = $select.val(),
                        $message = $select.parent().children(".description"),
                        $editRendererCombo = $("#column-renderer"),
                        editRenderer = column.renderer;

                    if (val != column.type) {
                        var text = ("The original type is {}. If you save, the column will be transformed to {}. The conversion" +
                        " is up to the database system, not Play SQL. You may or may not be satisfied with the new values.")
                            .replace("{}", column.type).replace("{}", val);
                        $message.text(text);
                    } else {
                        $message.empty();
                    }

                    for (var i in DATA_TYPES) {
                        if (DATA_TYPES[i].name == val) {
                            $(".for-length").toggleClass("hidden", !DATA_TYPES[i].hasLength);
                            break;
                        }
                    }

                    // Update the list of renderers in the combo
                    renderers = getRenderers(val);
                    $editRendererCombo.empty();
                    for (var i=0 ; i < renderers.sameTypeRenderers.length ; i++) {
                        var el = renderers.sameTypeRenderers[i];
                        $("<option>", {
                            value: el.key,
                            text: el.name,
                            selected: editRenderer == el.key
                        }).appendTo($editRendererCombo);
                    }
                    updateRenderer();
                }

                function updateRenderer() {
                    var $select = hasFormula ? $("#view-renderer") : $("#column-renderer"),
                        val = $select.val(),
                        $placeholderTable = $("#inline-dialog-col-properties .advanced-properties > tbody");
                    renderer = window.PlaySQL.Spreadsheet.renderers[val];

                    $("#inline-dialog-col-properties .format-details").remove();
                    renderer.appendRendererDetailsTo(spreadsheet, $placeholderTable, column);
                }

                $("#column-type").change(updateFieldType);
                $(hasFormula ? "#view-renderer" : "#column-renderer").change(updateRenderer);

                updateFieldType();
            }
        } // End of window.PlaySQL.Spreadsheet.ColumnToolbar

        var DATA_TYPES = [{name:'VARCHAR', hasLength: true},
            {name:'TEXT'},
            {name:'INTEGER'},
            {name:'BIG_INTEGER'},
            {name:'BOOLEAN'},
            {name:'DATE'},
            {name:'NUMERIC'},
            {name:'DOUBLE'},
            {name:'BYTEA'}];

        function displayColProps(spreadsheet, $cell) {
            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
            var column = spreadsheet.colOf($cell),
                dialog = window.PlaySQL.Spreadsheet.ColumnProperties(spreadsheet, column, spreadsheet.perms.hasPerm('EDIT_COLS_BE'));
            dialog.show();
        }


        var QUICK_RENDERERS = {
            "euro":   { renderer: "currency", formats: {aboveZero: "# ##0,00 €"}},
            "dollar": { renderer: "currency", formats: {aboveZero: "$ #,##0.00"}},
            "integer": { renderer: "integer"},
            "decimal": { renderer: "currency", formats: {aboveZero: "#,##0.00"}, updateType: true},
            "markdown": { renderer: "markdown"},
            "text": { renderer: "as-string"},
            "link": { renderer: "link"},
            "boolean": { renderer: "boolean"},
            "date-picker": { renderer: "date"},
            "user-picker": { renderer: "confluenceuser"},
            "page-picker": { renderer: "confluencecontent"},
            "foreign-key": { renderer: "foreign-key" },
            "image": { renderer: "image"}
        };

        function getQuickRendererBestGuess(column) {
            if (column.fk && column.fk.withUI) {
                return "foreign-key";
            }
            var action;
            for (action in QUICK_RENDERERS) {
                var quickRenderer = QUICK_RENDERERS[action],
                    matches = true;
                if (quickRenderer.renderer != (column.viewRenderer || column.renderer)) continue;
                for (var formatKey in quickRenderer.formats) {
                    if (!quickRenderer.formats.hasOwnProperty(formatKey)) continue;
                    if (column.formats == null || column.formats[formatKey] != quickRenderer.formats[formatKey]) {
                        matches = false;
                        break;
                    }
                }
                if (matches) {
                    return action;
                }
            }
            if ((column.viewRenderer || column.renderer) == "currency") {
                action = "integer";
                return action;
            }
            return undefined;
        }

        function getProposedRenderer(action, column) {
            var result = QUICK_RENDERERS[action];

            if (action == "integer") {
                if (column.type == "NUMERIC") {
                    result.renderer = "currency";
                    result.formats = {aboveZero: "#,##0"};
                } else {
                    result.renderer = "integer";
                }
            }
            return result;
        }

        function getRenderers(colType) {
            var sameTypeRenderers = [],
                otherTypeRenderers = [],
                renderers = window.PlaySQL.Spreadsheet.renderers;
            for (var key in renderers) {
                if (!renderers.hasOwnProperty(key)) continue;
                if (renderers[key].isSystemRenderer()) continue;
                var r = {
                    key: key,
                    name: renderers[key].getI18nName()
                }
                if (renderers[key].isSupportedType(colType)) {
                    sameTypeRenderers.push(r);
                } else {
                    otherTypeRenderers.push(r);
                }
            }
            return {
                sameTypeRenderers : sameTypeRenderers,
                otherTypeRenderers : otherTypeRenderers
            }
        }

        // Beware: That's the FK renderer at the old CLF formula level... That's legacy.
        window.PlaySQL.Spreadsheet.ColumnToolbar.wizardForeignKey = function(spreadsheet, $header, column, successCallback, failureCallback) {
            var inlineDialog2Id = 'wizard-foreign-key-inline-dialog';
            var inlineDialog2 = {
                show: function() {
                    spreadsheet.inlinedialog && spreadsheet.inlinedialog.close && spreadsheet.inlinedialog.close();
                    $header.attr('data-aui-trigger');
                    $header.attr('aria-controls', inlineDialog2Id);
                    if (!$('#' + inlineDialog2Id).size()) {
                        var $content = $(Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog({}));
                        $('body').append($content);
                        $content.css('width', '450px');
                        $content.find(".btn-submit").click(function () {
                            var formula = $content.find(".preview").attr("data-result"),
                                targetColumnRenderer = $content.find("#targetlabel option:checked").attr("data-renderer");
                            if (!formula) {
                                $content.find(".error").last().text("All fields are mandatory");
                                return;
                            }
                            successCallback && successCallback(formula, targetColumnRenderer);
                            inlineDialog2 && inlineDialog2.close && inlineDialog2.close();
                        });

                        $content.find("select").change(function () {
                            function quoteIfNecessary(columnname) {
                                if (columnname == undefined) return columnname;
                                if (spreadsheet.defaultCase == "LOWER") {
                                    if (columnname.toLowerCase() != columnname) {
                                        columnname = '"' + columnname + '"';
                                    }
                                } else if (spreadsheet.defaultCase == "UPPER") {
                                    if (columnname.toUpperCase() != columnname) {
                                        columnname = '"' + columnname + '"';
                                    }
                                } else {
                                    columnname = '"' + columnname + '"';
                                }
                                return columnname;
                            }

                            var targettable = $content.find("#targettable").val(),
                                targetlabel = $content.find("#targetlabel").val(),
                                targetid = $content.find("#targetid").val(),
                                sourcecolumn = $content.find("#sourcecolumn").val(),
                                formula = "= " + quoteIfNecessary(targettable) + "." + quoteIfNecessary(targetlabel)
                                    + " WHERE " + quoteIfNecessary(targettable) + "." + quoteIfNecessary(targetid) + "=" + quoteIfNecessary(sourcecolumn),
                                $previewArea = $content.find(".preview");

                            if (!!targettable && !!targetlabel && !!targetid && !!sourcecolumn) {
                                $previewArea.text(formula).attr("data-result", formula);
                                $content.find(".error").last().text("");
                            } else {
                                $previewArea.html("&nbsp;").attr("data-result", "");
                            }
                        });

                        var url = PlaySQL.SPI.baseUrl0("autocomplete/" + spreadsheet.context),
                            $selectTargetTable = $content.find("#targettable"),
                            $selectTargetLabel = $content.find("#targetlabel"),
                            $selectTargetId = $content.find("#targetid"),
                            $selectSourceColumn = $content.find("#sourcecolumn");

                        // Load the table list
                        $.ajax({
                            url: url,
                            type: 'GET',
                            contentType: "application/json; charset=utf-8"
                        }).done(function (data) {
                            var tables = data.tables["current schema"];
                            $selectTargetTable.empty();
                            $("<option>", {
                                value: "",
                                text: "-- Select a table to lookup"
                            }).appendTo($selectTargetTable);
                            for (var i = 0; i < tables.length; i++) {
                                $("<option>", {
                                    value: tables[i].name,
                                    text: tables[i].label
                                }).appendTo($selectTargetTable);
                            }
                        }).fail(function (data) {
                            failureCallback && failureCallback("Couldn't load the table list");
                        });

                        // Load the local columns
                        $.ajax({
                            url: url + "/" + spreadsheet.id,
                            type: 'GET',
                            contentType: "application/json; charset=utf-8"
                        }).done(function (data) {
                            var tables = data.tables["current schema"],
                                tableName;
                            $selectSourceColumn.empty();
                            for (var i = 0; i < tables.length; i++) {
                                if (tables[i].name == spreadsheet.id) {
                                    var columns = tables[i].columns;
                                    for (var j = 0; j < columns.length; j++) {
                                        $("<option>", {
                                            value: columns[j].name,
                                            text: tables[i].label + "." + columns[j].label + (column.name == columns[j].name ? " (this column)" : "")
                                        }).appendTo($selectSourceColumn);
                                    }
                                }
                            }
                            $selectSourceColumn.val(column.name);
                        }).fail(function (data) {
                            failureCallback && failureCallback("Couldn't load the table list");
                        });

                        // Load the other columns
                        $selectTargetTable.change(function () {
                            $.ajax({
                                url: url + "/" + $selectTargetTable.val(),
                                type: 'GET',
                                contentType: "application/json; charset=utf-8"
                            }).done(function (data) {
                                var tables = data.tables["current schema"],
                                    tableName;
                                $selectTargetLabel.empty();
                                $selectTargetId.empty();
                                $("<option>", {
                                    value: "",
                                    text: "-- Select the column to display"
                                }).appendTo($selectTargetLabel);
                                $("<option>", {
                                    value: "",
                                    text: "-- Select the key"
                                }).appendTo($selectTargetId);
                                for (var i = 0; i < tables.length; i++) {
                                    if (tables[i].name == $selectTargetTable.val()) {
                                        var columns = tables[i].columns;
                                        for (var j = 0; j < columns.length; j++) {
                                            $("<option>", {
                                                value: columns[j].name,
                                                text: tables[i].label + "." + columns[j].label,
                                                "data-renderer": columns[j].renderer
                                            }).appendTo($selectTargetLabel)
                                                .clone().appendTo($selectTargetId)
                                        }
                                    }
                                }
                                $selectTargetId.val("ID");
                            }).fail(function (data) {
                                failureCallback && failureCallback("Couldn't load the table list");
                            });
                        });
                    }
                    $("#" + inlineDialog2Id).attr("open", true);
                },
                close: function() {
                    $header.removeAttr('data-aui-trigger');
                    $header.removeAttr('aria-controls');
                    $("#" + inlineDialog2Id).attr("open", false);
                },
                is: function (selector) {
                    return $('#' + inlineDialog2Id).is(selector);
                }
            };
            inlineDialog2.show();
        };
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-formula-editor.js' */
(function(){
window.Confluence = window.Confluence || {};
window.PlaySQL = window.PlaySQL || {};
window.PlaySQL.Spreadsheet = window.PlaySQL.Spreadsheet || {};
window.PlaySQL.Spreadsheet.FormulaEditor = window.PlaySQL.Spreadsheet.FormulaEditor || {

    /**
     * Displays the formula editor for this cell.
     * If the cell was in edit mode, cancel it first.
     */
    edit : function(spreadsheet, $cell, renderer, setValue) {
        var inlinedialog;
        if (!spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
            // Should never reach there because checkBeforeEdit() should return 'no'
            return false;
        }
        if ($cell.hasClass("editing") && !$cell.hasClass("formula")) {
            renderer.cancelEdit();
        }

        // Keep the old value for cancel
        if (!$cell.hasClass("saving")) {
            $cell.attr('data-rendered', $cell.html());
        }

        $cell.addClass("editing formula");

        // Define the value. If the cell was in error, the last correct value is the text of the cell.
        // Otherwise it is provided through the parameters and it comes from the cellMetadata.
        if ($cell.hasClass("invalid") || $cell.hasClass("saving")) {
            // The cell is re-edited after an invalid state
            setValue = $cell.text();
            if (setValue.charAt(0) == "=") {
                setValue = setValue.substr(1);
            }
            $cell.removeClass("saving");
        } else {
            // The cell is edited for the first time.
            if (setValue == undefined) {
                setValue = "";
            } else if (setValue.charAt(0) == "=") {
                setValue = setValue.substr(1);
            }
            $cell.attr('data-cell-metadata-formula', "=" + setValue);
        }

        var selectionManager = window.PlaySQL.Selection.forTable(spreadsheet.$placeholder);

        // Add the input field
        var $input = $("<div>", {
                        contenteditable: true,
                        "class": 'formula-editor playsql-formula',
                        text: setValue
                    });
        $input.appendTo($cell.empty().append("=&nbsp;"));
        // Key movements while editing the formula
        $input.on("keydown", function(e){
            // This time it's Play SQL's bindings that we want to skip
            e.stopPropagation();
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            // And we want to map a few keys
            var keyCombination = window.PlaySQL.Helpers.getKeyCombinationDetail(e);
            if (keyCombination.key == "backspace") {
                var caret = window.PlaySQL.Helpers.caretSelection($input[0]);
                if (caret == undefined) return;
                if (caret.position == 0 && caret.length == 0) {
                    e.preventDefault();
                    window.PlaySQL.Spreadsheet.FormulaEditor.removeFormula(spreadsheet, $cell, renderer);
                    renderer.focus();
                }
            } else if (keyCombination.canonical == "up"
                || keyCombination.canonical == "down"
                || keyCombination.canonical == "enter") {
                e.preventDefault();
            }
            // We need to wait for the character to be inserted
            window.setTimeout(function() {
                var result = window.PlaySQL.Spreadsheet.FormulaEditor.triggerKeyboardCellSelection(spreadsheet, $cell, $input, inlineDialog2, e);
                if (result) {
                    window.PlaySQL.Spreadsheet.FormulaEditor.triggerAutocompletion(spreadsheet, $cell, $input, inlineDialog2, e);
                }
            }, 0);
        }).on("keypress", function(e) {
            // Note: Keypress is only generated on actual characters after keydown, not on ESC/ENTER
            // We want to dodgeskip Confluence's keyboard shortcuts while we're in there, especially 'c' for Create
            e.stopPropagation();
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
        }).on("input, keyup", function(e){
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            window.PlaySQL.Spreadsheet.FormulaEditor.highlightCellsAtCaret(spreadsheet, $input);
            debouncedTriggerSyntaxColoration();
            //spreadsheet.inlinedialog && spreadsheet.inlinedialog.refresh();
        }).on("click", function(e) {
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            window.PlaySQL.Spreadsheet.FormulaEditor.highlightCellsAtCaret(spreadsheet, $input);
        });
        var debouncedTriggerSyntaxColoration = PlaySQL.Helpers.debounce(function(){
            if (!$input.is(":visible")) return;
            window.PlaySQL.Spreadsheet.FormulaEditor.triggerSyntaxColoration($input, spreadsheet, spreadsheet.inlinedialog);
        }, 500);

        // Create the inline dialog
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close && spreadsheet.inlinedialog.close();
        var javadoc = null;
        var inlineDialog2ID = 'inline-dialog-formula-editor';
        var inlineDialog2 = {
            close: function() {
                $cell.removeAttr('data-aui-trigger');
                $cell.removeAttr('aria-controls');
                $("#" + inlineDialog2ID).remove();
                if (spreadsheet.inlinedialog == inlineDialog2) spreadsheet.inlinedialog = undefined;
                selectionManager.options.cssClassMap = undefined;
                window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, false);
            },
            show: function () {
                $cell.attr('data-aui-trigger');
                $cell.attr('aria-controls', 'inline-dialog-formula-editor');
                if (!$('#' + inlineDialog2ID).size()) {
                    $('body').append(Confluence.Templates.PlaySQL.formulaEditor2({
                        javadoc : javadoc
                    }));
                    $(document).on("mouseenter.playsql-inlinedialog", "#inline-dialog-formula-editor .autocomplete-item", function(){
                        $(this).addClass("active").siblings().removeClass("active");
                    }).on("click.playsql-inlinedialog", "#inline-dialog-formula-editor .autocomplete-item", function(){
                        var $item = $(this);
                        $input.focus();
                        window.PlaySQL.Spreadsheet.FormulaEditor.insertAutocomplete(spreadsheet, $item);
                    });
                    $("#inline-dialog-formula-editor .btn-cancel").click(function(){
                        window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, true);
                    });
                    $("#inline-dialog-formula-editor .btn-submit").click(function(){
                        // Save the cell
                        var cell = spreadsheet.getCell($cell);
                        if (cell != null) {
                            cell.renderer.saveAndView();
                            spreadsheet.sprayRequestPipe();
                        }
                    });
                } else if (javadoc) {
                    $("#" + inlineDialog2ID).find('#javadoc').html(javadoc);
                }
                $("#" + inlineDialog2ID).attr("open", true);
            },
            is: function (selector) {
                return $('#' + inlineDialog2ID).is(selector);
            },
            find: function(selector) {
                return $("#" + inlineDialog2ID).find(selector);
            },
            hide: function () {
                $("#" + inlineDialog2ID).attr("open", false);
            },
            append: function(el) {
                 $("#" + inlineDialog2ID).append(el);
            }
        };
        spreadsheet.inlinedialog = inlineDialog2;
        inlineDialog2.name = "formula-editor";
        inlineDialog2.$input = $input;
        inlineDialog2.append = function(formulaAddition) {
            var $field = $cell.find(".formula-editor").first();
            if (formulaAddition instanceof $) {
                var caret = window.PlaySQL.Helpers.caretSelection($field[0], $field.data("saved-selection")),
                    range = caret.range;
                // Either the caret is in the middle of a subrule-value-cell, either something is selected,
                // either we insert at the end. We position the caret at the end of the insert.
                if (caret.length === 0) {
                    // If the cursor is over a cell reference, select the whole <span>
                    if (caret.position > 0) {
                        window.PlaySQL.Helpers.setSelection(range, $field[0], caret.position - 1, "setStart");
                    }
                    var $parentRef = $(range.startContainer).closest(".subrule-value-cell");
                    if ($parentRef.size() == 1) {
                        //range = document.createRange();
                        range.setEndAfter($parentRef[0]);
                        // If the last character before the cursor is not alphanum or *,
                        // we'll consider the user has added a separator and we won't replace the last element
                        var lastChar = range.toString();
                        if (/[^a-zA-Z0-9*:\[\]]/.test(lastChar)) {
                            range.collapse(false);
                        } else {
                            range.setStartBefore($parentRef[0]);
                        }
                    } else if (!$(range.startContainer).closest("td").hasClass("editing")) {
                        // The caret isn't in the formula cell. Move it in.
                        range = document.createRange();
                        var node = $field[0].childNodes.length > 0 ? $field[0].childNodes[$field[0].childNodes.length - 1] : $field[0];
                        range.setStart(node, node.length);
                        range.setEnd(node, node.length);
                    } else {
                        // Cancel the selection modification we've made earlier
                        range.collapse(false);
                    }
                }
                range.deleteContents();
                range.insertNode(formulaAddition[0]);
                // Refocus
                $field.focus();
                var selection = window.getSelection();
                selection.removeAllRanges();
                range.collapse(false);
                selection.addRange(range);
                $field.data("saved-selection", range);
            } else if (typeof formulaAddition == "string") {
                $field.val($field.val() + formulaAddition);
                // Refocus
                $field.focus();
            } else {
                throw "inlinedialog.append(): Unknown object: " + formulaAddition;
            }
        };
        inlineDialog2.setJavadoc = function(data) {
            javadoc = Confluence.Templates.PlaySQL.javadoc(data);
            inlineDialog2.redisplay && inlineDialog2.redisplay();
        };
        // inlinedialog.close = function(){
        //     inlinedialog.remove();
        //     if (spreadsheet.inlinedialog == inlinedialog) spreadsheet.inlinedialog = undefined;
        //     selectionManager.options.cssClassMap = undefined;
        //     window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, false);
        // };
        inlineDialog2.redisplay = function() {
            inlineDialog2.redisplay.isRedisplaying = true;
            inlineDialog2.hide();
            //inlineDialog2.close();
            inlineDialog2.show();
            inlineDialog2.redisplay.isRedisplaying = false;
        };
        var onClickOutsideInlineDialog = function (e) {
            if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return false;
            var target = e.target || this;
            var $this = $(target),
                $targetCell = $this.closest("td, th");
            // Abort if the user clicks in the current cell
            if ($targetCell.is(spreadsheet.inlinedialog.$input.closest("td, th"))) return;
            // Abort if the user clicks in an inline dialog
            if ($this.closest("#inline-dialog-formula-editor" //+
                //"#null-sorting-dropdown, " +
                //"#select2-drop, #select2-drop-mask, #select2-drop-mask"
            ).size() > 0) return;
            // If it's not in the DOM, it was detached, therefore it's probably button of the Inline Dialog
            // which was removed.
            if (!$.contains(document.documentElement, target)) return;

            // Ok, so now we have a click on a cell. Wait for playsql-selection.js to complete, then
            // look at what cell-ref-active brings back.
            window.setTimeout(function(){
                if (!spreadsheet.inlinedialog || spreadsheet.inlinedialog.name != "formula-editor") return;
                var $selection = spreadsheet.$placeholder.find(".cell-ref-active")
                                    .not(spreadsheet.inlinedialog.$input.closest("td"));
                if ($selection.size() == 0) {
                    // console.log("A click for a formula was lost");
                } else if ($selection.is("thead th")) {
                    $selection = $selection.filter("thead th").first();
                    var colName = $selection.attr("data-name");
                    var $el = $("<span>", {"class": "subrule-value-range subrule-range-all"})
                        .append($("<span>", {
                                    "class": "subrule-column-identifier",
                                    text: colName
                                }))
                        .append($("<span>", {
                                    "class": "subrule-range-all",
                                    text: ":*"
                                }));
                    inlineDialog2
                        .append($el);
                } else {
                    var $selection = $selection.first("td");
                    var cell = spreadsheet.getCell($selection),
                        currentCell = spreadsheet.getCell(spreadsheet.inlinedialog.$input.closest("td")),
                        $el;
                    if (!cell) return;
                    if (!!currentCell && cell.rowId == currentCell.rowId) {
                        $el = $("<span>", {
                                "class": "subrule-value-cell subrule-cell-same-row subrule-column-identifier",
                                text: cell.column.name
                            });
                    } else {
                        $el = $("<span>", {"class": "subrule-value-cell subrule-cell-row-id"})
                            .append($("<span>", {
                                "class": "subrule-column-identifier",
                                text: cell.column.name
                            }))
                            .append(":")
                            .append($("<span>", {
                                "class": "subrule-row-id-digits",
                                text: cell.rowId
                            }));
                    }
                    inlineDialog2.append($el);
                }
            }, 10);
            return;

            // Check whether we should append the formula instead
            var cell = spreadsheet.getCell($targetCell);
            if (cell) {
                if ($targetCell[0] == $cell[0]){
                    // Let something else take action: The user probably selected text in the formula
                    return true;
                }
                // Build a range definition
                var row = ":" + (cell.isColumnHeader ? "*" : $cell.closest("tr").attr("data-row-id"));
                var columnName = cell.column.name;
                var formulaAddition = columnName + row;
                inlineDialog2.append(formulaAddition);
                // Here add colors for the formula
            }
            // If we don't prevent bubbling, each of the parents will receive the same click
            return false;
        };
        spreadsheet.$placeholder.on("mouseup.playsql-inlinedialog", "td, th", onClickOutsideInlineDialog);

        selectionManager.options.cssClassMap = { "selected": "cell-ref-active", "focused": "cell-ref-focused" };
        inlineDialog2.show();
        inlineDialog2.find(".remove-formula-link").click(function(e){
            e.preventDefault();
            window.PlaySQL.Spreadsheet.FormulaEditor.removeFormula(spreadsheet, $cell, renderer);
            return false;
        });
        debouncedTriggerSyntaxColoration();
        return inlineDialog2;
    },
    triggerAutocompletion: function(spreadsheet, $cell, $input, inlinedialog, event) {
        var text = $input.text(),
            caret = window.PlaySQL.Helpers.caretSelection($input[0]);
        if (text.length == 0 || caret.position == undefined) return;
        var textBeforeCaret = text.substr(0, caret.position),
            parsed = window.PlaySQL.Helpers.parseFunctionAtCaret(textBeforeCaret),
            targetTable = parsed.currentTable || spreadsheet.id;
        window.PlaySQL.Helpers.getFunctionList(spreadsheet.context, targetTable, function (functionList) {
            if (!functionList || functionList.length == 0) return;
            var options = {},
                current = parsed.current && parsed.current.toLowerCase();
            function highlight(substring, text) {
                // If 'text' is part of HTML tags used here, don't take the risk
                if (new RegExp("<.*" + substring + ".*>").test(text)) return text;
                return text.replace(new RegExp("(" + substring + ")", 'i'), "<b>$1</b>");
            }
            if (current) {
                var candidates = [];
                for (var i=0 ; i < functionList.functions.length ; i++) {
                    var item = functionList.functions[i],
                        matches = item.name.toLowerCase().indexOf(current) == 0,
                        description = item.description,
                        priority = 1;
                    if (!matches && item.keywords) {
                        for (var j=0 ; j < item.keywords.length ; j++)
                            if (item.keywords[j].toLowerCase().indexOf(current) == 0) {
                                priority = 2;
                                matches = true;
                                description += " (keyword: " + highlight(current, item.keywords[j]) + ")";
                                break;
                            }
                    }
                    if (!matches && description) {
                        if (description.toLowerCase().indexOf(current) != -1) {
                            description = highlight(current, description);
                            priority = 20;
                            matches = true;
                        }
                    }
                    if (matches) {
                        candidates.push({
                            name: priority < 2 ? highlight(current, item.name) : item.name,
                            autocomplete: item.name,
                            type: "function",
                            // Override the description
                            detail: $.extend({}, item, {description:description}),
                            priority: priority
                        });
                    }
                }
                for (var i=0 ; i < functionList.columnNames.length ; i++) {
                    var item = functionList.columnNames[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: "column",
                            detail: item,
                            priority : 3
                        });
                    }
                }
                for (var i=0 ; i < functionList.tables.length ; i++) {
                    var item = functionList.tables[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: "table",
                            detail: item,
                            priority : 4
                        });
                    }
                }
                for (var i=0 ; i < functionList.constants.length ; i++) {
                    var item = functionList.constants[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: item.type,
                            detail: item,
                            priority : 5
                        });
                    }
                }
                // Sort by priority
                candidates.sort(function(a, b) {return a && a.priority && b && b.priority ? a.priority - b.priority : 0 });
                options.candidates = candidates;
            }
            if (parsed.parentFn) {
                var functionDef = functionList.functions.filter(function(f){ return f.name == parsed.parentFn })[0];
                if (!functionDef) {
                    options.parentFnNotFound = parsed.parentFn;
                } else {
                    options.parentFn = functionDef;
                }
            }
            inlinedialog.setJavadoc(options);
        });
    },
    triggerSyntaxColoration : function($input, spreadsheet, inlinedialog) {
        // Replace the contents of the cell with syntax-highlighted contents
        var text = $input.text(),
            url = PlaySQL.SPI.baseUrl0("autocomplete/" + spreadsheet.context + "/" + spreadsheet.id + "/checkFormula"),
            caret = window.PlaySQL.Helpers.caretSelection($input[0]);
        if (caret.length != 0 || text.length < 3) {
            spreadsheet.$placeholder
                .find(".cell-ref-inactive, .cell-ref-active")
                .removeClass("cell-ref-inactive cell-ref-active");
            return;
        }

        url += "?" + $.param({
            formula: text,
            column: "col1",
            caretPosition: caret.position
        });

        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            if (!$input.is(":visible")) return;
            var caret = window.PlaySQL.Helpers.caretSelection($input[0]),
                inputText = $input.text();
            if (caret.length != 0) return;
            if (data.formula != inputText) {
                declassifyFormulaPartsAtCaretPosition();
                return;
            }
            // The markup is good and matches the input. We can update the formula, reposition the caret,
            // and update the cell-ref-active and cell-ref-inactive.
            var markupHtml = data.markup,
                markupText = $("<div>").html(markupHtml).text();
            if (markupText != inputText) {
                if (inputText.indexOf(markupText) == 0) {
                    // The user has just added a few letters. We can still recover by appended the added
                    // text.
                    markupHtml += AJS.escapeHtml(inputText.substr(markupText.length));
                } else {
                    declassifyFormulaPartsAtCaretPosition();
                    return;
                }
            }

            $input.html(markupHtml);
            //inlinedialog.setJavadoc(data.currentFunctions.length > 0 && data.currentFunctions[data.currentFunctions.length - 1]);

            var range = document.createRange();
            window.PlaySQL.Helpers.setSelection(range, $input[0], caret.position, "setEnd");
            range.collapse(false); // to end
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            $input.data("saved-selection", range);

            spreadsheet.$placeholder
                .find(".cell-ref-inactive, .cell-ref-active")
                .removeClass("cell-ref-inactive cell-ref-active");

            var $current = getCurrentFormulaElement();
            $input.find(".subrule-value-cell, .subrule-value-range").not($current).each(function(){
                highlightOriginCells(spreadsheet, $input, $(this), "cell-ref-inactive", "");
            });
            highlightOriginCells(spreadsheet, $input, $current, "cell-ref-active", "");

        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get syntax highlighting for formula: " + text);
            declassifyFormulaPartsAtCaretPosition();
        });
    },
    highlightCellsAtCaret: function(spreadsheet, $input) {
        // If the caret in a formula is above a cell reference, we need to highlight it is active
        // and highlight other references as inactive
        spreadsheet.$placeholder.find(".cell-ref-active").addClass("cell-ref-inactive").removeClass("cell-ref-active");
        var $current = getCurrentFormulaElement();
        highlightOriginCells(spreadsheet, $input, $current, "cell-ref-active", "cell-ref-inactive");
    },
    triggerKeyboardCellSelection: function(spreadsheet, $cell, $input, inlinedialog, e){
        var keyCombinationDetail =  window.PlaySQL.Helpers.getKeyCombinationDetail(e),
            $li = $("#inline-dialog-formula-editor .autocomplete-item.active");
        switch (keyCombinationDetail.canonical) {
            case "up":
                //e.preventDefault();
                $li = $li.removeClass("active").prev(".autocomplete-item").addClass("active");
                if ($li.size() == 0) {
                    $("#inline-dialog-formula-editor .autocomplete-item").last().addClass("active");
                }
                return false;
            case "down":
                //e.preventDefault();
                $li = $li.removeClass("active").next(".autocomplete-item").addClass("active");
                if ($li.size() == 0) {
                    $("#inline-dialog-formula-editor .autocomplete-item").first().addClass("active");
                }
                return false;
            case "enter":
                //e.preventDefault();
                var success = window.PlaySQL.Spreadsheet.FormulaEditor.insertAutocomplete(spreadsheet, $li);
                if (!success) {
                    // Save the cell
                    var cell = spreadsheet.getCell($cell);
                    if (cell != null) {
                        cell.renderer.saveAndView();
                        spreadsheet.sprayRequestPipe();
                    }
                }
                return false;
            case "esc":
                window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell);
                break;
        }
        return true;
    },
    /** Keeps the selection in the data of the $input */
    saveSelection: function($input) {
        var selection = window.getSelection();
        if (selection.rangeCount > 0) {
            var range = selection.getRangeAt(0).cloneRange();
            $input.data("saved-selection", range);
        }
    },
    /* Inserts the autocompleted value into the formula
    * Syntax: insertAutocomplete(spreadsheet, $(".autocomplete-item.active"))
    * @return true if something was autocompleted, false otherwise (if false, the user prolly wanted to save the cell)
    * */
    insertAutocomplete: function(spreadsheet, $li){
        // Check if the active dialog is still the formula editor
        var inlinedialog = spreadsheet.inlinedialog;
        if (!inlinedialog || !inlinedialog.name == "formula-editor") return false;
        var $input = inlinedialog.$input;
        var autocompleteText, autocompleteType;
        if ($li instanceof $) {
            if ($li.size() == 0) return;
            autocompleteText = $li.attr("data-autocomplete");
            autocompleteType = $li.attr("data-autocomplete-type");
        } else {
            autocompleteText = arguments[1];
            autocompleteType = arguments[2];
        }
        var autocompleteText2 = autocompleteType == "function" ? autocompleteText + "(" : autocompleteText;
        var regex = /^[a-zA-Z0-9_:]+\(?$/;

        function selectTextMatchingRegex(range, regex, el, method) {
            var startingFromEnd = (method == "setEnd");
            if (el.nodeType == 3) {
                // Loop from the beginning or from the end of the text
                for (var i = startingFromEnd ? el.length : 0 ; i <= el.length && i >= 0 ; startingFromEnd ? i-- : i++) {
                    // We clone because there's a risk we collapse it
                    var range2 = range.cloneRange();
                    range2[method](el, i);
                    if (range2.collapsed) return false;
                    var text = range2.toString();
                    if (regex.test(text)) {
                        // The selection is set. Stop here.
                        range[method](el, i);
                        return true;
                    }
                }
            } else if (el.childNodes) {
                if (!startingFromEnd) {
                    for (var i=0 ; i < el.childNodes.length ; i++) {
                        var result = selectTextMatchingRegex(range, regex, el.childNodes[i], method);
                        // If the result is true or false, return it
                        if (typeof result != "undefined") return result;
                    }
                } else {
                    // Same loop, but starting from the end
                    for (var i = el.childNodes.length - 1 ; i >= 0 ; i--) {
                        var result = selectTextMatchingRegex(range, regex, el.childNodes[i], method);
                        // If the result is true or false, return it
                        if (typeof result != "undefined") return result;
                    }
                }
            }
        }

        var selection = window.getSelection();
        if (!selection.rangeCount) {
            $input.append(document.createTextNode(autocompleteText2));
            return true;
        }
        var range = selection.getRangeAt(0);
        var root = $(range.startContainer).closest("[contenteditable]")[0];
        if (!root) return true;
        if (selectTextMatchingRegex(range, regex, root, "setStart")) {
            range.deleteContents();
        }
        if (selectTextMatchingRegex(range, regex, root, "setEnd")) {
            range.deleteContents();
        }
        var newNode = document.createTextNode(autocompleteText2);
        range.insertNode(newNode);
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);

        // Now find the functionDef and reset the javadoc
        spreadsheet.inlinedialog.setJavadoc("");
        window.PlaySQL.Helpers.getFunctionList(spreadsheet.context, spreadsheet.id, function (functionList) {
            if (!functionList || functionList.length == 0 || !functionList.functions) return;
            var functionDef = functionList.functions.filter(function(f){ return f.name == autocompleteText; })[0];
            // The function may be empty if 'spreadsheet.id' is not the same as parsed.currentTable.
            if (!functionDef) return;
            spreadsheet.inlinedialog.setJavadoc({parentFn: functionDef});
        });
        window.PlaySQL.Spreadsheet.FormulaEditor.triggerSyntaxColoration($input, spreadsheet, inlinedialog);
        return true;
    },
    validate: function(spreadsheet, $cell, renderer) {
        // Formulas can always be stored
        return true;
    },
    saveAndView: function(spreadsheet, $cell, renderer) {
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
        $cell.removeClass("invalid");
        var formula = "=" + $cell.find(".formula-editor").text(),
            previousValue = $cell.attr("data-cell-metadata-formula");
        if (formula == previousValue) {
            this.cancelEdit(spreadsheet, $cell, renderer);
            return;
        }
        if (formula.trim() == "=") {
            // Just delete the contents
            $cell.removeAttr('data-rendered');
            this.cancelEdit(spreadsheet, $cell, renderer);
            if (spreadsheet.saveCellMetadata($cell, "formula", null))
                spreadsheet.sprayRequestPipe();
            return;
        }

        $cell.empty()
            .text(formula)
            .addClass("saving").removeClass("editing");

        if (spreadsheet.saveCellMetadata($cell, "formula", formula)) {
            spreadsheet.sprayRequestPipe();
        } else {
            $cell.html($cell.attr("data-rendered"));
        }
    },
    cancelEdit: function(spreadsheet, $cell) {
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
        $cell.tipsy("disable");
        $(".tipsy").remove();
        var rendered = $cell.attr('data-rendered');
        if (rendered == undefined) {
            $cell.empty().removeClass("editing saving invalid");
        } else {
            $cell.html(rendered).removeClass("editing saving invalid");
        }
    },
    /**
     * Turns the cell back to a normally-rendered cell and sets the anti-formula class
     */
    removeFormula: function(spreadsheet, $cell, renderer) {
        var value = "=" + $cell.find(".formula-editor").text();
        window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell, renderer);
        $cell.removeClass("formula").addClass("anti-formula");
        renderer.edit(value);
    },
    checkAndSaveFormulaRemoval: function(spreadsheet, $cell) {
        if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
            spreadsheet.saveCellMetadata($cell, "formula", null);
        }
    },
    /**
     * Feel free to trigger this function every time you're not sure whether the inline dialog / formula were closed.
     **/
    closeDialog: function(spreadsheet, cancelAllEditingFormulas){
        $(".tipsy.tipsy-n").remove();
        $(document).off(".playsql-inlinedialog");
        spreadsheet.$placeholder.off(".playsql-inlinedialog");
        spreadsheet.$placeholder.find(".cell-ref-inactive, .cell-ref-active").removeClass("cell-ref-inactive cell-ref-active");
        if (spreadsheet.inlinedialog && spreadsheet.inlinedialog.name == "formula-editor") {
            spreadsheet.inlinedialog.close();
        }
        var selectionManager = window.PlaySQL.Selection.forTable(spreadsheet.$placeholder);
        selectionManager.options.cssClassMap = undefined;
        if (cancelAllEditingFormulas) {
            var $editingCells = spreadsheet.$placeholder.find(".editing.formula");
            if ($editingCells.size() > 0) {
                window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $editingCells);
            }
        }
        // Should there still be a reluctant dialog, kill it forcefully
        //window.setTimeout(function(){ $("#inline-dialog-formula-editor").remove(); }, 0);
    }
};

function declassifyFormulaPartsAtCaretPosition() {
    var range = window.getSelection().rangeCount > 0 && window.getSelection().getRangeAt(0);
    if (!range || !range.collapsed) return;
    var $caretContainer = $(range.endContainer);
    // It only acts if the caret is within the formula
    $caretContainer.parents(".playsql-formula *").attr("class", "");
    return;
}

function getCurrentFormulaElement() {
    var sel = window.getSelection();
    if (!sel.rangeCount > 0) return $([]);
    var range = sel.getRangeAt(0),
        $startNode = $(range.startContainer.parentNode);
    return $startNode.closest(".subrule-value-cell, .subrule-value-range");
}

function highlightOriginCells(spreadsheet, $input, $formulaCellOrRangeElement, cssClass, cssClassToRemove) {
    var $this = $formulaCellOrRangeElement,
        columnName = $this.is(".subrule-column-identifier") ? $this.text() : $this.find(".subrule-column-identifier").first().text(),
        rowNum = $this.find(".subrule-row-id-digits").text(),
        isRange = $this.is(".subrule-value-range");
    var column = spreadsheet.colOf(columnName);
    if (!column) return;
    rowNum = rowNum.replace(/[^0-9]/g, "");

    if (isRange) {
        spreadsheet.$findColumnCells(column, true).addClass(cssClass);

    } else {
        if (!rowNum) {
            var $formulaCell = $input.closest("th, td");
            if ($formulaCell.size() == 0) return;
            rowNum = spreadsheet.getCell($formulaCell).rowId;
        } else {
            if (spreadsheet.$placeholder.find("tr[data-row-id=" + rowNum + "]").size() == 0) return;
        }
        var cell = spreadsheet.getCell(rowNum, columnName);
        if (cell) cell.$cell.addClass(cssClass).removeClass(cssClassToRemove);
    }
}
})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-cell-properties.js' */
window.Confluence = window.Confluence || {};
window.PlaySQL = window.PlaySQL || {};
window.PlaySQL.Spreadsheet = window.PlaySQL.Spreadsheet || {};
window.PlaySQL.Spreadsheet.CellProperties = window.PlaySQL.Spreadsheet.CellProperties || {

    lastChosenColor : undefined,

    /**
     * Displays the formula editor for this cell.
     * If the cell was in edit mode, cancel it first.
     */
    display : function(spreadsheet, $cells) {
        $cells = $cells.filter("td:not(.right-padding)");
        var size = $cells.size(),
            formula = undefined;
        if (spreadsheet.inlinedialog) {
            if (spreadsheet.inlinedialog.is("#inline-dialog-cell-properties")) {
                // We just close the current cell properties - we don't open new ones
                spreadsheet.inlinedialog.close();
                return;
            }
            spreadsheet.inlinedialog.close();
        }
        if (size == 0) return;
        // If one cell, display the formula
        if (size == 1) {
            formula = spreadsheet.getCellMetadata($cells, "formula");
        } else {
            formula = $cells.filter(".formula").size() > 0;
        }

        if (typeof window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor === "undefined") {
            // Retrieve the _declared_ bgColor, not the inherited css bgColor.
            window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor = $cells.first()[0].style.backgroundColor;
        }

        // Create the inline dialog
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close && spreadsheet.inlinedialog.close();
        var inlinedialog = {
            show: function() {
                var $focusedCell = $cells.filter('.focused');
                $focusedCell.attr('data-aui-trigger');
                $focusedCell.attr('aria-controls', 'cell-properties-inline-dialog');
                $("#cell-properties-inline-dialog").find('.playsql-color-picker-background').unbind('playsql-color-changed');
                var canEdit = spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA');
                if (!$("#cell-properties-inline-dialog").size()) {
                    $('body').append($(Confluence.Templates.PlaySQL.cellProperties({
                        formula: formula,
                        cellCount: size,
                        lastChosenColor: window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor,
                        palette:
                        // Pastel palette
                            [
                                ["#202020", "#404040", "#808080", "#bfbfbf", "#f2f2f2", "transparent"],
                                ["#948a55", "#b3aa7c", "#c4bd9b", "#d5d1b5", "#e6e4d2", "#f0ece1"],
                                ["#23518b", "#2a69a8", "#3173c4", "#4785d2", "#72a1dc", "#1f497e"],
                                ["#622524", "#953736", "#d9a094", "#e6bab8", "#f5dcdb", "#c0514d"],
                                ["#4e6326", "#72933d", "#c4d69b", "#d8e4bd", "#eff1de", "#9cbb59"],
                                ["#253f61", "#346092", "#95b3d8", "#b9cee5", "#dfe6f4", "#4f82bd"],
                                ["#b38808", "#f7c121", "#fcf9af", "#feffea", "#fefaec", "#fada7b"],
                                ["#901929", "#d9253e", "#f0a7b1", "#f5c4cb", "#fae2e5", "#e66c7d"],
                                ["#403154", "#654a7b", "#b4a2c7", "#ccc1db", "#e6e4ec", "#8065a2"],
                                ["#215b68", "#32859c", "#93cddf", "#b7dfe8", "#dbeff4", "#4aacc7"],
                                ["#994808", "#e16c0a", "#fab990", "#fdd5b5", "#feeada", "#f79646"]
                            ]
                    })));
                    inlinedialog.colorpicker = PlaySQL.Helpers.colorPicker(
                        $("#cell-properties-inline-dialog").find('.playsql-color-picker-background'),
                        canEdit,
                        window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor);
                    $("#cell-properties-inline-dialog").find(".formula-recalculate").click(function(e){
                        e.preventDefault();
                        spreadsheet.recalculateFormulas($cells);
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                    });
                }
                if (canEdit) {
                    $("#cell-properties-inline-dialog").find('.playsql-color-picker-background').on('playsql-color-changed', function() {
                        var color =  $("#cell-properties-inline-dialog").find('.playsql-color-picker-background').attr('data-color');
                        window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor = color;
                        $("#cell-properties-inline-dialog").find(".aui-button-split-main span").css("background-color", color || "");
                        spreadsheet.saveCellMetadata($focusedCell, "background-color", color);
                        spreadsheet.sprayRequestPipe();
                    });
                }
                $("#cell-properties-inline-dialog").attr("open", true);
            },
            close: function() {
                $cells.removeAttr('data-aui-trigger', '');
                $cells.removeAttr('aria-controls');
                $("#cell-properties-inline-dialog").attr("open", false);
            },
            is: function(selector) {
                return $('#cell-properties-inline-dialog').is(selector);
            }
        };
        spreadsheet.inlinedialog = inlinedialog;
        var onClickOutsideInlineDialog = function (e) {
            if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return;
            var target = e.target || this;
            var $this = $(target);
            if ($this.closest("#inline-dialog-cell-properties").size() > 0) return;
            var selectionIsCorrect = $cells.size() == $(".selected").size();
            $cells.each(function() {
                if (!$(this).hasClass("selected"))
                    selectionIsCorrect = false;
                return selectionIsCorrect;
            });
            if (selectionIsCorrect)
                return;
            spreadsheet.inlinedialog.close();
            // If we don't prevent bubbling, each of the parents will receive the same click
            return false;
        };
        $("body").on("click.playsql-inlinedialog", "*", onClickOutsideInlineDialog);
        inlinedialog.show();
        return inlinedialog;
    }
};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/soyjs/spreadsheet-macro.soy' */
// This file was automatically generated from spreadsheet-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }


Confluence.Templates.PlaySQL.fullTable = function(opt_data, opt_ignored) {
  var output = Confluence.Templates.PlaySQL.userParamsForm(opt_data) + '<table id="playsql-' + soy.$$escapeHtml(opt_data.name) + '" class="playsql spreadsheet ' + ((opt_data.squeeze) ? 'squeeze-mode' : '') + '"><thead>' + Confluence.Templates.PlaySQL.paginationRow({pagination: opt_data.pagination, columnCount: opt_data.columns.length - 2}) + '<tr class="playsql-col-headers">';
  var columnList18 = opt_data.columns;
  var columnListLen18 = columnList18.length;
  if (columnListLen18 > 0) {
    for (var columnIndex18 = 0; columnIndex18 < columnListLen18; columnIndex18++) {
      var columnData18 = columnList18[columnIndex18];
      if (! columnData18.statusPosition) {
        output += '<th data-name="' + soy.$$escapeHtml(columnData18.name) + '" title="' + soy.$$escapeHtml(columnData18.name) + '" data-type="' + soy.$$escapeHtml(columnData18.type) + '" data-renderer="' + soy.$$escapeHtml(columnData18.renderer) + '" data-view-renderer="' + soy.$$escapeHtml(columnData18.viewRenderer ? columnData18.viewRenderer : '') + '"';
        if (columnData18.statusPK) {
          output += 'data-status-pk="true" title="' + soy.$$escapeHtml('Click on the red cell to open the spreadsheet editor') + '" data-metadata-name="';
          var columnMetadataList37 = opt_data.columns;
          var columnMetadataListLen37 = columnMetadataList37.length;
          for (var columnMetadataIndex37 = 0; columnMetadataIndex37 < columnMetadataListLen37; columnMetadataIndex37++) {
            var columnMetadataData37 = columnMetadataList37[columnMetadataIndex37];
            output += (columnMetadataData37.statusPosition) ? soy.$$escapeHtml(columnMetadataData37.name) : '';
          }
          output += '"';
        }
        output += ((columnData18.statusPosition) ? 'data-status-position="true"' : '') + '>' + soy.$$escapeHtml(columnData18.label) + ((opt_data.whereClauseColumnFilters && opt_data.whereClauseColumnFilters[columnData18.name] && opt_data.whereClauseColumnFilters[columnData18.name].length > 0) ? '&nbsp;<span class="aui-icon aui-icon-small playsql-filtericon">(Filtered)</span>' : '') + '</th>';
      }
    }
  } else {
    output += '<th><a href="' + soy.$$escapeHtml(opt_data.editorUrl) + '" target="_blank">&nbsp;</a></th><th>&nbsp;</th>';
  }
  output += '<th class="add-column right-padding"><a href="#" title="' + soy.$$escapeHtml('Click to add a new column') + '">' + soy.$$escapeHtml('Add a Column') + '</a></th></tr>' + ((opt_data.recoverableErrorMessage) ? '<tr class="playsql-message recoverable"><th>&nbsp;</th><td colspan="' + soy.$$escapeHtml(Math.max(2, opt_data.columns.length - 1)) + '"><div class="playsql-message-inner"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAAG1BMVEX///87c687c687c687c687c687c6////87c68225wXAAAACXRSTlMAEWaqu8zu///VQmatAAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABR0RVh0Q3JlYXRpb24gVGltZQA2LzEvMTM4qUXQAAAARklEQVQImWNgYFDu6DBiAALRDiAIZGBgzAAx2gQYWDvAIIBBo6OjvaKjo4nBA8JoYeiAAhADJIKNAVcM1w43EG4F3FKYMwD5VTVUBOW+rQAAAABJRU5ErkJggg==" width="16" height="16" align="absmiddle" alt="" border="0" />&nbsp;' + soy.$$escapeHtml(opt_data.recoverableErrorMessage) + '<br/></p></div></td></tr>' : (opt_data.data.length == 0) ? '<tr class="playsql-message"><th>&nbsp;</th><td colspan="' + soy.$$escapeHtml(opt_data.columns.length - 1) + '"><div class="playsql-message-inner"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAAG1BMVEX///87c687c687c687c687c687c6////87c68225wXAAAACXRSTlMAEWaqu8zu///VQmatAAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABR0RVh0Q3JlYXRpb24gVGltZQA2LzEvMTM4qUXQAAAARklEQVQImWNgYFDu6DBiAALRDiAIZGBgzAAx2gQYWDvAIIBBo6OjvaKjo4nBA8JoYeiAAhADJIKNAVcM1w43EG4F3FKYMwD5VTVUBOW+rQAAAABJRU5ErkJggg==" width="16" height="16" align="absmiddle" alt="" border="0"/>&nbsp;' + ((opt_data.customEmptyMessage) ? soy.$$escapeHtml(opt_data.customEmptyMessage) : soy.$$escapeHtml('No data in this table.')) + '<br/></p></div></td></tr>' : '') + '</thead><tbody>';
  var rowList80 = opt_data.data;
  var rowListLen80 = rowList80.length;
  for (var rowIndex80 = 0; rowIndex80 < rowListLen80; rowIndex80++) {
    var rowData80 = rowList80[rowIndex80];
    output += Confluence.Templates.PlaySQL.oneRow({row: rowData80});
  }
  output += '</tbody>' + Confluence.Templates.PlaySQL.totalsRow({totals: opt_data.totals, pagination: opt_data.pagination, columnCount: opt_data.columns.length - 2}) + '</table><div id="custom-menu"></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.fullTable.soyTemplateName = 'Confluence.Templates.PlaySQL.fullTable';
}


Confluence.Templates.PlaySQL.totalsRow = function(opt_data, opt_ignored) {
  var output = '<tfoot>';
  if (opt_data.totals) {
    output += '<tr class="totals-row"><th class="add-row"><a href="#">' + soy.$$escapeHtml('Add a Row') + '</a></th>';
    var cellList97 = opt_data.totals;
    var cellListLen97 = cellList97.length;
    for (var cellIndex97 = 0; cellIndex97 < cellListLen97; cellIndex97++) {
      var cellData97 = cellList97[cellIndex97];
      output += '<td colspan="' + soy.$$escapeHtml(cellData97.first) + '"><span class="total-label">' + soy.$$escapeHtml(cellData97.second) + ' </span><span class="total-value">' + soy.$$escapeHtml(cellData97.third) + '</span></td>';
    }
    output += '<td class="right-padding">&nbsp;</td></tr>';
  } else {
    output += '<tr class="totals-row"><th class="add-row"><a href="#">' + soy.$$escapeHtml('Add a Row') + '</a></th><td colspan="' + soy.$$escapeHtml(opt_data.columnCount) + '" class="edit-on-first-click">&nbsp;</td><td class="right-padding">&nbsp;</td></tr>';
  }
  output += Confluence.Templates.PlaySQL.paginationRow(opt_data) + '</tfoot>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.totalsRow.soyTemplateName = 'Confluence.Templates.PlaySQL.totalsRow';
}


Confluence.Templates.PlaySQL.paginationRow = function(opt_data, opt_ignored) {
  return '' + ((opt_data.pagination) ? '<tr class="pagination-row"><td colspan="' + soy.$$escapeHtml(opt_data.columnCount + 2) + '"><a href="#" class="pagination-squeeze aui-icon aui-icon-small aui-iconfont-custom-bullet playsql-tipsy" title="Reduce margins to squeeze more data on the screen">Squeeze</a><a href="#" class="pagination-full-screen aui-icon aui-icon-small aui-iconfont-focus playsql-tipsy" title="Full screen">Full screen</a>' + ((opt_data.pagination.firstPage == null) ? '<span class="pagination-first pagination-number active">&lt;&lt;</span>' : '<a href="#" class="pagination-first pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.firstPage) + '">&lt;&lt;</a>') + ((opt_data.pagination.previousPage == null) ? '<span class="pagination-previous pagination-number active">&lt;</span>' : '<a href="#" class="pagination-previous pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.previousPage) + '">&lt;</a>') + '&nbsp;' + soy.$$escapeHtml(opt_data.pagination.offset + 1) + ' &ndash; ' + soy.$$escapeHtml(opt_data.pagination.pageEnd + 1) + '&nbsp; of ' + soy.$$escapeHtml(opt_data.pagination.count) + ((opt_data.pagination.limit < 100000) ? '&nbsp; (<a href="#" class="pagination-see-all-rows" data-limit="1000000">See all</a>) &nbsp;' : '') + ((opt_data.pagination.nextPage == null) ? '<span class="pagination-next pagination-number active">&gt;</span>' : '<a href="#" class="pagination-next pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.nextPage) + '">&gt;</a>') + ((opt_data.pagination.lastPage == null) ? '<span class="pagination-last pagination-number active">&gt;&gt;</span>' : '<a href="#" class="pagination-last pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.lastPage) + '">&gt;&gt;</a>') + '</td></tr>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.paginationRow.soyTemplateName = 'Confluence.Templates.PlaySQL.paginationRow';
}


Confluence.Templates.PlaySQL.oneRow = function(opt_data, opt_ignored) {
  var output = '';
  var rowId__soy162 = opt_data.row[0][0] ? opt_data.row[0][0] : '';
  var position__soy163 = opt_data.row[1][0] ? opt_data.row[1][0] : '';
  output += '<tr data-row-id="' + soy.$$escapeHtml(rowId__soy162) + '" data-row-metadata="' + soy.$$escapeHtml(position__soy163) + '">';
  var cellList169 = opt_data.row;
  var cellListLen169 = cellList169.length;
  for (var cellIndex169 = 0; cellIndex169 < cellListLen169; cellIndex169++) {
    var cellData169 = cellList169[cellIndex169];
    if (cellIndex169 == 0) {
      output += '<th data-value="' + soy.$$escapeHtml(cellData169[0] ? cellData169[0] : '') + '" data-saved-value="' + soy.$$escapeHtml(cellData169[0] ? cellData169[0] : '') + '">' + soy.$$escapeHtml(rowId__soy162) + '</th>';
    } else if (cellIndex169 != 1) {
      var value__soy180 = '' + soy.$$escapeHtml(cellData169[0] != null ? cellData169[0] : '');
      var beValue__soy182 = '' + soy.$$escapeHtml(cellData169[1] != null ? cellData169[1] : '');
      output += '<td data-value="' + soy.$$filterNoAutoescape(beValue__soy182) + '" data-fe-value="' + soy.$$escapeHtml(value__soy180) + '"' + ((cellData169[3]) ? ' class="' + soy.$$escapeHtml(cellData169[3]) + '" ' : '') + ((cellData169[4]) ? ' style="' + soy.$$escapeHtml(cellData169[4]) + '" ' : '') + '>' + soy.$$filterNoAutoescape(cellData169[2]) + '</td>';
    }
  }
  output += '<td class="right-padding">&nbsp;</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.oneRow.soyTemplateName = 'Confluence.Templates.PlaySQL.oneRow';
}


Confluence.Templates.PlaySQL.userParamsForm = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.useForm) {
    if (opt_data.userParameters && opt_data.userParameters.length > 0) {
      output += '<form class="aui"><div class="playsql-user-parameters-form">';
      var paramList212 = opt_data.userParameters;
      var paramListLen212 = paramList212.length;
      for (var paramIndex212 = 0; paramIndex212 < paramListLen212; paramIndex212++) {
        var paramData212 = paramList212[paramIndex212];
        output += '<div class="field-group"><label for="user-parameter-' + soy.$$escapeHtml(paramData212.name) + '">' + soy.$$escapeHtml(paramData212.label) + '</label><input class="text" type="text" class="playsql-user-parameter" id="user-parameter-' + soy.$$escapeHtml(paramData212.cleanName) + '" name="user-parameter-' + soy.$$escapeHtml(paramData212.cleanName) + '" value="' + soy.$$escapeHtml(paramData212.valueOrDefault) + '"></div>';
      }
      output += '<div class="buttons-container"><div class="buttons"><input class="button submit" type="submit" value="Run" id="user-parameter-run-query">' + ((opt_data.useCache) ? '<a class="cancel" id="user-parameter-refresh-query">Refresh the cache</a>' : '') + '</div></div></div></form>';
    } else if (opt_data.useCache) {
      output += '<a href="#" id="user-parameter-refresh-query">Refresh the cache for this table</a>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.userParamsForm.soyTemplateName = 'Confluence.Templates.PlaySQL.userParamsForm';
}


Confluence.Templates.PlaySQL.columnPropertiesInlineDialog = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="inline-dialog-col-properties" alignment="bottom left" persistent><form class="aui content"><div class="aui-toolbar2" style="margin: -10px;"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="aui-buttons"><a class="aui-button btn-properties playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Configure. Get detailed options about the column properties, including the type, length, number of decimals, currency, renderer.') + '" ' + ((! opt_data.hasColFEPerm) ? 'aria-disabled="true"' : '') + '><span class="aui-icon aui-icon-small aui-iconfont-configure">' + soy.$$escapeHtml('Properties') + '</span></a></div><div class="aui-buttons"><a href="#" class="aui-button orderby-selector ' + ((opt_data.orderbyDef.way == 'DESC') ? 'sort-asc' : (opt_data.orderbyDef.way == 'ASC') ? 'sort-none' : 'sort-desc') + '">' + ((opt_data.orderbyDef.way == 'DESC') ? soy.$$escapeHtml('Sort: DESC') : (opt_data.orderbyDef.way == 'ASC') ? soy.$$escapeHtml('Sort: ASC') : soy.$$escapeHtml('Unsorted')) + '</a><button class="aui-button aui-dropdown2-trigger aui-button-split-more" aria-haspopup="true" aria-owns="null-sorting-dropdown">' + soy.$$escapeHtml('Nulls') + '</button></div><div id="null-sorting-dropdown" class="aui-dropdown2 aui-style-default" data-dropdown2-alignment="left"><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a href="#" class="aui-dropdown2-radio sort-none ' + ((opt_data.orderbyDef.way != 'DESC' && opt_data.orderbyDef.way != 'ASC') ? 'checked' : '') + '">' + soy.$$escapeHtml('Unsorted') + '</a></li><li><a href="#" class="aui-dropdown2-radio sort-desc ' + ((opt_data.orderbyDef.way == 'DESC') ? 'checked' : '') + '">' + soy.$$escapeHtml('Descending') + '</a></li><li><a href="#" class="aui-dropdown2-radio sort-asc ' + ((opt_data.orderbyDef.way == 'ASC') ? 'checked' : '') + '">' + soy.$$escapeHtml('Ascending') + '</a></li></ul></div><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a href="#" class="aui-dropdown2-radio nulls-default ' + ((opt_data.orderbyDef.nulls != 'FIRST' && opt_data.orderbyDef.nulls != 'LAST' && opt_data.orderbyDef.way != null) ? 'checked' : '') + '">' + soy.$$escapeHtml('Default') + '</a></li><li><a href="#" class="aui-dropdown2-radio nulls-first ' + ((opt_data.orderbyDef.nulls == 'FIRST') ? 'checked' : '') + '">' + soy.$$escapeHtml('Nulls first') + '</a></li><li><a href="#" class="aui-dropdown2-radio nulls-last ' + ((opt_data.orderbyDef.nulls == 'LAST') ? 'checked' : '') + '">' + soy.$$escapeHtml('Nulls last') + '</a></li></ul></div></div><div class="aui-buttons" style="margin-top: 10px;"><input id="playsql-inline-filter5" type="hidden" class="filter-input5"></div></div></div></div></form></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesInlineDialog.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesInlineDialog';
}


Confluence.Templates.PlaySQL.columnPropertiesDetails = function(opt_data, opt_ignored) {
  return '<form class="aui content"><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-secondary"><div class="aui-buttons"><a class="btn-cancel" href="#">' + soy.$$escapeHtml('Cancel') + '</a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Save') + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml('Save') + '</span></a></div><div class="aui-buttons hide-when-displaying-advanced">' + ((! opt_data.isFirst) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-left" href="#" title="' + soy.$$escapeHtml('Move this column to the left. All instances of this spreadsheet will display columns in the same order.') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&lt;</a>' : '') + ((! opt_data.isLast) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-right" href="#" title="' + soy.$$escapeHtml('Move this column to the right. All instances of this spreadsheet will display columns in the same order.') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&gt;</a>' : '') + '</div><div class="aui-buttons hide-when-displaying-advanced"><a class="aui-button btn-delete playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Delete the column') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '><span class="aui-icon aui-icon-small aui-iconfont-delete">' + soy.$$escapeHtml('Delete the column') + '</span></a></div></div></div></div><table border="0" class="advanced-properties"><tbody><tr class="hide-when-displaying-advanced"><td>' + soy.$$escapeHtml('Label:') + '</td><td><input class="text column-label" value="' + soy.$$escapeHtml(opt_data.column.label) + '" ' + ((! opt_data.hasColFEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr class="hide-when-displaying-advanced"><td>' + soy.$$escapeHtml('Name:') + '</td><td><input class="text column-name" value="' + soy.$$escapeHtml(opt_data.column.name) + '" ' + ((! opt_data.hasColBEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr class="hide-when-displaying-advanced hidden"><td>' + soy.$$escapeHtml('CLF:') + '</td><td><input class="text column-formula long-field" value="' + soy.$$escapeHtml(opt_data.column.formula ? opt_data.column.formula : '') + '" ' + ((! opt_data.hasColBEPerm) ? 'disabled="disabled"' : '') + '/><div id="dropdown-wizards" class="aui-dropdown2 aui-style-default"><ul class="aui-list-truncate"><li><a href="#" class="wizardForeignKey">' + soy.$$escapeHtml('\x3d Lookup a value from another table') + '</a></li><li><a href="#" class="wizardGMaps">' + soy.$$escapeHtml('\x3d Link a street address to Google Maps') + '</a></li><li><a href="http://documentation.play-sql.com/display/PUBLIC/Formulas" target="_blank">' + soy.$$escapeHtml('? Get help about formulas') + '</a></li></ul></div></td></tr>' + ((opt_data.hasColBEPerm) ? '<tr class="formula-helpers hide-when-displaying-advanced hidden"><td>&nbsp;</td><td><div class="description">' + soy.$$filterNoAutoescape(AJS.format('CLF in SQL. \x3ca href\x3d\x22{0}\x22 {1}\x3eWizards\x3c/a\x3e\x26nbsp;\x3ca href\x3d\x22{2}\x22 target\x3d\x22_blank\x22\x3eMore information\x3c/a\x3e','#','class="show-wizards aui-dropdown2-trigger" aria-owns="dropdown-wizards" aria-haspopup="true"','http://documentation.play-sql.com/display/PUBLIC/Formulas')) + '</div></td></tr>' : '') + '<tr class="remove-when-displaying-advanced"><td>&nbsp;</td><td><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="euro" href="#" title="' + soy.$$escapeHtml('Euro') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-euro">' + soy.$$escapeHtml('Euro') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="dollar" href="#" title="' + soy.$$escapeHtml('Dollar') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-dollar">' + soy.$$escapeHtml('Dollar') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="integer" href="#" title="' + soy.$$escapeHtml('Integer') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-number">' + soy.$$escapeHtml('Integer') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="decimal" href="#" title="' + soy.$$escapeHtml('Decimal') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-zeroes">' + soy.$$escapeHtml('Decimal') + '</span></a></div><div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="markdown" href="#" title="' + soy.$$escapeHtml('Markdown (rich text). See help.') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-markdown">' + soy.$$escapeHtml('Markdown (rich text). See help.') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="text" href="#" title="' + soy.$$escapeHtml('Text') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-text">' + soy.$$escapeHtml('Text') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="link" href="#" title="' + soy.$$escapeHtml('Link') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-link">' + soy.$$escapeHtml('Link') + '</span></a></div>' + ((opt_data.canEditImage) ? '<div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="image" href="#" title="' + soy.$$escapeHtml('Image') + '"><span class="aui-icon aui-icon-small aui-iconfont-image">' + soy.$$escapeHtml('Image') + '</span></a></div>' : '') + '<div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="boolean" href="#" title="' + soy.$$escapeHtml('Boolean') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-boolean">' + soy.$$escapeHtml('Boolean') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="date-picker" href="#" title="' + soy.$$escapeHtml('Date Picker') + '"><span class="aui-icon aui-icon-small aui-iconfont-calendar">' + soy.$$escapeHtml('Date Picker') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="user-picker" href="#" title="' + soy.$$escapeHtml('User Picker') + '"><span class="aui-icon aui-icon-small aui-iconfont-user">' + soy.$$escapeHtml('User Picker') + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="page-picker" href="#" title="' + soy.$$escapeHtml('Page Picker') + '"><span class="aui-icon aui-icon-small aui-iconfont-doc aui-iconfont-page-default">' + soy.$$escapeHtml('Page Picker') + '</span></a><a class="aui-button quick-renderer playsql-tipsy fk" data-quick-renderer="foreign-key" href="#" title="' + soy.$$escapeHtml('Foreign Key') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-foreign-key aui-iconfont-devtools-arrow-right">' + soy.$$escapeHtml('Foreign Key') + '</span></div></div></div></div></td></tr><tr class="formula-helpers hide-when-displaying-advanced"><td>' + soy.$$escapeHtml('Formats') + '</td><td><input type="checkbox" class="column-word-wrap test" id="column-word-wrap" ' + ((opt_data.column.formats && opt_data.column.formats.wordwrap == 'true') ? ' checked="on" ' : '') + ' /><label for="column-word-wrap">' + soy.$$escapeHtml('Wrap text on several lines.') + '</label></td></tr><tr class="remove-when-displaying-advanced"><td>&nbsp;</td></tr><tr class="remove-when-displaying-advanced"><td>&nbsp;</td><td><a href="#" class="btn-advanced">' + soy.$$escapeHtml('Advanced...') + '</a></td></tr></tbody></table><div class="error"></div><div class="button-panel" id="inline-dialog-col-properties-submit-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml('Save') + '</a><a href="#" class="cancel btn-cancel">' + soy.$$escapeHtml('Cancel') + '</a></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesDetails.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesDetails';
}


Confluence.Templates.PlaySQL.columnPropertiesDetailsWhenFK = function(opt_data, opt_ignored) {
  return '<form class="aui content"><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-secondary"><div class="aui-buttons"><a class="btn-cancel" href="#">' + soy.$$escapeHtml('Cancel') + '</a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Save') + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml('Save') + '</span></a></div><div class="aui-buttons hide-when-displaying-advanced">' + ((! opt_data.isFirst) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-left" href="#" title="' + soy.$$escapeHtml('Move this column to the left. All instances of this spreadsheet will display columns in the same order.') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&lt;</a>' : '') + ((! opt_data.isLast) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-right" href="#" title="' + soy.$$escapeHtml('Move this column to the right. All instances of this spreadsheet will display columns in the same order.') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&gt;</a>' : '') + '</div><div class="aui-buttons hide-when-displaying-advanced"><a class="aui-button btn-delete playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Delete the column') + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '><span class="aui-icon aui-icon-small aui-iconfont-delete">' + soy.$$escapeHtml('Delete the column') + '</span></a></div></div></div></div><table border="0" class="advanced-properties"><tbody><tr class="hide-when-displaying-advanced"><td>' + soy.$$escapeHtml('Label:') + '</td><td><input class="text column-label" value="' + soy.$$escapeHtml(opt_data.column.label) + '" ' + ((! opt_data.hasColFEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr class="hide-when-displaying-advanced"><td>' + soy.$$escapeHtml('Name:') + '</td><td><input class="text column-name" value="' + soy.$$escapeHtml(opt_data.column.name) + '" ' + ((! opt_data.hasColBEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr class="remove-when-displaying-advanced"><td style="padding-top: 5px">' + soy.$$escapeHtml('Type:') + '</td><td style="padding-top: 5px"><p class="free-text-in-form">Foreign key to <code>' + soy.$$escapeHtml(opt_data.column.fk.targetTable) + '.' + soy.$$escapeHtml(opt_data.column.fk.targetPK) + '</code></p><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="aui-buttons"><a class="aui-button active playsql-tipsy fk-remove" data-quick-renderer="foreign-key" href="#" title="' + soy.$$escapeHtml('Remove this foreign key') + '"><span class="aui-icon aui-icon-small aui-iconfont-devtools-arrow-right">' + soy.$$escapeHtml('Remove this foreign key') + '</span></a>' + ((! opt_data.column.fk.ghost) ? '<a class="aui-button active playsql-tipsy fk-remove-renderer" href="#" data-quick-renderer="remove-foreign-key-renderer" href="#" title="' + soy.$$escapeHtml('Remove the renderer but keep the foreign key') + '"><span class="aui-icon aui-icon-small aui-foreign-key playsql-iconfont playsql-iconfont-remove-foreign-key-renderer">' + soy.$$escapeHtml('Remove the renderer but keep the foreign key') + '</span></a>' : '<a class="aui-button playsql-tipsy display-another-column" href="#" data-quick-renderer="remove-foreign-key-renderer-display-another-column" href="#" title="' + soy.$$escapeHtml('Display another column') + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-remove-foreign-key-renderer  ">' + soy.$$escapeHtml('Display another column') + '</span></a>') + '</div></div></div></div></td></tr><tr><td>' + soy.$$escapeHtml('Display field') + '</td><td><input class="text" id="fk-display-field" value="' + soy.$$escapeHtml(opt_data.column.fk.displayField != null ? opt_data.column.fk.displayField : '') + '" placeholder="' + soy.$$escapeHtml('(All text fields)') + '"/></td></tr><tr><td>' + soy.$$escapeHtml('Search field') + '</td><td><input class="text" id="fk-search-field" value="' + soy.$$escapeHtml(opt_data.column.fk.searchField != null ? opt_data.column.fk.searchField : '') + '" placeholder="' + soy.$$escapeHtml('(Same as the display field)') + '"/></td></tr><tr><td>' + soy.$$escapeHtml('On Delete / Update:') + '</td><td><p class="free-text-in-form">' + soy.$$escapeHtml(opt_data.column.fk.onDelete) + ' / ' + soy.$$escapeHtml(opt_data.column.fk.onUpdate) + '</p></td></tr><tr><td>' + soy.$$escapeHtml('Rendered as:') + '</td><td><p class="free-text-in-form">' + soy.$$escapeHtml(opt_data.column.viewRenderer ? opt_data.column.viewRenderer : opt_data.column.renderer) + ' ' + soy.$$escapeHtml('(Same as the target field)') + '</p></td></tr></tbody></table><div class="error"></div><div class="button-panel" id="inline-dialog-col-properties-submit-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml('Save') + '</a><a href="#" class="cancel btn-cancel">' + soy.$$escapeHtml('Cancel') + '</a></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesDetailsWhenFK.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesDetailsWhenFK';
}


Confluence.Templates.PlaySQL.columnPropertiesAdvanced = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml('Database column properties') + '</h3></td></tr><tr class="for-type"><td>' + soy.$$escapeHtml('Type:') + '</td><td><select class="select" id="column-type" name="type" title="' + soy.$$escapeHtml('Select a type for your data') + '"' + ((! opt_data.canChangeBackEndCols) ? 'disabled="on"' : '') + '>';
  var typeList553 = opt_data.dataTypes;
  var typeListLen553 = typeList553.length;
  for (var typeIndex553 = 0; typeIndex553 < typeListLen553; typeIndex553++) {
    var typeData553 = typeList553[typeIndex553];
    output += '<option value="' + soy.$$escapeHtml(typeData553.name) + '"' + ((typeData553.name == opt_data.coltype) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(typeData553.label != null ? typeData553.label : typeData553.name) + '</option>';
  }
  output += '</select><div class="description"></div><div class="error" class="hidden"></div></td></tr><tr class="' + ((opt_data.length == null) ? 'hidden' : '') + ' for-length"><td>Length</td><td><input class="text" id="column-length" name="length" value="' + soy.$$escapeHtml(opt_data.length != null ? opt_data.length : '') + '"/><div class="error" class="hidden"></div></td></tr><tr class="for-renderer ' + ((opt_data.hasFormula) ? 'hidden' : '') + '"><td>' + soy.$$escapeHtml('Renderer') + '</td><td><select class="select" id="column-renderer" name="renderer" title="' + soy.$$escapeHtml('Select the renderer you use to edit the data') + '"><optgroup label="Same type (' + soy.$$escapeHtml(opt_data.coltype) + ')">';
  var rendererItemList581 = opt_data.renderers.sameTypeRenderers;
  var rendererItemListLen581 = rendererItemList581.length;
  for (var rendererItemIndex581 = 0; rendererItemIndex581 < rendererItemListLen581; rendererItemIndex581++) {
    var rendererItemData581 = rendererItemList581[rendererItemIndex581];
    output += '<option value="' + soy.$$escapeHtml(rendererItemData581.key) + '"' + ((rendererItemData581.key == opt_data.renderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData581.name) + '</option>';
  }
  output += '</optgroup></select><div class="description"></div><div class="error" class="hidden"></div></td></tr><tr class="for-view-renderer ' + ((! opt_data.hasFormula) ? 'hidden' : '') + '"><td>' + soy.$$escapeHtml('Formula Renderer') + '</td><td><select class="select" id="view-renderer" name="view-renderer" title="' + soy.$$escapeHtml('Select a renderer to display your data') + '"><optgroup label="Same type (' + soy.$$escapeHtml(opt_data.coltype) + ')">';
  var rendererItemList603 = opt_data.renderers.sameTypeRenderers;
  var rendererItemListLen603 = rendererItemList603.length;
  for (var rendererItemIndex603 = 0; rendererItemIndex603 < rendererItemListLen603; rendererItemIndex603++) {
    var rendererItemData603 = rendererItemList603[rendererItemIndex603];
    output += '<option value="' + soy.$$escapeHtml(rendererItemData603.key) + '"' + ((rendererItemData603.key == opt_data.viewRenderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData603.name) + '</option>';
  }
  output += '</optgroup>';
  if (opt_data.canChangeBackEndCols) {
    output += '<optgroup label="Different type">';
    var rendererItemList618 = opt_data.renderers.otherTypeRenderers;
    var rendererItemListLen618 = rendererItemList618.length;
    for (var rendererItemIndex618 = 0; rendererItemIndex618 < rendererItemListLen618; rendererItemIndex618++) {
      var rendererItemData618 = rendererItemList618[rendererItemIndex618];
      output += '<option value="' + soy.$$escapeHtml(rendererItemData618.key) + '" ' + ((rendererItemData618.key == opt_data.viewRenderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData618.name) + '</option>';
    }
    output += '</optgroup>';
  }
  output += '</select><div class="description">' + soy.$$escapeHtml('Renders the result of your formula. Check the type matches the formula (whether it is integer, date or text).') + '</div><div class="error" class="hidden"></div></td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesAdvanced.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesAdvanced';
}


Confluence.Templates.PlaySQL.columnPropertiesJoint = function(opt_data, opt_ignored) {
  return '' + ((opt_data.jointIdColumn) ? '<tr><td>' + soy.$$escapeHtml('Joint ID') + '</td><td><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.jointIdColumn) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml('All edits will be saved in the joint table. See the Joint ID column for more info.') + '</div><div class="error"></div></td></tr><tr><td>' + soy.$$escapeHtml('Joint column') + '</td><td><input class="text" id="column-joint-column" name="column-joint-column" ' + ((opt_data.jointColumn) ? 'value="' + soy.$$escapeHtml(opt_data.jointColumn) + '"' : '') + ' disabled="disabled"/><div class="description">' + soy.$$escapeHtml(AJS.format('Name of the column in \x22{$jointTable}\x22. Optional.',opt_data.jointTable)) + ' </div><div class="error"></div></td></tr>' : '<tr><td>' + soy.$$escapeHtml('Joint table') + '</td><td><div class="free-text-in-form"></div><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.jointTable) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml('All edits will be saved in the joint table.') + '</div><div class="error"></div></td></tr><tr><td>' + soy.$$escapeHtml('Joint FK') + '</td><td><div class="free-text-in-form"></div><input class="text" id="column-joint-fk" name="column-joint-fk" value="' + soy.$$escapeHtml(opt_data.jointFK) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml('The foreign key (FK) column.') + '</div><div class="error"></div></td></tr>');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesJoint.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesJoint';
}


Confluence.Templates.PlaySQL.columnPropertiesFK = function(opt_data, opt_ignored) {
  return '<tr class="for-type"><td>' + soy.$$escapeHtml('Type:') + '</td><td><p class="free-text-in-form"><select id="fk-remove" title="If you remove the Foreign Key and come back to a simple integer field, no data will be deleted. You will see the IDs (numbers) instead of their value. You can recreate the FK later."><option value="fk">Foreign Key to <code>' + soy.$$escapeHtml(opt_data.fk.targetTable) + '.' + soy.$$escapeHtml(opt_data.fk.targetPK) + '</code></option><option value="non-fk">Integer</option></select></p></td></tr><tr><td>' + soy.$$escapeHtml('Display field') + '</td><td><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.fk.displayField != null ? opt_data.fk.displayField : '') + '" placeholder="' + soy.$$escapeHtml('(All text fields)') + '"/></td></tr><tr><td>' + soy.$$escapeHtml('Search field') + '</td><td><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.fk.searchField != null ? opt_data.fk.searchField : '') + '" placeholder="' + soy.$$escapeHtml('(Same as the display field)') + '"/></td></tr><tr><td>' + soy.$$escapeHtml('On Delete / Update:') + '</td><td><p class="free-text-in-form">' + soy.$$escapeHtml(opt_data.fk.onDelete) + ' / ' + soy.$$escapeHtml(opt_data.fk.onUpdate) + '</p></td></tr>' + ((opt_data.column) ? '<tr><td>' + soy.$$escapeHtml('Rendered as:') + '</td><td><p class="free-text-in-form">' + soy.$$escapeHtml(opt_data.column.viewRenderer ? opt_data.column.viewRenderer : opt_data.column.renderer) + ' ' + soy.$$escapeHtml('(Same as the target field)') + '</p></td></tr>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesFK.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesFK';
}


Confluence.Templates.PlaySQL.columnPropertiesDateFormatField = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td for="dateFormat">' + soy.$$escapeHtml('Display format') + '</td><td><input class="text" id="column-dateFormat" name="dateFormat" ' + ((opt_data.dateFormat) ? 'value="' + soy.$$escapeHtml(opt_data.dateFormat) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Optional. Example: \x22yyyy-MM-dd\x22, or \x22ddd dd/MM/yyyy\x22') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['dateFormat']) {
    var errorList716 = opt_data.fieldErrors['dateFormat'];
    var errorListLen716 = errorList716.length;
    for (var errorIndex716 = 0; errorIndex716 < errorListLen716; errorIndex716++) {
      var errorData716 = errorList716[errorIndex716];
      output += '<div class="error">' + soy.$$escapeHtml(errorData716) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesDateFormatField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesDateFormatField';
}


Confluence.Templates.PlaySQL.columnPropertiesMarkdown = function(opt_data, opt_ignored) {
  return '<tr class="format-details"><td></td><td><p>The cells will be rendered using the <a href="https://github.com/sirthias/pegdown">PegDown</a> syntax:</p><ul><li>*One star*: <em>Emphasis</em></li><li>**Two stars**: <b>Bold</b></li><li>`Back-quotes`: <code>Code</code></li><li>![Alt text](/path/to/img.jpg): Image</li><li>&lt;http://example.com&gt;: Links</li><li># Hash: Title</li><li>## Double Hash: Sub-title</li><li>* Star (at the beginning of the line): List</li></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesMarkdown.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesMarkdown';
}


Confluence.Templates.PlaySQL.columnPropertiesImage = function(opt_data, opt_ignored) {
  return '<tr class="format-details" ><td>Width</td><td><input class="text width" type="number" placeholder="64" id="columnWidth" value="' + soy.$$escapeHtml(opt_data.columnWidth != null ? opt_data.columnWidth : '') + '"></td></tr><tr class="format-details"><td>Height</td><td><input class="text height" type="number" placeholder="64" id="columnHeight" value="' + soy.$$escapeHtml(opt_data.columnHeight != null ? opt_data.columnHeight : '') + '"></td></tr><tr class="format-details"><td>Width (Form)</td><td><input class="text widthForm" type="number" placeholder="64" id="columnWidthForm" value="' + soy.$$escapeHtml(opt_data.columnWidthForm != null ? opt_data.columnWidthForm : '') + '"></td></tr><tr class="format-details"><td>Height (Form)</td><td><input class="text heightForm" type="number" placeholder="64" id="columnHeightForm" value="' + soy.$$escapeHtml(opt_data.columnHeightForm != null ? opt_data.columnHeightForm : '') + '"></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesImage.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesImage';
}


Confluence.Templates.PlaySQL.columnPropertiesCurrencyField = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml('Currency renderer details') + '</h3></td></tr><tr class="format-details"><td for="aboveZero">' + soy.$$escapeHtml('Positive number format') + '</td><td><input class="text" id="column-aboveZero" name="aboveZero" ' + ((opt_data.aboveZero) ? 'value="' + soy.$$escapeHtml(opt_data.aboveZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Example: \x22$ #,##0.00\x22 or \x22# ##0,00 \u20ac\x22') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['aboveZero']) {
    var errorList752 = opt_data.fieldErrors['aboveZero'];
    var errorListLen752 = errorList752.length;
    for (var errorIndex752 = 0; errorIndex752 < errorListLen752; errorIndex752++) {
      var errorData752 = errorList752[errorIndex752];
      output += '<div class="error">' + soy.$$escapeHtml(errorData752) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr><tr class="format-details"><td for="equalZero">' + soy.$$escapeHtml('Zero') + '</td><td><input class="text" id="column-equalZero" name="equalZero" ' + ((opt_data.equalZero) ? 'value="' + soy.$$escapeHtml(opt_data.equalZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Optional.') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['equalZero']) {
    var errorList772 = opt_data.fieldErrors['equalZero'];
    var errorListLen772 = errorList772.length;
    for (var errorIndex772 = 0; errorIndex772 < errorListLen772; errorIndex772++) {
      var errorData772 = errorList772[errorIndex772];
      output += '<div class="error">' + soy.$$escapeHtml(errorData772) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr><tr class="format-details"><td for="belowZero">' + soy.$$escapeHtml('Negative numbers') + '</td><td><input class="text" id="column-belowZero" name="belowZero" ' + ((opt_data.belowZero) ? 'value="' + soy.$$escapeHtml(opt_data.belowZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Optional. Example: \x22darkred;$# ###.00\x22') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['belowZero']) {
    var errorList792 = opt_data.fieldErrors['belowZero'];
    var errorListLen792 = errorList792.length;
    for (var errorIndex792 = 0; errorIndex792 < errorListLen792; errorIndex792++) {
      var errorData792 = errorList792[errorIndex792];
      output += '<div class="error">' + soy.$$escapeHtml(errorData792) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesCurrencyField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesCurrencyField';
}


Confluence.Templates.PlaySQL.columnPropertiesValueMappingField = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml('Icon renderer details') + '</h3></td></tr><tr class="format-details"><td>' + soy.$$escapeHtml('Value mapping') + '</td><td><p>' + soy.$$filterNoAutoescape(AJS.format('Map values with icons. Enter the \x3ca href\x3d\x22{0}\x22\x3eCSS class\x3c/a\x3e or the \x3ca href\x3d\x22{1}\x22\x3edata url\x3c/a\x3e.','https://developer.atlassian.com/design/latest/iconography.html','http://dataurl.net/#dataurlmaker')) + '</p><table class="aui aui-table-interactive" id="value-mappings"><thead><tr><th>' + soy.$$escapeHtml('Value') + '</th><th>' + soy.$$escapeHtml('Icon') + '</th><th><a class="add" href="#" title="' + soy.$$escapeHtml('Add a new mapping') + '"><span class="aui-icon aui-icon-small aui-iconfont-add" data-unicode="UTF+E002" original-title="">' + soy.$$escapeHtml('Add a new mapping') + '</span></a></th></tr></thead><tbody>';
  var keyList817 = soy.$$getMapKeys(opt_data.mappings);
  var keyListLen817 = keyList817.length;
  for (var keyIndex817 = 0; keyIndex817 < keyListLen817; keyIndex817++) {
    var keyData817 = keyList817[keyIndex817];
    output += Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow({key: keyData817, value: opt_data.mappings[keyData817]});
  }
  output += '</tbody></table></td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesValueMappingField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesValueMappingField';
}


Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow = function(opt_data, opt_ignored) {
  return '<tr><td><input type="text" value="' + soy.$$escapeHtml(opt_data.key) + '" name="key"></td><td><input type="text" value="' + soy.$$escapeHtml(opt_data.value) + '" name="value"></td><td><a href="#" class="remove-mapping" title="' + soy.$$escapeHtml('Remove') + '"><span class="aui-icon aui-icon-small aui-iconfont-remove">' + soy.$$escapeHtml('Remove') + '</span></a></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow';
}


Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="wizard-foreign-key-inline-dialog" alignment="bottom left"><form class="aui" id="wizard-foreign-key-dialog"><h2>' + soy.$$escapeHtml('Formula Wizard: Foreign Key') + '</h2><fieldset><h3>Label</h3><div class="field-group targettable"><label for="targettable">' + soy.$$escapeHtml('Target table') + '</label><select class="select long-field" id="targettable" name="targettable" title="' + soy.$$escapeHtml('Choose in which table the value should be looked up') + '"></select></div><div class="field-group targetlabel"><label for="targetlabel">Label</label><select class="select long-field" id="targetlabel" name="targetlabel" title="' + soy.$$escapeHtml('Choose the value to be displayed') + '"></select></div><h3>ID Columns</h3><div class="field-group targetid"><label for="targetid">' + soy.$$escapeHtml('Target table\x27s ID') + '</label><select class="select long-field" id="targetid" name="targetid" title="' + soy.$$escapeHtml('Choose the identifier column') + '"></select></div><div class="field-group sourcecolumn"><label for="sourcecolumn">' + soy.$$escapeHtml('Source column') + '</label><select class="select long-field" id="sourcecolumn" name="sourcecolumn" title="' + soy.$$escapeHtml('Choose the local table\x27s foreign key') + '"></select></div></fieldset><fieldset class="group hidden"><legend><span>' + soy.$$escapeHtml('Format') + '</span></legend><div class="checkbox"><input class="checkbox" type="checkbox" name="convert-to-sql" id="convert-to-sql"/><label for="convert-to-sql">' + soy.$$escapeHtml('Convert the formula to SQL') + '</label></div></fieldset><fieldset class="group"><legend><span>' + soy.$$escapeHtml('Preview') + '</span></legend><p class="preview free-text-in-form">&nbsp;</p><div class="error free-text-in-form"></div></fieldset><div class="button-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml('Finish') + '</a></div></form></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog.soyTemplateName = 'Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog';
}


Confluence.Templates.PlaySQL.formulaEditor = function(opt_data, opt_ignored) {
  return '<form class="aui top-label"><div class="field-group"><div class="description javadoc-autocomplete"><div class="aui-buttons formula-editor-buttons"><a class="aui-button btn-help playsql-tipsy" title="' + soy.$$escapeHtml('? Get help about formulas') + '" href="http://documentation.play-sql.com/display/PUBLIC/Formulas+2" target="_blank"><span class="aui-icon aui-icon-small aui-iconfont-help">' + soy.$$escapeHtml('? Get help about formulas') + '</span></a><a class="aui-button btn-cancel playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Cancel [esc]') + '"><span class="aui-icon aui-icon-small aui-iconfont-undo">' + soy.$$escapeHtml('Cancel') + '</span></a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Save [enter]') + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml('Save') + '</span></a></div>' + ((opt_data.javadoc == null) ? '<p id="javadoc">Functions: SUM, MIN, MAX, COUNT...</p>' : '<p id="javadoc">' + soy.$$filterNoAutoescape(opt_data.javadoc) + '</p>') + '</div></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.formulaEditor.soyTemplateName = 'Confluence.Templates.PlaySQL.formulaEditor';
}


Confluence.Templates.PlaySQL.formulaEditor2 = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="inline-dialog-formula-editor" alignment="bottom"><form class="aui top-label"><div class="field-group"><div class="description javadoc-autocomplete"><div class="aui-buttons formula-editor-buttons"><a class="aui-button btn-help playsql-tipsy" title="' + soy.$$escapeHtml('? Get help about formulas') + '" href="http://documentation.play-sql.com/display/PUBLIC/Formulas+2" target="_blank"><span class="aui-icon aui-icon-small aui-iconfont-help">' + soy.$$escapeHtml('? Get help about formulas') + '</span></a><a class="aui-button btn-cancel playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Cancel [esc]') + '"><span class="aui-icon aui-icon-small aui-iconfont-undo">' + soy.$$escapeHtml('Cancel') + '</span></a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml('Save [enter]') + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml('Save') + '</span></a></div>' + ((opt_data.javadoc == null) ? '<p id="javadoc">Functions: SUM, MIN, MAX, COUNT...</p>' : '<p id="javadoc">' + soy.$$filterNoAutoescape(opt_data.javadoc) + '</p>') + '</div></div></form></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.formulaEditor2.soyTemplateName = 'Confluence.Templates.PlaySQL.formulaEditor2';
}


Confluence.Templates.PlaySQL.cellProperties = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog id="cell-properties-inline-dialog"  alignment="bottom right" persistent><div class="aui-toolbar2" role="toolbar" style="margin: -15px; margin-top: -23px;"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-group"><div class="aui-toolbar2-primary">' + Confluence.Templates.PlaySQL.colorPicker(opt_data) + '</div></div></div></div><div class="description">' + ((opt_data.formula) ? '<p>Formula: ' + soy.$$escapeHtml(opt_data.formula == true ? 'Yes' : opt_data.formula) + ' <a href="#" class="formula-recalculate">Recalculate</a></p>' : '') + ((opt_data.cellCount > 1) ? '<p>' + soy.$$escapeHtml(opt_data.cellCount) + ' cells</p>' : '') + '</div></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.cellProperties.soyTemplateName = 'Confluence.Templates.PlaySQL.cellProperties';
}


Confluence.Templates.PlaySQL.colorPicker = function(opt_data, opt_ignored) {
  var output = '<div style="margin: 0;" class="aui-buttons playsql-color-picker-background ' + soy.$$escapeHtml(opt_data.classes != null ? opt_data.classes : '') + '" ' + ((opt_data.id) ? 'id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + '><a class="aui-button aui-button-split-main" href="#"><span style="background-color:' + soy.$$escapeHtml(opt_data.lastChosenColor) + ';">&nbsp;</span></a></div><div class="aui-dropdown2 aui-style-default aui-layer playsql-color-picker-dropdown" data-aui-alignment-container="playsql-color-picker-background" aria-hidden="true">';
  var rowList934 = opt_data.palette;
  var rowListLen934 = rowList934.length;
  for (var rowIndex934 = 0; rowIndex934 < rowListLen934; rowIndex934++) {
    var rowData934 = rowList934[rowIndex934];
    output += (rowData934.length == 0) ? '<hr />' : '';
    var colorList938 = rowData934;
    var colorListLen938 = colorList938.length;
    for (var colorIndex938 = 0; colorIndex938 < colorListLen938; colorIndex938++) {
      var colorData938 = colorList938[colorIndex938];
      output += '<a class="color-item" style="background-color: ' + soy.$$escapeHtml(colorData938) + ';">Color</a>';
    }
    output += '<br/>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.colorPicker.soyTemplateName = 'Confluence.Templates.PlaySQL.colorPicker';
}


Confluence.Templates.PlaySQL.javadoc = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '' + ((opt_data.parentFnNotFound) ? '<p class="javadoc-fn">No function found with name "' + soy.$$escapeHtml(opt_data.parentFnNotFound) + '"</p>' : '');
  if (opt_data.parentFn != null) {
    output += '<p><span class="javadoc-fn-signature">' + soy.$$escapeHtml(opt_data.parentFn.name);
    if (opt_data.parentFn.params) {
      output += '(';
      var paramList959 = opt_data.parentFn.params;
      var paramListLen959 = paramList959.length;
      for (var paramIndex959 = 0; paramIndex959 < paramListLen959; paramIndex959++) {
        var paramData959 = paramList959[paramIndex959];
        output += soy.$$escapeHtml(paramData959.javadocName) + ((! (paramIndex959 == paramListLen959 - 1)) ? ',&nbsp;' : '');
      }
      output += ')';
    } else {
      output += '()';
    }
    output += '</span><br>&nbsp;=&gt;&nbsp;<span class="javadoc-fn-description">' + soy.$$escapeHtml(opt_data.parentFn.description) + '</span></p>';
    if (opt_data.parentFn.params) {
      output += '<p>Parameters:<ul>';
      var paramList974 = opt_data.parentFn.params;
      var paramListLen974 = paramList974.length;
      for (var paramIndex974 = 0; paramIndex974 < paramListLen974; paramIndex974++) {
        var paramData974 = paramList974[paramIndex974];
        output += '<li><b>' + soy.$$escapeHtml(paramData974.javadocName) + '</b>:&nbsp;<i>' + soy.$$escapeHtml(paramData974.type) + ((paramData974.range) ? '[]' : '') + '</i>.' + soy.$$escapeHtml(paramData974.javadocDescription ? paramData974.javadocDescription : '') + '</li>';
      }
      output += '</ul>';
    }
    output += (opt_data.parentFn.example) ? '<p class="javadoc-fn-example">Example: ' + soy.$$escapeHtml(opt_data.parentFn.example) + '</p>' : '';
  }
  if (opt_data.candidates != null) {
    output += (opt_data.parentFn != null) ? '<hr><p>Autocompletion suggestions:</p>' : '';
    var candidateList997 = opt_data.candidates;
    var candidateListLen997 = candidateList997.length;
    for (var candidateIndex997 = 0; candidateIndex997 < candidateListLen997; candidateIndex997++) {
      var candidateData997 = candidateList997[candidateIndex997];
      output += '<li class="autocomplete-item" data-autocomplete="' + soy.$$escapeHtml(candidateData997.autocomplete) + '" data-autocomplete-type="' + soy.$$escapeHtml(candidateData997.type) + '">' + ((candidateData997.type == 'column') ? ' Column "' + soy.$$escapeHtml(candidateData997.detail.label) + '" (' + soy.$$filterNoAutoescape(candidateData997.name) + ')' : (candidateData997.type == 'table') ? ' Table "' + soy.$$escapeHtml(candidateData997.detail.label) + '" (' + soy.$$filterNoAutoescape(candidateData997.name) + ')' : (candidateData997.type == 'function') ? soy.$$filterNoAutoescape(candidateData997.name) + ':&nbsp;' + soy.$$filterNoAutoescape(candidateData997.detail.description) : soy.$$escapeHtml(candidateData997.type) + ': ' + soy.$$filterNoAutoescape(candidateData997.name)) + '</li>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.javadoc.soyTemplateName = 'Confluence.Templates.PlaySQL.javadoc';
}


Confluence.Templates.PlaySQL.foreignKeyWizard = function(opt_data, opt_ignored) {
  return '<tr><td colspan="2"><h3>Foreign Key</h3></td></tr><tr class="fkwiz-0"><td colspan="2" style="max-width: 400px; padding-bottom: 15px;">A foreign key is when a value references a record in another table. For example it helps you display a label instead of a product ID.</td></tr><tr class="fkwiz-1 hidden"><td colspan="2">Does this column contain values or IDs ?</td></tr><tr class="fkwiz-1 hidden"><td colspan="2"><input class="radio fkwiz-1-swap"      type="radio" name="fkwiz-1-swap"      id="fkwiz-1-swap"     ><label for="fkwiz-1-swap">Human-readable values or text (default)</label></td></tr><tr class="fkwiz-1 hidden"><td colspan="2"><input class="radio fkwiz-1-dont-swap" type="radio" name="fkwiz-1-dont-swap" id="fkwiz-1-dont-swap"><label for="fkwiz-1-dont-swap">IDs, identifiers that users should not see</label></td></tr><tr class="fkwiz-2 hidden"><td colspan="2" style="max-width: 400px;">Search for or create a target table</td></tr><tr class="fkwiz-2 hidden"><td>Table name</td><td><input class="text" id="fk-table-name"></td></tr><tr class="fkwiz-3 hidden"><td colspan="2">Choose the name of the column which should be displayed to the user.</td></tr><tr class="fkwiz-3 hidden"><td colspan="2"><input class="text" id="fk-display-column"></td></tr><tr class="fkwiz-spinner hidden"><td colspan="2"><aui-spinner size="small" title="Please wait while we check the structure of the target table and whether the values match the IDs.">wait</aui-spinner><span id="spinner-text">Retrieving information about the target table.</span></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.foreignKeyWizard.soyTemplateName = 'Confluence.Templates.PlaySQL.foreignKeyWizard';
}


Confluence.Templates.PlaySQL.createSpreadsheetForm = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = ((opt_data.copyId != null) ? '<p>' + soy.$$escapeHtml(AJS.format('The current spreadsheet (with key \x27{0}\x27) will be duplicated as:',opt_data.copyId)) + '</p>' : '') + '<form class="aui" id="create-spreadsheet-form"><fieldset><div class="field-group"><label for="create-form-name">' + soy.$$escapeHtml('Spreadsheet Label') + '</label><input class="text" id="create-form-spreadsheet-name" name="create-form-name" autocomplete="off" ' + ((opt_data.name) ? 'value="' + soy.$$escapeHtml(opt_data.name) + '"' : '') + '/>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['name']) {
    var errorList1050 = opt_data.fieldErrors['name'];
    var errorListLen1050 = errorList1050.length;
    for (var errorIndex1050 = 0; errorIndex1050 < errorListLen1050; errorIndex1050++) {
      var errorData1050 = errorList1050[errorIndex1050];
      output += '<div class="error">' + soy.$$escapeHtml(errorData1050) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div><div class="field-group"><label for="create-form-key">' + soy.$$escapeHtml('Key') + '</label><input class="text" id="create-form-spreadsheet-key" name="create-form-key" ' + ((opt_data.key) ? 'value="' + soy.$$escapeHtml(opt_data.key) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml('Used as a name for the table in the database') + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['key']) {
    var errorList1070 = opt_data.fieldErrors['key'];
    var errorListLen1070 = errorList1070.length;
    for (var errorIndex1070 = 0; errorIndex1070 < errorListLen1070; errorIndex1070++) {
      var errorData1070 = errorList1070[errorIndex1070];
      output += '<div class="error">' + soy.$$escapeHtml(errorData1070) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.createSpreadsheetForm.soyTemplateName = 'Confluence.Templates.PlaySQL.createSpreadsheetForm';
}


Confluence.Templates.PlaySQL.editTotalsCell = function(opt_data, opt_ignored) {
  return '<input class="totals-label" placeholder="' + soy.$$escapeHtml('(Place label here)') + '" value="' + soy.$$escapeHtml(opt_data.label) + '">&nbsp;=<input class="totals-calculation" value="' + soy.$$escapeHtml(opt_data.calculation) + '">';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.editTotalsCell.soyTemplateName = 'Confluence.Templates.PlaySQL.editTotalsCell';
}


Confluence.Templates.PlaySQL.formulaHelp = function(opt_data, opt_ignored) {
  var output = '<aui-inline-dialog id="inline-dialog-formula-help" alignment="bottom"><div class="formula-help-popup"><p>' + soy.$$filterNoAutoescape(AJS.format('Type a SQL expression here. \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eHelp about formulas\x3c/a\x3e.','http://documentation.play-sql.com/display/PUBLIC/Formulas')) + '</p>';
  var keyList1091 = soy.$$getMapKeys(opt_data.fields);
  var keyListLen1091 = keyList1091.length;
  for (var keyIndex1091 = 0; keyIndex1091 < keyListLen1091; keyIndex1091++) {
    var keyData1091 = keyList1091[keyIndex1091];
    output += ((keyData1091) ? '<p>' + soy.$$escapeHtml(AJS.format('{0} fields:',keyData1091)) + '</p>' : '<p>' + soy.$$escapeHtml('Available fields:') + '</p>') + '<ul>';
    var fieldList1102 = opt_data.fields[keyData1091];
    var fieldListLen1102 = fieldList1102.length;
    for (var fieldIndex1102 = 0; fieldIndex1102 < fieldListLen1102; fieldIndex1102++) {
      var fieldData1102 = fieldList1102[fieldIndex1102];
      output += '<li>' + soy.$$escapeHtml(fieldData1102) + '</li>';
    }
    output += '</ul>';
  }
  if (opt_data.examples != null && opt_data.examples.length > 0) {
    output += '<p>' + soy.$$escapeHtml('Examples:') + '</p><ul class="examples">';
    var exampleList1114 = opt_data.examples;
    var exampleListLen1114 = exampleList1114.length;
    for (var exampleIndex1114 = 0; exampleIndex1114 < exampleListLen1114; exampleIndex1114++) {
      var exampleData1114 = exampleList1114[exampleIndex1114];
      output += '<li><a href="#">' + soy.$$escapeHtml(exampleData1114) + '</a></li>';
    }
    output += '</ul>';
  }
  output += '</div></aui-inline-dialog>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.formulaHelp.soyTemplateName = 'Confluence.Templates.PlaySQL.formulaHelp';
}


Confluence.Templates.PlaySQL.autocompletePage = function(opt_data, opt_ignored) {
  return ((opt_data.item.type == 'page') ? '<span class="aui-icon aui-icon-small aui-iconfont-page-default"/>' : (opt_data.item.type == 'blogpost') ? '<span class="aui-icon aui-icon-small aui-iconfont-page-blogpost"/>' : '<span class="aui-icon aui-icon-small aui-iconfont-page-blank"/>') + '<a href="#" data-type="' + soy.$$escapeHtml(opt_data.item.type) + '">' + soy.$$escapeHtml(opt_data.item.label) + '</a>' + ((opt_data.item.space != opt_data.spaceKey) ? '<span class="playsql-autocomplete-confluencecontent-spacekey">' + soy.$$escapeHtml(opt_data.item.space) + '</span>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.autocompletePage.soyTemplateName = 'Confluence.Templates.PlaySQL.autocompletePage';
}


Confluence.Templates.PlaySQL.autocompleteUserOrGroup = function(opt_data, opt_ignored) {
  return '' + ((opt_data.item.type == 'user') ? '<img src="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.item.url) + '" alt="Avatar of user ' + soy.$$escapeHtml(opt_data.item.label) + '"><a href="#">' + soy.$$escapeHtml(opt_data.item.label) + '</a>' : (opt_data.item.type == 'group') ? '<img src="' + soy.$$escapeHtml("") + '/images/icons/avatar_group_32.png" alt="Avatar of group ' + soy.$$escapeHtml(opt_data.item.label) + '"><a href="#">' + soy.$$escapeHtml(opt_data.item.label) + '</a>' : '<a href="#">? ' + soy.$$escapeHtml(opt_data.item.label) + '</a>');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.autocompleteUserOrGroup.soyTemplateName = 'Confluence.Templates.PlaySQL.autocompleteUserOrGroup';
}


Confluence.Templates.PlaySQL.imageViewer = function(opt_data, opt_ignored) {
  return '<div id="playsql-imageviewer"><div id="playsql-imageviewer-image"></div><button class="nav exit" tabindex="20">X</button><button class="nav previous">&laquo;</button><button class="nav next">&raquo;</button></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.imageViewer.soyTemplateName = 'Confluence.Templates.PlaySQL.imageViewer';
}


Confluence.Templates.PlaySQL.imageViewerCell = function(opt_data, opt_ignored) {
  return '<a class="playsql-imageviewer-cell" href="' + soy.$$escapeHtml(opt_data.urlToImage) + '"><img src="' + soy.$$escapeHtml(opt_data.urlToSrc) + '" style="' + ((opt_data.maxWidth) ? 'max-width:' + soy.$$escapeHtml(opt_data.maxWidth) + 'px;' : '') + ((opt_data.maxWidth) ? 'max-height:' + soy.$$escapeHtml(opt_data.maxHeight) + 'px;' : '') + '" /></a>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.imageViewerCell.soyTemplateName = 'Confluence.Templates.PlaySQL.imageViewerCell';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'soy/comments.soy' */
// This file was automatically generated from comments.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Comments.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Comments == 'undefined') { Confluence.Templates.Comments = {}; }


Confluence.Templates.Comments.displayReplyEditorLoadingContainer = function(opt_data, opt_ignored) {
  return '<ol class="comment-threads"><li class="comment-thread">' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId, parentId: opt_data.parentCommentId}, commenter: opt_data.commenter, state: 'loading', mode: 'reply'}) + '</li></ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayReplyEditorLoadingContainer.soyTemplateName = 'Confluence.Templates.Comments.displayReplyEditorLoadingContainer';
}


Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId}, commenter: opt_data.commenter, state: 'placeholder', mode: 'add'});
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder.soyTemplateName = 'Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder';
}


Confluence.Templates.Comments.displayEditEditorContainer = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId, id: opt_data.commentId}, commenter: opt_data.commenter, state: 'placeholder', mode: 'edit'});
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayEditEditorContainer.soyTemplateName = 'Confluence.Templates.Comments.displayEditEditorContainer';
}


Confluence.Templates.Comments.editorLoadErrorMessage = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$escapeHtml(opt_data.message) + '</p><p><a href="' + soy.$$escapeHtml(opt_data.fallbackUrl) + '">' + soy.$$escapeHtml('Try again') + '</a></p>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.editorLoadErrorMessage.soyTemplateName = 'Confluence.Templates.Comments.editorLoadErrorMessage';
}


Confluence.Templates.Comments.displayCommentEditorCommon = function(opt_data, opt_ignored) {
  var output = '<div class="quick-comment-container comment ' + soy.$$escapeHtml(opt_data.mode) + '">' + Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}) + '<div class="quick-comment-body"><div class="quick-comment-loading-container" style="display:' + ((opt_data.state == 'loading') ? 'block' : 'none') + ';"></div><div id="editor-messages"></div><div id="any-messages"></div><form style="display:' + ((opt_data.state == 'loading') ? 'none' : 'block') + ';" class="quick-comment-form aui" method="post" ';
  switch (opt_data.mode) {
    case 'add':
      output += 'name="inlinecommentform" action="' + soy.$$escapeHtml("") + '/pages/doaddcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '"';
      break;
    case 'edit':
      output += 'name="editcommentform" action="' + soy.$$escapeHtml("") + '/pages/doeditcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '&commentId=' + soy.$$escapeHtml(opt_data.comment.id) + '"';
      break;
    case 'reply':
      output += 'name="threadedcommentform"  action="' + soy.$$escapeHtml("") + '/pages/doaddcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '&parentId=' + soy.$$escapeHtml(opt_data.comment.parentId) + '"';
      break;
  }
  output += ' >' + ((opt_data.mode == 'add') ? '<div title="' + soy.$$escapeHtml('Add a Comment') + '" role="button" tabindex="0" aria-label="' + soy.$$escapeHtml('Add a Comment') + '" class="quick-comment-prompt"><span>' + soy.$$escapeHtml('Write a comment...') + '</span></div>' : '') + '</form></div></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayCommentEditorCommon.soyTemplateName = 'Confluence.Templates.Comments.displayCommentEditorCommon';
}


Confluence.Templates.Comments.userLogo = function(opt_data, opt_ignored) {
  return '<p class="comment-user-logo">' + ((opt_data.userInfo.userName == null) ? '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/libiju/8703/4mhn8a/_") + '/images/icons/profilepics/anonymous.svg" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml('Anonymous') + '" title="' + soy.$$escapeHtml('Anonymous') + '">' : (opt_data.userInfo.profilePicture.isDefault) ? '<a class="userLogoLink" data-username="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" href="' + soy.$$escapeHtml("") + '/users/profile/editmyprofilepicture.action" title="' + soy.$$escapeHtml('Add a picture of yourself') + '"><img class="userLogo logo defaultLogo" src="' + soy.$$escapeHtml("/s/libiju/8703/4mhn8a/_") + '/images/icons/profilepics/add_profile_pic.svg" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml('Add a picture of yourself') + '"></a>' : '<a class="userLogoLink" data-username="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" href="' + Confluence.Templates.User.userLinkUrl({username: opt_data.userInfo.userName}) + '"><img class="userLogo logo" src="' + soy.$$escapeHtml(opt_data.userInfo.profilePicture.path) + '" alt="' + soy.$$escapeHtml('User icon') + ': ' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" title="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '"></a>') + '</p>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.userLogo.soyTemplateName = 'Confluence.Templates.Comments.userLogo';
}


Confluence.Templates.Comments.displayComment = function(opt_data, opt_ignored) {
  return '' + ((opt_data.comment.parentId == 0 && opt_data.firstReply) ? '<div id="comments-section" class="pageSection group"><div class="section-header"><h2 id="comments-section-title" class="section-title">' + soy.$$escapeHtml('1 Comment') + '</h2>' + Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: true}) + '</div></div>' : (opt_data.firstReply) ? Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: false}) : Confluence.Templates.Comments.commentThreadItem({comment: opt_data.comment, commenter: opt_data.commenter, highlight: true}));
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayComment.soyTemplateName = 'Confluence.Templates.Comments.displayComment';
}


Confluence.Templates.Comments.commentThread = function(opt_data, opt_ignored) {
  return '<ol class="comment-threads' + ((opt_data.topLevel) ? ' top-level" id="page-comments' : '') + '">' + Confluence.Templates.Comments.commentThreadItem(opt_data) + '</ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentThread.soyTemplateName = 'Confluence.Templates.Comments.commentThread';
}


Confluence.Templates.Comments.commentThreadItem = function(opt_data, opt_ignored) {
  return '<li id="comment-thread-' + soy.$$escapeHtml(opt_data.comment.id) + '" class="comment-thread">' + Confluence.Templates.Comments.commentView(opt_data) + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentThreadItem.soyTemplateName = 'Confluence.Templates.Comments.commentThreadItem';
}


Confluence.Templates.Comments.commentView = function(opt_data, opt_ignored) {
  return '<div class="comment' + ((opt_data.highlight == true) ? ' focused' : '') + '" id="comment-' + soy.$$escapeHtml(opt_data.comment.id) + '">' + Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}) + '<div class="comment-header"><h4 class="author">' + ((opt_data.commenter.userName == null) ? soy.$$escapeHtml('Anonymous') : '<a href="' + soy.$$escapeHtml("") + '/display/~' + soy.$$escapeUri(opt_data.commenter.userName) + '" class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.commenter.userName) + '">' + soy.$$escapeHtml(opt_data.commenter.displayName) + '</a>') + '</h4></div><div class="comment-body"><div class="comment-content wiki-content">' + soy.$$filterNoAutoescape(opt_data.comment.html) + '</div><div class="comment-actions">' + Confluence.Templates.Comments.displayCommentActions({section: 'secondary', actions: opt_data.comment.secondaryActions, commentId: opt_data.comment.id}) + Confluence.Templates.Comments.displayCommentActions({section: 'primary', actions: opt_data.comment.primaryActions, commentId: opt_data.comment.id}) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentView.soyTemplateName = 'Confluence.Templates.Comments.commentView';
}


Confluence.Templates.Comments.displayCommentActions = function(opt_data, opt_ignored) {
  var output = '<ul class="comment-actions-' + soy.$$escapeHtml(opt_data.section) + '">';
  if (opt_data.actions != null) {
    var itemList213 = opt_data.actions;
    var itemListLen213 = itemList213.length;
    for (var itemIndex213 = 0; itemIndex213 < itemListLen213; itemIndex213++) {
      var itemData213 = itemList213[itemIndex213];
      output += '<li ' + ((itemData213.style != null) ? ' class="' + soy.$$escapeHtml(itemData213.style) + '"' : '') + '><a ' + ((itemData213.tooltip != null) ? ' title="' + soy.$$escapeHtml(itemData213.tooltip) + '"' : '') + ' href="' + soy.$$escapeHtml(itemData213.url) + '" ' + ((itemData213.id) ? ' id="' + soy.$$escapeHtml(itemData213.id) + '-' + soy.$$escapeHtml(opt_data.commentId) + '"' : '') + '><span>' + soy.$$escapeHtml(itemData213.label) + '</span></a></li>\n';
    }
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayCommentActions.soyTemplateName = 'Confluence.Templates.Comments.displayCommentActions';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/comment-display-manager.js' */
define("confluence-quick-edit/comment-display-manager",["ajs","confluence/legacy","confluence/templates","jquery"],function(g,j,h,c){var i={_updateCommentSectionTitle:function(){var a=c("#comments-section-title");if(0!==a.length){var b=this.commentCount();1===b?a.text("1 Comment"):a.text(g.format("{0} Comments",b))}},addComment:function(a,b,f,d){a={comment:b,commenter:a,highlight:f,context:{contextPath:g.Meta.get("context-path"),staticResourceUrlPrefix:g.Meta.get("static-resource-url-prefix")}};
if(this.hasComments()){if(0===b.parentId)a.firstReply=!1,f=c("#comments-section").find(".comment-threads.top-level");else{var f=c("#comment-thread-"+b.parentId),e=f.children(".commentThreads");e.length?(a.firstReply=!1,f=e):a.firstReply=!0}d||this.clearFocus();d=c(h.Comments.displayComment(a));d.addClass("fadeInComment");f.append(d);this._updateCommentSectionTitle()}else a.firstReply=!0,d=c(h.Comments.displayComment(a)),d.addClass("fadeInComment"),c("#comments-section").prepend(d);j.Comments.bindRemoveConfirmation(b.id);
b=this.getCommentNode(b.id);b.scrollToElement();return b},addOrUpdateComment:function(a,b,c,d){var e=this.getCommentNode(b.id);return e?(e.find(".comment-content").html(b.html),d||this.clearFocus(),c&&e.addClass("focused"),e.addClass("fadeInComment"),e.scrollToElement(),e):this.addComment.apply(this,arguments)},isVisible:function(){return!c("#page-comments").hasClass("hidden")},hasComments:function(){return 0<this.commentCount()},commentCount:function(){return c("#comments-section .comment").not(".quick-comment-container").length},
clearFocus:function(){c(".comment").removeClass("focused")},getCommentNode:function(a){a=c("#comment-"+a);return!a.length?null:a},getParentId:function(a){a=i.getCommentNode(a);return null!=a&&(a=a.closest("div.comment"),a.length)?(a=a.attr("id"),a=/\d+/.exec(a),parseInt(a)):0}};return i});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/comment-display-manager","Confluence.CommentDisplayManager");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/scroll-util.js' */
define("confluence-quick-edit/scroll-util",["window","document","jquery"],function(a,c,e){return{scrollToElement:function(){this.scrollWindowToElement()||this.scrollOverflowContainerToElement();return this},scrollWindowToElement:function(){function b(){return"pageYOffset"in a?a.pageYOffset:c.documentElement.scrollTop}var f=b(),d;if("number"===typeof a.innerWidth)d=a.innerHeight;else if(c.documentElement&&c.documentElement.clientWidth)d=c.documentElement.clientHeight;else return this[0].scrollIntoView(!1),
!0;var g=this.offset().top,h=this.height();return g+h+40>f+d?(this[0].scrollIntoView(!1),a.scrollBy(0,40),f!=b()):!0},scrollOverflowContainerToElement:function(){var b=null;this.parents().each(function(){var a=e(this).css("overflow");if("auto"==a||"scroll"==a)return b=e(this),!1});if(!b)return!1;var a=b.height(),d=this.offset().top,c=this.height(),a=a-(d+c+40);0>a&&(b[0].scrollTop-=a);return!0}}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/scroll-util",function(a){require("jquery").fn.extend(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-core', location = 'utils/quick-reload-timer.js' */
define("confluence-quick-reload/utils/quick-reload-timer",["jquery","underscore"],function(c,d){function a(b,a){this.options=c.extend({min:3E4,max:36E5,inactivity:12E4},a);d.bindAll(this,"start","stop","_now","_timeSinceLastSeen","_setActive","_setActivityTrigger","_clamp","_intervalMultiplier");this.callback=b;this._timer=null;this._setActivityTrigger(this._setActive)}a.prototype.start=function(b){this.lastSeenTimestamp=this._now();this.stop();b&&this.callback();var a=function(){this.callback();
c.call(this)},c=function(){this.stop();this._timer=setTimeout(d.bind(a,this),this.options.min*this._intervalMultiplier())};c.call(this)};a.prototype.stop=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)};a.prototype._setActive=function(){if(null!==this._timer){var b=this._timeSinceLastSeen()>this.options.inactivity;this.lastSeenTimestamp=this._now();b&&this.start(!0)}};a.prototype._setActivityTrigger=function(b){document.addEventListener("visibilitychange",function(){document.hidden||
b()},!1);c(window).focus(b);c("body").click(b);c(window).scroll(b)};a.prototype._now=function(){return(new Date).getTime()};a.prototype._timeSinceLastSeen=function(){return this._now()+1-this.lastSeenTimestamp};a.prototype._clamp=function(b,a,c){a=Math.max(Math.min(a,c),b);return isNaN(a)?b:a};a.prototype._intervalMultiplier=function(){var a=(document.hidden?3:1)*Math.ceil(this._timeSinceLastSeen()/this.options.inactivity);return this._clamp(1,this.options.max/this.options.min,a)};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-core', location = 'main/quick-reload-manager.js' */
define("confluence-quick-reload/main/quick-reload-manager","underscore jquery ajs confluence/api/constants confluence-quick-reload/utils/quick-reload-timer confluence/meta confluence/api/logger".split(" "),function(f,e,m,h,k,g,l){function a(){this.enabled=!1;this.handlers=[];this.lastFetchTime=e('meta[name\x3d"confluence-request-time"]').attr("content")||(new Date).getTime();this.timer=null;f.bindAll(this,"addHandler","removeHandler","update","enable","disable","onUpdateSuccess","onUpdateError")}
a.prototype.addHandler=function(b){var a=!1,d;for(d=0;d<this.handlers.length;d++)this.handlers[d]===b&&(a=!0);!0!==a&&this.handlers.push(b)};a.prototype.removeHandler=function(b){var a;if(b)for(a=0;a<this.handlers.length;a++)if(this.handlers[a]===b){this.handlers.splice(a,1);break}};a.prototype.update=function(){var a=void 0!==g.get("page-id")?g.get("page-id"):"0";e("body").hasClass("contenteditor")?this.disable():e.ajax({type:"GET",url:h.CONTEXT_PATH+"/rest/quickreload/latest/"+a+"?since\x3d"+encodeURIComponent(this.lastFetchTime),
dataType:"json"}).done(this.onUpdateSuccess).fail(this.onUpdateError)};a.prototype.enable=function(){this.enabled||(null===this.timer&&(this.timer=new k(this.update)),this.timer.start(),this.enabled=!0)};a.prototype.disable=function(){null!==this.timer&&this.timer.stop();this.enabled=!1};a.prototype.isEnabled=function(){return this.enabled};a.prototype.onUpdateSuccess=function(a,e,d){204!==d.status&&(this.lastFetchTime=a.time,f.map(this.handlers,function(b){var c=a[b.property];Array.isArray(c)||(c=
[c]);c=b.filterNewResults(b.results,c);0<c.length&&(b.results=b.results.concat(c),b.render(c))},this))};a.prototype.onUpdateError=function(a){if(a={404:"not found - the plugin has been probably been removed or disabled from Confluence",500:"generic server error",503:"service unavailable",504:"gateway timeout"}[(a||{}).status])this.disable(),l.error('Quick comment reload plugin has been disabled in this page due to a server error: "'+a+'". Please refresh the page to get it back.')};return new a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-read-only-mode-handler', location = 'handlers/quick-reload-read-only-mode.js' */
define("confluence-quick-reload/handlers/quick-reload-read-only-mode",["ajs","jquery","confluence/message-controller","confluence/meta","confluence/api/event"],function(f,k,a,e,g){return{results:[],property:"readOnlyMode",filterNewResults:function(a,c){return 0<c.length&&"string"!==typeof c[0]?c:[]},render:function(b){b=b[0];var c=e.get("access-mode"),d=b.isEnabled?"READ_ONLY":"READ_WRITE",h="READ_ONLY"===e.get("render-mode")?"We\u0027re back! \u003ca onclick=\u0022location.reload()\u0022\u003eRefresh\u003c/a\u003e the page to edit and make changes.":"We\u0027re back! You can now edit and make changes.";
if(!a.hasSuccess(a.Location.BANNER)||b.isEnabled)e.set("access-mode",d),d!==c&&g.trigger("qr:access-mode",{accessMode:d}),this.shouldDisplayError(b)?a.hasErrors(a.Location.BANNER)||this.showError(b.bannerMessage):"READ_ONLY"===c&&"READ_WRITE"===d?this.showSuccess(h):this.clearAll()},clearAll:function(){a.clearErrors(a.Location.ALL);a.clearSuccess(a.Location.ALL)},showError:function(b){a.clearSuccess(a.Location.ALL);a.showError(b,a.Location.BANNER)},showSuccess:function(b){a.clearErrors(a.Location.ALL);
a.showSuccess(b,a.Location.BANNER,{closeable:!0})},shouldDisplayError:function(a){return a.isBannerMessageOn||a.isEnabled}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'main/quick-reload.soy' */
// This file was automatically generated from quick-reload.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace QuickReload.Templates.
 */

if (typeof QuickReload == 'undefined') { var QuickReload = {}; }
if (typeof QuickReload.Templates == 'undefined') { QuickReload.Templates = {}; }


QuickReload.Templates.pageAttachments = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors"></div><div class="qr-notice-summary qr-notice-summary-attachments">' + aui.buttons.button({text: 'Reload page', type: 'text', extraClasses: 'qr-notice-show aui-button-link'}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.pageAttachments.soyTemplateName = 'QuickReload.Templates.pageAttachments';
}


QuickReload.Templates.pageEdit = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.pageEditors}) + '</div><div class="qr-notice-summary">' + aui.buttons.button({text: 'Reload page', type: 'text', extraClasses: 'qr-notice-show aui-button-link'}) + QuickReload.Templates.summaryText({users: opt_data.pageEditors}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.pageEdit.soyTemplateName = 'QuickReload.Templates.pageEdit';
}


QuickReload.Templates.pageComment = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.commentUsers}) + ((opt_data.commentUsers.length == 1) ? '<span class="qr-notice-text">"' + soy.$$escapeHtml(opt_data.noticeText) + '"</span>' : '') + '</div><div class="qr-notice-summary">' + aui.buttons.button({text: '' + ((opt_data.commentUsers.length > 1) ? soy.$$escapeHtml('Show all') : soy.$$escapeHtml('Show')), type: 'text', extraClasses: 'qr-notice-show aui-button-link'}) + QuickReload.Templates.summaryText({users: opt_data.commentUsers}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.pageComment.soyTemplateName = 'QuickReload.Templates.pageComment';
}


QuickReload.Templates.inlineComment = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.user}) + '<span class="qr-notice-text">"' + soy.$$escapeHtml(opt_data.noticeText) + '"</span></div><div class="qr-notice-summary">' + aui.buttons.button({text: '' + ((opt_data.reloadRequired) ? soy.$$escapeHtml('Reload page') : soy.$$escapeHtml('Show')), type: 'text', extraClasses: 'qr-notice-show aui-button-link', extraAttributes: ['data-reload-required', opt_data.reloadRequired]}) + QuickReload.Templates.summaryText({users: opt_data.user}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.inlineComment.soyTemplateName = 'QuickReload.Templates.inlineComment';
}


QuickReload.Templates.container = function(opt_data, opt_ignored) {
  return '<div class="qr-container">' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  QuickReload.Templates.container.soyTemplateName = 'QuickReload.Templates.container';
}


QuickReload.Templates.noticeHeader = function(opt_data, opt_ignored) {
  var output = '';
  var userList77 = opt_data.users;
  var userListLen77 = userList77.length;
  for (var userIndex77 = 0; userIndex77 < userListLen77; userIndex77++) {
    var userData77 = userList77[userIndex77];
    output += (userIndex77 < 8) ? aui.avatar.avatar({size: 'small', avatarImageUrl: userData77.profilePicture.path, title: userData77.displayName != '' ? userData77.displayName : 'Anonymous', extraClasses: 'qr-author-avatar'}) : '';
  }
  return output;
};
if (goog.DEBUG) {
  QuickReload.Templates.noticeHeader.soyTemplateName = 'QuickReload.Templates.noticeHeader';
}


QuickReload.Templates.summaryText = function(opt_data, opt_ignored) {
  var output = '';
  var lastModifier__soy87 = opt_data.users[0];
  var others__soy88 = opt_data.users.length - 1;
  output += '<span class="qr-notice-summary-text">' + soy.$$escapeHtml('by') + ' ' + Confluence.Templates.User.usernameLink({canView: false, username: lastModifier__soy87.userName, fullName: lastModifier__soy87.displayName != '' ? lastModifier__soy87.displayName : 'Anonymous'}) + ((others__soy88 == 1) ? ' ' + soy.$$escapeHtml('and 1 other') : '') + ((others__soy88 > 1) ? ' ' + soy.$$escapeHtml(AJS.format('and {0} others',others__soy88)) : '') + '</span>';
  return output;
};
if (goog.DEBUG) {
  QuickReload.Templates.summaryText.soyTemplateName = 'QuickReload.Templates.summaryText';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'utils/quick-reload-count.js' */
define("confluence-quick-reload/utils/quick-reload-count",[],function(){function a(){this.count=0}var b=document.title;a.prototype.getCount=function(){return this.count};a.prototype.setCount=function(a){this.count=a;this._displayCount()};a.prototype._displayCount=function(){document.title=(0<this.count?"("+this.count+") ":"")+b};return new a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-comments.js' */
define("confluence-quick-reload/handlers/quick-reload-comments","ajs underscore jquery confluence/flag confluence/api/event confluence-quick-reload/utils/quick-reload-count confluence/legacy".split(" "),function(l,c,e,m,n,h,b){function p(a){a=c.clone(a);a.reverse();a=c.uniq(a,function(a){return a.commenter.userName});return c.map(a,function(a){return a.commenter})}function q(a){b&&b.CommentDisplayManager&&(b.CommentDisplayManager.clearFocus(),c.map(a,function(a){var c=null!==b.CommentDisplayManager.getCommentNode(g(a));
a=b.CommentDisplayManager.addOrUpdateComment(a.commenter,a.comment,!0,!0);b.Likes&&!c&&(b.Likes.appendAction(e(a)),b.Likes.updateComment(e(a),{}))}),b.CommentDisplayManager._updateCommentSectionTitle(),n.trigger("ic-jim-async-supported"))}function g(a){return a.comment.id}var d,f=[];return{results:[],property:"comments",ignoreOnce:function(a){f.push(a)},filterNewResults:function(a,b){if(0===b.length)return b;var d=c.map(a,g);return c.filter(b,function(a){if(a.comment.isInlineComment)return!1;a=g(a);
if(c.contains(d,a))return!1;a=e.inArray(a,f);return 0<=a?(f.splice(a,1),!1):!0})},render:function(a){h.setCount(h.getCount()+a.length);a={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};var b=1<this.results.length?l.format("{0} New comments",this.results.length):"New comment",k=p(this.results),g=e("\x3cdiv\x3e\x3c/div\x3e").html(this.results[this.results.length-1].comment.html).text();k=QuickReload.Templates.pageComment({commentUsers:k,
noticeText:g});var f=this;void 0===d||"true"===d.getAttribute("aria-hidden")?(d=new m(e.extend({},{body:k,title:b},a)),e(d).on("click",".qr-notice-show",c.bind(function(){q(f.results);d.close()},this)),e(d).on("aui-flag-close",c.bind(function(){h.setCount(h.getCount()-f.results.length);f.results=[]},this))):(e(d).find(".qr-container").replaceWith(k),e(d).find(".title").text(b))}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-inline-comments.js' */
define("confluence-quick-reload/handlers/quick-reload-inline-comments","underscore jquery ajs confluence/flag confluence/meta confluence/api/event confluence-quick-reload/utils/quick-reload-count".split(" "),function(c,e,l,u,r,t,h){function n(a,b,c,f,d){a=QuickReload.Templates.inlineComment({user:[a.commenter],noticeText:v(a),reloadRequired:b});d=1<d?"New inline comments":"New inline comment";d=new u(e.extend({},{title:d,body:a},{close:"manual",
type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"}));e(d).find(".qr-notice-show").click(c);b||e(d).find(".qr-notice-show").click(d.close);e(d).on("aui-flag-close",f)}function v(a){return a&&a.comment&&e("\x3cdiv\x3e\x3c/div\x3e").text(a.comment.html).text()}function m(a){return 0===a.comment.parentId}function k(a){return m(a)?a.comment.id:a.comment.parentId}return{results:[],property:"comments",filterNewResults:function(a,b){b=c.clone(b);b=c.filter(b,function(a){return a.comment.isInlineComment&&
a.commenter.userName!==r.get("remote-user")});if(0<b.length){var e=c.map(a,k);a=c.filter(b,m);b=c.filter(b,function(a){return!m(a)});var f=c.map(a,k),d=c.map(b,k),h=c.difference(d,f),g=[];b=c.filter(b,function(a){return-1!==h.indexOf(a.comment.parentId)&&-1===g.indexOf(a.comment.parentId)?(g.push(a.comment.parentId),!0):!1});a=a.concat(b);b=c.filter(a,function(a){return-1===e.indexOf(k(a))})}return b},render:function(a){h.setCount(h.getCount()+a.length);var b=this;c.each(a,function(a){var f=k(a),
d=function(){t.trigger("qr:show-new-thread",f)},l=function(){var a=r.Links.canonical(),b=-1===a.indexOf("?")?"?":"\x26";window.location=a+b+"focusedCommentId\x3d"+f+"#comment-"+f},g=function(){b.results=c.filter(b.results,function(a){return k(a)!==f});h.setCount(h.getCount()-1)};g=c.bind(g,this);var p=this.results.length;if(m(a)){var q=new e.Deferred;q.fail(function(a){n(a,!0,l,g,p)});q.done(function(a){n(a,!1,d,g,p)});t.trigger("qr:add-new-highlight",[a,q])}else n(a,!1,d,g,p)},this)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-page.js' */
define("confluence-quick-reload/handlers/quick-reload-page",["underscore","jquery","ajs","confluence/flag","confluence-quick-reload/utils/quick-reload-count"],function(d,c,g,l,e){function m(a){a=d.clone(a);a.reverse();a=d.uniq(a,function(a){return a.editor.userName});return d.map(a,function(a){return a.editor})}var b;return{results:[],property:"page",filterNewResults:function(a,b){return 0<b.length&&"string"!==typeof b[0]?b:[]},render:function(a){e.setCount(e.getCount()+a.length);a={close:"manual",
type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};var h=1<this.results.length?g.format("{0} new edits",this.results.length):"New page edits",f=m(this.results);f=QuickReload.Templates.pageEdit({pageEditors:f});var k=this;void 0===b||"true"===b.getAttribute("aria-hidden")?(b=new l(c.extend({},{body:f,title:h},a)),c(b).on("click",".qr-notice-show",function(){c(this).prop("disabled",!0).prepend('\x3cspan class\x3d"aui-icon aui-icon-wait"\x3e\x3c/span\x3e\x26nbsp;');
window.location.reload()}),c(b).on("aui-flag-close",d.bind(function(){e.setCount(e.getCount()-k.results.length);k.results=[]},this))):(c(b).find(".qr-container").replaceWith(f),c(b).find(".title").text(h))}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-attachments.js' */
define("confluence-quick-reload/handlers/quick-reload-attachments",["underscore","jquery","ajs","confluence/flag","confluence-quick-reload/utils/quick-reload-count"],function(h,a,k,l,d){var b;return{results:[],property:"attachmentsCount",filterNewResults:function(b,a){const c=a[0];return"number"===typeof c&&0<c?(b.length=0,a):[]},render:function(c){c=c[0]||0;d.setCount(d.getCount()+c);c={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"};const e="Files on this page have changed",
f=QuickReload.Templates.pageAttachments({});if(void 0===b||"true"===b.getAttribute("aria-hidden")){b=new l(a.extend({},{body:f,title:e},c));a(b).on("click",".qr-notice-show",function(){a(this).prop("disabled",!0).prepend('\x3cspan class\x3d"aui-icon aui-icon-wait"\x3e\x3c/span\x3e\x26nbsp;');window.location.reload()});const g=this;a(b).on("aui-flag-close",h.bind(function(){d.setCount(d.getCount()-(g.results[0]||0));g.results=[]},this))}else a(b).find(".qr-container").replaceWith(f),a(b).find(".title").text(e)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-bootstrap', location = 'main/quick-reload-main.js' */
require("ajs confluence/dark-features confluence-quick-reload/main/quick-reload-manager confluence-quick-reload/handlers/quick-reload-comments confluence-quick-reload/handlers/quick-reload-inline-comments confluence-quick-reload/handlers/quick-reload-page confluence-quick-reload/handlers/quick-reload-read-only-mode confluence-quick-reload/handlers/quick-reload-attachments confluence/legacy".split(" "),function(b,d,a,c,e,f,g,h,k){b.toInit(function(){if(d.isEnabled("quickreload.disabled")||!k.CommentDisplayManager?
0:void 0!==b.Meta.get("page-id"))a.addHandler(c),a.addHandler(e),a.addHandler(f),a.addHandler(h),a.addHandler(g),a.enable(),b.bind("page.commentAddedOrUpdated",function(a,b){c.ignoreOnce(b.commentId)})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:sortable-table-hooks', location = 'js/hooks.js' */
define("confluence-sortable-tables/hooks",[],function(){var a=[];return{onBeforeInit:function(b){a.push(b)},beforeInitHooks:function(){return a}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/tablesorter-date-parser.js' */
require(["ajs","jquery","confluence-sortable-tables/hooks"],function(d,c,a){a.onBeforeInit(function(a){a.addParser({id:"dateAttributeParser",is:function(a,e,b){return c(b).is(".content-report-table-macro .modified")},format:function(a,e,b,d){return c(b).attr("data-sortable-date")},type:"numeric"})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/soy/content-report-table.soy' */
// This file was automatically generated from content-report-table.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Plugins.ContentReport.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Plugins == 'undefined') { Confluence.Templates.Plugins = {}; }
if (typeof Confluence.Templates.Plugins.ContentReport == 'undefined') { Confluence.Templates.Plugins.ContentReport = {}; }


Confluence.Templates.Plugins.ContentReport.contentReportTable = function(opt_data, opt_ignored) {
  var output = '';
  var hasSocialColumn__soy3 = opt_data.showCommentsCount || opt_data.showLikesCount;
  if (opt_data.results.length == 0 && opt_data.blueprintKey) {
    output += '<div class="blueprint-blank-experience ' + soy.$$escapeHtml(opt_data.blueprintKey) + '"><div class="content"><h2>' + soy.$$escapeHtml(opt_data.blankTitle) + '</h2><p>' + soy.$$escapeHtml(opt_data.blankDescription) + '</p></div>' + ((opt_data.createButtonLabel) ? '<p><button class="create-from-template-button aui-button aui-button-primary" data-space-key="' + soy.$$escapeHtml(opt_data.dataSpaceKey) + '" data-content-blueprint-id="' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '" href="' + soy.$$escapeHtml(opt_data.createContentUrl) + '" >' + soy.$$escapeHtml(opt_data.createButtonLabel) + '</button></p>' : '') + '</div>';
  } else {
    output += '<table class="aui content-report-table-macro' + ((hasSocialColumn__soy3) ? ' with-extra-columns' : '') + '"' + ((opt_data.analyticsKey) ? ' data-analytics-key="' + soy.$$escapeHtml(opt_data.analyticsKey) + '"' : '') + '><thead><tr><th>' + soy.$$escapeHtml('Title') + '</th><th>' + soy.$$escapeHtml('Creator') + '</th><th>' + soy.$$escapeHtml('Modified') + '</th></tr></thead><tbody>';
    var resultList43 = opt_data.results;
    var resultListLen43 = resultList43.length;
    if (resultListLen43 > 0) {
      for (var resultIndex43 = 0; resultIndex43 < resultListLen43; resultIndex43++) {
        var resultData43 = resultList43[resultIndex43];
        output += '<tr><td class="title"><a href="' + soy.$$escapeHtml(resultData43.urlPath) + '">' + soy.$$escapeHtml(resultData43.title) + '</a></td><td class="creator">' + Confluence.Templates.User.usernameLink({canView: opt_data.canViewProfiles, username: resultData43.creatorName, fullName: resultData43.creatorFullName, contextPath: opt_data.contextPath}) + '</td><td class="modified" data-sortable-date="' + soy.$$escapeHtml(resultData43.sortableDate) + '">' + soy.$$escapeHtml(resultData43.friendlyModificationDate) + '</td>' + ((hasSocialColumn__soy3) ? '<td class="social">' + ((opt_data.showCommentsCount && resultData43.commentCount != 0) ? '<span class="icon icon-comment"></span> <span class="count">' + soy.$$escapeHtml(resultData43.commentCount) + '</span>' : '') + ((opt_data.showLikesCount && resultData43.likeCount != 0) ? '<span class="icon icon-like"></span> <span class="count">' + soy.$$escapeHtml(resultData43.likeCount) + '</span>' : '') + '</td>' : '') + '</tr>';
      }
    } else {
      output += '<tr><td colspan="3">' + soy.$$escapeHtml('No content found.') + '</td></tr>';
    }
    output += '</tbody></table>' + ((opt_data.searchMoreResultsLinkUrl) ? '<div class="more-results"><a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.searchMoreResultsLinkUrl) + '">' + soy.$$escapeHtml('Find more results') + '</a></div>' : '');
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Plugins.ContentReport.contentReportTable.soyTemplateName = 'Confluence.Templates.Plugins.ContentReport.contentReportTable';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/content-report-analytics.js' */
require(["ajs"],function(b){b.toInit(function(c){c(".content-report-table-macro").on("click",".title a",function(a){(a=c(a.delegateTarget).data("analytics-key"))&&b.trigger("analytics",{name:"content-report-table-macro.content-click."+a})})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:sortable-table-loader', location = 'js/loader.js' */
require(["ajs","wrm"],function(a,b){a.toInit(function(){a.$("#main").find("table").length&&b.require("wrc!sortable-tables-resources")})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/doctheme-utils.js' */
Confluence.DocThemeUtils=Confluence.DocThemeUtils||function(a){function d(){return c().length?!0:!1}function c(){b||(b=a("#splitter-content"));return b}var b;return{isDocTheme:d,appendAbsolutePositionedElement:function(b){var e=a(b);a(b).appendTo(d()?c():a("body"));return e},getMainContentScrollTop:function(){return d()?c().scrollTop():a(document).scrollTop()},getMainContentScrollLeft:function(){return d()?c().scrollLeft():a(document).scrollLeft()},getDocThemeContentElement:c}}(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/scrolling-inline-dialog.js' */
Confluence.ScrollingInlineDialog=function(x,y,z,d){var g=Confluence.DocThemeUtils.getDocThemeContentElement(),h=Confluence.DocThemeUtils.isDocTheme();d=d||{};!d.container&&h&&(d.container=g);var A=function(e,b,d,f){var p="auto",u=-7,v=h?g.width():AJS.$(window).width(),a=b.target.position();a.top+=h?g.scrollTop():0;a.left+=h?g.scrollLeft():0;var l=b.target.outerWidth();var t=a.left+l/2,w=h?g.scrollTop()+AJS.$(window).height()-AJS.$("#footer").outerHeight():(window.pageYOffset||document.documentElement.scrollTop)+
AJS.$(window).height();l=a.top+b.target.outerHeight()+f.offsetY;var n=e.find(".arrow").outerWidth(),k=e.outerWidth();var c=b.target.outerWidth();f.centerOnHighlight?k>c?(b=a.left-(k-c)/2,c=t-b-n/2):(b=a.left+f.offsetX,c=(k-n)/2):(b=a.left+f.offsetX,c=k>c?t-b-n/2:(k-n)/2);c=0>c?0:c;var m=h?a.top-g.scrollTop():a.top-(window.pageYOffset||document.documentElement.scrollTop),q=f.maxHeight||0,r=e.height();m=m>Math.max(r,q);q=l+e.height()<w;e=!q&&m||f.onTop;f.onTop=e;m=v-(b+k+10);e&&(l=a.top-r-8,u=r);!1===
e&&!1===q&&(a=l+r-w,a=h?g.scrollTop()+a+AJS.$("#footer").outerHeight():(window.pageYOffset||document.documentElement.scrollTop)+a+20,(h?g:AJS.$("html, body")).stop().animate({scrollTop:a},500));f.isRelativeToMouse?0>m?(p=10,b="auto",c=d.x-(AJS.$(window).width()-f.width)):(b=d.x-20,c=d.x-b):0>m&&(p=10,b="auto",c=t-(v-p-k)-n/2);return{displayAbove:e,popupCss:{left:b,right:p,top:l},arrowCss:{position:"absolute",left:c,right:"auto",top:u}}};d.calculatePositions||(d.calculatePositions=A);return AJS.InlineDialog.call(this,
x,y,z,d)};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-panel.js' */
Confluence.HighlightAction=function(d){function n(e){var c={};c.pageId=e.pageId;c.selectedText=e.selectedText;c.index=e.index;c.numMatches=e.numMatches;c.lastFetchTime=d("meta[name\x3d'confluence-request-time']").attr("content");return c}var l={},m,p={MAINCONTENT_AND_COMMENT:function(e){return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(d(".wiki-content"),e)},MAINCONTENT_ONLY:function(e){m=m||d(".wiki-content").first();return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(m,
e)},COMMENT_ONLY:function(e){return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(d(".comment-content"),e)}};return{registerButtonHandler:function(e,c){l[e]=d.extend({onClick:function(){},shouldDisplay:p.MAINCONTENT_AND_COMMENT},c)},getButtonHandler:function(d){var c=l[d];c||(c=function(){AJS.logError("The button with key "+d+" doesn't have a registered handler")});return c},insertContentAtSelectionEnd:function(e){var c=Confluence.getContextPath()+"/rest/highlighting/1.0/insert-storage-fragment";
return d.ajax({type:"POST",contentType:"application/json",url:c,data:JSON.stringify(e)})},insertContentsInTableColumnCells:function(e){var c=Confluence.getContextPath()+"/rest/highlighting/1.0/insert-storage-column-table";return d.ajax({type:"POST",contentType:"application/json",url:c,data:JSON.stringify(e)})},createTableInsertionBean:function(d,c,g){g=n(g);g.tableColumnIndex=c;g.cellModifications=d;return g},createInsertionBean:function(d,c){c=n(c);c.xmlModification=d[0].xmlInsertion;return c},createXMLModificationBean:function(d,
c){c=n(c);c.xmlModification=d;return c},clearTextSelection:function(){window.getSelection?(window.getSelection().empty&&window.getSelection().empty(),window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()):window.document.selection&&window.document.selection.empty()},WORKING_AREA:p}}(AJS.$);
Confluence.HighlightAction.RangeHelper=function(d){function n(a){var c=Confluence.DocThemeUtils.getMainContentScrollTop(),k=Confluence.DocThemeUtils.getMainContentScrollLeft(),f=a.getClientRects();if(!f.length&&a.parentElement()){f=d(a.parentElement());var h=f.offset();f=[{top:h.top-(Confluence.DocThemeUtils.isDocTheme()?0:c),left:h.left-(Confluence.DocThemeUtils.isDocTheme()?0:k),bottom:h.top+f.height(),right:h.left+f.width()}]}f=e(a,f);h=function(a){if(Confluence.DocThemeUtils.isDocTheme()){var c=
Confluence.DocThemeUtils.getDocThemeContentElement().offset();a.left-=c.left;a.right-=c.left;a.top-=c.top;a.bottom-=c.top}return a};a=h(function(a,d){var b={};b.top=a.top;b.left=a.left+k;b.bottom=d.bottom;b.right=a.left>=d.right?a.right:d.right;b.right+=k;b.top+=c;b.bottom+=c;b.width=b.right-b.left;b.height=b.bottom-b.top;return b}(f.first,f.last));f=h(function(a){var b={};b.width=a.right-a.left;b.height=a.bottom-a.top;b.left=a.left+k;b.right=a.right+k;b.top=a.top+c;b.bottom=a.bottom+c;return b}(f.first));
Confluence.HighlightAction.debug&&(h=d("\x3cdiv\x3e").attr("id","highlight-actions-debug-helper"),Confluence.DocThemeUtils.appendAbsolutePositionedElement(h).css(d.extend({position:"absolute",outline:"1px solid red"},a)));return{first:f,average:a}}function l(a){return(void 0!=a.text?a.text:a.cloneContents().textContent).replace(/\u00a0/g," ")}function m(a){return a.cloneContents?d("\x3cdiv\x3e").append(a.cloneContents()).html():a.htmlText}function p(a){if(a.commonAncestorContainer)return a=a.commonAncestorContainer,
3==a.nodeType?a.parentNode:a;if(a.parentElement)return a.parentElement()}function e(a,b){var c={};c.first=b[0];c.last=b[b.length-1];"undefined"!==a.endOffset&&0==a.endOffset&&1<b.length&&(c.last=b[b.length-2]);return c}function c(a,b){var c=p(b);return function(){var b=!1;d.each(a,function(a,f){if(f===c||d.contains(f,c))return b=!0,!1});return b}()}function g(a){if(document.createRange)return a.text();range=document.body.createTextRange();range.moveToElementText(a.get(0));return range.text}function q(a,
b,c){var f=b.find('.user-mention, a[href^\x3d"/"], thead:hidden.tableFloatingHeader');b.find('.conf-macro[data-hasbody\x3d"false"], .jira-issue, .jira-issues').each(function(){-1<d(this).text().indexOf(a)&&(f=f.add(this))});if(0<f.length){var k=a.replace(/\S/g," "),e=new RegExp(a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26"),"g");f.each(function(){var a=d(this).text();d(this).text(a.replace(e,k))});return g(b)}return c}return{getRangeOption:function(a){return{area:n(a),text:l(a),html:m(a),containingElement:p(a),
range:a}},getUserSelectionRange:function(){if(window.getSelection&&window.getSelection().isCollapsed||document.selection&&("None"==document.selection.type||""==document.selection.createRange().htmlText))return!1;if(window.getSelection){var a=window.getSelection();a=a.getRangeAt(a.rangeCount-1)}else document.selection&&(a=document.selection.createRange());if(/^\s*$/.test(l(a))){var b=m(a);if(!b||-1==b.toLowerCase().indexOf("\x3cimg "))return!1}return c(d(".wiki-content"),a)?a:!1},getSelectionRects:n,
getSelectionText:l,getSelectionHTML:m,getContainingElement:p,getFirstAndLastSelectionRect:e,isSelectionInsideContent:c,computeSearchTextObject:function(a,b){if(document.createRange){var c=document.createRange();c.setStart(a.get(0),0);c.setEnd(b.endContainer,b.originalEndOffset)}else c=document.body.createTextRange(),c.moveToElementText(a.get(0)),c.setEndPoint("EndToEnd",b);c=l(c);b=d.trim(l(b));var f=g(a);f=q(b,a.clone(),f);f=f.replace(/\u00a0/g," ");var e=0;for(a=[];-1<(e=f.indexOf(b,e));)a.push(e),
e+=1;c=c.replace(/\s*$/,"");return{pageId:AJS.Meta.get("page-id"),selectedText:b,index:d.inArray(c.length-b.length,a),numMatches:a.length}}}}(AJS.$);
AJS.toInit(function(d){function n(a){var b=m(),k=29*a.length,f=Confluence.HighlightPanel.Templates.panelContent({webItems:a}),h=!1,r=function(a){var b=!1;a.find("button").each(function(a){a=d(this);var c=a.attr("data-key");c=Confluence.HighlightAction.getButtonHandler(c).shouldDisplay(g);a.css("display",c?"inline-block":"none");b=b||c});b?a.find(".contents").width("auto"):c.hide()};c=Confluence.ScrollingInlineDialog(e,"selection-action-panel",function(a,b,e){h||(a.append(f),a.find(".aui-button").tooltip({gravity:"s"}),
a.parent().children().attr("unselectable","on").on("selectstart",!1),a.find("button").click(function(a){a=d(this).attr("data-key");a=Confluence.HighlightAction.getButtonHandler(a);c.hide();var b=Confluence.HighlightAction.RangeHelper.getRangeOption(g);""!==d.trim(b.text)&&(b.searchText=Confluence.HighlightAction.RangeHelper.computeSearchTextObject(p,g));a.onClick(b)}));e();h=!0;return!1},{centerOnHighlight:!0,onTop:!0,fadeTime:0,width:k,persistent:!0,initCallback:function(){Confluence.HighlightAction.Analytics.sendAnalyticsForOpeningHighlightOptionPanel();
r(this.popup);b.bindHideEvents();e.show()},hideCallback:function(){b.unbindHideEvents();e.hide()}})}function l(a){var b;d(document).on("mouseup",function(k){a.done(function(a){a&&0<a.length&&0===d(k.target).closest(".aui-inline-dialog").length&&setTimeout(function(){clearTimeout(b);var a=1E3;d(c[0]).is(":visible")&&(a=0);b=setTimeout(function(){g=Confluence.HighlightAction.RangeHelper.getUserSelectionRange();g.originalEndOffset=g.endOffset;if(g&&""!==d.trim(g.toString())){var a=Confluence.HighlightAction.RangeHelper.getSelectionRects(g),
b;if(b=a)Confluence.DocThemeUtils.appendAbsolutePositionedElement(e),b=!1,q&&a.first.top==q.first.top&&a.first.height==q.first.height&&a.first.left==q.first.left&&a.first.width==q.first.width||(e.css({top:a.first.top,height:a.first.height,left:a.first.left,width:a.first.width}),q=a,b=!0),b=b||!d(c[0]).is(":visible");b&&(d(c[0]).hide(),c.show())}else c.hide()},a)},0)})});a.done(function(){AJS.bind("quickedit.success",function(){c.hide()})})}function m(){var a=!1,b=function(){a||(d("body").bind("click.selection-action-panel.inline-dialog-check",
function(a){0===d(a.target).closest("#inline-dialog-selection-action-panel .contents").length&&(g||c.hide())}),a=!0)},e=function(a){27===a.keyCode&&c.hide()};return{bindHideEvents:function(){b();d(document).on("keydown",e)},unbindHideEvents:function(){a&&d("body").unbind("click.selection-action-panel.inline-dialog-check");a=!1;d(document).off("keydown",e)}}}var p=d(".wiki-content").first(),e=d("\x3cdiv\x3e").attr("id","action-dialog-target"),c,g,q;(function(){var a=Confluence.getContextPath()+"/rest/highlighting/1.0/panel-items",
b=AJS.Meta.get("page-id");void 0!=b&&(a=a+"?pageId\x3d"+b);a=d.get(a,function(a){a.length&&n(a)});l(a)})()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/quote-in-comment.js' */
AJS.toInit(function(c){function f(){if(Confluence.DocThemeUtils.isDocTheme()){var a=Confluence.DocThemeUtils.getDocThemeContentElement(),b=a.scrollTop()-c("#header").height()+c("#rte-toolbar").offset().top;a.scrollTop(b-40)}else b=c("#rte-toolbar").offset().top,c(document).scrollTop(b-40)}function d(a,b){a.execCommand("mceInsertContent",!1,"\x3cblockquote\x3e\x3cp\x3e"+b.html+"\x3c/p\x3e\x3c/blockquote\x3e\x3cp\x3e\x3cbr/\x3e\x3c/p\x3e")}function g(a){Confluence.HighlightAction.clearTextSelection();
setTimeout(function(){var b=AJS&&AJS.Rte&&AJS.Rte.getEditor&&AJS.Rte.getEditor();if(b)Confluence.HighlightAction.Analytics.sendAnalyticsForQuoteInComment(),f(),d(b,a);else{Confluence.HighlightAction.Analytics.sendAnalyticsForQuoteInComment(!0);var e=function(){d(AJS.Rte.getEditor(),a);AJS.unbind("quickedit.visible",e)};AJS.bind("quickedit.visible",e);h(c(a.containingElement).closest("div.comment"))}},0)}function h(a){0< !a.length?c(".quick-comment-prompt").click():a.find(".comment-actions .action-reply-comment").click()}
Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-highlight-actions:quote-comment",{onClick:g,shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_AND_COMMENT})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-analytics.js' */
Confluence.HighlightAction.Analytics=function(d){function a(a,c){AJS.trigger("analytics",{name:a,data:c})}return{sendAnalyticsForOpeningHighlightOptionPanel:function(){a("confluence.highlight.actions.open")},sendAnalyticsForQuoteInComment:function(b){b?a("confluence.quote.in.comment.insert"):a("confluence.quote.in.comment.append")}}}(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/soy/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.HighlightPanel.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.HighlightPanel == 'undefined') { Confluence.HighlightPanel = {}; }
if (typeof Confluence.HighlightPanel.Templates == 'undefined') { Confluence.HighlightPanel.Templates = {}; }


Confluence.HighlightPanel.Templates.panelContent = function(opt_data, opt_ignored) {
  var output = '';
  var webItemList3 = opt_data.webItems;
  var webItemListLen3 = webItemList3.length;
  for (var webItemIndex3 = 0; webItemIndex3 < webItemListLen3; webItemIndex3++) {
    var webItemData3 = webItemList3[webItemIndex3];
    output += '<button data-key="' + soy.$$escapeHtml(webItemData3.key) + '" class="aui-button aui-button-compact aui-button-subtle" title="' + soy.$$escapeHtml(webItemData3.label) + '"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(webItemData3.styleClass) + '"></span></button>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.HighlightPanel.Templates.panelContent.soyTemplateName = 'Confluence.HighlightPanel.Templates.panelContent';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.expand-macro:expand-macro-core', location = 'com/atlassian/confluence/plugins/expand/js/expand-macro-core.js' */
(function(){var g=function(a){this.$=a;this.createToggleFunction=function(c){var a=this.$;return function(b){if("undefined"==typeof c||c(b)){b=a(this);var e=a(".expand-icon",b),d=a(".expand-content",b.closest(".expand-container")).first();d.hasClass("expand-hidden")?(e.removeClass("aui-iconfont-chevron-right").addClass("aui-iconfont-chevron-down"),d.css("display","block"),d.animate({opacity:1}),b.attr("aria-expanded",!0),b="expand"):(e.removeClass("aui-iconfont-chevron-down").addClass("aui-iconfont-chevron-right"),
d.animate({opacity:0},{complete:function(){d.hide()}}),b.attr("aria-expanded",!1),b="collapse");d.toggleClass("expand-hidden");"expand"===b?AJS.trigger("confluence.expand-macro.expanded"):AJS.trigger("confluence.expand-macro.collapsed");AJS.trigger("analyticsEvent",{name:"confluence.expand-macro.expand-click",data:{userAction:b}})}}};this.getExpandElements=function(a){return this.$("div[id^\x3d'expander-control-'].expand-control",a)}};"undefined"===typeof Confluence&&(Confluence={});"undefined"===
typeof Confluence.Plugins&&(Confluence.Plugins={});Confluence.Plugins.ExpandMacro={bind:function(a,c,f,b){a=new g(a);c=a.getExpandElements(c);c.length&&c.bind(f,a.createToggleFunction(b))}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.expand-macro:expand-macro-desktop-resources', location = 'com/atlassian/confluence/plugins/expand/js/expand-macro.js' */
AJS.toInit(function(a){Confluence.Plugins.ExpandMacro.bind(a,a("body"),"click keyup",function(a){return!("keyup"==a.type&&13!=a.keyCode)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/soy/sharelinks-urlmacro-templates.soy' */
// This file was automatically generated from sharelinks-urlmacro-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.SharelinksUrlMacro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.SharelinksUrlMacro == 'undefined') { Confluence.Blueprints.SharelinksUrlMacro = {}; }


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink = function(opt_data, opt_ignored) {
  return '<a class="aui-button sharelinks-urlmacro-button" href="' + Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript(opt_data) + '"><span>' + soy.$$escapeHtml('Share on Confluence') + '</span></a>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink.soyTemplateName = 'Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink';
}


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript = function(opt_data, opt_ignored) {
  return 'javascript:(function(){var screenWidth=screen.width,screenHeight=screen.height,popupWidth=640,popupHeight=580,popupLeft=0,popupTop=0; if(screenWidth>popupWidth){popupLeft=Math.round((screenWidth/2)-(popupWidth/2));}if(screenHeight>popupHeight){popupTop=Math.round((screenHeight/2)-(popupHeight/2));}window.open(\'' + soy.$$filterNoAutoescape(opt_data.bookmarkletActionURL) + '?bookmarkedURL=\'+encodeURIComponent(window.location.href), \'\',\'left=\'+popupLeft+\',top=\'+popupTop+\',width=\'+popupWidth+\',height=\'+popupHeight+\',personalbar=0,toolbar=0,scrollbars=1,resizable=1\');}());';
};
if (goog.DEBUG) {
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript.soyTemplateName = 'Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/js/sharelinks-urlmacro.js' */
AJS.toInit(function(a){a(".sharelinks-urlmacro-button").click(function(){alert("Drag this link to your toolbar");return!1})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:jsUri', location = '/includes/js/third-party/jsUri.js' */
(function(){function g(a){a=decodeURIComponent(a);return a=a.replace("+"," ")}function h(a){var c,b,f,e,d=[];if("undefined"===typeof a||null===a||""===a)return d;0===a.indexOf("?")&&(a=a.substring(1));c=a.toString().split(/[&;]/);for(a=0;a<c.length;a++)b=c[a],f=b.split("="),e=f[0],b=-1===b.indexOf("=")?null:null===f[1]?"":f[1],d.push([e,b]);return d}function d(a){var c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(a||
""),b={};"source protocol authority userInfo user password host port relative path directory file query anchor".split(" ").forEach(function(a,e){b[a]=c[e]||""});this.uriParts=b;this.queryPairs=h(this.uriParts.query);this.hasAuthorityPrefixUserPref=null}Array.prototype.forEach||(Array.prototype.forEach=function(a,c){for(var b=0,f=this.length;b<f;++b)a.call(c||this,this[b],b,this)});"protocol userInfo host port path anchor".split(" ").forEach(function(a){d.prototype[a]=function(c){typeof c!=="undefined"&&
(this.uriParts[a]=c);return this.uriParts[a]}});d.prototype.hasAuthorityPrefix=function(a){if(typeof a!=="undefined")this.hasAuthorityPrefixUserPref=a;return this.hasAuthorityPrefixUserPref===null?this.uriParts.source.indexOf("//")!==-1:this.hasAuthorityPrefixUserPref};d.prototype.query=function(a){var c="",b;if(typeof a!=="undefined")this.queryPairs=h(a);for(a=0;a<this.queryPairs.length;a++){b=this.queryPairs[a];c.length>0&&(c=c+"&");c=b[1]===null?c+b[0]:c+b.join("=")}return c.length>0?"?"+c:c};
d.prototype.getQueryParamValue=function(a){var c,b;for(b=0;b<this.queryPairs.length;b++){c=this.queryPairs[b];if(g(a)===g(c[0]))return c[1]}};d.prototype.getQueryParamValues=function(a){var c=[],b,f;for(b=0;b<this.queryPairs.length;b++){f=this.queryPairs[b];g(a)===g(f[0])&&c.push(f[1])}return c};d.prototype.deleteQueryParam=function(a,c){var b=[],f,e,d,h;for(f=0;f<this.queryPairs.length;f++){e=this.queryPairs[f];d=g(e[0])===g(a);h=g(e[1])===g(c);(arguments.length===1&&!d||arguments.length===2&&!d&&
!h)&&b.push(e)}this.queryPairs=b;return this};d.prototype.addQueryParam=function(a,c,b){if(arguments.length===3&&b!==-1){b=Math.min(b,this.queryPairs.length);this.queryPairs.splice(b,0,[a,c])}else arguments.length>0&&this.queryPairs.push([a,c]);return this};d.prototype.replaceQueryParam=function(a,c,b){var d=-1,e,h;if(arguments.length===3){for(e=0;e<this.queryPairs.length;e++){h=this.queryPairs[e];if(g(h[0])===g(a)&&decodeURIComponent(h[1])===g(b)){d=e;break}}this.deleteQueryParam(a,b).addQueryParam(a,
c,d)}else{for(e=0;e<this.queryPairs.length;e++){h=this.queryPairs[e];if(g(h[0])===g(a)){d=e;break}}this.deleteQueryParam(a);this.addQueryParam(a,c,d)}return this};"protocol hasAuthorityPrefix userInfo host port path query anchor".split(" ").forEach(function(a){var c="set"+a.charAt(0).toUpperCase()+a.slice(1);d.prototype[c]=function(b){this[a](b);return this}});d.prototype.scheme=function(){var a="";if(this.protocol()){a=a+this.protocol();this.protocol().indexOf(":")!==this.protocol().length-1&&(a=
a+":");a=a+"//"}else this.hasAuthorityPrefix()&&this.host()&&(a=a+"//");return a};d.prototype.origin=function(){var a=this.scheme();if(this.userInfo()&&this.host()){a=a+this.userInfo();this.userInfo().indexOf("@")!==this.userInfo().length-1&&(a=a+"@")}if(this.host()){a=a+this.host();this.port()&&(a=a+(":"+this.port()))}return a};d.prototype.toString=function(){var a=this.origin();if(this.path())a=a+this.path();else if(this.host()&&(this.query().toString()||this.anchor()))a=a+"/";if(this.query().toString()){this.query().toString().indexOf("?")!==
0&&(a=a+"?");a=a+this.query().toString()}if(this.anchor()){this.anchor().indexOf("#")!==0&&(a=a+"#");a=a+this.anchor()}return a};d.prototype.clone=function(){return new d(this.toString())};define("confluence/jsUri",function(){return d})})(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks.js' */
(function(b){function g(a){var c;if(void 0===a.offsetX){var b=c=0,d=a.target;do{if(0!=d.scrollTop||0!=d.scrollLeft)var h=d;c+=d.offsetLeft;b+=d.offsetTop;d=d.offsetParent}while(d&&d!=d.offsetParent);c=a.pageX+(h?h.scrollLeft:0)-c;a=a.pageY+(h?h.scrollTop:0)-b}else c=a.offsetX,a=a.offsetY;return 3<=c&&14>=c&&3<=a&&14>=a}function k(a){var c="page";a.closest("table.tasks-report").length?c="report":a.closest("#task-container").length?c="mytasks":a.closest("ul.inline-task-list").length&&(c="task");return c}
function l(a,c){var f=a.attr("data-inline-task-id");a=a.find(c).first();return a.closest("li").attr("data-inline-task-id")===f?a:b()}function m(a){a.attr("aria-checked",a.hasClass("checked")?"true":"false")}var n=!1;b(window).bind("beforeunload",function(){n=!0});var e=[];b(document).delegate("ul.inline-task-list \x3e li[data-inline-task-id]",{click:function(a){if(a.currentTarget===a.target&&g(a)){var c=b(a.target);c.toggleClass("checked");m(c);var f=c.hasClass("checked")?"CHECKED":"UNCHECKED",d=
c.data("inline-task-id");a=c.closest("ul").attr("data-inline-tasks-content-id")||AJS.params.pageId;a=AJS.contextPath()+"/rest/inlinetasks/1/task/"+a+"/"+d+"/";c.prop("disabled",!0);c.closest("tr").attr("aria-disabled",!0);e.push(d);AJS.trigger("inline-tasks.status-update.start",{status:f,taskId:d,taskListQueue:e});b.ajax({type:"POST",url:a,data:b.toJSON({status:f,trigger:"VIEW_PAGE"}),dataType:"json",contentType:"application/json",timeout:3E4,error:function(a,b,e){n||"timeout"===b||(AJS.logError("Inline Task #"+
d+" was not persisted to "+f+" because of "+e+" (status: "+b+")"),b=require("confluence/message-controller"),c.toggleClass("checked"),m(c),b.showError(b.parseError(a,"Oops! Your task change couldn\u0027t be saved. \u003cbr/\u003eThere could be a few reasons for this."),b.Location.FLAG))},success:function(){var a=l(c,"time").attr("datetime"),b=new Date;var d=""+b.getFullYear();var e=""+(b.getMonth()+1);b=""+b.getDate();2>e.length&&(e="0"+e);2>b.length&&(b="0"+b);d=[d,e,b].join("-");a={dueDate:a,completionDate:d,mode:"view",assigneeUsername:l(c,".user-mention").attr("data-username"),
context:k(c)};"CHECKED"===f&&AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.completed",data:a})}}).always(function(){c.prop("disabled",!1);c.closest("tr").attr("aria-disabled",!1);e.splice(e.indexOf(d),1);AJS.trigger("inline-tasks.status-update.complete",{status:f,taskId:d,taskListQueue:e})})}},mousemove:function(a){a.currentTarget===a.target&&(g(a)?b(a.target).addClass("hover"):b(a.target).removeClass("hover"))},mouseout:function(a){a.currentTarget===a.target&&b(a.target).removeClass("hover")},
mousedown:function(a){a.currentTarget===a.target&&g(a)&&b(a.target).addClass("task-active")},mouseup:function(a){a.currentTarget===a.target&&g(a)&&b(a.target).removeClass("task-active")}});b(document).tooltip({title:function(){return "This task is due in less than a week"},live:"ul.inline-task-list li:not(.checked) time.date-upcoming"});b(document).tooltip({title:function(){return "This task is overdue"},live:"ul.inline-task-list li:not(.checked) time.date-past"});b(document).tooltip({title:function(){return "A completion date wasn\u0027t recorded for this task"},
live:"span.emptycompletedate"});b(document).on("click","time",function(){var a=b(this);a={date:a.attr("datetime"),mode:"view",context:k(a)};AJS.trigger("analyticsEvent",{name:"confluence-spaces.date.clicked",data:a})});AJS.toInit(function(){b(".inline-task-list").attr("role","group");b(".inline-task-list [data-inline-task-id]:not(.checked)").attr("role","checkbox").attr("aria-checked","false");b(".inline-task-list [data-inline-task-id].checked").attr("role","checkbox").attr("aria-checked","true");
"READ_ONLY"===AJS.Meta.get("access-mode")&&(b("[data-inline-task-id]").addClass("disabled"),b("[data-inline-task-id]").prop("disabled",!0))})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks-alert.js' */
Confluence.InlineTasks=Confluence.InlineTasks||{};
(function(c){var a=function(d){this.settings=c.extend({},a.DEFAULTS,d);this.template=Confluence.InlineTasks.Templates;c("#inline-tasks-notice").remove();var b=c(this.template.notice(this.settings));b.hide().appendTo("body");b.find(".notice-close").click(function(){b.hide()});this.$notice=b};a.DEFAULTS={textMessage:"Oops! Your task change couldn\u0027t be saved. \u003cbr/\u003eThere could be a few reasons for this.",className:"general-notice"};a.prototype.show=function(){this.$notice.show();return this};a.prototype.hide=function(){this.$notice.hide();
return this};Confluence.InlineTasks.Notice=a})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'templates/inline-tasks.soy' */
// This file was automatically generated from inline-tasks.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.InlineTasks.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.InlineTasks == 'undefined') { Confluence.InlineTasks = {}; }
if (typeof Confluence.InlineTasks.Templates == 'undefined') { Confluence.InlineTasks.Templates = {}; }


Confluence.InlineTasks.Templates.notice = function(opt_data, opt_ignored) {
  return '<div class="aui-message error' + ((opt_data.className) ? ' ' + soy.$$escapeHtml(opt_data.className) : '') + '" id="inline-tasks-notice">' + soy.$$filterNoAutoescape(opt_data.textMessage) + '&nbsp;&nbsp;<a href="#" class="notice-close">' + soy.$$escapeHtml('Dismiss') + '</a></div>';
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Templates.notice.soyTemplateName = 'Confluence.InlineTasks.Templates.notice';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks-focus.js' */
AJS.$(document).ready(function(a){if(a=(new (require("confluence/jsUri"))(window.location.href)).getQueryParamValue("focusedTaskId"))a=$("li[data-inline-task-id\x3d"+a+"]"),a.length&&(a.addClass("focused"),window.scrollTo(a.offset().left,a.offset().top-$(window).height()/2))});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:sortable-table-server-side', location = 'js/jquery.tablesorter.serveronly.js' */
(function(d){d.extend({tablesorterServerOnly:new function(){this.defaults={classNameDisableSorting:"aui-table-column-unsortable",classNameHeaderDesc:"tablesorter-headerDesc",classNameHeaderAsc:"tablesorter-headerAsc",reverseSort:!1,sortColumn:"",onInit:function(){},onSort:function(){},events:{clickHeader:"click.sortServerOnly",refreshHeader:"refreshHeader.sortServerOnly",simulateClickHeader:"simulateClickHeader.sortServerOnly"}};var e={updateCurrentHeaderSort:function(b,a){e.resetHeadersSort(b,a);
a.$headers.each(function(){var b=d(this),g=b.attr("data-column-name"),e=a.reverseSort;g===a.sortColumn&&(e?b.addClass(a.classNameHeaderDesc):b.addClass(a.classNameHeaderAsc))})},resetHeadersSort:function(b,a){a.$headers.removeClass(a.classNameHeaderDesc).removeClass(a.classNameHeaderAsc)},prepareHTMLHeader:function(b,a){a.$headers.not("."+a.classNameDisableSorting).attr("unselectable","on").bind("selectstart",!1).addClass("tablesorter-header").wrapInner("\x3cspan class\x3d'aui-table-header-content'/\x3e")},
bindEvents:function(b,a){var c=d(b);c.on(a.events.refreshHeader,function(){e.updateCurrentHeaderSort(b,a)});c.on(a.events.simulateClickHeader,function(b,d,c){a.reverseSort=c;a.sortColumn=d})}},f=function(b,a){var c=d(b);a.$table=c;a.$headers=c.find("thead th");a.$tbodies=c.find("tbody");e.prepareHTMLHeader(b,a);e.updateCurrentHeaderSort(b,a);"function"===typeof a.onInit&&a.onInit.apply(b,[a]);a.$headers.on(a.events.clickHeader,function(){var c=d(this);if(c.hasClass(a.classNameDisableSorting))return!1;
c=c.attr("data-column-name");a.reverseSort=c===a.sortColumn?!a.reverseSort:!1;a.sortColumn=c;"function"===typeof a.onSort&&a.onSort.apply(b,[a]);return!1});e.bindEvents(b,a)};this.construct=function(b){return this.each(function(){var a=this,c=d.extend(!0,{},d.tablesorterServerOnly.defaults,b);this.config&&a.hasInitialized&&d.tablesorter?d.tablesorter.destroy(a,!1,function(){f(a,c)}):f(a,c)})}}});d.fn.extend({tablesorterServerOnly:d.tablesorterServerOnly.construct})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:sortable-table-server-side', location = 'js/tasks-table-sortable.js' */
(function(e){var d=function(a){this.ajaxUrl=a.ajaxUrl;this.restUrlPagination=a.restUrlPagination;this.$wrapper=a.$wrapper;this.table=a.table;this.$table=e(this.table);this.analyticEventKey=a.analyticEventKey;this.sortColumnDefault=a.sortColumnDefault||"duedate";this.sortReverseSortDefault=a.sortReverseSortDefault||!1;this.reportParametersDefault=a.reportParametersDefault;this.pageIndex=a.pageIndex||0;this.pageSize=a.pageSize||10;this.pageTotal=a.pageTotal||0;this.pageLimit=a.pageLimit||7;this.adaptive=
a.adaptive;this.columns=a.columns;this.templates=a.templates;this.onRenderEmptyTable=a.onRenderEmptyTable;this.onBusySorting=a.onBusySorting};d.getColumnNameFromSortBy=function(a){var b={"due date":"duedate","page title":"location",assignee:"assignee"};return b[a]?b[a]:"duedate"};d.getSortByFromColumnName=function(a){var b={duedate:"due date",location:"page title"};return b[a]?b[a]:a};d.prototype.updateOptions=function(a){e.extend(this,a);this.$table=e(this.table)};d.prototype.getCurrentPageIndex=
function(){var a=this.$wrapper.find(".macro-auto-pagination").last();a=parseInt(a.attr("data-initial-page-index"),10);return isNaN(a)?0:a};d.prototype.renderPagination=function(a,b){var c=this;a||(a=c.$table);b||(b=c.reportParametersDefault);this.$wrapper.find(".macro-auto-pagination").remove();1<c.pageTotal&&f.UI.Components.Pagination.build({scope:a,pageSize:c.pageSize,totalPages:c.pageTotal,pageLimit:c.pageLimit,path:c.restUrlPagination,adaptive:c.adaptive,currentPage:c.pageIndex,data:{reportParameters:JSON.stringify(b)},
success:function(a,b){a=c.templates.tasksReportLine({task:a,columns:c.columns});b.append(a)}})};d.prototype.toggleBusyState=function(a){this.$wrapper.attr("data-loading",a);a?this.$wrapper.find(".task-blanket").show():this.$wrapper.find(".task-blanket").hide();"function"===typeof this.onBusySorting&&this.onBusySorting.apply(this,[a])};d.prototype.renderTable=function(a){var b=this;a=_.map(a,function(a){return b.templates.tasksReportLine({task:a,columns:b.columns})}).join("");b.$table.find("tbody").html(a);
f.Binder.userHover()};d.prototype._triggerAnalyticsSorting=function(){AJS.trigger("analyticsEvent",{name:this.analyticEventKey,data:{column:this.sortColumn,direction:this.reverseSort?"desc":"asc"}})};d.prototype._buildAjaxData=function(a){return{url:this.ajaxUrl,cache:!1,dataType:"json",data:{pageIndex:this.pageIndex,pageSize:this.pageSize,reportParameters:JSON.stringify(a)}}};d.prototype.init=function(){var a=this;a.sortColumn=a.sortColumnDefault;a.reverseSort=a.sortReverseSortDefault;this.$table.tablesorterServerOnly({sortColumn:a.sortColumn,
reverseSort:a.reverseSort,onInit:function(){e(this).addClass("aui-table-sortable")},onSort:function(b){var c=e(this);a.pageIndex=a.getCurrentPageIndex();a.sortColumn=b.sortColumn;a.reverseSort=b.reverseSort;a.toggleBusyState(!0);var g=e.extend({},a.reportParametersDefault,{sortColumn:d.getSortByFromColumnName(a.sortColumn),reverseSort:a.reverseSort});b=a._buildAjaxData(g);e.ajax(b).done(function(b){a.pageIndex=a.getCurrentPageIndex();a.pageTotal=b.totalPages;0===a.pageIndex&&0===a.pageTotal?"function"===
typeof a.onRenderEmptyTable&&(a.$wrapper.find(".macro-auto-pagination").remove(),c.remove(),a.onRenderEmptyTable.apply(a)):(a.renderTable(b.detailLines),a.renderPagination(null,g),c.trigger("refreshHeader.sortServerOnly"),a._triggerAnalyticsSorting())}).fail(function(){(new f.InlineTasks.Notice({textMessage:"We can\u0027t sort your tasks right now. Refresh the page to try again.",className:"forbidden-notice"})).show()}).always(function(){AJS.trigger("ic-jim-async-supported");a.toggleBusyState(!1)})}})};var f=
window.Confluence||{};f.InlineTasks=f.InlineTasks||{};f.InlineTasks.TasksTableSortable=d})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:common', location = '/js/internal/namespace-legacy.js' */
var Confluence=require("confluence/legacy");Confluence.UI||(Confluence.UI={});Confluence.UI.Components||(Confluence.UI.Components={});Confluence.UI.Components.BlankPlaceholderBox||(Confluence.UI.Components.BlankPlaceholderBox={});Confluence.UI.Components.CQL||(Confluence.UI.Components.CQL={});Confluence.UI.Components.DatePicker||(Confluence.UI.Components.DatePicker={});Confluence.UI.Components.LabelPicker||(Confluence.UI.Components.LabelPicker={});
Confluence.UI.Components.Pagination||(Confluence.UI.Components.Pagination={});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:common', location = 'js/internal/soy-templates.js' */
define("confluence-ui-components/js/internal/soy-templates",[],function(){return{BlankPlaceholderBox:function(){return Confluence.UI.Components.BlankPlaceholderBox.Templates},DatePicker:function(){return Confluence.UI.Components.DatePicker.templates},LabelPicker:function(){return Confluence.UI.Components.LabelPicker.templates},Pagination:function(){return Confluence.UI.Components.Pagination.Templates},Components:function(){return Confluence.UI.Components.templates},UserGroupSelect2:function(){return Confluence.UI.Components.UserGroupSelect2}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:pagination', location = '/js/pagination.js' */
define("confluence-ui-components/js/pagination",["ajs","confluence/hover-user","confluence-ui-components/js/internal/soy-templates","jquery","underscore"],function(m,q,r,k,n){var l=function(a,b,c){var d=a.find("a").attr("aria-disabled",c);c?d.attr("disabled","disabled"):(d.removeAttr("disabled"),c=k(".aui-nav-selected",a).data("index")+1,a.find(".aui-nav-next \x3e a").attr("aria-disabled",c===b),a.find(".aui-nav-previous \x3e a").attr("aria-disabled",1===c))},t={scope:null,success:null,data:null,
path:"",url:"#",pageLimit:7,currentPage:0,adaptive:!1,totalPages:0,pageSize:0},p=function(a){var b=a.totalPages,c=a.currentPage,d=a.pageLimit,f=a.adaptive;d?(f&&(b=c+d),f=d):f=b;var e=Math.floor(d/2);d=!d||b<=d||0>c-e?0:c+e>b-1?b-d:c-e;return r.Pagination().paginationFooter({currentPage:c||0,startPage:d,itemsToRender:f,totalPages:b,pageSize:a.pageSize,url:a.url||"#"})};return{build:function(a){var b=n.extend({},t,a);"function"!==typeof b.success&&(b.success=function(){});a=p(b);b.scope.after(a);var c=
b.scope.next(),d=c.data("initial-page-index");c.on("click","a",function(a){var e=k(this),h=e.parents("ol").prev();"floating-scrollbar"===h.prop("id")&&(h=h.prev());var f=h.is("table")?h:h.find("table"),g=f.data("pageIndex")||d;e=e.parent("li");e.hasClass("aui-nav-selected")||e.find("\x3e a[aria-disabled\x3dtrue]").length||(e.hasClass("aui-nav-next")?g++:e.hasClass("aui-nav-previous")?g--:g=e.data("index"),l(c,b.totalPages,!0),e=k.extend({},{pageSize:b.pageSize,pageIndex:g},b.data),k.getJSON(m.contextPath()+
b.path,e).done(function(a){g=a.currentPage;var d=f.find("tbody");d.find("tr").remove();f.data("pageIndex",g);n.each(a.detailLines,function(a){b.success(a,d)});m.trigger("ui.components.pagination.updated",[a,b]);a=k.extend({},b,{totalPages:a.totalPages,adaptive:a.adaptive,currentPage:g});c.html(p(a));l(c,a.totalPages,!1);q()}).fail(function(){l(c,b.totalPages,!1)}),a.preventDefault())})}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:pagination', location = '/js/internal/pagination-legacy.js' */
var _=require("underscore");window.Confluence.UI.Components.Pagination=_.extend(window.Confluence.UI.Components.Pagination,require("confluence-ui-components/js/pagination"));require("ajs").deprecate.prop(window.Confluence.UI.Components.Pagination,"build",{sinceVersion:"2.1.1",extraInfo:"Use require('confluence-ui-components/js/pagination')"});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:pagination', location = '/soy/pagination.soy' */
// This file was automatically generated from pagination.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.Pagination.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.Pagination == 'undefined') { Confluence.UI.Components.Pagination = {}; }
if (typeof Confluence.UI.Components.Pagination.Templates == 'undefined') { Confluence.UI.Components.Pagination.Templates = {}; }


Confluence.UI.Components.Pagination.Templates.paginationFooter = function(opt_data, opt_ignored) {
  var output = '<ol class="aui-nav aui-nav-pagination macro-auto-pagination" data-page-size="' + soy.$$escapeHtml(opt_data.pageSize) + '" data-initial-page-index="' + soy.$$escapeHtml(opt_data.currentPage) + '"><li class="aui-nav-previous"><a ' + ((opt_data.currentPage == 0) ? 'aria-disabled="true"' : 'href="#"') + '>' + soy.$$escapeHtml('Prev') + '</a></li>';
  var startIdx__soy16 = opt_data.startPage + 1;
  var currentIdx__soy17 = opt_data.currentPage + 1;
  var endIdx__soy18 = startIdx__soy16 + opt_data.itemsToRender;
  var totalRange__soy19 = opt_data.totalPages + 1;
  var indexInit20 = startIdx__soy16;
  var indexLimit20 = endIdx__soy18 < totalRange__soy19 ? endIdx__soy18 : totalRange__soy19;
  for (var index20 = indexInit20; index20 < indexLimit20; index20++) {
    output += (index20 == currentIdx__soy17) ? '<li class="aui-nav-selected" data-index="' + soy.$$escapeHtml(index20 - 1) + '">' + soy.$$escapeHtml(index20) + '</li>' : '<li data-index="' + soy.$$escapeHtml(index20 - 1) + '"><a href="#">' + soy.$$escapeHtml(index20) + '</a></li>';
  }
  output += '<li class="aui-nav-next"><a ' + ((currentIdx__soy17 == opt_data.totalPages) ? 'aria-disabled="true"' : 'href="' + soy.$$escapeHtml(opt_data.url) + '"') + '>' + soy.$$escapeHtml('Next') + '</a></li></ol>';
  return output;
};
if (goog.DEBUG) {
  Confluence.UI.Components.Pagination.Templates.paginationFooter.soyTemplateName = 'Confluence.UI.Components.Pagination.Templates.paginationFooter';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:blank-placeholder-box', location = 'soy/blank-placeholder-box.soy' */
// This file was automatically generated from blank-placeholder-box.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.BlankPlaceholderBox.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.BlankPlaceholderBox == 'undefined') { Confluence.UI.Components.BlankPlaceholderBox = {}; }
if (typeof Confluence.UI.Components.BlankPlaceholderBox.Templates == 'undefined') { Confluence.UI.Components.BlankPlaceholderBox.Templates = {}; }


Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox = function(opt_data, opt_ignored) {
  return '<div class="blank-placeholder-box ' + ((opt_data.customClass) ? soy.$$escapeHtml(opt_data.customClass) : '') + '"><div class="content"><h2>' + soy.$$escapeHtml(opt_data.blankTitle) + '</h2><p>' + soy.$$escapeHtml(opt_data.blankDescription) + '</p></div>' + ((opt_data.customHtml) ? soy.$$filterNoAutoescape(opt_data.customHtml) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox.soyTemplateName = 'Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'templates/tasks-report.soy' */
// This file was automatically generated from tasks-report.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.InlineTasks.Report.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.InlineTasks == 'undefined') { Confluence.InlineTasks = {}; }
if (typeof Confluence.InlineTasks.Report == 'undefined') { Confluence.InlineTasks.Report = {}; }
if (typeof Confluence.InlineTasks.Report.Templates == 'undefined') { Confluence.InlineTasks.Report.Templates = {}; }


Confluence.InlineTasks.Report.Templates.tasksReport = function(opt_data, opt_ignored) {
  var output = '<div class="table-wrapper" data-loading="false"><div class="task-blanket"></div><input type="hidden" name="reportParameters" value="' + soy.$$escapeHtml(opt_data.reportParameters) + '" /><table class="aui aui-table-interactive tasks-report" data-sortable="false" data-total-pages="' + soy.$$escapeHtml(opt_data.totalPages) + '" data-page-size="' + soy.$$escapeHtml(opt_data.pageSize) + '" data-adaptive="' + soy.$$escapeHtml(opt_data.adaptive) + '" data-page-limit="' + soy.$$escapeHtml(opt_data.pageLimit) + '"><thead><tr class="tablesorter-headerRow">';
  var headingList14 = opt_data.headings;
  var headingListLen14 = headingList14.length;
  for (var headingIndex14 = 0; headingIndex14 < headingListLen14; headingIndex14++) {
    var headingData14 = headingList14[headingIndex14];
    output += '<th class="header-' + soy.$$escapeHtml(headingData14) + ((headingData14 == 'description') ? ' aui-table-column-unsortable' : '') + '" data-column-name="' + soy.$$escapeHtml(headingData14) + '">' + soy.$$escapeHtml(opt_data.headingTexts[headingData14]) + '</th>';
  }
  output += '</tr></thead><tbody>';
  if (opt_data.tasks.length) {
    var taskList29 = opt_data.tasks;
    var taskListLen29 = taskList29.length;
    for (var taskIndex29 = 0; taskIndex29 < taskListLen29; taskIndex29++) {
      var taskData29 = taskList29[taskIndex29];
      output += Confluence.InlineTasks.Report.Templates.tasksReportLine({task: taskData29, columns: opt_data.headings});
    }
  } else {
    output += '<tr><td colspan="' + soy.$$escapeHtml(opt_data.headings.length) + '">' + soy.$$escapeHtml('Create a task list in a Confluence page to keep track of things you need to do.') + '</td></tr>';
  }
  output += '</tbody></table></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksReport.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksReport';
}


Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml('Hey! Did you know...') + '</h2><p>' + soy.$$escapeHtml('You can view the tasks you created, or assigned to you, in the tasks tabs of your profile.') + '</p>';
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification';
}


Confluence.InlineTasks.Report.Templates.tasksReportLine = function(opt_data, opt_ignored) {
  var output = '<tr data-task-id="' + soy.$$escapeHtml(opt_data.task.taskId) + '" aria-disabled="false">';
  var columnList51 = opt_data.columns;
  var columnListLen51 = columnList51.length;
  for (var columnIndex51 = 0; columnIndex51 < columnListLen51; columnIndex51++) {
    var columnData51 = columnList51[columnIndex51];
    if (columnData51 == 'duedate') {
      output += '<td class=\'tasks-report-date\'>' + ((opt_data.task.dueDate) ? soy.$$escapeHtml(opt_data.task.dueDate) : '') + '</td>';
    } else if (columnData51 == 'description') {
      output += '<td>' + soy.$$filterNoAutoescape(opt_data.task.taskHtml) + '</td>';
    } else if (columnData51 == 'assignee') {
      output += '<td class=\'tasks-report-assignee\'>' + ((opt_data.task.assigneeUserName) ? Confluence.Templates.User.usernameLink({username: opt_data.task.assigneeUserName, fullName: opt_data.task.assigneeFullName, canView: false}) : '') + '</td>';
    } else if (columnData51 == 'location') {
      output += '<td><a class=\'task-location\' href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.task.pageUrl) + '">' + soy.$$escapeHtml(opt_data.task.pageTitle) + '</a></td>';
    } else if (columnData51 == 'completedate') {
      output += '<td class=\'tasks-report-date\'>' + ((opt_data.task.completeDate) ? soy.$$escapeHtml(opt_data.task.completeDate) : (opt_data.task.taskCompleted) ? '<span class="emptycompletedate">--</span>' : '') + '</td>';
    } else if (columnData51 == 'labels') {
      output += '<td>';
      var labelList90 = opt_data.task.labels;
      var labelListLen90 = labelList90.length;
      for (var labelIndex90 = 0; labelIndex90 < labelListLen90; labelIndex90++) {
        var labelData90 = labelList90[labelIndex90];
        output += aui.labels.label({text: labelData90});
      }
      output += '</td>';
    }
  }
  output += '</tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksReportLine.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksReportLine';
}


Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning = function(opt_data, opt_ignored) {
  var param98 = '<p>' + soy.$$escapeHtml('Unable to show this task report.') + '</p>';
  var messageList102 = opt_data.messages;
  var messageListLen102 = messageList102.length;
  for (var messageIndex102 = 0; messageIndex102 < messageListLen102; messageIndex102++) {
    var messageData102 = messageList102[messageIndex102];
    param98 += '<p>' + soy.$$escapeHtml(messageData102) + '</p>';
  }
  var output = '' + aui.message.warning({content: param98});
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning';
}


Confluence.InlineTasks.Report.Templates.taskReportWarning = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({content: '<p>' + soy.$$escapeHtml('Unable to show the task report. Edit this page to resolve the issues.') + '</p>'});
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.taskReportWarning.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.taskReportWarning';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'js/tasks-report-blank-exp.js' */
(function(d){Confluence.InlineTasks=Confluence.InlineTasks||{};Confluence.InlineTasks.TasksReport=Confluence.InlineTasks.TasksReport||{};var b={"blank.complete.title":"Task report","blank.complete.desc":"Get going, no tasks completed yet.","blank.incomplete.title":"Task report","blank.incomplete.desc":"Looking good, no incomplete tasks."};Confluence.InlineTasks.TasksReport.renderBlankExperiences=function(c,
a){a||(a="incomplete");a=Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox({blankTitle:b["blank."+a+".title"],blankDescription:b["blank."+a+".desc"],customClass:a+" tasks-report-blank"});c.html(a)}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'js/tasks-report.js' */
AJS.$(function(c){var l=Confluence.InlineTasks.Report.Templates,g=Confluence.InlineTasks.TasksTableSortable,f=c(".tasks-report").parent();_.each(f,function(d){var e=c(d),a=e.find("table.tasks-report"),f=a.data("page-size");d=a.data("total-pages");var m=a.data("page-limit"),h=a.data("adaptive");e=e.find("input[name\x3dreportParameters]").val();var b=JSON.parse(e);AJS.bind("inline-tasks.status-update.start",function(a,b){0<b.taskListQueue.length&&(a=c("li[data-inline-task-id\x3d"+b.taskId+"]").closest(".tasks-report").siblings(".macro-auto-pagination"),
c(a).attr("aria-disabled",!0),a=a.find("li a"),a.on("click.taskreport.pagination",function(a){a.preventDefault();a.stopPropagation()}))});AJS.bind("inline-tasks.status-update.complete",function(a,b){0===b.taskListQueue.length&&(c(".macro-auto-pagination").attr("aria-disabled",!1),c(".macro-auto-pagination li a").off("click.taskreport.pagination"))});var k=a.closest(".table-wrapper");a=new g({$wrapper:k,table:a[0],sortReverseSortDefault:b.reverseSort,sortColumnDefault:g.getColumnNameFromSortBy(b.sortColumn),
reportParametersDefault:b,pageIndex:0,pageSize:f,pageTotal:d,adaptive:h,pageLimit:m,templates:l,columns:b.columns,onRenderEmptyTable:function(){Confluence.InlineTasks.TasksReport.renderBlankExperiences(k,b.status)},analyticEventKey:"confluence-spaces.tasks.report.sorted",restUrlPagination:"/rest/inlinetasks/1/task-report/",ajaxUrl:Confluence.getContextPath()+"/rest/inlinetasks/1/task-report/"});a.init();(h||1<d)&&a.renderPagination()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'js/help-tip.js' */
(function(f){function b(){return false}function d(){return true}var l=0,g=new Date().getTime();var k=AJS.contextPath()+"/rest/helptips/1.0/tips";function h(n){n=""+(n||"");return n.replace(/\./g,"-")}function j(o,n){if(AJS.EventQueue&&n&&n.attributes.id){var q={};var p=h(n.attributes.id);q.name="helptips."+p+"."+o;q.properties={};AJS.EventQueue.push(q)}}function c(){return"c"+g+(l++)}var a={dismissedTipIds:[],loaded:f.Deferred(),url:function(){return k},sync:function(o,n){o||(o="get");n||(n=null);return f.ajax(this.url(),{type:o,context:this,dataType:"json",contentType:"application/json",data:n&&JSON.stringify(n),processData:false}).promise()},fetch:function(){var n=this.sync();n.done(function(o){f.merge(this.dismissedTipIds,o);this.loaded.resolve()});return n.promise()},show:function(n){this.loaded.done(n)},dismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=true}else{this.dismissedTipIds.push(o);this.sync("post",{id:o})}},undismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=false}else{this.dismissedTipIds.splice(f.inArray(o,this.dismissedTipIds),1);this.sync("delete",{id:o})}},isDismissed:function(n){var o=n.attributes.id;return(o)?f.inArray(o,this.dismissedTipIds)>=0:n._dismissed}};var e=AJS.HelpTip=function(n){var o;this.attributes=f.extend({},n);this.attributes.id||(this.attributes.id=false);if(this.attributes.body){this.attributes.bodyHtml=this.attributes.body;delete this.attributes.body}this.cid=c();o=this.attributes.anchor;delete this.attributes.anchor;this.view=o?new i(this,o):new m(this);this.view.$el.addClass("aui-help-tip")};AJS.HelpTip.Manager=a;f.extend(e.prototype,{show:function(){var n=this;AJS.HelpTip.Manager.show(function(){if(!n.isDismissed()){if(AJS.Popups&&AJS.Popups.DisplayController){AJS.Popups.DisplayController.request({name:n.id,weight:1000,show:function(){n.view.show()}})}else{n.view.show()}j("shown",n)}})},dismiss:function(){var n=h(arguments[0]||"programmatically");this.view.dismiss();if(!this.isDismissed()){AJS.HelpTip.Manager.dismiss(this);j("dismissed."+n,this)}},isVisible:function(){return this.view.$el.is(":visible")},isDismissed:function(){return AJS.HelpTip.Manager.isDismissed(this)}});var i=function(o,n){this.initialize(o,n)};f.extend(i.prototype,{initialize:function(r,q){var o=this;var s=q.prop("ownerDocument");var p=s!=window.document;if(p){var n=f("iframe").filter(function(){return this.contentDocument==s});n.contents().scroll(function(){var v=f(this).contents().find("body").scrollTop();var w=n.offset().top;var u=o.popup.data("offset-top");var t=o.popup.find(".arrow").height();o.popup.css("top",u-v);o.popup.toggle(v<=u-w-t&&v+n.height()-t+w-o.popup.height()>=u)})}this.model=r;this.beforeHide=b;this.dismissButton=f(AJS.Templates.HelpTip.tipDismiss());this.dismissButton.click(function(t){r.dismiss("close-button");t.preventDefault()});this.popup=AJS.InlineDialog(q,r.cid,function(v,u,t){v.html(AJS.Templates.HelpTip.tipContent(r.attributes));v.find(".helptip-body").after(o.dismissButton);v.unbind("mouseover mouseout");v.find(".helptip-link").click(function(){j("learn-more.clicked",r)});t()},{container:"body",noBind:true,preHideCallback:function(){return o.beforeHide()},calculatePositions:function(t,y,z,x){var w=AJS.InlineDialog.opts.calculatePositions(t,y,z,x);if(p){var v=t.find(".arrow").height();var u=n.contents().find("body").scrollTop();w.popupCss.top=n.offset().top+(q.offset().top-u)+q.height()+v;w.popupCss.left=q.offset().left;n.contents().scroll()}t.data("offset-top",w.popupCss.top);return w}});this.popup.refresh();this._popupHide=this.popup.hide;this.popup.hide=b;this.$el=f(this.popup[0]);AJS.$(document).bind("showLayer",function(v,u,t){if(u==="inlineDialog"&&t.id===r.cid){AJS.InlineDialog.current=null;AJS.$(document.body).unbind("click."+r.cid+".inline-dialog-check");t._validateClickToClose=b;t.hide=b}})},show:function(){var n=this.popup,o=function(p){if(!n.has(p.target).length){n.shadow.remove();n.remove()}};n.show()},dismiss:function(){this.beforeHide=d;this._popupHide()}});var m=function(n){this.initialize(n)};f.extend(m.prototype,{initialize:function(){this.$el=f("<div />")},show:f.noop,dismiss:f.noop});if(AJS.Meta.get("remote-user")){a.fetch()}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'templates/help-tip.soy' */
// This file was automatically generated from help-tip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace AJS.Templates.HelpTip.
 */

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Templates == 'undefined') { AJS.Templates = {}; }
if (typeof AJS.Templates.HelpTip == 'undefined') { AJS.Templates.HelpTip = {}; }


AJS.Templates.HelpTip.tipContent = function(opt_data, opt_ignored) {
  return ((opt_data.title) ? '<h4 class="helptip-title">' + soy.$$escapeHtml(opt_data.title) + '</h4>' : '') + '<div class="helptip-body">' + soy.$$filterNoAutoescape(opt_data.bodyHtml) + '</div>' + ((opt_data.url) ? '<a class="helptip-link" href="' + soy.$$escapeHtml(opt_data.url) + '" target="_blank">' + soy.$$escapeHtml('Learn more') + '</a>' : '');
};
if (goog.DEBUG) {
  AJS.Templates.HelpTip.tipContent.soyTemplateName = 'AJS.Templates.HelpTip.tipContent';
}


AJS.Templates.HelpTip.tipDismiss = function(opt_data, opt_ignored) {
  return '<button class="helptip-dismiss aui-button" type="button">' + soy.$$escapeHtml('Dismiss') + '</button>';
};
if (goog.DEBUG) {
  AJS.Templates.HelpTip.tipDismiss.soyTemplateName = 'AJS.Templates.HelpTip.tipDismiss';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-feature-discovery-resources', location = 'js/tasks-discovery.js' */
(function(a){a(function(){if(0<a("meta[name\x3dshow-task-feature-discovery-flag]").length&&Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").shouldShow("inline-tasks-flag")&&AJS.HelpTip){var b={id:null,body:Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification(),anchor:a("#user-menu-link")};b=new AJS.HelpTip(b);AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.feature.discovery.shown"});b.show();Confluence.FeatureDiscovery.forPlugin("com.atlassian.confluence.plugins.confluence-jira-metadata").markDiscovered("inline-tasks-flag")}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-view-content', location = 'js/viewcontent-init.js' */
require(["jquery","window","wrm/require"],function(a,c,d){function b(){return new Promise(function(e,a){d("wrc!com.atlassian.confluence.plugins.drag-and-drop:default-drop-handler").then(function(){e(require("confluence-drag-and-drop/default-drop-handler"))},a)})}a(document).one("dragenter",function(){b().then(function(a){a.initialise()})});a(c).one("load",b)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:util-resource', location = 'util/utils.js' */
define("confluence/ic/util/utils",["jquery","underscore","ajs","backbone","exports"],function(e,g,d,w,c){function x(a){return 0<a.filter(function(){return 0<e(this).text().length}).length}function m(a,b,c,d){null!=b&&(b.isResolved()?(new c({collection:a,focusCommentId:b.get("id")})).render():b.isDangling()||w.trigger("ic:view",b,"permalink",{isReplyComment:d}))}function p(a){if("number"===typeof a.selectionStart){var b=a.value.length;a.selectionStart=b;a.selectionEnd=b}else a.focus(),a=a.createTextRange(),
a.collapse(!1),a.select()}function q(a){var b=e(a).closest("a");b.length||(b=e(a).find("a"));return b}function r(){return!!e(".ic-sidebar #wysiwygTextarea_ifr").length}function t(){void 0===h&&(h=!!u().length);return h}function v(){void 0===k&&(k=e("#content"));return k}function u(){void 0===l&&(l=e("#splitter-content"));return l}var y={INLINE_COMMENTS:d.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:d.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:d.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),
DANGLING_COMMENT:d.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment")},z=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],A=["autoresize","confluenceleavecomment"],B=["code"],k,l,h;c.overlappedSelection=function(a,b){if(a&&b){var c=e(a.containingElement);c.is(".inline-comment-marker.valid")||(c=e("\x3cdiv/\x3e").append(a.html).find(".inline-comment-marker.valid"));if(0<c.length&&x(c))return a=c.first().data("ref"),b=b.findWhere({markerRef:a})}};
c.focusedCommentUrl=function(a){return d.contextPath()+"/pages/viewpage.action?pageId\x3d"+d.Meta.get("latest-page-id")+"\x26focusedCommentId\x3d"+a+"#comment-"+a};c.showFocusedComment=function(a,b,c){b=b.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null!=b){var n="replyToComment"===b[1];b=parseInt(b[2],10);var f=a.findWhere({id:b});null!=f?m(a,f,c,n):e.ajax({url:d.contextPath()+"/rest/inlinecomments/1.0/comments/replies/"+b+"/commentId"}).done(function(b){f=a.findWhere({id:b});m(a,f,c,n)})}};
c.getAuthorAvatarUrl=function(){return d.Meta.get("current-user-avatar-url")?d.contextPath()+d.Meta.get("current-user-avatar-url"):d.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/anonymous.png"};c.moveCaretToEnd=function(a){p(a);window.setTimeout(function(){p(a)},1)};c.animateSidebar=function(a,b){var c=a.$wikiContent,d=e.Deferred();if(b){var f=e(".inline-comment-marker.active");c.addClass("ic-fade-in-animation");c.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",
function(){e(this).removeClass("ic-fade-in-animation")});a.$el.addClass("ic-slide-in");a.$el.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).removeClass("ic-slide-in");f.addClass("ic-highlight-pulse");f.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){f.removeClass("ic-highlight-pulse")})});d.resolve()}else{c.bind("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(b){"ic-fade-out-animation"==b.originalEvent.animationName?
(a.$wikiContent.removeClass("ic-fade-out-animation"),a.$wikiContent.css("opacity","0.5")):"ic-fade-in-animation"==b.originalEvent.animationName&&(a.$wikiContent.css("opacity","1"),a.$wikiContent.removeClass("ic-fade-in-animation"),a.$wikiContent.unbind("webkitAnimationEnd oanimationend msAnimationEnd animationend"))});c.addClass("ic-fade-out-animation");a.$el.addClass("ic-slide-out");var g=function(){a.$el.removeClass("ic-slide-out");a._emptySidebar();v().css("padding-right","0");c.addClass("ic-fade-in-animation");
c.css("position","static");d.resolve();a.$el.off("webkitAnimationEnd oanimationend msAnimationEnd animationend",g)};a.$el.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",g)}return d.promise()};c.getDarkFeatures=function(){return g.clone(y)};c.getInlineLinks=q;c.removeInlineLinksDialog=function(a){a.each(function(){var a=q(this);a.length&&a.off("mousemove")})};c.isAnimationSupported=function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation};
c.showHighlightContent=function(a){a.parents(".expand-content.expand-hidden").each(function(a){e(this).siblings(".expand-control").click()})};c.getUnsupportedRtePlugins=function(){return g.clone(z)};c.getSupportedRtePlugins=function(){return g.clone(A)};c.confirmProcess=function(a){var b=d.Rte&&d.Rte.getEditor();if(!0===a){if(r()&&b&&b.isDirty())return confirm("Your comment will be lost.")}else if(b&&b.isDirty()&&Confluence.Editor&&!Confluence.Editor.getContentType)return confirm("Your comment will be lost.");
return!0};c.getAuthorDisplayName=function(){return d.Meta.get("user-display-name")||d.Meta.get("current-user-fullname")};c.isKeyboardShortcutsEnable=function(){return d.Meta.get("use-keyboard-shortcuts")&&Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.enabled};c.addSidebarHeadingTooltip=function(a){a.$("button.ic-action-hide").tooltip({gravity:"se"});a.$("#ic-nav-next").tooltip({gravity:"s"});a.$("#ic-nav-previous").tooltip({gravity:"s"})};c.hasEditorInSidebar=r;c.recalculateContentHeight=
function(a){if(t())a.css("padding-bottom","20px");else{var b=a.height();a=a.offset().top+b;b=this.getPageContainer().offset().top;a-=b;this.getPageContainer().css({"min-height":a+"px"})}};c.resizeContentAfterLoadingImages=function(a){a=a.closest(".ic-display-comment-view");var b=this,c=e(".confluence-embedded-image, .confluence-embedded-file img",a),d=c.length,f=0;0<d&&c.off("load").one("load",function(){++f===d&&b.recalculateContentHeight(a)}).each(function(){this.complete&&e(this).load()})};c.isDocTheme=
t;c.getPageContainer=v;c.getSplitterContent=u;c.scrollToCommentAfterToggleSideBar=function(a,b){(!b||b.is(":visible"))&&a&&(this.isDocTheme()?this.getSplitterContent().scrollTop(b.offset().top-a):window.scrollTo(0,b.offset().top-a))};c.getEditorFormat=function(a){var b=e.Deferred();e.ajax({url:d.contextPath()+"/rest/api/content/"+a+"?expand\x3dbody.editor",type:"GET",dataType:"json",contentType:"application/json; charset\x3dutf-8"}).then(function(a){b.resolve(a.body.editor.value)}).fail(function(a,
c,d){b.reject(a,c,d)});return b.promise()};c.containUnsupportedMacro=function(a){var b=a.closest(".conf-macro");return!1===b.data("hasbody")||0<a.find('.conf-macro[data-hasbody\x3d"false"]').length||-1!=B.indexOf(b.data("macro-name"))};c.containInternalLink=function(a){return 0<a.closest(".user-mention").length||0<a.find(".user-mention").length};c.containUserMetion=function(a){return 0<a.closest("a[href^\x3d'/']:not('.user-mention')").length||0<a.find("a[href^\x3d'/']:not('.user-mention')").length};
c.getCurrentUserInfo=function(){var a={isDefault:!0,path:d.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/default.png"};"/images/icons/profilepics/default.png"!==d.Meta.get("current-user-avatar-url")&&(a={isDefault:!1,path:d.contextPath()+d.Meta.get("current-user-avatar-url")});var b=d.Meta.get("remote-user");return{userName:""==b?null:b,displayName:d.Meta.get("current-user-fullname"),profilePicture:a}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:util-resource', location = 'util/text-highlighter.js' */
define("confluence/ic/util/text-highlighter",["jquery"],function(a){function c(){a.textHighlighter.createWrapper=function(b){return a("\x3cspan\x3e\x3c/span\x3e").addClass(b.highlightedClass)};this.$el=a("#content .wiki-content").first();0<this.$el.length&&this.$el.textHighlighter({highlightedClass:"ic-current-selection"})}c.prototype.highlight=function(b){if(0!==this.$el.length)return b=a(this.$el.getHighlighter().doHighlight(b)),this.$el.getHighlighter().serializeHighlights(b)};c.prototype.removeHighlight=
function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this};c.prototype.deserializeHighlights=function(b,a){if(0!==this.$el.length)return a='\x3cspan class\x3d"inline-comment-marker" data-ref\x3d"'+a+'"\x3e\x3c/span\x3e',this.$el.getHighlighter().deserializeHighlights(b,a)};return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/comment.js' */
define("confluence/ic/model/comment","jquery underscore backbone ajs confluence/ic/util/utils confluence/ic/model/reply-collection".split(" "),function(c,d,e,b,f,g){return e.Model.extend({defaults:{authorDisplayName:f.getAuthorDisplayName(),authorUserName:b.Meta.get("remote-user"),authorAvatarUrl:b.contextPath()+b.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",containerId:b.Meta.get("latest-page-id"),containerVersion:b.Meta.get("page-version"),parentCommentId:"0",lastFetchTime:c("meta[name\x3dconfluence-request-time]").attr("content"),
hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:b.contextPath()+"/rest/inlinecomments/1.0/comments",initialize:function(a){a=a||{};this._setHighlights(a.markerRef);var h=this;this.replies=new g;this.replies.url=function(){return h.url()+"/replies"};f.getDarkFeatures().DANGLING_COMMENT&&b.Meta.get("page-id")===b.Meta.get("latest-page-id")&&this.isDangling()&&!this.isResolved()&&this.resolve(!0,
{wait:!0,dangling:!0,success:d.bind(function(){e.trigger("ic:open:dangled",this)},this),error:d.bind(function(a,b){e.trigger("ic:resolve:dangled:failed",this)},this)})},validate:function(){if(!this.get("body"))return!0},resolve:function(a,b){b=b||{};this.save({},d.extend(b,{url:this.urlRoot+"/"+this.get("id")+"/resolve/"+a+"/dangling/"+(!0===b.dangling)}))},isResolved:function(){return this.get("resolveProperties").resolved},isDangling:function(){return void 0===this.highlight},isDeleted:function(){return this.get("deleted")},
_setHighlights:function(a){a=void 0!==a?c("#content .wiki-content:first").find('.inline-comment-marker[data-ref\x3d"'+a+'"]'):c(".ic-current-selection");0!==a.length?(this.highlights=a,this.highlight=a.first()):this.highlight=this.highlights=void 0},destroy:function(a){a=a?d.clone(a):{};var b=this,c=a.success;a.success=function(k){c&&c(b,k,a)};(function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b);a.trigger("error",a,d,b)}})(this,a);return this.sync("delete",this,a)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/comment-collection.js' */
define("confluence/ic/model/comment-collection",["jquery","backbone","ajs","underscore","confluence/ic/model/comment"],function(f,g,d,c,h){return g.Collection.extend({model:h,initialize:function(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:function(){var a=d.contextPath(),b=d.Meta.get("page-id");return a+"/rest/inlinecomments/1.0/comments?containerId\x3d"+b},getResolvedCount:function(){return this.getResolvedComments().length},getUnresolveCount:function(){return this.reject(function(a){return!0===
a.isResolved()&&!1===a.isDeleted()}).length},getResolvedComments:function(){return this.filter(function(a){return!0===a.isResolved()&&!1===a.isDeleted()})},getResolvedCommentsDesc:function(){return c.sortBy(this.getResolvedComments(),function(a){return 0-a.get("resolveProperties").resolvedTime})},getNextCommentOnPage:function(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage:function(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset:function(a){var b=this.getCommentsOnPage(),
e=this.findWhere({active:!0});if(void 0===e||1>=b.length)return null;var d=c.pluck(b,"id");e=c.indexOf(d,e.get("id"));return b[(e+a+b.length)%b.length]},getCommentsOnPage:function(){return this.filter(function(a){return!1===a.isResolved()&&!a.isDangling()&&!1===a.isDeleted()||!0===a.get("active")})},getCommentsOnPageCount:function(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments:function(){var a=c.pluck(this.getCommentsOnPage(),"id"),b=this.findWhere({active:!0});if(void 0===
b)return null;b=b.get("id");return c.indexOf(a,b)},comparator:function(a,b){void 0===this.markers&&(this.markers=f("#content .wiki-content:first").find(".inline-comment-marker"));return void 0===a.highlight?1:void 0===b.highlight?-1:this.markers.index(a.highlight)-this.markers.index(b.highlight)},_removeCachedMarkers:function(){this.markers=void 0}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/reply.js' */
define("confluence/ic/model/reply",["jquery","backbone","ajs","confluence/ic/util/utils"],function(f,d,a,c){return d.Model.extend({defaults:{authorDisplayName:c.getAuthorDisplayName(),authorUserName:a.Meta.get("remote-user"),authorAvatarUrl:a.contextPath()+a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:!!a.Meta.get("remote-user")},urlRoot:function(){return a.contextPath()+"/rest/inlinecomments/1.0/comments/"+this.get("commentId")+"/replies"},sync:function(e,
c,b){b=b||{};"create"===e&&(b.url=this.urlRoot()+"?containerId\x3d"+a.Meta.get("latest-page-id"));return d.sync.call(this,e,c,b)},validate:function(){if(!this.get("body"))return!0}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/reply-collection.js' */
define("confluence/ic/model/reply-collection",["backbone","confluence/ic/model/reply"],function(a,b){return a.Collection.extend({model:b})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:app', location = 'analytics/ic-analytics.js' */
define("confluence/ic/analytics",["ajs","underscore","backbone"],function(c,d,a){var b={};d.extend(b,a.Events);b.start=function(){!0!==this.running&&(this.running=!0,this.send=function(a,b){c.trigger("analytics",{name:a,data:b})},this.listenTo(a,"ic:highlight-panel-click",function(){this.send("confluence.highlight.actions.comment.inline")}),this.listenTo(a,"ic:view",function(a,b){this.send("confluence.comment.inline.view");"nav"===b&&this.send("confluence.comment.inline.view.nav");"permalink"===b&&
this.send("confluence.comment.inline.view.permalink")}),this.listenTo(a,"ic:overlap",function(){this.send("confluence.comment.inline.overlap")}),this.listenTo(a,"ic:edit",function(){this.send("confluence.comment.inline.edit")}),this.listenTo(a,"ic:persist",function(){this.send("confluence.comment.inline.create")}),this.listenTo(a,"ic:sidebar:close",function(){this.send("confluence.comment.inline.sidebar.close")}),this.listenTo(a,"ic:reply:persist",function(){this.send("confluence.comment.inline.reply")}),
this.listenTo(a,"ic:delete ic:reply:delete",function(){this.send("confluence.comment.inline.delete")}),this.listenTo(a,"ic:resolved",function(){this.send("confluence.comment.inline.resolved")}),this.listenTo(a,"ic:unresolved",function(){this.send("confluence.comment.inline.unresolved")}),this.listenTo(a,"ic:resolved:view",function(a){this.send("confluence.comment.inline.resolved.view",{total:a})}),this.listenTo(a,"ic:resolved:dismiss:recovery",function(){this.send("confluence.comment.inline.resolved.dismiss")}),
this.listenTo(a,"ic:resolved:show:recovery",function(){this.send("confluence.comment.inline.resolved.discovery")}),this.listenTo(a,"ic:open:dangled",function(a){a={commentId:a.get("id"),pageId:c.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",a)}),this.listenTo(a,"ic:editor:load:fail",function(){var a={pageId:c.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",a)}),this.listenTo(a,"ic:resolve:dangled:failed",function(a){a={commentId:a.get("id"),pageId:c.Meta.get("page-id")};
this.send("confluence.comment.inline.resolved.dangled.failed",a)}))};b.stop=function(){this.running=!1;this.stopListening()};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:app', location = '/app/app.js' */
define("confluence/ic/app/app","jquery backbone ajs confluence/ic/model/comment confluence/ic/model/comment-collection confluence/ic/analytics exports".split(" "),function(g,h,e,q,r,t,k){k.init=function(){function l(){c().done(function(a){a.afterSyncCommentCollection();a.displayPermalinkedComment(b)})}function c(){if(n){n=!1;if(f)return f.promise();f=g.Deferred();WRM.require("wrc!inline-comments-load-sidebar").then(function(){var a=require("confluence/ic/app/loader");a.init(b);f.resolve(a)})}m=!1;
return f.promise()}t.start();var n=!0,b=new r;g("body").on("click","#view-resolved-comments",function(a){a.preventDefault();c().done(function(a){a.createResolvedCommentListView()})});b.fetch({cache:!1}).done(function(){0<b.getCommentsOnPageCount()&&l();0<b.getResolvedCount()&&c().done(function(a){a.updateResolvedCommentCountInToolsMenu()})});-1!==window.location.search.indexOf("focusedCommentId")&&l();h.listenTo(h,"ic:resolved",function(){l()});g("#view-resolved-comments\x3espan").text("Resolved comments"+
e.format(" ({0})",b.getResolvedCount()));var k=function(a,p){var d=b.get(p),c=!1;void 0===d&&(d=new q({id:p}),c=!0);d.fetch({success:function(a){a._setHighlights(a.get("markerRef"));c?b.add(a):d.replies.isFetched=!1;h.trigger("ic:view",d,"quickreload")}})};e.bind("qr:show-new-thread",function(a,b){c().done(function(){k(a,b)})});e.bind("qr:add-new-highlight",function(a,b,d){c().done(function(){e.trigger("qr:add-new-highlight-text",[b,d])})});var f,m;Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",
{onClick:function(a){c().done(function(b){0==m&&(m=!0,b.loadSidebarOnClick(a))})},shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:bootstrap', location = '/app/bootstrap.js' */
require(["jquery","ajs","confluence/ic/app/app"],function(b,a,c){a.Meta.get("page-id")&&a.Meta.get("page-id")===a.Meta.get("latest-page-id")&&b(c.init)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-amd-resources', location = '/js/amd/confluence-amd.js' */
define("confluence",function(){return Confluence});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-amd-resources', location = '/js/amd/tinymce-amd.js' */
define("tinymce",function(){return tinymce});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:common', location = '/js/view-file-macro-utils.js' */
define("vfm/view-file-macro-utils",[],function(){return{DEFAULT_HEIGHT:"250",DEFAULT_HEIGHT_IN_COMMENT:"150",THUMBNAIL_STATUS_IN_PROGRESS:202,THUMBNAIL_STATUS_CONVERTED:200,THUMBNAIL_STATUS_ERROR:415,THUMBNAIL_STATUS_BUSY:429,THUMBNAIL_POLLING_PERIOD:1E3,THUMBNAIL_POLLING_BACKOFF_RATIO:1.25,MAP_NICE_TYPE_TO_TEXT:{"pdf document":"PDF","word document":"Document","excel spreadsheet":"Spreadsheet",
"powerpoint presentation":"Presentation","generic file":"File"},getFileNameFromUrl:function(a){if(!a)return"";var b=a.indexOf("#");b=0<=b?b:a.length;a=a.substring(0,b);b=a.indexOf("?");b=0<=b?b:a.length;a=a.substring(0,b);b=a.lastIndexOf("/");a=a.substring(b+1,a.length);return decodeURIComponent(a)},isSupportPointerEvents:function(){var a=document.createElement("x");a.style.cssText="pointer-events:auto";return"auto"===
a.style.pointerEvents},getParameterByName:function(a,b){var c=a.indexOf("#");0<=c&&(a=a.substring(0,c));return(a=(new RegExp(b+"\x3d([^\x26]*)","i")).exec(a))?decodeURIComponent(a[1]):null},addParamsToUrl:function(a,b){var c=-1===a.indexOf("?")?"?":"\x26";for(var e=Object.keys(b),d=0;d<e.length;d++){var f=e[d],g=b[f];0<d&&(c+="\x26");c+=f+"\x3d"+g}return a+c},getFileTypeTextFromNiceType:function(a){a=a?a.toLowerCase():"";return this.MAP_NICE_TYPE_TO_TEXT[a]?this.MAP_NICE_TYPE_TO_TEXT[a]:a}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:common', location = '/js/services/conversion-service.js' */
define("vfm/services/conversion-service",["ajs","jquery"],function(d,e){return{postThumbnailConversionResults:function(b){var a=d.contextPath()+"/rest/documentConversion/latest/conversion/thumbnail/results",c=Object.keys(b);c=_.map(c,function(a){return{id:a,v:b[a].version}});return e.ajax({type:"POST",url:a,contentType:"application/json",data:JSON.stringify(c)})},getThumbnailUrl:function(b,a){return d.contextPath()+"/rest/documentConversion/latest/conversion/thumbnail/"+b+"/"+a}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:file-types-utils-resources', location = 'utils/file-types-utils.js' */
define("confluence-editor/utils/file-types-utils",[],function(){var b={},c={};"code|css,htm,html,java,js,xhtml,xml|text/css,text/html,text/javascript,text/x-java-source,text/xml doc|doc,docx,dot|application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document image|bmp,gif,jpe,jpeg,jpg,png,tif,tiff|image/bmp,image/gif,image/jpeg,image/png,image/tiff pdf|pdf|application/pdf ppt|pot,pps,ppt,pptx|application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation txt|asc,diff,log,text,txt|text/plain video|avi,flv,m4a,m4v,mov,mp2,mp3,mp4,mpe,mpeg,mpega,mpg,mpga,qt,rv,wav,webm,wmv|audio/mp3,audio/mp4,audio/mpeg,audio/x-wav,video/avi,video/mp4,video/mpeg,video/quicktime,video/vnd.rn-realvideo,video/webm,video/x-flv,video/x-m4v,video/x-ms-wmv xls|xlb,xls,xlsx|application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet zip|ear,jar,war,zip|application/java-archive,application/zip".split(" ").forEach(function(a){var a=
a.split("|"),d="aui-iconfont-file-"+a[0],e=a[1].split(",");a[2].split(",").forEach(function(a){b[a]=d});e.forEach(function(a){c[a]=d})});return{getAUIIconFromMime:function(a){return b[a]||"aui-iconfont-file-generic"},getAUIIconFromExt:function(a){return c[a]||"aui-iconfont-file-generic"},isImage:function(a){return b[a]&&0===a.indexOf("image/")}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/utils/file-types-utils","AJS.Confluence.FileTypesUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-soy-resources', location = '/templates/embedded-file-view.soy' */
// This file was automatically generated from embedded-file-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.ViewFileMacro.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.ViewFileMacro == 'undefined') { Confluence.ViewFileMacro = {}; }
if (typeof Confluence.ViewFileMacro.Templates == 'undefined') { Confluence.ViewFileMacro.Templates = {}; }


Confluence.ViewFileMacro.Templates.embeddedFile = function(opt_data, opt_ignored) {
  return '<span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="' + soy.$$escapeHtml(opt_data.fileSrc) + '" data-nice-type="' + soy.$$escapeHtml(opt_data.niceType) + '" data-file-src="' + soy.$$escapeHtml(opt_data.fileSrc) + '" data-linked-resource-id="' + soy.$$escapeHtml(opt_data.attachmentId) + '" data-linked-resource-type="attachment" data-linked-resource-container-id="' + soy.$$escapeHtml(opt_data.containerId) + '" data-linked-resource-default-alias="' + soy.$$escapeHtml(opt_data.fileName) + '" data-mime-type="' + soy.$$escapeHtml(opt_data.mimeType) + '" data-has-thumbnail="' + ((opt_data.hasThumbnail) ? 'true' : 'false') + '" data-linked-resource-version="' + soy.$$escapeHtml(opt_data.attachmentVersion) + '" data-can-edit="' + soy.$$escapeHtml(opt_data.canEdit) + '" aria-label="' + soy.$$escapeHtml(opt_data.fileName) + '"' + ((opt_data.unresolvedCommentCount && opt_data.unresolvedCommentCount >= 0) ? 'data-unresolved-comment-count=' + soy.$$escapeHtml(opt_data.unresolvedCommentCount) : '') + '><img src="' + soy.$$escapeHtml(opt_data.placeholderSrc) + '" height="' + soy.$$escapeHtml(opt_data.height) + '" />' + ((! opt_data.hasThumbnail) ? '<span class="title">' + soy.$$escapeHtml(opt_data.fileName) + '</span>' : '') + '</a>' + ((opt_data.canEdit) ? Confluence.ViewFileMacro.Templates.companionEditButtonPlaceholder(opt_data) : '') + '</span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.embeddedFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.embeddedFile';
}


Confluence.ViewFileMacro.Templates.embeddedUnknownFile = function(opt_data, opt_ignored) {
  return '<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-file unknown-attachment" src="' + soy.$$escapeHtml(opt_data.placeholderSrc) + '" /></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.embeddedUnknownFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.embeddedUnknownFile';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFile = function(opt_data, opt_ignored) {
  return '<span class="overlay"></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFile';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount = function(opt_data, opt_ignored) {
  return '<span class="comment-count-overlay"><span class="content">' + soy.$$escapeHtml(opt_data.commentCountRep) + '</span></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc = function(opt_data, opt_ignored) {
  return '<span class="file-type-desc-overlay"><i class="aui-icon aui-icon-small ' + soy.$$escapeHtml(opt_data.iconClass) + '"></i><span class="content"> ' + soy.$$escapeHtml(opt_data.fileType) + '</span></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc';
}


Confluence.ViewFileMacro.Templates.companionEditButtonPlaceholder = function(opt_data, opt_ignored) {
  return '<span class="companion-edit-button-placeholder edit-button-overlay" data-linked-resource-container-id="' + soy.$$escapeHtml(opt_data.containerId) + '" data-linked-resource-id="' + soy.$$escapeHtml(opt_data.attachmentId) + '" data-template-name="companionEditIcon" data-source-location="embedded-attachment"></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.companionEditButtonPlaceholder.soyTemplateName = 'Confluence.ViewFileMacro.Templates.companionEditButtonPlaceholder';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-resources', location = '/js/services/file-service.js' */
define("vfm/services/file-service",["ajs","jquery"],function(b,c){return{getCommentCount:function(d,e){var a="/rest/files/1.0/files/content/{0}/commentCount?attachmentId\x3d{1}";a=b.contextPath()+b.format(a,d,e);return c.get(a)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-resources', location = '/js/components/embedded-file-view.js' */
define("vfm/components/embedded-file-view",["jquery","backbone","ajs","confluence/legacy","vfm/view-file-macro-utils"],function(f,q,k,g,l){return{render:function(b){b=f(b.el);var a=b.find(".confluence-embedded-image, .confluence-embedded-file");if(a.hasClass("unknown-attachment")||a.attr("src")&&0<=a.attr("src").indexOf("/confluence/plugins/servlet/confluence/placeholder/unknown-attachment"))return this;var e="",h=a.hasClass("confluence-embedded-image"),c=b.parent().is("a"),m="true"===a.attr("data-has-thumbnail");
if(h)var d="image/png";else d=a.attr("data-mime-type"),e="null"!==a.attr("data-nice-type")?a.attr("data-nice-type"):"generic file";if(c)c="";else{c="";var n=a.attr("data-linked-resource-container-id"),p=a.attr("data-linked-resource-id");n&&p&&(a=a.attr("data-unresolved-comment-count"),a=parseInt(a,10),a=f.isNumeric(a)?a:0,a=9<a?"9+":a+"","0"!==a&&(c=g.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount({commentCountRep:a})))}d=!h&&m?g.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc({fileType:l.getFileTypeTextFromNiceType(e),
iconClass:k.Confluence.FileTypesUtils.getAUIIconFromMime(d)}):"";if(c||d)e=g.ViewFileMacro.Templates.overlayEmbeddedFile(),b.append(f(e).append(c).append(d)),d&&b.addClass("has-comment-overlay")}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources', location = '/js/vfm.js' */
require(["jquery","ajs","vfm/components/embedded-file-view"],function(a,b,c){a(document).on("click",".confluence-embedded-file.unknown-attachment",function(a){a.preventDefault()});b.toInit(function(){a(".confluence-embedded-file-wrapper").each(function(){c.render({el:this})})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-core-resources', location = 'loader/profiles.js' */
define("confluence-editor/profiles",["jquery","ajs"],function(d,c){return{createProfileForCommentEditor:function(){return{plugins:"searchreplace confluenceimagedialog autocompletemacro confluencemacrobrowser confluenceleavecomment confluencewatch autoresize".split(" ")}},createProfileForPageEditor:function(a){var b="searchreplace confluencedrafts confluenceimagedialog autocompletemacro confluencemacrobrowser flextofullsize referrer".split(" ");c.Meta.getBoolean("shared-drafts")&&c.DarkFeatures.isEnabled("unpublished-changes-lozenge")&&
b.push("unpublishedchanges");a&&a.versionComment&&b.push("confluenceversioncomment");a&&a.notifyWatchers&&b.push("confluencenotifywatchers");return{plugins:b}},createProfileForTemplateEditor:function(){return{plugins:"searchreplace confluenceimagedialog autocompletemacro confluencemacrobrowser confluenceleavetemplate flextofullsize confluencetemplateeditor".split(" ")}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/profiles","AJS.Confluence.Editor._Profiles");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-util', location = 'jscripts/util.js' */
define("confluence-quick-edit/util",["window","ajs"],function(c,d){return{generateUUID:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getBaseUrl:function(){var a=c.location.protocol.replace(/:$/,"")+"://"+c.location.host+"/"+c.location.pathname.replace(/^\//,""),b=c.location.search.replace(/^\?/,""),b=b.replace(/&?focusedCommentId=\d+/,""),b=b.replace(/^&/,"");return{url:a,search:b,addQueryParam:function(a,
b){this.search=this.search?this.search+"&"+a+"="+b:a+"="+b},toString:function(){return this.url+"?"+this.search}}},timeoutDeferred:function(a,b,c){"function"!==typeof b.reject&&d.log("WARNING: invalid, not rejectable object passed to AJS.Confluence.QuickEdit.Util.timeoutDeferred. You should use a Deferred object");setTimeout(function(){"pending"===b.state()&&(d.logError("Timeout: "+a),b.reject("timeout"))},c);return b}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/util","AJS.Confluence.QuickEdit.Util");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:querystring', location = '/includes/js/api/querystring.js' */
define("confluence/api/querystring",[],function(){return{stringify:function(a){var b="",c;for(c in a)for(var d=0;d<a[c].length;d++)b+="&"+c,a[c][d]&&(b+="="+a[c][d]);return b.substring(1)},parse:function(a){var b={};if(a){"?"===a.substr(0,1)&&(a=a.substr(1));for(var a=a.split("&"),c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]||(b[d[0]]=[]);b[d[0]].push(a[c].substring(d[0].length+1))}}return b}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:url', location = '/includes/js/api/url.js' */
define("confluence/api/url",["confluence/api/querystring","jquery"],function(d,e){var g=/([^?|#]+)[?]?([^#]*)[#]?(.*)/,f=["source","urlPath","queryParams","anchor"];return{parse:function(a){var b={};if(a=g.exec(a)){for(var c=0;c<f.length;c++)b[f[c]]=a[c];b.queryParams=d.parse(b.queryParams)}return b},format:function(a){return e.isEmptyObject(a)?"":(!a.urlPath?"":a.urlPath)+(e.isEmptyObject(a.queryParams)?"":"?"+d.stringify(a.queryParams))+(!a.anchor?"":"#"+a.anchor)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:analytics-support', location = '/includes/js/analytics-support.js' */
define("confluence/analytics-support","jquery ajs confluence/meta window document confluence/api/url".split(" "),function(j,o,l,k,m,h){var b={},n;b.setAnalyticsSource=function(a,d){if(typeof n==="undefined"){var c=j._data(k,"events");n=c&&c.analytics&&c.analytics.length>0}n&&a.attr("href",function(a,c){var b=encodeURIComponent(d),g=h.parse(c);if(!j.isEmptyObject(g))g.queryParams.src=[b];return h.format(g)})};b.srcRemovedUrl=function(a){a=h.parse(a);delete a.queryParams.src;for(var d=Object.keys(a.queryParams),
c=0;c<d.length;c++){var b=d[c],f=b.split(".");f.length===3&&f[0]==="src"&&delete a.queryParams[b];b==="jwt"&&delete a.queryParams[b]}return h.format(a)};b.srcParamValues=function(a){return(a=h.parse(a).queryParams)&&a.src?a.src:[]};b.srcAttrParamValues=function(a){for(var a=h.parse(a).queryParams,b={},c=Object.keys(a),e=0;e<c.length;e++){var f=c[e],i=f.split(".");if(i.length===3&&i[0]==="src"){var g=i[1],i=i[2];b[g]=b[g]||{};b[g][i]=decodeURIComponent(a[f][0])}}return b};b.extractAnalyticsData=function(a){for(var d=
[],c=b.srcParamValues(a),a=b.srcAttrParamValues(a),e=0;e<c.length;e++){var f=c[e];d.push({src:f,attr:a[f]||{}})}return d};b.publish=function(a,b){o.trigger("analytics",{name:a,data:b||{}})};b.init=function(){var a=b.extractAnalyticsData(m.URL),d={userKey:l.get("remote-user-key"),pageID:l.get("page-id"),draftID:l.get("draft-id")};if(a.length>0){for(var c=0;c<a.length;c++){var e=a[c],f=j.extend({},d,e.attr);b.publish("confluence.viewpage.src."+e.src,f)}if(k.history&&k.history.replaceState){a=b.srcRemovedUrl(m.URL);
m.URL!==a&&k.history.replaceState(null,"",a)}}else b.publish("confluence.viewpage.src.empty",d)};return b});require("confluence/module-exporter").exportModuleAsGlobal("confluence/analytics-support","AJS.Confluence.Analytics",function(j){require("ajs").toInit(j.init)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/captcha-manager.js' */
define("confluence-quick-edit/captcha-manager",["jquery","ajs"],function(d,e){return function(f){function a(a){return d(f||"body").find(a)}return{refreshCaptcha:function(){var b=a("img.captcha-image");if(0<b.length){var c=Math.random();b.attr("src",e.contextPath()+"/jcaptcha?id="+c);a('input[name="captchaId"]').val(c);a('input[name="captchaResponse"]').val("")}},getCaptchaData:function(){return{id:a('input[name="captchaId"]').val(),response:a('input[name="captchaResponse"]').val()}}}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/captcha-manager","AJS.Confluence.QuickEditCaptchaManager");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/quick-edit.js' */
define("confluence-quick-edit/quick-edit","ajs confluence-editor-loader/block-and-buffer-keys confluence/legacy confluence/templates confluence/meta jquery window document confluence-editor-loader/editor-loader confluence/api/event confluence/api/logger confluence-quick-edit/captcha-manager confluence-quick-edit/util wrm".split(" "),function(i,u,e,r,j,a,v,w,o,c,g,k,x,y){function z(){var b=new a.Deferred;o.load(function(){setTimeout(function(){b.resolve()},0)},function(){b.reject()});return b}var s=
{enableShortcut:function(){a("#editPageLink").addClass("full-load")},disableShortcut:function(){a("#editPageLink").removeClass("full-load")}},l=[],q={loadingContentTimeout:4E3,register:function(b){l.push(b)},disableHandlers:function(){a.each(l,function(b,a){return a.disable()})},enableHandlers:function(){a.each(l,function(b,a){return a.enable()})},SaveBarBinder:{bind:function(b,a){b&&e.Editor.addSaveHandler(b);a&&e.Editor.addCancelHandler(a)}},activateEditor:function(b){function e(){function f(b){var c=
new a.Deferred;y.require(b).done(function(b){c.resolve(b)}).fail(function(b){c.reject(b)});return c}var l,m=new a.Deferred;if(j.get("access-mode")==="READ_ONLY"){g.logError("activateEditor could not be initialised: Read-only mode is enabled");return m.reject("READ_ONLY")}if(i.Rte&&i.Rte.getEditor()){g.debug("there is already an editor open");return m.reject("EDITOR_OPEN")}if(!b.$container||!b.$form){g.logError("activateEditor could not be initialised: bad arguments",b);return m.reject("BAD_ARGS")}l=
u.block(a(w));b.preActivate&&b.preActivate();s.disableShortcut();var t=b.timeoutResources||o.loadingTimeout,k=q.loadingContentTimeout,n=x.timeoutDeferred;a.when(n("resources",z(),t),n("fetch content",b.fetchContent||a.Deferred().resolve(),k),n("additional resources",b.additionalResources?f(b.additionalResources):a.Deferred().resolve(),t)).done(function(e,f){var d={$container:b.$container,content:f,$form:b.$form,replayBufferedKeys:l};b.preInitialise&&b.preInitialise(d);var h=o.getPreloadContainer();
a(".quick-comment-prompt",d.$container).hide();a(".quick-comment-body",d.$container).addClass("comment-body");if(d.content&&d.content.title){var p=d.content.title;h.find("#content-title").val(p)}d.$form.append(h.children());h.show();a("#editor-precursor").hide();a("#rte-savebar").find(".toolbar-split-left").hide();if(j.get("content-type")==="comment"){a("#pluggable-status").hide();var h=r.Editor.Page.cancelButton({contentType:j.get("content-type"),sharedDraftsEnabled:j.getBoolean("shared-drafts")}),
p=a("#rte-button-cancel"),k=p.parent(".rte-toolbar-group-done");if(k.length){k.remove();a("#rte-button-discard").remove()}else p.remove();a("#rte-savebar").find(".toolbar-split-right").append(h);h=r.Editor.Page.previewButton({});a("#rte-button-ellipsis").parent().remove();a("#rte-savebar").find(".toolbar-group-preview").empty().append(h)}var n=function(){d.editor=i.Rte.getEditor();d.$container.find(".quick-comment-loading-container").hide();d.$form.show();d.$form.addClass("fadeIn");var a=d.editor,
e=d.content?d.content.editorContent:"",f=d.replayBufferedKeys;if(e){g.debug("Initial Editor Content from quick edit: ",e);a.setContent(e);a.startContent=a.getContent({format:"raw",no_events:1});a.undoManager.clear()}f()&&a.undoManager.add();c.trigger("quickedit.success");c.trigger("quickedit.visible");c.trigger("add-bindings.keyboardshortcuts");c.trigger("active.dynamic.rte");b.postInitialise&&b.postInitialise(d);q.SaveBarBinder.bind(b.saveHandler,b.cancelHandler);c.trigger("rte-quick-edit-ready");
a=j.get("content-type");j.get("collaborative-content")&&(a==="page"||a==="blogpost")&&c.trigger("rte-collab-editor-loaded");c.unbind("rte-ready",n);m.resolve()};c.bind("rte-ready",n);c.bind("rte-destroyed",b.postDeactivate||function(){});i.Rte.BootstrapManager.initialise({plugins:b.plugins,toolbar:b.toolbar,excludePlugins:b.excludePlugins,isQuickEdit:true,onInitialise:b.onInitialise})}).fail(function(a,e){m.reject(a,e);g.logError("Error loading page quick edit. Falling back to normal edit URL...");
c.trigger("analytics",{name:"rte.quick-edit.activate-editor.failed"});if(b.fallbackUrl){g.log("This parameter is deprecated. To be removed in the next major version (5.8 or 6.0). Please use the promise returned to bind custom action if the editor fails to load instead.");v.location=b.fallbackUrl}});return m.promise()}if(b.closeAnyExistingEditor&&i.Rte&&i.Rte.getEditor()){var f=new a.Deferred;this.deactivateEditor().done(function(){e().done(function(){f.resolve()}).fail(function(a){f.reject(a)})}).fail(function(){g.debug("Could not deactivate current editor.");
f.reject("Could not deactivate current editor.")});return f.promise()}return e()},deactivateEditor:function(){require("tinymce").majorVersion>=4?require("tinymce").execCommand("mceRemoveEditor",true,"wysiwygTextarea"):require("tinymce").execCommand("mceRemoveControl",true,"wysiwygTextarea");e.Editor.UI.toggleSavebarBusy(false);var b=o.getPreloadContainer().empty();a(".editor-container").remove();a("#editor-precursor").remove();a("#anonymous-warning").remove();a(".quick-comment-prompt").show();a(".bottom-comment-panels").show();
a("#editor-notification-container").empty();a(".action-reply-comment").removeAttr("reply-disabled");s.enableShortcut();e.Editor.removeAllSaveHandlers();e.Editor.removeAllCancelHandlers();return o.getEditorPreloadMarkup().done(function(a){b.append(a);b.hide();(new k(b)).refreshCaptcha();c.trigger("rte-destroyed");c.unbind("rte-destroyed")})}};return q});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/quick-edit","AJS.Confluence.QuickEdit");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/view.js' */
define("confluence-quick-edit/handlers/view",["jquery","ajs","window"],function(c,d,e){return function(){var a;sessionStorage.viewPort&&(a=JSON.parse(sessionStorage.viewPort));if(a&&a.pageId==d.params.pageId){var b;b=c("#main-content");var f=c("#header");b=-1!==a.blockIndex?b.children().first().children().eq(a.blockIndex).find(".innerCell").eq(a.columnIndex).children().eq(a.index):b.children().eq(a.index);e.scrollTo(0,b.offset().top+a.offset-f.outerHeight())}delete sessionStorage.viewPort}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/handlers/view",function(c){require("ajs").toInit(c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/shortcut.js' */
define("confluence-quick-edit/handlers/shortcut",["ajs"],function(a){var d=!1;a.bind("initialize.keyboardshortcuts add-bindings.keyboardshortcuts",function(){d=!0});a.bind("remove-bindings.keyboardshortcuts",function(){d=!1});return{createShortcut:function(f,g){function b(){c=c||a.whenIType(f).moveToAndClick(g)}function e(){c&&c.unbind();c=null}var c;return{bind:function(){d&&b();a.bind("initialize.keyboardshortcuts",b);a.bind("add-bindings.keyboardshortcuts",b);a.bind("remove-bindings.keyboardshortcuts",
e)},unbind:function(){e();a.unbind("initialize.keyboardshortcuts",b);a.unbind("add-bindings.keyboardshortcuts",b);a.unbind("remove-bindings.keyboardshortcuts",e)}}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/shortcut","AJS.Confluence.QuickEdit.KeyboardShortcuts");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/page.js' */
define("confluence-quick-edit/handlers/page","jquery ajs confluence/legacy confluence/analytics-support wrm/context-path confluence/dark-features confluence/api/event confluence/api/logger confluence/meta confluence/aui-overrides window confluence/api/browser confluence-editor/editor/page-editor-message confluence/message-controller confluence-quick-edit/quick-edit confluence-quick-edit/handlers/shortcut".split(" "),function(b,i,l,p,s,I,f,o,g,A,m,B,C,n,t,D){function q(){var a=b("#editPageLink");a.find(".aui-icon").css("visibility",
"visible");a.parent().spinStop()}function u(){var a=g.get("content-type");return g.get("collaborative-content")&&(a==="page"||a==="blogpost")}function v(a,c,d){var e={pageId:d,blockIndex:-1,columnIndex:-1,index:-1,offset:0,hasBlock:function(){return this.blockIndex!==-1}},h=false,f=function(a){var b=a.offset();return b.top-8<=c&&b.top+a.height()>=c},g=function(a,b){var d=a.offset();if(f(a)){e.index=b;e.offset=c-d.top;h=true}};if(a.children().length===1&&a.children().first().hasClass("contentLayout2")){a.children().first().children().each(function(a){if(!e.hasBlock()&&
f(b(this)))e.blockIndex=a});if(e.hasBlock()){a=a.children().first().children().eq(e.blockIndex).find(".innerCell");a.each(function(a){if(e.columnIndex===-1){var d=b(this).children().length;if(d>0)if(d<2){if(b(this).children().first().height()>25)e.columnIndex=a}else e.columnIndex=a}});a.eq(e.columnIndex).children().each(function(a){h||g(b(this),a)})}}else a.children().each(function(a){h||g(b(this),a)});return h?e:null}function E(a){var c=require("tinymce");j.disable();A.metaToParams();var d=b("#main-content"),
e=b("#header"),h=b("#main-header"),e=m.pageYOffset+e.outerHeight()+h.outerHeight();k=v(d,e,i.params.pageId);f.trigger("quick-edit.viewport.saved");var w=function(){b(c.activeEditor.getWin().document).find("body#tinymce").addClass("page-edit");b("#content").css({paddingRight:0});f.unbind("quickedit.visible",w)};f.bind("quickedit.visible",w);d=a.$form;e=g.get("content-type")==="page"?"doeditpage":"doeditblogpost";e=s()+"/pages/"+e+".action?pageId="+l.getContentId();b(".ia-splitter-left").remove();try{b("#main").unwrap()}catch(n){}b("#rte").removeClass("editor-default").addClass("editor-fullheight");
a.$container.children().remove();b(".editor-container").children().eq(0).unwrap();d.attr({"class":"editor aui",action:e,name:"editpageform",id:"editpageform",style:""});a.$container.append(d);a.$container.removeClass("view").addClass("edit");b("body").addClass("contenteditor edit")}function F(a){require("tinymce");b("#editor-precursor").show();b("#rte-savebar").find(".toolbar-split-left").show();if(m.history.pushState){var c=b("#editPageLink").attr("href");if(c!==m.location.pathname+m.location.search){history.pushState({quickEdit:true},
"",c);f.trigger("rte-quick-edit-push-state",c)}}else{m.location.hash="editor";f.trigger("rte-quick-edit-push-hash")}c=a.content;if(c.permissions)for(var d in c.permissions)b("#"+d).attr("value",c.permissions[d]);b("#originalVersion").val(a.content.pageVersion);g.set("page-version",a.content.pageVersion);g.set("page-title",a.content.title);b('meta[name="page-version"]').attr("content",a.content.pageVersion);b('meta[name="ajs-page-version"]').attr("content",a.content.pageVersion);b("#syncRev").val(a.content.syncRev);
g.set("conf-revision",a.content.confRev);b('meta[name="ajs-conf-revision"]').attr("content",a.content.confRev);d=a.content.atlToken;g.set("atl-token",d);b('input[name="atl_token"]').val(d);f.trigger("analyticsEvent",{name:"quick-edit-success"});b("#navigation").remove();var e=new Date,h=function(b){if(e&&!(b.type==="keydown"&&[91,92,93,224,33,34,37,38,39,40,16,17,18,20,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(b.keyCode)>-1)){b=new Date-e;e=null;p.publish("confluence.editor.transition.firstkeydown",
{delay:b});a.editor.off("keydown",h);a.editor.off("Change",h)}};a.editor.on("keydown",h);a.editor.on("Change",h);l.debugTimeEnd("confluence.editor")}function G(a){var c=function(){f.unbind("rte-ready",c);if(k){var d;d=b(a.getBody());d=k.hasBlock()?d.children().first().children().eq(k.blockIndex).find(".innerCell").eq(k.columnIndex).children().eq(k.index):d.children().eq(k.index);a.getWin().scrollTo(0,d.offset().top+k.offset);b("#main").css("visibility","visible")}};return function(){f.bind("rte-ready",
c)}}function x(a){f.trigger("rte-collaborative-content-ready",a)}function H(){var a=new b.Deferred;l.debugTime("confluence.editor.quick.fetchContent");var c=b.ajax({url:s()+"/rest/tinymce/1/content/"+l.getContentId()+".json",cache:false});c.success(function(b){g.get("edit-mode")&&g.get("edit-mode")!==b.editMode&&a.reject("edit mode change",c);l.debugTimeEnd("confluence.editor.quick.fetchContent");u()&&x(b);f.bind("synchrony-events-bound",function h(){x(b);f.unbind("synchrony-events-bound",h)});a.resolve(b)});
c.error(function(b){a.reject("error fetching content",b)});return a}function y(a,c){if(c)switch(c.status){case 405:q();n.showError(n.parseError(c),n.Location.FLAG);return;case 423:var d=JSON.parse(c.responseText).user;q();d={title:"Unable to edit",body:i.format("Collaborative editing is offline right now, and {0} is editing this page. Try again in a few minutes.",i.escapeHtml(d))};n.showError(d,n.Location.FLAG);return;case 412:q();C.handleMessage("collab.edit.user.limit.reached",{type:"warning",title:"You can\u0027t edit this page right now",
message:"\u003cp\u003eThis page is so popular, you\u0027ve reached the maximum number of simultaneous editors.\u003c/p\u003e\u003cp\u003eTry again when it\u0027s not so busy.\u003c/p\u003e",close:"manual"});p.publish("collab.edit.user.limit.reached",{browserName:z.friendlyName(),browserVersion:z.version(),pageId:g.get("page-id"),editMode:"quick",numEditors:g.get("max-number-editors")});return}m.location=b("#editPageLink").attr("href")}var r,k,z=new B(m.navigator.userAgent),j={editShortcut:D.createShortcut("e","#editPageLink"),activateEventHandler:function(a){if(!a.metaKey&&!a.shiftKey&&!a.ctrlKey&&!a.altKey&&!(a.which===2||a.which===
3)){a.preventDefault();if(r&&r.state()==="pending")o.debug("Editor is being activated. Ignoring handler...");else{r=j.activateEditor();a=b("#editPageLink");a.find(".aui-icon").css("visibility","hidden");a.spin();a=b("#draft-status-lozenge");a.text()!==""&&p.publish("confluence.drafts.referrer",{referrerPage:"view",lozengeType:a.text()})}}},enable:function(){if(b("body").is(".theme-default")){var a=b("#editPageLink");a.bind("click",j.activateEventHandler);a.removeClass("full-load");j.editShortcut.bind();
o.debug("QuickPageEdit enabled")}else o.debug("QuickPageEdit not enabled")},activateEditor:function(){l.debugTime("confluence.editor");u()&&f.trigger("rte-quick-edit-init");var a=b("#content").find(".quick-comment-form"),c=function(){var a=require("tinymce").activeEditor.getWin(),c=b(a.document).find("#tinymce");if(a=v(c,a.pageYOffset,i.params.pageId))sessionStorage.viewPort=JSON.stringify(a)};return t.activateEditor({fetchContent:H(),$container:b("#content"),$form:a.length?a:b('<form method="post"></form>'),
preInitialise:E,postInitialise:F,saveHandler:function(){c()},cancelHandler:function(){c()},plugins:l.Editor._Profiles.createProfileForPageEditor({versionComment:true,notifyWatchers:true}).plugins,onInitialise:function(a){a.on("Load",G(a));i.messages.setup()}}).fail(y)},disable:function(){o.debug("QuickPageEdit disabled.");j.editShortcut.unbind();b("#editPageLink").unbind("click",j.activateEventHandler)}};t.register(j);return{disable:j.disable,_objForTesting:{onFailActivateEditor:y}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/page","AJS.Confluence.QuickEdit.QuickEditPage");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/init.js' */
define("confluence-quick-edit/init",["ajs","jquery","window"],function(a,b,c){return function(){b("body").hasClass("page-gadget")?a.debug("QuickComment: editor preload is disabled"):b(c).load(function(){a.debug("QuickComment: instigated background loading of the comment editor.");a.Confluence.EditorLoader.load()});a.Confluence.QuickEdit.enableHandlers();a.trigger("rte-quick-edit-enable-handlers")}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/init",function(a){var b=require("ajs"),c=require("jquery");b.DarkFeatures.isEnabled("disable-quick-edit")?b.log("disable-quick-edit is turned on; run AJS.Confluence.EditorLoader.load() manually."):c(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment.js' */
define("confluence-quick-edit/handlers/comment","jquery ajs confluence/legacy wrm/context-path confluence-editor-loader/editor-loader confluence/api/event aui/flag confluence/api/logger confluence-editor/editor/page-editor-message confluence/message-controller confluence/meta confluence-quick-edit/captcha-manager confluence-quick-edit/handlers/page confluence-quick-edit/util".split(" "),function(f,b,i,o,p,l,t,q,e,g,c,r,s,m){function n(a,h){var b=a.match(RegExp("[?&]"+h+"=(\\d+)"));return b&&b.length>
1?parseInt(b[1],10):0}f(function(){b.AppLinksInitialisationBinder=function(a){l.bind("init.rte",a)}});var j={timeout:8E3,showLoadingEditorErrorMessage:function(a){var h={};l.trigger("rte-quick-comment-loading-failed");if(a==="READ_ONLY"){h.title="This site is read-only";h.body="You can\u0027t make changes right now."}else{h.title="Error";h.body="Error loading the comment editor. Please refresh the page to try again."}g.showError(h,
g.Location.FLAG)},preInitialise:function(){s.disable();c.set("content-type","comment");c.set("draft-type","");b.params.contentType="comment";b.params.draftType="";c.set("use-inline-tasks","false");f("#editor-precursor").children().eq(0).hide();f("#pagelayout-menu").parent().hide();f("#page-layout-2-group").hide();f("#rte-button-tasklist").remove();f("#pluggable-status-container").remove();f("#rte-insert-tasklist").parent().remove()},postInitialise:function(a){b.Rte.editorFocus(a.editor)},delegatingSaveCommentHandler:function(a){return a.asyncRenderSafe?
j.ajaxSaveCommentHandler(a):j.reloadPageSaveCommentHandler(a)},reloadPageSaveCommentHandler:function(a){var b=m.getBaseUrl();b.addQueryParam("focusedCommentId",a.id);b.addQueryParam("refresh",+new Date);window.location.href=b.toString()+"#comment-"+a.id},ajaxSaveCommentHandler:function(a){var b={isDefault:true,path:c.get("static-resource-url-prefix")+"/images/icons/profilepics/default.png"};c.get("current-user-avatar-uri-reference")!==o()+"/images/icons/profilepics/default.png"&&(b={isDefault:false,
path:c.get("current-user-avatar-uri-reference")});var d=c.get("remote-user"),f={userName:d===""?null:d,displayName:c.get("current-user-fullname"),profilePicture:b};j.cancelComment().done(function(){i.CommentDisplayManager.addOrUpdateComment(f,a,true,false);l.trigger("page.commentAddedOrUpdated",{commentId:a.id})})},cancelHandler:function(){var a=require("confluence-quick-edit/quick-edit");b.Rte.Content.editorResetContentChanged();a.deactivateEditor()},createCommenterParam:function(a,b,d){return{userName:b||
c.get("remote-user")||null,displayName:d||c.get("user-display-name"),profilePicture:{isDefault:a.hasClass("defaultLogo"),path:a.attr("src")}}},createSaveHandler:function(a,h){var d=m.generateUUID();return function(c){var k=require("confluence/editor-notifications");c.preventDefault();if(b.Rte.Content.isEmpty()){k.notify("warning","Comment text is empty. Cannot create empty comments.");i.Editor.UI.toggleSavebarBusy(false)}else{var k=c=0,e=p.getEditorForm();if(e.is("form")){k=e.attr("action");c=n(k,"parentId");k=n(k,"commentId")}var g=
new r(e),e=function(a,b){h(a,b);g.refreshCaptcha()},j=f("#watchPage").is(":checked");k>0?i.Editor.CommentManager.updateComment(i.getContentId(),k,b.Rte.Content.getHtml(),j,g.getCaptchaData(),a,e):i.Editor.CommentManager.saveComment(i.getContentId(),c,b.Rte.Content.getHtml(),j,d,g.getCaptchaData(),a,e)}}},saveCommentErrorHandler:function(a,c){var d;i.Editor.UI.toggleSavebarBusy(false);if(a&&a.search(/captcha/i)!==-1){d="The typed word did not match the text in the picture.";e.closeMessages(["captcha-response-failed"]);
e.handleMessage("captcha-response-failed",{type:"error",message:d})}else if(a&&a.search(/Unsupported character found in content: (.{12})/i)!==-1){d=JSON.parse(a.replace(/error: {2}- /,"")).message.split("Unsupported character found in content: ")[1];d=b.format("We can\u0027\u0027t save your comment because the {0} character isn\u0027\u0027t supported by your database.\u003cbr\u003e\u003cbr\u003eRemove this character or use a Confluence symbol or emoticon instead. \u003ca href = \u0022https://confluence.atlassian.com/x/BYfsNg\u0022 target=\u0022_blank\u0022\u003eLearn more\u003c/a\u003e",d);e.closeMessages(["utf8-validation-failed"]);e.handleMessage("utf8-validation-failed",{title:"Unsupported character",type:"error",message:d})}else{d=
"Failed to save the comment. Please try again later.";if(c)g.showError(g.parseError(c,d),g.Location.FLAG);else{e.closeMessages(["server-offline"]);e.handleMessage("server-offline",{type:"error",message:d})}}q.logError("Error saving comment",a)},cancelComment:function(){b.Rte.Content.editorResetContentChanged();return require("confluence-quick-edit/quick-edit").deactivateEditor()},proceedWithActivation:function(){var a=new f.Deferred,c=b.Rte&&b.Rte.getEditor();if(c){if(c.isDirty()&&!i.Editor.isEmpty()&&
!confirm("Your comment will be lost."))return a.reject();a=j.cancelComment()}else a.resolve();return a}};return j});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment","AJS.Confluence.QuickEdit.QuickComment");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/top-level.js' */
define("confluence-quick-edit/handlers/comment/top-level","jquery confluence/dark-features confluence-editor-loader/editor-loader confluence/api/event confluence/api/logger confluence-editor/profiles confluence-quick-edit/handlers/comment confluence-quick-edit/quick-edit confluence-quick-edit/handlers/shortcut window".split(" "),function(a,i,j,k,e,l,b,f,m,g){function n(a){b.preInitialise(a)}function o(c){a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler);a("#rte-savebar").scrollWindowToElement();
b.postInitialise(c)}function p(){if(!j.resourcesLoaded()){k.trigger("analytics",{name:"rte.quick-edit.top-comment.spinner"});a(".quick-comment-prompt").hide();a(".quick-comment-loading-container").fadeIn().spin("medium")}}function q(b){b.preventDefault();g.location=a("#add-comment-rte").attr("href")}var r=i.isEnabled("editor.slow.comment.disable"),d={commentShortcut:m.createShortcut("m",".quick-comment-prompt"),activateEventHandler:function(c){c.preventDefault();b.proceedWithActivation().done(function(){var c=
b.createSaveHandler(b.delegatingSaveCommentHandler,b.saveCommentErrorHandler),h=a("form[name=inlinecommentform]");return f.activateEditor({preActivate:p,$container:h.closest(".quick-comment-container"),$form:h,preInitialise:n,saveHandler:c,cancelHandler:b.cancelHandler,postInitialise:o,plugins:l.createProfileForCommentEditor().plugins,additionalResources:["wrc!comment-editor"],timeoutResources:b.timeout}).fail(function(c){e.logError("activateEventHandler failed because of: "+c);if(c==="READ_ONLY"||
r){b.showLoadingEditorErrorMessage(c);a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler)}else g.location=a("#add-comment-rte").attr("href")})}).fail(function(){a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler)})},enable:function(){a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler);a(".quick-comment-prompt").on("keydown",function(b){b.keyCode===a.ui.keyCode.ENTER&&d.activateEventHandler(b)});a("#add-comment-rte").removeClass("full-load");
this.commentShortcut.bind()},disable:function(){a("#comments-section").off("click",".quick-comment-prompt");this.commentShortcut.unbind()}};f.register(d);return{bindCommentAreaFallbackHandler:function(){a("#comments-section").delegate(".quick-comment-prompt","click",q)},cancelComment:function(){e.log("'AJS.Confluence.QuickEdit.QuickComment.TopLevel.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");return b.cancelComment()}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/top-level","AJS.Confluence.QuickEdit.QuickComment.TopLevel");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/reply.js' */
define("confluence-quick-edit/handlers/comment/reply","confluence/root confluence/templates wrm/context-path confluence/dark-features confluence-editor-loader/editor-loader confluence/api/event confluence/api/logger confluence/meta confluence-editor/profiles confluence-quick-edit/handlers/comment confluence-quick-edit/quick-edit jquery".split(" "),function(l,m,n,o,p,g,h,i,q,b,j,a){function r(a){b.preInitialise(a);a.$container.scrollWindowToElement()}function s(a){b.postInitialise(a)}function k(a){var b=
a.attr("id").match(/comment-(\d+)/),e=0;if(b)e=parseInt(b[1],10);else{g.trigger("analytics",{name:"rte.quick-edit.get-reply-parent.failed"});h.logError("replyHandler: activateEventHandler - could not extract a parent comment Id from the comment id "+a.attr("id"))}return e}function t(){a(".comment.reply").closest(".comment-threads").remove()}var d,u=o.isEnabled("editor.slow.comment.disable");d={activateEventHandler:function(d){var f=this;d.preventDefault();d.stopPropagation();if(a(f).attr("reply-disabled"))return false;
b.proceedWithActivation().done(function(){var e=a(f).closest("div.comment"),c;c=a(".quick-comment-container img.userLogo");c=b.createCommenterParam(c);c={contentId:l.getContentId(),parentCommentId:k(e),commenter:c,context:{contextPath:n(),staticResourceUrlPrefix:i.get("static-resource-url-prefix")}};c=a(m.Comments.displayReplyEditorLoadingContainer(c));var d=a(".quick-comment-loading-container",c);d.hide();e.after(c);if(p.resourcesLoaded())g.trigger("analytics",{name:"rte.quick-edit.reply-comment.no-spinner"});
else{g.trigger("analytics",{name:"rte.quick-edit.reply-comment.spinner"});e.after(c);d.fadeIn();d.spin("medium");d[0].scrollIntoView()}c=a(f).closest(".comment-thread").find(".quick-comment-container");i.set("form-name",a("form",c).attr("name"));j.activateEditor({$container:c,$form:a("form.quick-comment-form[name=threadedcommentform]"),preInitialise:r,postInitialise:s,saveHandler:b.createSaveHandler(b.delegatingSaveCommentHandler,b.saveCommentErrorHandler),cancelHandler:b.cancelHandler,plugins:q.createProfileForCommentEditor().plugins,
postDeactivate:t,additionalResources:["wrc!comment-editor"],timeoutResources:b.timeout}).fail(function(){u?b.showLoadingEditorErrorMessage():window.location=a("#reply-comment-"+k(e)).attr("href")});a(f).attr("reply-disabled",true)})},enable:function(){a("#comments-section").delegate(".action-reply-comment","click",d.activateEventHandler)},disable:function(){a("#comments-section").undelegate(".action-reply-comment","click")}};j.register(d);return{cancelComment:function(){h.log("'AJS.Confluence.QuickEdit.QuickComment.Reply.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");
return b.cancelComment()}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/reply","AJS.Confluence.QuickEdit.QuickComment.Reply");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/edit.js' */
define("confluence-quick-edit/handlers/comment/edit","confluence/root confluence/templates wrm/context-path confluence/dark-features confluence/api/logger confluence/meta confluence-editor/profiles confluence-quick-edit/handlers/comment confluence-quick-edit/quick-edit jquery".split(" "),function(j,k,l,m,n,g,o,b,i,d){function p(a){b.preInitialise(a);a.$container.scrollWindowToElement()}function q(a){b.postInitialise(a)}function h(a){return(a=a.attr("id").match(/comment-(\d+)/))?parseInt(a[1],10):
0}function r(a){var b=new d.Deferred;d.ajax({url:l()+"/rest/api/content/"+a+"?expand=body.editor",cache:false}).done(function(a){!a||!a.body||!a.body.editor?b.reject("invalid response from loading comment rest endpoint"):b.resolve({editorContent:a.body.editor.value})}).fail(function(){b.reject("error fetching content")});return b}function s(){var a=d(".comment.edit");a.prev(".comment").show();a.remove()}var t=m.isEnabled("editor.slow.comment.disable"),f={activateEventHandler:function(a){var f=this;
a.preventDefault();a.stopPropagation();b.proceedWithActivation().done(function(){var a=d(f).closest("div.comment"),c;c=a.find(".author .confluence-userlink");var e=a.find(".comment-user-logo img.userLogo");c=b.createCommenterParam(e,c.attr("data-username"),c.text());c={contentId:j.getContentId(),commentId:h(a),commenter:c,context:{contextPath:g.get("context-path"),staticResourceUrlPrefix:g.get("static-resource-url-prefix")},mode:"edit"};c=d(k.Comments.displayEditEditorContainer(c));e=d(".quick-comment-loading-container",
c);a.hide();a.after(c);e.fadeIn().spin("medium");e[0].scrollIntoView();c=a.next(".quick-comment-container");g.set("form-name",d("form",c).attr("name"));i.activateEditor({$container:c,$form:d("form.quick-comment-form[name=editcommentform]"),fetchContent:r(h(a)),preInitialise:p,postInitialise:q,saveHandler:b.createSaveHandler(b.delegatingSaveCommentHandler,b.saveCommentErrorHandler),cancelHandler:b.cancelHandler,plugins:o.createProfileForCommentEditor().plugins,postDeactivate:s,additionalResources:["wrc!comment-editor"],
timeoutResources:b.timeout}).fail(function(){t?b.showLoadingEditorErrorMessage():window.location=d("#edit-comment-"+h(a)).attr("href")})})},enable:function(){d("#comments-section").delegate(".comment-action-edit","click",f.activateEventHandler)},disable:function(){d("#comments-section").undelegate(".comment-action-edit","click")}};i.register(f);return{cancelComment:function(){n.log("'AJS.Confluence.QuickEdit.QuickComment.Edit.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");
return b.cancelComment()}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/edit","AJS.Confluence.QuickEdit.QuickComment.Edit");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/editor-comment-manager.js' */
define("confluence-quick-edit/editor-comment-manager",["ajs","jquery","confluence/legacy"],function(d,e,j){return function(){function k(a,f,l,i,b,g,h){d.trigger("analytics",{name:"confluence.page.comment.create",data:{pageID:d.Meta.get("page-id")}});a={type:"POST",url:a,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{html:f,watch:l,uuid:i},dataType:"json",cache:!1,headers:{"X-Atlassian-Token":"no-check"},success:function(a){g(a)},error:function(a,c,b){c=c+": "+b;a.responseText&&
(c=c+" - "+a.responseText);h(c,a)},timeout:12E4};b&&b.id&&(a.headers["X-Atlassian-Captcha-Id"]=b.id,a.headers["X-Atlassian-Captcha-Response"]=b.response);e.ajax(a)}return{addComment:function(a,f,d,i,b,g,h,e,c){j.Editor.CommentManager.saveComment(a,f,d,function(a){j.CommentDisplayManager.addComment(h,a,g);e(a)},c)},saveComment:function(a,f,e,i,b,g,h,j){var c=null,c=f?d.contextPath()+"/rest/tinymce/1/content/"+a+"/comments/"+f+"/comment?actions=true":d.contextPath()+"/rest/tinymce/1/content/"+a+"/comment?actions=true";
k(c,e,i,b,g,h,j)},updateComment:function(a,f,e,i,b,g,h){a=d.contextPath()+"/rest/tinymce/1/content/"+a+"/comments/"+f+"?actions=true";k(a,e,i,null,b,g,h)}}}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/editor-comment-manager",function(d){var e=require("confluence/legacy");require("ajs").bind("init.rte",function(){e.Editor.CommentManager=d()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:editor-view-resources', location = 'jscripts/view-content/pushed-navigation-util.js' */
define("confluence-quick-edit/view-content/pushed-navigation-util",["ajs","jquery","window"],function(d,f,a){function c(){return d.Rte&&d.Rte.getEditor()&&!!f("#editpageform").length}var b=a.location.hash,e=a.location.search;return{isInEditPage:c,filterPreviewHashChange:function(){var g=c()||a.history.pushState||!(a.location.hash&&0===a.location.hash.indexOf("#!"))&&!(b&&0===b.indexOf("#!"));b=a.location.hash;return g},filterPreviewNavigationEvent:function(){var b=c()||!/[?&]preview=([^&]*)/.test(a.location.search)&&
!/[?&]preview=([^&]*)/.test(e);e=a.location.search;return b}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/view-content/pushed-navigation-util","Confluence.Editor.PushedNavUtil");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:editor-view-resources', location = 'jscripts/view-content/pushed-navigation.js' */
define("confluence-quick-edit/view-content/pushed-navigation","jquery underscore window confluence/legacy confluence/api/event confluence-quick-edit/view-content/pushed-navigation-util".split(" "),function(b,n,a,f,g,c){function d(){if(h){if(e.split("#")[0]!=a.location.href.split("#")[0]){b(a).unbind("popstate",k);a.location.reload()}}else e.split("#")[0]==a.location.href.split("#")[0]&&e.split("#")[1]!=="editor"||a.location.reload()}function i(){e=a.location.href}function l(){var b=f.Editor.Drafts.unloadMessage();
if(b){f.Editor.Drafts.unBindUnloadMessage();if(confirm(b+"\n\n"+"Press OK to continue, or Cancel to stay on the current page.")){g.trigger("analytics",{name:"rte.quick-edit.confirmation.leaving"});d()}else{g.trigger("analytics",{name:"rte.quick-edit.confirmation.staying"});if(h){j=true;a.history.forward()}else a.location.hash="editor";f.Editor.Drafts.bindUnloadMessage()}}else d()}function o(){c.isInEditPage()?a.location.hash!=="#editor"&&l():d()}function k(){j?j=false:c.isInEditPage()?l():d()}function m(a,b){return function(){n.every(b,
function(a){return a()})&&a()}}var h=!!a.history.pushState,j=false,e=a.location.href,p=[c.filterPreviewHashChange],q=[c.filterPreviewNavigationEvent];g.bind("rte-quick-edit-enable-handlers",function(){a.location.hash==="#editor"&&b("#editPageLink").click()});return function(){i();if(h){b(a).bind("popstate",m(k,q));b(a).bind("rte-quick-edit-push-state",i)}else{b(a).bind("hashchange",m(o,p));b(a).bind("rte-quick-edit-push-hash",i)}}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/view-content/pushed-navigation",function(b){require("ajs").toInit(function(){setTimeout(b,0)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.dialog2', location = 'aui.chunk.f864ec8a095c50c1adb6--768a18c66defff7e4114.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.dialog2"],{"0+IH":function(t,i,e){"use strict";e.r(i),e.d(i,"dialog2",(function(){return b}));e("AehQ"),e("rWoL");var a=e("+x/D"),n=e("TmQU"),u=e("KloK"),o=e("jEnx"),c=e("6RZY"),s=e("+ay7"),l=e("Pjwx"),h={"aui-focus":"false","aui-blanketed":"true"};function r(t){var i;this._handlers=new WeakMap,this.$el=t?Object(a.a)(t):Object(a.a)('\n        <section role="dialog" class="aui-layer aui-dialog2 aui-dialog2-medium">\n            <header class="aui-dialog2-header">\n                <h2 class="aui-dialog2-header-main"></h2>\n                '.concat(l.a,'\n                </button>\n            </header>\n            <div class="aui-dialog2-content"></div>\n            <footer class="aui-dialog2-footer"></footer>\n        </section>')),i=this.$el,a.a.each(h,(function(t,e){var a="data-"+t;i[0].hasAttribute(a)||i.attr(a,e)}))}r.prototype.on=function(t,i){const e=this.$el;if(!this._handlers.get(i)){const a=function(t){t.target===e.get(0)&&i.apply(this,arguments)};Object(o.b)(e).on(t,a),this._handlers.set(i,a)}return this},r.prototype.off=function(t,i){const e=this.$el,a=this._handlers.get(i);return a&&(Object(o.b)(e).off(t,a),this._handlers.delete(i)),this},r.prototype.show=function(){return Object(o.b)(this.$el).show(),this},r.prototype.hide=function(){return Object(o.b)(this.$el).hide(),this},r.prototype.remove=function(){return Object(o.b)(this.$el).remove(),this},r.prototype.isVisible=function(){return Object(o.b)(this.$el).isVisible()};var d=Object(c.a)("dialog2",r),f=new Set;d.on=function(t,i){return f.has(i)||(o.b.on(t,".aui-dialog2",i),f.add(i)),this},d.off=function(t,i){return f.has(i)&&(o.b.off(t,".aui-dialog2",i),f.delete(i)),this},Object(a.a)(document).on("click keydown",".aui-dialog2-header ".concat(l.b),(function(t){("click"===t.type||t.keyCode===s.a.ENTER||t.keyCode===s.a.SPACE)&&(t.preventDefault(),d(Object(a.a)(t.target).closest(".aui-dialog2")).hide())})),d.on("show",(function(t,i){i.find(l.b).attr("tabindex",0),i.attr("tabindex",-1);var e=i[0].hasAttribute("data-aui-focus-selector")&&i.attr("data-aui-focus-selector");if(e){var a=i.find(e);if(a.length>0)return a.first().focus()}i.focus()})),d.on("hide",(function(t,i){var e=Object(o.b)(i);i.data("aui-remove-on-hide")&&e.remove()})),Object(n.a)("aui/dialog2",d),Object(u.a)("dialog2",d);var b=d}},[["0+IH","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.dd803a46b4","aui.splitchunk.994e478d48","aui.splitchunk.d7c46c2734","aui.splitchunk.e54c7c7304","aui.splitchunk.fb15cffa72","aui.splitchunk.f1e06f97a4","aui.splitchunk.479fe6ee76","aui.splitchunk.f673ef53ac","aui.splitchunk.8659b532c1","aui.splitchunk.5f851f97df","aui.splitchunk.d0110a864f","aui.splitchunk.afa5039e04","aui.splitchunk.bff3715233","aui.splitchunk.c750721820","aui.splitchunk.6d6f245ed3","aui.splitchunk.5b8c290363","aui.splitchunk.3d2cb1af14"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/js/page-loading-indicator.js' */
define("confluence/page-loading-indicator",["jquery","underscore","ajs","confluence/templates"],function(c,g,a,h){return function(b){function d(){return c(".confluence-page-loading-blanket",b)}function e(){return c(".confluence-loading-indicator",b)}return{show:function(){0===d().length&&c(b).append(h.pageLoadingIndicator());d().show();e().spin({lines:12,length:8,width:4,radius:10,trail:60,speed:1.5,color:"#F0F0F0"})},hide:function(){e().stop();d().hide()},showUntilResolved:function(c,b){this.show();
c.always(g.bind(this.hide,this));b&&c.fail(function(){a.messages.error(".confluence-page-loading-errors",{body:b})})},showUntilDialogVisible:function(b,d){var f=this,e=d||"An error has occurred connecting to the server. Please try again.",g=c(".aui-dialog:visible"),h=c(".aui-dialog2:visible");!g.length&&!h.length&&f.show();b.always(f.hide).fail(function(){a.messages.error(".confluence-page-loading-errors",{body:e})});a.bind("show.dialog",function i(){a.unbind("show.dialog",i);f.hide()});if(null!=a.dialog2&&void 0!=a.dialog2)a.dialog2.on("show",
function j(){a.dialog2.off("show",j);f.hide()})},destroy:function(){b.remove(".confluence-page-loading-blanket")}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-loading-indicator","Confluence.PageLoadingIndicator");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/soy/page-loading-indicator.soy' */
// This file was automatically generated from page-loading-indicator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }


Confluence.Templates.pageLoadingIndicator = function(opt_data, opt_ignored) {
  return '<div class="confluence-page-loading-errors"></div><div class="confluence-page-loading-blanket aui-blanket" aria-hidden="false"><div class="confluence-loading-indicator"></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.pageLoadingIndicator.soyTemplateName = 'Confluence.Templates.pageLoadingIndicator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/preview-support.js' */
define("cp/confluence/preview-support",["ajs"],function(a){var d=function(){var e=b.SELECTOR_STRINGS.IMAGE+", "+b.SELECTOR_STRINGS.LINK_IMAGE+", "+b.SELECTOR_STRINGS.EXTERNAL_IMAGE;if(b.isPDFSupported()){e+=", "+b.SELECTOR_STRINGS.PDF+", "+b.SELECTOR_STRINGS.LINK_PDF}return e};var c=function(){return b.SELECTOR_STRINGS.IMAGE+", "+b.SELECTOR_STRINGS.EXTERNAL_IMAGE+", "+b.SELECTOR_STRINGS.FILE+", "+b.SELECTOR_STRINGS.LINK_FILE+", "+b.SELECTOR_STRINGS.ATTACHMENT_MACRO};var b={SELECTOR_STRINGS:{IMAGE:"img.confluence-embedded-image[data-linked-resource-id]",EXTERNAL_IMAGE:"img.confluence-embedded-image.confluence-external-resource",PDF:"a.confluence-embedded-file[data-nice-type='PDF Document']",LINK_IMAGE:"a[data-linked-resource-type='attachment'][data-nice-type='Image']",LINK_PDF:"a[data-linked-resource-type='attachment'][data-nice-type='PDF Document']",FILE:"a.confluence-embedded-file",LINK_FILE:"a[data-linked-resource-type='attachment']",FILE_OVERLAY:"span.confluence-embedded-file-wrapper .overlay",ATTACHMENT_MACRO:".plugin_attachments_container a.previewAttachmentLink"},VIEW_MODE:{FULL:"full",COMMENT:"comment",SIMPLE:"simple"},isPDFSupported:function(){return a.DarkFeatures.isEnabled("pdf-preview")},getFileSelectorString:function(){if(a.DarkFeatures.isEnabled("previews.trigger-all-file-types")){return c()}else{return d()}}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/preview.js' */
define("cp/confluence/preview",["underscore","jquery","cp/confluence/preview-support","ajs","confluence/jsUri"],function(k,e,f,i,b){var j,l;e(document).ready(g);function g(){var o=e(f.getFileSelectorString());o.off("click.fb");e(document.body).off("click.filePreviews");e(document.body).on("click.filePreviews",f.getFileSelectorString(),n);e(document.body).on("click.filePreviews",f.SELECTOR_STRINGS.FILE_OVERLAY,h);e(window).on("popstate",function(){if(!l&&i.DarkFeatures.isEnabled("previews.sharing.pushstate")){a()}});a()}function n(o){if(!o.altKey&&!o.ctrlKey&&!o.metaKey&&!e(this).parent().closest("a, #draft-changes-dialog, #cp-annotations, .diff-block-context, .diff-block-target").length){o.preventDefault();m(this)}}function h(p){p.preventDefault();var o=e(p.target);var q=o.closest("span.confluence-embedded-file-wrapper");m(q.find(f.SELECTOR_STRINGS.IMAGE+","+f.SELECTOR_STRINGS.FILE),undefined,undefined,o.closest(".comment-count-overlay").length>0)}function m(q,r,o,x){if(!l){var s="confluence-previews-css";var p="media-viewer";var y="viewattachments";WRM.require("wr!com.atlassian.confluence.plugins.confluence-previews:"+s);var z=e.Deferred(),u=z.promise();var t=setInterval(function(){for(var D=0;D<document.styleSheets.length;D++){var E=document.styleSheets[D];if(E.href&&(E.href.indexOf(s)!==-1||E.href.indexOf(p)!==-1||E.href.indexOf(y)!==-1)){w();return}if(document.styleSheets[D].imports&&document.all&&!window.atob){for(var C=0;C<document.styleSheets[D].imports.length;C++){if(document.styleSheets[D].imports[C].href.indexOf(s)!==-1){w();return}}}}},100);var w=function(){z.resolve();clearInterval(t)};var B=i.Meta.get("static-resource-url-prefix");var A="com.atlassian.confluence.plugins.confluence-previews:mediaviewer-chunks";var v=B+"/download/resources/"+A+"/";l=e.when(WRM.require(["wr!com.atlassian.confluence.plugins.confluence-previews:confluence-previews-js","wrc!media-viewer"]),u);l.done(function(){j=require("cp/confluence/file-preview-loader");d(q,r,o,x)});Confluence.PageLoadingIndicator(e("body")).showUntilResolved(l,"We were unable to load the file previewer")}else{l.done(k.partial(d,q,r,o,x))}return l}var d=function(q,p,s,t){var o=e("#content");var r=e(q).closest(".comment,.cq-content,.ic-content");if(!p){if(!(o.hasClass("page")||o.hasClass("blogpost"))){p=f.VIEW_MODE.SIMPLE}else{if(r.length){p=f.VIEW_MODE.COMMENT}}}if(p===f.VIEW_MODE.COMMENT){j.showPreviewerForComment(q,r,p,t)}else{if(p===f.VIEW_MODE.SIMPLE){j.showPreviewerForSingleFile(q,p,s)}else{p=f.VIEW_MODE.FULL;j.showPreviewer(undefined,q,p,t)}}};function a(){if(c()){var q=new b(window.location.href);var p=window.history.pushState&&i.DarkFeatures.isEnabled("previews.sharing.pushstate");if(q.getQueryParamValue("preview")&&!p){var r="#!/preview"+q.getQueryParamValue("preview");var o=decodeURIComponent(q.deleteQueryParam("preview").setAnchor(r).toString());if(window.history.replaceState){window.history.replaceState({},"",o)}else{window.location=o}}else{if(q.anchor().indexOf("!/preview")===0&&p){var o;if(q.getQueryParamValue("preview")){o=q.setAnchor("")}else{o=q.addQueryParam("preview",q.anchor().substr("!/preview".length,q.anchor().length)).setAnchor("")}window.history.replaceState({},"",o)}}m()}}function c(){var o=new b(window.location.href);return i.DarkFeatures.isEnabled("previews.sharing")&&(o.getQueryParamValue("preview")||(o.anchor()&&o.anchor().indexOf("!/preview")===0))}return{loadConfluencePreviews:m}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/jquery-previewer.js' */
require(["cp/confluence/preview","jquery"],function(b,a){a.fn.previewer=function(c){if(!a(this).length){return this}var d=a.extend({},c);return this.each(function(){var f=a(this);var e=f.closest("li");var g=d.src||f.attr("data-image-src")||f.attr("src");if(g){f.click(function(j){var i={src:g,type:d.type,thumbnail:g,title:d.title||e.attr("data-file-name")||g,id:e.attr("data-attachment-id"),ownerId:e.attr("data-owner-id")};var h=b.loadConfluencePreviews([i],d.viewMode||"simple",d.from||"custom");d.zindex&&h.done(function(){a(".cp-container").css({"z-index":d.zindex})})})}})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:toc-plugin-analytics', location = 'net/customware/confluence/plugin/toc/analytics/analytics.js' */
AJS.toInit(function(){AJS.$(".toc-macro a").click(function(){AJS.trigger("analyticsEvent",{name:"confluence.toc-macro.heading-click"})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:client-side-toc-resources', location = 'net/customware/confluence/plugin/toc/js/client-side-toc.js' */
require(["ajs"],function(h){h.toInit(function(d){function h(b){var a=d({});a.data("precedenceLevel",b);return a}function k(b){return d(b).data("precedenceLevel")}function l(b,a,c){if(0===b.length)return d();var g=b.map(k).reduce(function(a,b){return Math.min(a,b)});g!==k(b[0])&&b.unshift(h(g));var e=a.createTocLevelContainer(),f={subElements:[],currentItem:void 0,outline:void 0,flush:function(){0<this.subElements.length&&this.currentItem&&(l(this.subElements,a,this.outline).appendTo(this.currentItem),
this.subElements=[])},add:function(a){this.subElements.push(a)},resetItem:function(b){this.outline=(c||[]).slice(0);this.outline.push(b);this.currentItem=a.createTocItemContainer();this.currentItem.appendTo(e);return this.currentItem}},m=0;b.forEach(function(a){if(g===k(a))if(m++,f.flush(),f.resetItem(m),a.textContent){var b=f.outline.join(".");d(Confluence.Plugins.TableOfContents.Client.tocItemBody({outline:b,linkHref:"#"+a.id,linkText:a.textContent})).appendTo(f.currentItem)}else f.currentItem.addClass("toc-empty-item");
else f.add(a)});f.flush();0===c.length&&a.decorateToc&&a.decorateToc(e);return e}function n(b){return{createTocLevelContainer:function(){return this.createTocItemContainer()},createTocItemContainer:function(){return d(Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer({cssClass:"toc-item-container"}))},decorateToc:function(a){function c(c,e){(c=c in b?b[c]:e)&&d(Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator({separator:c})).appendTo(a)}c("preseparator","[ ");d(a).find("span.toc-item-body").each(function(b,
e){0<b&&c("midseparator"," ] [ ");d(e).appendTo(a)});c("postseparator"," ]");d(a).find(".toc-item-container").remove()}}}function p(b){return{createTocLevelContainer:function(){return d(Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer({cssliststyle:b.cssliststyle,csslistindent:b.csslistindent}))},createTocItemContainer:function(){return d(Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer())}}}function q(b){var a;b.includeheaderregex&&(a=new RegExp(b.includeheaderregex));
var c;b.excludeheaderregex&&(c=new RegExp(b.excludeheaderregex));return function(){var b=d(this).text();return a&&!a.test(b)||c&&c.test(b)?!1:!0}}function r(b,a){var c=a.headerelements,g=c.split(",");a=q(a);c=d(".wiki-content").find(c).filter(a).each(function(){var a=g.indexOf(this.nodeName);d(this).data("precedenceLevel",a)}).toArray();return l(c,b,[])}d(".client-side-toc-macro").each(function(){var b=d(this),a=b.data()||{};var c="flat"===a.structure?n(a):p(a);!0!==a.numberedoutline&&b.addClass("hidden-outline");
b.html(r(c,a))})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:client-side-toc-resources', location = 'net/customware/confluence/plugin/toc/templates/client.soy' */
// This file was automatically generated from client.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Plugins.TableOfContents.Client.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Plugins == 'undefined') { Confluence.Plugins = {}; }
if (typeof Confluence.Plugins.TableOfContents == 'undefined') { Confluence.Plugins.TableOfContents = {}; }
if (typeof Confluence.Plugins.TableOfContents.Client == 'undefined') { Confluence.Plugins.TableOfContents.Client = {}; }


Confluence.Plugins.TableOfContents.Client.tocItemBody = function(opt_data, opt_ignored) {
  return '<span class="toc-item-body" data-outline="' + soy.$$escapeHtml(opt_data.outline) + '"><span class="toc-outline">' + soy.$$escapeHtml(opt_data.outline) + '</span><a href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="toc-link">' + soy.$$escapeHtml(opt_data.linkText) + '</a></span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.tocItemBody.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.tocItemBody';
}


Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer = function(opt_data, opt_ignored) {
  return '<ul style="' + ((opt_data.cssliststyle) ? ' list-style: ' + soy.$$escapeHtml(opt_data.cssliststyle) + ';' : '') + ((opt_data.csslistindent) ? ' padding-left: ' + soy.$$escapeHtml(opt_data.csslistindent) + ';' : '') + '"></ul>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer';
}


Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer = function(opt_data, opt_ignored) {
  return '<li></li>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer';
}


Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer = function(opt_data, opt_ignored) {
  return '<span class="' + soy.$$escapeHtml(opt_data.cssClass) + '"></span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer';
}


Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator = function(opt_data, opt_ignored) {
  return '<span class="toc-separator">' + soy.$$escapeHtml(opt_data.separator) + '</span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-dashboard:footer-analytics', location = '/js/confluence-dashboard/utils/footer-analytics.js' */
define("confluence-dashboard/utils/footer-analytics",["jquery","ajs","confluence/meta"],function(e,a,t){"use strict";var n=i(e).default,o=i(a).default,c=i(t).default;function i(e){return e&&e.__esModule?e:{default:e}}o.toInit(function(){var e=c.get("page-id"),a=n("body").hasClass("dashboard");n("#footer").on("click","a",function(){o.trigger("analytics",{name:"confluence.footer.item.click",data:{pageId:e,isDashboard:a}})})})}),require(["confluence-dashboard/utils/footer-analytics"]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:deferred-loaders', location = '/includes/js/deferred-dialog-loader.js' */
define("confluence/deferred-dialog-loader",["underscore","jquery","ajs","confluence/page-loading-indicator","confluence/api/event"],function(c,d,i,j,b){return function(){var k=j(d("body")),e,g=!1,h=!1,f=function(){g&&h&&e&&(b.trigger(e),e=void 0)};b.bind("page.move.dialog.ready",function(){g=!0;f()});b.bind("blogpost.move.dialog.ready",function(){h=!0;f()});c.each({movePageDialogTools:{resource:"confluence.web.resources:page-move-resources",selector:"#action-move-page-dialog-link",event:"deferred.page-move.tools-menu"},
movePageDialogEditor:{resource:"confluence.web.resources:page-move-resources",selector:"#rte-button-location",event:"deferred.page-move.editor"},moveBlogDialogTools:{resource:"confluence.web.resources:page-move-resources",selector:"#action-move-blogpost-dialog-link",event:"deferred.blog-move.tools-menu"},availableGadgetsHelp:{resource:"com.atlassian.confluence.plugins.gadgets:gadget-directory-resources",selector:"#gadget-directory-link",event:"deferred.available-gadgets.help-menu"},aboutConfluenceHelp:{resource:"confluence.web.resources:about",
selector:"#confluence-about-link",event:"deferred.about-confluence.help-menu"}},function(a){d("body").on("click",a.selector,function(c){var d=a.resource+".requested",f=WRM.require("wr!"+a.resource,function(){"confluence.web.resources:page-move-resources"!==a.resource?b.trigger(a.event):g&&h?b.trigger(a.event):e=a.event});k.showUntilDialogVisible(f);i.Analytics?i.Analytics.triggerPrivacyPolicySafeEvent(d):b.trigger("analyticsEvent",{name:d});c.preventDefault()})})}});
require("confluence/module-exporter").safeRequire("confluence/deferred-dialog-loader",function(c){require("ajs").toInit(c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:deferred-loaders', location = '/includes/js/page-permissions-deferred-loader.js' */
define("confluence/page-permissions-deferred-loader","confluence/dark-features confluence/legacy ajs confluence/page-loading-indicator jquery wrm".split(" "),function(a,b,c,d,e,f){var g=d(e("body"));return function(a){var b=f.require("wr!com.atlassian.confluence.plugins.confluence-page-restrictions-dialog:dialog-resources",function(){c.trigger("deferred.page.permissions")});g.showUntilDialogVisible(b,"There was an error loading the page restrictions. Please try again later.");a.preventDefault()}});
require("confluence/module-exporter").safeRequire("confluence/page-permissions-deferred-loader",function(a){var b=require("ajs");b.toInit(function(c){c("body").on("click","#rte-button-restrictions,#action-page-permissions-link",a);b.bind("system-content-metadata.open-restrictions-dialog",a)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:navigator-context', location = '/includes/js/api/navigator-context.js' */
define("confluence/api/navigator-context",["confluence/meta","document"],function(g,b){var h=function(a){a=d(a);return"undefined"!==typeof a&&0!==a},d=function(a){a=g.get(a);if(!isNaN(a))return Number(a)},i=function(){return!!b.querySelector(".page.view")||!!b.querySelector(".blogpost.view")},e=function(){return!!b.querySelector(".page.edit")||!!b.querySelector(".blogpost.edit")},f=function(){return g.get("content-type")},c=function(){return d("page-id")};return{getCurrent:function(){return e()&&
0===c()&&h("draft-id")?{target:"contentcreate",context:{contentId:d("draft-id"),contentType:f()}}:e()&&!i()&&0!==c()?{target:"contentedit",context:{contentId:c(),contentType:f()}}:!e()&&i()&&h("page-id")?{target:"contentview",context:{contentId:c(),contentType:f()}}:{target:"unknown",context:{}}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:global-css', location = 'assets/core/js/playsql-messages.js' */
(function($){
    window.PlaySQL = window.PlaySQL || {};
    window.PlaySQL.Messages = window.PlaySQL.Messages || {};
    var idLastMessage = 1000;

    /**
     * Displays a message in the side bar
     * @param type error, warn, info
     * @param message the message
     * @param id (optional) an id
     * @returns the id
     */
    window.PlaySQL.Messages.addMessage = function(type, message, id, jqXHRResponseText){
        if (!window.PlaySQL.Messages.debugMode) {
            AJS.log("Play SQL: " + type + " - " + message + " class:" + id + " - ResponseText:" + jqXHRResponseText);
            var firstLine = jqXHRResponseText != undefined && ("\n" + jqXHRResponseText.split(/[\n\r]/)[0]) || "";
            if (firstLine.length > 100) firstLine = "";
            alert(type.charAt(0).toUpperCase() + type.substr(1) + ": " + message + firstLine);
            return id || idLastMessage++;
        }

        // Clean up
        $("p.tip:not(.playsql-message-inner)").remove();

        // Set the id
        if (id == undefined) {
            id = idLastMessage++;
        } else {
            window.PlaySQL.Messages.removeMessage(id);
        }
        var $body = $("<p></p>", {
            "class": "tip playsql-message-inner",
            id: "playsql-message-" + id,
            text: " : " + message
        }).prepend($("<b></b>").text(type.toUpperCase()));

        // Insert
        var $location = $("hr.playsql-messages");
        if ($location.size() == 0) {
            $location = $(".acs-nav .advanced-links-section").first();
            if ($location.size() == 0)
            {
                $location = $(".acs-nav hr").first();
                if ($location.size() == 0) {
                    throw "Couldn't display error because there si no sidebar - " + type + message + id;
                }
            }
            $location.after($("<hr/>", {
                "class": "playsql-messages"
            }));
            $location = $("hr.playsql-messages");
        }
        $location.after($body);
        return id;
    };
    window.PlaySQL.Messages.removeMessage = function(id){
        var $p = $("#playsql-message-" + id);
        $p.remove();

    };

    /*
     * Converts an element into a spinner.
     */
    window.PlaySQL.Messages.spin = function ($element) {
        var response = {
            on: function(delay, title){
                // This data attribute also tells whether off() was already called.
                $element.attr("data-html-replacement", $element.html());
                function establish() {
                    if (typeof $element.attr("data-html-replacement") != "undefined") {
                        $("<span></span>", {
                            "class": "aui-icon aui-icon-wait",
                            "title": title,
                            text: "Wait"
                        }).appendTo($element.empty());
                    }
                }
                if (delay == undefined)
                    establish();
                else
                    window.setTimeout(establish, delay);
                return response;
            },
            off: function() {
                var html = $element.attr("data-html-replacement");
                $element.removeAttr("data-html-replacement");
                if (html) {
                    $element.empty().html(html);
                    $element.removeAttr("data-html-replacement");
                    // This doesn't rebind the handlers
                }
            }
        };
        return response;
    }



})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:web-item-about', location = 'admin/playsql-about.js' */
AJS.$(function(a){a(".playsql-faq").on("click",".faq",function(){var b=a(this),c=b.closest("li").find(".answer");if(c.length==1&&c.parents(".playsql-faq").length){c.toggleClass("hidden")}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/store-1.3.1.js' */
(function(){var l={},h=window,k=h.document,c="localStorage",n="globalStorage",d="__storejs__",g;l.disabled=false;l.set=function(e,o){};l.get=function(e){};l.remove=function(e){};l.clear=function(){};l.transact=function(e,o){var p=l.get(e);if(typeof p=="undefined"){p={}}o(p);l.set(e,p)};l.serialize=function(e){return JSON.stringify(e)};l.deserialize=function(e){if(typeof e!="string"){return undefined}return JSON.parse(e)};function b(){try{return(c in h&&h[c])}catch(e){return false}}function m(){try{return(n in h&&h[n]&&h[n][h.location.hostname])}catch(e){return false}}if(b()){g=h[c];l.set=function(e,o){if(o===undefined){return l.remove(e)}g.setItem(e,l.serialize(o))};l.get=function(e){return l.deserialize(g.getItem(e))};l.remove=function(e){g.removeItem(e)};l.clear=function(){g.clear()}}else{if(m()){g=h[n][h.location.hostname];l.set=function(e,o){if(o===undefined){return l.remove(e)}g[e]=l.serialize(o)};l.get=function(e){return l.deserialize(g[e]&&g[e].value)};l.remove=function(e){delete g[e]};l.clear=function(){for(var e in g){delete g[e]}}}else{if(k.documentElement.addBehavior){var j,f;try{f=new ActiveXObject("htmlfile");f.open();f.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>');f.close();j=f.w.frames[0].document;g=j.createElement("div")}catch(i){g=k.createElement("div");j=k.body}function a(e){return function(){var p=Array.prototype.slice.call(arguments,0);p.unshift(g);j.appendChild(g);g.addBehavior("#default#userData");g.load(c);var o=e.apply(l,p);j.removeChild(g);return o}}l.set=a(function(p,e,o){if(o===undefined){return l.remove(e)}p.setAttribute(e,l.serialize(o));p.save(c)});l.get=a(function(o,e){return l.deserialize(o.getAttribute(e))});l.remove=a(function(o,e){o.removeAttribute(e);o.save(c)});l.clear=a(function(q){var o=q.XMLDocument.documentElement.attributes;q.load(c);for(var p=0,e;e=o[p];p++){q.removeAttribute(e.name)}q.save(c)})}}}try{l.set(d,d);if(l.get(d)!=d){l.disabled=true}l.remove(d)}catch(i){l.disabled=true}if(typeof module!="undefined"){module.exports=l}else{if(typeof define==="function"&&define.amd){define(l)}else{this.store=l}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/page-visibility.js' */
define("atlassian/analytics/page-visibility",function(){var a=(document.hidden!==undefined);var b={supported:a,isHidden:function(){return a?document.hidden:false}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/user-activity-xhr-header.js' */
define("atlassian/analytics/user-activity-xhr-header",["atlassian/analytics/page-visibility"],function(c){var e="x-atlassian-mau-ignore";var d=XMLHttpRequest.prototype.send;var a=window.fetch;var b=false;return{install:function(){if(!b&&c.supported){XMLHttpRequest.prototype.send=function(){if(c.isHidden()){this.setRequestHeader(e,c.isHidden())}d.apply(this,arguments)};if(a){window.fetch=function(f,i){var g=i||{};var h=g.headers;if(c.isHidden()){g.headers=(h)?new Headers(h):new Headers();g.headers.set(e,c.isHidden())}return a.call(this,f,g)}}b=true}},uninstall:function(){if(b){XMLHttpRequest.prototype.send=d;if(a){window.fetch=a}}b=false}}});require("atlassian/analytics/user-activity-xhr-header").install();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/atlassian-analytics.js' */
(function(d){var q=AJS.$.ajax;var l="atlassian-analytics";var j=typeof AJS.contextPath==="function"?AJS.contextPath():"";var p=null;var m=null;var g=null;var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(z){var y=Math.random()*16|0,x=z=="x"?y:(y&3|8);return x.toString(16)});var t=function(){var x="unknown";if(document.body.id=="jira"){x="jira"}else{if(document.body.id=="com-atlassian-confluence"){x="confluence"}}m=l+"."+x;g=m+".lock"};var f=function(){if(store.get(g)){return false}store.set(g,r);return(store.get(g)===r)};var u=function(){store.set(g,null)};var i=function(){var y=[],A,B,x,z;if(AJS.EventQueue.length==0){return}y=store.get(m)||y;for(x=0,z=AJS.EventQueue.length;x<z;++x){B=AJS.EventQueue[x];if(B.name){A={name:B.name,properties:B.properties,time:B.time||0};y.push(A)}}AJS.EventQueue.length=0;store.set(m,y)};var v=0;var a=function(x){return Math.min(5000*Math.pow(2,x),5*60*1000)};var e=0;var h=function(){var A;function y(){setTimeout(h,a(v=0))}function x(){setTimeout(h,a(++v))}if(!f()){++e;if(e<20){return y()}}else{e=0}try{i();A=store.get(m);if(!A||!A.length){return y()}store.remove(m);if(!o(A)){return y()}var B=new Date().getTime();for(var z=0;z<A.length;z++){if(A[z].time>0){A[z].timeDelta=A[z].time-B}else{A[z].timeDelta=z-A.length}delete A[z].time}p=q({type:"POST",url:j+"/rest/analytics/1.0/publish/bulk",data:JSON.stringify(A),contentType:"application/json",dataType:"json"});p.fail(function(){AJS.EventQueue.concat(A);i();x()});p.done(function(){y()})}finally{u()}};var o=function(z){for(var y=z.length-1;y>=0;y--){var B="";var A=z[y];var x=A.properties;if(typeof A.name==="undefined"){B="you must provide a name for the event."}else{if(typeof x!=="undefined"&&x!==null){if(x.constructor!==Object){B="properties must be an object with key value pairs."}else{b(x)}}}if(B!==""){AJS.log("WARN: Invalid analytics event detected and ignored, "+B+"\nEvent: "+JSON.stringify(A));z.splice(y,1)}}return z.length};var b=function(z){for(var y in z){if(z.hasOwnProperty(y)){var x=z[y];if(c(x)&&k(x)){}else{if(c(x)&&x.toString){z[y]=x.toString()}else{z[y]=""}}}}};function c(x){return typeof x!=="undefined"&&x!==null}function k(x){return typeof x==="number"||typeof x==="string"||typeof x==="boolean"}var n=function(){if(p&&!(p.state()==="resolved"||p.state()==="rejected")){p.abort()}};AJS.EventQueue=AJS.EventQueue||[];var s=Array.prototype.push;AJS.EventQueue.push=function(x){x.time=new Date().getTime();s.call(AJS.EventQueue,x)};AJS.toInit(function(){t();setTimeout(h,500);w()});d(window).on("beforeunload",function(){n();i()});AJS.Analytics={triggerPrivacyPolicySafeEvent:function(x,y){AJS.log("WARN: 'triggerPrivacyPolicySafeEvent' has been deprecated");AJS.EventQueue.push({name:x,properties:y})}};AJS.bind("analytics",function(x,y){AJS.EventQueue.push({name:y.name,properties:y.data})});AJS.bind("analyticsEvent",function(x,y){AJS.EventQueue.push({name:y.name,properties:y.data})});var w=function(){if(window.location.pathname.indexOf("/secure/admin/ViewApplicationProperties")>-1){AJS.$("[data-property-id='analytics-enabled']").remove()}else{if(window.location.pathname.indexOf("/secure/admin/EditApplicationProperties")>-1){var y=AJS.$(":contains(Enable Atlassian analytics)");if(y.size()>0){var x=y[y.size()-2];if(x){x.remove()}}}}}}(AJS.$));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:policy-update-init', location = 'js/policy-update-init.js' */
AJS.toInit(function(){var a=WRM.data.claim("com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider");if(a){WRM.require("wrc!com.atlassian.analytics.analytics-client:policy-update")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:programmatic-analytics-init', location = 'js/programmatic-analytics-init.js' */
(function(){var a=WRM.data.claim("com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider");if(a){WRM.require("wrc!com.atlassian.analytics.analytics-client:programmatic-analytics")}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks=(function(a){a.ApplicationHeader=function(b){b.Cog=(function(){var c=function(){var d=AJS.$("#system-admin-menu-content");if(d.length>0){return d}var e=AJS.$("#admin-menu-link-content");if(e.length>0){return e}return AJS.$("#bamboo\\.global\\.header-admin\\.menu")};return{getDropdown:c}}());return b}(a.ApplicationHeader||{});return a}(NavLinks||{}));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminshortcuts.soy' */
// This file was automatically generated from adminshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.adminshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.adminshortcuts == 'undefined') { navlinks.templates.adminshortcuts = {}; }


navlinks.templates.adminshortcuts.section = function(opt_data, opt_ignored) {
  var param5 = '<ul class="aui-list-truncate">';
  var linkList7 = opt_data.links;
  var linkListLen7 = linkList7.length;
  for (var linkIndex7 = 0; linkIndex7 < linkListLen7; linkIndex7++) {
    var linkData7 = linkList7[linkIndex7];
    param5 += '<li><a href="' + soy.$$escapeHtml(linkData7.link) + '">' + soy.$$escapeHtml(linkData7.label) + '</a></li>';
  }
  param5 += '</ul>';
  var output = '' + aui.dropdown2.section({id: 'nl-remote-admin-section', label: 'Other applications', content: param5});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.adminshortcuts.section.soyTemplateName = 'navlinks.templates.adminshortcuts.section';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminnavlinks.js' */
var NavLinks=(function(a){a.AdminShortcuts=(function(){var c=function(){return AJS.$.ajax({url:AJS.contextPath()+"/rest/menu/latest/admin",cache:false,dataType:"json"})};var b=function(){AJS.$("#nl-remote-admin-section").on("click","a",function(){NL.trackEvent("remoteAdminItemSelected",NL.getCurrentApplication(),$(this).attr("href"))})};return{render:function(){c().done(function(e){e=_.reject(e,function(f){return f.local===true});if(e.length){var d=navlinks.templates.adminshortcuts.section({links:e});a.ApplicationHeader.Cog.getDropdown().append(d);b()}})}}}());return a}(NavLinks||{}));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts', location = 'adminshortcuts/adminshortcuts-cdn.js' */
AJS.toInit(function(){if(AJS.DarkFeatures&&AJS.DarkFeatures.isEnabled("rotp.admin.shortcuts")){NavLinks.AdminShortcuts.render()}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_jquery.ui.keycode', location = 'aui.chunk.7089ca9499cb45d39ef8--cbe2dcb0ec06b83c0149.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["jquery.ui.keycode"],{wrJm:function(u,i,n){"use strict";n.r(i);n("M4tZ");i.default="jquery"}},[["wrJm","runtime","aui.splitchunk.vendors--20a97d6a33","aui.splitchunk.vendors--02a4084a95","aui.splitchunk.0d131bcbf1"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.projectshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.projectshortcuts == 'undefined') { navlinks.templates.projectshortcuts = {}; }


navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_ignored) {
  return '' + ((opt_data.localShortcuts && opt_data.localShortcuts.length > 0) ? navlinks.templates.projectshortcuts.dialogContentShortcuts({shortcuts: opt_data.localShortcuts, listClass: 'projectshortcut-links'}) : '') + ((opt_data.remoteShortcuts != null) ? (opt_data.remoteShortcuts.length > 0) ? '<h2 class="projectshortcuts-heading">Related Links</h2>' + navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentMap(opt_data.remoteShortcuts, {shortcuts: opt_data.remoteShortcuts, listClass: 'projectshortcut-links'})) : '' : navlinks.templates.projectshortcuts.dialogLoading(null));
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContent.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContent';
}


navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_ignored) {
  return '<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="' + soy.$$escapeHtml(opt_data.logoUrl) + '"><h2 class="dialog-title">' + soy.$$escapeHtml(opt_data.title) + '</h2></div><div class="project-content-wrapper">' + soy.$$filterNoAutoescape(opt_data.contentHtml) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.headingWrapper.soyTemplateName = 'navlinks.templates.projectshortcuts.headingWrapper';
}


navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
  var shortcutList35 = opt_data.shortcuts;
  var shortcutListLen35 = shortcutList35.length;
  for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
    var shortcutData35 = shortcutList35[shortcutIndex35];
    output += '<li' + ((shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '') + '>' + navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcuts.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcuts';
}


navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.link) + '"' + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.label) + '</a>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcut.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcut';
}


navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="projectshortcuts-loading">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogLoading.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogLoading';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e,g){var i,k={},m="key",b="name",j="entity-type";function f(s){var n=e(this),o=n.data(m),q=n.data(b),p=n.data(j);if(typeof o==="undefined"){return}s.preventDefault();i=new AJS.Dialog({width:600,keypressListener:function(u){if(u.which==jQuery.ui.keyCode.ESCAPE){i.remove()}},id:"project-shortcuts-dialog"}).addCancel("Close",function(){i.remove()}).addPanel("",navlinks.templates.projectshortcuts.headingWrapper({title:q,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogLoading({text:"Retrieving links…"})})).show();c(i);if(!k[o]){k[o]={entity:{title:q},localShortcuts:null,remoteShortcuts:null};d(AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+o,{entityType:p}).done(t);d(AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+o,{entityType:p}).done(r).fail(function(){var u=i.getCurrentPanel().body.find(".project-content-wrapper");u.find(".projectshortcuts-loading").remove();AJS.messages.error(u,{body:"Could not retrieve remote project shortcuts",closeable:false});c(i)})}else{l(k[o])}function t(u){k[o].localShortcuts=u.shortcuts;l(k[o])}function r(u){k[o].remoteShortcuts=u.shortcuts;l(k[o])}}function h(){return e(".project-shortcut-dialog-trigger img").attr("src")}function l(n){if(n.localShortcuts){i.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({title:n.entity.title,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogContent(n)}));c(i)}}function a(p){var o=210;if(!p||p.length<=o){return p}var n=o;while(n>0&&p.charAt(n)!=" "){n--}if(n==0){n=o}p=p.substring(0,n);if(p.length>=n){p=p+"..."}return p}function c(n){var q=n.popup.element,p=q.find(".dialog-panel-body"),o=q.find(".dialog-components");p.height("auto");q.height(o.outerHeight()-1);e(".aui-shadow").remove()}function d(n,o){return e.ajax({url:n,cache:false,data:o,dataType:"json"})}e(document).on("click",".project-shortcut-dialog-trigger",f)}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups=AJS.Popups||{};AJS.Popups.DisplayController=function(){var c=[];var a=false;var b=false;AJS.toInit(function(){setTimeout(function(){AJS.Popups.DisplayController.render()},0)});return{request:function(d){c.push(d);if(a&&b===false){this.render()}},render:function(){c.sort(function(e,d){return e.weight-d.weight});a=true;if(c.length!==0){b=true;c[0].show()}}}}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.page.iconography', location = 'aui.chunk.725e27193d28978cce8e--39d3cd1fe342226e5759.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.page.iconography"],[],[["rSV2","runtime","aui.splitchunk.fbbef27525","aui.splitchunk.d7c46c2734","aui.splitchunk.56dfb54d0c","aui.splitchunk.908fe798b4"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jira-issues-view-mode-resources', location = 'jira/jira-issues-view-mode/main.js' */
require(["ajs","jquery"],function(a,c){var b=function(){var a=c(".wiki-content [data-jira-key][data-client-id]");if(0==a.length)return!1;WRM.require("wr!confluence.extra.jira:jira-issues-view-mode-async-resource",function(){require(["confluence/jim/jira/jira-issues-view-mode/lazy-loading","confluence/jim/jira/jira-issues-view-mode/fix-ui"],function(b,c){b.init(a).done(function(){c.fixBreakIconInOldConf()})})})};a.toInit(b);a.bind("ic-jim-async-supported",b)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:amd-support', location = 'amd/confluence-shim.js' */
define("confluence/jim/confluence-shim",function(){return window.Confluence});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:amd-support', location = 'amd/amd-exporter.js' */
define("confluence/jim/amd/module-exporter",[],function(){var f={namespace:function(d,e,a){var b=d.split(".");a=a||window;var c,f=b.length-1;for(c=0;c<f;c++){var g=a[b[c]];a=null!=g?g:a[b[c]]={}}a[b[c]]&&window.console&&window.console.warn&&window.console.warn('Value of "'+d+'" was overridden');a[b[c]]=e||a[b[c]]||{};return a[b[c]]},safeRequire:function(d,e){define&&void 0===define.amd&&(d=require(d),e&&e(d))},exportModuleAsGlobal:function(d,e,a){f.safeRequire(d,function(b){f.namespace(e,b);a&&a(b)})}};
return f});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:lodash-amd', location = 'applinks/internal/lib/lodash-amd-global.js' */
define('applinks/lib/lodash', function() {
        if (!window._) {
            throw "lodash not found";
        }
        return window._;
    });
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/lib-version.js' */
// NOTE: this is in "lib" because it's required by aui-amd.js. This module _cannot_ have any dependencies on non-lib
// modules (like "common")
define('applinks/lib/version', [
    'applinks/lib/lodash'
], function(
    _
) {

    function checkIntValue(value, desc) {
        if (_.isUndefined(value)) {
            return 0;
        } else if (typeof value !== 'number' || isNaN(value)) {
            throw new Error(desc + ': expected a number, was: <' + value + '>');
        } else {
            return Math.floor(value);
        }
    }

    function checkVersionObject(object, desc) {
        if (!object || !(object instanceof Version)) {
            throw new Error(desc + ': expected a Version object, was: <' + object + '>');
        }
        return object;
    }

    function compareInt(intOne, intTwo) {
        return intOne > intTwo ? 1 : intOne == intTwo ? 0 : -1;
    }

    /**
     * Constructs a version object that contains version information and can be compared with other version objects.
     *
     * @param major major version component
     * @param minor minor version component
     * @param bugfix bugfix version component
     * @constructor
     */
    function Version(major, minor, bugfix) {
        this.major = checkIntValue(major, 'major');
        this.minor = checkIntValue(minor, 'minor');
        this.bugfix = checkIntValue(bugfix, 'bugfix');
    }

    /**
     * Constructs a Version by parsing a version string.
     *
     * @param versionString version string to parse, expected to be in the form of <major>.<minor>.<bugfix>
     * @param versionDesc what version does the `versionString` represent
     */
    Version.parse = function(versionString, versionDesc) {
        versionDesc = versionDesc || 'versionString';
        if (!versionString) {
            throw new Error(versionDesc + ': expected a non-empty string');
        }
        var versionSplit = versionString.split('.');
        if (versionSplit.length !== 3) {
            throw new Error(versionDesc + ': expected <major>.<minor>.<bugfix> string, was: <' + versionString + '>');
        }
        return new Version(parseInt(versionSplit[0]), parseInt(versionSplit[1]), parseInt(versionSplit[2]));
    };

    /**
     * Comparator function to sort Version objects.
     *
     * @param versionOne first version object
     * @param versionTwo second version object
     * @returns {Number} comparison result
     * @see Version.compareTo(that)
     */
    Version.comparator = function(versionOne, versionTwo) {
        return checkVersionObject(versionOne, 'versionOne').compareTo(checkVersionObject(versionTwo, 'versionTwo'));
    };

    /**
     * Return -1, 0 or 1 as this Version object represents a version less than, equal to, or greater than `that`.
     *
     * @param that the other version to compare to
     * @returns {Number} comparison result
     */
    Version.prototype.compareTo = function(that) {
        checkVersionObject(that, 'that');
        var majorResult = compareInt(this.major, that.major);
        if (majorResult != 0) {
            return majorResult;
        }
        var minorResult = compareInt(this.minor, that.minor);
        if (minorResult != 0) {
            return minorResult;
        }
        return compareInt(this.bugfix, that.bugfix);
    };

    Version.prototype.greaterThan = function(that) {
        return this.compareTo(that) > 0;
    };

    Version.prototype.greaterThanOrEqual = function(that) {
        return this.compareTo(that) >= 0;
    };

    Version.prototype.lessThan = function(that) {
        return this.compareTo(that) < 0;
    };

    Version.prototype.lessThanOrEqual = function(that) {
        return this.compareTo(that) <= 0;
    };

    Version.prototype.equals = function(that) {
        return this.compareTo(that) == 0;
    };

    Version.prototype.toMinor = function() {
        return new Version(this.major, this.minor);
    };

    Version.prototype.toMajor = function() {
        return new Version(this.major);
    };

    Version.prototype.toString = function() {
        return this.major + '.' + this.minor + '.' + this.bugfix;
    };

    return Version;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/aui-version-details.js' */
define('applinks/lib/aui-version-details', [
    'applinks/lib/version'
], function(
    Version
) {
    // minimum 5.9.x AUI versions - lower versions ship with bugs that break some of the Applinks functionality.
    var MINIMUM_59_VERSION = new Version(5, 9, 13);
    var VERSION_58 = new Version(5, 8);
    var VERSION_59 = new Version(5, 9);

    function checkVersion(version) {
        // if 5.9, must be >= the minimum required 5.9.x version
        if (version.lessThan(MINIMUM_59_VERSION) || version.lessThan(VERSION_59)) {
            throw new Error('AUI version ' + version + ' is too low, you need to upgrade AUI to ' + MINIMUM_59_VERSION
                + ' for Applinks to work');
        }
    }

    function addVersionDetails(AJS) {
        var ajsVersion = Version.parse(AJS.version, 'AUI version');
        checkVersion(ajsVersion);

        AJS.versionDetails = ajsVersion;
        AJS.versionDetails.is58 = ajsVersion.toMinor().equals(VERSION_58);
        AJS.versionDetails.is59 = ajsVersion.toMinor().equals(VERSION_59);

        return AJS;
    }

    return  {
        /**
         * Check AUI version for compatibility with Applinks and add `versionDetails` field.
         */
        addVersionDetails: addVersionDetails
    };
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/console-amd.js' */
define('applinks/lib/console', function() {
    return window.console;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/jquery-amd.js' */
define('applinks/lib/jquery', function() {
   return window.jQuery;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/aui-amd.js' */
define('applinks/lib/aui', [
    'applinks/lib/window',
    'applinks/lib/aui-version-details'
], function(
    window,
    VersionDetails
) {
    var AJS = window.AJS;
    if (!AJS) {
        throw new Error('window.AJS not defined, cannot load AUI');
    }

    return VersionDetails.addVersionDetails(AJS);
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/wrm-amd.js' */
/**
 * Define Web resource manager as an AMD dependency. This should also be present in apps using Atlassian Plugins Web
 * Resources framework.
 */
define('applinks/lib/wrm', function() {
   return window.WRM;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/skate-amd.js' */
define('applinks/lib/skate', function() {
   // window.skate is not exposed as a global from AUI 5.9, this will return undefined with that version or later
   return window.skate;
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/window-amd.js' */
/**
 * Define window as AMD module to facilitate unit testing of some modules
 */
define('applinks/lib/window', function() {
    return window;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/spi-amd.js' */
/**
 * Define the Applinks SPI functions as AMD module to facilitate unit testing of some modules
 */
define('applinks/lib/spi', function() {
    return {get:
        function (){
            //required since code that depends on this global is run before the global is defined,
            // can be eliminated once this module is made properly AMD
            return AppLinks.SPI;
    }}
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/applinks-creation-amd.js' */
/**
 * Define the Applinks creation resources  as AMD module to facilitate unit testing of some modules
 */
define('applinks/lib/creation', function() {
    return {
        get: function () {
            //required since code that depends on this global is run before the global is defined,
            // can be eliminated once this module is made properly AMD
            return AppLinks.Creation;
        }
    }
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/docs.js' */
define('applinks/common/docs', [
    'applinks/lib/jquery',
    'applinks/lib/aui',
    'applinks/common/help-paths'
], function(
    $,
    AJS,
    ApplinksHelpPaths
) {
    // NOTE: should be moved to applinks/feature/help-link, see APLDEV-593

    return {
        /**
         * NOTE: this is a dynamically generated version of the link build in _help_link.vm, any update here should be
         * applied there.
         * @method createDocLink
         * @param pageKey a key that maps to a page in ual-help-paths.properties
         * @param sectionKey (Optional) a key that maps to an anchor section id in ual-help-paths.properties
         * @param classNames (Optional) Whitespace separated list of additional class names
         * @return an html &lt;a&gt; element targeting the specified page & section
         */
        createDocLink: function(pageKey, sectionKey, classNames) {
            return this._createDocLink(pageKey, sectionKey, classNames, "Help");
        },
        createDocLinkIcon: function(pageKey, sectionKey, classNames) {
            return this._createDocLink(pageKey, sectionKey, classNames, '')
                .append($('<span/>', {
                    "class": 'aui-icon aui-icon-small aui-iconfont-help',
                    "text": "Help"
                }));
        },

        _createDocLink: function(pageKey, sectionKey, classNames, text) {
            if (!classNames) {
                classNames = '';
            } else {
                classNames = ' ' + classNames;
            }
            return $('<a/>', {
                'class': 'ual-help-link help-link' + classNames,
                href: this.getDocHref(pageKey, sectionKey),
                target: '_blank',
                'data-help-link-key': pageKey,
                text: text,
                title: "Help"
            });
        },

        /**
         * @method getDocHref
         * @param pageKey a key that maps to a page in ual-help-paths.properties
         * @param sectionKey (Optional) a key that maps to an anchor section id in ual-help-paths.properties
         * @return the url of the given page and section (if specified)
         */
        getDocHref: function(pageKey, sectionKey) {
            var link = ApplinksHelpPaths.getFullPath(pageKey);
            if (sectionKey) {
                link += '#' + ApplinksHelpPaths.getPath(sectionKey);
            }
            return link;
        }
    };

});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/help-paths.js' */
define('applinks/common/help-paths', [
    'applinks/lib/console',
    'applinks/lib/wrm',
    'applinks/lib/lodash',
    'applinks/common/modules',
    'applinks/common/preconditions'
], function(
    console,
    WRM,
    _,
    ApplinksModules,
    Preconditions
) {
    // NOTE: should be moved to applinks/feature/help-link, see APLDEV-593

    // lazy-load help paths, facilitates unit-testing
    var allHelpPaths = _.memoize(function() {
        var helpPaths = WRM.data.claim(ApplinksModules.dataFqn(ApplinksModules.COMMON_EXPORTED, 'applinks-help-paths'));
        if (!helpPaths.entries) {
            console.warn('Help paths not found, all help links are likely to be broken.');
        }
        return helpPaths.entries || {};
    });

    var getPath = function(key, sectionKey) {
        Preconditions.nonEmptyString(key, 'key');
        var path = allHelpPaths()[key] || key;
        if (sectionKey) {
            Preconditions.nonEmptyString(sectionKey, 'sectionKey');
            var prefix = path.replace(/\+/g, ''); // "g" flag to remove _all_ '+' signs
            path += '#' +prefix + '-' + sectionKey;
        }
        return path;
    };

    function endsWith(string, suffix) {
        return string.indexOf(suffix, string.length - suffix.length) !== -1;
    }

    function addSuffixIfRequired(string, suffix) {
        return endsWith(string, suffix) ? string : string + suffix;
    }

    return {
        /**
         * @param key {string} key to get the path for
         * @returns {string} relative help path that can be appended to any relevant docs base URL
         */
        getPath: getPath,

        /**
         * @param key {string} key to get the path for
         * @param sectionKey {string} optional key of the anchor on the target page
         * @returns {string} full help path including the base URL
         */
        getFullPath: function(key, sectionKey) {
            var baseUrl = this.baseUrl();
            return addSuffixIfRequired(baseUrl, '/') + this.getPath(key, sectionKey);
        },

        /**
         * @returns {string} configured base URL for the help paths
         */
        baseUrl: _.partial(getPath, 'applinks.docs.root')
    }
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/events.js' */
define('applinks/common/events', [
    'applinks/lib/jquery',
    'applinks/lib/lodash',
    'applinks/lib/window',
    'applinks/common/preconditions'
], function(
    $,
    _,
    window,
    Preconditions
) {
    var PREFIX = 'applinks.event.';

    function applinksEvent(eventId) {
        return PREFIX + Preconditions.nonEmptyString(eventId, 'eventId');
    }

    /**
     * Provides common Applinks event IDs and a simple event system facade API. This is a preferred way to subscribe to
     * and raise Applinks-specific events as it does not depend on a specific event bus or event target (such as
     * `document`), as well as facilitates unit testing.
     */
    return {
        PREREADY: applinksEvent('preready'),
        READY: applinksEvent('ready'),

        /**
         * Raised when applinks list is first loaded
         */
        APPLINKS_LOADED: applinksEvent('loaded'),
        /**
         * Raised when applinks list is updated
         */
        APPLINKS_UPDATED: applinksEvent('updated'),

        /**
         * This event is only raised when linking to Atlassian applications
         * Can be consumed by other plugins
         */
        NEW_APPLINK_CREATED: applinksEvent('created'),

        /**
         * Raised when orphaned upgrade operation succeeds in creating a new Applink from the orphaned relationship
         */
        ORPHANED_UPGRADE: applinksEvent('orphaned.upgrade'),

        /**
         * Raised when v3 onboarding has finished or, or has never run on the current page (and won't).
         */
        V3_ONBOARDING_FINISHED: applinksEvent('v3-onboarding-finished'),

        // legacy events
        Legacy: {
            MESSAGE_BOX_DISPLAYED: applinksEvent('message-box-displayed')
        },

        applinksEvent: applinksEvent,

        on: function(events, handler, context) {
            var handlerWithContext = context ? _.bind(handler, context) : handler;
            $(window.document).on(events, handlerWithContext);
        },

        off: function(events, handler) {
            $(window.document).off(events, handler);
        },

        trigger: function(event, data) {
            $(window.document).trigger(event, data);
        }
    }
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/i18n.js' */
define('applinks/common/i18n', [
    'applinks/lib/lodash',
    'applinks/lib/jquery',
    'applinks/lib/wrm',
    'applinks/common/modules',
    'applinks/common/preconditions',
    'applinks/common/products'
], function(
    _,
    $,
    WRM,
    ApplinksModules,
    Preconditions,
    ApplinksProducts
) {
    var getAllEntityTypes = _.memoize(function() {
        var val = WRM.data.claim(ApplinksModules.dataFqn(ApplinksModules.COMMON_EXPORTED, 'entity-types'));
        return Preconditions.hasValue(val, 'entity-types', 'Entity Types data not found');
    });

    var getAllAuthTypes = _.memoize(function() {
        var val = WRM.data.claim(ApplinksModules.dataFqn(ApplinksModules.COMMON_EXPORTED, 'authentication-types'));
        return Preconditions.hasValue(val, 'authentication-types', 'Authentication Types data not found');
    });

    return {
        
        /**
         * @param typeId ID of the application type to resolve
         * @returns {string} resolved i18n-ed type name, or the original `typeId` if there is no mapping
         */
        getApplicationTypeName: function(typeId) {
            return ApplinksProducts.getTypeName(typeId);
        },

        /**
         * @param typeId ID of the entity type to resolve
         * @returns {string} resolved i18n-ed singular entity type name, or the original `typeId` if there is no mapping
         */
        getEntityTypeName: function(typeId) {
            return getAllEntityTypes().singular[typeId] || typeId;
        },

        /**
         * @param typeId ID of the entity type to resolve
         * @returns {string} resolved i18n-ed plural entity type name, or the original `typeId` if there is no mapping
         */
        getPluralizedEntityTypeName: function(typeId) {
            return getAllEntityTypes().plural[typeId] || typeId;
        },

        /**
         * @param type ID of the authentication type to resolve (usually in a form of full class name)
         * @returns {string} resolved i18n-ed authentication type name, or the original `type` if there is no mapping
         */
        getAuthenticationTypeName: function(type) {
            return getAllAuthTypes()[type] || type;
        }
    };
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/modules.js' */
/**
 * Applinks plugin modules core constants and definitions.
 */
define('applinks/common/modules', function() {
    return {
        /**
         * Applinks plugin key
         */
        PLUGIN_KEY: 'com.atlassian.applinks.applinks-plugin',

        // key web resource keys
        COMMON_EXPORTED: 'applinks-common-exported',
        COMMON: 'applinks-common',

        /**
         * Fully qualifies a module name using the plugin key.
         *
         * @param {string} moduleName module name to qualify
         * @returns {string} fully qualified name
         */
        fqn: function(moduleName) {
            return this.PLUGIN_KEY + ':' + moduleName;
        },

        /**
         * Fully qualifies web-resource data using module name and data key.
         *
         * @param {string} moduleName module name
         * @param {string} dataKey key of the data element
         * @returns {string} fully qualified name
         */
        dataFqn: function(moduleName, dataKey) {
            return this.fqn(moduleName) + '.' + dataKey;
        }
    };
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/preconditions.js' */
define('applinks/common/preconditions', [
    'applinks/lib/lodash'
], function(
    _
) {
    function nonEmptyString(value, varName, customMessage) {
        return _checkArgument(
            _.isString(value) && !_.isEmpty(value),
            customMessage,
            _withVarName(varName, ': expected a non-empty string, was: <' + value + '>'),
            value
        );
    }

    function isFunction(value, varName, customMessage) {
        return _checkArgument(
            _.isFunction(value),
            customMessage,
            _withVarName(varName, ': expected a function, was: ' + value),
            value
        );
    }

    function isArray(value, varName, customMessage) {
        return _checkArgument(
            _.isArray(value),
            customMessage,
            _withVarName(varName, ': expected an array, was: ' + value),
            value
        );
    }

    function hasValue(value, varName, customMessage) {
        return _checkArgument(
            value,
            customMessage,
            _withVarName(varName, ': expected a value'),
            value
        );
    }

    function _checkArgument(test, message, defaultMessage, actualValue) {
        var actualMessage = message ? message : defaultMessage;
        if (!test) {
            throw new Error(actualMessage)
        }
        return actualValue || test;
    }

    function _withVarName(varName, msg) {
        return (varName || '[unspecified]') + msg;
    }

    return {
        // applinks support 1.5.2+ underscore and its lodash counterparts
        // _.partial works differently in lodash@2.x vs its newer and underscore versions
        //  thus replacing _.partial with vanilla JS for full compatibility
        checkArgument: function(test, message, actualValue) {
            return _checkArgument(test, message, '', actualValue);
        },
        nonEmptyString: nonEmptyString,
        isArray: isArray,
        isFunction: isFunction,
        hasValue: hasValue
    };
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/products.js' */
define('applinks/common/products', [
    'applinks/lib/lodash',
    'applinks/lib/wrm',
    'applinks/common/modules',
    'applinks/common/preconditions'
], function(
    _,
    WRM,
    ApplinksModules,
    Preconditions
) {
    var getAllTypes = _.memoize(function() {
        var val = WRM.data.claim(ApplinksModules.dataFqn(ApplinksModules.COMMON_EXPORTED, 'applinks-types'));
        return Preconditions.hasValue(val, 'types', 'Application Types data not found');
    });

    /**
     * @param typeId ID of the application type to resolve
     * @returns {string} resolved i18n-ed type name, or the original `typeId` if there is no mapping
     */
    function getTypeName(typeId) {
        return getAllTypes()[typeId] || typeId;
    }

    /**
     * Map of Atlassian product keys to application type IDs
     */
    return {
        BAMBOO: 'bamboo',
        BITBUCKET: 'stash', // special case, see java class com.atlassian.applinks.application.bitbucket.BitbucketApplicationTypeImpl.TYPE_ID
        CONFLUENCE: 'confluence',
        FECRU: 'fecru',
        JIRA: 'jira',
        REFAPP: 'refapp',
        STASH: 'stash',
        getTypeName: getTypeName
    };
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.core', location = 'aui.chunk.9b2eba48549bfcc75829--e52bd34ff22cfadb41b6.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.core"],[],[["7KGX","runtime","aui.splitchunk.0d131bcbf1","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.994e478d48","aui.splitchunk.479fe6ee76","aui.splitchunk.2e16019fb9","aui.splitchunk.8771ceac91","aui.splitchunk.7873ba9060","aui.splitchunk.0fc208f3fe","aui.splitchunk.2a34183e72"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'applinks/internal/non-amd/rest-service.js' */
// NOTE: this is used outside of Applinks. See atlassian-plugin.xml for more details about the associated restrictions

(function(AppLinksI18n, ApplinksDocs, ApplinksEvents) {
    var $ = AJS.$;

    /**
     * The triggering of AppLinks initialisation can be customised by setting a function on
     * AJS.AppLinksInitialisationBinder. The binder function should take a single argument which is a zero-arg function to
     * run and should execute this function when appropriate.
     */
    AppLinks = $.extend(window.AppLinks || {}, {
        Event: {
            NAMESPACE: 'applinks'
        },
        I18n: AppLinksI18n,
        Docs: ApplinksDocs
    });
    AppLinks.Event = $.extend(window.AppLinks.Event, ApplinksEvents);

    // Is there an overridden initialisation binder?
    if (AJS.AppLinksInitialisationBinder) {
        AppLinks.initialisationBinder = AJS.AppLinksInitialisationBinder;
    } else {
        // The default bind if no specific binder is specified
        AppLinks.initialisationBinder = function(f) {
            AJS.toInit(f);
        }
    }

    function parseJsonResponse(xhr) {
        var respJSON = xhr.responseText;
        var respObj;
        try {
            respObj = JSON.parse(respJSON);
        } catch (e) {
            console && console.error && console.error('invalid JSON response', respJSON, xhr);
        }
        return respObj || {};
    }

    var restUrlVersionMatch = new RegExp('rest/applinks(?:.*?)/(\\d\\.\\d|\\d)/');
    /**
     * Determine the REST endpoint version of a given URL.
     * @param url
     */
    function versionOf(url) {
        var results = restUrlVersionMatch.exec(url);
        return results && results.length === 2 ? results[1] : false;
    }

    AppLinks.initialisationBinder(function() {
        AppLinks = $.extend(window.AppLinks || {}, {
            failure: function(data) {
                if (data.status == 401) {
                    window.location.reload();
                } else {
                    var message = AppLinks.parseError(data);
                    var errorDivs = $('.page-error');

                    if (errorDivs.length > 0) {
                        errorDivs.html(message).fadeIn('slow');
                    } else {
                        alert('REST request failed: ' + message);
                    }
                }
            },
            jsonRequest: function(url, type, data, success, error, beforeSend) {
                if (data) {
                    data = JSON.stringify(data);
                }
                $(".page-error").fadeOut('fast');
                if (!error) error = AppLinks.failure;
                return jQuery.ajax({
                    url: url,
                    type: type,
                    data: data,
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                    beforeSend: beforeSend,
                    cache: false,
                    success: success,
                    error: error,
                    jsonp: false
                });
            },
            xmlRequest: function(url, type, data, success, error, beforeSend) {
                if (data) {
                    data = JSON.stringify(data);
                }
                $(".page-error").fadeOut('fast');
                if (!error) error = AppLinks.failure;
                return jQuery.ajax({
                    url: url,
                    type: type,
                    data: data,
                    dataType: 'xml',
                    contentType: "application/xml; charset=utf-8",
                    beforeSend: beforeSend,
                    cache: false,
                    success: success,
                    error: error
                });
            },
            parseError: function(errorData) {
                var error = parseJsonResponse(errorData);
                var message = error && error.message;
                if (message) {
                    return $.isArray(message) ? message.join(' ') : message;
                }
                if (errorData) {
                    return errorData.statusText ? errorData.statusText : errorData;
                }
                return 'An unknown error occurred. Check the console logs for details.';
            },
            put: function(url, data, success, error, beforeSend) {
                return AppLinks.jsonRequest(url, 'PUT', data, success, error, beforeSend);
            },
            post: function(url, data, success, error, beforeSend) {
                return AppLinks.jsonRequest(url, 'POST', data, success, error, beforeSend);
            },
            update: function(data, success, error, beforeSend) {
                var selfLink = AppLinks.self_link(data);
                /**
                 * Adapt to the version of the endpoint and the HTTP verb it uses.
                 * yes, this is not "REST-ful". The verb is wrong. It has been wrong since 2014.
                 * It is simpler to adapt than it is to release a new endpoint.
                 */
                var restMethod = versionOf(selfLink) === '1.0' ? AppLinks.put : AppLinks.post;
                restMethod(selfLink, data, success, error, beforeSend);
            },
            get: function(url, success, error, beforeSend) {
                return AppLinks.jsonRequest(url, 'GET', null, success, error, beforeSend);
            },
            getXml: function(url, success, error, beforeSend) {
                return AppLinks.xmlRequest(url, 'GET', null, success, error, beforeSend);
            },
            self_link: function(item) {
                for (var i = 0, _i = item.link.length; i < _i; i++) {
                    var link = item.link[i];
                    if (link.rel == "self") return link.href;
                }

                throw "No self-link found";
            },
            del: function(urlOrObject, success, error, beforeSend) {
                var url;
                if (typeof(urlOrObject) == 'string') url = urlOrObject;
                else url = AppLinks.self_link(urlOrObject);
                return AppLinks.jsonRequest(url, 'DELETE', null, success, error, beforeSend);
            },
            SPI: $.extend({}, {
                API_VERSION: "1.0",
                REST_RESOURCE_URL: AJS.contextPath() + "/rest/applinks/",
                BASE_URL: AJS.contextPath() + "/rest/applinks/1.0",
                OAUTH_REST_RESOURCE_URL: AJS.contextPath() + "/rest/applinks-oauth/",
                OAUTH_BASE_URL: AJS.contextPath() + "/rest/applinks-oauth/1.0",

                /**
                 * Update the API version and associated urls.
                 * @param version
                 */
                setApiVersion: function(version){
                    AppLinks.SPI.API_VERSION = version;
                    AppLinks.SPI.setBaseUrl(AppLinks.SPI.REST_RESOURCE_URL + AppLinks.SPI.API_VERSION);
                },
                setBaseUrl: function(url){
                    AppLinks.SPI.BASE_URL = url;
                },
                setOAuthBaseUrl: function(url){
                    AppLinks.SPI.OAUTH_BASE_URL = url;
                },
                /**
                 * Build a base URL for rest calls using the specified baseUrl.
                 * @param baseUrl
                 * @returns {string}
                 */
                getRemoteRestBaseUrl: function(baseUrl) {
                    return baseUrl + "/rest/applinks/" + AppLinks.SPI.API_VERSION;
                },
                /**
                 * Build a base URL for plugin servlet calls using the specified baseUrl.
                 * @param baseUrl
                 * @returns {string}
                 */
                getRemotePluginServletBaseUrl: function(baseUrl) {
                    return baseUrl + "/plugins/servlet";
                },
                getAllLinks: function(success, failure) {
                    var url = AppLinks.SPI.BASE_URL + "/applicationlink";
                    return AppLinks.get(url, success, failure);
                },
                getAllLinksWithAuthInfo: function(success, failure) {
                    var url = AppLinks.SPI.BASE_URL + "/listApplicationlinks";
                    return AppLinks.get(url, success, failure);
                },
                getApplicationLinkState: function(id, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + "/listApplicationlinkstates/id/" + id;
                    return AppLinks.get(url, success, failure);
                },
                getLinksOfType: function(typeId, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + "/applicationlink/type/" + typeId;
                    return AppLinks.get(url, success, failure);
                },
                tryToFetchManifest: function(url, success, failure) {
                    var restUrl = AppLinks.SPI.BASE_URL + '/applicationlinkForm/manifest.json?url=' + encodeURIComponent(url);
                    return AppLinks.get(restUrl, success, failure, function(jqxhr) {
                        jqxhr.setRequestHeader("X-Atlassian-Token", "no-check");
                    });
                },
                getManifestFor: function(id, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/manifest/' + id + ".json";
                    return AppLinks.get(url, success, failure);
                },
                getLocalManifest: function(success, failure){
                    var url = AppLinks.SPI.BASE_URL + '/manifest.json';
                    return AppLinks.get(url, success, failure);
                },
                /**
                 * Attempt to get the Manifest of the remote application, via a direct REST call.
                 * Requires CORS enabled on the REST resource.
                 * @param url
                 * @param success
                 * @param failure
                 * @returns {*}
                 */
                getRemoteManifest: function(remoteBaseUrl, success, failure){
                    var remoteManifestUrl = AppLinks.SPI.getRemoteRestBaseUrl(remoteBaseUrl) + '/manifest.json';
                    return AppLinks.get(remoteManifestUrl, success, failure);
                },
                /**
                 * Attempt to get the OAuth Consumer Info of the remote application, via a direct call.
                 * Requires CORS enabled on the REST resource.
                 * @param url
                 * @param success
                 * @param failure
                 * @returns {*}
                 */
                getRemoteOAuthConsumerInfo: function(remoteBaseUrl, success, failure){
                    var remoteManifestUrl = AppLinks.SPI.getRemotePluginServletBaseUrl(remoteBaseUrl) + '/oauth/consumer-info';
                    return AppLinks.getXml(remoteManifestUrl, success, failure);
                },
                getApplinkStatus: function (applinkId, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/status/' + applinkId;
                    return AppLinks.get(url, success, failure);
                },
                createStaticUrlAppLink: function(applicationType, success, failure) {
                    var restUrl = AppLinks.SPI.BASE_URL + '/applicationlinkForm/createStaticUrlAppLink?typeId=' + applicationType;
                    return AppLinks.post(restUrl, null, success, failure);
                },
                createLink: function(applicationLink, username, password, createTwoWayLink, customRpcUrl, rpcUrl, configFormValues, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlinkForm/createAppLink';
                    var data = {
                        applicationLink: applicationLink,
                        username: username,
                        password: password,
                        createTwoWayLink: createTwoWayLink,
                        customRpcURL: customRpcUrl,
                        rpcUrl: rpcUrl,
                        configFormValues: configFormValues
                    };
                    return AppLinks.post(url, data, success, failure);
                },
                createLinkWithOrphanedTrust : function(applicationLink, username, password, createTwoWayLink, customRpcUrl, rpcUrl, configFormValues, orphanedTrust, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlinkForm/createAppLink';
                    var data = {
                        applicationLink: applicationLink,
                        username: username,
                        password: password,
                        createTwoWayLink: createTwoWayLink,
                        customRpcURL: customRpcUrl,
                        rpcUrl: rpcUrl,
                        configFormValues: configFormValues,
                        orphanedTrust: orphanedTrust
                    };
                    return AppLinks.post(url, data, success, failure);
                },
                verifyTwoWayLinkDetails : function (remoteUrl, rpcUrl, username, password, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlinkForm/details';
                    var data = {
                        username: username,
                        password: password,
                        remoteUrl: remoteUrl,
                        rpcUrl: rpcUrl
                    };
                    return AppLinks.post(url, data, success, failure);
                },
                getApplicationLinkInfo: function (appId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/applicationlinkInfo/id/" + appId;
                    return AppLinks.get(url, success, error);
                },
                deleteLink: function(applicationLink, reciprocate, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/applicationlink/" + applicationLink.id;
                    if (reciprocate) url += "?reciprocate=true";
                    return AppLinks.del(url, success, error);
                },
                makePrimary: function(applicationLink, success) {
                    var url = AppLinks.SPI.BASE_URL + "/applicationlink/primary/" + applicationLink.id;
                    return AppLinks.post(url, null, success);
                },
                relocate: function(applicationLink, newUrl, suppressWarnings, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/relocateApplicationlink/" + applicationLink.id + "?newUrl=" + encodeURIComponent(newUrl) +
                        "&nowarning=" + (suppressWarnings ? "true" : "false");
                    return AppLinks.post(url, null, success, error);
                },
                legacyUpgrade: function(applicationLink, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/upgrade/legacy/" + applicationLink.id;
                    return AppLinks.post(url, null, success, error);
                },
                ualUpgrade: function(applicationLink, body, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/upgrade/ual/" + applicationLink.id;
                    return AppLinks.post(url, body, success, error);
                },
                getEntityTypesForApplicationType: function(applicationType, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/type/entity/" + applicationType;
                    return AppLinks.get(url, success, error);
                },
                getLocalEntitiesWithLinksToApplication: function(applicationLinkId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/localEntitiesWithLinksTo/" + applicationLinkId + ".json";
                    return AppLinks.get(url, success, error);
                },
                getEntityLinksForApplication: function(applicationLinkId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entities/" + applicationLinkId + ".json";
                    AppLinks.get(url, success, error);
                },
                getEntityLinksForApplicationUsingAnonymousAccess: function(applicationLinkId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entities/anonymous/" + applicationLinkId + ".json";
                    return AppLinks.get(url, success, error);
                },
                createNonUalEntityLink: function(localType, localKey, applicationId, remoteTypeId, remoteKey, name, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/" + localType + "/" + localKey + "?reciprocate=false";
                    var data = {
                        applicationId: applicationId,
                        typeId: remoteTypeId,
                        key: remoteKey,
                        name: name,
                        isPrimary: false
                    };
                    return AppLinks.put(url, data, success, error);
                },
                createEntityLink: function(localType, localKey, entity, reciprocate, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/" + localType + "/" + localKey + "?reciprocate=";
                    url += (reciprocate ? "true" : "false");
                    return AppLinks.put(url, entity, success, failure);
                },
                getConfiguredEntityLinks: function(localType, localKey, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/primaryLinks/" + localType + "/" + localKey + ".json";
                    return AppLinks.get(url, success, error);
                },
                deleteEntityLink: function(localTypeId, localKey, entity, reciprocate, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/" + localTypeId + "/" + localKey + "?typeId=" + entity.typeId + "&key=" + entity.key + "&applicationId=" + entity.applicationId + "&reciprocate=" + reciprocate;
                    return AppLinks.del(url, success, error);
                },
                makePrimaryEntityLink: function(localTypeID, localKey, entity, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/entitylink/primary/" + localTypeID + "/" + localKey + "?typeId=" + entity.typeId + "&key=" + entity.key + "&applicationId=" + entity.applicationId;
                    return AppLinks.post(url, null, success, error);
                },
                canDeleteAppLink: function(applicationId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/permission/reciprocate-application-delete/" + applicationId;
                    return AppLinks.get(url, success, error);
                },
                canDeleteEntityLink: function(localTypeId, localKey, entity, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/permission/reciprocate-entity-delete/" + entity.applicationId + "/" + localTypeId + "/" + localKey + "/" + entity.typeId + "/" + entity.key;
                    return AppLinks.get(url, success, error);
                },
                canCreateReciprocateEntityLink: function(applicationId, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/permission/reciprocate-entity-create/" + applicationId;
                    return AppLinks.get(url, success, error);
                },
                processPermissionCode: function(settings) {
                    var config = {
                        noPermission: function() {},
                        missing: function() {},
                        credentialsRequired: function(authUrl) {},
                        authenticationFailed: function(authUrl) {},
                        noAuthentication: function(authUrl) {},
                        noAuthenticationConfigured: function() {},
                        noConnection: function() {},
                        allowed: function() {},
                        unrecognisedCode: function(code) {},
                        updateView: function(message, icon, button) {}
                    };

                    if (!settings) settings = {};

                    settings = $.extend(config, settings);

                    return function(data) {
                        var code = data.code;
                        if (code == "NO_PERMISSION") {
                            settings.noPermission();
                        } else if (code == "MISSING") {
                            settings.missing();
                        } else if (code == "CREDENTIALS_REQUIRED") {
                            settings.credentialsRequired(data.url);
                        } else if (code == "AUTHENTICATION_FAILED") {
                            settings.authenticationFailed(data.url);
                        } else if (code == "NO_AUTHENTICATION") {
                            settings.noAuthentication(data.url);
                        } else if (code == "NO_AUTHENTICATION_CONFIGURED") {
                            settings.noAuthenticationConfigured();
                        } else if (code == "NO_CONNECTION") {
                            settings.noConnection();
                        } else if (code == "ALLOWED") {
                            settings.allowed();
                        } else {
                            settings.unrecognisedCode(data.code);
                        }
                    };
                },
                addAuthenticationTrigger: function(target, authUrl, callbacks) {
                    if (!callbacks) {
                        callbacks = {};
                    }

                    if (typeof callbacks.onSuccess == "undefined") {
                        callbacks.onSuccess = function() {
                            location.reload();
                        }
                    }

                    if (typeof callbacks.onFailure == "undefined") {
                        callbacks.onFailure = function() {
                            return true;
                        }
                    }
                    //Unbind previous click listener, otherwise we might end up opening multiple windows.
                    $(target).off('click.applinks');
                    $(target).on('click.applinks', function() {
                        if (callbacks.before) {
                            callbacks.before();
                        }
                        AppLinks.authenticateRemoteCredentials(authUrl, callbacks.onSuccess, callbacks.onFailure);
                    });
                },
                deleteOrphanedTrust: function(id, type, success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/orphaned-trust/" + type + "/" + id;
                    return AppLinks.del(url, success, error);
                },
                getOrphanedTrust: function(success, error) {
                    var url = AppLinks.SPI.BASE_URL + "/orphaned-trust/";
                    return AppLinks.get(url, success, error);
                },
                showCreateEntityLinkSuggestion: function() {
                    return true;
                },
                getApplicationLink: function(id, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlink/' + id;
                    return AppLinks.get(url, success, failure);
                },
                createApplicationLink: function(id, name, rpcUrl, displayUrl, typeId, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlink';
                    var data = {
                        id: id,
                        name: name,
                        rpcUrl: rpcUrl,
                        displayUrl: displayUrl,
                        typeId: typeId
                    };
                    return AppLinks.put(url, data, success, failure);
                },
// TODO APLDEV-3 extract OAuth creation code into OAuth specific js files in the Oauth plugin.
                createConsumer: function(id, key, name, description, sharedSecret, publicKey, twoLOAllowed, executingTwoLOUser, twoLOImpersonationAllowed, outgoing, success, failure) {
                    var url = AppLinks.SPI.OAUTH_BASE_URL + '/applicationlink/' + id + '/authentication/consumer';
                    var data = {
                        key: key,
                        name: name,
                        description: description,
                        sharedSecret: sharedSecret,
                        publicKey: publicKey,
                        outgoing: outgoing,
                        twoLOAllowed: twoLOAllowed,
                        executingTwoLOUser: executingTwoLOUser,
                        twoLOImpersonationAllowed: twoLOImpersonationAllowed
                    };
                    return AppLinks.put(url, data, success, failure);
                },
                createConsumerAutoConfigure: function(id, twoLOAllowed, executingTwoLOUser, twoLOImpersonationAllowed, success, failure) {
                    var url = AppLinks.SPI.OAUTH_BASE_URL + '/applicationlink/' + id + '/authentication/consumer?autoConfigure=true';
                    var data = {
                        twoLOAllowed: twoLOAllowed,
                        executingTwoLOUser: executingTwoLOUser,
                        twoLOImpersonationAllowed: twoLOImpersonationAllowed
                    };
                    return AppLinks.put(url, data, success, failure);
                },
                registerProvider: function(id, provider, config, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/applicationlink/' + id + '/authentication/provider';
                    var data = {
                        config : config,
                        provider : provider
                    };
                    return AppLinks.put(url, data, success, failure);
                },
                enableFeature: function(featureName, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/features/' + featureName;
                    return AppLinks.put(url, {}, success, failure);
                },
                disableFeature: function(featureName, success, failure) {
                    var url = AppLinks.SPI.BASE_URL + '/features/' + featureName;
                    return AppLinks.del(url, success, failure);
                }
            }, (window.AppLinks && window.AppLinks.SPI) || {})
        });

        AppLinks.UI = {
            showInfoBox: function(message) {
                $('.aui-message.aui-message-success').remove();
                AppLinks.UI.createMessage('success', message, 'page-info');
            },
            hideInfoBox: function() {
                $('.aui-message.aui-message-success').remove();
            },
            showErrorBox: function(message) {
                AppLinks.UI.createMessage('error', message, 'page-error');
            },
            hideErrorBox: function() {
                $('.aui-message.aui-message-error').remove();
            },
            showWarningBox: function(messages) {
                if ($.isArray(messages) && messages.length > 0) {
                    var ulEl = $("<ul></ul>");
                    $(messages).each(function(index) {
                        ulEl.append($("<li/>", {
                            text: messages[index]
                        }));
                    });
                    var messageEl = $('<div class="page-warning"></div>').append(ulEl);
                    AppLinks.UI.createMessage('warning', messageEl.html(), 'page-warning');
                } else {
                    AppLinks.UI.createMessage('warning', messages, 'page-warning');
                }
            },
            hideWarningBox: function() {
                $('.aui-message.aui-message-warning').remove();
            },
            shortenString: function(message, maxLength) {
                if (message.length  > maxLength) {
                    message = message.substring(0, maxLength) + "...";
                }
                return message;
            },
            createMessage: function(type, message, cssClass) {
                var messageEl = $('<div class="' + cssClass + '">');
                messageEl.html(message);
                AJS.messages[type](".applinks-message-bar", {
                    title: "",
                    body: messageEl.wrap('<div></div>').parent().html(),
                    closeable: true
                });
                $(document).trigger(AppLinks.Event.Legacy.MESSAGE_BOX_DISPLAYED);
            },
            displayValidationErrorMessages: function (errorClass, rootEl, messages) {
                if ($.isArray(messages)) {
                    $(messages).each(function(i,v) {
                        var d = $('<div class="error applinks-error">');
                        d.text(v);
                        $(rootEl).find("." + errorClass).append(d);
                    });
                } else if(typeof messages != 'undefined'){
                    var d = $('<div class="error applinks-error">');
                    d.text(messages.toString());
                    $(rootEl).find("." + errorClass).append(d);
                }
            },
            displayValidationError: function(errorClass, rootEl, errorFn) {
                return function(xhr) {
                    if (xhr.status == 401) {
                        window.location.reload();
                        return;
                    }
                    $('.applinks-error').remove();
                    $('aui-spinner').remove();

                    var respObj = parseJsonResponse(xhr);
                    var messages = respObj.message;

                    if (typeof respObj.fields == "undefined") {
                        AppLinks.UI.displayValidationErrorMessages(errorClass, rootEl, messages);
                    } else {
                        var fields = respObj.fields;
                        $(fields).each(function(index) {
                            var d = $('<div class="error applinks-error" id="' + fields[index] + '-error">');
                            d.text(messages[index]);
                            if ($(rootEl).find('.' + fields[index]).length > 0) {
                                d.insertAfter($(rootEl).find('.' + fields[index]));
                            } else {
                                d.insertAfter($(rootEl).find('.' + errorClass).append(d));
                            }
                        });
                    }
                    $(rootEl).find('.' + errorClass).addClass("fully-populated-errors");
                    if (errorFn) {
                        errorFn();
                    }
                }
            },
            addProtocolToURL : function(url) {
                var newUrl = $.trim(url);
                var tempURL = newUrl.toLowerCase();
                var hasProtocol = false;
                if (tempURL.length >= 7) {
                    if (tempURL.substring(0,7).indexOf('http') != -1) {
                        hasProtocol = true;
                    }
                }
                //default protocol is http
                if (!hasProtocol) {
                    newUrl = 'http://' + newUrl;
                }
                return newUrl;
            },
            /**
             * Similar to the standard Javascript join() method, but nicer in that
             * it uses a different delimiter for the last node (by default "and"),
             * so that:
             * {code}
             * "1, 2 and 3" == prettyJoin(['1', '2', '3'], function(value) {return value;});
             * {code}
             *
             * @param inputArray
             * @param resolveFn
             * @param finalDelimiter
             */
            prettyJoin : function(inputArray, resolveFn, finalDelimiter) {
                if (!finalDelimiter) {
                    finalDelimiter = "and";
                }
                var maxLength = inputArray.length;
                var message = "";
                $.each(inputArray, function(index, value) {
                    if (index == (maxLength - 1) && maxLength > 1) {
                        message += " " + finalDelimiter + "  " + resolveFn(value);
                    } else {
                        message += resolveFn(value);
                        if (index + 2 < maxLength) {
                            message += ", ";
                        }
                    }
                });
                return message;
            },
            showLoadingIcon: function(element) {
                $('<aui-spinner size="small" class="applinks-loading"></aui-spinner>').insertBefore(element);
            },
            hideLoadingIcon: function(element) {
                $(element).prev('aui-spinner').remove();
            },
            findUrl: function(text) {
                var url = undefined;
                var lcText = text.toLowerCase();
                var startOfUrl = lcText.indexOf('http:');
                if (startOfUrl == -1) {
                    startOfUrl = lcText.indexOf('https:');
                }
                if (startOfUrl > -1) {
                    var endOfUrl = lcText.indexOf(' ', startOfUrl);
                    if (endOfUrl == -1) {
                        endOfUrl = lcText.length;
                    }
                    url = text.substring(startOfUrl, endOfUrl); // use _case-sensitive_ version to retrieve the actual URL
                }
                return url;
            },
            findApplicationType : function(id) {
                id = id.toLowerCase();
                if (id.indexOf("jira") != -1) {
                    return "jira";
                } else if (id.indexOf("fisheye") != -1) {
                    return "fecru";
                } else if (id.indexOf("confluence") != -1) {
                    return "confluence";
                } else if (id.indexOf("refapp") != -1) {
                    return "refapp";
                } else {
                    return undefined;
                }
            },
            escapeSelector: function(selector) {
                // based on http://samuelsjoberg.com/archive/2009/09/escape-jquery-selectors
                return selector.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g, "\\$1");
            },
            sanitiseHTML: function(input) {
                var replacements = {
                    "<": "&lt;",
                    '"': "&quot;",
                    "&": "&amp;"
                };
                return input.replace(/[<"&]/g, function(match) {
                    return replacements[match];
                });
            },
            refreshOrphanedTrust: function() {
                // post dialog -- check whether we need to remove any orphaned-trust entries
                var updateOrphanedTrust = function(data) {
                    $("tr.orphaned-trust-row").each(function() {
                        var $this = $(this);
                        var id = $this.attr("data-id");
                        var type = $this.attr("data-type");
                        var stillExists = false;
                        for (var i = 0; i < data.orphanedTrust.length; i++) {
                            var ot = data.orphanedTrust[i];
                            if (id == ot.id && type == ot.type) {
                                stillExists = true;
                                break;
                            }
                        }
                        if (!stillExists) {
                            $this.remove();
                            if (data.orphanedTrust.length == 0) {
                                // we just removed the last orphaned trust cert, hide warning!
                                $(".orphaned-trust-warning").hide();
                            }
                        }
                    });
                };

                AppLinks.SPI.getOrphanedTrust(updateOrphanedTrust);
            },
            removeCssClass: function(element, prefix) {
                $(element).removeClass( function(index, className) {
                    var classes = className.split(' ');
                    var classToRemove = "";
                    $.each(classes, function(index, value) {
                        if (value.indexOf(prefix) != -1) {
                            classToRemove = value;
                        }
                    });
                    return classToRemove;
                } );
            }
        };

        /**
         * Add jQuery event system to AppLinks.UI namespace.
         */
        (function(){
            var eventBus = $({});
            $.each(['bind', 'unbind', 'trigger'], function(i, current){
                AppLinks.UI[current] = function(){
                    return eventBus[current].apply(eventBus, arguments);
                }
            });
        })();

        $(document).trigger(AppLinks.Event.PREREADY);
        $(document).trigger(AppLinks.Event.READY);
    });
})(require('applinks/common/i18n'), require('applinks/common/docs'), require('applinks/common/events'));

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'applinks/internal/non-amd/autocomplete.js' */
// NOTE: this is used outside of Applinks. See atlassian-plugin.xml for more details about the associated restrictions

AJS.$(document).bind(AppLinks.Event.READY, function() {
/**
 * TODO: THIS CODE IS COPIED FROM CONFLUENCE and should be part of AUI/AJS.
 * IF AUI comes with the InputDrivenDropDown when can remove this file.
 * https://studio.atlassian.com/browse/AJS-471
 *
 * A simple cache manager that supports a
 * FIFO cache invalidation strategy.
 *
 * @class cacheManager
 * @namespace AJS.Confluence
 * @constructor
 * @param cacheSize the size of the cache before keys are invalidated
 */
AppLinks.autoComplete = {
        cacheManager : function (cacheSize) {
    var cache = {},
        cacheStack = [],
        cacheSize = cacheSize || 30;

    return {
        /**
         * Return the value stored in the cache for the given key
         * @method get
         * @param key {String}
         */
        get: function(key) {
            return cache[key];
        },
        /**
         * Put the given key, value in the cache
         * @method put
         * @param key {String}
         * @param value {Object}
         */
        put: function(key, value) {
            cache[key] = value;
            cacheStack.push(key);
            if (cacheStack.length > cacheSize) {
                delete cache[cacheStack.shift()];
            }
        },
        /**
         * Clear the cache.
         */
        clear : function() {
            cache = {};
            cacheStack = [];
        }
    };
}};


(function($){
    /**
     * Check that all items in the drop down can be displayed - show ellipses at the end of any that
     * are too long. Also remove any unused properties that the dropDown may have stored for each
     * item in the list.
     *
     * @method truncateText
     * @private
     */
    var truncateText = function (dd) {
        AJS.log("InputDrivenDropDown: truncating text");
        var width = dd.$.closest(".aui-dropdown").width(),
            rightPadding = 20; // add some padding so the ellipsis doesn't run over the edge of the box

        $("a span:not(.icon)", dd.$).each(function () {
            var $a = $(this),
                elpss = $("<var></var>").html("&#8230;"),
                elwidth = elpss.width(),
                isLong = false;

            $a.wrapInner($("<em>"));
            $("em", $a).each(function () {
                var $label = $(this);

                $label.show();
                if (this.offsetLeft + this.offsetWidth > width) {
                    var childNodes = this.childNodes,
                        success = false;

                    for (var j = childNodes.length - 1; j >= 0; j--) {
                        var childNode = childNodes[j],
                            truncatedChars = 1,
                            valueAttr = (childNode.nodeType == 3) ? "nodeValue" : "innerHTML",
                            nodeText = childNode[valueAttr];

                        do {
                            if (truncatedChars <= nodeText.length) {
                                childNode[valueAttr] = nodeText.substr(0, nodeText.length - truncatedChars++);
                            } else { // if we cannot fit even one character of the next word, then try truncating the node just previous to this
                                break;
                            }
                        } while (this.offsetLeft + this.offsetWidth + elwidth > width - rightPadding);

                        if (truncatedChars <= nodeText.length) {
                            // we've managed truncate part of the word and fit it in
                            success = true;
                            break;
                        }
                    }

                    if (success) {
                        isLong = true;
                    } else {
                        $label.hide();
                    }
                }
            });
            if (isLong) {
                $a.append(elpss);
                this.elpss = elpss;
            }
        });
    };

    var highlightTokens = function(dd, tokens) {
        if (!tokens.length || !tokens[0]) return;

        AJS.log("InputDrivenDropDown: highlighting tokens");

        // escape regex chars .*+?|()[]{}\ first
        for (var i = 0, ii = tokens.length; i < ii; i++) {
            var token = tokens[i];
            tokens[i] = token ? token.replace(/[\.\*\+\?\|\(\)\[\]{}\\]/g, "\\$") : "";
        }

        var regex = new RegExp("(" + tokens.join("|") + ")", "gi");

        $("li a:not(.dropdown-prevent-highlight) span", dd.$).each(function() {
            var span = $(this),
                html = span.html().replace(regex, "<strong>$1</strong>");
            span.html(html);
        });
    };

    /**
     * Builds and shows the dropdown.
     *
     * @param idd the InputDrivenDropdown
     * @param dropdownData in the form { matrix, query, queryTokens }
     * @private
     */
    var makeDropdown = function (idd, dropdownData) {
        var options = idd.options,
            old_dd = idd.dd;

        if (old_dd) {
            old_dd.hide();
            old_dd.$.remove();
        }

        options.ajsDropDownOptions = options.ajsDropDownOptions || {};
        if (options.ajsDropDownOptions && !options.ajsDropDownOptions.alignment) { // default to left alignment
            options.ajsDropDownOptions.alignment = "left";
        }
        //this needs to be moved into aui
        options.ajsDropDownOptions.selectionHandler = options.ajsDropDownOptions.selectionHandler || function(e, element) {
            if(e.type != "click") {
                e.preventDefault();
                $("a",element).click();
                document.location = $("a",element).attr("href");
            }
        };

        /* Fixing an AUI bug in here:  AJS.dropdown puts the raw 'matrix[i].name' as html, without escaping it !
           The solution is to override their displayHandler
         */
        /**
         * Escape obj.name and return it
         */
        options.ajsDropDownOptions.displayHandler = function (obj) {
            return AJS.escapeHtml(obj.name);
        }

        var dd = idd.dd = new AJS.dropDown(dropdownData.matrix, options.ajsDropDownOptions)[0];

        // could move into dropdown.js in AUI
        if (options.ajsDropDownOptions && options.ajsDropDownOptions.className) {
            dd.$.addClass(options.ajsDropDownOptions.className);
        }

        // place the created drop down using the configured dropdownPlacement function
        // if there is none then use a default behaviour
        if (options.dropdownPlacement) {
            options.dropdownPlacement(dd.$);
        } else {
            AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");
            $("body").append(dd.$);
        }

        highlightTokens(dd, dropdownData.queryTokens || [dropdownData.query]);
        truncateText(dd);

        if (options.dropdownPostprocess) {
            options.dropdownPostprocess(dd.$);
        }
        dd.show(idd._effect);

        if (typeof options.onShow == "function") {
            options.onShow.call(dd, dd.$);
        }

        return dd;
    };

    /**
     * Provides a controller-agnostic object that listens for controller changes and populates a dropdown
     * via a callback. Most aspects can be customized via the options object parameter.
     * <br>
     * Options are:
     * <li>
     *   getDataAndRunCallback - (required) callback method used to provide data for the dropdown. It must take
     *                          two parameters, user input value and the callback function to execute.
     * </li>
     * <li>
     *   onShow - function to call when the drop-down is displayed
     * </li>
     * <li>
     *   dropdownPlacement - a function that will be called with the drop down and which should place it in the
     *                          correct place on the page. The supplied arguments are 1) the input that issued the
     *                          search, 2) the dropDown to be placed.
     * </li>
     * <li>
     *   ajsDropDownOptions - any options the underlying dropDown component can handle expects
     * </li>
     * <li>
     *   onDeath - callback to run when dropdown dies
     * </li>
     * @class InputDrivenDropDown
     * @namespace AJS
     */
    function InputDrivenDropDown(id, options) {
        this._effect = "appear";
        this._timer = null;

        this.id = id;
        this.options = options;
        this.inactive = false;
        this.busy = false;
        this.cacheManager = AppLinks.autoComplete.cacheManager();
    }

    /**
     * Clears the cache.
     */
    InputDrivenDropDown.prototype.clearCache = function () {
        this.cacheManager.clear();
    };

    /**
     * This method should be called when the user input for this dropdown has changed.
     * It will check the cache before fetching data (via options.getDataAndRunCallback)
     * and displaying the dropdown.
     *
     * @param value {String} the new value of the user input
     * @param force {Boolean} force a change to occur regardless of user input
     */
    InputDrivenDropDown.prototype.change = function (value, force) {
        var t = this;
        if (value != t._value || force) {
            t._value = value;
            t.busy = false;

            clearTimeout(t._timer);

            if (force || (/\S{0,}/).test(value)) {
                var cachedVal = t.cacheManager.get(value);
                if (cachedVal) {
                    makeDropdown(t, cachedVal);
                } else {
                    t.busy = true;
                    t._timer = setTimeout(function () { // delay sending a request to give the user a chance to finish typing their search term(s)
                        t.options.getDataAndRunCallback.call(t, value, t.show);
                    }, 200);
                }
            } else {
                t.dd && t.dd.hide();
            }
        }
    };

    /**
     * Gets the number of visible options in the dropdown.
     */
    InputDrivenDropDown.prototype.dropDownLength = function () {
        return this.dd.links ? this.dd.links.length : 0;
    };
    
    /**
     * Gets the specified menu item from the dropdown list.
     * 
     * @param index {Integer} the 0-based index of the dropdown option list
     */
    InputDrivenDropDown.prototype.dropDownItem = function (index) {
        return this.dropDownLength() > index ? this.dd.links[index] : null;
    };
    
    /**
     * Hides the drop down
     */
    InputDrivenDropDown.prototype.hide = function () {
        this.dd && this.dd.hide();
    };

    /**
     * Hides and removes the drop down from the DOM.
     */
    InputDrivenDropDown.prototype.remove = function () {
        var dd = this.dd;
        if (dd) {
            this.hide();
            dd.$.remove();
        }
        this.inactive = true;
        this.options.onDeath && this.options.onDeath();
    };

    /**
     * Shows the drop down with the given matrix data and query.
     * <br>
     * Matrix property should be an array of arrays, where the sub-arrays represent the different
     * search categories.
     *
     * Expected properties of category sub-array objects are:
     *  - href
     *  - name
     *  - className
     *  - html (optional, replaces href and name)
     *  - icon (optional)
     *
     *
     * @param matrix {Array} matrix to populate the drop down from
     * @param query {String} the user input string that triggered this show
     * @param queryTokens {Array} an array of strings of the query tokens. Use for highlighting search terms.
     */
    InputDrivenDropDown.prototype.show = function (matrix, query, queryTokens) {
        if (this.inactive) {
            AJS.log("Quick search abandoned before server response received, ignoring. " + this);
            return;
        }

        var dropdownData = {
            matrix: matrix,
            query: query,
            queryTokens: queryTokens
        };
        this.cacheManager.put(query, dropdownData);

        makeDropdown(this, dropdownData);
        this.busy = false;
    };

    /**
     * Returns an InputDrivenDropDown. See InputDrivenDropDown for more documentation.
     * @param options {Object} options for the InputDrivenDropDown
     * @constructor
     */
    AppLinks.inputDrivenDropdown = function (options) {
        return new InputDrivenDropDown("inputdriven-dropdown", options);
    };

})(jQuery);
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/fecru-compatibility.js' */
if (jQuery != undefined && AJS != undefined) jQuery = AJS.$; // make sure we're extending the correct jQuery
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:feature-oauth-dance', location = 'applinks/internal/feature/oauth/oauth-callback.js' */
define('applinks/feature/oauth-callback', [
    'applinks/lib/window',
    'applinks/lib/lodash',
    'applinks/common/preconditions'
], function(
    window,
    _,
    Preconditions
) {
    function OAuthCallback(url) {
        Preconditions.nonEmptyString(url, 'url');
        this._url = url;
    }

    OAuthCallback.prototype.source = function(source) {
        Preconditions.hasValue(source, 'source');
        this._source = source;
        return this;
    };

    OAuthCallback.prototype.onSuccess = function(callback) {
        Preconditions.isFunction(callback, 'onSuccess');
        this._onSuccess = callback;
        return this;
    };

    OAuthCallback.prototype.onFailure = function(callback) {
        Preconditions.isFunction(callback, 'onFailure');
        this._onFailure = callback;
        return this;
    };

    // API for OAuth to invoke callbacks
    OAuthCallback.prototype.success = function() {
        this.oauthWindow.close();
        if (this._onSuccess) {
            this._onSuccess(this._source);
        }
        // free up the oauthCallback object
        delete window.oauthCallback;
    };

    OAuthCallback.prototype.failure = function() {
        this.oauthWindow.close();
        if (this._onFailure) {
            this._onFailure(this._source);
        }
        // free up the oauthCallback object
        delete window.oauthCallback;
    };

    // start the dance
    OAuthCallback.prototype.open = function() {
        // required for OAuth callbacks to fire
        window.oauthCallback = this;
        this.oauthWindow = window.open(this._url, 'com_atlassian_applinks_authentication');
    };

    return OAuthCallback;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:feature-oauth-dance', location = 'applinks/internal/feature/oauth/oauth-dance.js' */
define('applinks/feature/oauth-dance', [
    'applinks/lib/console',
    'applinks/lib/jquery',
    'applinks/lib/lodash',
    'applinks/lib/window',
    'applinks/common/events',
    'applinks/common/preconditions',
    'applinks/feature/oauth-callback'
], function(
    console,
    $,
    _,
    window,
    ApplinksEvents,
    Preconditions,
    OAuthCallback
) {
    /**
     * Creates a new OAuth Dance. This initializes elements found by `selector` within `scope` to initiate the OAuth
     * dance on click. The elements need to have a `data-authorisation-uri` attribute that points to the authorisation
     * page to open.
     *
     * @param scope {string} optional selector for scope, if not defined then global `document` will be used
     * @param selector {string} selector for the DOM elements to initialize OAuth dance for. If not defined then scope will be used
     * @constructor
     */
    function OAuthDance(scope, selector) {
        this._scope = scope || window.document;
        this._selector = selector;
    }

    OAuthDance.prototype.onSuccess = function(callback) {
        Preconditions.isFunction(callback, 'onSuccess');
        this._onSuccess = callback;
        return this;
    };

    OAuthDance.prototype.onFailure = function(callback) {
        Preconditions.isFunction(callback, 'onFailure');
        this._onFailure = callback;
        return this;
    };

    OAuthDance.prototype.defaultSuccess = function() {
        return this.onSuccess(function() {
            window.location.reload()
        });
    };

    OAuthDance.prototype.defaultFailure = function() {
        return this.onFailure(function() { return true });
    };

    /**
     * Wire up click events for the selected elements to initiate OAuth dance.
     */
    OAuthDance.prototype.initialize = function() {
        var that = this;
        if (this._selector) {
            $(this._scope).on('click', this._selector, function(e) {
                e.preventDefault();
                that._open($(this));
            });
        } else {
            $(this._scope).on('click', function(e) {
                e.preventDefault();
                that._open($(this));
            });
        }
    };

    /**
     * Start the OAuth dance for the given selector/scope.
     */
    OAuthDance.prototype.start = function() {
        var $scope = $(this._scope);
        var $element = this._selector ? $scope.find(this._selector) : $scope;
        this._open($element);
    };

    OAuthDance.prototype._open = function(element) {
        if (element.length !== 1) {
            console.warn('Could not trigger OAuth dance, the source is not a single HTML element: ' + element);
            return;
        }
        
        var authorisationUri = element.attr('data-authorisation-uri');

        if (authorisationUri) {
            this._onSuccess || this.defaultSuccess();
            this._onFailure || this.defaultFailure();
            new OAuthCallback(authorisationUri)
                .source(element)
                .onSuccess(this._onSuccess)
                .onFailure(this._onFailure)
                .open();
        } else {
            console.warn('Could not trigger OAuth dance, data-authorisation-uri missing for: ' + element);
        }
    };

    return OAuthDance;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-oauth-ui', location = 'js/oauth-dialog.js' */
// NOTE: this is used outside of Applinks. See atlassian-plugin.xml for more details about the associated restrictions

/**
 * @deprecated use applinks/feature/oauth-callback and applinks/feature/oauth-dance AMD module
 */
(function($, ApplinksEvents, OAuthCallback) {
    // rest-service.js will load the AppLinks name space
    AppLinks.authenticateRemoteCredentials = function (url, onSuccess, onFailure) {
        $('.applinks-error').remove();
        new OAuthCallback(url).onSuccess(onSuccess).onFailure(onFailure).open();
    };
})(require('applinks/lib/jquery'), require('applinks/common/events'), require('applinks/feature/oauth-callback'));

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:common', location = 'util/retry-caller.js' */
define("confluence/jim/util/retry-caller",["ajs","jquery","underscore"],function(q,d,h){return function(k,a){a=a||{};var l=a.args,m="function"===typeof a.tester?a.tester:function(){return!0},e=a.delays||[.1,.3,.5,.7,1],n=e.length,c=d.Deferred(),p=c.promise(),b=a.context||c,f=0,g=function(){if(f===n)return c.rejectWith(b,[b,"exceed-maximum-called-times",""]);var a=e[f++];h.delay(function(){d.when(k.apply(b,l)).then(function(){c.notify.apply(b,arguments);m.apply(b,arguments)?g():c.resolveWith(b,arguments)},
function(){c.rejectWith(b,arguments)})},a)};g();return p}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:common', location = 'util/common.js' */
AJS.JiraIssues={Remote:{}};var appLinksI18n={entries:{}};
jQuery(document).ready(function(){AJS.JiraIssues=jQuery.extend(AJS.JiraIssues||{},{bindOAuthLink:function(a,b){var c=function(){b()},d=function(){},e=a.attr("href");a.click(function(a){AppLinks.authenticateRemoteCredentials(e,c,d);a.preventDefault()})},getOAuthRealm:function(a){a=a.getResponseHeader("WWW-Authenticate")||"";return(a=/OAuth realm="([^"]+)"/.exec(a))?a[1]:null}});jQuery("a.static-oauth-init").each(function(){AJS.JiraIssues.bindOAuthLink(jQuery(this),function(){window.location.reload()})});
jQuery("a.anonymous-init").each(function(a,b){a=encodeURIComponent(window.location.pathname.replace(Confluence.getContextPath(),""));a=Confluence.getContextPath()+"/login.action?os_destination\x3d"+a;AJS.$(b).attr("href",a)});var n=function(a){for(var b=AJS.JiraIssues.Remote[a],c="",d=0;d<b.length;d++)c+=b[d].key+(d<b.length-1?",":"");var e=function(b){b="/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery\x3d"+encodeURIComponent("issuekey in ("+b+")")+"\x26returnMax\x3dtrue";return contextPath+
"/plugins/servlet/issue-retriever?appId\x3d"+a+"\x26url\x3d"+encodeURIComponent(b)+"\x26columns\x3dsummary\x26columns\x3dtype\x26columns\x3dresolution\x26columns\x3dstatus"},f=function(a){AJS.$("item",a).each(function(){for(var a=AJS.$("link",this).text(),b=AJS.$("key",this).text(),c=AJS.$("summary",this).text(),d=AJS.$("type",this),m="-1"!=AJS.$("resolution",this).attr("id"),e=AJS.$("status",this),k=AJS.$(".unknown-jira-issue."+b),h=0;h<k.length;h++){var f=AJS.$("\x3ca style\x3d\"background-image: url('"+
d.attr("iconUrl")+'\')" href\x3d"'+a+'"\x3e\x3c/a\x3e');f.text(b);var l=AJS.$('\x3cspan class\x3d"jira-status"\x3e\x3c/span\x3e');l.text(e.text().toUpperCase());var g=AJS.$('\x3cspan class\x3d"jira-issue'+(m?" resolved":"")+'" \x3e\x3c/span\x3e');g.append(f);g.append(document.createTextNode(" - "+c+" - "));g.append(l);AJS.$(k[h]).replaceWith(g)}})};c=e(c);AJS.$.ajax({url:c,success:f,error:function(a){if(401==a.status){var c=AJS.JiraIssues.getOAuthRealm(a);if(c){var d={};AJS.$(b).each(function(){if(!d[this.key]){d[this.key]=
!0;var a=AJS.$('\x3cspan class\x3d"oauth-msg"\x3e - \x3ca class\x3d"oauth-init" href\x3d"'+c+'"\x3e'+"Authenticate"+"\x3c/a\x3e "+"to see issue details"+"\x3c/span\x3e");AJS.$(".unknown-jira-issue."+this.key).addClass("single-issue-oauth").append(a)}});AJS.JiraIssues.bindOAuthLink(AJS.$(".single-issue-oauth a.oauth-init"),function(){window.location.reload()})}}else 400==a.status&&1<b.length&&AJS.$(b).each(function(){var a=this.key,b=e(a);
AJS.$.ajax({url:b,success:f,error:function(b){b=AJS.$(".unknown-jira-issue."+a);b.removeClass("single-issue-oauth");AJS.$(".oauth-msg",b).remove();b.addClass("jira-error")}})})}})};AJS.$(".unknown-jira-issue").each(function(a,b){b=AJS.$(b);a=b.attr("data-app-link");b=b.attr("data-key");AJS.JiraIssues.Remote[a]=AJS.JiraIssues.Remote[a]||[];AJS.JiraIssues.Remote[a].push({key:b})});for(var p in AJS.JiraIssues.Remote)n(p)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:web-resources', location = 'templates/extra/jira/jiraIssues.js' */
jQuery(document).ready(function(){var f=jQuery.extend(window.JiraIssues||{},{ADG_ENABLED:4E3<=AJS.Meta.getNumber("build-number"),ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO:14/11,onSuccessFunction:function(b){if(!jQuery("fieldset input[name\x3d'height']",b).length){var a=jQuery(".bDiv table[id^\x3d'jiraissues_table']",b)[0],c=a.grid;a=a.clientHeight+jQuery(".hDiv",b)[0].clientHeight;jQuery(".bDiv",b).css("height",a+"px");c.options.height=a;c.fixHeight(a)}},onErrorFunction:function(b,a,c,e,d){c=jQuery("#"+
a);d=e.getResponseHeader("WWW-Authenticate")||"";if("401"==e.status&&-1!=d.indexOf("OAuth")){if(e=/OAuth realm="([^"]+)"/.exec(d)){c.empty();f.bigMessageFunction(a,'\x3ca class\x3d"oauth-init" href\x3d"'+e[1]+'"\x3e'+"Authenticate"+"\x3c/a\x3e "+"to retrieve your issues"+"\x3c/span\x3e");jQuery(".bmDiv",b).css({"z-index":2});var k=function(){window.location.reload()},g=function(){};a=jQuery(".oauth-init",c.parent());var l=a.attr("href");a.click(function(a){AppLinks.authenticateRemoteCredentials(l,
k,g);a.preventDefault()});AJS.$(".gBlock").remove()}}else if("400"==e.status)f.bigMessageFunction(a,"The Jira server was not able to process the search. This may indicate a problem with the syntax of this macro. Alternatively, if this table is requesting specific issue keys, you may not have permission to view one of these issues.");else{var h=jQuery("iframe.jiraissues_errorMsgSandbox",b);h.load(function(){var a=this.contentWindow||this.contentDocument;a=jQuery((a.document?a.document:a).body);jQuery("a",a).each(function(){this.target="_top"});jQuery(".pPageStat",b).empty().text(a.text());a=jQuery("div.bmDiv",b)[0];h.removeClass("hidden");h.css({height:a.clientHeight+"px",
width:a.clientWidth+"px"})});h[0].src=jQuery("fieldset input[name\x3d'retrieverUrlHtml']",b).val();f.bigMessageFunction(a,h)}jQuery(b).find(".pReload").removeClass("loading");c[0].grid.loading=!1;jQuery(b).find(".pButton").each(function(){jQuery(this).removeClass("pBtnOver");jQuery(this).css({cursor:"default",opacity:"0.3"})});jQuery(b).find("span.pcontrol input").attr("readonly","true")},onReloadFunction:function(b,a,c){jQuery(".bmDiv",a).remove();jQuery(".bmDistance",a).remove();c.onSubmit=function(){f.reloadOnSubmitFunction(b,
c);return!0}},reloadOnSubmitFunction:function(b,a){a.params=[{name:"useCache",value:!1}];a.onSubmit=function(){f.onSubmitFunction(b,a);return!0}},onSubmitFunction:function(b,a){a.params=[{name:"useCache",value:b}]},showTrustWarningsFunction:function(b,a){b=jQuery(b).children(".trusted_warnings");a.trustedMessage?(b.find("td:last").html(a.trustedMessage),b.css("display","block")):b.css("display","none")},preProcessFunction:function(b,a,c,e,d){c&&f.showTrustWarningsFunction(b,e);0==e.total&&(jQuery(".pPageStat",
b).html(d),f.bigMessageFunction(a,d),jQuery(".pReload",b).removeClass("loading"))},bigMessageFunction:function(b,a){var c=jQuery("\x3cdiv\x3e\x3c/div\x3e"),e=jQuery("\x3cdiv\x3e\x3c/div\x3e");c.addClass("bmDistance");e.addClass("bmDiv");"string"==typeof a?e.html("\x3cp\x3e\x3cstrong\x3e"+a+"\x3c/strong\x3e\x3c/p\x3e"):a.appendTo(e);jQuery("#"+b).after(e).after(c)},getParamsFrom:function(b){var a={};b.children("input").each(function(){a[jQuery(this).attr("name")]=jQuery(this).attr("value")});return a},
initializeColumnWidth:function(b,a){var c={},e=function(a){return f.ADG_ENABLED?Math.round(a*f.ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO):a};if(!a||!a.length)return c;b=b.width()-(37+11*a.length);for(var d=!1,k=!1,g=0,l=e(140),h=0,n=a.length;h<n;h++){var m=a[h].name;switch(m){case "summary":d=!0;g++;break;case "description":k=!0;g++;break;case "type":g++;c[m]=30;b-=30;break;case "priority":g++;c[m]=50;b-=50;break;case "status":g++;c[m]=e(100);b-=e(100);break;case "key":g++;c[m]=e(90);b-=e(90);
break;case "comments":case "attachments":case "version":case "component":case "resolution":g++;c[m]=e(80);b-=e(80);break;default:c[m]=l}}if(d||k)b-=l*(a.length-g),d&&k?(c.summary=Math.max(b/2,250),c.description=Math.max(b/2,250)):d?c.summary=Math.max(b,250):c.description=Math.max(b,250);else if(!d&&!k&&a.length>g)for(l=b/(a.length-g),h=0;h<n;h++)({resolution:!0,key:!0,type:!0,priority:!0,status:!0})[a[h]]||(c[a[h]]=l);return c}});jQuery(".jiraissues_table").each(function(b,a){var c=jQuery(a),e=c.children("fieldset"),
d=f.getParamsFrom(e),k="jiraissues_table_"+b;c.append('\x3ctable id\x3d"'+k+'" style\x3d"display:none"\x3e\x3c/table\x3e');c.css("width",d.width);var g=[];e.children(".columns").each(function(a){var b=jQuery(this).hasClass("nowrap");g[a]={display:this.name,name:this.value,nowrap:b,sortable:!0,align:"left"}});var l=f.initializeColumnWidth(c,g);jQuery.each(g,function(a,b){b.width=l[b.name]});b=jQuery("\x3cdiv\x3e\x3c/div\x3e");jQuery("\x3ca\x3e\x3c/a\x3e").attr({rel:"nofollow",href:d.clickableUrl}).text(d.title).appendTo(b);
jQuery("#"+k).flexigrid({url:d.retrieverUrlHtml,method:"GET",dataType:"json",colModel:g,sortname:d.sortField,sortorder:d.sortOrder,usepager:!0,title:b.html(),page:parseInt(d.requestedPage,10),useRp:!1,rp:parseInt(d.resultsPerPage,10),showTableToggleBtn:!0,height:d.height?parseInt(d.height,10):480,onSuccess:function(){f.onSuccessFunction(a)},onSubmit:function(){f.onSubmitFunction(d.useCache,this);return!0},preProcess:function(b){f.preProcessFunction(a,k,d.showTrustWarnings,b,d.nomsg);return b},onError:function(b,
c,e){f.onErrorFunction(a,k,d.jiraissuesError,b,c,e)},onReload:function(){f.onReloadFunction(d.useCache,a,this);return!0},errormsg:d.errormsg,pagestat:d.pagestat,procmsg:d.procmsg,nomsg:d.nomsg})});jQuery(".jiraissues_count").each(function(b,a){var c=jQuery(a);jQuery.ajax({cache:!1,type:"GET",url:c.find(".url").text(),data:{useCache:c.find(".use-cache").text(),rp:c.find(".rp").text(),showCount:"true"},success:function(a){var b=c.find(".result");1==a?b.text(AJS.format("{0} issue",
a)):b.text(AJS.format("{0} issues",a));b.removeClass("hidden");jQuery(".calculating, .error, .data",c).remove()},error:function(a){var b=jQuery(".error",c).removeClass("hidden"),e=a.getResponseHeader("WWW-Authenticate")||"",g=!1;if(401===a.status&&-1!=e.indexOf("OAuth")){var f=/OAuth realm="([^"]+)"/.exec(e);f&&(b.empty().append(AJS.$("\x3ca/\x3e",{href:f[1],"class":"oauth-init"}).text("Authenticate").click(function(){AppLinks.authenticateRemoteCredentials(f[1],
function(){window.location.reload()},function(){});return!1})).append(AJS.$("\x3cspan/\x3e",{text:" "+"to retrieve your issues"})),g=!0)}g||b.text(AJS.format(b.text(),a.status));jQuery(".calculating, .result, .data",c).remove()}})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.synchrony-interop:synchrony-status-banner-loader', location = '/js/synchrony-down-banner-loader.js' */
require(["ajs","wrm"],function(b,a){b.toInit(function(){!0===a.data.claim("com.atlassian.confluence.plugins.synchrony-interop:synchrony-status-banner-loader.synchrony-status")&&a.require("wrc!synchrony-interop-down-banner")})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'templates/recently.soy' */
// This file was automatically generated from recently.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace RY.Templates.
 */

if (typeof RY == 'undefined') { var RY = {}; }
if (typeof RY.Templates == 'undefined') { RY.Templates = {}; }


RY.Templates.body = function(opt_data, opt_ignored) {
  return '<div id="recently-viewed" class="aui-group"><div class="aui-item"><div class="top"><div class="filter"><form class="aui"><input class="filter-input text" type="text" placeholder="' + soy.$$escapeHtmlAttribute('Filter') + '"></form></div></div><div class="pages"></div></div></div>';
};
if (goog.DEBUG) {
  RY.Templates.body.soyTemplateName = 'RY.Templates.body';
}


RY.Templates.pageCollection = function(opt_data, opt_ignored) {
  return '<div class="groups"></div><div class="empty"></div>';
};
if (goog.DEBUG) {
  RY.Templates.pageCollection.soyTemplateName = 'RY.Templates.pageCollection';
}


RY.Templates.pageGroup = function(opt_data, opt_ignored) {
  return '<h3>' + soy.$$escapeHtml(opt_data.title) + '</h3><ul></ul>';
};
if (goog.DEBUG) {
  RY.Templates.pageGroup.soyTemplateName = 'RY.Templates.pageGroup';
}


RY.Templates.pageItem = function(opt_data, opt_ignored) {
  return '<a href=' + soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)) + '><div class="page-icon"><span class="aui-icon content-type-' + soy.$$escapeHtmlAttribute(opt_data.type) + '">' + soy.$$escapeHtml(opt_data.type) + '</span></div><div class="page-title"><span class="ellipsis" href=' + soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)) + '>' + soy.$$escapeHtml(opt_data.title) + ' - ' + soy.$$escapeHtml(opt_data.space) + '</span></div></a>';
};
if (goog.DEBUG) {
  RY.Templates.pageItem.soyTemplateName = 'RY.Templates.pageItem';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/util.js' */
var RY=RY||{};
(function(){var a=new Date,c=(new Date(a)).getTime(),d=(new Date(a.getFullYear(),a.getMonth(),a.getDate())).getTime(),h=(new Date(a.getFullYear(),a.getMonth(),a.getDate()-1)).getTime();RY.util=RY.Util={analytics:{trackDialogOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-dialog-open"})},trackPageOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-page-open"})}},quote:function(b){return b.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},diffInDays:function(b,a){return Math.floor((b-a)/
864E5)},daysSince:function(a){return a>=d?0:a>=h?1:RY.util.diffInDays(c,a)},wait:function(a,e,c){var b,f,g,d=function(){f=setTimeout(function(){a.apply(c,g)},e)};return function(){g=arguments;var a=new Date;b&&a-b<e&&clearTimeout(f);d();b=a}}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page-storage.js' */
var RY=RY||{};
RY.RecentPageStorage=function(d){var c={},e=function(){var a=function(b,a){return"lastSeen"===b&&_.isString(a)?(new Date(a)).getTime():a};try{c=JSON.parse(d.getItem("com.atlassian.confluence.plugins.recently.viewed.pages.v1"),a)||{}}catch(b){c={}}return c},f=function(){var a=_.values(c),b=a.length-100;if(0<b){var d=_.sortBy(a,function(a){return a.lastSeen});_.times(b,function(){var a=d.shift();delete c[a.id]})}};this.addCurrentPage=function(a){if(a.id&&a.title){e();var b=c[a.id];b||(c[a.id]=b={});
b=_.extend(b,a);b.lastSeen=(new Date).getTime();b.count=b.count+1||1;f();try{d.setItem("com.atlassian.confluence.plugins.recently.viewed.pages.v1",JSON.stringify(c))}catch(g){}}};this.getPages=function(){return _.values(e())}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/filter.js' */
var RY=RY||{};
RY.FilterView=Backbone.View.extend({className:"filter",events:{"input .filter-input":"onInput","keyup .filter-input":"onInput","keydown .filter-input":"onKeydown"},initialize:function(){_.bindAll(this,"render","onInput","onKeydown","search");this.navigationEvents=this.options.navigationEvents;this.onInput=RY.util.wait(this.onInput,100,this)},render:function(){this.$input=this.$(".filter-input");return this},onInput:function(a){a&&_.contains([37,38,39,40],a.which)||this.search()},onKeydown:function(a){switch(a.which){case 13:this.navigationEvents.trigger("select");a.preventDefault();
a.stopPropagation();break;case 38:this.navigationEvents.trigger("previous");a.preventDefault();break;case 40:this.navigationEvents.trigger("next"),a.preventDefault()}},search:function(){var a=this.$input.val();this.collection.search(a)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page-model.js' */
var RY=RY||{};
(function(){var c="undefined"!=typeof ConfluenceMobile?ConfluenceMobile.AppData.get("confluence-context-path"):AJS.contextPath();RY.Page=Backbone.Model.extend({href:function(){return c+this.get("url")},daysSinceLastSeen:function(){return RY.util.daysSince(this.get("lastSeen"))}});RY.PageCollection=Backbone.Collection.extend({model:RY.Page,url:c+"/rest/recentlyviewed/1.0/recent?includeTrashedContent\x3dtrue",search:function(a){if(0===this._queryLength(a))var b=this.models;else{var c=a.match(/[^\s-]+/g);
b=this.filter(function(a){var b=a.get("title");a=a.get("space");var d=(b+a).toLowerCase();return _.all(c,function(a){return-1!==d.indexOf(a.toLowerCase())})})}this.trigger("filter",b,a);return b},_queryLength:function(a){return String.prototype.trim?a.trim().length:AJS.$.trim(a).length},comparator:function(a){return-a.get("lastSeen")}})})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page.js' */
var RY=RY||{};RY.PageView=Backbone.View.extend({tagName:"li",className:"ry-page",template:RY.Templates.pageItem,initialize:function(){_.bindAll(this,"hide","show","render")},hide:function(){this.$el.hide().removeClass("shown")},show:function(){this.$el.show().addClass("shown")},render:function(){var a=this.model.toJSON();a.href=this.model.href();this.$el.html(this.template(a));return this}});
RY.PageGroupView=Backbone.View.extend({className:"group",template:RY.Templates.pageGroup,initialize:function(){_.bindAll(this,"hide","hideAll","show","showBorder","showPages","add","render");this.title=this.options.title;this.modelViews={}},hide:function(){this.$el.hide()},hideAll:function(){this.$el.removeClass("border").hide();_.invoke(_.values(this.modelViews),"hide")},show:function(){this.$el.show()},showBorder:function(){this.$el.addClass("border")},showPages:function(a){var b=this,c=!1;_.each(a,
function(a){if(a=b.modelViews[a.cid])c=!0,a.show()});c&&this.show();return c},add:function(a){var b=new RY.PageView({model:a});this.modelViews[a.cid]=b;this.$list.append(b.render().el)},render:function(){this.$el.html(this.template({title:this.title}));this.$list=this.$("ul");return this}});
RY.PageNavigator=function(a,b,c){function e(b){pageItems=a.find("li.shown");var c=pageItems.index(pageItems.filter(".highlight"));d&&d.removeClass("highlight");b+=c;0>b&&(b=pageItems.length-1);b>=pageItems.length&&(b=0);d=pageItems.eq(b);d.addClass("highlight")}function f(){if(d.length){var c=b.children(),e=b.height(),f=d.outerHeight(!0),g=d.position().top;0>g?0===a.find("li.shown").index(d)?b.scrollTop(0):b.scrollTop(d.offset().top-c.offset().top):g>e&&b.scrollTop(d.offset().top-c.offset().top-e+
f)}}var d=null;c.on("select",function(){if(d&&d.is(":visible")){RY.util.analytics.trackPageOpen();var a=d.find(".page-title span").attr("href");window.location=a}},this);c.on("previous",function(){e(-1);f()},this);c.on("next",function(){e(1);f()},this)};
RY.PageCollectionView=Backbone.View.extend({template:RY.Templates.pageCollection,events:{"click .page-title a":RY.util.analytics.trackPageOpen},initialize:function(){_.bindAll(this,"checkEmpty","filter","_groupForPage","addOne","showEmptyMessage","clearEmptyMessage","addAll","render");this.modelViews={};this.collection.on("reset",this.addAll,this);this.collection.on("add",this.addOne,this);this.collection.on("filter",this.filter,this)},checkEmpty:function(a,b){var c=this.collection.isEmpty();a=0===
a.length;c||a?(c?b="Sorry mate, looks like you haven\u0027t visited any pages yet.":(b=AJS.contextPath()+"/dosearchsite.action?queryString\x3d"+encodeURIComponent(b),b="We didn\u0027t find any matching pages in your history."+" "+AJS.format("\u003ca href=\u0022{0}\u0022\u003eClick here\u003c/a\u003e to search for this term instead.",b)),this.showEmptyMessage(b)):this.clearEmptyMessage()},filter:function(a,b){this.checkEmpty(a,b||"");b=[this.$today,this.$yesterday,this.$older];_.invoke(b,
"hideAll");var c=[];_.each(b,function(b){b.showPages(a)&&c.push(b)});1<c.length&&(c.pop(),_.invoke(c,"showBorder"))},_groupForPage:function(a){a=a.daysSinceLastSeen();return 0===a?this.$today:1===a?this.$yesterday:this.$older},addOne:function(a){this._groupForPage(a).add(a)},showEmptyMessage:function(a){this.$(".empty").html(AJS.$("\x3cp\x3e").html(a))},clearEmptyMessage:function(){this.$(".empty").html("")},addAll:function(){this.collection.each(this.addOne)},render:function(){this.$el.html(this.template());
this.$today=new RY.PageGroupView({title:"Today"});this.$yesterday=new RY.PageGroupView({title:"Yesterday"});this.$older=new RY.PageGroupView({title:"Older"});var a=this.$(".groups");a.append(this.$today.render().el);a.append(this.$yesterday.render().el);a.append(this.$older.render().el);
_.invoke([this.$today,this.$yesterday,this.$older],"hideAll");return this}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:main-resources', location = 'js/main.js' */
var RY=RY||{};
AJS.toInit(function(b){b("#view-user-history-link").unbind("click");b("#view-user-history-link").click(function(a){a.preventDefault();a=new AJS.Dialog({width:600,height:500,id:"recently-viewed-dialog",closeOnOutsideClick:!0});var c=b(RY.Templates.body());a.addHeader("Recently viewed pages");a.addPanel("SinglePanel",c);a.addLink("Close",function(a){a.hide()});var f=b("\x3cdiv\x3e",{"class":"dialog-tip"}).text("Hint: type \u0022g\u0022 and then \u0022r\u0022 anywhere to quickly open this menu");
a.popup.element.find(".dialog-button-panel").append(f);var d=new RY.PageCollection,e=new RY.PageCollectionView({collection:d});c.find(".pages").html(e.render().el);a.gotoPanel(0);a.show();var g=b("#recently-viewed-dialog").spin("large");d.fetch({success:function(){g.spinStop();var a=_.extend({},Backbone.Events);new RY.PageNavigator(e.$el,c.parent(),a);(new RY.FilterView({collection:d,el:c.find(".filter"),navigationEvents:a})).render().search()}});RY.util.analytics.trackDialogOpen()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.pattern.icon', location = 'aui.chunk.133afb7ec1bb5b6a96aa--2547fd690d4ae5d7edbc.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.pattern.icon"],[],[["YQ7q","runtime","aui.splitchunk.d7c46c2734"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.expander', location = 'aui.chunk.33f39b18a6139eacbb29--34c953d3f58103cedfe9.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.expander"],{ufFX:function(e,t,r){"use strict";r.r(t);var a=r("+x/D"),n=Object(a.a)(document),i=function(e){var t={};return t.$trigger=Object(a.a)(e.currentTarget),t.$content=n.find("#"+t.$trigger.attr("aria-controls")),t.triggerIsParent=0!==t.$content.parent().filter(t.$trigger).length,t.$shortContent=t.triggerIsParent?t.$trigger.find(".aui-expander-short-content"):null,t.height=t.$content.css("min-height"),t.isCollapsible=!1!==t.$trigger.data("collapsible"),t.replaceText=t.$trigger.attr("data-replace-text"),t.replaceSelector=t.$trigger.data("replace-selector"),t},c=function(e){if(e.replaceText){var t=e.replaceSelector?e.$trigger.find(e.replaceSelector):e.$trigger;e.$trigger.attr("data-replace-text",t.text()),t.text(e.replaceText)}},g={"aui-expander-invoke":function(e){var t=Object(a.a)(e.currentTarget),r=n.find("#"+t.attr("aria-controls")),i=!1!==t.data("collapsible");"true"===r.attr("aria-expanded")&&i?t.trigger("aui-expander-collapse"):t.trigger("aui-expander-expand")},"aui-expander-expand":function(e){var t=i(e);"true"!==t.$content.attr("aria-expanded")&&(t.$content.attr("aria-expanded","true"),t.$trigger.attr("aria-expanded","true"),t.$content.get(0).removeAttribute("hidden"),c(t),t.triggerIsParent&&t.$shortContent.hide(),t.$trigger.trigger("aui-expander-expanded"))},"aui-expander-collapse":function(e){var t=i(e);"true"===t.$content.attr("aria-expanded")&&(c(t),t.$content.attr("aria-expanded","false"),t.$trigger.attr("aria-expanded","false"),t.triggerIsParent&&t.$shortContent.show(),0===t.$content.outerHeight()&&t.$content.get(0).setAttribute("hidden",""),t.$trigger.trigger("aui-expander-collapsed"))},"click.aui-expander":function(e){Object(a.a)(e.currentTarget).trigger("aui-expander-invoke",e.currentTarget)}};n.on(g,".aui-expander-trigger")}},[["ufFX","runtime","aui.splitchunk.0d131bcbf1","aui.splitchunk.739b9ec8cc"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.component.form.toggle', location = 'aui.chunk.cea7679ae83489881190--cbe615ac83bc24051ade.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.component.form.toggle"],{KKmC:function(e,t,i){"use strict";i.r(t),i.d(t,"ToggleEl",(function(){return O}));i("6fSn"),i("eSvk"),i("oSOL"),i("XphB");var a=i("+x/D"),n=i("kdZR"),c=i("cWqH"),u=i("fVKi"),s=i("+ay7"),l=i("gjsO"),o=i.n(l),r=i("4dFR"),d=i("LTUc"),h=i("P3rJ"),f=i("tYoR"),b=i("HH5i");function p(e){return e._input||(e._input=e.querySelector("input"))}function k(e){return e._spinner||(e._spinner=new f.b)}function v(e,t){p(t).removeAttribute(e)}function g(e,t,i){p(t).setAttribute(e,i.newValue)}function m(e){return{removed:v.bind(this,e),fallback:g.bind(this,e)}}const y={removed:function(e){v.call(this,"form",e),e._formId=null},fallback:function(e,t){g.call(this,"form",e,t),e._formId=t.newValue}};var A={removed:v.bind(void 0,"id"),fallback:function(e,t){const i="".concat(t.newValue).concat(d.a);p(e).setAttribute("id",i)}},w={removed:function(e){v.call(this,"value",e),p(e).value="on"},fallback:function(e,t){g.call(this,"value",e,t)}},_={removed:function(e){p(e).checked=!1},fallback:function(e){p(e).checked=!0}},L={removed:function(e){p(e).removeAttribute("aria-label")},fallback:function(e,t){p(e).setAttribute("aria-label",t.newValue)}};var O=Object(r.a)("aui-toggle",{template:o()('<input type="checkbox" class="aui-toggle-input assistive">','<span class="aui-toggle-view">','<span class="aui-toggle-tick aui-icon aui-icon-small aui-iconfont-success"></span>','<span class="aui-toggle-cross aui-icon aui-icon-small aui-iconfont-close-dialog"></span>',"</span>"),created:function(e){p(e),k(e).setAttribute("size",f.a.SMALL.name),Object(a.a)(p(e)).tooltip({title:function(){return this.checked?this.getAttribute("tooltip-on"):this.getAttribute("tooltip-off")},gravity:"s",hoverable:!1}),function(e){p(e).addEventListener("keydown",(function(t){e.busy&&t.keyCode===s.a.SPACE&&t.preventDefault()})),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&p(e).addEventListener("click",(function(t){e.busy&&t.preventDefault()})),Object(c.c)()||(e._input.addEventListener("focus",(()=>e.classList.add("active"))),e._input.addEventListener("blur",(()=>e.classList.remove("active"))))}(e),e.hasAttribute("checked")&&p(e).setAttribute("checked",""),e._canFireEventsNow=!0},attached:function(e){Object(u.a)(e).attributeExists("label")},events:{click:function(e,t){var i=p(e);e.disabled||e.busy||t.target===i||(i.checked=!i.checked,function(e){e._canFireEventsNow&&e.dispatchEvent(new h.a("change",{bubbles:!0}))}(e)),Object(n.b)(e,"checked",i.checked)}},attributes:{id:A,checked:_,disabled:m("disabled"),form:y,name:m("name"),value:w,"tooltip-on":{value:b.a.getText("aui.toggle.on"),fallback:function(e,t){p(e).setAttribute("tooltip-on",t.newValue||b.a.getText("aui.toggle.on"))}},"tooltip-off":{value:b.a.getText("aui.toggle.off"),fallback:function(e,t){p(e).setAttribute("tooltip-off",t.newValue||b.a.getText("aui.toggle.off"))}},label:L},prototype:{focus:function(){return p(this).focus(),this},get checked(){return p(this).checked},set checked(e){p(this).checked!==e&&(p(this).checked=e,Object(n.b)(this,"checked",e))},get disabled(){return p(this).disabled},set disabled(e){return Object(n.b)(this,"disabled",e)},get form(){return document.getElementById(this._formId)},set form(e){return y.fallback.call(this,this,{newValue:e||null}),this.form},get name(){return p(this).name},set name(e){return this.setAttribute("name",e),e},get value(){return p(this).value},set value(e){let t=null===e?"":e;return this.setAttribute("value",t),t},get busy(){return"true"===p(this).getAttribute("aria-busy")},set busy(e){const t=p(this),i=k(this);var c,u;return Object(n.b)(this,"busy",e),e?(t.setAttribute("aria-busy","true"),t.indeterminate=!0,this.checked?(t.classList.add("indeterminate-checked"),Object(a.a)(this.querySelector(".aui-toggle-tick")).append(i)):Object(a.a)(this.querySelector(".aui-toggle-cross")).append(i)):(t.classList.remove("indeterminate-checked"),t.indeterminate=!1,t.removeAttribute("aria-busy"),i.parentNode&&i.parentNode.removeChild(this._spinner)),u=!!e,(c=this).id&&Array.prototype.forEach.call(document.querySelectorAll('aui-label[for="'.concat(c.id,'"]')),(function(e){e.disabled=u})),e}}})}},[["KKmC","runtime","aui.splitchunk.vendors--894c8113d9","aui.splitchunk.vendors--95c789edf5","aui.splitchunk.vendors--9c48cc20a9","aui.splitchunk.vendors--d2297af84a","aui.splitchunk.vendors--be1eb78c1a","aui.splitchunk.0d131bcbf1","aui.splitchunk.fbbef27525","aui.splitchunk.444efc83be","aui.splitchunk.739b9ec8cc","aui.splitchunk.056561461c","aui.splitchunk.949297951c","aui.splitchunk.dd803a46b4","aui.splitchunk.994e478d48","aui.splitchunk.d7c46c2734","aui.splitchunk.e54c7c7304","aui.splitchunk.fb15cffa72","aui.splitchunk.56dfb54d0c","aui.splitchunk.f1e06f97a4","aui.splitchunk.479fe6ee76","aui.splitchunk.9c48cc20a9","aui.splitchunk.908fe798b4","aui.splitchunk.5f851f97df","aui.splitchunk.462ee5f9ef","aui.splitchunk.afa5039e04","aui.splitchunk.26116b3cbd","aui.splitchunk.ed86a19e01","aui.splitchunk.50dca3e042","aui.splitchunk.e5af17b48e","aui.splitchunk.be1eb78c1a","aui.splitchunk.5b7fdbd666","aui.splitchunk.8a641c03a4","aui.splitchunk.86ad04cc86","aui.splitchunk.57d1ac075f","aui.splitchunk.4331a05956"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/miniorange-constants.js' */
var formConstants={"backdoor-form":{"info-note":"Please submit your username to access login page",action:"checkBackdoorAccess"},"redirection-rules-form":{"info-note":"Please submit your username to proceed with login",action:"processRedirectionRules"}};var LOGOUTCOOKIE="mo.confluence-sso.logoutcookie";
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/utility.js' */
function ReadCookie(d){var b=d+"=";var f=document.cookie;var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}function createSSOUrl(b){var d=getQueryParameterByName("os_destination");var f=getQueryParameterByName("webSudoDestination");var a=getQueryParameterByName("destination");var g=AJS.contextPath()+"/plugins/servlet/saml/auth";if(!(!d||/^\s*$/.test(d))&&d!="/"){g+="?return_to="+encodeURIComponent(d)}else{if(!(!f||/^\s*$/.test(f))&&f!="/"){g+="?return_to="+encodeURIComponent(f)}else{if(!(!a||/^\s*$/.test(a))&&a!="/"){g+="?return_to="+encodeURIComponent(a)}else{var e=window.location.href;if(!e.match(/login.action/i)&&!e.match(/dologin.action/i)){g+="?return_to="+encodeURIComponent(window.location.href)}}}}var c=localStorage.getItem("isAdmin");if(g.indexOf("return_to")>0){g+="&isAdmin="+c}else{g+="?isAdmin="+c}if(b){g+="&idp="+b}return g}function backdoorUrlEnteredAndEnabled(a){console.log("checking for backdoor");if(a.backdoorEnabled){console.log("backdoor enabled");var b=getQueryParameterByName(a.backdoorKey);console.log("backdoorValue from query param : "+b);console.log("backdoorValue from configObj : "+a.backdoorValue);if(b===a.backdoorValue){return true}}return false}function getSubmitUsernameFormHtml(a){var b='<div id="username-form-note" class="aui-message aui-message-info">'+a["info-note"]+'</div><form id="submit-username-form" method="post" action="" name="submit-username-form" class="aui gdt"><input type="hidden" id="action" name="action" value="'+a.action+'"/><div class="field-group"><label accesskey="u" for="login-form-email" id="usernamelabel" style="display: block;"><u>U</u>sername/Email</label><input class="text" id="login-form-email" name="mo_username" type="text"/></div><div class="field-group"><button id="submit-username" class="aui aui-button aui-button-primary">Submit</button></div></form>';return b}function insertDelay(f,c,a){var e=createSSOUrl(a);var d=c.loginButtonText;var b='<div id="moRedirectBox" class="aui-message aui-message-info"><p><span id="defaultText">Redirecting to IDP.</span><button id="stopAutoRedirect" onClick="stopAutoRedirect(\''+e+"','"+d+'\')" class="aui-button aui-button-primary" style="float:right;" resolved="">Cancel</button></p><div id="moRedirectProgress" class="aui-progress-indicator" style="margin-top: 1.5em;background: #e9e9e9;border-radius: 3px;height: 5px;overflow: hidden;position: relative;width: 100%;" data-value="0.01"><span class="aui-progress-indicator-value" style="position: absolute;display: block;height: 5px;animation: progressSlide 1s infinite linear;animation-play-state: running;-webkit-animation-play-state: paused;animation-play-state: paused;background: #3572b0;border-radius: 3px 0 0 3px;transition: width .5s;-webkit-transform: skewX(0);transform: skewX(0);width:0%"></span></div></div>';AJS.$("#gadget-0").css("height","355px");AJS.$(b).insertAfter(f);updateProgressBar(0.005,a,f)}function stopAutoRedirect(c,a){AJS.$("#moRedirectBox").remove();var b='<br><div class="buttons-container form-footer" style=""><div class="buttons"><a href="'+c+'" width="100%" id="redirectMessage" class="aui-button aui-button-primary" resolved="">'+a+"</a></div></div>";AJS.$(".aui.login-form-container").append(b)}function updateProgressBar(c,b,d){if(AJS.$("#moRedirectProgress").length===0){return}if(c<0.995){c=c+0.005;var a=c*100+"%";AJS.$("#moRedirectProgress").attr("data-value",c);AJS.$(".aui-progress-indicator-value").css("width",a);setTimeout(updateProgressBar,25,c,b,d)}else{c=0.1;AJS.$("#moRedirectBox").remove();redirectToIDP(d,b)}}function redirectToIDP(d,a){var b='<div class="aui-message aui-message-info"><span>Please wait while we redirect you for authentication...</span><aui-spinner size="medium" style="margin-left: 50%;margin-top: 20px;"></aui-spinner></div>';d.html(b);var c=createSSOUrl(a);window.onbeforeunload=null;window.location.href=c}function showSamlErrorMessage(c){var a=getQueryParameterByName("samlerror");if(a){var b;switch(a){case"cant_signin_no_access":b='<div id="sso_failed_error" class="aui-message aui-message-error closeable"><p>Sorry. It seems like you don\'t have an access to the Application. Please contact your administrator with this message. </p></div>';break;default:b='<div id="sso_failed_error" class="aui-message aui-message-error closeable"><p>We couldn\'t sign you in. Please contact your administrator with this message. </p></div>';break}AJS.$(b).insertBefore(c)}}function checkBackdoorAccess(a){if(a.isUserAllowedBackdoorAccess===true){var e=AJS.$(".aui.login-form-container");AJS.$("#os_username").val(a.usernamePreFill);AJS.$("#backdoor_restriction_note").remove();AJS.$("#submit-username-form").remove();showLoginFormWithoutButtons(e)}else{console.log("access denied");var b='<div id="no_backdoor_access_error" class="aui-message aui-message-error closeable"><p>Sorry. You don\'t have access to this page, Please wait while we redirect you to IDP</p></div><div class="mospinner"><aui-spinner size="large"></aui-spinner></div>';AJS.$("#username-form-note").remove();AJS.$("#submit-username-form").hide();if(!AJS.$("#no_backdoor_access_error").length){AJS.$(b).insertBefore(AJS.$("#submit-username-form"))}var d=window.location.pathname;var c=AJS.contextPath()+"/login.action";setTimeout(function(){window.onbeforeunload=null;window.location.href=c},2000)}}function showLoginFormWithoutButtons(b){AJS.$("#sso_failed_error").remove();var a=AJS.$("#submit-username-form");AJS.$("#username-form-note").remove();a.remove();b.show();showSamlErrorMessage(b)}function getQueryParameterByName(b){var a=window.location.href;b=b.replace(/[\[\]]/g,"\\$&");var d=new RegExp("[?&]"+b+"(=([^&]*)|&|$)"),c=d.exec(a);if(!c){return null}if(!c[2]){return""}return decodeURIComponent(c[2].replace(/\+/g," "))}function renderLoginPage(c,a,b){c++;var d;if(AJS.$(".aui.login-form-container").length>0){d=AJS.$(".aui.login-form-container");localStorage.setItem("isAdmin",a);if(a){processAdminLogin(d,b)}else{processConfluenceLogin(d,b)}}else{if(c<=100){setTimeout(renderLoginPage,100,c,a,b)}}return d}function showCustomLoginForm(a){AJS.$("body").hide();var b="<div>"+a+"</div>";AJS.$("body").html(b);AJS.$("body").show()}function showLoginFormWithButtons(d,b){AJS.$("#sso_failed_error").remove();var c;var a=localStorage.getItem("isAdmin");if(b.ssoEnabledForIdpList.length===0){d.show();showSamlErrorMessage(d);return}if(a==="true"){firstIdpName=ReadCookie(LOGOUTCOOKIE)}else{firstIdpName=b.ssoEnabledForIdpList[0]}if(a==="true"){showAdminLoginFormWithButton(firstIdpName,d,b.loginButtonText);return}if(b.ssoEnabledForIdpList.length>1){c='<hr/><div id="mo_sso_form"><h2>'+b.loginButtonText+'</h2></div><div id="oauth_application_list" style="text-align: center;">';for(i=0;i<b.ssoEnabledForIdpList.length;i++){idpID=b.ssoEnabledForIdpList[i];idpName=b.idpMap[idpID];ssoURL=createSSOUrl(idpID);c+='<div class="buttons">';c+='<a class="aui-button aui-style aui-button-primary" href="'+ssoURL+'"style="align:center;width: 50%;margin-bottom: 2px;margin-top: 2px; margin-left: 0px;"><p style="text-align:center;">'+idpName+"</p></a>";c+="</div>"}c+="</div>"}else{c='<a class="aui-button aui-style aui-button-primary" href="'+createSSOUrl(firstIdpName)+'" style="align:center;">'+b.loginButtonText+"</a>"}if(b.ssoEnabledForIdpList.length>1){AJS.$(c).insertAfter(AJS.$(".aui.login-form-container"))}else{if(b.ssoEnabledForIdpList.length==1){AJS.$(c).insertAfter(AJS.$("#loginButton"))}}showSamlErrorMessage(d)}function showAdminLoginFormWithButton(a,d,b){var c='<a class="aui-button aui-style aui-button-primary" href="'+createSSOUrl(a)+'" style="align:center;">'+b+"</a>";AJS.$(c).insertAfter(AJS.$("#authenticateButton"));showSamlErrorMessage(d)};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/ajaxCalls.js' */
function getConfigurations(){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/getconfig",type:"GET",error:function(){console.log("miniOrange SAML: configuration couldn't be fetched. exiting");return},success:function(a){if(a.enableSAMLSSO){initializeSSO(a)}if(a.enablePasswordChange===false){disablePasswordChange()}}})}AJS.$(document).on("keypress","#login-form-email",function(a){if(a.which!=13){return}a.preventDefault();submitUsernameForm()});AJS.$(document).on("click","#submit-username",function(a){a.preventDefault();submitUsernameForm()});function submitUsernameForm(){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/moapi",data:AJS.$("#submit-username-form").serialize(),type:"GET",async:true,error:function(a){},success:function(a){var b=AJS.$("#action").val();switch(b){case"checkBackdoorAccess":checkBackdoorAccess(a);break;case"processRedirectionRules":processRedirectionRules(a);break}}})};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/process-redirect-rules.js' */
function getRedirectionRules(){var a;AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/moapi",data:{action:"getConfluenceRedirectionRules"},type:"GET",async:false,success:function(b){console.log(JSON.stringify(b));a=b}});return a}function checkAndShowRedirectionRulesForm(d,a){var b=getRedirectionRules();console.log("Redirection Rules "+b);console.log("Size "+Object.keys(b).length);if(Object.keys(b).length>0){d.hide();showSubmitUsernameForm(d,formConstants["redirection-rules-form"]);return}var c=a.defaultConfluenceIDP;if(c==="loginPage"){if(a.enableLoginTemplate===true&&getQueryParameterByName("show_login_form")!="true"){if(a.ssoEnabledForIdpList.length!=0){showCustomLoginForm(a.loginTemplate);return}}if(a.showLoginButtons){showLoginFormWithButtons(d,a)}else{showLoginFormWithoutButtons(d)}return}if(a.enableAutoRedirectDelay){insertDelay(d,a,c);return}redirectToIDP(d,c)}function processRedirectionRules(a){var c=a.idp;if(c==="loginPage"){var d=AJS.$(".aui.login-form-container");showLoginFormWithoutButtons(d);return}if(c==="redirectUrl"){var b=a.defaultRedirectUrl;console.log("Default rule set to redirectUrl. Redirecting to :"+b);window.location.href=b;return}redirectToIDP(AJS.$("#submit-username-form"),c)};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/confluence-admin-sso.js' */
function processAdminLogin(c,a){if(!a.isAdminSSOEnabled){console.log("miniorange-saml: Admin SSO is disabled");return}if(backdoorUrlEnteredAndEnabled(a)){showLoginFormWithoutButtons(c);return}var b=ReadCookie(LOGOUTCOOKIE);if(b){if(a.isAdminRedirectEnabled){if(a.enableAutoRedirectDelay){insertDelay(c,a,b);return}redirectToIDP(c,b);return}else{showLoginFormWithButtons(c,a)}}else{showLoginFormWithoutButtons(c)}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/confluence-sso.js' */
getConfigurations();function initializeSSO(e){var c=window.location.href;var b=["/saml/auth","/saml/getconfig","/saml/logout","/saml/moapi","/samlerror","/forgotuserpassword.action"];var f=new RegExp(b.join("|"),"i");if(f.test(c)){return}if(c.match(/\/login.action/i)&&c.match(/\?logout=true/i)){localStorage.removeItem("isAdmin");if(ReadCookie(LOGOUTCOOKIE)!==""){AJS.$(".aui.login-form-container").hide();var d='<p>Please wait while we log you out...</p><aui-spinner size="medium"></aui-spinner>';AJS.$(d).insertBefore(AJS.$(".aui.login-form-container"));window.location.href=AJS.contextPath()+"/plugins/servlet/saml/logout";return}renderLoginPage(0,false,e)}else{if(c.match(/\/login.action/i)){renderLoginPage(0,false,e)}else{if(c.match(/\/dologin.action/i)){renderLoginPage(0,false,e)}else{if(c.match(/\/authenticate.action/i)){renderLoginPage(0,true,e)}else{if(e.allowAnonymousAccess||!e.isGuestCookieExpired){return}if(AJS.params.remoteUser!==""&&AJS.params.remoteUser!==null){return}var g=window.location.pathname;var a=g.replace(AJS.contextPath(),"");window.location.href=AJS.contextPath()+"/login.action?os_destination="+encodeURIComponent(a+window.location.search)}}}}}function processConfluenceLogin(b,a){if(backdoorUrlEnteredAndEnabled(a)){if(a.restrictBackdoor){console.log("backdoor restriction enabled");showSubmitUsernameForm(b,formConstants["backdoor-form"]);return}else{showLoginFormWithoutButtons(b);return}}if(a.enableLoginTemplate===true&&getQueryParameterByName("show_login_form")!="true"){if(a.ssoEnabledForIdpList.length!=0){console.log("show custom login template");showCustomLoginForm(a.loginTemplate);return}else{showLoginFormWithoutButtons(b);return}}if(getQueryParameterByName("moskipsso")=="true"){showLoginFormWithoutButtons(b);return}checkAndShowRedirectionRulesForm(b,a)}function showSubmitUsernameForm(c,a){var b=getSubmitUsernameFormHtml(a);AJS.$(b).insertAfter(c);c.hide();showSamlErrorMessage(AJS.$("#submit-username-form"))}function hideChangePasswordlogin(a){if(AJS.$("#forgot-password").length>0){AJS.$("#forgot-password").remove()}else{if(a<50){a++;setTimeout(hideChangePasswordlogin,100,a)}}}function disablePasswordChange(){var c=window.location.pathname;var b=c.match(/\/forgotuserpassword.action/i);var a=c.match(/\/changemypassword.action/i);if(b){window.location.href=AJS.contextPath()+"/login.action";return}else{if(a){window.location.href=AJS.contextPath()+"/users/viewmysettings.action";return}}b=c.match(/\/login.action/i);a=c.match(/\/viewmysettings.action/i);if(b){hideChangePasswordlogin(0)}else{if(a){hideChangePasswordprofile(0)}}}function hideChangePasswordprofile(b){if(document.querySelector("a[title=Password]")){var a=document.querySelector("a[title=Password]");a.parentElement.remove()}else{if(b<50){b++;setTimeout(hideChangePasswordprofile,100,b)}}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.miniorange.sso.saml.confluence-sso:samlsso.plugin.admin.resources', location = 'js/customcerts.js' */
AJS.$(function(){var b=window.location.pathname;if((AJS.params.remoteUser!="")&&(b.indexOf("/authenticate.action")>-1)&&(b.indexOf("/confluence-sso")===-1)){a()}if(b.indexOf("/confluence-sso")>-1){a()}AJS.$(".aui-nav li").removeClass("aui-nav-selected");AJS.$("#mo-custom-certs").addClass("aui-nav-selected");AJS.$("#mo-saml").addClass("aui-nav-selected");AJS.$("#dialog-show-button-cert").click(function(c){c.preventDefault();AJS.dialog2("#newcert-dialog").show()});AJS.$("#dialog-submit-button-cert").click(function(c){c.preventDefault();AJS.dialog2("#newcert-dialog").hide()});AJS.$("#dialog-close-button-cert").click(function(c){location.reload(false)});AJS.$(document).on("click","#hide_certificate_warning",function(){var c=document.getElementsByClassName("aui-flag");for(var d=c.length-1;d>=0;d--){c[d].remove()}localStorage.setItem("doNotRemindMe","true")});AJS.$("#generate-cert").on("click",function(c){AJS.flag({title:"Operation running",type:"info",close:"never",body:'<p>Please wait. Generating certificates....</p><p><aui-spinner size="large"></aui-spinner></p>'});AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert?emailAdsress="+encodeURIComponent(AJS.$("#emailAdsress").val())+"&companyName="+encodeURIComponent(AJS.$("#companyName").val())+"&orgUnit="+encodeURIComponent(AJS.$("#orgUnit").val())+"&locationName="+encodeURIComponent(AJS.$("#locationName").val())+"&countryCode="+encodeURIComponent(AJS.$("#countryCode").val())+"&validityDays="+encodeURIComponent(AJS.$("#validityDays").val()),data:{action:"gennewcert"},type:"GET",error:function(e){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Error",type:"error",close:"auto",body:"<p>Something went wrong, please fill all the details.</p>"})},success:function(e){if(e.resultStatus===true){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Success",type:"success",close:"auto",body:"<p>Certificates generated successfully. Please update the public key in your IDP.</p>"})}}})});AJS.$("#revert-new-cert").on("click",function(c){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert",data:{action:"revertnewcert"},type:"GET",error:function(e){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Error",type:"error",close:"auto",body:"<p>Please check new certificate details.</p>"})},success:function(e){if(e.result===true){var d=document.getElementsByClassName("aui-flag");for(var g=d.length-1;g>=0;g--){d[g].remove()}var f=window.location.href;if((f.indexOf("?")>-1)&&(f.indexOf("operation=updated")===-1)){f+="&operation=updated"}else{if(f.indexOf("operation=updated")===-1){f+="?operation=updated"}}window.location.href=f}}})});AJS.$("#replace-new-cert").on("click",function(c){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert",data:{action:"revertnewcert"},type:"GET",error:function(e){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Error",type:"error",close:"auto",body:"<p>Please check new certificate details.</p>"})},success:function(e){if(e.result===true){var d=document.getElementsByClassName("aui-flag");for(var g=d.length-1;g>=0;g--){d[g].remove()}var f=window.location.href;if((f.indexOf("?")>-1)&&(f.indexOf("operation=updated")===-1)){f+="&operation=updated"}else{if(f.indexOf("operation=updated")===-1){f+="?operation=updated"}}window.location.href=f}}})});AJS.$("#revert-old-cert").on("click",function(c){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert",data:{action:"revertoldcert"},type:"GET",error:function(e){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Error",type:"error",close:"auto",body:"<p>Please re-try something went wrong.</p>"})},success:function(e){if(e.status===true){var d=document.getElementsByClassName("aui-flag");for(var g=d.length-1;g>=0;g--){d[g].remove()}var f=window.location.href;if((f.indexOf("?")>-1)&&(f.indexOf("operation=updated")===-1)){f+="&operation=updated"}else{if(f.indexOf("operation=updated")===-1){f+="?operation=updated"}}window.location.href=f}}})});AJS.$("#revert-old-configured-cert").on("click",function(c){AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert",data:{action:"revertoldconfiguredcert"},type:"GET",error:function(e){var d=document.getElementsByClassName("aui-flag");for(var f=d.length-1;f>=0;f--){d[f].remove()}AJS.flag({title:"Error",type:"error",close:"auto",body:"<p>Please re-try something went wrong.</p>"})},success:function(e){if(e.status===true){var d=document.getElementsByClassName("aui-flag");for(var g=d.length-1;g>=0;g--){d[g].remove()}var f=window.location.href;if((f.indexOf("?")>-1)&&(f.indexOf("operation=updated")===-1)){f+="&operation=updated"}else{if(f.indexOf("operation=updated")===-1){f+="?operation=updated"}}window.location.href=f}}})});function a(){var c=localStorage.getItem("doNotRemindMe");AJS.$.ajax({url:AJS.contextPath()+"/plugins/servlet/saml/mogencert",type:"GET",data:{action:"getdays"},error:function(){},success:function(e){var d=e.days;if((d<60)&&(c!="true")){AJS.flag({title:"Attention!",type:"warning",body:"<p>miniOrange SAML SSO certificates are due to expire in "+d+' days. Kindly update the certificate in the <a class="aui-button aui-button-link" href="/admin/plugins/confluence-sso/customcerts.action">Certificates</a> tab as well as in your IDP. Single Sign-On will not work after '+d+' days.</p><br><a id="hide_certificate_warning" class="aui-button">Do not remind me again</a>'})}}})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'js/space-menu.js' */
AJS.toInit(function(a){var b=a(Confluence.Templates.BrowseSpaces.spacesLink());a("#space-directory-link").replaceWith(a(b));var d=function(b){var c=a("#space-menu-link-content");c.html(b.template);AJS&&AJS.Confluence&&AJS.Confluence.Analytics&&AJS.Confluence.Analytics.setAnalyticsSource&&AJS.Confluence.Analytics.setAnalyticsSource(c.find("a"),"spacemenu");a("#create-space-header").click(function(){AJS.trigger("analytics",{name:"create-space-from-header"});Confluence.SpaceBlueprint.Dialog.launch();
return!1})};a("#space-menu-link-content").on("aui-dropdown2-show",function(){AJS.trigger("analytics",{name:"open-space-menu"});a("#space-menu-link-content .aui-dropdown2-section")&&a("#space-menu-link-content .aui-dropdown2-section").length||a.ajax({url:Confluence.getContextPath()+"/rest/ia/1.0/spacesmenu",type:"GET",dataType:"json",cache:!1,success:d});return!1})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'soy/space-menu.soy' */
// This file was automatically generated from space-menu.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.BrowseSpaces.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.BrowseSpaces == 'undefined') { Confluence.Templates.BrowseSpaces = {}; }


Confluence.Templates.BrowseSpaces.spacesLink = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.trigger({menu: {id: 'space-menu-link-content'}, id: 'space-menu-link', tagName: 'a', extraClasses: 'aui-nav-link', title: 'Spaces', showIcon: false, text: 'Spaces'}) + aui.dropdown2.contents({id: 'space-menu-link-content', extraClasses: 'aui-style-default aui-dropdown2-in-header'});
};
if (goog.DEBUG) {
  Confluence.Templates.BrowseSpaces.spacesLink.soyTemplateName = 'Confluence.Templates.BrowseSpaces.spacesLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:space-ia-analytics', location = 'js/space-ia-analytics.js' */
(function(f){function d(){var a=f(".acs-side-bar"),b=a.find("a:not(.external_link a, #acs-configure-link)");c(b,"sidebar");b=a.find("[data-collapsed-tooltip\x3d'"+AJS.I18n.getText("Pages")+"']");c(b,"sidebar-pages");b=a.find("[data-collapsed-tooltip\x3d'"+AJS.I18n.getText("Blog")+"']");c(b,"sidebar-blogs");b=a.find(".quick-links-section li:not(.external_link) a");c(b,"spaceshortcut");b=a.find(".ia-secondary-container a:not(.more-children-link)");"pages"==a.find(".ia-secondary-container").data("tree-type")?
c(b,"contextnavchildmode"):"page-tree"==a.find(".ia-secondary-container").data("tree-type")?c(b,"contextnavpagetreemode"):c(b,"contextnav")}function e(a){return function(){AJS.trigger("analytics",{name:"space-ia-nav",data:{linkType:a}})}}var c=AJS.Confluence.Analytics.setAnalyticsSource;AJS.toInit(function(a){a(".acs-side-bar").find(".ia-secondary-container .more-children-link").click(e("context-nav.more-children"));AJS.bind("sidebar.exit-configure-mode",d);AJS.bind("sidebar.flyout-triggered",function(b,
a){e("flyout-triggered."+a.flyout)()});AJS.bind("pagetree-children-loaded",d);d()})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:persistable', location = 'js/persistable.js' */
define("confluence/persistable",["skate","confluence/storage-manager"],function(f,g){var d=g("confluence","userSettings");return f("data-persist",{type:f.types.ATTRIBUTE,created:function(b){if(!b.name)throw'Missing attribute "name"';var c=b.getAttribute("data-persist"),a=b.getAttribute("data-persist-scope"),a=a?b.name+"."+a.replace(/\./g,"-"):b.name,a=d.getItem(a),e=b.getAttribute("data-default-value");if(/value|checked/.test(c))a=a||e||null,null!==a&&("checked"===c&&(a="true"===a),b[c]=a);else throw"Persistable only works with 'value' or 'checked' attributes!";
},events:{change:function(b){var c=b.getAttribute("data-persist"),a=b.getAttribute("data-persist-scope"),a=a?b.name+"."+a.replace(/\./g,"-"):b.name,e=b.getAttribute("data-default-value");String(b[c])===e?d.removeItem(a):d.setItem(a,b[c],2592E3)}}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-quicknav:quicknav-resources', location = 'js/quick-nav.js' */
define("confluence-quicknav/quick-nav",["jquery","confluence/api/logger"],function(b,l){var f=[],d,g=function(a){return function(e){a.closest("form").find(".quick-nav-drop-down").append(e)}},h=function(a){"undefined"!==typeof a?f.push(a):l.log("WARN: Attempted to add a dropdown post-process function that was undefined.")},m=function(a){b("a",a).each(function(){var a=b(this),c=a.find("span").data("properties");(c=c?c.spaceName:null)&&!a.is(".content-type-spacedesc")&&(a.after(a.clone().attr("class",
"space-name").html(c)),a.parent().addClass("with-space-name"))})};return{addDropDownPostProcess:h,setMakeParams:function(a){d=a},init:function(){var a=b("#quick-search-query"),e=g(a),c=b("#space-blog-quick-search-query"),k=b("#confluence-space-key");a.quicksearch("/rest/quicknav/1/search",null,{dropdownPlacement:e,dropdownPostprocess:function(a){b.each(f,function(c,b){b&&b(a)})},makeParams:function(a){return d?d(a):{query:a}},ajsDropDownOptions:{className:"quick-search-dropdown"}});h(m);c.length&&
k.length&&c.quicksearch("/rest/quicknav/1/search?type\x3dblogpost\x26spaceKey\x3d"+b("\x3ci\x3e\x3c/i\x3e").html(k.attr("content")).text(),null,{dropdownPlacement:g(c)})}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quicknav/quick-nav","Confluence.QuickNav");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources', location = '/js/confluence-license-banner.js' */
require(["ajs","jquery"],function(a,c){a.toInit(function(){var e=WRM.data.claim("com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details");if(e){var d={destroyBanner:function(){c("#license-banner").slideUp(function(){c("#license-banner").remove()})},remindMeLater:function(){c.ajax({type:"POST",dataType:"json",contentType:"application/json; charset\x3dutf-8",data:JSON.stringify({atl_token:a.Meta.get("atl-token")}),url:a.contextPath()+"/rest/licensebanner/1.0/reminder/later"});
d.destroyBanner()},remindMeNever:function(){c.ajax({type:"POST",dataType:"json",contentType:"application/json; charset\x3dutf-8",data:JSON.stringify({atl_token:a.Meta.get("atl-token")}),url:a.contextPath()+"/rest/licensebanner/1.0/reminder/never"});d.destroyBanner()},createBanner:function(b){var a;b.showLicenseExpiryBanner?a=Confluence.Templates.LicenseBanner.expiryBanner({days:b.daysBeforeLicenseExpiry,mac:b.renewUrl,sales:b.salesUrl}):b.showMaintenanceExpiryBanner&&(a=Confluence.Templates.LicenseBanner.maintenanceBanner({days:b.daysBeforeMaintenanceExpiry,
mac:b.renewUrl,sales:b.salesUrl}));a&&(b=c(a),c("#full-height-container").prepend(b),c("#license-banner-later").click(function(a){a.preventDefault();d.remindMeLater()}),c("#license-banner-never").click(function(a){a.preventDefault();d.remindMeNever()}),b.find(".icon-close").click(function(a){a.preventDefault();d.remindMeLater()}))}};d.createBanner(e)}else a.warn("Unable to claim my required data")})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources', location = 'soy/confluence-license-banner.soy' */
// This file was automatically generated from confluence-license-banner.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.LicenseBanner.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.LicenseBanner == 'undefined') { Confluence.Templates.LicenseBanner = {}; }


Confluence.Templates.LicenseBanner.wrapper = function(opt_data, opt_ignored) {
  return '<div>' + soy.$$filterNoAutoescape(opt_data.contentHTML) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.wrapper.soyTemplateName = 'Confluence.Templates.LicenseBanner.wrapper';
}


Confluence.Templates.LicenseBanner.expiryBanner = function(opt_data, opt_ignored) {
  var output = '';
  var renewTag__soy8 = '<a id="license-banner-my-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.mac) + '">';
  var end__soy12 = '</a>';
  var mailTag__soy14 = '<a id="license-banner-sales-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.sales) + '">';
  output += Confluence.Templates.LicenseBanner.wrapper({contentHTML: '' + aui.message.warning({content: '<div id="license-banner-content" data-days="' + soy.$$escapeHtml(opt_data.days) + '" data-subscription="true">' + ((opt_data.days < 0) ? soy.$$filterNoAutoescape(AJS.format('Your subscription has expired. This site is now read-only. To keep using Confluence, {0}renew online{1} or {2}contact us{3}.',renewTag__soy8,end__soy12,mailTag__soy14,end__soy12)) : (opt_data.days == 0) ? soy.$$filterNoAutoescape(AJS.format('Your subscription will expire today and your site will become read-only. To keep using Confluence, {0}renew online{1} or {2}contact us{3}.',renewTag__soy8,end__soy12,mailTag__soy14,end__soy12)) : soy.$$filterNoAutoescape(AJS.format('Your subscription will expire in {0,choice,1#{0} day|1\x3c{0} days}. Your site will become read-only after the expiry. To keep using Confluence, {1}renew online{2} or {3}contact us{4}.',opt_data.days,renewTag__soy8,end__soy12,mailTag__soy14,end__soy12))) + '</div>', isCloseable: opt_data.days > 7, id: 'license-banner'})});
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.expiryBanner.soyTemplateName = 'Confluence.Templates.LicenseBanner.expiryBanner';
}


Confluence.Templates.LicenseBanner.maintenanceBanner = function(opt_data, opt_ignored) {
  var output = '';
  var renewTag__soy39 = '<a id="license-banner-my-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.mac) + '">';
  var end__soy43 = '</a>';
  var later__soy45 = '<a href="#" id="license-banner-later">';
  var never__soy47 = '<a href="#" id="license-banner-never">';
  output += Confluence.Templates.LicenseBanner.wrapper({contentHTML: '' + aui.message.warning({content: '<div id="license-banner-content" data-days="' + soy.$$escapeHtml(opt_data.days) + '" data-subscription="false">' + ((opt_data.days < 0) ? soy.$$filterNoAutoescape(AJS.format('You no longer have access Support and Updates. {0}Renew online{1}, {2}remind me later{3} or {4}never remind me again{5}.',renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43)) : (opt_data.days == 0) ? soy.$$filterNoAutoescape(AJS.format('You will lose access to Support and Updates today. {0}Renew online{1}, {2}remind me later{3} or {4}never remind me again{5}.',renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43)) : soy.$$filterNoAutoescape(AJS.format('You will lose access to Support and Updates in {0,choice,1#{0} day|1\x3c{0} days}. {1}Renew online{2}, {3}remind me later{4} or {5}never remind me again{6}.',opt_data.days,renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43))) + '</div>', id: 'license-banner'})});
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.maintenanceBanner.soyTemplateName = 'Confluence.Templates.LicenseBanner.maintenanceBanner';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics.js' */
(function(){var a=window.BrowserMetrics||{};a.isFunction=function(b){return !!(b&&b.constructor&&b.call&&b.apply)};a.isEnabled=function(){if(a.enabled===undefined){a.enabled=true}return a.enabled};window.BrowserMetrics=a}());(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var f=5;var e=12000;var c=function(g){return Math.round(g)};var a=function(g){return Math.round(g*100)/100};var d=function(k){var h=(function(){var n=/^(\w+):\/\/([^\/]*)(.*)$/;return function(p){var o=p.match(n);if(!o){return{path:p}}return{scheme:o[1],host:o[2],path:o[3]}}}());var i=(function(){var n=["secureConnectionStart","requestStart","responseStart","responseEnd","domContentLoadedEventStart","domContentLoadedEventEnd","loadEventEnd"];return function(o){if(k.performance){var s=k.performance.timing;var p=s.navigationStart;if(p){for(var r=0;r<n.length;++r){var q=n[r];var t=s[q];if(t){o(q,t-p)}}}}}}());var g=(function(){var o=[{key:"LOGIN",pattern:/^\/login.*/i},{key:"J-DASH",pattern:/^\/secure\/dashboard\.jspa.*/i},{key:"J-ISSUE",pattern:/^\/browse\/\w+\-\w+.*/i},{key:"J-NAV",pattern:/^\/issues.*/i},{key:"J-RAPID",pattern:/secure\/rapidboard\.jspa/i},{key:"SD-AGENT",pattern:/^(\/\w+)?\/servicedesk\/agent\/.*/i},{key:"SD-CUSTOMER",pattern:/^(\/\w+)?\/servicedesk\/customer\/.*/i},{key:"C-DASH",pattern:/^\/wiki(\/)?(\?.*|#.*)?$/i},{key:"C-DASH",pattern:/^\/wiki\/dashboard\.action.*$/i},{key:"C-SPACE",pattern:/^\/wiki\/display\/\w+(\?.*|#.*)?$/i},{key:"C-PAGE",pattern:/^\/wiki\/display\/\w+\/.*/i},{key:"C-PAGE",pattern:/^\/wiki\/pages\/viewpage\.action.*/i},{key:"C-BLOG",pattern:/^\/wiki\/display\/~\w+\/\d+\/\d+\/\d+\/.*/i},{key:"C-EDITOR",pattern:/^\/wiki\/pages\/editpage\.action.*/i},{key:"C-CREATE",pattern:/^\/wiki\/pages\/createpage\.action.*/i}];return function n(){var r=h(k.location.href).path;for(var p=0;p<o.length;++p){var q=o[p];if(r.match(q.pattern)){return q.key}}return null}}());function j(){var n=g();if(n){i(function(p,r){var o="browser.metrics."+p,q={version:f,page:n,value:r>e?"x":Math.ceil((r)/100),rawValue:c(r)};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent(o,q):AJS.trigger("analyticsEvent",{name:o,data:q})})}}function m(){try{j()}catch(n){if(window.console){window.console.log("Error reporting browser metrics: "+n)}}}function l(){if(k.performance.timing.loadEventEnd){m()}else{setTimeout(l,1000)}}if(k.performance&&k.performance.timing){l()}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initPageLoad=d}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics-events.js' */
(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var e=5;var d=12000;var a=function(f){return Math.round(f*100)/100};var c=function(g){var l={};function h(){return g.performance&&g.performance.now?g.performance.now():new Date().getTime()}function n(o){return o===Object(o)}function k(o){if(n(o)){return o.eventName+"."+o.eventType}else{return o}}function m(o){if(n(o)){return o.eventName}else{return o}}function j(o){if(n(o)){return o.eventType}else{return""}}function f(o){var p=k(o);l[p]=h()}function i(r,u){var v=k(r);if(!l[v]){throw ("Error logging browser metrics event end: no start event for key '"+v+"'")}var t=h()-l[v];l[v]=null;var o=m(r),q=j(r);var p="browser.metrics.e."+o+(u?"."+u:""),s={version:e,value:t>d?"x":Math.ceil((t)/100),rawValue:a(t),eventType:q};g.AJS.Analytics?g.AJS.Analytics.triggerPrivacyPolicySafeEvent(p,s):g.AJS.trigger("analyticsEvent",{name:p,data:s})}return{start:f,end:i}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initEvents=c}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics-init.js' */
(function(){var a=window.BrowserMetrics||{};if(a.isEnabled()){if(Math.random()<0.1){window.ATL_PERF&&window.ATL_PERF.initPageLoad&&window.ATL_PERF.initPageLoad(window)}window.ATL_PERF&&window.ATL_PERF.initEvents&&(function(){window.BrowserMetrics=window.ATL_PERF.initEvents(window)}())}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:clickable-resources', location = 'js/clickable.js' */
jQuery(function($) {
    $(".clickable").live("click", function(event) {
        // Ensure we don't override any normal links or nested clickables within the clickable element
        if ($(event.target).closest("a[href]").length === 0 && $(event.target).closest(".clickable").length === 1) {
            // Use the href from the clickable element or the first nested link
            var href = $(this).attr("href") || $('a[href]:first', this).attr("href");
            if (href) {
                location.href = href;
            }
        }
    });
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:alert-resources', location = 'js/alert.js' */
AJS.toInit(function () {

    AJS.$(".adaptavist-alert").each(function () {

        var title = $(this).attr('title');
        var type = $(this).attr('type').toLowerCase();
        var content = $(this).attr('contentBody');

        require('aui/flag')({
            type: type,
            title: title,
            body: content
        });
    });

});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:rollover-resource', location = 'js/rollover.js' */
AJS.toInit(function () {

    var allRolloverMacros = AJS.$('.rollover-parameters');
    function validateUrl(url) {
        const regex = /((http(s):\/\/.))|((www\.))[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;
        return regex.test(url);
    }

    function checkForHTTP(url){
        const http = /http(s):\/\/./g;
        if (!http.test(url)){
            return "https://" + url 
        }
        return url;
    }

    AJS.$.each(allRolloverMacros, function (index, macro) {
        var targetID = macro.getAttribute('targetid');
        var normalClass = macro.getAttribute('normal-class');
        var overClass = macro.getAttribute('over-class');

        var targetElement = AJS.$('#' + targetID);
        var link = allRolloverMacros[index].getAttribute("rollover-link");

        if (targetID != null) {
            targetElement.addClass(normalClass);
            if (!(overClass === "${overClass}")) {
                targetElement.hover(
                    function () {
                        AJS.$(this).removeClass(normalClass);
                        AJS.$(this).addClass(overClass);
                    }, function () {
                        AJS.$(this).removeClass(overClass);
                        AJS.$(this).addClass(normalClass);
                    }
                );
            }

            if (validateUrl(link)) {
                targetElement.html('<a class="external-link rolloverLink" rel="nofollow" href="" >' + targetElement.text() + '</a>');
                targetElement.children().attr('href', checkForHTTP(link));
            }
        }
    });
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:split_aui.pattern.multi-step-progress', location = 'aui.chunk.603288689c64b52b8c56--2fafcbebdc89d8037336.js' */
(window.__auiJsonp=window.__auiJsonp||[]).push([["aui.pattern.multi-step-progress"],{qc5q:function(i,u,n){"use strict";n.r(u);n("FStl"),n("Q0fs"),n("nqD9")}},[["qc5q","runtime","aui.splitchunk.fbbef27525","aui.splitchunk.056561461c","aui.splitchunk.949297951c"]]]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:cfm-blueprint-wizard', location = 'soy/blueprint/wizard-page1.soy' */
// This file was automatically generated from wizard-page1.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace CFM.Blueprints.
 */

if (typeof CFM == 'undefined') { var CFM = {}; }
if (typeof CFM.Blueprints == 'undefined') { CFM.Blueprints = {}; }


CFM.Blueprints.cfmBlueprintWizardPage1 = function(opt_data, opt_ignored) {
  return '<div class="aui-group"><div class="aui-item wizard-page-left"><form name="cfm-wizard-page-one" action="#" method="post" class="aui"><fieldset><div class="cfm-wizard-description">' + soy.$$escapeHtml('This wizard provides the ability to quick start a page that uses selected Content Formatting macros.') + '</div><div class="cfm-page-title-padding"><label for="text-input">Page title<span class="aui-icon icon-required cfm-req">required</span></label><input class="text medium-field" type="text" id="cfm-page-title" name="title" title="title"></input></div><div><label for="cfm-blueprints-dropdown" class="blueprints-label-padding">Templates</label><!-- Trigger --><a href="#cfm-blueprints-dropdown-trigger" aria-owns="cfm-blueprints-dropdown" aria-haspopup="true" class="aui-button aui-style-default aui-dropdown2-trigger cfm-blueprints-dropdown-text">Selection</a><!-- Dropdown --><div id="cfm-blueprints-dropdown" class="aui-style-default aui-dropdown2"><div class="aui-dropdown2-section"><ul><li class="cfm-blueprint-selected"><a href="#1mpj">Multi-Page Journey</a></li><li class="cfm-blueprint-selected"><a href="#2shp">Space Home Page</a></li><li class="cfm-blueprint-selected"><a href="#3f">Finance</a></li><li class="cfm-blueprint-selected"><a href="#4a">Academic</a></li><li class="cfm-blueprint-selected"><a href="#5b">Blog</a></li><li class="cfm-blueprint-selected"><a href="#6sr">Software Requirements</a></li></ul></div></div></div><div class="cfm-blueprint-description">' + soy.$$escapeHtml('Start by entering a page Title and selecting a template from the dropdown.') + '</div></fieldset></form></div><div class="cfm-vertical-line"></div><div class="aui-item"><div class="cfm-blueprints-picture">&nbsp;</div></div></div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.cfmBlueprintWizardPage1.soyTemplateName = 'CFM.Blueprints.cfmBlueprintWizardPage1';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:cfm-wizard-resources', location = 'soy/blueprint/wizard-page1.soy' */
// This file was automatically generated from wizard-page1.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace CFM.Blueprints.
 */

if (typeof CFM == 'undefined') { var CFM = {}; }
if (typeof CFM.Blueprints == 'undefined') { CFM.Blueprints = {}; }


CFM.Blueprints.cfmBlueprintWizardPage1 = function(opt_data, opt_ignored) {
  return '<div class="aui-group"><div class="aui-item wizard-page-left"><form name="cfm-wizard-page-one" action="#" method="post" class="aui"><fieldset><div class="cfm-wizard-description">' + soy.$$escapeHtml('This wizard provides the ability to quick start a page that uses selected Content Formatting macros.') + '</div><div class="cfm-page-title-padding"><label for="text-input">Page title<span class="aui-icon icon-required cfm-req">required</span></label><input class="text medium-field" type="text" id="cfm-page-title" name="title" title="title"></input></div><div><label for="cfm-blueprints-dropdown" class="blueprints-label-padding">Templates</label><!-- Trigger --><a href="#cfm-blueprints-dropdown-trigger" aria-owns="cfm-blueprints-dropdown" aria-haspopup="true" class="aui-button aui-style-default aui-dropdown2-trigger cfm-blueprints-dropdown-text">Selection</a><!-- Dropdown --><div id="cfm-blueprints-dropdown" class="aui-style-default aui-dropdown2"><div class="aui-dropdown2-section"><ul><li class="cfm-blueprint-selected"><a href="#1mpj">Multi-Page Journey</a></li><li class="cfm-blueprint-selected"><a href="#2shp">Space Home Page</a></li><li class="cfm-blueprint-selected"><a href="#3f">Finance</a></li><li class="cfm-blueprint-selected"><a href="#4a">Academic</a></li><li class="cfm-blueprint-selected"><a href="#5b">Blog</a></li><li class="cfm-blueprint-selected"><a href="#6sr">Software Requirements</a></li></ul></div></div></div><div class="cfm-blueprint-description">' + soy.$$escapeHtml('Start by entering a page Title and selecting a template from the dropdown.') + '</div></fieldset></form></div><div class="cfm-vertical-line"></div><div class="aui-item"><div class="cfm-blueprints-picture">&nbsp;</div></div></div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.cfmBlueprintWizardPage1.soyTemplateName = 'CFM.Blueprints.cfmBlueprintWizardPage1';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:cfm-wizard-resources', location = 'soy/blueprint/wizard-page2.soy' */
// This file was automatically generated from wizard-page2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace CFM.Blueprints.
 */

if (typeof CFM == 'undefined') { var CFM = {}; }
if (typeof CFM.Blueprints == 'undefined') { CFM.Blueprints = {}; }


CFM.Blueprints.cfmBlueprintWizardPage2 = function(opt_data, opt_ignored) {
  return '<div class="aui-group cfm-dialog-no-scroll"><div class="aui-item"><form name="cfm-wizard-page-two" action="#" method="post" class="aui"><fieldset class="rows"><div class="cfm-wizard-description">' + soy.$$escapeHtml('Please add the additional page or pages required for the Multi-Page Journey template.') + '</div><div class="aui-group"><div class="aui-item create-button-rows"><div class="cfm-wizard-page-two-validation"></div><table class="aui" id="cfm-wizard-dataTable"><thead><tr><th>Page Title</th><th>Actions</th></tr></thead><tbody><tr id="groupRow0"><td class="cfm-input-field"><input id="cfm-page-title-input-0" class="text buttonInputLabel" type="text" value="" required="required" tabindex="10"/></td><td class="cfm-actions"><input type="button" class="aui-button cfmAddPageTitleRowInput" value="+" data-row-index="0" tabindex="10"/><input type="button" class="aui-button cfmRemovePageTitleRowInput" data-row-index="0" value="-" tabindex="10" disabled/></td></tr></tbody></table></div></div></fieldset></form></div></div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.cfmBlueprintWizardPage2.soyTemplateName = 'CFM.Blueprints.cfmBlueprintWizardPage2';
}


CFM.Blueprints.addPageTitleRow = function(opt_data, opt_ignored) {
  return '<tr id="groupRow' + soy.$$escapeHtml(opt_data.rowIndex) + '"><td class="cfm-input-field"><input id="cfm-page-title-input-' + soy.$$escapeHtml(opt_data.rowIndex) + '" class="text buttonInputLabel" type="text" value="" required="required" tabindex="10"/></td><td class="cfm-actions"><input type="button" class="aui-button cfmAddPageTitleRowInput" value="+" data-row-index="' + soy.$$escapeHtml(opt_data.rowIndex) + '" tabindex="10"/><input type="button" class="aui-button cfmRemovePageTitleRowInput" data-row-index="' + soy.$$escapeHtml(opt_data.rowIndex) + '" value="-" tabindex="10"/></td></tr>';
};
if (goog.DEBUG) {
  CFM.Blueprints.addPageTitleRow.soyTemplateName = 'CFM.Blueprints.addPageTitleRow';
}


CFM.Blueprints.addDuplicateValidationMessage = function(opt_data, opt_ignored) {
  return '<div class="cfm-invalid-page-title">' + soy.$$escapeHtml('Each title must be unique') + '</div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.addDuplicateValidationMessage.soyTemplateName = 'CFM.Blueprints.addDuplicateValidationMessage';
}


CFM.Blueprints.addExistsValidationMessage = function(opt_data, opt_ignored) {
  return '<div class="cfm-invalid-page-title">' + soy.$$escapeHtml('A page with this title already exists') + '</div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.addExistsValidationMessage.soyTemplateName = 'CFM.Blueprints.addExistsValidationMessage';
}


CFM.Blueprints.addEmptyValidationMessage = function(opt_data, opt_ignored) {
  return '<div class="cfm-invalid-page-title">' + soy.$$escapeHtml('This field can not be empty') + '</div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.addEmptyValidationMessage.soyTemplateName = 'CFM.Blueprints.addEmptyValidationMessage';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:cfm-wizard-resources', location = 'soy/blueprint/wizard-page3.soy' */
// This file was automatically generated from wizard-page3.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace CFM.Blueprints.
 */

if (typeof CFM == 'undefined') { var CFM = {}; }
if (typeof CFM.Blueprints == 'undefined') { CFM.Blueprints = {}; }


CFM.Blueprints.cfmBlueprintWizardPage3 = function(opt_data, opt_ignored) {
  return '<div class="aui-group cfm-wizard-page-two"><div class="cfm-wizard-description">' + soy.$$escapeHtml('You finished the wizard setup successfully. Click create to get started with your template.') + '</div></div><div class="aui-item"><div class="cfm-blueprints-picture-complete">&nbsp;</div></div>';
};
if (goog.DEBUG) {
  CFM.Blueprints.cfmBlueprintWizardPage3.soyTemplateName = 'CFM.Blueprints.cfmBlueprintWizardPage3';
}


CFM.Blueprints.docoLink = function(opt_data, opt_ignored) {
  return '<a class="add-remove-customise-templates-trigger button-panel-link" href="https://www.adaptavist.com/doco/display/CFP/Templates" tabindex="-1">' + soy.$$escapeHtml('Documentation') + '</a>';
};
if (goog.DEBUG) {
  CFM.Blueprints.docoLink.soyTemplateName = 'CFM.Blueprints.docoLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.adaptavist.confluence.contentFormattingMacros:cfm-wizard-resources', location = 'js/blueprint-wizard.js' */
AJS.toInit(function ($) {

    var selectedBlueprint;
    var pageTwoData = {};
    var rowIndex = 1;
    var stepTwoTitles = [];

    function handleWizardPage1Submit(e, state) {
        var pageOneValidationElement = $('.cfm-blueprint-description');
        if (!state.pageData.title) {
            pageOneValidationElement.text("Please enter a unique page title");
            addValidationStyling(pageOneValidationElement);
            return false;
        }

        if (doesPageExist(state.pageData.title, state.wizardData.spaceKey)) {
            pageOneValidationElement.text("Page title already exists, please enter a unique title");
            addValidationStyling(pageOneValidationElement);
            return false;
        }

        if (!selectedBlueprint) {
            pageOneValidationElement.text("Please select a template from the dropdown");
            addValidationStyling(pageOneValidationElement);
            return false;
        }

        state.pageData.userSelectedBlueprint = selectedBlueprint;
        if (selectedBlueprint === 'Multi-Page Journey') {
            state.nextPageId = 'cfmBlueprintWizardPage2';
        } else {
            state.nextPageId = 'cfmBlueprintWizardPage3';
        }
        return true;
    }

    function handleWizardPage2Submit(e, state) {
        pageTwoData = {};
        stepTwoTitles = [];
        var success = true;
        var allPageTitles = [];
        resetValidation();
        $('#cfm-wizard-dataTable > tbody > tr').each(function (index) {
            allPageTitles.push($('#cfm-page-title').val());
            var pageTwoValidationElement;
            var pageTitle = $(this).find('.cfm-input-field > input').val();
            var pageIndex = 'page' + index;
            pageTwoData[pageIndex] = pageTitle;
            stepTwoTitles.push(pageTitle);

            //check if user provided same title twice
            if ($.inArray($(this).find('.buttonInputLabel').val(), allPageTitles) !== -1 && pageTitle || state.wizardData.pages.cfmBlueprintWizardPage1.title === pageTitle) {
                //add error text
                var pageTitleDuplicateValidationMessage = CFM.Blueprints.addDuplicateValidationMessage();
                $(this).find('.cfm-input-field').append(pageTitleDuplicateValidationMessage);
                //style the error message
                pageTwoValidationElement = $(this).find($('.cfm-invalid-page-title'));
                addValidationStyling(pageTwoValidationElement);
                success = false;
            } else {
                allPageTitles.push($(this).find('.buttonInputLabel').val());
            }

            if (doesPageExist(pageTitle, state.wizardData.spaceKey)) {
                if ($(this).find('.buttonInputLabel').val()) {
                    //show page title already exists message
                    var pageTitleExistsValidationMessage = CFM.Blueprints.addExistsValidationMessage();
                    $(this).find('.cfm-input-field').append(pageTitleExistsValidationMessage);
                    pageTwoValidationElement = $(this).find($('.cfm-invalid-page-title'));
                } else {
                    //show field empty message
                    var pageTitleEmptyValidationMessage = CFM.Blueprints.addEmptyValidationMessage();
                    $(this).find('.cfm-input-field').append(pageTitleEmptyValidationMessage);
                    pageTwoValidationElement = $(this).find($('.cfm-invalid-page-title'));
                }

                addValidationStyling(pageTwoValidationElement);
                $(this).find(pageTwoValidationElement).addClass('blueprint-validation');

                success = false;
            }
        });

        var errorMessages = $('.cfm-invalid-page-title');
        if ($(errorMessages).size() > 0) {
            errorMessages[0].scrollIntoView(false);
        }
        state.wizardData.pageTwoNewPageTitles = pageTwoData;
        return success;
    }

    function handleWizardPage3Submit(e, state) {
        //subsumes the normal blueprint wizard and use an action to complete the specified tasks
        if (state.wizardData.pages.cfmBlueprintWizardPage1.userSelectedBlueprint === "Blog") {
            $('#create-dialog').find('.button-panel-cancel-link').click();
            var blogPayload = {
                "title": state.wizardData.pages.cfmBlueprintWizardPage1.title,
                "space": state.wizardData.spaceKey
            };
            createBlog(blogPayload);
            e.preventDefault();
        } else if (state.wizardData.pages.cfmBlueprintWizardPage1.userSelectedBlueprint === "Multi-Page Journey") {
            $('#create-dialog').find('.button-panel-cancel-link').click();
            var journeyPayload = {
                "stepOnePageTitle": state.wizardData.pages.cfmBlueprintWizardPage1.title,
                "space": state.wizardData.spaceKey,
                "parentPageId": state.wizardData.parentPageId,
                "stepTwoPageTitles": stepTwoTitles
            };
            createJourneyPages(journeyPayload);
            e.preventDefault();
        } else {
            return true;
        }
    }

    function createBlog(blogPayload) {
        $.ajax({
            type: 'POST',
            async: false,
            url: AJS.params.baseUrl + '/cfm/blueprint/create/blog/cfm-create-blog.action',
            data: blogPayload
        }).success(function () {
            window.location.href = AJS.params.baseUrl + '/pages/viewrecentblogposts.action?key=' + blogPayload.space;
        }).error(function () {
            var failMessage = "Failed to call Content Formatting blueprint create blog action";
            console.log(failMessage);
        });
    }

    function createJourneyPages(journeyPayload) {
        $.ajax({
            type: 'POST',
            async: false,
            url: AJS.params.baseUrl + '/cfm/blueprint/create/journeypages/cfm-create-multi-page-journey-pages.action',
            data: journeyPayload
        }).success(function () {
            window.location.href = AJS.params.baseUrl + '/display/' + journeyPayload.space + '/' + journeyPayload.stepOnePageTitle;
        }).error(function () {
            var failMessage = "Failed to call Content Formatting blueprint create journey pages action";
            console.log(failMessage);
        });
    }

    function handleWizardPage1Input(e, state) {
        $('.dialog-button-panel').append(CFM.Blueprints.docoLink());
        $('.cfm-blueprints-picture').prop('class', 'cfm-blueprints-picture');
        var descriptionElement = $('.cfm-blueprint-description');
        //handle dropdown blueprint selection
        $('.cfm-blueprint-selected').on('click', function (event) {
            descriptionElement.removeClass('blueprint-validation');
            selectedBlueprint = event.target.text;
            $('.cfm-blueprints-dropdown-text').text(selectedBlueprint);
            descriptionElement.text(getBlueprintDescriptionAndUpdateImage('page1', selectedBlueprint));
        });
        //handle page title change
        $('#cfm-page-title').on('change', function () {
            descriptionElement.removeClass('blueprint-validation');
            descriptionElement.text(getBlueprintDescriptionAndUpdateImage('page1', selectedBlueprint));
        });
        //close dropdown if cancel button is clicked while dropdown open
        $('.dialog-button-panel .button-panel-link.button-panel-cancel-link').on('click', function () {
            $('#cfm-blueprints-dropdown').remove();
        });
    }

    function createKeyCodeRange(start, end) {
        var keyCodeArray = [];
        for (var i = start; i <= end; i++) {
            keyCodeArray.push(i);
        }
        return keyCodeArray;
    }

    function handleWizardPage2Input(e, state) {
        $('.dialog-button-panel').append(CFM.Blueprints.docoLink());
        var table = $('#cfm-wizard-dataTable');
        var keyCodeArray = createKeyCodeRange(48, 90);
        keyCodeArray.push(13);
        keyCodeArray.push(32);

        //add page title table row
        table.on('keypress click', '.cfmAddPageTitleRowInput', function (event) {
            if ($.inArray(event.which, keyCodeArray) === -1) {
                var tableRow = $('#cfm-wizard-dataTable > tbody > tr');
                var newRow = CFM.Blueprints.addPageTitleRow({rowIndex: rowIndex});
                rowIndex++;
                //add new table row on appropriate index
                tableRow.eq($.inArray($(event.target).parent().parent()[0], tableRow)).after(newRow);
                //make first row 'remove button' clickable
                $('#groupRow' + $('#cfm-wizard-dataTable tbody tr .cfmAddPageTitleRowInput')[0].getAttribute('data-row-index') + ' .cfm-actions .cfmRemovePageTitleRowInput').removeAttr('disabled');
            } else {
                event.preventDefault();
            }
        });

        //remove page title table row
        table.on('keypress click', '.cfmRemovePageTitleRowInput', function (event) {
            if (event.which !== 13 && event.which !== 32) {
                var rowIndex = event.target.getAttribute('data-row-index');
                $('#groupRow' + rowIndex).remove();
                //make first row 'remove button' disabled
                if ($('#cfm-wizard-dataTable tbody tr').length === 1) {
                    $('#groupRow' + $('#cfm-wizard-dataTable tbody tr .cfmAddPageTitleRowInput')[0].getAttribute('data-row-index') + ' .cfm-actions .cfmRemovePageTitleRowInput').prop('disabled', true);
                }
            } else {
                event.preventDefault();
            }
        });
    }

    function handleWizardPage3Input(e, state) {
        $('.dialog-button-panel').append(CFM.Blueprints.docoLink());
        $('.cfm-blueprint-description').text(getBlueprintDescriptionAndUpdateImage('page3', selectedBlueprint));
    }

    //displays the appropriate description message and image based on the selected blueprint and wizard dialog step.
    function getBlueprintDescriptionAndUpdateImage(dialogPage, selectedBlueprint) {
        var description;
        switch (selectedBlueprint) {
            case "Multi-Page Journey":
                description = "Create several pages that a user can follow from start to finish.";
                updateBlueprintImage(dialogPage, 'multi-page-journey');
                break;
            case "Space Home Page":
                description = "Design a new Space Home Page.";
                updateBlueprintImage(dialogPage, 'space-home-page');
                break;
            case "Finance":
                description = "This template displays financial performance data.";
                updateBlueprintImage(dialogPage, 'finance');
                break;
            case "Blog":
                description = "Get started with a blog.";
                updateBlueprintImage(dialogPage, 'blog');
                break;
            case "Software Requirements":
                description = "Create a software requirements document.";
                updateBlueprintImage(dialogPage, 'software-requirements');
                break;
            case "Academic":
                description = "Use mathematical formulae and cite works.";
                updateBlueprintImage(dialogPage, 'academic');
                break;
            default:
                description = "Start by entering a page Title and selecting a template from the dropdown.";
        }
        return description;
    }

    function updateBlueprintImage(dialogPage, selectedBlueprint) {
        var blueprintPictureElement = $('.cfm-blueprints-picture');
        var blueprintPictureElementComplete = $('.cfm-blueprints-picture-complete');
        if (dialogPage === 'page1') {
            blueprintPictureElement.prop('class', 'cfm-blueprints-picture');
            blueprintPictureElement.addClass(dialogPage).addClass(selectedBlueprint);
        } else {
            blueprintPictureElementComplete.prop('class', 'cfm-blueprints-picture-complete');
            blueprintPictureElementComplete.addClass(dialogPage).addClass(selectedBlueprint);
        }
    }

    function doesPageExist(pageTitle, spaceKey) {
        var success = false;
        $.ajax({
            type: 'GET',
            async: false,
            url: AJS.params.baseUrl + '/rest/api/content?spaceKey=' + spaceKey + '&title=' + pageTitle,
            dataType: 'json'
        }).success(function (json) {
            if (json.size > 0) {
                success = true;
            } else {
                success = false;
            }
        });
        return success;
    }

    function addValidationStyling(element) {
        element.addClass('blueprint-validation');
        element.addClass('validation-error');

        //shake error message
        setTimeout(function () {
            element.removeClass('validation-error');
        }, 100);
    }

    function resetValidation() {
        $('.cfm-invalid-page-title').remove();
    }

    //reset some elements when navigating backwards to page 1
    function handleWizardPage1PreRender() {
        selectedBlueprint = false;
    }

    Confluence.Blueprint.setWizard('com.adaptavist.confluence.contentFormattingMacros:cfm-blueprint-item', function (wizard) {
        wizard.on('submit.cfmBlueprintWizardPage1', handleWizardPage1Submit);
        wizard.on('submit.cfmBlueprintWizardPage2', handleWizardPage2Submit);
        wizard.on('submit.cfmBlueprintWizardPage3', handleWizardPage3Submit);
        wizard.on('pre-render.cfmBlueprintWizardPage1', handleWizardPage1PreRender);
        wizard.on('post-render.cfmBlueprintWizardPage1', handleWizardPage1Input);
        wizard.on('post-render.cfmBlueprintWizardPage2', handleWizardPage2Input);
        wizard.on('post-render.cfmBlueprintWizardPage3', handleWizardPage3Input);
    });
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher == 'undefined') { navlinks.templates.appswitcher = {}; }


navlinks.templates.appswitcher.linkSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    output += '<div class="aui-nav-heading sidebar-section-header">' + soy.$$escapeHtml(opt_data.title) + '</div><ul class="aui-nav nav-links">';
    var linkList8 = opt_data.list;
    var linkListLen8 = linkList8.length;
    for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
      var linkData8 = linkList8[linkIndex8];
      output += navlinks.templates.appswitcher.applicationsItem(linkData8);
    }
    output += '</ul>';
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.linkSection.soyTemplateName = 'navlinks.templates.appswitcher.linkSection';
}


navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span></a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher.applicationsItem';
}


navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.shortcutsItem.soyTemplateName = 'navlinks.templates.appswitcher.shortcutsItem';
}


navlinks.templates.appswitcher.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape('Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.error.soyTemplateName = 'navlinks.templates.appswitcher.error';
}


navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_ignored) {
  return '<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">' + soy.$$escapeHtml('Application Links') + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape('Loading...') + '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">' + soy.$$escapeHtml('Shortcuts') + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape('Loading...') + '</div></div></nav></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebarContents.soyTemplateName = 'navlinks.templates.appswitcher.sidebarContents';
}


navlinks.templates.appswitcher.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml('Linked Applications') + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.trigger.soyTemplateName = 'navlinks.templates.appswitcher.trigger';
}


navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-title">' + aui.avatar.avatar({size: 'large', avatarImageUrl: opt_data.avatarUrl, isProject: true, title: opt_data.name}) + '<div class="sidebar-project-name">' + soy.$$escapeHtml(opt_data.name) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.projectHeaderSection.soyTemplateName = 'navlinks.templates.appswitcher.projectHeaderSection';
}


navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_ignored) {
  var output = '';
  var dropdownList__soy74 = '' + navlinks.templates.appswitcher.dropdownList({list: opt_data.links});
  output += aui.dropdown2.dropdown2({menu: {id: opt_data.id, content: dropdownList__soy74, extraClasses: 'aui-style-default sidebar-customize-section'}, trigger: {showIcon: false, content: '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>', container: '#app-switcher'}});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.cogDropdown.soyTemplateName = 'navlinks.templates.appswitcher.cogDropdown';
}


navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_ignored) {
  var output = '<ul class="sidebar-admin-links">';
  var linkList82 = opt_data.list;
  var linkListLen82 = linkList82.length;
  for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
    var linkData82 = linkList82[linkIndex82];
    output += '<li class="nav-link"><a href="' + soy.$$escapeHtml(linkData82.href) + '" title="' + soy.$$escapeHtml(linkData82.title) + '"><span class="nav-link-label">' + soy.$$escapeHtml(linkData82.label) + '</span></a></li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.dropdownList.soyTemplateName = 'navlinks.templates.appswitcher.dropdownList';
}


navlinks.templates.appswitcher.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
      var sidebarContents__soy97 = '' + navlinks.templates.appswitcher.sidebarContents(null);
      var triggerContent__soy99 = '' + navlinks.templates.appswitcher.trigger(null);
      output += navlinks.templates.appswitcher.sidebar({sidebar: {id: 'app-switcher', content: sidebarContents__soy97}, trigger: {showIcon: false, content: triggerContent__soy99}});
    } else {
      output += navlinks.templates.appswitcher_old.switcher(null);
    }
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.switcher.soyTemplateName = 'navlinks.templates.appswitcher.switcher';
}


navlinks.templates.appswitcher.sidebar = function(opt_data, opt_ignored) {
  return '<button class="sidebar-trigger app-switcher-trigger" aria-owns="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" aria-haspopup="true" >' + soy.$$filterNoAutoescape(opt_data.trigger.content) + '</button><div id=' + soy.$$escapeHtml(opt_data.sidebar.id) + ' class="app-switcher-sidebar aui-style-default sidebar-offscreen" data-is-sidebar="true" data-is-user-admin="' + soy.$$escapeHtml(false) + '">' + soy.$$filterNoAutoescape(opt_data.sidebar.content) + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebar.soyTemplateName = 'navlinks.templates.appswitcher.sidebar';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(e,a){var d="is-user-admin";var c="#app-switcher";a.SideBar=function(f){var g=this;this.$sidebar=null;f=e.extend({sidebarContents:null},f);this.getLinks=function(){return e.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateAppLinks).fail(this.showAppSwitcherError)};this.populateProjectHeader=function(i,h){g.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({avatarUrl:h,name:i}))};this.getProjectData=function(){var h=e(".project-shortcut-dialog-trigger"),i=h.data("key"),j=h.data("entity-type");if(h.size()==0||!i||!j){e(".app-switcher-shortcuts").remove();return}var l,k;k=e.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+i,cache:false,data:{entityType:j},dataType:"json"});l=e.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+i,cache:false,data:{entityType:j},dataType:"json"});e.when(k,l).then(function(n,m){g.updateProjectShortcuts(n,m,{key:i,entityType:j,name:h.data("name"),avatarUrl:h.find("img").prop("src")})},g.showProjectShortcutsError)};this.getSidebar=function(){if(!this.$sidebar){this.$sidebar=e(f.sidebarContents)}return this.$sidebar};this.addApplicationsCog=function(){e(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-applications-admin-dropdown",links:[{href:AJS.contextPath()+"/plugins/servlet/customize-application-navigator",label:"Customize navigator",title:"Add new entries, hide existing or restrict who sees what"},{href:AJS.contextPath()+"/plugins/servlet/applinks/listApplicationLinks",label:"Manage application links",title:"Link to more Atlassian applications"}]}))};this.addProjectShortcutsCog=function(h,j){var i=[{href:AJS.contextPath()+"/plugins/servlet/custom-content-links-admin?entityKey="+h,label:"Customize shortcuts",title:""}];if(g.entityMappings[j]){i.push({href:g.generateEntityLinksUrl(h,g.entityMappings[j]),label:"Manage product links",title:""})}g.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-project-shortcuts-admin-dropdown",links:i}))};this.updateAppLinks=function(h){e(function(){g.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({title:"Application Links",list:h}));if(g.getSidebar().data(d)){g.addApplicationsCog()}g.bindAnalyticsHandlers(g.getSidebar(),h)})};this.updateProjectShortcuts=function(k,i,j){var l=k[0].shortcuts,h=i[0].shortcuts;g.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({title:"Shortcuts",list:l.concat(h)}));if(g.getSidebar().data(d)){g.addProjectShortcutsCog(j.key,j.entityType)}g.populateProjectHeader(j.name,j.avatarUrl);g.bindAnalyticsHandlers(g.getSidebar(),data)};this.entityMappings={"confluence.space":"com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType","jira.project":"com.atlassian.applinks.api.application.jira.JiraProjectEntityType","bamboo.project":"com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType","stash.project":"com.atlassian.applinks.api.application.stash.StashProjectEntityType"};this.generateEntityLinksUrl=function(h,i){if(i===g.entityMappings["confluence.space"]){return AJS.contextPath()+"/spaces/listentitylinks.action?typeId="+i+"&key="+h}else{return AJS.contextPath()+"/plugins/servlet/applinks/listEntityLinks/"+i+"/"+h}};this.showAppSwitcherError=function(){e(function(){var h=g.getSidebar();h.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());h.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",e.proxy(g.retryLoading,g))})};this.showProjectShortcutsError=function(){e(function(){var h=g.getSidebar();h.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());h.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",e.proxy(g.retryLoading,g))})};this.retryLoading=function(h){this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());this.getLinks();this.getProjectData();h&&h.stopPropagation()};this.bindAnalyticsHandlers=function(h,i){};this.getLinks();e(this.getProjectData);this.toggleSidebar=function(j){j.preventDefault();var k=g.getSidebar(),i=e("body"),h=e(window.document);if(!i.hasClass("app-switcher-open")){var m=e("#header");k.css("left",-k.width());k.parent("body").length||k.appendTo("body");b({data:k});k.animate({left:0},300);function l(n){var p=n.target&&e(n.target),o=n.keyCode;if(n.originalEvent===j.originalEvent){return}if(p&&!o&&!(p.closest(k).length||p.closest(m).length)&&j.which==1&&!(n.shiftKey||n.ctrlKey||n.metaKey)){g.toggleSidebar()}else{if(o===27){g.toggleSidebar()}}}h.on("click.appSwitcher",l);h.on("keydown.appSwitcher",l);h.on("scroll.appSwitcher",k,b)}else{h.off(".appSwitcher")}i.toggleClass("app-switcher-open")};e("#header").on("click",".app-switcher-trigger",this.toggleSidebar)};function b(h){var f=e(document).scrollTop(),i=e("#header"),g=(i.height()+i.offset().top)-f;if(g>=0){h.data.css({top:g,position:"fixed"})}else{h.data.css({top:0,left:0,position:"fixed"})}}e(function(){if(e(c).data("is-sidebar")===true){new a.SideBar({sidebarContents:c})}})}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
var APPSWITCHER_TRIGGER_CLICK="appswitcher.trigger.click";var APPSWITCHER_DROPDOWN_SHOW="appswitcher.dropdown.show";var APPSWITCHER_DROPDOWN_DISPLAY_ERROR="appswitcher.dropdown.display.error";var APPSWITCHER_APP_LINK_CLICK="appswitcher.app.link.click";var APPSWITCHER_CONFIGURE_LINK_CLICK="appswitcher.configure.link.click";(function(c,f){var b="isAppSuggestionAvailable";var d="isSiteAdminUser";var e="isUserAdmin";var a="#app-switcher";f.AppSwitcher=function(j){var l=AJS.contextPath()+"/plugins/servlet/customize-application-navigator";var k="unified.usermanagement";var m=this;this.$dropdown=null;j=c.extend({dropdownContents:null},j);this.getLinks=function(){return c.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateDropdown).fail(this.showError)};this.getDropdown=function(){if(!this.$dropdown){this.$dropdown=c(j.dropdownContents);this.envData=this.$dropdown.data("environment")}return this.$dropdown};this.updateDropdown=function(n){c(function(){m.getDropdown().html(navlinks.templates.appswitcher_old.applications({apps:n,showAdminLink:m.envData[e],adminLink:l}));m.bindAnalyticsHandlers();if(m.envData[b]===true){m.handleSuggestionApps(n)}})};this.bindAnalyticsHandlers=function(){c(".app-switcher-trigger").on("click",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_TRIGGER_CLICK})});c("#app-switcher").on("aui-dropdown2-show",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_DROPDOWN_SHOW})});c("#app-switcher .nav-link").on("click",function(){var p="custom";var q=c(this).find("a");var o=q.attr("href");var n=window.location.hostname;if(o&&o.indexOf("bitbucket.org")>-1){p="bitbucket-cloud"}else{if(o.indexOf(n+"/wiki")>-1){p="confluence"}else{if(o.indexOf(n+"/build")>-1){p="bamboo"}else{if(o.indexOf(n)>-1){p="jira"}}}}AJS.trigger("analyticsEvent",{name:APPSWITCHER_APP_LINK_CLICK,data:{product:p}})});c(".nav-link-edit-wrapper").on("click",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_CONFIGURE_LINK_CLICK})})};this.isBillingSystemEnabled=function(){return(this.envData[d]===true)&&AJS.DarkFeatures.isEnabled(k)};this.handleSuggestionApps=function(q){var r=_.map(q,function(s){return s.applicationType.toLowerCase()});var o=c("<div id='app-switcher-suggestion-apps' class='aui-dropdown2-section'/>");o.html(navlinks.templates.appswitcher_old.suggestionApps);var p=o.find(".suggestion-apps");var n=false;_.each(g,function(s){if(!_.contains(r,s.appName)){n=true;p.append(navlinks.templates.appswitcher_old.suggestionApp({suggestionApp:s,isBillingSystemEnabled:m.isBillingSystemEnabled()}))}});if(!n){return}c("#app-switcher").append(o);c(".app-discovery-suggestion-app").click(function(){var t=c(this).find("a");var s;if(m.envData[d]===true){s="appswitcher.discovery.siteadmin.select.inproduct."}else{s="appswitcher.discovery.user.select."}s=s+t.attr("id").toLowerCase();AJS.trigger("analytics",{name:s})});c(".app-discovery-suggestion-app").hover(function(){c(this).find("a").removeClass("active").removeClass("aui-dropdown2-active")});c(".app-discovery-cancel-button").click(function(){AJS.trigger("analytics",{name:"appswitcher.discovery.nothanks.button.click"});i(h,"true");o.remove()})};this.showError=function(){c(function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_DROPDOWN_DISPLAY_ERROR});m.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(m.retryLoading,m))})};this.retryLoading=function(n){this.getDropdown().html(navlinks.templates.appswitcher_old.loading());this.getLinks();n&&n.stopPropagation()};this.getLinks()};var h="key-no-thanks";var g=[{appName:"jira",appDesc:"Issue & Project Tracking Software",discoveryUrl:"https://www.atlassian.com/software/jira",billingSystemDiscoveryUrl:"/admin/billing/addapplication"},{appName:"confluence",appDesc:"Collaboration and content sharing",discoveryUrl:"https://www.atlassian.com/software/confluence",billingSystemDiscoveryUrl:"/admin/billing/addapplication?product=confluence.ondemand"},{appName:"bamboo",appDesc:"Continuous integration",discoveryUrl:"https://www.atlassian.com/software/bamboo",billingSystemDiscoveryUrl:"/admin/billing/addapplication?product=bamboo.ondemand"}];var i=function(j,k){c.ajax({url:AJS.contextPath()+"/rest/menu/latest/userdata/",type:"PUT",contentType:"application/json",data:JSON.stringify({key:j,value:k})})};c(function(){if(c(a).data("is-switcher")===true){new f.AppSwitcher({dropdownContents:a})}})}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher_old.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher_old == 'undefined') { navlinks.templates.appswitcher_old = {}; }


navlinks.templates.appswitcher_old.applications = function(opt_data, opt_ignored) {
  return '' + navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.apps, listClass: 'nav-links', showDescription: opt_data.showDescription}) + ((opt_data.custom) ? navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.custom, showDescription: opt_data.showDescription}) : '') + ((opt_data.showAdminLink) ? navlinks.templates.appswitcher_old.adminSection(opt_data) : '');
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applications.soyTemplateName = 'navlinks.templates.appswitcher_old.applications';
}


navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    var param19 = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
    var linkList27 = opt_data.list;
    var linkListLen27 = linkList27.length;
    for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
      var linkData27 = linkList27[linkIndex27];
      param19 += navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentMap(linkData27, {showDescription: opt_data.showDescription}));
    }
    param19 += '</ul>';
    output += aui.dropdown2.section({content: param19});
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsSection.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsSection';
}


navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link' + ((opt_data.self) ? ' nav-link-local' : '') + '"><a href="' + soy.$$escapeHtml(opt_data.link) + '" class="aui-dropdown2-radio ' + ((opt_data.self) ? 'aui-dropdown2-checked' : '') + '" title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsItem';
}


navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.section({content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + soy.$$filterNoAutoescape('Configure...') + '</span></a></li></ul>'});
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.adminSection.soyTemplateName = 'navlinks.templates.appswitcher_old.adminSection';
}


navlinks.templates.appswitcher_old.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape('Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.error.soyTemplateName = 'navlinks.templates.appswitcher_old.error';
}


navlinks.templates.appswitcher_old.loading = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-loading">' + soy.$$filterNoAutoescape('Loading...') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.loading.soyTemplateName = 'navlinks.templates.appswitcher_old.loading';
}


navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml('Linked Applications') + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.trigger.soyTemplateName = 'navlinks.templates.appswitcher_old.trigger';
}


navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    var loadingContent__soy81 = '' + navlinks.templates.appswitcher_old.loading(null);
    var triggerContent__soy83 = '' + navlinks.templates.appswitcher_old.trigger(null);
    output += aui.dropdown2.dropdown2({menu: {id: 'app-switcher', content: loadingContent__soy81, extraClasses: 'aui-style-default', extraAttributes: {'data-environment': {}, 'data-is-switcher': 'true'}}, trigger: {tagName: 'button', showIcon: false, content: triggerContent__soy83, extraClasses: 'app-switcher-trigger aui-dropdown2-trigger-arrowless', extraAttributes: {href: '#app-switcher'}}});
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.switcher.soyTemplateName = 'navlinks.templates.appswitcher_old.switcher';
}


navlinks.templates.appswitcher_old.suggestionApp = function(opt_data, opt_ignored) {
  var output = '';
  var href__soy89 = opt_data.isBillingSystemEnabled == true ? opt_data.suggestionApp.billingSystemDiscoveryUrl : opt_data.suggestionApp.discoveryUrl;
  output += '<li class="app-discovery-suggestion-app"><a id="' + soy.$$escapeHtml(opt_data.suggestionApp.appName) + '" href="' + soy.$$escapeHtml(href__soy89) + '" class="app-discovery-link aui-icon-container app-discovery-' + soy.$$escapeHtml(opt_data.suggestionApp.appName) + '-product-icon" title="' + soy.$$escapeHtml(href__soy89) + '" target="_blank"></a><div class="app-discovery-small">' + soy.$$escapeHtml(opt_data.suggestionApp.appDesc) + '</div></li>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApp.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApp';
}


navlinks.templates.appswitcher_old.suggestionApps = function(opt_data, opt_ignored) {
  return '<ul class=\'nav-links suggestion-apps\'><li><span class=\'app-discovery-suggest-title nav-link-label\'><h6>' + soy.$$escapeHtml('Try other Atlassian apps') + '</h6></span></li></ul><div class=\'buttons-container app-discovery-suggest-apps-buttons\'><div class=\'buttons\'><button class=\'aui-button aui-button-link app-discovery-cancel-button\' name=\'cancel\' accesskey=\'c\' href=\'#\'>' + soy.$$escapeHtml('Don\x27t show this again') + '</button></div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApps.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApps';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:common-header-resources', location = '/includes/js/header-user-menu.js' */
define("confluence/header-user-menu",["jquery","confluence/meta","underscore"],function(a,c,b){function d(){var b=c.get("current-user-avatar-uri-reference");a("#user-menu-link").find(".aui-avatar-inner img").attr("src",b)}return function(){b.defer(d)}});require("confluence/module-exporter").safeRequire("confluence/header-user-menu",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:general-analytics-bindings', location = '/includes/js/analytics-bindings.js' */
define("confluence/analytics-bindings",["jquery","confluence/analytics-support"],function(b,d){return function(){function e(a,c){b(a).on("click",".view-historical-version-trigger",function(){d.publish("confluence.page.view-historical.from-"+(c||"unknown"))})}function f(a,c){b(a).on("click",".restore-historical-version-trigger",function(){d.publish("confluence.page.restore-historical.from-"+(c||"unknown"))})}function g(a,c){b("#header .aui-header-secondary "+a).on("click",function(){var a=b(this).hasClass("aui-dropdown2-active")?
"expanded":"collapsed";d.publish("confluence.header.dropdown."+c,{state:a})})}e("#page-history-warning","navigation");e("#page-history-container","history");e(".diff-menu","diff");f("#page-history-warning","navigation");f("#page-history-container","history");g("#admin-menu-link","administration");g("#user-menu-link","profile")}});require("confluence/module-exporter").safeRequire("confluence/analytics-bindings",function(b){require("ajs").toInit(b)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-read-only-mode-bootstrap', location = 'main/quick-reload-read-only-mode-bootstrap.js' */
require(["ajs","confluence/dark-features","confluence-quick-reload/main/quick-reload-manager","confluence-quick-reload/handlers/quick-reload-read-only-mode"],function(b,c,a,d){b.toInit(function(){c.isEnabled("quickreload.disabled")||(a.addHandler(d),a.enable())})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'templates/anchor.soy' */
// This file was automatically generated from anchor.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace MyWork.Templates.Anchor.
 */

if (typeof MyWork == 'undefined') { var MyWork = {}; }
if (typeof MyWork.Templates == 'undefined') { MyWork.Templates = {}; }
if (typeof MyWork.Templates.Anchor == 'undefined') { MyWork.Templates.Anchor = {}; }


MyWork.Templates.Anchor.tasksFeatureDiscovery = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$escapeHtml('See the tasks assigned to you, or created by you, in the Tasks tab of your profile.') + '</p><ul class="mw-tasks-discovery-controls"><li><a id="mw-tasks-discovery-view" href="' + soy.$$escapeHtml(opt_data.tasksUrl) + '" class="aui-button aui-style"><p>' + soy.$$escapeHtml('View Tasks') + '</p></a></li><li><a id="mw-tasks-discovery-dismiss" href="#">' + soy.$$escapeHtml('Dismiss') + '</a></li></ul>';
};
if (goog.DEBUG) {
  MyWork.Templates.Anchor.tasksFeatureDiscovery.soyTemplateName = 'MyWork.Templates.Anchor.tasksFeatureDiscovery';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'js/miniview-anchor.js' */
var MW=MW||{$:jQuery};MW.MV={};
AJS.toInit(function(){if(!AJS.Meta||AJS.Meta.get("remote-user")){MW.MV.AnchorManager=function(){function b(){MW.$(document).keydown(function(a){AJS.InlineDialog.current&&27==a.which&&!MW.$(a.target).is(":input")&&AJS.InlineDialog.current.hide()})}function m(){MW.$("#header-menu-bar").find(".ajs-drop-down").each(function(){this.hide()})}function n(a,e){function b(c){if("escKey"===c.data)d.hide(),MW.$("#notifications-anchor").focus(),document.activeElement.blur();else if("getParentConfig"===c.data&&
c.origin===location.protocol+"//"+location.host){c=JSON.stringify({parentConfig:{parentUrl:location.href,preload:MW.Dialog.preload,unread:g}});var e=MW.$("#"+a+"-miniview-iframe")[0].contentWindow;e.postMessage(c,"*");MW.Dialog.preload?MW.Dialog.preload=!1:e.focus()}}var d;window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b);MW.Dialog=AJS.InlineDialog(MW.$("#"+a+"-anchor"),a+"-miniview",function(c,b,p){if(0===MW.$(c).children().length)MW.$(c).append(MW.$('\x3ciframe id\x3d"'+
a+'-miniview-iframe" src\x3d"'+e+'" frameborder\x3d"0"\x3e\x3c/iframe\x3e'));else{c=JSON.stringify({unread:g});var f=MW.$("#"+a+"-miniview-iframe")[0].contentWindow;f.postMessage(c,"*");setTimeout(function(){f.focus()},100)}m();p()},{width:500,height:520,hideDelay:null,initCallback:function(){d=this},hideCallback:function(){if(!0!==this.preload){var c=JSON.stringify({markAllRead:!0});MW.$("#"+a+"-miniview-iframe")[0].contentWindow.postMessage(c,"*")}},noBind:!0});MW.Tasks=function(){var a,e=$("#user-menu-link"),
b=$("#user-menu-link-content"),f=b.find("#view-mytasks-link"),d=function(b,e,c){e=MyWork.Templates.Anchor.tasksFeatureDiscovery({tasksUrl:AJS.contextPath()+"/plugins/inlinetasks/mytasks.action"});b.html(e);b.find("#mw-tasks-discovery-dismiss").click(function(){a.hide()});c()};return{closeAndDiscoverMyTasks:function(){MW.Dialog.hide();b.is(":visible")||e.trigger("aui-button-invoke");var c=function(){a.hide()};b.one("aui-dropdown2-hide",c);a=AJS.InlineDialog(f,"my-tasks-discovery",d,{hideCallback:function(){a.unbind("click focusin mousedown",
h);b.unbind("aui-dropdown2-hide",c);b.is(":visible")&&e.trigger("aui-button-invoke");MW.$("#inline-dialog-my-tasks-discovery").remove()},gravity:"w",useLiveEvents:!0,width:300,noBind:!0});b.find(".user-item.active").removeClass("active");f.addClass("active");f.focus();var h=function(a){a.stopPropagation()};a.on("click focusin mousedown",h);a.show()}}}();MW.$("#"+a+"-anchor").click(function(b){b.preventDefault();MW.$("#"+a+"-miniview-iframe").is(":visible")?MW.Dialog.hide():MW.Dialog.show()});k&&MW.$("#"+
a+"-anchor").click()}var d=contextPath+"/plugins/servlet/notifications-miniview",g=0,k=/[?&]show-miniview/.test(window.location.search),l=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?\\#\x26]"+a+"\x3d([^\x26#]*)")).exec(window.location.search);if(null!==a)return decodeURIComponent(a[1].replace(/\+/g," "))}("show-miniview");l&&(d+="#notification/"+l);var q=function(a){var b=!1,d;return function(){if(b)return d;b=!0;return d=a.apply(this,arguments)}}(function(){MW.Dialog.getOptions().closeOthers=
!1;MW.Dialog.preload=!0;MW.Dialog.show();MW.Dialog.hide();MW.Dialog.getOptions().closeOthers=!0});return{setupAnchors:function(){MW.$("#notifications-anchor").html('\x3cdiv class\x3d"badge-i aui-icon aui-icon-small aui-iconfont-notification"\x3e\x3c/div\x3e\x3cspan class\x3d"badge-w"\x3e\x3cspan class\x3d"badge"\x3e\x3c/span\x3e\x3c/span\x3e').attr("title","Open Notifications");n("notifications",d);b()},updateNotificationCount:function(a){var b=MW.$("#notifications-anchor"),
d=b.find(".badge");b.find(".aui-icon");d.html(9>=a?a:"9+");g=a;0<a?(b.addClass("unread").removeClass("read"),b.is(":visible")&&!k&&q()):b.addClass("read").removeClass("unread")}}}();MW.MV.AnchorManager.setupAnchors();var b=new MW.AnchorUtil(MW.$,contextPath,MW.MV.AnchorManager.updateNotificationCount);b.setupAnchors();MW.$("#notifications-anchor").click(function(){AJS.trigger("analytics",{name:"mywork.host.button.clicked.notifications",data:{}});MW.MV.AnchorManager.updateNotificationCount(0)});document.addEventListener("visibilitychange",
function(){document.hidden?b.stopRequests(!0):b.startRequests()},!1);"undefined"===typeof document.hidden&&MW.$(window).focus(function(){b.startRequests()});MW.$("body").click(function(){b.startRequests()})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'js/util/anchor-util.js' */
MW.AnchorUtil=function(p,k,l){function d(){3E5>(new Date).getTime()-e&&a||g();e=(new Date).getTime()}function g(){a&&clearTimeout(a);a=setTimeout(function(){b()},h=m(h))}function m(a){return Math.min(3E5>(new Date).getTime()-e?c:1.25*a,f)}function b(a){MW.$.getJSON(n+(a?"?pageid\x3d"+a:""),function(a){var b=1E3*a.timeout;f=1E3*a.maxTimeout||f;b&&b!=c&&(c=b,d());l(a.count)});g()}var c=3E4,a,n=k+"/rest/mywork/latest/status/notification/count",e=(new Date).getTime(),f=3E5,h=0;return{setupAnchors:function(){AJS&&
AJS.Meta&&AJS.Meta.get&&("page"===AJS.Meta.get("content-type")||"blogpost"===AJS.Meta.get("content-type"))?b(AJS.Meta.get("page-id")):b();d()},startRequests:d,stopRequests:function(b){window.clearInterval(a);a=void 0;!0===b&&(c=3E4)},updateAnchors:b}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-search-ui-plugin:search-ui-client-templates', location = 'soy/search-ui-client-templates.soy' */
// This file was automatically generated from search-ui-client-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.SearchUI.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.SearchUI == 'undefined') { Confluence.Templates.SearchUI = {}; }


Confluence.Templates.SearchUI.helpUrl = function(opt_data, opt_ignored) {
  return '' + soy.$$escapeHtml("https:\/\/docs.atlassian.com\/confluence\/docs-713\/Search");
};
if (goog.DEBUG) {
  Confluence.Templates.SearchUI.helpUrl.soyTemplateName = 'Confluence.Templates.SearchUI.helpUrl';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-search-ui-plugin:confluence-search-ui-plugin-resources', location = '/js/confluence-search-ui-analytics-support.js' */
'use strict';

/**
 * Utility functions for publishing new search ui analytics
 * @module confluence/searchui/analytics-support
 */
define('confluence/search-ui/analytics-support', ['window', 'document', 'confluence/api/event', 'confluence/api/url'], function (window, document, eventApi, url) {
    "use strict";

    var SEARCH_UI_LEAVE_CONTENT_FROM_SEARCH_RESULT = 'confluence-search-ui-leave-content-from-new-search';
    var SEARCH_UI_EDIT_CONTENT_FROM_SEARCH_RESULT = 'confluence-search-ui-edit-content-from-new-search';
    /**
     * trigger analytic
     * @since 6.13.0
     * @public
     * @param name the analytic name
     * @param data the analytic data
     */
    function triggerAnalytic(name, data) {
        data = data || {};
        eventApi.trigger('analytics', { name: name, data: data });
    }

    /**
     * @param urlString
     * @returns {*} return array of searchId
     */
    function extractAnalyticsData(urlString) {
        var params = url.parse(urlString).queryParams;
        return params && params.searchId ? params.searchId : [];
    }

    /**
     * trigger period analytic event when beforeunload event happen
     * @param searchId searchId
     * @param period the period in millisecond
     */
    function triggerPeriodEventViewContentFromSearch(searchId, period) {
        triggerAnalytic(SEARCH_UI_LEAVE_CONTENT_FROM_SEARCH_RESULT, { searchId: searchId, period: period });
    }

    /**
     * trigger period analytic event when enter editor init.rte
     * @param searchId searchId
     * @param period the period in millisecond
     */
    function triggerPeriodEvenEditContentFromSearch(searchId, period) {
        triggerAnalytic(SEARCH_UI_EDIT_CONTENT_FROM_SEARCH_RESULT, { searchId: searchId, period: period });
    }

    /**
     * Remove
     * @param urlString
     * @returns {*}
     */
    function removeSearchIdUrl(urlString) {
        var parsedUrl = url.parse(urlString);
        delete parsedUrl.queryParams.searchId;
        return url.format(parsedUrl);
    }

    /**
     * Clean analytic parameter
     */
    function replaceStateAfterCleaningUpAnalyticsParameters() {
        var cleanUrl = removeSearchIdUrl(document.URL);
        if (document.URL !== cleanUrl) {
            window.history.replaceState(null, '', cleanUrl);
        }
    }

    /**
     * Init analytic for period
     * @since 6.13
     * @public
     */
    function initAnalytic() {
        var analyticsData = extractAnalyticsData(document.URL);
        var searchId = analyticsData[0];
        if (!searchId) {
            return;
        }

        var currentDate = new Date();
        window.addEventListener('beforeunload', function () {
            var currentTriggerTime = new Date();
            var period = currentTriggerTime.getTime() - currentDate.getTime();
            triggerPeriodEventViewContentFromSearch(searchId, period);
        });
        eventApi.bind('init.rte', function () {
            var currentTriggerTime = new Date();
            var period = currentTriggerTime.getTime() - currentDate.getTime();
            triggerPeriodEvenEditContentFromSearch(searchId, period);
        });
        // Check if browser supports HTML5 replaceState()
        if (window.history && window.history.replaceState) {
            replaceStateAfterCleaningUpAnalyticsParameters();
        }
    }

    return {
        init: initAnalytic
    };
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-search-ui-plugin:confluence-search-ui-plugin-resources', location = '/js/confluence-search-ui-plugin.js' */
require(['ajs', 'wrm', 'document', 'confluence/api/logger', 'confluence/meta', 'confluence/api/constants', 'confluence/search-ui/analytics-support'],
    function (ajs, wrm, document, logger, meta, constants, analyticsSupport) {
        const events = ['click', 'focus'];
        var searchUI;
        var searchInput;
        var spinner;
        var tooltip;
        var isTooltipShown = false;
        var isLoading = false;

        function toggleIcon() {
            searchUI.classList.toggle("hide-icon");
        }

        function startLoading() {
            isLoading = true;
            toggleIcon();
            spinner.style.display = 'block';
        }

        function stopLoading() {
            isLoading = false;
            toggleIcon();
            spinner.style.display = 'none';
        }

        function unregisterHandlers() {
            events.forEach(function (event) {
                searchInput.removeEventListener(event, lazyLoad);
            });
        }

        function showTooltip() {
            if (!isTooltipShown) {
                tooltip.style.display = 'block';
                isTooltipShown = true;
            }
        }

        function hideTooltip() {
            if (isTooltipShown) {
                tooltip.style.display = 'none';
                isTooltipShown = false;
            }
        }

        function handleClickAndFocusEvent(event) {
            showTooltip();
            event.stopPropagation();
        }

        function handleInputEvent(event) {
            if (event.target.value) {
                showTooltip();
            } else {
                hideTooltip();
            }
        }

        function handleKeyDownEvent(event) {
            const ENTER_KEY_CODE = 13;
            if (event.keyCode === ENTER_KEY_CODE) {
                const searchTerm = event.target.value;
                const cql = searchTerm ? '?cql=&queryString=' + encodeURIComponent(searchTerm) : '';
                window.location.href = constants.CONTEXT_PATH + '/dosearchsite.action' + cql;
            }
        }

        function handleDocumentClick(event) {
            if (searchUI.contains(event.target)) {
                showTooltip();
            } else {
                hideTooltip();
            }
        }

        function lazyLoad() {
            if (isLoading) return;

            startLoading();
            wrm
                .require(['wrc!confluence-search-ui-plugin-main'])
                .done(function () {
                    require(['confluence-search-ui-plugin-main'], function (SearchUI) {
                        SearchUI.init();
                        unregisterHandlers();
                        stopLoading();
                    });
                })
                .fail(function () {
                    stopLoading();
                    logger.error('fail to load confluence-search-ui-plugin-main');
                });
        }

        ajs.toInit(function () {
            searchUI = document.getElementById('search-ui');
            // login screen doesn't have navigation search
            if (!searchUI) {
                logger.log('no search-ui element found');
                return;
            }

            analyticsSupport.init();
            searchInput = searchUI.querySelector('#quick-search-query');
            spinner = searchUI.querySelector('aui-spinner');
            tooltip = searchUI.querySelector('[role=alert]');

            if (!meta.get('global-settings-quick-search-enabled')) {
                searchInput.addEventListener('keydown', handleKeyDownEvent);
                searchInput.addEventListener('input', handleInputEvent);

                events.forEach(function (event) {
                    searchInput.addEventListener(event, handleClickAndFocusEvent);
                });

                document.addEventListener('click', handleDocumentClick);
            } else {
                events.forEach(function (event) {
                    searchInput.addEventListener(event, lazyLoad);
                });
            }
        });
    });

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.dialog-wizard:dialog-wizard-resources', location = '/soy/dialog-wizard.soy' */
// This file was automatically generated from dialog-wizard.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.DialogWizard.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.DialogWizard == 'undefined') { Confluence.Templates.DialogWizard = {}; }


Confluence.Templates.DialogWizard.pageContainer = function(opt_data, opt_ignored) {
  return '<div class="dialog-wizard-page-wrapper"><div class="dialog-wizard-page-main"></div><div class="dialog-wizard-page-description">' + ((opt_data.descriptionHeaderLink && opt_data.descriptionHeader) ? '<h3><a href=\'' + soy.$$escapeHtml(opt_data.descriptionHeaderLink) + '\' target=\'_blank\'>' + soy.$$escapeHtml(opt_data.descriptionHeader) + '</a></h3>' : (opt_data.descriptionHeader) ? '<h3>' + soy.$$escapeHtml(opt_data.descriptionHeader) + '</h3>' : '') + '<p>' + soy.$$escapeHtml(opt_data.descriptionContent) + '</p></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.DialogWizard.pageContainer.soyTemplateName = 'Confluence.Templates.DialogWizard.pageContainer';
}


Confluence.Templates.DialogWizard.waitIcon = function(opt_data, opt_ignored) {
  return '<img class="wait-icon" src="' + soy.$$escapeHtml("") + '/images/icons/wait.gif">';
};
if (goog.DEBUG) {
  Confluence.Templates.DialogWizard.waitIcon.soyTemplateName = 'Confluence.Templates.DialogWizard.waitIcon';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.dialog-wizard:dialog-wizard-resources', location = '/js/dialog-wizard.js' */
(function($){var FormStateControl=require("confluence/form-state-control");function findNextPageId(pageId,pages){var thisPageIdIndex=-1;_.each(pages,function(element,index){if(element.id==pageId){thisPageIdIndex=index;return}});return pages[thisPageIdIndex+1].id}Confluence.DialogWizard=function(dialog,finalAction){function newPage(config,pageId,soyRenderContext,wizardData,wizard){var wizardPage=_.find(config.wizard.pages,function(page){return page.id==pageId});wizard.trigger("pre-render."+pageId,{soyRenderContext:soyRenderContext,wizardData:wizardData});try{var soyTemplateFunction=eval(wizardPage.templateKey);var $soyRender=$(soyTemplateFunction(soyRenderContext))}catch(e){throw Error("wizard points to a non-existent Soy template '"+wizardPage.templateKey+"'. Check your web-resources or server logs.")}$soyRender.find("a, area, button, input, object, select, textarea").attr("tabindex","10");var $panelContent;if(wizardPage.descriptionContent){$panelContent=$(Confluence.Templates.DialogWizard.pageContainer({descriptionHeaderLink:wizardPage.descriptionHeaderLink,descriptionHeader:wizardPage.descriptionHeader,descriptionContent:wizardPage.descriptionContent}));$panelContent.addClass("with-description").find(".dialog-wizard-page-main").append($soyRender)}else{$panelContent=$soyRender}var dialogPageId=pageId;if(dialog.id=="create-dialog"){dialogPageId="create-dialog-"+pageId}var page=dialog.addPage(dialogPageId).page[dialog.curpage];page.addHeader(wizardPage.title).addPanel("SinglePanel",$panelContent,"singlePanel");page.element.find("form").submit(function(){return false});if(wizardPage.descriptionContent){page.element.find(".dialog-panel-body").css({padding:0})}Confluence.Binder.autocompleteMultiUser($soyRender);Confluence.Binder.placeholder($soyRender);function nextCallback(ev){$soyRender.find(".placeholded").val("");var pageData={};var formArray=$soyRender.parent().find("form").serializeArray();_.each(formArray,function(item){pageData[item.name]=item.value});var e=$.Event("submit."+pageId);var state={$container:$soyRender,wizardData:wizardData,pageData:pageData};var validationDeferred=$.Deferred();validationDeferred.done(function(){wizardData.pages[pageId]=pageData;var nextPageId;if(state.nextPageId){nextPageId=state.nextPageId}else{nextPageId=!wizardPage.last&&findNextPageId(pageId,config.wizard.pages)}if(!state.nextPageId&&wizardPage.last){doFinalAction(ev,state,wizardData,finalAction,wizard);FormStateControl.disableElement(dialog.popup.element.find(":input,a").filter(":visible"));buttons.prepend(Confluence.Templates.DialogWizard.waitIcon())}else{newPage(config,nextPageId,soyRenderContext,wizardData,wizard)}});validationDeferred.fail(function(){AJS.log("dialog aborted by on-submit callback on page: "+pageId)});state.validationDeferred=validationDeferred;wizard.trigger(e,state);if(state.async){return}if(e.isDefaultPrevented()){validationDeferred.reject();return}validationDeferred.resolve()}var buttons=dialog.addFullButtonPanel(page,nextCallback,null,wizardPage.last);buttons.find(".button-panel-back").click(function(){delete wizardData.pages[pageId]});buttons.find(".aui-button-primary").attr("tabindex","10");$soyRender.find("input, select, textarea").eq(0).focus();wizard.trigger("post-render."+pageId,{$container:$soyRender,wizardData:wizardData})}function doFinalAction(ev,state,wizardData,finalAction,wizard){if(state.finalUrl){if(ev.type==="click"&&ev.which===2){var windowOpened=window.open(state.finalUrl);windowOpened.opener=null}else{window.location=state.finalUrl}}else{_.each(wizardData.pages,function(pageData){_.extend(wizardData,pageData)});delete wizardData.pages;finalAction(ev,wizardData,null,wizard)}return{success:function(callback){callback()}}}return{newPage:newPage,doFinalAction:doFinalAction}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:common-template-resources', location = 'com/atlassian/confluence/plugins/blueprint/common/soy/common-templates.soy' */
// This file was automatically generated from common-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.Common.Index.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Common == 'undefined') { Confluence.Blueprints.Common = {}; }
if (typeof Confluence.Blueprints.Common.Index == 'undefined') { Confluence.Blueprints.Common.Index = {}; }


Confluence.Blueprints.Common.Index.detailsSummaryMacro = function(opt_data, opt_ignored) {
  return '<ac:macro ac:name="detailssummary"><ac:parameter ac:name="label">' + soy.$$escapeHtml(opt_data.label) + '</ac:parameter><ac:parameter ac:name="spaces">' + soy.$$escapeHtml(opt_data.spaces) + '</ac:parameter><ac:parameter ac:name="firstcolumn">' + soy.$$escapeHtml(opt_data.firstcolumn) + '</ac:parameter><ac:parameter ac:name="headings">' + soy.$$escapeHtml(opt_data.headings) + '</ac:parameter><ac:parameter ac:name="blankTitle">' + soy.$$escapeHtml(opt_data.blankTitle) + '</ac:parameter><ac:parameter ac:name="blankDescription">' + soy.$$escapeHtml(opt_data.blankDescription) + '</ac:parameter><ac:parameter ac:name="contentBlueprintId">' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '</ac:parameter><ac:parameter ac:name="blueprintModuleCompleteKey">' + soy.$$escapeHtml(opt_data.blueprintModuleCompleteKey) + '</ac:parameter><ac:parameter ac:name="createButtonLabel">' + soy.$$escapeHtml(opt_data.createButtonLabel) + '</ac:parameter></ac:macro>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Common.Index.detailsSummaryMacro.soyTemplateName = 'Confluence.Blueprints.Common.Index.detailsSummaryMacro';
}


Confluence.Blueprints.Common.Index.createFromTemplateMacro = function(opt_data, opt_ignored) {
  return '<ac:macro ac:name="create-from-template"><ac:parameter ac:name="blueprintModuleCompleteKey">' + soy.$$escapeHtml(opt_data.moduleKey) + '</ac:parameter><ac:parameter ac:name="buttonLabel">' + soy.$$escapeHtml(opt_data.buttonLabel) + '</ac:parameter><ac:parameter ac:name="spaceKey">' + soy.$$escapeHtml(opt_data.spaceKey) + '</ac:parameter><ac:parameter ac:name="templateName">' + soy.$$escapeHtml(opt_data.templateName) + '</ac:parameter></ac:macro>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Common.Index.createFromTemplateMacro.soyTemplateName = 'Confluence.Blueprints.Common.Index.createFromTemplateMacro';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/how-to.soy' */
// This file was automatically generated from how-to.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.Meeting.Notes.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Meeting == 'undefined') { Confluence.Blueprints.Meeting = {}; }
if (typeof Confluence.Blueprints.Meeting.Notes == 'undefined') { Confluence.Blueprints.Meeting.Notes = {}; }


Confluence.Blueprints.Meeting.Notes.howTo = function(opt_data, opt_ignored) {
  return '<h1>' + soy.$$escapeHtml('With meeting notes you can...') + '</h1><ol class="howto-steps"><li class="howto-step"><div><h3>' + soy.$$escapeHtml('Crowd-source your agenda') + '</h3><p>' + soy.$$escapeHtml('Distribute an agenda and keep meetings focused.') + '</p></div></li><li class="howto-step"><div><h3>' + soy.$$escapeHtml('Capture meeting minutes') + '</h3><p>' + soy.$$escapeHtml('Take notes and make them available to everyone.') + '</p></div></li><li class="howto-step"><div><h3>' + soy.$$escapeHtml('Create and assign tasks') + '</h3><p>' + soy.$$escapeHtml('Assign action items for attendees to work on afterward.') + '</p></div></li></ol>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Meeting.Notes.howTo.soyTemplateName = 'Confluence.Blueprints.Meeting.Notes.howTo';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/user-mention.soy' */
// This file was automatically generated from user-mention.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Meeting.Notes.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Meeting == 'undefined') { Confluence.Templates.Meeting = {}; }
if (typeof Confluence.Templates.Meeting.Notes == 'undefined') { Confluence.Templates.Meeting.Notes = {}; }


Confluence.Templates.Meeting.Notes.userMention = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.userkey) ? '<li><p><ac:link><ri:user ri:userkey="' + soy.$$escapeHtml(opt_data.userkey) + '" /></ac:link></p></li><li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml('@mention a person to add them as an attendee and they will be notified.') + '</ac:placeholder></p></li>' : '<li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml('@mention a person to add them as an attendee and they will be notified.') + '</ac:placeholder></p></li>');
};
if (goog.DEBUG) {
  Confluence.Templates.Meeting.Notes.userMention.soyTemplateName = 'Confluence.Templates.Meeting.Notes.userMention';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.troubleshooting.plugin-confluence:atst-common', location = 'js/ajs-amd.js' */
define('troubleshooting/ajs', [], function () {
    'use strict';

    return AJS;
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.troubleshooting.plugin-confluence:atst-healthcheck-sensors', location = 'js/sensors.js' */
require([
    'troubleshooting/sensors/page-protocols',
    'troubleshooting/ajs'
], function(
    protocolSensor,
    AJS
) {
    var sensors = [protocolSensor];

    AJS.toInit(function() {

        function hash(str) {
            var hash = 0;
            for (var i = 0; i < str.length; ++i) {
                hash = 31 * hash + str.charCodeAt(i);
                hash |= 0; // this reduces the number to 32bits and prevents Infinity
            }
            return hash;
        }

        //this handles cases when the user disabled access to local storage
        var localStorageWrapper = {
            getWithDefaultOnError: function(sensorName, defaultValue) {
                try {
                    return window.localStorage.getItem(sensorName) || "0";
                } catch (e) {
                    return defaultValue;
                }
            },
            setItemQuietly: function (key, value) {
                try {
                    window.localStorage.setItem(key, value);
                } catch (ignored) {
                }
            }
        };

        // Iterate through each sensor and ingest any data it has for us...
        // but only if it's actually working properly in this client.
        sensors.forEach(function(sensor) {
            if (!sensor.isWorking()) {
                return
            }

            var sensorData = {};
            var newData = sensor.getData();
            for (var key in newData) {
                if (newData.hasOwnProperty(key)) {
                    sensorData[key] = newData[key];
                }
            }

            var sensorName = 'atst.healthcheck.sensors.' + sensor.getName();
            var currentHash = hash(JSON.stringify(sensorData)).toString(36);
            var previousHash = localStorageWrapper.getWithDefaultOnError(sensorName, currentHash);
            if (previousHash===currentHash && Math.random()>0.01) {
                return;
            }
            // What's one more analytics event to the world? A drop in the data ocean.
            AJS.trigger('analytics', {
                name: sensorName,
                data: sensorData
            });
            localStorageWrapper.setItemQuietly(sensorName, currentHash);
        });

    });
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.troubleshooting.plugin-confluence:atst-healthcheck-sensors', location = 'js/sensors/page-protocols.js' */
define('troubleshooting/sensors/page-protocols', ['troubleshooting/ajs'], function(AJS) {
    var baseUrl = AJS.contextPath();
    var hasPerfData = window.performance && typeof window.performance.getEntriesByType === 'function';

    // WARNING: This is a rough assumption based on how the WRM works.
    // Consuming this from the WRM would be a better option, but meh.
    // See: https://bitbucket.org/atlassian/atlassian-plugins-webresource/src/master/atlassian-plugins-webresource/src/main/java/com/atlassian/plugin/webresource/WebResourceUrlProviderImpl.java
    // See also: https://stash.atlassian.com/projects/CP/repos/static-assets-url/browse/src/main/resources/ui/health-checks/health-checks.js
    var WRM_STATIC_ASSET_REGEX = new RegExp(baseUrl + '/s/.+?/_/');

    function isStaticResource(resource) {
        return WRM_STATIC_ASSET_REGEX.test(resource.name);
    }

    function getNextHopData(resource) {
        return (resource && resource.nextHopProtocol) || 'unknown';
    }

    function unique(elem, pos, arr) {
        return arr.indexOf(elem) === pos;
    }

    return {
        isWorking: function() {
            return hasPerfData;
        },
        getName: function() {
          return 'page-protocols';
        },
        getData: function() {
            var resources = window.performance.getEntriesByType('resource');
            var navigation = window.performance.getEntriesByType('navigation');
            var resourceProtocols = resources
                .filter(isStaticResource)
                .map(getNextHopData)
                .filter(unique)
                .sort();
            if (!resourceProtocols.length) {
                resourceProtocols.push('unknown');
            }
            return {
                resourceProtocols: resourceProtocols,
                navigationProtocol: getNextHopData(navigation[0]),
                userAgent: navigator.getUserAgent && "use-js-client-hints" || navigator.userAgent
            };
        }
    }
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:custom-protocol-launcher', location = '/includes/js/custom-protocol-launcher.js' */
define("confluence/custom-protocol-launcher",["document","confluence/api/logger"],function(b,c){return{openUri:function(d){var e=b.body,a;a=b.querySelector("#confluence_hiddenIframe");a||(a=b.createElement("iframe"),a.src="about:blank",a.id="confluence_hiddenIframe",a.style.display="none",e.appendChild(a));try{a.contentWindow.location.href=d}catch(f){c.log("Error while try to open URI"+f)}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-hierarchy-plugin:confluence-copy-page-hierarchy-plugin-loader', location = 'js/loader.js' */
/**
 * Async resources loader for copy-page-hierarchy resources.
 */
require([
    'ajs',
    'wrm',
    'confluence/legacy'
], function (AJS, WRM, Confluence) {
    var COPY_CONTEXT = 'confluence-copy-page-hierarchy';
    var DELETE_CONTEXT = 'confluence-delete-page-hierarchy';

    AJS.toInit(function ($) {
        var $toolsCopyLink = $('#action-copy-page-link');
        var $operationsCopyLink = $('#copyPageLink');
        var $toolsDeleteLink = $('#action-remove-content-link');

        _loadResourcesAsync($toolsCopyLink, COPY_CONTEXT);
        _loadResourcesAsync($operationsCopyLink, COPY_CONTEXT);
        _loadResourcesAsync($toolsDeleteLink, DELETE_CONTEXT);
        _checkInProgressDeleteFlow($toolsDeleteLink);
    });

    /**
     * Loads the require resources for either copy or delete
     * @param {jQuery} $button The button that loads the resources
     * @param {string} context The WRM resource context to load
     * @returns {undefined}
     * @private
     */
    function _loadResourcesAsync($button, context) {
        if ($button.length) {
            $button.off('click');
            $button.on('click', function (e) {
                e.preventDefault();
                _loadResources($button, context);
            });
        }
    }

    /**
     * Function handler to run when the delete or copy button is clicked
     * @param {jQuery} $button The button that loads the resources
     * @param {string} context The WRM resource context to load
     * @returns {undefined}
     * @private
     */
    function _loadResources($button, context) {
        var $body = $('body');
        $button.off('click');

        var loadingIndicator = Confluence.PageLoadingIndicator($body);
        loadingIndicator.show();

        AJS.debug('Loading ' + context + ' resources...');
        WRM.require(['wrc!' + context], function () {
            loadingIndicator.hide();
            $button.addClass('confluencePageHierarchy');
            AJS.debug('Loaded ' + context + ' resources.');
        });
    }

    /**
     * Checks to see if there is a flow in progress based on url parameters
     * and loads the resources if the flow is in progress.
     * @param {jQuery} $toolsDeleteLink The Delete button, if present
     * @returns {undefined}
     * @private
     */
    function _checkInProgressDeleteFlow($toolsDeleteLink) {
        var hash = window.location.hash;
        if (hash.indexOf('delete-complete') === 1) {
            _loadResources($toolsDeleteLink, DELETE_CONTEXT);
        }
    }
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jirachart-resources', location = '/jirachart/jirachart.js' */
AJS.toInit(function(){var c=require("confluence/form-state-control");AJS.$(".jira-chart-macro-img").load(function(a){AJS.log("Jira Chart Macro - chart image loaded");c.enableElement(AJS.$(".insert-jira-chart-macro-button",window.parent.document))}).error(function(a){AJS.log("Jira Chart Macro - chart image loaded error");c.disableElement(AJS.$(".insert-jira-chart-macro-button",window.parent.document));var b=AJS.$(a.target).parent();a=b.parent();b.remove();b="Unable to render Jira chart macro due to an execution error.";
AJS.messages.error(a,{body:b})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jirachart-resources', location = '/jirachart/twodimensionalchart-showlink.js' */
var TwoDimensionalShowLink=function(a){var g=function(b){var d=a("#two-dimensional-chart-"+b),c=d.position();a("\x3cdiv /\x3e",{id:"twodimensional-dark-layout-"+b,"class":"jim-sortable-dark-layout",css:{top:c.top+"px",left:c.left+"px",width:d.width()+"px",height:d.height()+"px"}}).appendTo(d.parent())},e=function(b){a("#twodimensional-dark-layout-"+b).remove()},h=function(){var b=a(this).attr("data-chart-id");g(b);var d={pageId:a("#chart-page-id-"+b).val(),wikiMarkup:a("#chart-wiki-"+b).val(),isShowMore:a(this).attr("data-is-show-more")};
AJS.$.ajax({type:"POST",dataType:"html",url:Confluence.getContextPath()+"/plugins/servlet/twoDimensionalShowMoreRenderer",data:d,success:function(c){if(a(c).find(".aui-message.error,.aui-message.aui-message-error").length)c=a(c).find(".message").text(),a("#two-dimensional-chart-"+b).find(".show-error").html(c);else{var d=a(c).find(".show-link-container a").attr("data-chart-id");a("#two-dimensional-chart-"+b).replaceWith(c);f(d)}e(b)},error:function(){a("#two-dimensional-chart-"+b).find(".show-error").html("Unable to render Jira chart macro. Execution has timed out.");
e(b)}})},f=function(b){a("#show-link-"+b).on("click",h)};return{init:function(){a(".show-link-container a").each(function(){f(a(this).attr("data-chart-id"))})}}}(AJS.$);AJS.$(function(){TwoDimensionalShowLink.init()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:synchrony-util', location = '/js/synchrony-util.js' */
define("confluence-collaborative-editor-plugin/synchrony-util",["ajs","jquery","underscore","confluence/meta","confluence/legacy"],function(d,f,p,h,c){function e(a){var b=h.get(a);void 0===b&&(b=f('meta[name\x3d"ajs-'+a+'"]').attr("content"),void 0!==b?h.set(a,b):(console.error("Missing '"+a+"' metadata value"),k()&&d.trigger("editor.error.message",{messageKey:"collaborative-editor-load-failure",message:d.I18n.getText("editor.collaborative-editing.refresh-editor.error"),close:"manual"})));return b}
function n(){return e("synchrony-base-url").split(",")}function m(a,b,g){if(0===g.length||0===b.length)a.reject();else{var c=g[0];f.ajax({url:c+"/heartbeat",cache:!1}).done(function(d,e,k){200===k.status?(l=c,d=0<g.slice(1).length?"primary":"secondary",e=0<l.indexOf("synchrony-proxy")?"synchrony-proxy":"synchrony-direct",h.set("synchrony-connection-order",d),h.set("synchrony-connection-type",e),f.when.apply(this,b.map(function(a){return f.ajax({url:c+"/resources"+a,dataType:"script",cache:!0})})).then(function(){a.resolve()})):
m(a,b,g.slice(1))}).fail(function(){m(a,b,g.slice(1))})}}function k(){return d.Rte.getEditor()&&d.Rte.getEditor().initialized}var l;return{retrieveMetadata:e,getEntityId:function(){return"/"+e("synchrony-app-id")+"/confluence-"+c.getContentId()},synchronyReady:function(){return"0"!==c.getContentId()},getServiceUrl:function(){return(l?l:n()[0])+"/v1"},getXhrFallbackFlag:function(){return e("use-xhr-fallback")},getLatestRevisionWithAttr:function(a,b){return p.last(a.filter(function(a){return a.meta&&
a.meta[b]}))},hasRevisionType:function(a,b){return a.some(function(a){return a.meta&&a.meta.type===b})},hasRevisionTrigger:function(a,b){return a.some(function(a){return a.meta&&a.meta.trigger===b})},asArray:function(){return Array.prototype.slice.call(arguments)},time:function(a){c.debugTime&&c.debugTime(a)},timeEnd:function(a){c.debugTimeEnd&&c.debugTimeEnd(a)},loadScript:function(a){var b=f.Deferred(),c=n();m(b,a,c);return b.promise()},isEditorInitialised:k}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:synchrony-content', location = '/js/synchrony-content.js' */
define("confluence-collaborative-editor-plugin/synchrony-content","jquery underscore ajs confluence/meta confluence/legacy confluence-collaborative-editor-plugin/synchrony-util".split(" "),function(d,h,f,l,m,k){var e;return{getContent:function(a){if("limited"===a.syncRevSource)return{error:"limited-mode"};var b=a.title,c=a.editorContent;var e="\x3cbody data-title\x3d'"+h.escape(b)+"'\x3e"+c+"\x3c/body\x3e";var f=!!d("\x3cdiv\x3e"+c+"\x3c/div\x3e").find(".fatal-render-error").length,g=a.syncRev;return{title:b,
raw:c,html:e,error:f,confRev:a.confRev,syncRev:"dummy-sync-rev"===g?null:g,syncRevSource:a.syncRevSource}},isUnpublished:function(){return k.retrieveMetadata("new-page")},fixTinymceCaretContainer:function(a,b){var c;!(c=!a.childNodes.length)&&(c=1===a.childNodes.length)&&(c=a.firstChild&&a.firstChild.classList&&a.firstChild.classList.contains("synchrony-container")&&/^\s*$/.test(a.firstChild.textContent));c&&b.setContent("")},writeTitleToRootElement:function(){var a=d("#content-title").val();if(a!==
e){var b=frames.wysiwygTextarea_ifr;(void 0!==b.contentDocument?b.contentDocument:b.document).body.setAttribute("data-title",a);e=a}},readTitleFromRootElement:function(a){a.hasAttribute("data-title")&&(a=a.getAttribute("data-title"),a!==e&&(d("#content-title").val(a),e=a))},bindPostPasteFix:function(){d(document).bind("prePaste",function(){f.trigger("synchrony.stop",{id:"confluence.postpaste-fix"})}).bind("postPaste",function(){setTimeout(function(){f.trigger("synchrony.start",{id:"confluence.postpaste-fix"})},
0)})},isContentEmpty:function(a){return/^\s+$/.test(a)||0===d(d.parseHTML?d.parseHTML(a):a).text().trim().length}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch-model.js' */
define("confluence-watch-button/watch-model",["ajs","backbone"],function(c,e){return e.Model.extend({saveSettings:function(b,a,e){this.trigger("request");var d=this;return c.safe.ajax({url:b,type:a?"POST":"DELETE",contentType:"application/json",dataType:"json",data:{}}).done(function(){d.set(e,a);d.trigger("sync",d)}).fail(function(){d.trigger("error")})},saveWatchPage:function(b){var a=c.contextPath()+"/rest/api/user/watch/content/"+this.get("pageId");return this.saveSettings(a,b,"watchingPage")},
saveWatchBlogs:function(b){var a=c.contextPath()+"/rest/api/user/watch/space/"+this.get("spaceKey")+"?contentType\x3dblogpost";return this.saveSettings(a,b,"watchingBlogs")},saveWatchSpace:function(b){var a=c.contextPath()+"/rest/api/user/watch/space/"+this.get("spaceKey");return this.saveSettings(a,b,"watchingSpace")}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch-view.js' */
define("confluence-watch-button/watch-view",["jquery","ajs","underscore","backbone","confluence/flag"],function(e,b,g,h,k){return h.View.extend({events:{"change #cw-watch-page":"changeWatchPage","change #cw-watch-blogs":"changeWatchBlogs","change #cw-watch-space":"changeWatchSpace"},initialize:function(){g.bindAll(this,"render","initTooltips","changeWatchPage","changeWatchBlogs","changeWatchSpace","togglePageEnabledState","toggleBlogsEnabledState","startLoading","stopLoading","setTitle","_restoreCheckboxState",
"_disableAllElements","_rememberLastState","_revertToLastState");this.model.on("sync change:watchingSpace",this.togglePageEnabledState,this);this.model.on("change:watchingSpace",this.toggleBlogsEnabledState,this);this.model.on("request",this.startLoading,this);this.model.on("sync",this.setTitle,this);this.model.on("sync",this.stopLoading,this);this.model.on("sync",this._restoreCheckboxState,this);this.model.on("error",this._revertToLastState,this)},render:function(){this.$el.html(Confluence.Watch.Templates.dialogBody(this.model.toJSON()));
this.initTooltips();this.setTitle(this.model);"READ_ONLY"===b.Meta.get("access-mode")&&this._disableAllElements();return this},_revertToLastState:function(){var a=this.currentModel.get("watchingPage"),c=this.currentModel.get("watchingSpace"),f=this.currentModel.get("watchingBlogs"),d=this.$("#cw-watch-page");d.prop("checked",a||c);d.prop("disabled",this.currentModel.get("watchPageDisabled"));d=this.$("#cw-watch-space");d.prop("checked",c);d.prop("disabled",this.currentModel.get("watchSpaceDisabled"));
d=this.$("#cw-watch-blogs");d.prop("checked",f);d.prop("disabled",this.currentModel.get("watchBlogsDisabled"));this.$(".cw-manage-watchers").removeClass("disabled");this.model.set("watchingPage",a);this.model.set("watchingBlogs",f);this.model.set("watchingSpace",c);this.stopLoading();this.errorFlag=new k(e.extend({},{close:"manual",type:"error",extraClasses:"confluence-menu-flag",fifo:!0,stack:"menu"},{body:"This site is read-only. You can\u0027t make changes right now."}))},_rememberLastState:function(){this.errorFlag&&
this.errorFlag.close();this.currentModel=this.model.clone();this.currentModel.set("watchPageDisabled",this.$("#cw-watch-page").prop("disabled"));this.currentModel.set("watchSpaceDisabled",this.$("#cw-watch-space").prop("disabled"));this.currentModel.set("watchBlogsDisabled",this.$("#cw-watch-blogs").prop("disabled"));this.$targetCheckbox.prop("disabled",!0)},_disableAllElements:function(){this.$("input[type\x3d'checkbox']").prop("disabled",!0);this.$(".cw-manage-watchers").addClass("disabled")},_restoreCheckboxState:function(){this.$targetCheckbox&&
this.$targetCheckbox.prop("disabled",!1)},initTooltips:function(){this.$(".cw-tooltip").tooltip({gravity:"e",offset:5,delayIn:0});this.togglePageEnabledState(this.model);this.toggleBlogsEnabledState(this.model)},changeWatchPage:function(a){this.$targetCheckbox=e(a.target);this._rememberLastState();a=this.$targetCheckbox.is(":checked");this.model.saveWatchPage(a)},changeWatchBlogs:function(a){this.$targetCheckbox=e(a.target);this._rememberLastState();a=this.$targetCheckbox.is(":checked");this.model.saveWatchBlogs(a)},
changeWatchSpace:function(a){this.$targetCheckbox=e(a.target);this._rememberLastState();a=this.$targetCheckbox.is(":checked");this.model.saveWatchSpace(a)},togglePageEnabledState:function(a){var c=a.get("watchingPage");a=a.get("watchingSpace");this.$("#cw-watch-page").prop("disabled",a);this.$("#cw-watch-page").prop("checked",c||a);c=a?"You will receive updates for this page because you are watching this space.":"";this.$(".cw-tooltip-watch-page").attr("original-title",c)},toggleBlogsEnabledState:function(a){var c=a.get("watchingBlogs");
a=a.get("watchingSpace");this.$("#cw-watch-blogs").prop("disabled",a);this.$("#cw-watch-blogs").prop("checked",c||a);c=a?"You are subscribed to all blog posts because you are watching this space.":"";this.$(".cw-tooltip-watch-blogs").attr("original-title",c)},startLoading:function(){this.$(".cw-status").addClass("loading")},stopLoading:function(){this.$(".cw-status").removeClass("loading")},setTitle:function(){var a=this.model.get("watchingPage"),c=this.model.get("watchingBlogs"),e=this.model.get("watchingSpace"),d=
this.model.get("isBlogPost");a=e?{title:"You are watching this space",description:"Receiving email updates for all content in this space."}:a&&d&&c?{title:"You are watching this blog post",description:"Receiving email updates about changes to this blog post and all new blog posts in this space."}:a&&d?{title:"You are watching this blog post",description:"Receiving email updates about changes to this blog post."}:a?{title:"You are watching this page",
description:"Receiving email updates about changes to this page."}:d&&c?{title:"You are watching for new blog posts",description:"Receiving email updates for new blog posts in this space."}:d?{title:"You are not watching this blog",description:"Start watching to receive email updates about changes to this blog."}:{title:"You are not watching this page",description:"Start watching to receive email updates about changes to this page."};
this.$(".cw-title").text(a.title);this.$(".cw-title-description").text(a.description)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/notification.js' */
define("confluence-watch-button/watch-notification",["jquery","confluence/flag"],function(d,b){return function(c){var a=document.getElementById("watch-notification");null!=a&&a.close();b({type:"success",body:c,close:"auto"}).setAttribute("id","watch-notification")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch.js' */
require("jquery underscore ajs confluence-watch-button/watch-model confluence-watch-button/watch-view confluence-watch-button/watch-notification".split(" "),function(e,k,d,l,m,n){function p(b,c){h(b,c);var a=new l(c),f=new m({model:a});d.InlineDialog(b,"confluence-watch",function(a,d,b){f.setElement(a);f.render();b()},{width:325,offsetX:-180,cacheContent:!1,hideDelay:null,hideCallback:function(){e(".tipsy").hide()}});a.on("change:watchingPage change:watchingBlogs change:watchingSpace",function(a){h(b,
a.toJSON())});a.on("change:watchingPage",function(a,b){d.trigger("analytics",{name:b?"watch-page":"unwatch-page"})});a.on("change:watchingBlogs",function(a,b){d.trigger("analytics",{name:b?"watch-blogs":"unwatch-blogs"})});a.on("change:watchingSpace",function(a,b){d.trigger("analytics",{name:b?"watch-space":"unwatch-space"})});q(a);var g=!1;e(document).on("keyup",function(){g=!1});window.CW_watchPage=function(){if(!g){g=!0;var c=a.get("watchingSpace"),f=a.get("watchingPage");c?e("body, #splitter-content").animate({scrollTop:0},
300,function(){b.click();setTimeout(function(){e(".cw-tooltip-watch-page").tipsy("show")},50)}):(c=!f,a.saveWatchPage(c),c=c?"You started watching this page.":"You stopped watching this page.",n(c))}}}function h(b,c){var a=c.isBlogPost&&c.watchingBlogs,e=c.watchingSpace;c.watchingPage||a||e?(c=b.find(".aui-icon").removeClass("aui-iconfont-unwatch").addClass("aui-iconfont-watch"),a=d.format("{0}W{1}atching","\x3cu\x3e",
"\x3c/u\x3e"),b.prop("title","Stop watching (w)").children("span").empty().append(c).append(" "+a)):(c=b.find(".aui-icon").removeClass("aui-iconfont-watch").addClass("aui-iconfont-unwatch"),a=d.format("{0}W{1}atch","\x3cu\x3e","\x3c/u\x3e"),b.prop("title","Watch (w)").children("span").empty().append(c).append(" "+a))}function q(b){b.on("change:watchingPage",function(b,a){d.trigger(a?"watchpage.pageoperation":
"unwatchpage.pageoperation")})}d.toInit(function(){var b=e("#watch-content-button");if(b.length){b.click(function(a){a.preventDefault()});var c=d.Meta.get("page-id");e.getJSON(d.contextPath()+"/rest/watch-button/1.0/watchState/"+c,function(a){k.extend(a,{pageId:c,spaceKey:d.Meta.get("space-key"),spaceName:d.Meta.get("space-name")});p(b,a);b.addClass("watch-state-initialised")})}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'templates/watch.soy' */
// This file was automatically generated from watch.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Watch.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Watch == 'undefined') { Confluence.Watch = {}; }
if (typeof Confluence.Watch.Templates == 'undefined') { Confluence.Watch.Templates = {}; }


Confluence.Watch.Templates.dialogBody = function(opt_data, opt_ignored) {
  return '<div class="cw-status"><h2 class="cw-title"></h2><p class="cw-title-description"></p></div><form class="aui cw-dialog"><div class="cw-tooltip cw-tooltip-watch-page"><div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-page" ' + ((opt_data.watchingPage) ? 'checked' : '') + '><label for="cw-watch-page">' + ((opt_data.isBlogPost) ? soy.$$escapeHtml('Watch blog post') : soy.$$escapeHtml('Watch page')) + '</label></div></div>' + ((opt_data.isBlogPost) ? '<div class="cw-tooltip cw-tooltip-watch-blogs"><div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-blogs" ' + ((opt_data.watchingBlogs) ? 'checked' : '') + '><label for="cw-watch-blogs">' + soy.$$escapeHtml('Watch for new blog posts in this space') + '</label></div></div>' : '') + '<div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-space" ' + ((opt_data.watchingSpace) ? 'checked' : '') + '><label for="cw-watch-space">' + soy.$$escapeHtml('Watch all content in this space') + '</label></div></form>' + ((opt_data.isAdmin) ? '<div class="cw-manage-watchers-wrapper"><button class="aui-button aui-button-link cw-manage-watchers">' + soy.$$escapeHtml('Manage Watchers') + '</button></div>' : '');
};
if (goog.DEBUG) {
  Confluence.Watch.Templates.dialogBody.soyTemplateName = 'Confluence.Watch.Templates.dialogBody';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:share-dialog-service', location = 'js/service/share-page.js' */
define("confluence/share-page/service/share-page",["ajs","wrm","jquery"],function(k,e,c){return{initDialog:function(d,f,g,a){var b=c(d);if(b.length)b.off("click.share-page").on("click.share-page",function(h){b.off("click.share-page");a.beforeLoad&&"function"===typeof a.beforeLoad&&a.beforeLoad();e.require(["wrc!share-page-async-loader"]).done(function(){a.afterLoad&&"function"===typeof a.afterLoad&&a.afterLoad();require("confluence/share-page/dialog-async-loader")(d,f,c.extend(!1,{hideCallback:function(){a.onHide&&
"function"===typeof a.onHide&&a.onHide()},width:250,hideDelay:36E5},g),a);b.click()});h.preventDefault();return!1})}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:share-dialog-service', location = 'js/service/share-dialog-loader.js' */
define("confluence/share-page/service/share-dialog-loader",["wrm","confluence/api/logger"],function(a,b){return{init:function(c,d){a.require(["wrc!share-dialog-react"]).done(function(){require(["share-dialog-react"],function(a){a.init(c,d)})}).fail(function(){b.error("fail to load share-dialog-app")})}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:view-resources', location = 'js/view-init.js' */
require(["ajs","confluence/meta","confluence/share-page/service/share-page","confluence/share-page/service/share-dialog-loader","confluence/dark-features"],function(c,a,e,f,g){var h="page"===a.get("content-type")?"Share this page":"Share this blog post",k="page"===a.get("content-type")?"Take a look at this page":"Take a look at this blog post";c.toInit(function(b){if(g.isEnabled("react.share.dialog"))f.init("share-react-link");
else{var d=b("#shareContentLink");b("#shareContentLink").length&&e.initDialog("#shareContentLink","shareContentPopup",{},{heading:h,notePlaceholder:k,link:function(){return b('link[rel\x3d"shortlink"]').prop("href")},entityId:function(){return a.get("page-id")},restriction:function(){return require("confluence/share-page/fetch/content-restrictions")(a.get("content-id")).pipe(function(a){var b={};if(a.read.restrictions.user.size||a.read.restrictions.group.size||a.update.restrictions.user.size||a.update.restrictions.group.size)b.type=
"restrict",b.message="Restrictions on this page may prevent people viewing or editing.";return b})},copyOption:"share",shareType:"view",contentType:a.get("content-type"),errorText:"An unexpected error occurred. Please try again.",beforeLoad:function(){d.find(".aui-icon").css("visibility","hidden");d.spin()},afterLoad:function(){d.find(".aui-icon").css("visibility","visible");d.spinStop()},onHide:function(){b(".dashboard-actions .explanation").hide()}})}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:analytics-common-resource', location = 'js/analytics/constants.js' */
window.define('stiltsoft/handy-macros/analytics/constants', ['exports'], function (exports) {
    const DIMENSION_MACRO_TYPE = {
        name: "macroType",
        index: 7
    };

    const DIMENSION_FEATURE_TYPE = {
        name: "featureType",
        index: 8
    };

    const DIMENSION_STATUSES_COUNT = {
        name: "count",
        index: 9
    };

    const DIMENSIONS = [DIMENSION_STATUSES_COUNT, DIMENSION_FEATURE_TYPE, DIMENSION_MACRO_TYPE];

    const DIMENSION_BY_NAME = DIMENSIONS.reduce(function (result, item) {
        result[item.name] = item;
        return result;
    }, {});

    const EVENT_MACRO_INSERTED = {
        name: "MACRO_INSERTED",
        category: "Macro usage",
        screenName: "Confluence page (edit)",
        dimensions: [DIMENSION_MACRO_TYPE]
    };

    const EVENT_FEATURE_USED = {
        name: "FEATURE_USED",
        category: "Macro usage",
        screenName: "Confluence page (edit)",
        dimensions: [DIMENSION_FEATURE_TYPE]
    };

    const EVENT_STATUS_CHANGED = {
        name: "STATUS_CHANGED",
        category: "Macro usage",
        screenName: "Confluence page (edit)",
        dimensions: [DIMENSION_STATUSES_COUNT]
    };

    const EVENT_ACTIONS = [
        EVENT_MACRO_INSERTED,
        EVENT_FEATURE_USED,
        EVENT_STATUS_CHANGED
    ];

    exports.EVENT_MACRO_INSERTED = EVENT_MACRO_INSERTED;
    exports.EVENT_FEATURE_USED = EVENT_FEATURE_USED;
    exports.EVENT_STATUS_CHANGED = EVENT_STATUS_CHANGED;

    exports.eventName = "handy-macros-event:analytics";

    exports.EVENT_ACTION_BY_NAME = EVENT_ACTIONS.reduce(function (result, item) {
        result[item.name] = item;
        return result;
    }, {});
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:analytics-common-resource', location = 'js/analytics/operations.js' */
window.define('stiltsoft/handy-macros/analytics/operations',
    ['exports', 'jquery', 'underscore'], function (exports, $, _) {
        var TRACKING_URL = '/rest/status-macro/1.0/config/ga';

        function allowTracking() {
            return $.ajax({
                contentType: "application/json; charset=utf-8",
                type: 'PUT',
                cache: false,
                url: Confluence.getContextPath() + TRACKING_URL,
                data: {},
                dataType: 'json'
            }).promise();
        }

        function disableTracking() {
            return $.ajax({
                contentType: "application/json; charset=utf-8",
                type: 'DELETE',
                cache: false,
                url: Confluence.getContextPath() + TRACKING_URL,
                data: {},
                dataType: 'json'
            }).promise();
        }

        exports.fetchState = function () {
            return new Promise(function (resolve, reject) {
                $.ajax({
                    contentType: "application/json; charset=utf-8",
                    type: 'GET',
                    cache: false,
                    url: Confluence.getContextPath() + TRACKING_URL,
                    data: {},
                    dataType: 'json',
                    success: function (response, statusText, jqXHR) {
                        if (statusText === 'nocontent') {
                            resolve('none');
                        }
                        resolve(response);
                    },
                    error: function (xhr) {
                        reject(xhr);
                    }
                });
            });
        };

        exports.trackingUrl = TRACKING_URL;

        exports.setState = function (value) {
            var xhr = (value)
                ? allowTracking()
                : disableTracking();
            return xhr.then(function () {
                return value;
            });
        };
    });
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:analytics-client-resource', location = 'js/analytics/client.js' */
window.define('stiltsoft/handy-macros/analytics/client',
    [
        'exports',
        'jquery',
        'stiltsoft/handy-macros/analytics/constants'
    ], function (exports, $, Constants) {
        var $document = $(document);

        function send(eventAction, payload) {
            const json = JSON.stringify(payload || {});
            $document.trigger(Constants.eventName, [eventAction.name, json]);
        }

        function sendInsertMacroEvent(macroType) {
            var payload = {macroType: macroType};
            send(Constants.EVENT_MACRO_INSERTED, payload);
        }

        function sendFeatureUsedEvent(featureType) {
            var payload = {featureType: featureType};
            send(Constants.EVENT_FEATURE_USED, payload);
        }

        function sendStatusChangedEvent(count) {
            var payload = {count: count};
            send(Constants.EVENT_STATUS_CHANGED, payload);
        }

        exports.send = send;
        exports.sendFeatureUsedEvent = sendFeatureUsedEvent;
        exports.sendInsertMacroEvent = sendInsertMacroEvent;
        exports.sendStatusChangedEvent = sendStatusChangedEvent;
    });

window.define('stiltsoft/handy-macros/analytics/client/extender',
    ['exports',
        'underscore',
        'stiltsoft/handy-macros/analytics/client'
    ], function (exports, _, Client) {

        exports.extendObject = function (obj) {
            _.extend(obj, {
                sendAnalyticsInsertEvent: Client.sendInsertMacroEvent,
                sendAnalyticsUsedEvent: Client.sendFeatureUsedEvent
            });
        };

        exports.extend = function (obj) {
            obj.updateSelectedMacro = function () {
                console.log('Is updated macro');
                this.updated = true;
            }.bind(obj);

            obj.manipulateMarkup = function (metadata) {
                if (!this.updated) {
                    console.log('Send event', metadata);
                    Client.sendInsertMacroEvent(metadata.title);
                }
            }.bind(obj);
            return obj;
        };
    });
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:status-controller-resource', location = 'soy/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace HandyStatusTemplate.
 */

if (typeof HandyStatusTemplate == 'undefined') { var HandyStatusTemplate = {}; }


HandyStatusTemplate.history = function(opt_data, opt_ignored) {
  var output = '<div>';
  if (opt_data.revisions.length == 0) {
    output += soy.$$escapeHtml('Status has no changes in history.');
  } else {
    output += '<table>';
    var revisionList9 = opt_data.revisions;
    var revisionListLen9 = revisionList9.length;
    for (var revisionIndex9 = 0; revisionIndex9 < revisionListLen9; revisionIndex9++) {
      var revisionData9 = revisionList9[revisionIndex9];
      output += '<tr><td>' + soy.$$escapeHtml(revisionData9.date) + '</td><td>' + ((revisionData9.user.name) ? '<a href="' + soy.$$escapeHtml("") + '/display/~' + soy.$$escapeHtml(revisionData9.user.name) + '" class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(revisionData9.user.name) + '">' : '') + '<img class="recipient-icon" src="' + soy.$$escapeHtml("") + soy.$$escapeHtml(revisionData9.user.avatarUrl) + '" height="16" width="16">' + soy.$$escapeHtml(revisionData9.user.fullName) + ((revisionData9.user.name) ? '</a>' : '') + '</td><td>' + ((revisionData9.newStatus) ? HandyStatusTemplate.status({status: revisionData9.oldStatus}) : soy.$$escapeHtml('Created')) + '</td><td>' + ((revisionData9.newStatus) ? '&rarr;' : '') + '</td><td>' + ((revisionData9.newStatus) ? HandyStatusTemplate.status({status: revisionData9.newStatus}) : HandyStatusTemplate.status({status: revisionData9.oldStatus})) + '</td></tr>';
    }
    output += '</table>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  HandyStatusTemplate.history.soyTemplateName = 'HandyStatusTemplate.history';
}


HandyStatusTemplate.status = function(opt_data, opt_ignored) {
  return '<span class="aui-lozenge handy-status-view ' + ((opt_data.status.view == 1) ? ' min-view ' : '') + '"' + ((opt_data.status.outline) ? 'style="color: ' + soy.$$escapeHtml(opt_data.status.textColor) + '; background-color: white; border-color: ' + soy.$$escapeHtml(opt_data.status.color) + '; ' + ((opt_data.status.view == 1) ? ' width: ' + soy.$$escapeHtml(opt_data.status.width) + 'px ' : '') + '"' : 'style="color: ' + soy.$$escapeHtml(opt_data.status.textColor) + '; background-color: ' + soy.$$escapeHtml(opt_data.status.color) + '; border-color: ' + soy.$$escapeHtml(opt_data.status.color) + '; ' + ((opt_data.status.view == 1) ? ' min-width: ' + soy.$$escapeHtml(opt_data.status.width) + 'px ' : '') + '"') + '>' + soy.$$escapeHtml(opt_data.status.name) + '</span>';
};
if (goog.DEBUG) {
  HandyStatusTemplate.status.soyTemplateName = 'HandyStatusTemplate.status';
}


HandyStatusTemplate.options = function(opt_data, opt_ignored) {
  var output = '';
  var optionList90 = opt_data.options;
  var optionListLen90 = optionList90.length;
  for (var optionIndex90 = 0; optionIndex90 < optionListLen90; optionIndex90++) {
    var optionData90 = optionList90[optionIndex90];
    output += '<aui-item-link resolved=""><a role="menuitem" tabindex="-1">' + soy.$$filterNoAutoescape(optionData90.content) + '</a></aui-item-link>';
  }
  return output;
};
if (goog.DEBUG) {
  HandyStatusTemplate.options.soyTemplateName = 'HandyStatusTemplate.options';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:status-controller-resource', location = 'js/status-controller.js' */
(function ($, AnalyticsClient) {
    if (!AJS || !AJS.toInit) {
        return;
    }

    window.HandyStatus = {

        init: function () {
            var self = this;
            self.bindInlineComments();
            self.initStatuses();
            self.bindDOMChange();
            self.bindTableSorterHeader();
            self.bindStatusChange();
        },

        initStatuses: function () {
            var self = HandyStatus;
            var statuses = $('.handy-status-view:not(.ready)');
            if (statuses.length === 0) return;
            statuses.addClass('ready');

            self.setMarkup();
            self.bindStatusClick(statuses);
            if (!window.ConfluenceMobile) {
                self.bindHistory(statuses);
            }
            self.bindDDInit();
        },

        setMarkup: function () {
            $('body').append($('[id^="asdd-"]'));
        },

        bindStatusClick: function (statuses) {
            return statuses.filter('.handy-status-editable').click(function (e) {
                e.stopPropagation();
            });
        },

        bindHistory: function (statuses) {
            statuses.filter('.history').each(function () {
                var status = $(this);
                if (status.parents('.ic-content').length) {
                    status.parents('p').css('white-space', 'normal');
                }
                var timer;
                status.one("mouseover", function () {
                    var popup = AJS.InlineDialog(status, "handy-status-history-" + status.attr('id'),
                        function (content, trigger, showPopup) {
                            $.ajax({
                                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                                type: 'GET',
                                cache: false,
                                url: Confluence.getContextPath() + '/rest/status-macro/1.0/status/get-history',
                                data: {
                                    contentId: status.data('pageid'),
                                    id: status.attr('id')
                                },
                                dataType: 'json',
                                success: function (data) {
                                    content.html(HandyStatusTemplate.history({revisions: data}));
                                    showPopup();
                                }
                            });

                            return false;
                        }, {onHover: true, fadeTime: 0, hideDelay: 100, showDelay: 600});

                    status.click(function () {
                        popup.hide();
                    });

                    timer = setTimeout(function () {
                        popup.show();
                    }, 600);
                }).one("mouseleave", function () {
                    clearTimeout(timer);
                });
            });
        },

        bindStatusChange: function () {
            var pageVersionMeta = $('meta[name="page-version"]');
            var xhr, timer;
            $(document).delegate('.handy-status-option', 'click', function () {
                var option = $(this);
                var macroId = option.data('macroid');
                var pageId = option.data('pageid');
                var span = $('[id="' + macroId + '"][data-pageid="' + pageId + '"]');
                var dd = $('#asdd-' + macroId + '-' + pageId);
                var oldStyle = span.attr('style');
                var oldStatus = span.data('status');
                var oldText = span.text();
                var changeStatus = function () {
                    span.text(option.text().toUpperCase()).attr('style', option.children().attr('style')).data('status', option.data("status"))
                        .trigger('DOMCharacterDataModified');
                };
                if (span.data('status') === option.data("status")) return;

                if ($('body.content-preview').length) {
                    changeStatus();
                    return;
                }

                var statusesCount = option.closest('aui-section').find('aui-item-link').length;

                $.ajax({
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    type: 'POST',
                    cache: false,
                    url: Confluence.getContextPath() + '/rest/status-macro/1.0/status/change',
                    data: {
                        contentId: option.data('pageid'),
                        macroId: option.data('macroid'),
                        status: option.data("status"),
                        name: option.text().trim()
                    },
                    dataType: 'json',
                    success: function (data) {
                        AnalyticsClient.sendStatusChangedEvent(statusesCount);
                        if ((data.pageVersion - pageVersionMeta.attr('content'))=== 1) {
                            pageVersionMeta.attr('content', data.pageVersion);
                        }
                        dd.find('.aui-message').remove();
                        span.attr('id', data.id);
                        dd.find('.handy-status-option').attr('data-macroid', data.id);
                    },
                    error: function (xhr) {
                        span.text(oldText).attr('style', oldStyle).data('status', oldStatus).trigger('DOMCharacterDataModified');
                        span.click();
                        var isReadOnly = xhr.responseText.indexOf('com.atlassian.confluence.api.service.exceptions.ReadOnlyException') !== -1;
                        AJS.messages.error(dd, {
                            title: "Oops! An unexpected error has occurred!",
                            body: isReadOnly ? "This Confluence site is temporarily in the read-only mode. You cannot make any changes right now." : "Unable to save changes. Please try to reload the page and make another attempt."
                        });
                    }
                });

                changeStatus();
            })
                .delegate(".handy-status-search", "input", function () {
                    var input = $(this);
                    var container = input.closest("div");
                    var spinner = container.find(".handy-status-search-spinner").css("display", "inline-block");

                    clearTimeout(timer);
                    xhr && xhr.abort();
                    timer = setTimeout(function () {
                        getOptions(input, container, spinner, input.val().trim());
                        container.find(".handy-status-search-show-all").show();
                    }, 300)
                })
                .delegate(".handy-status-search-show-all", "click", function () {
                    var a = $(this).hide();
                    var container = a.closest("div");
                    var spinner = container.find(".handy-status-show-all-spinner").show();
                    container.find(".handy-status-search").val("");
                    clearTimeout(timer);
                    xhr && xhr.abort();
                    getOptions(a, container, spinner, "", 1000000);
                    return false;
                });

            function getOptions(el, container, spinner, search, limit) {
                xhr = $.ajax({
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    type: 'GET',
                    cache: false,
                    url: Confluence.getContextPath() + '/rest/status-macro/1.0/status/get-options',
                    data: {
                        contentId: el.data('pageid'),
                        id: el.data('id'),
                        search: search,
                        limit: limit
                    },
                    dataType: 'json',
                    success: function (data) {
                        container.children(":gt(0)").remove();
                        container.append(HandyStatusTemplate.options({options: data[0].items}));
                        spinner.hide();
                        container.find(".handy-status-search-shown").text(data[0].items.length);
                    },
                    complete: function() {
                        spinner.hide();
                    }
                });
            }
        },

        bindInlineComments: function () {
            var self = this;

            if (_ && Backbone && Backbone.Events.listenTo) {
                $(document).bind('ajaxComplete', function (e, xhr, data) {
                    if (data.url.indexOf('/rest/inlinecomments/1.0/comments') >= 0) {
                        self.initStatuses();
                    }
                });
                $('#rte-button-publish, #rte-button-cancel').live('click', function () {
                    self.initStatuses();
                });

                var listener = {};
                _.extend(listener, Backbone.Events);
                listener.listenTo(Backbone, "ic:view", function () {
                    setTimeout(self.initStatuses, 50);
                });
            }
        },

        bindDOMChange: function () {
            var self = this;
            var timer = null;
            var onInsert = function (target) {
                if (target.hasClass('handy-status-view') || target.find('.handy-status-view').length) {
                    if (timer) {
                        clearTimeout(timer);
                        timer = null;
                    }
                    timer = setTimeout(self.initStatuses, 100);
                }
            };

            var wikiContent = $('.wiki-content');
            if (wikiContent.length && wikiContent.find('.microBlogWrapper').length === 0) {
                var observer = new MutationObserver(function (events) {
                    events.some(function (event) {
                        if (event.addedNodes.length) {
                            return onInsert($(event.addedNodes));
                        }
                    });
                });
                observer.observe(wikiContent[0], {
                    childList: true,
                    subtree: true
                });
            }
        },

        bindTableSorterHeader: function () {
            var self = this;

            $('table').bind('tablesorter-initialized', function () {
                var statuses = $(this).find('thead .tablesorter-headerRow .handy-status-view');
                self.bindStatusClick(statuses).bind('mousedown mouseup', function (e) {
                    e.preventDefault();
                    return false;
                });
                self.bindHistory(statuses);
            });
        },

        bindDDInit: function () {
            $('aui-dropdown-menu[id^="asdd-"]').on("aui-dropdown2-show", function () {
                var dropdown = this;
                var $dropdown = $(this);
                var sections = $dropdown.find('aui-section');

                if (sections.length) {
                    var section = sections[0];
                    var resolved = section.hasAttribute("resolved");

                    if (resolved) {
                        HandyStatus.initDD($dropdown);
                    } else {
                        var observer = new MutationObserver(function (e) {
                            if (section.hasAttribute("resolved")) {
                                observer.disconnect();
                                HandyStatus.initDD($dropdown);
                            }
                        });
                        observer.observe(section, {attributes: true});
                    }
                } else {
                    var observer = new MutationObserver(function (e) {
                        if (HandyStatus.getNotRenderedDropdownOptions($dropdown).length) {
                            observer.disconnect();
                            HandyStatus.initDD($dropdown);
                        }
                    });
                    observer.observe(dropdown, {childList: true, subtree: true});
                }
            });
        },

        getNotRenderedDropdownOptions: function (dropdown) {
            return dropdown.find("a:not(.handy-status-option):not(.binded)");
        },

        initDD: function (dds) {
            return this.getNotRenderedDropdownOptions(dds).each(function () {
                var $dropdownOption = $(this);
                var searchOption = $dropdownOption.find('.handy-status-search');
                var auiMessageOption = $dropdownOption.find('.aui-message');
                var handyStatusOption = $dropdownOption.find('.handy-status-option');

                if (!handyStatusOption.length && !searchOption.length && !auiMessageOption.length) {
                    $dropdownOption.html($dropdownOption.text());
                } else {
                    $dropdownOption.addClass("binded");
                }
            }).length;
        }
    };

    if (window.ConfluenceMobile) {
        ConfluenceMobile.contentEventAggregator.on("displayed", function () {
            if (!Confluence.getContextPath) {
                Confluence.getContextPath = AJS.contextPath;
            }
            HandyStatus.init();
            WRM.require("com.stiltsoft.confluence.handy.macros:aui-mobile-resources");
        });
    } else {
        AJS.toInit(function () {
            HandyStatus.init();
        });
    }

})(AJS.$ || window.Zepto || $, require('stiltsoft/handy-macros/analytics/client'));

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:whats-new-resources', location = 'soy/whats-new.soy' */
// This file was automatically generated from whats-new.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace WhatsNew.
 */

if (typeof WhatsNew == 'undefined') { var WhatsNew = {}; }


WhatsNew.viewDialog = function(opt_data, opt_ignored) {
  var output = '<div id="whats-new-view"><div id="whats-new-view-summary">' + ((opt_data.changes == 1) ? 'This page was modified by ' + ((opt_data.users[0].name) ? '<a href="' + "" + '/display/~' + opt_data.users[0].name + '" class="url fn confluence-userlink" data-username="' + opt_data.users[0].name + '">' + opt_data.users[0].fullName + '</a>' : opt_data.users[0].fullName) : AJS.format('\x3cstrong\x3e{0}\x3c/strong\x3e changes were made to this page ',opt_data.changes) + ((opt_data.users.length > 1) ? AJS.format('by \x3cstrong\x3e{0}\x3c/strong\x3e contributors:',opt_data.users.length) : 'by ' + ((opt_data.users[0].name) ? '<a href="' + "" + '/display/~' + opt_data.users[0].name + '" class="url fn confluence-userlink" data-username="' + opt_data.users[0].name + '">' + opt_data.users[0].fullName + '</a>' : opt_data.users[0].fullName))) + '</div>';
  if (opt_data.users.length > 1) {
    var userList43 = opt_data.users;
    var userListLen43 = userList43.length;
    for (var userIndex43 = 0; userIndex43 < userListLen43; userIndex43++) {
      var userData43 = userList43[userIndex43];
      if (userIndex43 < 10) {
        output += ((userData43.name) ? '<a href="' + "" + '/display/~' + userData43.name + '" class="url fn confluence-userlink" data-username="' + userData43.name + '">' : '') + '<img src="' + "" + userData43.avatarUrl + '" title="' + userData43.fullName + '" width="24" height="24"/><span class="handy-diff-count">' + ((userData43.count > 9) ? '9+' : userData43.count) + '</span>' + ((userData43.name) ? '</a>' : '');
      } else if (userIndex43 == 10 && opt_data.users.length > 10) {
        var others__soy71 = opt_data.users.length - 10;
        output += '<div>' + AJS.format('and {0} more contributors',others__soy71) + '</div>';
      }
    }
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  WhatsNew.viewDialog.soyTemplateName = 'WhatsNew.viewDialog';
}


WhatsNew.acknowledgeDialog = function(opt_data, opt_ignored) {
  return '<div id="whats-new-acknowledge">' + 'Acknowledge changes made to this page since your last visit.' + '<div id="whats-new-acknowledge-read-more"><a href="https://docs.stiltsoft.com/display/HMFC/How+to+use+Handy+Page+Diff?from=add-on-dialog" target="_blank">' + 'Read more' + '</a></div></div>';
};
if (goog.DEBUG) {
  WhatsNew.acknowledgeDialog.soyTemplateName = 'WhatsNew.acknowledgeDialog';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:whats-new-resources', location = 'js/whats-new.js' */
(function($, AnalyticsClient) {

    if (!AJS || !AJS.toInit) {
        return;
    }

    window.HandyWhatsNew = {

        acknBtn: null,
        viewBtn: null,
        pageVersion: null,
        currentPageVersion: null,
        contentId: null,

        init: function() {
            var self = this;
            self.acknBtn = $('#handy-whats-new-acknowledge, #handy-diff-acknowledge');
            self.viewBtn = $('#handy-whats-new-view');
            self.currentPageVersion = $('meta[name="page-version"]').attr('content');
            self.contentId = AJS.params.contentId || AJS.Meta.get("content-id") || AJS.params.pageId || AJS.Meta.get("page-id");
            if (self.acknBtn.length) {
                self.initAcknowledge();
            }
            if (self.viewBtn.length) {
                self.initView();
            }
        },

        initAcknowledge: function() {
            var self = this;

            self.acknBtn.prepend('<span class="aui-icon aui-icon-small aui-iconfont-success"></span>');
            self.acknBtn.click(function() {
                $.ajax({
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    type: 'POST',
                    cache: false,
                    url: Confluence.getContextPath() + '/rest/status-macro/1.0/whats-new/change',
                    data: {
                        contentId: self.contentId,
                        version: self.currentPageVersion
                    },
                    dataType: 'json',
                    success: function() {
                        AnalyticsClient.sendFeatureUsedEvent('Handy Page Diff');
                        self.hideButtons();
                        if (opener) {
                            opener.HandyWhatsNew.hideButtons();
                        }
                    }
                });
                return false;
            });

            AJS.InlineDialog(self.acknBtn, "handy-acknowledge-changes",
                function(content, trigger, showPopup) {
                    content.html(WhatsNew.acknowledgeDialog());
                    showPopup();
                    return false;
                }, {onHover: true, fadeTime: 0, hideDelay: 300, hideCallback: function() {
                    self.viewBtn.removeClass('handy-whats-new-hl');
            }});

            self.acknBtn.mouseenter(function() {
                self.viewBtn.addClass('handy-whats-new-hl');
            }).mouseleave(function() {
                if (!self.acknBtn.is('.active')) {
                    self.viewBtn.removeClass('handy-whats-new-hl');
                }
            });
        },

        initView: function() {
            var self = this;

            self.viewBtn.html('<span class="aui-icon aui-icon-small aui-iconfont-pages-large"></span>');
            self.viewBtn.parent().css('padding-left', 0);
            var newCount = $('<span class="whats-new-count"></span>');
            self.viewBtn.append(newCount);

            $.ajax({
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                type: 'GET',
                cache: false,
                url: Confluence.getContextPath() + '/rest/status-macro/1.0/whats-new/version',
                data: {
                    contentId: self.contentId
                },
                dataType: 'json',
                success: function(version) {
                    self.pageVersion = version;
                    var diff = self.currentPageVersion - self.pageVersion;
                    var diffStr = diff > 9 ? '9+' : diff;
                    newCount.text(diffStr);
                    var contributors = null;

                    AJS.InlineDialog(self.viewBtn, "handy-view-changes",
                        function(content, trigger, showPopup) {
                            var show = function () {
                                content.html(WhatsNew.viewDialog({users: contributors, changes: diff}));
                                showPopup();
                            };

                            if (contributors) {
                                show();
                            } else {
                                $.ajax({
                                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                                    type: 'GET',
                                    cache: false,
                                    url: Confluence.getContextPath() + '/rest/status-macro/1.0/whats-new/contributors',
                                    data: {
                                        contentId: self.contentId,
                                        version: self.pageVersion
                                    },
                                    dataType: 'json',
                                    success: function (modifiers) {
                                        contributors = modifiers;
                                        show();
                                    }
                                });
                            }
                            
                            return false;
                        }, {onHover: true, fadeTime: 0, hideDelay: 300, width: 195, hideCallback: function() {
                            self.acknBtn.removeClass('handy-whats-new-hl');
                        }});

                    self.viewBtn.attr('href', Confluence.getContextPath() + '/pages/diffpagesbyversion.action?pageId=' + self.contentId +
                            '&selectedPageVersions=' + self.currentPageVersion + '&selectedPageVersions=' + self.pageVersion +
                            '&handyDiff=' + self.contentId).attr('target', '_blank');
                }
            });

            self.viewBtn.mouseenter(function() {
                self.acknBtn.addClass('handy-whats-new-hl');
            }).mouseleave(function() {
                if (!self.viewBtn.is('.active')) {
                    self.acknBtn.removeClass('handy-whats-new-hl');
                }
            }).click(function() {
                self.viewBtn.blur();
            });
        },

        hideButtons: function() {
            var self = this;

            self.viewBtn.parent().fadeOut();
            self.acknBtn.parent().fadeOut();
        }
    };

    AJS.toInit(function() {
        HandyWhatsNew.init();
    });

})(AJS.$ || window.Zepto || $, require('stiltsoft/handy-macros/analytics/client'));



}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.stiltsoft.confluence.handy.macros:handy-tip-resources', location = 'js/handy-tip.js' */
(function ($) {
    function init() {
        const body = $('body');
        $('a[href*="handytip-"]').not('[data-aui-trigger]').attr('data-aui-trigger', true).each(function (i) {
            const a = $(this);
            const href = a.attr('href');
            const id = href.substring(href.indexOf('handytip-'));
            a.attr('aria-controls', id + i);

            const dialog = $('<aui-inline-dialog responds-to="hover"></aui-inline-dialog>');
            const textarea = $('textarea#' + id);
            dialog.attr('id', id + i).html(textarea.val());
            body.append(dialog);
        });
        
        $('.handytip-textarea').remove();
    }

    function bindDOMChange() {
        var timer = null;
        var onInsert = function (target) {
            if (target.find('a[href*="handytip-"]').length) {
                if (timer) {
                    clearTimeout(timer);
                    timer = null;
                }
                timer = setTimeout(init, 100);
            }
        };

        var wikiContent = $('.wiki-content');
        if (wikiContent.length && wikiContent.find('.microBlogWrapper').length === 0) {
            if (window.MutationObserver) {
                var observer = new MutationObserver(function (events) {
                    events.some(function (event) {
                        if (event.addedNodes.length) {
                            return onInsert($(event.addedNodes));
                        }
                    });
                });
                observer.observe(wikiContent[0], {
                    childList: true,
                    subtree: true
                });
            } else {
                wikiContent.bind('DOMNodeInserted', function (e) {
                    onInsert($(e.target));
                });
            }
        }
    }


    if (window.ConfluenceMobile) {
        ConfluenceMobile.contentEventAggregator.on("displayed", function () {
            init();
            bindDOMChange();
        });
    } else {
        AJS.toInit(function () {
            init();
            bindDOMChange();
        });
    }

})(AJS.$ || window.Zepto || $);

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-analytics', location = '/includes/js/page.js' */
define("confluence/page",["ajs","jquery","confluence/analytics-support","window","document"],function(a,c,e,f,g){var i=a.Meta.get("page-id"),d=function(b,a){e.publish("confluence.page."+b,c.extend({pageID:i},a||{}))},j=(new Date).getTime();return function(){var b=c("#main-content");if(0!==b.length){d("view");b.on("click","a",function(a){a=-1<a.currentTarget.href.indexOf(f.location.host)?"internal":"external";d("link.click",{linkType:a})});var h=c(f),e=(new Date).getTime();h.on("scroll.content",a.debounce(function(){var a=
g.body.scrollTop+g.body.offsetHeight,c=b.offset().top+b.height();a>c&&(d("scroll-to-bottom",{secondsSinceReadyEvent:((new Date).getTime()-e)/1E3,secondsSincePageLoad:((new Date).getTime()-j)/1E3}),h.off("scroll.content"))},200));setTimeout(function(){d("reading")},3E5)}}});require("confluence/module-exporter").safeRequire("confluence/page",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.macros.advanced:blog-post-resources', location = 'com/atlassian/confluence/plugins/macros/advanced/blog-posts.js' */
jQuery(function(a){a(".macro-blank-experience .create-post").bind("click",function(){var a=AJS.Meta.get("base-url")+"/pages/createblogpost.action?spaceKey\x3d"+AJS.Meta.get("space-key");window.location=a})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.macros.multimedia:flash-autosize', location = 'javascript/flash-autosize.js' */
AJS.toInit(function(b){function a(e,d){var c;if(d>=20){AJS.log("unable to auto size flash - took too long to load");return}c=b([]);e.each(function(){var g=b(this);var i;var f;if(this.GetVariable){if(!g.attr("height")){i=this.GetVariable("height");if(i){g.height(i)}else{c=c.add(g);return}}if(!g.attr("width")){f=this.GetVariable("width");if(f){g.width(f)}else{c=c.add(g);return}}}});if(c.length){setTimeout(function(){a(c,d+1)},100)}}a(b('embed[type="application/x-shockwave-flash"]'),0);b(window).bind("render-content-loaded",function(d,c){a(b('embed[type="application/x-shockwave-flash"]',c),0)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.view-source:view-source-menu-resources', location = 'com/atlassian/confluence/plugins/viewsource/js/viewsource.js' */
define("confluence-view-source/viewsource",["jquery","window"],function(a,b){return function(){a("#action-view-source-link").click(function(a){b.open(this.href,(this.id+"-popupwindow").replace(/-/g,"_"),"width=800, height=600, scrollbars, resizable").opener=null;a.preventDefault();return!1})}});require("confluence/module-exporter").safeRequire("confluence-view-source/viewsource",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.view-storage-format:view-storage-menu-resources', location = 'com/atlassian/confluence/plugins/viewstorage/js/viewstorage.js' */
AJS.toInit(function(a){a(".view-storage-link, .view-storage-link a").click(function(a){window.open(this.href,(this.id+"-popupwindow").replace(/-/g,"_"),"width\x3d800, height\x3d600, scrollbars, resizable");a.preventDefault();return!1})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-loader', location = '/js/loader.js' */
require(["ajs","wrm"],function(a,b){!a.$(".page-gadget").length&&a.toInit(function(){b.require(["wrc!request-access-plugin"])})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'soy/pagetree.soy' */
// This file was automatically generated from pagetree.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Pagetree.Macro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Pagetree == 'undefined') { Confluence.Templates.Pagetree = {}; }
if (typeof Confluence.Templates.Pagetree.Macro == 'undefined') { Confluence.Templates.Pagetree.Macro = {}; }


Confluence.Templates.Pagetree.Macro.loadingIndicator = function(opt_data, opt_ignored) {
  return '<div class="plugin_pagetree_children_loading_wrapper"><div class="spinner"></div><span class="plugin_pagetree_children_loading">' + soy.$$escapeHtml('Loading...') + '</span></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Pagetree.Macro.loadingIndicator.soyTemplateName = 'Confluence.Templates.Pagetree.Macro.loadingIndicator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree.js' */
(function(){var a=function(j){this.$=j;var f=this.$;var y=999;var z=true;var i=false;var u={};var c={};var k=function(I,E,J,D,B){var G=I.dataset.expanded==="true";if(E==undefined||E==null){E=!G}if(J==undefined||J==null){J=0}var F=I.getAttribute("data-children-loaded")==="true";if(G!==E){var C=I.getAttribute("data-page-id")+"-"+I.getAttribute("data-tree-id");var H=f("#children"+C);if(F){if(E==z){I.classList.remove("aui-iconfont-chevron-right");I.classList.add("aui-iconfont-chevron-down");I.setAttribute("data-expanded",true);I.setAttribute("aria-expanded",true)}else{I.classList.remove("aui-iconfont-chevron-down");I.classList.add("aui-iconfont-chevron-right");I.setAttribute("data-expanded",false);I.setAttribute("aria-expanded",false)}if(E==z){if(B==false){H.slideDown(300)}else{H.removeClass("plugin-pagetree-hide-children");H.animate({opacity:1})}}else{if(B==false){H.slideUp(300)}else{H.animate({opacity:0},{complete:function(){H.addClass("plugin-pagetree-hide-children")}})}}if(D){p(C)}}else{h(I,C,new Array(),J,"",D,B,true)}}if(D){p(C)}};var g=function(D,C,B){x(D,z,C,B)};var v=function(D,C,B){x(D,i,C,B)};var x=function(G,E,D,C){e(G);var F=f("#"+G);var B=F.find('a.plugin_pagetree_childtoggle[data-type="toggle"]');B.each(function(H){k(this,E,y,H==B.length-1,C)});D.preventDefault();D.stopPropagation()};var s=function(B){if(!B||B==undefined){return null}if(B.indexOf("plusminus")!=-1){return B.substring("plusminus".length)}if(B.indexOf("children")!=-1){return B.substring("children".length)}return null};var b=function(B){if(!B||B==undefined){return null}return o(B)[1]};var o=function(B){if(!B||B==undefined){return null}return B.split("-")};var e=function(C){var B=b(C);f("div.plugin_pagetree").each(function(D){if(D==B){f(this).find("span.plugin_pagetree_status").removeClass("hidden");f(this).find("div.plugin_pagetree_expandcollapse").addClass("hidden")}})};var p=function(C){var B=b(C);f("div.plugin_pagetree").each(function(D){if(D==B){f(this).find("span.plugin_pagetree_status").addClass("hidden");f(this).find("div.plugin_pagetree_expandcollapse").removeClass("hidden")}})};var d=function(G,E,L,I,H,D,C,J,F,K){var B=u[G];if(E=="Orphan"){B+="&hasRoot=false&spaceKey="+H}else{B+="&hasRoot=true&pageId="+E}B+="&treeId="+G+"&startDepth="+I+"&mobile="+C;f.each(L,function(){B+="&ancestors="+this});if(J){B+="&loadMore=true"}if(F!=null){B+="&elementsAfter="+F}if(K!=null){B+="&elementsBefore="+K}B+="&treePageId="+D;if(C==false){B=(AJS.params.serverUrl||"")+B}return B};var n=function(D){var C=D;var B=null;f("div.plugin_pagetree").each(function(E){if(E==C){B=f(this)}});return B};var m=function(B){var C=B.children("fieldset");var D=new Object();if(C.length>0){C.children("input").each(function(){D[this.name]=this.value})}return D};var l=function(B){var D=B.children("fieldset");var E=new Array();if(D.length>0){var C=D.children("fieldset");if(C.length>0){C.children("input").each(function(){E.push(this.value)})}}return E};var r=function(B){var C=f(document.createElement("div"));C.html(B);return C.find("ul[id^='child_ul']").length};var h=function(F,J,B,U,K,E,C,S,G,O,L,H){var Q=J;var I=E;var R=o(J);var M=R[0];var D=R[1];var V=f("#children"+J);var P=m(n(D));var T=false;function W(){if(O||L){F.innerHTML="Loading..."}else{var X=Confluence.Templates.Pagetree.Macro.loadingIndicator();V.find(".plugin_pagetree_children_loading_wrapper .spinner").spin("small");if(L){V.html(X+V.html())}else{V.append(X)}}}var N=0;if(typeof H!=="undefined"&&H){N=f("#"+H).offset().top}if(S){setTimeout(function(){if(!T){W()}},250)}else{W()}f.ajax({type:"GET",url:d(D,M,B,U,P.spaceKey,P.treePageId,C,G,O,L),dataType:"text",success:function(Y){if(r(Y)){f(".plugin_pagetree_children_loading_wrapper").remove();if(L!=null){var X=V.html();V.html(Y+X)}else{V.append(Y)}T=true;if(typeof H!=="undefined"){var Z=f("#"+H).offset().top-N;document.getElementsByClassName("acs-side-bar")[0].scrollTop=document.getElementsByClassName("acs-side-bar")[0].scrollTop+Z}if(V.children().length&&V.hasClass("hidden")){V.removeClass("hidden")}f("#plusminus"+Q).addClass("aui-iconfont-chevron-down").removeClass("aui-iconfont-chevron-right");f("#childrenspan"+c[parseInt(D)]+"-"+D).addClass("plugin_pagetree_current");if(I){p(Q)}if(typeof F!=="undefined"){F.setAttribute("data-children-loaded",true);F.setAttribute("data-expanded",true);F.setAttribute("aria-expanded",true)}if(O){f("#children"+J+" > ul > .page-tree-load-more-link-after").remove()}if(L){f("#children"+J+" > ul > .page-tree-load-more-link-before").remove()}q(V);if(AJS.PageGadget&&AJS.PageGadget.contentsUpdated){AJS.PageGadget.contentsUpdated()}}else{window.location=P.loginUrl}AJS.trigger("pagetree-children-loaded")},error:function(X){if(X.status=="403"){V.text(P["i18n-pagetree.error.permission"])}else{V.text(P["i18n-pagetree.error.general"])}}})};var q=function(B){f("div.plugin_pagetree_children_container:empty",B).addClass("hidden")};function t(F){var E=F.target;var D=E.getAttribute("data-type");var C=F.currentTarget.getAttribute("data-mobile")==="true";if(D==="toggle"){F.preventDefault();F.stopPropagation();k(F.target,null,null,null,C)}else{if(D==="load-all-after"){var I=E.getAttribute("data-last-rendered-id");var H=E.getAttribute("data-page-id")+"-"+E.getAttribute("data-tree-id");h(F.target,H,new Array(),null,"","",C,false,true,I,null)}else{if(D==="load-all-before"){var B=E.getAttribute("data-first-rendered-id");var H=E.getAttribute("data-page-id")+"-"+E.getAttribute("data-tree-id");var G="childrenspan"+B+"-"+E.getAttribute("data-tree-id");h(F.target,H,new Array(),null,"","",C,false,false,null,B,G)}else{return}}}F.preventDefault();F.stopPropagation()}var w=function(B,G,I){B[0].addEventListener("click",t,{passive:false});var E=m(B);var H=E.noRoot=="true";var D=H?"Orphan-"+G:E.rootPageId+"-"+G;var C=E.mobile=="true";if(C){B[0].setAttribute("data-mobile",C)}u[G]=E.treeRequestId;if(C==false){c[G]=AJS.params.pageId}else{c[G]=f("div.content-container").parent().attr("data-content-id")}B.children("fieldset").each(function(){var J=f(this);J.children("input[treeId]").attr("value",G);J.children("input[rootPage]").attr("value",D)});if(H){B.find("div.plugin_pagetree_children").attr("id","childrenOrphan-"+G);B.find("a.plugin_pagetree_expandall").click(function(J){g("childrenOrphan-"+G,J,C);return false});B.find("a.plugin_pagetree_collapseall").click(function(J){v("childrenOrphan-"+G,J,C);return false})}else{B.find("div.plugin_pagetree_children").attr("id","children"+D);B.find("a.plugin_pagetree_expandall").click(function(J){g("children"+D,J,C);return false});B.find("a.plugin_pagetree_collapseall").click(function(J){v("children"+D,J,C);return false})}var F=l(B);h(undefined,D,F,E.startDepth,E.spaceKey,"",C,false,I,null,null)};this.initPageTrees=function(B){f("div.plugin_pagetree").each(function(C){w(f(this),C,B)});A()};var A=function(){var B=self.placeFocus;if(B){self.placeFocus=function(){var C=f("form[name='pagetreesearchform']");C.attr("name","inlinecommentform");B();C.attr("name","pagetreesearchform")}}};f(".open-flyout-to-search").bind("click",function(B){if(f(".fly-out-open").length){setTimeout(function(){ConfluenceMobile.flyout.hide()},400)}else{setTimeout(function(){ConfluenceMobile.flyout.show()},400)}B.stopPropagation();B.preventDefault()})};Confluence=Confluence||{};Confluence.Plugins=Confluence.Plugins||{};Confluence.Plugins.PagetreeMacro={bind:function(b){var c=new a(b);c.initPageTrees(false)}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree-desktop.js' */
AJS.toInit(function(a){Confluence.Plugins.PagetreeMacro.bind(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-hide-traditional', location = 'jscripts/add-comment-hider.js' */
define("confluence-quick-edit/add-comment-hider",[],function(){return function(a){a("#comments-actions").hide()}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/add-comment-hider",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};